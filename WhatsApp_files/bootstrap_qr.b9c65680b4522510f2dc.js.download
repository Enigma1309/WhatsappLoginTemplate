/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[9209],{63509:(e,t,r)=>{var n={"./f00.png":92256,"./f01.png":7151,"./f02.png":29449,"./f03.png":94719,"./f04.png":83004,"./f05.png":99381,"./f06.png":4893,"./f07.png":61353,"./f08.png":45598,"./f09.png":79575,"./f10.png":5211,"./f11.png":19751,"./f12.png":61294,"./f13.png":70938,"./f14.png":81790,"./f15.png":8669,"./f16.png":30047,"./f17.png":61022,"./f18.png":33295,"./f19.png":99635,"./f20.png":82645,"./f21.png":67083,"./f22.png":55359,"./f23.png":30003,"./f24.png":77659,"./f25.png":81024,"./f26.png":64195,"./f27.png":37704,"./f28.png":15626,"./f29.png":12282,"./f30.png":57894,"./f31.png":53320,"./f32.png":18234,"./f33.png":37426,"./f34.png":37382,"./f35.png":80904,"./f36.png":5193,"./f37.png":38324,"./f38.png":83149,"./f39.png":68480,"./f40.png":35741,"./f41.png":24081,"./f42.png":9062,"./f43.png":51839,"./f44.png":77271,"./f45.png":39622,"./f46.png":48373,"./f47.png":51400,"./f48.png":42720,"./f49.png":43805,"./f50.png":56995,"./f51.png":75688,"./f52.png":31796,"./f53.png":73785,"./f54.png":62521,"./f55.png":71449,"./f56.png":98224,"./f57.png":10601,"./f58.png":72870,"./f59.png":93224,"./f60.png":21564,"./f61.png":93169,"./f62.png":54423,"./f63.png":3491,"./f64.png":86262,"./f65.png":37806,"./f66.png":35049,"./f67.png":4971,"./f68.png":32845,"./f69.png":29664,"./f70.png":29469,"./f71.png":60540,"./f72.png":14364,"./f73.png":34476,"./f74.png":80952,"./f75.png":47236,"./f76.png":91385,"./f77.png":86342,"./f78.png":93828,"./f79.png":7026,"./f80.png":59076,"./f81.png":86555,"./f82.png":15330,"./f83.png":51331,"./f84.png":44780,"./f85.png":2506,"./f86.png":27300,"./f87.png":30619,"./f88.png":83020,"./f89.png":58516,"./f90.png":15707,"./f91.png":71247,"./f92.png":54647,"./f93.png":67517,"./f94.png":83439,"./f95.png":38404,"./f96.png":50273,"./f97.png":44848,"./f98.png":79144,"./f99.png":40594,"./favicon-error.png":72654,"./favicon-error2.png":19528,"./favicon.png":29242};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id=63509},76554:(e,t,r)=>{var n={"./f00.png":11372,"./f01.png":48039,"./f02.png":49519,"./f03.png":98446,"./f04.png":68917,"./f05.png":46454,"./f06.png":80841,"./f07.png":41038,"./f08.png":57522,"./f09.png":4754,"./f10.png":44183,"./f11.png":99233,"./f12.png":347,"./f13.png":52761,"./f14.png":19754,"./f15.png":18613,"./f16.png":17613,"./f17.png":70322,"./f18.png":55928,"./f19.png":98442,"./f20.png":32677,"./f21.png":64770,"./f22.png":43426,"./f23.png":31644,"./f24.png":6597,"./f25.png":7210,"./f26.png":61890,"./f27.png":58229,"./f28.png":81250,"./f29.png":41431,"./f30.png":60853,"./f31.png":75920,"./f32.png":21202,"./f33.png":23022,"./f34.png":46622,"./f35.png":13683,"./f36.png":45274,"./f37.png":74507,"./f38.png":36466,"./f39.png":55254,"./f40.png":95725,"./f41.png":97585,"./f42.png":75218,"./f43.png":81303,"./f44.png":49465,"./f45.png":55625,"./f46.png":48475,"./f47.png":67848,"./f48.png":58139,"./f49.png":97019,"./f50.png":63744,"./f51.png":14517,"./f52.png":2181,"./f53.png":65405,"./f54.png":61605,"./f55.png":90866,"./f56.png":71888,"./f57.png":35515,"./f58.png":18457,"./f59.png":20009,"./f60.png":63163,"./f61.png":20930,"./f62.png":69341,"./f63.png":8373,"./f64.png":99910,"./f65.png":10127,"./f66.png":34843,"./f67.png":68683,"./f68.png":79587,"./f69.png":81265,"./f70.png":29761,"./f71.png":67156,"./f72.png":14427,"./f73.png":18241,"./f74.png":55948,"./f75.png":20439,"./f76.png":85044,"./f77.png":56746,"./f78.png":73675,"./f79.png":63159,"./f80.png":37160,"./f81.png":31456,"./f82.png":58193,"./f83.png":68436,"./f84.png":15188,"./f85.png":35444,"./f86.png":61218,"./f87.png":12535,"./f88.png":56277,"./f89.png":11847,"./f90.png":83242,"./f91.png":97168,"./f92.png":6763,"./f93.png":69685,"./f94.png":34887,"./f95.png":24111,"./f96.png":71972,"./f97.png":39920,"./f98.png":94784,"./f99.png":60795,"./favicon-error.png":6769,"./favicon-error2.png":77238,"./favicon.png":56216};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id=76554},23098:module=>{var e={},aa={},l;for(l in e)e.hasOwnProperty(l)&&(aa[l]=e[l]);function ba(e){eval.call(null,e)}for(l in e.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},"undefined"!=typeof arguments&&(e.arguments=arguments),"undefined"!=typeof console?(e.print||(e.print=function(e){console.log(e)}),e.printErr||(e.printErr=function(e){console.log(e)})):e.print||(e.print=function(){}),void 0===e.setWindowTitle&&(e.setWindowTitle=function(e){document.title=e}),!e.load&&e.read&&(e.load=function(t){ba(e.read(t))}),e.print||(e.print=function(){}),e.printErr||(e.printErr=e.print),e.arguments||(e.arguments=[]),e.thisProgram||(e.thisProgram="./this.program"),e.print=e.print,e.S=e.printErr,e.preRun=[],e.postRun=[],aa)aa.hasOwnProperty(l)&&(e[l]=aa[l]);var n={cb:function(e){ca=e},Ua:function(){return ca},na:function(){return m},X:function(e){m=e},Aa:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:return"*"===e[e.length-1]?n.H:"i"===e[0]?(assert(0==(e=parseInt(e.substr(1)))%8),e/8):0}},Ta:function(e){return Math.max(n.Aa(e),n.H)},dd:16,Bd:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},od:function(e,t,r){return r||"i64"!=e&&"double"!=e?e?Math.min(t||(e?n.Ta(e):0),n.H):Math.min(t,8):8},J:function(t,r,n){return n&&n.length?(n.splice||(n=Array.prototype.slice.call(n)),n.splice(0,0,r),e["dynCall_"+t].apply(null,n)):e["dynCall_"+t].call(null,r)},U:[],Ma:function(e){for(var t=0;t<n.U.length;t++)if(!n.U[t])return n.U[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},$a:function(e){n.U[(e-2)/2]=null},M:function(t){n.M.ma||(n.M.ma={}),n.M.ma[t]||(n.M.ma[t]=1,e.S(t))},ha:{},rd:function(e,t){assert(t),n.ha[t]||(n.ha[t]={});var r=n.ha[t];return r[e]||(r[e]=function(){return n.J(t,e,arguments)}),r[e]},pd:function(){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},W:function(e){var t=m;return m=(m=m+e|0)+15&-16,t},Ia:function(e){var t=p;return p=(p=p+e|0)+15&-16,t},P:function(e){var t=v;return(e=(v=(v=v+e|0)+15&-16)>=w)&&(z("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+w+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which adjusts the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 "),e=!0),e?(v=t,0):t},ea:function(e,t){return Math.ceil(e/(t||16))*(t||16)},xd:function(e,t,r){return r?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},La:8,H:4,ed:0};e.Runtime=n,n.addFunction=n.Ma,n.removeFunction=n.$a;var A=!1,da,fa,ca,ha,ia,buffer;function assert(e,t){e||z("Assertion failed: "+t)}function ga(a){var b=e["_"+a];if(!b)try{b=eval("_"+a)}catch(e){}return assert(b,"Cannot call unknown function "+a+" (perhaps LLVM optimizations or closure removed it?)"),b}function ma(e,t,r){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":D[e>>0]=t;break;case"i16":E[e>>1]=t;break;case"i32":F[e>>2]=t;break;case"i64":fa=[t>>>0,(da=t,1<=+na(da)?0<da?(0|oa(+pa(da/4294967296),4294967295))>>>0:~~+qa((da-+(~~da>>>0))/4294967296)>>>0:0)],F[e>>2]=fa[0],F[e+4>>2]=fa[1];break;case"float":ra[e>>2]=t;break;case"double":sa[e>>3]=t;break;default:z("invalid type for setValue: "+r)}}function ta(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return D[e>>0];case"i16":return E[e>>1];case"i32":case"i64":return F[e>>2];case"float":return ra[e>>2];case"double":return sa[e>>3];default:z("invalid type for setValue: "+t)}return null}function G(e,t,r,i){var a,s;"number"==typeof e?(a=!0,s=e):(a=!1,s=e.length);var o,l,c="string"==typeof t?t:null;if(r=4==r?i:[ua,n.W,n.Ia,n.P][void 0===r?2:r](Math.max(s,c?1:t.length)),a){for(i=r,assert(0==(3&r)),e=r+(-4&s);i<e;i+=4)F[i>>2]=0;for(e=r+s;i<e;)D[i++>>0]=0;return r}if("i8"===c)return e.subarray||e.slice?H.set(e,r):H.set(new Uint8Array(e),r),r;for(i=0;i<s;){var d=e[i];"function"==typeof d&&(d=n.sd(d)),0===(a=c||t[i])?i++:("i64"==a&&(a="i32"),ma(r+i,d,a),l!==a&&(o=n.Aa(a),l=a),i+=o)}return r}function la(t,r){if(0===r||!t)return"";for(var n,i=0,a=0;(i|=n=H[t+a>>0],0!=n||r)&&(a++,!r||a!=r););if(r||(r=a),n="",128>i){for(;0<r;)i=String.fromCharCode.apply(String,H.subarray(t,t+Math.min(r,1024))),n=n?n+i:i,t+=1024,r-=1024;return n}return e.UTF8ToString(t)}function za(e,t){for(var r,n,i,a,s,o="";;){if(!(r=e[t++]))return o;128&r?(n=63&e[t++],192==(224&r)?o+=String.fromCharCode((31&r)<<6|n):(i=63&e[t++],224==(240&r)?r=(15&r)<<12|n<<6|i:(a=63&e[t++],240==(248&r)?r=(7&r)<<18|n<<12|i<<6|a:(s=63&e[t++],248==(252&r)?r=(3&r)<<24|n<<18|i<<12|a<<6|s:r=(1&r)<<30|n<<24|i<<18|a<<12|s<<6|63&e[t++])),65536>r?o+=String.fromCharCode(r):(r-=65536,o+=String.fromCharCode(55296|r>>10,56320|1023&r)))):o+=String.fromCharCode(r)}}function Aa(e,t,r,n){if(!(0<n))return 0;var i=r;n=r+n-1;for(var a=0;a<e.length;++a){var s=e.charCodeAt(a);if(55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),127>=s){if(r>=n)break;t[r++]=s}else{if(2047>=s){if(r+1>=n)break;t[r++]=192|s>>6}else{if(65535>=s){if(r+2>=n)break;t[r++]=224|s>>12}else{if(2097151>=s){if(r+3>=n)break;t[r++]=240|s>>18}else{if(67108863>=s){if(r+4>=n)break;t[r++]=248|s>>24}else{if(r+5>=n)break;t[r++]=252|s>>30,t[r++]=128|s>>24&63}t[r++]=128|s>>18&63}t[r++]=128|s>>12&63}t[r++]=128|s>>6&63}t[r++]=128|63&s}}return t[r]=0,r-i}function Ba(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),127>=n?++t:t=2047>=n?t+2:65535>=n?t+3:2097151>=n?t+4:67108863>=n?t+5:t+6}return t}function Ca(t){var r=!!e.___cxa_demangle;if(r)try{var i=ua(t.length);ka(t.substr(1),i);var a=ua(4),s=e.___cxa_demangle(i,0,0,a);if(0===ta(a,"i32")&&s)return la(s)}catch(e){}finally{i&&Da(i),a&&Da(a),s&&Da(s)}var o=3,l={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},c=[],d=!0;i=t;try{if("Object._main"==t||"_main"==t)return"main()";if("number"==typeof t&&(t=la(t)),"_"!==t[0]||"_"!==t[1]||"Z"!==t[2])return t;switch(t[3]){case"n":return"operator new()";case"d":return"operator delete()"}i=function e(r,n,i){n=n||1/0;var a,s="",u=[];if("N"===t[o]){for(o++,"K"===t[o]&&o++,a=[];"E"!==t[o];)if("S"===t[o]){o++;var p=t.indexOf("_",o);a.push(c[t.substring(o,p)||0]||"?"),o=p+1}else if("C"===t[o])a.push(a[a.length-1]),o+=2;else{var h=(p=parseInt(t.substr(o))).toString().length;if(!p||!h){o--;break}var f=t.substr(o+h,p);a.push(f),c.push(f),o+=h+p}if(o++,a=a.join("::"),0==--n)return r?[a]:a}else("K"===t[o]||d&&"L"===t[o])&&o++,(p=parseInt(t.substr(o)))&&(h=p.toString().length,a=t.substr(o+h,p),o+=h+p);d=!1,"I"===t[o]?(o++,p=e(!0),s+=(h=e(!0,1,!0))[0]+" "+a+"<"+p.join(", ")+">"):s=a;e:for(;o<t.length&&0<n--;)if(a=t[o++],a in l)u.push(l[a]);else switch(a){case"P":u.push(e(!0,1,!0)[0]+"*");break;case"R":u.push(e(!0,1,!0)[0]+"&");break;case"L":o++,p=t.indexOf("E",o)-o,u.push(t.substr(o,p)),o+=p+2;break;case"A":if(p=parseInt(t.substr(o)),o+=p.toString().length,"_"!==t[o])throw"?";o++,u.push(e(!0,1,!0)[0]+" ["+p+"]");break;case"E":break e;default:s+="?"+a;break e}return i||1!==u.length||"void"!==u[0]||(u=[]),r?(s&&u.push(s+"?"),u):s+"("+u.join(", ")+")"}()}catch(e){i+="?"}return 0<=i.indexOf("?")&&!r&&n.M("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),i}function Ea(){return Fa().replace(/__Z[\w\d_]+/g,(function(e){var t=Ca(e);return e===t?e:e+" ["+t+"]"}))}function Fa(){var e=Error();if(!e.stack){try{throw Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function Ga(){var e=v;return 0<e%4096&&(e+=4096-e%4096),e}(function(){function a(e){return{arguments:(e=e.toString().match(d).slice(1))[0],body:e[1],returnValue:e[2]}}var b={stackSave:function(){n.na()},stackRestore:function(){n.X()},arrayToC:function(e){var t=n.W(e.length);return ja(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&ka(e,t=n.W(1+(e.length<<2))),t}},c={string:b.stringToC,array:b.arrayToC};ia=function(e,t,r,i,a){e=ga(e);var s=[],o=0;if(i)for(var l=0;l<i.length;l++){var d=c[r[l]];d?(0===o&&(o=n.na()),s[l]=d(i[l])):s[l]=i[l]}if(r=e.apply(null,s),"string"===t&&(r=la(r)),0!==o){if(a&&a.async)return void EmterpreterAsync.hd.push((function(){n.X(o)}));n.X(o)}return r};var d=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/,f={},h;for(h in b)b.hasOwnProperty(h)&&(f[h]=a(b[h]));ha=function(b,c,d){d=d||[];var h=ga(b);b=d.every((function(e){return"number"===e}));var u="string"!==c;if(u&&b)return h;var q=d.map((function(e,t){return"$"+t}));c="(function("+q.join(",")+") {";var y=d.length;if(!b){c+="var stack = "+f.stackSave.body+";";for(var B=0;B<y;B++){var J=q[B],ea=d[B];"number"!==ea&&(ea=f[ea+"ToC"],c+="var "+ea.arguments+" = "+J+";",c+=ea.body+";",c+=J+"="+ea.returnValue+";")}}return d=a((function(){return h})).returnValue,c+="var ret = "+d+"("+q.join(",")+");",u||(d=a((function(){return la})).returnValue,c+="ret = "+d+"(ret);"),b||(c+=f.stackRestore.body.replace("()","(stack)")+";"),eval(c+"return ret})")}})(),e.ccall=ia,e.cwrap=ha,e.setValue=ma,e.getValue=ta,e.ALLOC_NORMAL=0,e.ALLOC_STACK=1,e.ALLOC_STATIC=2,e.ALLOC_DYNAMIC=3,e.ALLOC_NONE=4,e.allocate=G,e.getMemory=function(e){return va?void 0!==wa&&!wa.C||!xa?n.P(e):ua(e):n.Ia(e)},e.Pointer_stringify=la,e.AsciiToString=function(e){for(var t="";;){var r=D[e++>>0];if(!r)return t;t+=String.fromCharCode(r)}},e.stringToAscii=function(e,t){return ya(e,t,!1)},e.UTF8ArrayToString=za,e.UTF8ToString=function(e){return za(H,e)},e.stringToUTF8Array=Aa,e.stringToUTF8=function(e,t,r){return Aa(e,H,t,r)},e.lengthBytesUTF8=Ba,e.UTF16ToString=function(e){for(var t=0,r="";;){var n=E[e+2*t>>1];if(0==n)return r;++t,r+=String.fromCharCode(n)}},e.stringToUTF16=function(e,t,r){if(void 0===r&&(r=2147483647),2>r)return 0;var n=t;r=(r-=2)<2*e.length?r/2:e.length;for(var i=0;i<r;++i)E[t>>1]=e.charCodeAt(i),t+=2;return E[t>>1]=0,t-n},e.lengthBytesUTF16=function(e){return 2*e.length},e.UTF32ToString=function(e){for(var t=0,r="";;){var n=F[e+4*t>>2];if(0==n)return r;++t,65536<=n?(n-=65536,r+=String.fromCharCode(55296|n>>10,56320|1023&n)):r+=String.fromCharCode(n)}},e.stringToUTF32=function(e,t,r){if(void 0===r&&(r=2147483647),4>r)return 0;var n=t;r=n+r-4;for(var i=0;i<e.length;++i){if(55296<=(a=e.charCodeAt(i))&&57343>=a)var a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i);if(F[t>>2]=a,(t+=4)+4>r)break}return F[t>>2]=0,t-n},e.lengthBytesUTF32=function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&++r,t+=4}return t},e.stackTrace=function(){return Ea()};for(var D,H,E,Ha,F,Ia,ra,sa,Ja=0,p=0,va=!1,Ka=0,m=0,La=0,Ma=0,v=0,Na=e.TOTAL_STACK||5242880,w=e.TOTAL_MEMORY||16777216,I=65536;I<w||I<2*Na;)I=16777216>I?2*I:I+16777216;function Oa(e){for(;0<e.length;){var t=e.shift();if("function"==typeof t)t();else{var r=t.Qa;"number"==typeof r?void 0===t.T?n.J("v",r):n.J("vi",r,[t.T]):r(void 0===t.T?null:t.T)}}}I!==w&&(w=I),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(w),D=new Int8Array(buffer),E=new Int16Array(buffer),F=new Int32Array(buffer),H=new Uint8Array(buffer),Ha=new Uint16Array(buffer),Ia=new Uint32Array(buffer),ra=new Float32Array(buffer),sa=new Float64Array(buffer),F[0]=255,assert(255===H[0]&&0===H[3],"Typed arrays 2 must be run on a little-endian system"),e.HEAP=void 0,e.buffer=buffer,e.HEAP8=D,e.HEAP16=E,e.HEAP32=F,e.HEAPU8=H,e.HEAPU16=Ha,e.HEAPU32=Ia,e.HEAPF32=ra,e.HEAPF64=sa;var Pa=[],Qa=[],Ra=[],K=[],Sa=[],xa=!1;function Ta(e){Pa.unshift(e)}function Ua(e){Sa.unshift(e)}function Va(e,t,r){return e=Aa(e,r=Array(0<r?r:Ba(e)+1),0,r.length),t&&(r.length=e),r}function ka(e,t,r){for(e=Va(e,r),r=0;r<e.length;)D[t+r>>0]=e[r],r+=1}function ja(e,t){for(var r=0;r<e.length;r++)D[t++>>0]=e[r]}function ya(e,t,r){for(var n=0;n<e.length;++n)D[t++>>0]=e.charCodeAt(n);r||(D[t>>0]=0)}e.addOnPreRun=Ta,e.addOnInit=function(e){Qa.unshift(e)},e.addOnPreMain=function(e){Ra.unshift(e)},e.addOnExit=function(e){K.unshift(e)},e.addOnPostRun=Ua,e.intArrayFromString=Va,e.intArrayToString=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];255<n&&(n&=255),t.push(String.fromCharCode(n))}return t.join("")},e.writeStringToMemory=ka,e.writeArrayToMemory=ja,e.writeAsciiToMemory=ya,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16)*n+r*(t>>>16)<<16)|0}),Math.td=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;32>t;t++)if(e&1<<31-t)return t;return 32}),Math.kd=Math.clz32;var na=Math.abs,qa=Math.ceil,pa=Math.floor,oa=Math.min,L=0,Wa=null,Xa=null;function Ya(){L++,e.monitorRunDependencies&&e.monitorRunDependencies(L)}function Za(){if(L--,e.monitorRunDependencies&&e.monitorRunDependencies(L),0==L&&(null!==Wa&&(clearInterval(Wa),Wa=null),Xa)){var t=Xa;Xa=null,t()}}e.addRunDependency=Ya,e.removeRunDependency=Za,e.preloadedImages={},e.preloadedAudios={},Ja=8,p=Ja+1696,Qa.push(),G([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,164,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",4,n.La);var $a=n.ea(G(12,"i8",2),8);function eb(e,t){K.push((function(){n.J("vi",e,[t])})),eb.level=K.length}assert(0==$a%8),e._bitshift64Ashr=ab,e._i64Subtract=bb,e._i64Add=cb,e._memset=db,e._bitshift64Lshr=fb,e._bitshift64Shl=gb;var M={G:1,B:2,Qc:3,Nb:4,F:5,sa:6,gb:7,kc:8,Z:9,ub:10,oa:11,$c:11,Ka:12,Y:13,Gb:14,wc:15,$:16,pa:17,ad:18,ba:19,qa:20,N:21,u:22,fc:23,Ja:24,O:25,Xc:26,Hb:27,sc:28,da:29,Nc:30,Zb:31,Gc:32,Db:33,Kc:34,oc:42,Kb:43,vb:44,Qb:45,Rb:46,Sb:47,Yb:48,Yc:49,ic:50,Pb:51,Ab:35,lc:37,mb:52,pb:53,bd:54,gc:55,qb:56,rb:57,Bb:35,sb:59,uc:60,jc:61,Uc:62,tc:63,pc:64,qc:65,Mc:66,mc:67,jb:68,Rc:69,wb:70,Hc:71,ac:72,Eb:73,ob:74,Bc:76,nb:77,Lc:78,Tb:79,Ub:80,Xb:81,Wb:82,Vb:83,vc:38,ra:39,bc:36,aa:40,Cc:95,Fc:96,zb:104,hc:105,kb:97,Jc:91,zc:88,rc:92,Oc:108,yb:111,hb:98,xb:103,ec:101,cc:100,Vc:110,Ib:112,Jb:113,Mb:115,lb:114,Cb:89,$b:90,Ic:93,Pc:94,ib:99,dc:102,Ob:106,xc:107,Wc:109,Zc:87,Fb:122,Sc:116,Ac:95,nc:123,Lb:84,Dc:75,tb:125,yc:131,Ec:130,Tc:86},hb={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can't send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function ib(t){return e.___errno_location&&(F[e.___errno_location()>>2]=t),t}function jb(e,t){for(var r=0,n=e.length-1;0<=n;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function N(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function kb(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function lb(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)}function mb(){for(var e="",t=!1,r=arguments.length-1;-1<=r&&!t;r--){if("string"!=typeof(t=0<=r?arguments[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var nb=[];function ob(e,t){nb[e]={input:[],output:[],L:t},pb(e,qb)}var qb={open:function(e){var t=nb[e.g.rdev];if(!t)throw new O(M.ba);e.tty=t,e.seekable=!1},close:function(e){e.tty.L.flush(e.tty)},flush:function(e){e.tty.L.flush(e.tty)},read:function(e,t,r,n){if(!e.tty||!e.tty.L.Ba)throw new O(M.sa);for(var i=0,a=0;a<n;a++){var s;try{s=e.tty.L.Ba(e.tty)}catch(e){throw new O(M.F)}if(void 0===s&&0===i)throw new O(M.oa);if(null==s)break;i++,t[r+a]=s}return i&&(e.g.timestamp=Date.now()),i},write:function(e,t,r,n){if(!e.tty||!e.tty.L.ja)throw new O(M.sa);for(var i=0;i<n;i++)try{e.tty.L.ja(e.tty,t[r+i])}catch(e){throw new O(M.F)}return n&&(e.g.timestamp=Date.now()),i}},rb={Ba:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&(null!==(t=readline())&&(t+="\n")),!t)return null;e.input=Va(t,!0)}return e.input.shift()},ja:function(t,r){null===r||10===r?(e.print(za(t.output,0)),t.output=[]):0!=r&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.print(za(t.output,0)),t.output=[])}},sb={ja:function(t,r){null===r||10===r?(e.printErr(za(t.output,0)),t.output=[]):0!=r&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.printErr(za(t.output,0)),t.output=[])}},P={q:null,A:function(){return P.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(24576==(61440&r)||4096==(61440&r))throw new O(M.G);return P.q||(P.q={dir:{g:{D:P.k.D,p:P.k.p,lookup:P.k.lookup,V:P.k.V,rename:P.k.rename,unlink:P.k.unlink,rmdir:P.k.rmdir,readdir:P.k.readdir,symlink:P.k.symlink},stream:{I:P.n.I}},file:{g:{D:P.k.D,p:P.k.p},stream:{I:P.n.I,read:P.n.read,write:P.n.write,ta:P.n.ta,Ea:P.n.Ea,Ga:P.n.Ga}},link:{g:{D:P.k.D,p:P.k.p,readlink:P.k.readlink},stream:{}},va:{g:{D:P.k.D,p:P.k.p},stream:tb}}),16384==(61440&(r=ub(e,t,r,n)).mode)?(r.k=P.q.dir.g,r.n=P.q.dir.stream,r.e={}):32768==(61440&r.mode)?(r.k=P.q.file.g,r.n=P.q.file.stream,r.o=0,r.e=null):40960==(61440&r.mode)?(r.k=P.q.link.g,r.n=P.q.link.stream):8192==(61440&r.mode)&&(r.k=P.q.va.g,r.n=P.q.va.stream),r.timestamp=Date.now(),e&&(e.e[t]=r),r},Sa:function(e){if(e.e&&e.e.subarray){for(var t=[],r=0;r<e.o;++r)t.push(e.e[r]);return t}return e.e},qd:function(e){return e.e?e.e.subarray?e.e.subarray(0,e.o):new Uint8Array(e.e):new Uint8Array},ya:function(e,t){if(e.e&&e.e.subarray&&t>e.e.length&&(e.e=P.Sa(e),e.o=e.e.length),!e.e||e.e.subarray){var r=e.e?e.e.buffer.byteLength:0;r>=t||(t=Math.max(t,r*(1048576>r?2:1.125)|0),0!=r&&(t=Math.max(t,256)),r=e.e,e.e=new Uint8Array(t),0<e.o&&e.e.set(r.subarray(0,e.o),0))}else for(!e.e&&0<t&&(e.e=[]);e.e.length<t;)e.e.push(0)},ab:function(e,t){if(e.o!=t)if(0==t)e.e=null,e.o=0;else{if(!e.e||e.e.subarray){var r=e.e;e.e=new Uint8Array(new ArrayBuffer(t)),r&&e.e.set(r.subarray(0,Math.min(t,e.o)))}else if(e.e||(e.e=[]),e.e.length>t)e.e.length=t;else for(;e.e.length<t;)e.e.push(0);e.o=t}},k:{D:function(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.o:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Pa=4096,t.blocks=Math.ceil(t.size/t.Pa),t},p:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&P.ab(e,t.size)},lookup:function(){throw vb[M.B]},V:function(e,t,r,n){return P.createNode(e,t,r,n)},rename:function(e,t,r){if(16384==(61440&e.mode)){var n;try{n=wb(t,r)}catch(e){}if(n)for(var i in n.e)throw new O(M.ra)}delete e.parent.e[e.name],e.name=r,t.e[r]=e,e.parent=t},unlink:function(e,t){delete e.e[t]},rmdir:function(e,t){var r,n=wb(e,t);for(r in n.e)throw new O(M.ra);delete e.e[t]},readdir:function(e){var t,r=[".",".."];for(t in e.e)e.e.hasOwnProperty(t)&&r.push(t);return r},symlink:function(e,t,r){return(e=P.createNode(e,t,41471,0)).link=r,e},readlink:function(e){if(40960!=(61440&e.mode))throw new O(M.u);return e.link}},n:{read:function(e,t,r,n,i){var a=e.g.e;if(i>=e.g.o)return 0;if(assert(0<=(e=Math.min(e.g.o-i,n))),8<e&&a.subarray)t.set(a.subarray(i,i+e),r);else for(n=0;n<e;n++)t[r+n]=a[i+n];return e},write:function(e,t,r,n,i,a){if(!n)return 0;if((e=e.g).timestamp=Date.now(),t.subarray&&(!e.e||e.e.subarray)){if(a)return e.e=t.subarray(r,r+n),e.o=n;if(0===e.o&&0===i)return e.e=new Uint8Array(t.subarray(r,r+n)),e.o=n;if(i+n<=e.o)return e.e.set(t.subarray(r,r+n),i),n}if(P.ya(e,i+n),e.e.subarray&&t.subarray)e.e.set(t.subarray(r,r+n),i);else for(a=0;a<n;a++)e.e[i+a]=t[r+a];return e.o=Math.max(e.o,i+n),n},I:function(e,t,r){if(1===r?t+=e.position:2===r&&32768==(61440&e.g.mode)&&(t+=e.g.o),0>t)throw new O(M.u);return t},ta:function(e,t,r){P.ya(e.g,t+r),e.g.o=Math.max(e.g.o,t+r)},Ea:function(e,t,r,n,i,a,s){if(32768!=(61440&e.g.mode))throw new O(M.ba);if(r=e.g.e,2&s||r.buffer!==t&&r.buffer!==t.buffer){if((0<i||i+n<e.g.o)&&(r=r.subarray?r.subarray(i,i+n):Array.prototype.slice.call(r,i,i+n)),e=!0,!(n=ua(n)))throw new O(M.Ka);t.set(r,n)}else e=!1,n=r.byteOffset;return{Cd:n,gd:e}},Ga:function(e,t,r,n,i){if(32768!=(61440&e.g.mode))throw new O(M.ba);return 2&i||P.n.write(e,t,0,n,r,!1),0}}};G(1,"i32*",2),G(1,"i32*",2),G(1,"i32*",2);var xb=null,yb=[null],zb=[],Ab=1,R=null,Cb=!0,S={},O=null,vb={};function T(e,t){if(t=t||{},!(e=mb("/",e)))return{path:"",g:null};var r,n={za:!0,ka:0};for(r in n)void 0===t[r]&&(t[r]=n[r]);if(8<t.ka)throw new O(M.aa);n=jb(e.split("/").filter((function(e){return!!e})),!1);var i=xb;r="/";for(var a=0;a<n.length;a++){var s=a===n.length-1;if(s&&t.parent)break;if(i=wb(i,n[a]),r=N(r+"/"+n[a]),i.R&&(!s||s&&t.za)&&(i=i.R.root),!s||t.ga)for(s=0;40960==(61440&i.mode);)if(i=Db(r),i=T(r=mb(kb(r),i),{ka:t.ka}).g,40<s++)throw new O(M.aa)}return{path:r,g:i}}function U(e){for(var t;;){if(e===e.parent)return e=e.A.Fa,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function Eb(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%R.length}function Fb(e){var t=Eb(e.parent.id,e.name);e.K=R[t],R[t]=e}function wb(e,t){var r;if(r=(r=Gb(e,"x"))?r:e.k.lookup?0:M.Y)throw new O(r,e);for(r=R[Eb(e.id,t)];r;r=r.K){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return e.k.lookup(e,t)}function ub(e,t,r,n){return Hb||((Hb=function(e,t,r,n){e||(e=this),this.parent=e,this.A=e.A,this.R=null,this.id=Ab++,this.name=t,this.mode=r,this.k={},this.n={},this.rdev=n}).prototype={},Object.defineProperties(Hb.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}},Xa:{get:function(){return 16384==(61440&this.mode)}},Ca:{get:function(){return 8192==(61440&this.mode)}}})),Fb(e=new Hb(e,t,r,n)),e}var Ib={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function Gb(e,t){return Cb||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:M.Y}function Jb(e,t){try{return wb(e,t),M.pa}catch(e){}return Gb(e,"wx")}function Kb(){for(var e=0;e<=4096;e++)if(!zb[e])return e;throw new O(M.Ja)}function Lb(e){Mb||((Mb=function(){}).prototype={},Object.defineProperties(Mb.prototype,{object:{get:function(){return this.g},set:function(e){this.g=e}},vd:{get:function(){return 1!=(2097155&this.flags)}},wd:{get:function(){return 0!=(2097155&this.flags)}},ud:{get:function(){return 1024&this.flags}}}));var t,r=new Mb;for(t in e)r[t]=e[t];return e=r,r=Kb(),e.fd=r,zb[r]=e}var tb={open:function(e){e.n=yb[e.g.rdev].n,e.n.open&&e.n.open(e)},I:function(){throw new O(M.da)}},Zb;function pb(e,t){yb[e]={n:t}}function Nb(e,t){var r,n="/"===t,i=!t;if(n&&xb)throw new O(M.$);if(!n&&!i){if(t=(r=T(t,{za:!1})).path,(r=r.g).R)throw new O(M.$);if(16384!=(61440&r.mode))throw new O(M.qa)}i={type:e,Ad:{},Fa:t,Ya:[]};var a=e.A(i);a.A=i,i.root=a,n?xb=a:r&&(r.R=i,r.A&&r.A.Ya.push(i))}function Ob(e,t,r){var n=T(e,{parent:!0}).g;if(!(e=lb(e))||"."===e||".."===e)throw new O(M.u);var i=Jb(n,e);if(i)throw new O(i);if(!n.k.V)throw new O(M.G);return n.k.V(n,e,t,r)}function Pb(e,t){return t=4095&(void 0!==t?t:438),Ob(e,t|=32768,0)}function V(e,t){return t=1023&(void 0!==t?t:511),Ob(e,t|=16384,0)}function Qb(e,t,r){return void 0===r&&(r=t,t=438),Ob(e,8192|t,r)}function Rb(e,t){if(!mb(e))throw new O(M.B);var r=T(t,{parent:!0}).g;if(!r)throw new O(M.B);var n=lb(t),i=Jb(r,n);if(i)throw new O(i);if(!r.k.symlink)throw new O(M.G);return r.k.symlink(r,n,e)}function Db(e){if(!(e=T(e).g))throw new O(M.B);if(!e.k.readlink)throw new O(M.u);return mb(U(e.parent),e.k.readlink(e))}function Sb(e,t){var r;if(!(r="string"==typeof e?T(e,{ga:!0}).g:e).k.p)throw new O(M.G);r.k.p(r,{mode:4095&t|-4096&r.mode,timestamp:Date.now()})}function Tb(t,r){var n,i,a;if(""===t)throw new O(M.B);if("string"==typeof r){if(void 0===(i=Ib[r]))throw Error("Unknown file open mode: "+r)}else i=r;if(n=64&(r=i)?4095&(void 0===n?438:n)|32768:0,"object"==typeof t)a=t;else{t=N(t);try{a=T(t,{ga:!(131072&r)}).g}catch(e){}}if(i=!1,64&r)if(a){if(128&r)throw new O(M.pa)}else a=Ob(t,n,0),i=!0;if(!a)throw new O(M.B);if(8192==(61440&a.mode)&&(r&=-513),65536&r&&16384!=(61440&a.mode))throw new O(M.qa);if(!i&&(a?40960==(61440&a.mode)?n=M.aa:16384==(61440&a.mode)&&(0!=(2097155&r)||512&r)?n=M.N:(n=["r","w","rw"][3&r],512&r&&(n+="w"),n=Gb(a,n)):n=M.B,n))throw new O(n);if(512&r){var s;if(!(s="string"==typeof(n=a)?T(n,{ga:!0}).g:n).k.p)throw new O(M.G);if(16384==(61440&s.mode))throw new O(M.N);if(32768!=(61440&s.mode))throw new O(M.u);if(n=Gb(s,"w"))throw new O(n);s.k.p(s,{size:0,timestamp:Date.now()})}r&=-641,(a=Lb({g:a,path:U(a),flags:r,seekable:!0,position:0,n:a.n,eb:[],error:!1})).n.open&&a.n.open(a),!e.logReadFiles||1&r||(Ub||(Ub={}),t in Ub||(Ub[t]=1,e.printErr("read file: "+t)));try{S.onOpenFile&&(s=0,1!=(2097155&r)&&(s|=1),0!=(2097155&r)&&(s|=2),S.onOpenFile(t,s))}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return a}function Vb(e){e.ia&&(e.ia=null);try{e.n.close&&e.n.close(e)}catch(e){throw e}finally{zb[e.fd]=null}}function Wb(e,t,r){if(!e.seekable||!e.n.I)throw new O(M.da);e.position=e.n.I(e,t,r),e.eb=[]}function Xb(e,t,r,n,i,a){if(0>n||0>i)throw new O(M.u);if(0==(2097155&e.flags))throw new O(M.Z);if(16384==(61440&e.g.mode))throw new O(M.N);if(!e.n.write)throw new O(M.u);1024&e.flags&&Wb(e,0,2);var s=!0;if(void 0===i)i=e.position,s=!1;else if(!e.seekable)throw new O(M.da);t=e.n.write(e,t,r,n,i,a),s||(e.position+=t);try{e.path&&S.onWriteToFile&&S.onWriteToFile(e.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+path+"') threw an exception: "+e.message)}return t}function Yb(){O||((O=function(e,t){this.g=t,this.bb=function(e){for(var t in this.Q=e,M)if(M[t]===e){this.code=t;break}},this.bb(e),this.message=hb[e]}).prototype=Error(),O.prototype.constructor=O,[M.B].forEach((function(e){vb[e]=new O(e),vb[e].stack="<generic error, no stack>"})))}function $b(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r}function ac(e,t,r,n){return Pb(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(r,n))}function bc(e,t,r,n,i,a){if(i=Pb(e=t?N(("string"==typeof e?e:U(e))+"/"+t):e,n=$b(n,i)),r){if("string"==typeof r){e=Array(r.length),t=0;for(var s=r.length;t<s;++t)e[t]=r.charCodeAt(t);r=e}Sb(i,146|n),Xb(e=Tb(i,"w"),r,0,r.length,0,a),Vb(e),Sb(i,n)}return i}function W(e,t,r,n){e=N(("string"==typeof e?e:U(e))+"/"+t),t=$b(!!r,!!n),W.Da||(W.Da=64);var i=W.Da++<<8|0;return pb(i,{open:function(e){e.seekable=!1},close:function(){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,i){for(var a=0,s=0;s<i;s++){var o;try{o=r()}catch(e){throw new O(M.F)}if(void 0===o&&0===a)throw new O(M.oa);if(null==o)break;a++,t[n+s]=o}return a&&(e.g.timestamp=Date.now()),a},write:function(e,t,r,i){for(var a=0;a<i;a++)try{n(t[r+a])}catch(e){throw new O(M.F)}return i&&(e.g.timestamp=Date.now()),a}}),Qb(e,t,i)}function cc(t){if(t.Ca||t.Xa||t.link||t.e)return!0;var r=!0;if("undefined"!=typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!e.read)throw Error("Cannot load without read() or XMLHttpRequest.");try{t.e=Va(e.read(t.url),!0),t.o=t.e.length}catch(e){r=!1}return r||ib(M.F),r}var dc={},Hb,Mb,Ub,ec=0;function X(){return F[(ec+=4)-4>>2]}function fc(){var e;if(e=X(),!(e=zb[e]))throw new O(M.Z);return e}function wa(e){wa.C||(v=Ga(),wa.C=!0,assert(n.P),wa.Ra=n.P,n.P=function(){z("cannot dynamically allocate, sbrk now has control")});var t=v;return 0==e||wa.Ra(e)?t:4294967295}function hc(e,t){if(ic=e,jc=t,!kc)return 1;if(0==e)Y=function(){setTimeout(lc,t)},mc="timeout";else if(1==e)Y=function(){nc(lc)},mc="rAF";else if(2==e){if(!window.setImmediate){var r=[];window.addEventListener("message",(function(e){e.source===window&&"__emcc"===e.data&&(e.stopPropagation(),r.shift()())}),!0),window.setImmediate=function(e){r.push(e),window.postMessage("__emcc","*")}}Y=function(){window.setImmediate(lc)},mc="immediate"}return 0}function oc(t,r,i,a,s){e.noExitRuntime=!0,assert(!kc,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),kc=t,pc=a;var o=qc;if(lc=function(){if(!A)if(0<rc.length){var r=Date.now(),i=rc.shift();if(i.Qa(i.T),sc){var s=sc,l=0==s%1?s-1:Math.floor(s);sc=i.ld?l:(8*s+(l+.5))/9}console.log('main loop blocker "'+i.name+'" took '+(Date.now()-r)+" ms"),tc(),setTimeout(lc,0)}else o<qc||(uc=uc+1|0,1==ic&&1<jc&&0!=uc%jc?Y():("timeout"===mc&&e.fa&&(e.S("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),mc=""),vc((function(){void 0!==a?n.J("vi",t,[a]):n.J("v",t)})),o<qc||("object"==typeof SDL&&SDL.audio&&SDL.audio.Za&&SDL.audio.Za(),Y())))},s||(r&&0<r?hc(0,1e3/r):hc(1,1),Y()),i)throw"SimulateInfiniteLoop"}e._memcpy=gc;var Y=null,mc="",qc=0,kc=null,pc=0,ic=0,jc=0,uc=0,rc=[];function tc(){if(e.setStatus){var t=e.statusMessage||"Please wait...",r=sc,n=wc.nd;r?r<n?e.setStatus(t+" ("+(n-r)+"/"+n+")"):e.setStatus(t):e.setStatus("")}}function vc(t){if(!(A||e.preMainLoop&&!1===e.preMainLoop())){try{t()}catch(t){if(t instanceof xc)return;throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t}e.postMainLoop&&e.postMainLoop()}}var wc={},lc,sc,yc=!1,zc=!1,Ac=[];function Bc(){function t(){zc=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}if(e.preloadPlugins||(e.preloadPlugins=[]),!Cc){Cc=!0;try{Dc=!0}catch(e){Dc=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Ec="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Dc?null:console.log("warning: no BlobBuilder"),Fc="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,e.Ha||void 0!==Fc||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),e.Ha=!0),e.preloadPlugins.push({canHandle:function(t){return!e.Ha&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},handle:function(t,r,i,a){var s=null;if(Dc)try{(s=new Blob([t],{type:Gc(r)})).size!==t.length&&(s=new Blob([new Uint8Array(t).buffer],{type:Gc(r)}))}catch(e){n.M("Blob constructor present but fails: "+e+"; falling back to blob builder")}s||((s=new Ec).append(new Uint8Array(t).buffer),s=s.getBlob());var o=Fc.createObjectURL(s),l=new Image;l.onload=function(){assert(l.complete,"Image "+r+" could not be decoded");var n=document.createElement("canvas");n.width=l.width,n.height=l.height,n.getContext("2d").drawImage(l,0,0),e.preloadedImages[r]=n,Fc.revokeObjectURL(o),i&&i(t)},l.onerror=function(){console.log("Image "+o+" could not be decoded"),a&&a()},l.src=o}}),e.preloadPlugins.push({canHandle:function(t){return!e.zd&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(t,r,n,i){function a(i){o||(o=!0,e.preloadedAudios[r]=i,n&&n(t))}function s(){o||(o=!0,e.preloadedAudios[r]=new Audio,i&&i())}var o=!1;if(!Dc)return s();try{var l=new Blob([t],{type:Gc(r)})}catch(e){return s()}l=Fc.createObjectURL(l);var c=new Audio;c.addEventListener("canplaythrough",(function(){a(c)}),!1),c.onerror=function(){if(!o){console.log("warning: browser could not fully decode audio "+r+", trying slower base64 approach");for(var e="",n=0,i=0,s=0;s<t.length;s++)for(n=n<<8|t[s],i+=8;6<=i;){var l=n>>i-6&63;i=i-6,e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]}2==i?(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&n)<<4],e+="=="):4==i&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&n)<<2],e+="="),c.src="data:audio/x-"+r.substr(-3)+";base64,"+e,a(c)}},c.src=l,Hc((function(){a(c)}))}});var r=e.canvas;r&&(r.la=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.wa=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.wa=r.wa.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),e.elementPointerLock&&r.addEventListener("click",(function(e){!zc&&r.la&&(r.la(),e.preventDefault())}),!1))}}function Ic(t,r,n,i){if(r&&e.fa&&t==e.canvas)return e.fa;var a,s;if(r){if(s={antialias:!1,alpha:!1},i)for(var o in i)s[o]=i[o];(s=GL.createContext(t,s))&&(a=GL.getContext(s).cd),t.style.backgroundColor="black"}else a=t.getContext("2d");return a?(n&&(r||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.fa=a,r&&GL.yd(s),e.Dd=r,Ac.forEach((function(e){e()})),Bc()),a):null}var Jc=!1,Kc=void 0,Lc=void 0;function Mc(t,r,n){function i(){yc=!1;var t=a.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t?(a.ua=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},a.ua=a.ua.bind(document),Kc&&a.la(),yc=!0,Lc&&Nc()):(t.parentNode.insertBefore(a,t),t.parentNode.removeChild(t),Lc&&Oc()),e.onFullScreen&&e.onFullScreen(yc),Pc(a)}void 0===(Kc=t)&&(Kc=!0),void 0===(Lc=r)&&(Lc=!1),void 0===(Qc=n)&&(Qc=null);var a=e.canvas;Jc||(Jc=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var s=document.createElement("div");a.parentNode.insertBefore(s,a),s.appendChild(a),s.C=s.requestFullScreen||s.mozRequestFullScreen||s.msRequestFullscreen||(s.webkitRequestFullScreen?function(){s.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),n?s.C({Ed:n}):s.C()}var Rc=0;function Sc(e){var t=Date.now();if(0===Rc)Rc=t+1e3/60;else for(;t+2>=Rc;)Rc+=1e3/60;t=Math.max(Rc-t,0),setTimeout(e,t)}function nc(e){"undefined"==typeof window?Sc(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Sc),window.requestAnimationFrame(e))}function Hc(t){e.noExitRuntime=!0,setTimeout((function(){A||t()}),1e4)}function Gc(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}function Tc(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)}function Uc(e,t,r){Tc(e,(function(r){assert(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),Za()}),(function(){if(!r)throw'Loading data file "'+e+'" failed.';r()})),Ya()}var Vc=[],Cc,Dc,Ec,Fc,Qc;function Wc(){var t=e.canvas;Vc.forEach((function(e){e(t.width,t.height)}))}function Nc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=8388608|e}Wc()}function Oc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=-8388609&e}Wc()}function Pc(t,r,n){r&&n?(t.fb=r,t.Va=n):(r=t.fb,n=t.Va);var i=r,a=n;if(e.forcedAspectRatio&&0<e.forcedAspectRatio&&(i/a<e.forcedAspectRatio?i=Math.round(a*e.forcedAspectRatio):a=Math.round(i/e.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&"undefined"!=typeof screen){var s=Math.min(screen.width/i,screen.height/a);i=Math.round(i*s),a=Math.round(a*s)}Lc?(t.width!=i&&(t.width=i),t.height!=a&&(t.height=a),void 0!==t.style&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=r&&(t.width=r),t.height!=n&&(t.height=n),void 0!==t.style&&(i!=r||a!=n?(t.style.setProperty("width",i+"px","important"),t.style.setProperty("height",a+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))}Yb(),R=Array(4096),Nb(P,"/"),V("/tmp"),V("/home"),V("/home/web_user"),function(){var e;if(V("/dev"),pb(259,{read:function(){return 0},write:function(e,t,r,n){return n}}),Qb("/dev/null",259),ob(1280,rb),ob(1536,sb),Qb("/dev/tty",1280),Qb("/dev/tty1",1536),"undefined"!=typeof crypto){var t=new Uint8Array(1);e=function(){return crypto.getRandomValues(t),t[0]}}else e=function(){return 256*Math.random()|0};W("/dev","random",e),W("/dev","urandom",e),V("/dev/shm"),V("/dev/shm/tmp")}(),V("/proc"),V("/proc/self"),V("/proc/self/fd"),Nb({A:function(){var e=ub("/proc/self","fd",16895,73);return e.k={lookup:function(e,t){var r=zb[+t];if(!r)throw new O(M.Z);var n={parent:null,A:{Fa:"fake"},k:{readlink:function(){return r.path}}};return n.parent=n}},e}},"/proc/self/fd"),Qa.unshift((function(){if(!e.noFSInit&&!Zb){assert(!Zb,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),Zb=!0,Yb(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?W("/dev","stdin",e.stdin):Rb("/dev/tty","/dev/stdin"),e.stdout?W("/dev","stdout",null,e.stdout):Rb("/dev/tty","/dev/stdout"),e.stderr?W("/dev","stderr",null,e.stderr):Rb("/dev/tty1","/dev/stderr");var t=Tb("/dev/stdin","r");assert(0===t.fd,"invalid handle for stdin ("+t.fd+")"),assert(1===(t=Tb("/dev/stdout","w")).fd,"invalid handle for stdout ("+t.fd+")"),assert(2===(t=Tb("/dev/stderr","w")).fd,"invalid handle for stderr ("+t.fd+")")}})),Ra.push((function(){Cb=!1})),K.push((function(){Zb=!1;var t=e._fflush;for(t&&t(0),t=0;t<zb.length;t++){var r=zb[t];r&&Vb(r)}})),e.FS_createFolder=function(e,t,r,n){return V(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(r,n))},e.FS_createPath=function(e,t){e="string"==typeof e?e:U(e);for(var r=t.split("/").reverse();r.length;){var n=r.pop();if(n){var i=N(e+"/"+n);try{V(i)}catch(e){}e=i}}return i},e.FS_createDataFile=bc,e.FS_createPreloadedFile=function(t,r,n,i,a,s,o,l,c,d){function u(n){function u(e){d&&d(),l||bc(t,r,e,i,a,c),s&&s(),Za()}var h=!1;e.preloadPlugins.forEach((function(e){!h&&e.canHandle(p)&&(e.handle(n,p,u,(function(){o&&o(),Za()})),h=!0)})),h||u(n)}Bc();var p=r?mb(N(t+"/"+r)):t;Ya(),"string"==typeof n?Uc(n,(function(e){u(e)}),o):u(n)},e.FS_createLazyFile=function(e,t,r,n,i){if("undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";r={Ca:!1,url:r};var a=ac(e,t,n,i);r.e?a.e=r.e:r.url&&(a.e=null,a.url=r.url),Object.defineProperty(a,"usedBytes",{get:function(){return this.e.length}});var s={};return Object.keys(a.n).forEach((function(e){var t=a.n[e];s[e]=function(){if(!cc(a))throw new O(M.F);return t.apply(null,arguments)}})),s.read=function(e,t,r,n,i){if(!cc(a))throw new O(M.F);if(i>=(e=e.g.e).length)return 0;if(assert(0<=(n=Math.min(e.length-i,n))),e.slice)for(var s=0;s<n;s++)t[r+s]=e[i+s];else for(s=0;s<n;s++)t[r+s]=e.get(i+s);return n},a.n=s,a},e.FS_createLink=function(e,t,r){return Rb(r,e=N(("string"==typeof e?e:U(e))+"/"+t))},e.FS_createDevice=W,e.FS_unlink=function(e){var t,r=T(e,{parent:!0}).g,n=lb(e),i=wb(r,n);e:{try{t=wb(r,n)}catch(e){t=e.Q;break e}var a=Gb(r,"wx");t=a||(16384==(61440&t.mode)?M.N:0)}if(t)throw t===M.N&&(t=M.G),new O(t);if(!r.k.unlink)throw new O(M.G);if(i.R)throw new O(M.$);try{S.willDeletePath&&S.willDeletePath(e)}catch(t){console.log("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}if(r.k.unlink(r,n),r=Eb(i.parent.id,i.name),R[r]===i)R[r]=i.K;else for(r=R[r];r;){if(r.K===i){r.K=i.K;break}r=r.K}try{S.onDeletePath&&S.onDeletePath(e)}catch(t){console.log("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},Qa.unshift((function(){})),K.push((function(){})),e.requestFullScreen=function(e,t,r){Mc(e,t,r)},e.requestAnimationFrame=function(e){nc(e)},e.setCanvasSize=function(t,r,n){Pc(e.canvas,t,r),n||Wc()},e.pauseMainLoop=function(){Y=null,qc++},e.resumeMainLoop=function(){qc++;var e=ic,t=jc,r=kc;kc=null,oc(r,0,!1,pc,!0),hc(e,t),Y()},e.getUserMedia=function(){window.C||(window.C=navigator.getUserMedia||navigator.mozGetUserMedia),window.C(void 0)},e.createContext=function(e,t,r,n){return Ic(e,t,r,n)},Ka=m=n.ea(p),va=!0,La=Ka+Na,Ma=v=n.ea(La),assert(Ma<w,"TOTAL_MEMORY not big enough for stack");var Xc=G([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",3);e.Na={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array,NaN:NaN,Infinity:1/0},e.Oa={abort:z,assert,invoke_ii:function(t,r){try{return e.dynCall_ii(t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_iiii:function(t,r,n,i){try{return e.dynCall_iiii(t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_vi:function(t,r){try{e.dynCall_vi(t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},_pthread_cleanup_pop:function(){assert(eb.level==K.length,"cannot pop if something else added meanwhile!"),K.pop(),eb.level=K.length},___lock:function(){},_emscripten_set_main_loop:oc,_pthread_self:function(){return 0},___syscall6:function(e,t){ec=t;try{return Vb(fc()),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_emscripten_set_main_loop_timing:hc,_abort:function(){e.abort()},_sbrk:wa,_time:function(e){var t=Date.now()/1e3|0;return e&&(F[e>>2]=t),t},___setErrNo:ib,_emscripten_memcpy_big:function(e,t,r){return H.set(H.subarray(t,t+r),e),e},___syscall54:function(e,t){ec=t;try{var r=fc(),n=X();switch(n){case 21505:case 21506:return r.tty?0:-M.O;case 21519:if(!r.tty)return-M.O;var i=X();return F[i>>2]=0;case 21520:return r.tty?-M.u:-M.O;case 21531:if(i=X(),!r.n.Wa)throw new O(M.O);return r.n.Wa(r,n,i);default:z("bad ioctl syscall "+n)}}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},___unlock:function(){},___syscall140:function(e,t){ec=t;try{var r=fc(),n=X(),i=X(),a=X(),s=X();return assert(0===n),Wb(r,i,s),F[a>>2]=r.position,r.ia&&0===i&&0===s&&(r.ia=null),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_pthread_cleanup_push:eb,_sysconf:function(e){switch(e){case 30:return 4096;case 85:return I/4096;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ib(M.u),-1},___syscall146:function(e,t){ec=t;try{var r,n=fc(),i=X();e:{for(var a=X(),s=0,o=0;o<a;o++){var l=Xb(n,D,F[i+8*o>>2],F[i+(8*o+4)>>2],void 0);if(0>l){r=-1;break e}s+=l}r=s}return r}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},STACKTOP:m,STACK_MAX:La,tempDoublePtr:$a,ABORT:A,cttz_i8:Xc};var Z=function(e,t,r){var n=new e.Int8Array(r),i=(new e.Int16Array(r),new e.Int32Array(r)),a=new e.Uint8Array(r),s=(new e.Uint16Array(r),new e.Uint32Array(r),new e.Float32Array(r),new e.Float64Array(r),0|t.STACKTOP),o=(t.STACK_MAX,t.tempDoublePtr,t.ABORT,t.cttz_i8,0),l=(e.NaN,e.Infinity,0),c=(e.Math.floor,e.Math.abs,e.Math.sqrt,e.Math.pow,e.Math.cos,e.Math.sin,e.Math.tan,e.Math.acos,e.Math.asin,e.Math.atan,e.Math.atan2,e.Math.exp,e.Math.log,e.Math.ceil,e.Math.imul),d=(e.Math.min,e.Math.clz32,t.abort),u=(t.assert,t.invoke_ii,t.invoke_iiii,t.invoke_vi,t._pthread_cleanup_pop),p=t.___lock,h=(t._emscripten_set_main_loop,t._pthread_self),f=t.___syscall6,_=(t._emscripten_set_main_loop_timing,t._abort),m=t._sbrk,g=t._time,y=(t.___setErrNo,t._emscripten_memcpy_big),E=t.___syscall54,S=t.___unlock,v=t.___syscall140,T=t._pthread_cleanup_push,A=t._sysconf,C=t.___syscall146;function b(e,t,r){e|=0;var n,a=0,o=0,c=0,d=0,u=0,p=0,h=0,f=0,_=0,m=0,g=0;n=s,s=s+160|0,P(a=n,t|=0,r|=0),t=0|i[(r=a+144|0)>>2],o=0|i[r+4>>2],d=0|i[(c=r=a+64|0)>>2],u=0|i[c+4>>2],c=0|B(0|t,0|o,18,0),p=l,h=0|G(0|d,0|u,0|t,0|o),o=0|G(0|h,0|l,0|c,0|p),i[(p=r)>>2]=o,i[p+4>>2]=l,o=0|i[(p=a+136|0)>>2],r=0|i[p+4>>2],h=0|i[(c=p=a+56|0)>>2],t=0|i[c+4>>2],c=0|B(0|o,0|r,18,0),u=l,d=0|G(0|h,0|t,0|o,0|r),r=0|G(0|d,0|l,0|c,0|u),i[(u=p)>>2]=r,i[u+4>>2]=l,r=0|i[(u=a+128|0)>>2],p=0|i[u+4>>2],d=0|i[(c=u=a+48|0)>>2],o=0|i[c+4>>2],c=0|B(0|r,0|p,18,0),t=l,h=0|G(0|d,0|o,0|r,0|p),p=0|G(0|h,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,p=0|i[(t=a+120|0)>>2],u=0|i[t+4>>2],h=0|i[(c=t=a+40|0)>>2],r=0|i[c+4>>2],c=0|B(0|p,0|u,18,0),o=l,d=0|G(0|h,0|r,0|p,0|u),u=0|G(0|d,0|l,0|c,0|o),i[(o=t)>>2]=u,i[o+4>>2]=l,u=0|i[(o=a+112|0)>>2],t=0|i[o+4>>2],d=0|i[(c=o=a+32|0)>>2],p=0|i[c+4>>2],c=0|B(0|u,0|t,18,0),r=l,h=0|G(0|d,0|p,0|u,0|t),t=0|G(0|h,0|l,0|c,0|r),i[(r=o)>>2]=t,i[r+4>>2]=l,t=0|i[(r=a+104|0)>>2],o=0|i[r+4>>2],h=0|i[(c=r=a+24|0)>>2],u=0|i[c+4>>2],c=0|B(0|t,0|o,18,0),p=l,d=0|G(0|h,0|u,0|t,0|o),o=0|G(0|d,0|l,0|c,0|p),i[(p=r)>>2]=o,i[p+4>>2]=l,o=0|i[(p=a+96|0)>>2],r=0|i[p+4>>2],d=0|i[(c=p=a+16|0)>>2],t=0|i[c+4>>2],c=0|B(0|o,0|r,18,0),u=l,h=0|G(0|d,0|t,0|o,0|r),r=0|G(0|h,0|l,0|c,0|u),i[(u=p)>>2]=r,i[u+4>>2]=l,r=0|i[(u=a+88|0)>>2],p=0|i[u+4>>2],h=0|i[(c=u=a+8|0)>>2],o=0|i[c+4>>2],c=0|B(0|r,0|p,18,0),t=l,d=0|G(0|h,0|o,0|r,0|p),p=0|G(0|d,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,c=0|i[(p=t=a+80|0)>>2],d=0|i[p+4>>2],r=0|i[(p=a)>>2],o=0|i[p+4>>2],p=0|B(0|c,0|d,18,0),h=l,f=0|G(0|r,0|o,0|c,0|d),d=0|G(0|f,0|l,0|p,0|h),h=l,i[(p=a)>>2]=d,i[p+4>>2]=h,i[(p=t)>>2]=0,i[p+4>>2]=0,p=h,h=d,d=0;do{r=0|k(0|h,0|p,0|(o=0|x(0|(c=0|L(0|(f=0|G(p>>31>>>6|0,0,0|h,0|p)),0|l,26)),0|(f=l),26)),0|l),i[(o=a+(d<<3)|0)>>2]=r,i[o+4>>2]=l,g=0|k(0|(_=0|G(0|c,0|f,0|i[(r=o=a+((1|d)<<3)|0)>>2],0|i[r+4>>2])),0|(r=l),0|(m=0|x(0|(c=0|L(0|(f=0|G(r>>31>>>7|0,0,0|_,0|r)),0|l,25)),0|(f=l),25)),0|l),i[(m=o)>>2]=g,i[m+4>>2]=l,h=0|G(0|c,0|f,0|i[(g=m=a+((d=d+2|0)<<3)|0)>>2],0|i[g+4>>2]),p=l,i[(g=m)>>2]=h,i[g+4>>2]=p}while(d>>>0<10);p=0|i[(d=t)>>2],h=0|i[d+4>>2],g=0|i[(d=a)>>2],m=0|i[d+4>>2],d=0|B(0|p,0|h,18,0),f=l,c=0|G(0|g,0|m,0|p,0|h),h=0|G(0|c,0|l,0|d,0|f),f=l,i[(d=t)>>2]=0,i[d+4>>2]=0,p=0|k(0|h,0|f,0|(c=0|x(0|(t=0|L(0|(d=0|G(f>>31>>>6|0,0,0|h,0|f)),0|l,26)),0|(d=l),26)),0|l),i[(c=a)>>2]=p,i[c+4>>2]=l,p=0|G(0|t,0|d,0|i[(c=u)>>2],0|i[c+4>>2]),i[(c=u)>>2]=p,i[c+4>>2]=l,c=e,e=a,a=c+80|0;do{i[c>>2]=i[e>>2],c=c+4|0,e=e+4|0}while((0|c)<(0|a));s=n}function P(e,t,r){e|=0,r|=0;var n=0,a=0,s=0,o=0,c=0,d=0,u=0,p=0,h=0,f=0,_=0,m=0,g=0,y=0,E=0,S=0,v=0,T=0,A=0,C=0,b=0,P=0,M=0;n=0|L(0,0|i[(t|=0)>>2],32),a=l,o=0|B(0|(s=0|L(0,0|i[r>>2],32)),0|l,0|n,0|a),i[(a=e)>>2]=o,i[a+4>>2]=l,a=0|L(0,0|i[t>>2],32),o=l,c=0|B(0|(s=0|L(0,0|i[(n=r+8|0)>>2],32)),0|l,0|a,0|o),o=l,s=0|L(0,0|i[(a=t+8|0)>>2],32),d=l,d=0|G(0|(p=0|B(0|(u=0|L(0,0|i[r>>2],32)),0|l,0|s,0|d)),0|l,0|c,0|o),i[(o=e+8|0)>>2]=d,i[o+4>>2]=l,o=0|L(0,0|i[a>>2],31),d=l,p=0|B(0|(c=0|L(0,0|i[n>>2],32)),0|l,0|o,0|d),d=l,o=0|L(0,0|i[t>>2],32),c=l,c=0|G(0|(h=0|B(0|(u=0|L(0,0|i[(s=r+16|0)>>2],32)),0|l,0|o,0|c)),0|l,0|p,0|d),d=l,h=0|L(0,0|i[(p=t+16|0)>>2],32),o=l,o=0|G(0|c,0|d,0|(f=0|B(0|(u=0|L(0,0|i[r>>2],32)),0|l,0|h,0|o)),0|l),i[(f=e+16|0)>>2]=o,i[f+4>>2]=l,f=0|L(0,0|i[a>>2],32),o=l,c=0|B(0|(d=0|L(0,0|i[s>>2],32)),0|l,0|f,0|o),o=l,f=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|(u=0|B(0|(h=0|L(0,0|i[n>>2],32)),0|l,0|f,0|d)),0|l,0|c,0|o),o=l,c=0|L(0,0|i[t>>2],32),u=l,u=0|G(0|d,0|o,0|(_=0|B(0|(h=0|L(0,0|i[(f=r+24|0)>>2],32)),0|l,0|c,0|u)),0|l),_=l,d=0|L(0,0|i[(o=t+24|0)>>2],32),c=l,c=0|G(0|u,0|_,0|(m=0|B(0|(h=0|L(0,0|i[r>>2],32)),0|l,0|d,0|c)),0|l),i[(m=e+24|0)>>2]=c,i[m+4>>2]=l,m=0|L(0,0|i[p>>2],32),c=l,u=0|B(0|(_=0|L(0,0|i[s>>2],32)),0|l,0|m,0|c),c=l,m=0|L(0,0|i[a>>2],32),_=l,h=0|B(0|(d=0|L(0,0|i[f>>2],32)),0|l,0|m,0|_),_=l,m=0|L(0,0|i[o>>2],32),d=l,d=0|G(0|(y=0|B(0|(g=0|L(0,0|i[n>>2],32)),0|l,0|m,0|d)),0|l,0|h,0|_),d=0|G(0|(_=0|x(0|d,0|l,1)),0|l,0|u,0|c),c=l,u=0|L(0,0|i[t>>2],32),_=l,_=0|G(0|d,0|c,0|(m=0|B(0|(y=0|L(0,0|i[(h=r+32|0)>>2],32)),0|l,0|u,0|_)),0|l),m=l,d=0|L(0,0|i[(c=t+32|0)>>2],32),u=l,u=0|G(0|_,0|m,0|(g=0|B(0|(y=0|L(0,0|i[r>>2],32)),0|l,0|d,0|u)),0|l),i[(g=e+32|0)>>2]=u,i[g+4>>2]=l,g=0|L(0,0|i[p>>2],32),u=l,_=0|B(0|(m=0|L(0,0|i[f>>2],32)),0|l,0|g,0|u),u=l,g=0|L(0,0|i[o>>2],32),m=l,m=0|G(0|(y=0|B(0|(d=0|L(0,0|i[s>>2],32)),0|l,0|g,0|m)),0|l,0|_,0|u),u=l,_=0|L(0,0|i[a>>2],32),y=l,y=0|G(0|m,0|u,0|(d=0|B(0|(g=0|L(0,0|i[h>>2],32)),0|l,0|_,0|y)),0|l),d=l,u=0|L(0,0|i[c>>2],32),m=l,m=0|G(0|y,0|d,0|(g=0|B(0|(_=0|L(0,0|i[n>>2],32)),0|l,0|u,0|m)),0|l),g=l,d=0|L(0,0|i[t>>2],32),y=l,y=0|G(0|m,0|g,0|(E=0|B(0|(_=0|L(0,0|i[(u=r+40|0)>>2],32)),0|l,0|d,0|y)),0|l),E=l,m=0|L(0,0|i[(g=t+40|0)>>2],32),d=l,d=0|G(0|y,0|E,0|(S=0|B(0|(_=0|L(0,0|i[r>>2],32)),0|l,0|m,0|d)),0|l),i[(S=e+40|0)>>2]=d,i[S+4>>2]=l,S=0|L(0,0|i[o>>2],32),d=l,y=0|B(0|(E=0|L(0,0|i[f>>2],32)),0|l,0|S,0|d),d=l,S=0|L(0,0|i[a>>2],32),E=l,E=0|G(0|(_=0|B(0|(m=0|L(0,0|i[u>>2],32)),0|l,0|S,0|E)),0|l,0|y,0|d),d=l,y=0|L(0,0|i[g>>2],32),_=l,m=0|x(0|(_=0|G(0|E,0|d,0|(m=0|B(0|(S=0|L(0,0|i[n>>2],32)),0|l,0|y,0|_)),0|l)),0|l,1),_=l,d=0|L(0,0|i[p>>2],32),E=l,E=0|G(0|m,0|_,0|(S=0|B(0|(y=0|L(0,0|i[h>>2],32)),0|l,0|d,0|E)),0|l),S=l,_=0|L(0,0|i[c>>2],32),m=l,m=0|G(0|E,0|S,0|(y=0|B(0|(d=0|L(0,0|i[s>>2],32)),0|l,0|_,0|m)),0|l),y=l,S=0|L(0,0|i[t>>2],32),E=l,E=0|G(0|m,0|y,0|(v=0|B(0|(d=0|L(0,0|i[(_=r+48|0)>>2],32)),0|l,0|S,0|E)),0|l),v=l,m=0|L(0,0|i[(y=t+48|0)>>2],32),S=l,S=0|G(0|E,0|v,0|(T=0|B(0|(d=0|L(0,0|i[r>>2],32)),0|l,0|m,0|S)),0|l),i[(T=e+48|0)>>2]=S,i[T+4>>2]=l,T=0|L(0,0|i[o>>2],32),S=l,E=0|B(0|(v=0|L(0,0|i[h>>2],32)),0|l,0|T,0|S),S=l,T=0|L(0,0|i[c>>2],32),v=l,v=0|G(0|(d=0|B(0|(m=0|L(0,0|i[f>>2],32)),0|l,0|T,0|v)),0|l,0|E,0|S),S=l,E=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|v,0|S,0|(m=0|B(0|(T=0|L(0,0|i[u>>2],32)),0|l,0|E,0|d)),0|l),m=l,S=0|L(0,0|i[g>>2],32),v=l,v=0|G(0|d,0|m,0|(T=0|B(0|(E=0|L(0,0|i[s>>2],32)),0|l,0|S,0|v)),0|l),T=l,m=0|L(0,0|i[a>>2],32),d=l,d=0|G(0|v,0|T,0|(E=0|B(0|(S=0|L(0,0|i[_>>2],32)),0|l,0|m,0|d)),0|l),E=l,T=0|L(0,0|i[y>>2],32),v=l,v=0|G(0|d,0|E,0|(S=0|B(0|(m=0|L(0,0|i[n>>2],32)),0|l,0|T,0|v)),0|l),S=l,E=0|L(0,0|i[t>>2],32),d=l,d=0|G(0|v,0|S,0|(A=0|B(0|(m=0|L(0,0|i[(T=r+56|0)>>2],32)),0|l,0|E,0|d)),0|l),A=l,v=0|L(0,0|i[(S=t+56|0)>>2],32),E=l,E=0|G(0|d,0|A,0|(C=0|B(0|(m=0|L(0,0|i[r>>2],32)),0|l,0|v,0|E)),0|l),i[(C=e+56|0)>>2]=E,i[C+4>>2]=l,C=0|L(0,0|i[c>>2],32),E=l,d=0|B(0|(A=0|L(0,0|i[h>>2],32)),0|l,0|C,0|E),E=l,C=0|L(0,0|i[o>>2],32),A=l,m=0|B(0|(v=0|L(0,0|i[u>>2],32)),0|l,0|C,0|A),A=l,C=0|L(0,0|i[g>>2],32),v=l,v=0|G(0|(P=0|B(0|(b=0|L(0,0|i[f>>2],32)),0|l,0|C,0|v)),0|l,0|m,0|A),A=l,m=0|L(0,0|i[a>>2],32),P=l,P=0|G(0|v,0|A,0|(b=0|B(0|(C=0|L(0,0|i[T>>2],32)),0|l,0|m,0|P)),0|l),b=l,A=0|L(0,0|i[S>>2],32),v=l,v=0|G(0|P,0|b,0|(C=0|B(0|(m=0|L(0,0|i[n>>2],32)),0|l,0|A,0|v)),0|l),v=0|G(0|(C=0|x(0|v,0|l,1)),0|l,0|d,0|E),E=l,d=0|L(0,0|i[p>>2],32),C=l,C=0|G(0|v,0|E,0|(P=0|B(0|(b=0|L(0,0|i[_>>2],32)),0|l,0|d,0|C)),0|l),P=l,E=0|L(0,0|i[y>>2],32),v=l,v=0|G(0|C,0|P,0|(b=0|B(0|(d=0|L(0,0|i[s>>2],32)),0|l,0|E,0|v)),0|l),b=l,P=0|L(0,0|i[t>>2],32),C=l,C=0|G(0|v,0|b,0|(A=0|B(0|(d=0|L(0,0|i[(E=r+64|0)>>2],32)),0|l,0|P,0|C)),0|l),A=l,v=0|L(0,0|i[(b=t+64|0)>>2],32),P=l,P=0|G(0|C,0|A,0|(m=0|B(0|(d=0|L(0,0|i[r>>2],32)),0|l,0|v,0|P)),0|l),i[(m=e+64|0)>>2]=P,i[m+4>>2]=l,m=0|L(0,0|i[c>>2],32),P=l,C=0|B(0|(A=0|L(0,0|i[u>>2],32)),0|l,0|m,0|P),P=l,m=0|L(0,0|i[g>>2],32),A=l,A=0|G(0|(d=0|B(0|(v=0|L(0,0|i[h>>2],32)),0|l,0|m,0|A)),0|l,0|C,0|P),P=l,C=0|L(0,0|i[o>>2],32),d=l,d=0|G(0|A,0|P,0|(v=0|B(0|(m=0|L(0,0|i[_>>2],32)),0|l,0|C,0|d)),0|l),v=l,P=0|L(0,0|i[y>>2],32),A=l,A=0|G(0|d,0|v,0|(m=0|B(0|(C=0|L(0,0|i[f>>2],32)),0|l,0|P,0|A)),0|l),m=l,v=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|A,0|m,0|(C=0|B(0|(P=0|L(0,0|i[T>>2],32)),0|l,0|v,0|d)),0|l),C=l,m=0|L(0,0|i[S>>2],32),A=l,A=0|G(0|d,0|C,0|(P=0|B(0|(v=0|L(0,0|i[s>>2],32)),0|l,0|m,0|A)),0|l),P=l,C=0|L(0,0|i[a>>2],32),d=l,d=0|G(0|A,0|P,0|(v=0|B(0|(m=0|L(0,0|i[E>>2],32)),0|l,0|C,0|d)),0|l),v=l,P=0|L(0,0|i[b>>2],32),A=l,A=0|G(0|d,0|v,0|(m=0|B(0|(C=0|L(0,0|i[n>>2],32)),0|l,0|P,0|A)),0|l),m=l,v=0|L(0,0|i[t>>2],32),d=l,d=0|G(0|A,0|m,0|(M=0|B(0|(C=0|L(0,0|i[(P=r+72|0)>>2],32)),0|l,0|v,0|d)),0|l),M=l,t=0|L(0,0|i[(m=t+72|0)>>2],32),A=l,A=0|G(0|d,0|M,0|(r=0|B(0|(v=0|L(0,0|i[r>>2],32)),0|l,0|t,0|A)),0|l),i[(r=e+72|0)>>2]=A,i[r+4>>2]=l,r=0|L(0,0|i[g>>2],32),A=l,d=0|B(0|(M=0|L(0,0|i[u>>2],32)),0|l,0|r,0|A),A=l,r=0|L(0,0|i[o>>2],32),M=l,M=0|G(0|(v=0|B(0|(t=0|L(0,0|i[T>>2],32)),0|l,0|r,0|M)),0|l,0|d,0|A),A=l,d=0|L(0,0|i[S>>2],32),v=l,v=0|G(0|M,0|A,0|(t=0|B(0|(r=0|L(0,0|i[f>>2],32)),0|l,0|d,0|v)),0|l),t=l,A=0|L(0,0|i[a>>2],32),a=l,a=0|G(0|v,0|t,0|(d=0|B(0|(M=0|L(0,0|i[P>>2],32)),0|l,0|A,0|a)),0|l),d=l,t=0|L(0,0|i[m>>2],32),v=l,n=0|x(0|(v=0|G(0|a,0|d,0|(n=0|B(0|(A=0|L(0,0|i[n>>2],32)),0|l,0|t,0|v)),0|l)),0|l,1),v=l,d=0|L(0,0|i[c>>2],32),a=l,a=0|G(0|n,0|v,0|(A=0|B(0|(t=0|L(0,0|i[_>>2],32)),0|l,0|d,0|a)),0|l),A=l,v=0|L(0,0|i[y>>2],32),n=l,n=0|G(0|a,0|A,0|(t=0|B(0|(d=0|L(0,0|i[h>>2],32)),0|l,0|v,0|n)),0|l),t=l,A=0|L(0,0|i[p>>2],32),a=l,a=0|G(0|n,0|t,0|(d=0|B(0|(v=0|L(0,0|i[E>>2],32)),0|l,0|A,0|a)),0|l),d=l,t=0|L(0,0|i[b>>2],32),n=l,n=0|G(0|a,0|d,0|(v=0|B(0|(A=0|L(0,0|i[s>>2],32)),0|l,0|t,0|n)),0|l),i[(v=e+80|0)>>2]=n,i[v+4>>2]=l,v=0|L(0,0|i[g>>2],32),n=l,a=0|B(0|(d=0|L(0,0|i[_>>2],32)),0|l,0|v,0|n),n=l,v=0|L(0,0|i[y>>2],32),d=l,d=0|G(0|(A=0|B(0|(t=0|L(0,0|i[u>>2],32)),0|l,0|v,0|d)),0|l,0|a,0|n),n=l,a=0|L(0,0|i[c>>2],32),A=l,A=0|G(0|d,0|n,0|(t=0|B(0|(v=0|L(0,0|i[T>>2],32)),0|l,0|a,0|A)),0|l),t=l,n=0|L(0,0|i[S>>2],32),d=l,d=0|G(0|A,0|t,0|(v=0|B(0|(a=0|L(0,0|i[h>>2],32)),0|l,0|n,0|d)),0|l),v=l,t=0|L(0,0|i[o>>2],32),A=l,A=0|G(0|d,0|v,0|(a=0|B(0|(n=0|L(0,0|i[E>>2],32)),0|l,0|t,0|A)),0|l),a=l,v=0|L(0,0|i[b>>2],32),d=l,d=0|G(0|A,0|a,0|(n=0|B(0|(t=0|L(0,0|i[f>>2],32)),0|l,0|v,0|d)),0|l),n=l,a=0|L(0,0|i[p>>2],32),p=l,p=0|G(0|d,0|n,0|(v=0|B(0|(A=0|L(0,0|i[P>>2],32)),0|l,0|a,0|p)),0|l),v=l,n=0|L(0,0|i[m>>2],32),d=l,d=0|G(0|p,0|v,0|(s=0|B(0|(a=0|L(0,0|i[s>>2],32)),0|l,0|n,0|d)),0|l),i[(s=e+88|0)>>2]=d,i[s+4>>2]=l,s=0|L(0,0|i[y>>2],32),d=l,p=0|B(0|(v=0|L(0,0|i[_>>2],32)),0|l,0|s,0|d),d=l,s=0|L(0,0|i[g>>2],32),v=l,a=0|B(0|(n=0|L(0,0|i[T>>2],32)),0|l,0|s,0|v),v=l,s=0|L(0,0|i[S>>2],32),n=l,n=0|G(0|(t=0|B(0|(A=0|L(0,0|i[u>>2],32)),0|l,0|s,0|n)),0|l,0|a,0|v),v=l,a=0|L(0,0|i[o>>2],32),o=l,o=0|G(0|n,0|v,0|(s=0|B(0|(t=0|L(0,0|i[P>>2],32)),0|l,0|a,0|o)),0|l),s=l,v=0|L(0,0|i[m>>2],32),n=l,n=0|G(0|o,0|s,0|(f=0|B(0|(a=0|L(0,0|i[f>>2],32)),0|l,0|v,0|n)),0|l),n=0|G(0|(f=0|x(0|n,0|l,1)),0|l,0|p,0|d),d=l,p=0|L(0,0|i[c>>2],32),f=l,f=0|G(0|n,0|d,0|(o=0|B(0|(s=0|L(0,0|i[E>>2],32)),0|l,0|p,0|f)),0|l),o=l,d=0|L(0,0|i[b>>2],32),n=l,n=0|G(0|f,0|o,0|(s=0|B(0|(p=0|L(0,0|i[h>>2],32)),0|l,0|d,0|n)),0|l),i[(s=e+96|0)>>2]=n,i[s+4>>2]=l,s=0|L(0,0|i[y>>2],32),n=l,f=0|B(0|(o=0|L(0,0|i[T>>2],32)),0|l,0|s,0|n),n=l,s=0|L(0,0|i[S>>2],32),o=l,o=0|G(0|(p=0|B(0|(d=0|L(0,0|i[_>>2],32)),0|l,0|s,0|o)),0|l,0|f,0|n),n=l,f=0|L(0,0|i[g>>2],32),p=l,p=0|G(0|o,0|n,0|(d=0|B(0|(s=0|L(0,0|i[E>>2],32)),0|l,0|f,0|p)),0|l),d=l,n=0|L(0,0|i[b>>2],32),o=l,o=0|G(0|p,0|d,0|(s=0|B(0|(f=0|L(0,0|i[u>>2],32)),0|l,0|n,0|o)),0|l),s=l,d=0|L(0,0|i[c>>2],32),c=l,c=0|G(0|o,0|s,0|(n=0|B(0|(p=0|L(0,0|i[P>>2],32)),0|l,0|d,0|c)),0|l),n=l,s=0|L(0,0|i[m>>2],32),o=l,o=0|G(0|c,0|n,0|(h=0|B(0|(d=0|L(0,0|i[h>>2],32)),0|l,0|s,0|o)),0|l),i[(h=e+104|0)>>2]=o,i[h+4>>2]=l,h=0|L(0,0|i[S>>2],32),o=l,c=0|B(0|(n=0|L(0,0|i[T>>2],32)),0|l,0|h,0|o),o=l,h=0|L(0,0|i[g>>2],32),g=l,g=0|G(0|(s=0|B(0|(n=0|L(0,0|i[P>>2],32)),0|l,0|h,0|g)),0|l,0|c,0|o),o=l,c=0|L(0,0|i[m>>2],32),s=l,u=0|x(0|(s=0|G(0|g,0|o,0|(u=0|B(0|(h=0|L(0,0|i[u>>2],32)),0|l,0|c,0|s)),0|l)),0|l,1),s=l,o=0|L(0,0|i[y>>2],32),g=l,g=0|G(0|u,0|s,0|(h=0|B(0|(c=0|L(0,0|i[E>>2],32)),0|l,0|o,0|g)),0|l),h=l,s=0|L(0,0|i[b>>2],32),u=l,u=0|G(0|g,0|h,0|(c=0|B(0|(o=0|L(0,0|i[_>>2],32)),0|l,0|s,0|u)),0|l),i[(c=e+112|0)>>2]=u,i[c+4>>2]=l,c=0|L(0,0|i[S>>2],32),u=l,g=0|B(0|(h=0|L(0,0|i[E>>2],32)),0|l,0|c,0|u),u=l,c=0|L(0,0|i[b>>2],32),h=l,h=0|G(0|(o=0|B(0|(s=0|L(0,0|i[T>>2],32)),0|l,0|c,0|h)),0|l,0|g,0|u),u=l,g=0|L(0,0|i[y>>2],32),y=l,y=0|G(0|h,0|u,0|(c=0|B(0|(o=0|L(0,0|i[P>>2],32)),0|l,0|g,0|y)),0|l),c=l,u=0|L(0,0|i[m>>2],32),h=l,h=0|G(0|y,0|c,0|(_=0|B(0|(g=0|L(0,0|i[_>>2],32)),0|l,0|u,0|h)),0|l),i[(_=e+120|0)>>2]=h,i[_+4>>2]=l,_=0|L(0,0|i[b>>2],32),h=l,y=0|B(0|(c=0|L(0,0|i[E>>2],32)),0|l,0|_,0|h),h=l,_=0|L(0,0|i[S>>2],32),S=l,u=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|_,0|S),S=l,_=0|L(0,0|i[m>>2],32),c=l,c=0|G(0|(T=0|B(0|(g=0|L(0,0|i[T>>2],32)),0|l,0|_,0|c)),0|l,0|u,0|S),c=0|G(0|(S=0|x(0|c,0|l,1)),0|l,0|y,0|h),i[(h=e+128|0)>>2]=c,i[h+4>>2]=l,h=0|L(0,0|i[b>>2],32),b=l,y=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|h,0|b),b=l,h=0|L(0,0|i[m>>2],32),c=l,c=0|G(0|(E=0|B(0|(S=0|L(0,0|i[E>>2],32)),0|l,0|h,0|c)),0|l,0|y,0|b),i[(b=e+136|0)>>2]=c,i[b+4>>2]=l,b=0|L(0,0|i[m>>2],31),m=l,P=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|b,0|m),i[(m=e+144|0)>>2]=P,i[m+4>>2]=l}function M(e,t){e|=0;var r,n,a,o=0,c=0,d=0,u=0,p=0,h=0,f=0,_=0,m=0,g=0,y=0,E=0,S=0,v=0,T=0,A=0,C=0,b=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,N=0,U=0,F=0,K=0,Y=0,j=0,W=0,H=0,V=0,$=0,z=0,q=0;r=s,s=s+160|0,o=r,u=0|B(0|(n=0|L(0,0|(c=0|i[(t|=0)>>2]),32)),0|(d=l),0|n,0|d),i[(p=o)>>2]=u,i[p+4>>2]=l,p=0|L(0,0|c,31),c=l,m=0|B(0|(f=0|L(0,0|(h=0|i[(u=t+8|0)>>2]),32)),0|(_=l),0|p,0|c),i[(g=a=o+8|0)>>2]=m,i[g+4>>2]=l,g=0|B(0|f,0|_,0|f,0|_),m=l,m=0|x(0|(T=0|G(0|(v=0|B(0|(E=0|L(0,0|i[(y=t+16|0)>>2],32)),0|(S=l),0|n,0|d)),0|l,0|g,0|m)),0|l,1),i[(g=T=o+16|0)>>2]=m,i[g+4>>2]=l,g=0|B(0|E,0|S,0|f,0|_),m=l,m=0|x(0|(P=0|G(0|(b=0|B(0|(A=0|L(0,0|i[(v=t+24|0)>>2],32)),0|(C=l),0|n,0|d)),0|l,0|g,0|m)),0|l,1),i[(g=P=o+24|0)>>2]=m,i[g+4>>2]=l,g=0|B(0|E,0|S,0|E,0|S),m=l,b=0|G(0|(M=0|B(0|A,0|C,0|(b=0|L(0,0|h,30)),0|l)),0|l,0|g,0|m),c=0|G(0|b,0|(m=l),0|(I=0|B(0|(M=0|L(0,0|i[(g=t+32|0)>>2],32)),0|(O=l),0|p,0|c)),0|l),i[(m=I=o+32|0)>>2]=c,i[m+4>>2]=l,m=0|B(0|A,0|C,0|E,0|S),c=l,p=0|G(0|(b=0|B(0|M,0|O,0|f,0|_)),0|l,0|m,0|c),R=0|x(0|(D=0|G(0|p,0|(c=l),0|(R=0|B(0|(b=0|L(0,0|i[(m=t+40|0)>>2],32)),0|(w=l),0|n,0|d)),0|l)),0|l,1),i[(c=D=o+40|0)>>2]=R,i[c+4>>2]=l,c=0|B(0|A,0|C,0|A,0|C),R=l,N=0|G(0|(p=0|B(0|M,0|O,0|E,0|S)),0|l,0|c,0|R),K=0|G(0|N,0|(R=l),0|(F=0|B(0|(p=0|L(0,0|i[(c=t+48|0)>>2],32)),0|(U=l),0|n,0|d)),0|l),h=0|x(0|(R=0|G(0|K,0|(F=l),0|(h=0|B(0|b,0|w,0|(R=0|L(0,0|h,31)),0|l)),0|l)),0|l,1),i[(F=R=o+48|0)>>2]=h,i[F+4>>2]=l,F=0|B(0|M,0|O,0|A,0|C),h=l,N=0|G(0|(K=0|B(0|b,0|w,0|E,0|S)),0|l,0|F,0|h),K=0|G(0|N,0|(h=l),0|(F=0|B(0|p,0|U,0|f,0|_)),0|l),j=0|x(0|(W=0|G(0|K,0|(F=l),0|(j=0|B(0|(N=0|L(0,0|i[(h=t+56|0)>>2],32)),0|(Y=l),0|n,0|d)),0|l)),0|l,1),i[(F=W=o+56|0)>>2]=j,i[F+4>>2]=l,F=0|B(0|M,0|O,0|M,0|O),j=l,K=0|B(0|p,0|U,0|E,0|S),H=l,d=0|G(0|(q=0|B(0|($=0|L(0,0|i[(V=t+64|0)>>2],32)),0|(z=l),0|n,0|d)),0|l,0|K,0|H),H=l,K=0|B(0|N,0|Y,0|f,0|_),_=l,q=0|G(0|(f=0|B(0|b,0|w,0|A,0|C)),0|l,0|K,0|_),q=0|G(0|d,0|H,0|(_=0|x(0|q,0|l,1)),0|l),q=0|G(0|(_=0|x(0|q,0|l,1)),0|l,0|F,0|j),i[(F=j=o+64|0)>>2]=q,i[F+4>>2]=l,F=0|B(0|b,0|w,0|M,0|O),q=l,C=0|G(0|(_=0|B(0|p,0|U,0|A,0|C)),0|l,0|F,0|q),S=0|G(0|C,0|(q=l),0|(F=0|B(0|N,0|Y,0|E,0|S)),0|l),E=0|G(0|S,0|(F=l),0|(C=0|B(0|$,0|z,0|(q=0|L(0,0|i[u>>2],32)),0|(u=l))),0|l),C=l,F=0|L(0,0|i[t>>2],32),S=l,H=0|x(0|(S=0|G(0|E,0|C,0|(H=0|B(0|(t=0|L(0,0|(_=0|i[t+72>>2]),32)),0|(A=l),0|F,0|S)),0|l)),0|l,1),i[(S=o+72|0)>>2]=H,i[S+4>>2]=l,S=0|B(0|b,0|w,0|b,0|w),H=l,O=0|G(0|(C=0|B(0|p,0|U,0|M,0|O)),0|l,0|S,0|H),M=0|G(0|O,0|(H=l),0|(C=0|B(0|$,0|z,0|(S=0|L(0,0|i[y>>2],32)),0|(y=l))),0|l),C=l,O=0|B(0|N,0|Y,0|(H=0|L(0,0|i[v>>2],32)),0|(v=l)),E=l,E=0|x(0|(u=0|G(0|(F=0|B(0|t,0|A,0|q,0|u)),0|l,0|O,0|E)),0|l,1),E=0|x(0|(u=0|G(0|M,0|C,0|E,0|l)),0|l,1),i[(C=u=o+80|0)>>2]=E,i[C+4>>2]=l,C=0|B(0|p,0|U,0|b,0|w),w=l,M=0|G(0|(E=0|B(0|N,0|Y,0|(b=0|L(0,0|i[g>>2],32)),0|(g=l))),0|l,0|C,0|w),E=0|G(0|M,0|(w=l),0|(C=0|B(0|$,0|z,0|H,0|v)),0|l),C=0|x(0|(y=0|G(0|E,0|(C=l),0|(w=0|B(0|t,0|A,0|S,0|y)),0|l)),0|(w=l),1),E=l,i[(S=o+88|0)>>2]=C,i[S+4>>2]=E,S=0|B(0|p,0|U,0|p,0|U),U=l,p=0|B(0|$,0|z,0|b,0|g),M=l,q=0|B(0|N,0|Y,0|(m=0|L(0,0|(O=0|i[m>>2]),32)),0|(F=l)),d=l,v=0|G(0|(K=0|B(0|t,0|A,0|H,0|v)),0|l,0|q,0|d),v=0|G(0|(d=0|x(0|v,0|l,1)),0|l,0|p,0|M),v=0|G(0|(M=0|x(0|v,0|l,1)),0|l,0|S,0|U),U=l,i[(S=o+96|0)>>2]=v,i[S+4>>2]=U,M=0|B(0|N,0|Y,0|(S=0|L(0,0|i[c>>2],32)),0|(c=l)),Y=l,F=0|G(0|(N=0|B(0|$,0|z,0|m,0|F)),0|l,0|M,0|Y),Y=0|x(0|(g=0|G(0|F,0|(Y=l),0|(M=0|B(0|t,0|A,0|b,0|g)),0|l)),0|(M=l),1),F=l,i[(b=o+104|0)>>2]=Y,i[b+4>>2]=F,m=0|B(0|(h=0|L(0,0|(b=0|i[h>>2]),32)),0|(N=l),0|h,0|N),p=l,z=0|G(0|(d=0|B(0|$,0|z,0|S,0|c)),0|l,0|m,0|p),p=0|x(0|(m=0|G(0|z,0|(p=l),0|(O=0|B(0|t,0|A,0|(m=0|L(0,0|O,31)),0|l)),0|l)),0|(O=l),1),z=l,i[(d=o+112|0)>>2]=p,i[d+4>>2]=z,q=0|B(0|(V=0|L(0,0|(d=0|i[V>>2]),32)),0|($=l),0|h,0|N),N=l,q=0|x(0|(c=0|G(0|(h=0|B(0|t,0|A,0|S,0|c)),0|l,0|q,0|N)),0|(N=l),1),h=l,i[(S=o+120|0)>>2]=q,i[S+4>>2]=h,S=0|B(0|V,0|$,0|V,0|$),$=l,V=0|G(0|(b=0|B(0|t,0|A,0|(V=0|L(0,0|b,30)),0|l)),0|l,0|S,0|$),$=l,i[(S=o+128|0)>>2]=V,i[S+4>>2]=$,d=0|B(0|t,0|A,0|(S=0|L(0,0|d,31)),0|l),S=l,i[(b=o+136|0)>>2]=d,i[b+4>>2]=S,_=0|B(0|(b=0|L(0,0|_,31)),0|l,0|t,0|A),A=l,i[(t=o+144|0)>>2]=_,i[t+4>>2]=A,b=0|i[(t=j)>>2],K=0|i[t+4>>2],t=0|B(0|_,0|A,18,0),H=l,f=0|G(0|_,0|A,0|b,0|K),K=0|G(0|f,0|l,0|t,0|H),i[(H=j)>>2]=K,i[H+4>>2]=l,K=0|i[(H=W)>>2],j=0|i[H+4>>2],H=0|B(0|d,0|S,18,0),t=l,f=0|G(0|K,0|j,0|d,0|S),S=0|G(0|f,0|l,0|H,0|t),i[(t=W)>>2]=S,i[t+4>>2]=l,S=0|i[(t=R)>>2],W=0|i[t+4>>2],t=0|B(0|V,0|$,18,0),H=l,f=0|G(0|S,0|W,0|V,0|$),$=0|G(0|f,0|l,0|t,0|H),i[(H=R)>>2]=$,i[H+4>>2]=l,$=0|i[(H=D)>>2],R=0|i[H+4>>2],H=0|B(0|c,0|N,36,0),N=l,c=0|G(0|$,0|R,0|q,0|h),h=0|G(0|c,0|l,0|H,0|N),i[(N=D)>>2]=h,i[N+4>>2]=l,h=0|i[(N=I)>>2],D=0|i[N+4>>2],N=0|B(0|m,0|O,36,0),O=l,m=0|G(0|h,0|D,0|p,0|z),z=0|G(0|m,0|l,0|N,0|O),i[(O=I)>>2]=z,i[O+4>>2]=l,z=0|i[(O=P)>>2],I=0|i[O+4>>2],O=0|B(0|g,0|M,36,0),M=l,g=0|G(0|z,0|I,0|Y,0|F),F=0|G(0|g,0|l,0|O,0|M),i[(M=P)>>2]=F,i[M+4>>2]=l,F=0|i[(M=T)>>2],P=0|i[M+4>>2],M=0|B(0|v,0|U,18,0),O=l,g=0|G(0|F,0|P,0|v,0|U),U=0|G(0|g,0|l,0|M,0|O),i[(O=T)>>2]=U,i[O+4>>2]=l,U=0|i[(O=a)>>2],T=0|i[O+4>>2],O=0|B(0|y,0|w,36,0),w=l,y=0|G(0|U,0|T,0|C,0|E),E=0|G(0|y,0|l,0|O,0|w),i[(w=a)>>2]=E,i[w+4>>2]=l,E=0|i[(w=u)>>2],O=0|i[w+4>>2],y=0|i[(w=o)>>2],C=0|i[w+4>>2],w=0|B(0|E,0|O,18,0),T=l,U=0|G(0|y,0|C,0|E,0|O),O=0|G(0|U,0|l,0|w,0|T),T=l,i[(w=o)>>2]=O,i[w+4>>2]=T,i[(w=u)>>2]=0,i[w+4>>2]=0,w=T,T=O,O=0;do{y=0|k(0|T,0|w,0|(C=0|x(0|(E=0|L(0|(U=0|G(w>>31>>>6|0,0,0|T,0|w)),0|l,26)),0|(U=l),26)),0|l),i[(C=o+(O<<3)|0)>>2]=y,i[C+4>>2]=l,v=0|k(0|(M=0|G(0|E,0|U,0|i[(y=C=o+((1|O)<<3)|0)>>2],0|i[y+4>>2])),0|(y=l),0|(g=0|x(0|(E=0|L(0|(U=0|G(y>>31>>>7|0,0,0|M,0|y)),0|l,25)),0|(U=l),25)),0|l),i[(g=C)>>2]=v,i[g+4>>2]=l,T=0|G(0|E,0|U,0|i[(v=g=o+((O=O+2|0)<<3)|0)>>2],0|i[v+4>>2]),w=l,i[(v=g)>>2]=T,i[v+4>>2]=w}while(O>>>0<10);w=0|i[(O=u)>>2],T=0|i[O+4>>2],v=0|i[(O=o)>>2],g=0|i[O+4>>2],O=0|B(0|w,0|T,18,0),U=l,E=0|G(0|v,0|g,0|w,0|T),T=0|G(0|E,0|l,0|O,0|U),U=l,i[(O=u)>>2]=0,i[O+4>>2]=0,w=0|k(0|T,0|U,0|(E=0|x(0|(u=0|L(0|(O=0|G(U>>31>>>6|0,0,0|T,0|U)),0|l,26)),0|(O=l),26)),0|l),i[(E=o)>>2]=w,i[E+4>>2]=l,w=0|G(0|u,0|O,0|i[(E=a)>>2],0|i[E+4>>2]),i[(E=a)>>2]=w,i[E+4>>2]=l,E=e,e=o,o=E+80|0;do{i[E>>2]=i[e>>2],E=E+4|0,e=e+4|0}while((0|E)<(0|o));s=r}function O(){return 0|(0|i[2]?0|i[60+(0|h())>>2]:56)}function I(e){var t=0;return(e|=0)>>>0>4294963200?(i[(0|O())>>2]=0-e,t=-1):t=e,0|t}function w(e){return 0,0}function R(e){0}function D(e,t,r){t|=0,r|=0;var n,a,o,l,c,d=0,p=0,h=0,f=0,_=0,m=0,g=0,y=0,E=0,S=0,v=0,A=0,b=0,P=0,M=0,O=0;for(n=s,s=s+48|0,a=n+16|0,o=n,d=n+32|0,p=0|i[(l=(e|=0)+28|0)>>2],i[d>>2]=p,h=(0|i[(c=e+20|0)>>2])-p|0,i[d+4>>2]=h,i[d+8>>2]=t,i[d+12>>2]=r,t=e+60|0,p=e+44|0,f=d,d=2,_=h+r|0;;){if(0|i[2]?(T(1,0|e),i[o>>2]=i[t>>2],i[o+4>>2]=f,i[o+8>>2]=d,h=0|I(0|C(146,0|o)),u(0),m=h):(i[a>>2]=i[t>>2],i[a+4>>2]=f,i[a+8>>2]=d,m=0|I(0|C(146,0|a))),(0|_)==(0|m)){g=6;break}if((0|m)<0){y=f,E=d,g=8;break}h=_-m|0,m>>>0<=(S=0|i[f+4>>2])>>>0?2==(0|d)?(i[l>>2]=(0|i[l>>2])+m,v=S,A=m,b=f,P=2):(v=S,A=m,b=f,P=d):(M=0|i[p>>2],i[l>>2]=M,i[c>>2]=M,v=0|i[f+12>>2],A=m-S|0,b=f+8|0,P=d+-1|0),i[b>>2]=(0|i[b>>2])+A,i[b+4>>2]=v-A,f=b,d=P,_=h}return 6==(0|g)?(_=0|i[p>>2],i[e+16>>2]=_+(0|i[e+48>>2]),p=_,i[l>>2]=p,i[c>>2]=p,O=r):8==(0|g)&&(i[e+16>>2]=0,i[l>>2]=0,i[c>>2]=0,i[e>>2]=32|i[e>>2],O=2==(0|E)?0:r-(0|i[y+4>>2])|0),s=n,0|O}function N(e){var t,r,n=0,a=0,s=0,o=0,l=0;return r=(e|=0)+28|0,(0|i[(t=e+20|0)>>2])>>>0>(0|i[r>>2])>>>0&&(Y[3&i[e+36>>2]](e,0,0),0==(0|i[t>>2]))?n=-1:((s=0|i[(a=e+4|0)>>2])>>>0<(l=0|i[(o=e+8|0)>>2])>>>0&&Y[3&i[e+40>>2]](e,s-l|0,1),i[e+16>>2]=0,i[r>>2]=0,i[t>>2]=0,i[o>>2]=0,i[a>>2]=0,n=0),0|n}function L(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t>>r,e>>>r|(t&(1<<r)-1)<<32-r):(l=(0|t)<0?-1:0,t>>r-32|0)}function k(e,t,r,n){return(t|=0)-(n|=0)>>>0,0|(l=t-n-((r|=0)>>>0>(e|=0)>>>0|0)>>>0,e-r>>>0|0)}function G(e,t,r,n){var i;return 0|(l=(t|=0)+(n|=0)+((i=(e|=0)+(r|=0)>>>0)>>>0<e>>>0|0)>>>0,0|i)}function U(e,t,r){t|=0;var a,s=0,o=0,l=0;if(a=(e|=0)+(r|=0)|0,(0|r)>=20){if(o=(t&=255)|t<<8|t<<16|t<<24,l=-4&a,s=3&e)for(s=e+4-s|0;(0|e)<(0|s);)n[e>>0]=t,e=e+1|0;for(;(0|e)<(0|l);)i[e>>2]=o,e=e+4|0}for(;(0|e)<(0|a);)n[e>>0]=t,e=e+1|0;return e-r|0}function F(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t>>>r,e>>>r|(t&(1<<r)-1)<<32-r):(l=0,t>>>r-32|0)}function x(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t<<r|(e&(1<<r)-1<<32-r)>>>32-r,e<<r):(l=e<<r-32,0)}function B(e,t,r,n){t|=0,n|=0;var i,a;return r=0|function(e,t){var r,n,i,a=0;return e=((n=0|c(a=65535&(t|=0),r=65535&(e|=0)))>>>16)+(0|c(a,i=e>>>16))|0,t=0|c(a=t>>>16,r),0|(l=(e>>>16)+(0|c(a,i))+(((65535&e)+t|0)>>>16)|0,e+t<<16|65535&n|0)}(i=e|=0,e=r|=0),a=l,0|(l=(0|c(t,e))+(0|c(n,i))+a|0&a,0|r)}var K=[function(e){return 0,d(0),0},function(e){var t,r;return e|=0,t=s,s=s+16|0,i[(r=t)>>2]=i[e+60>>2],e=0|I(0|f(6,0|r)),s=t,0|e}],Y=[function(e,t,r){return 0,0,0,d(1),0},function(e,t,r){t|=0,r|=0;var a,o=0;return a=s,s=s+80|0,o=a,i[(e|=0)+36>>2]=3,0==(64&i[e>>2]|0)&&(i[o>>2]=i[e+60>>2],i[o+4>>2]=21505,i[o+8>>2]=a+12,0!=(0|E(54,0|o)))&&(n[e+75>>0]=-1),o=0|D(e,t,r),s=a,0|o},function(e,t,r){e|=0,t|=0,r|=0;var n,a,o,l=0;return n=s,s=s+32|0,o=n+20|0,i[(a=n)>>2]=i[e+60>>2],i[a+4>>2]=0,i[a+8>>2]=t,i[a+12>>2]=o,i[a+16>>2]=r,(0|I(0|v(140,0|a)))<0?(i[o>>2]=-1,l=-1):l=0|i[o>>2],s=n,0|l},D],j=[function(e){d(2)},function(e){0|i[(e|=0)+68>>2]||R()}];return{_curve25519_donna:function(e,t,r){e|=0,r|=0;var o,d,u,p,h,f,_,m,g,y,E,S,v,T,A,C,O,I,w,R,D,N,K,Y,j,W,H,V,$,z,q,J,Q,X,Z,ee,te,re,ne,ie,ae,se,oe,le,ce,de,ue,pe,he,fe,_e,me,ge,ye,Ee,Se,ve,Te,Ae,Ce=0,be=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Ne=0,Le=0,ke=0,Ge=0,Ue=0,Fe=0,xe=0,Be=0,Ke=0,Ye=0,je=0,We=0,He=0,Ve=0,$e=0,ze=0,qe=0,Je=0,Qe=0,Xe=0,Ze=0,et=0,tt=0,rt=0,nt=0,it=0,at=0,st=0,ot=0,lt=0,ct=0,dt=0,ut=0,pt=0,ht=0,ft=0,_t=0,mt=0,gt=0,yt=0,Et=0,St=0,vt=0,Tt=0,At=0,Ct=0,bt=0,Pt=0,Mt=0,Ot=0,It=0,wt=0,Rt=0,Dt=0,Nt=0,Lt=0,kt=0,Gt=0,Ut=0,Ft=0,xt=0,Bt=0,Kt=0,Yt=0,jt=0,Wt=0,Ht=0,Vt=0,$t=0,zt=0,qt=0,Jt=0,Qt=0,Xt=0,Zt=0,er=0,tr=0,rr=0,nr=0,ir=0,ar=0,sr=0,or=0,lr=0,cr=0,dr=0,ur=0,pr=0,hr=0,fr=0,_r=0,mr=0,gr=0,yr=0,Er=0,Sr=0,vr=0,Tr=0,Ar=0,Cr=0,br=0,Pr=0,Mr=0,Or=0,Ir=0,wr=0,Rr=0,Dr=0,Nr=0;o=s,s=s+2640|0,Ce=o+2456|0,be=o+2304|0,Pe=o+2152|0,Me=o+2e3|0,Oe=o+1848|0,Ie=o+1696|0,we=o+1544|0,Re=o+1392|0,De=o+1240|0,Ne=o+1088|0,Le=o+936|0,ke=o+784|0,Ge=o+632|0,Ue=o+480|0,Fe=o+328|0,d=o+248|0,xe=o+168|0,Be=o+80|0,Ke=o,je=t|=0,t=(Ye=u=o+2608|0)+32|0;do{n[Ye>>0]=0|n[je>>0],Ye=Ye+1|0,je=je+1|0}while((0|Ye)<(0|t));n[u>>0]=248&(0|a[u>>0]),n[(We=u+31|0)>>0]=63&(0|a[We>>0])|64,We=0|a[r>>0],He=0|x(0|a[r+1>>0],0,8),Ve=l,$e=0|x(0|a[r+2>>0],0,16),ze=Ve|l,qe=0|x(0|(Ve=0|a[r+3>>0]),0,24),i[(Je=d)>>2]=He|We|$e|50331648&qe,i[Je+4>>2]=ze,ze=0|x(0|a[r+4>>0],0,8),Je=l,qe=0|x(0|a[r+5>>0],0,16),$e=Je|l,He=0|F(ze|Ve|qe|(We=0|x(0|(Je=0|a[r+6>>0]),0,24))|0,$e|l|0,2),i[($e=d+8|0)>>2]=33554431&He,i[$e+4>>2]=0,$e=0|x(0|a[r+7>>0],0,8),He=l,We=0|x(0|a[r+8>>0],0,16),qe=He|l,ze=0|F($e|Je|We|(Ve=0|x(0|(He=0|a[r+9>>0]),0,24))|0,qe|l|0,3),i[(qe=d+16|0)>>2]=67108863&ze,i[qe+4>>2]=0,qe=0|x(0|a[r+10>>0],0,8),ze=l,Ve=0|x(0|a[r+11>>0],0,16),We=ze|l,$e=0|F(qe|He|Ve|(Je=0|x(0|(ze=0|a[r+12>>0]),0,24))|0,We|l|0,5),i[(We=d+24|0)>>2]=33554431&$e,i[We+4>>2]=0,We=0|x(0|a[r+13>>0],0,8),$e=l,Je=0|x(0|a[r+14>>0],0,16),Ve=$e|l,He=0|F(We|ze|Je|($e=0|x(0|a[r+15>>0],0,24))|0,Ve|l|0,6),i[(Ve=d+32|0)>>2]=67108863&He,i[Ve+4>>2]=0,Ve=0|a[r+16>>0],He=0|x(0|a[r+17>>0],0,8),$e=l,Je=0|x(0|a[r+18>>0],0,16),ze=$e|l,We=0|x(0|($e=0|a[r+19>>0]),0,24),i[(qe=d+40|0)>>2]=He|Ve|Je|16777216&We,i[qe+4>>2]=ze,ze=0|x(0|a[r+20>>0],0,8),qe=l,We=0|x(0|a[r+21>>0],0,16),Je=qe|l,He=0|F(ze|$e|We|(Ve=0|x(0|(qe=0|a[r+22>>0]),0,24))|0,Je|l|0,1),i[(Je=d+48|0)>>2]=67108863&He,i[Je+4>>2]=0,Je=0|x(0|a[r+23>>0],0,8),He=l,Ve=0|x(0|a[r+24>>0],0,16),We=He|l,ze=0|F(Je|qe|Ve|($e=0|x(0|(He=0|a[r+25>>0]),0,24))|0,We|l|0,3),i[(We=d+56|0)>>2]=33554431&ze,i[We+4>>2]=0,We=0|x(0|a[r+26>>0],0,8),ze=l,$e=0|x(0|a[r+27>>0],0,16),Ve=ze|l,Je=0|F(We|He|$e|(qe=0|x(0|(ze=0|a[r+28>>0]),0,24))|0,Ve|l|0,4),i[(Ve=d+64|0)>>2]=67108863&Je,i[Ve+4>>2]=0,Ve=0|x(0|a[r+29>>0],0,8),Je=l,qe=0|x(0|a[r+30>>0],0,16),$e=Je|l,r=0|F(Ve|ze|qe|(Je=0|x(0|a[r+31>>0],0,24))|0,$e|l|0,6),i[($e=d+72|0)>>2]=33554431&r,i[$e+4>>2]=0,U(0|De,0,152),i[($e=De)>>2]=1,i[$e+4>>2]=0,U(0|Ne,0,152),i[($e=Ne)>>2]=1,i[$e+4>>2]=0,U(0|Le,0,152),U(0|ke,0,152),U(0|Ge,0,152),i[($e=Ge)>>2]=1,i[$e+4>>2]=0,U(0|Ue,0,152),U(0|Fe,0,152),i[($e=Fe)>>2]=1,i[$e+4>>2]=0,t=(Ye=Re+80|0)+72|0;do{i[Ye>>2]=0,Ye=Ye+4|0}while((0|Ye)<(0|t));je=d,t=(Ye=Re)+80|0;do{i[Ye>>2]=i[je>>2],Ye=Ye+4|0,je=je+4|0}while((0|Ye)<(0|t));for($e=Me+144|0,r=Me+64|0,Je=Me+136|0,qe=Me+56|0,ze=Me+128|0,Ve=Me+48|0,He=Me+120|0,We=Me+40|0,p=Me+112|0,h=Me+32|0,f=Me+104|0,_=Me+24|0,m=Me+96|0,g=Me+16|0,y=Me+88|0,E=Me+8|0,S=Me+80|0,v=Oe+144|0,T=Oe+64|0,A=Oe+136|0,C=Oe+56|0,O=Oe+128|0,I=Oe+48|0,w=Oe+120|0,R=Oe+40|0,D=Oe+112|0,N=Oe+32|0,K=Oe+104|0,Y=Oe+24|0,j=Oe+96|0,W=Oe+16|0,H=Oe+88|0,V=Oe+8|0,$=Oe+80|0,z=Me+72|0,q=Oe+72|0,J=be+8|0,Q=Pe+8|0,X=be+16|0,Z=Pe+16|0,ee=be+24|0,te=Pe+24|0,re=be+32|0,ne=Pe+32|0,ie=be+40|0,ae=Pe+40|0,se=be+48|0,oe=Pe+48|0,le=be+56|0,ce=Pe+56|0,de=be+64|0,ue=Pe+64|0,pe=be+72|0,he=Pe+72|0,fe=Ce+80|0,_e=Ce+8|0,me=Ce+16|0,ge=Ce+24|0,ye=Ce+32|0,Ee=Ce+40|0,Se=Ce+48|0,ve=Ce+56|0,Te=Ce+64|0,Ae=Ce+72|0,Qe=0,Xe=Re,Ze=ke,ke=De,et=Ge,Ge=Ne,tt=Ue,Ue=Le,Le=Fe;;){for(Fe=0|n[u+(31-Qe)>>0],rt=0,nt=Xe,it=Ze,at=ke,st=et,ot=Ge,lt=tt,ct=Ue,dt=Le;;){pt=0|k(0,0,(ut=255&Fe)>>>7|0,0),ht=l,ft=0;do{gt=0|i[(mt=_t=ot+(ft<<3)|0)>>2],yt=0|i[mt+4>>2],St=0|i[(Et=mt=nt+(ft<<3)|0)>>2],Tt=((vt=0|i[Et+4>>2])^yt)&ht,yt=0|L(0,(Et=(St^gt)&pt)^gt|0,32),i[(gt=_t)>>2]=yt,i[gt+4>>2]=l,gt=0|L(0,Et^St|0,32),i[(St=mt)>>2]=gt,i[St+4>>2]=l,ft=ft+1|0}while(10!=(0|ft));At=0;do{gt=0|i[(St=ft=ct+(At<<3)|0)>>2],mt=0|i[St+4>>2],yt=0|i[(Et=St=at+(At<<3)|0)>>2],vt=((_t=0|i[Et+4>>2])^mt)&ht,mt=0|L(0,(Et=(yt^gt)&pt)^gt|0,32),i[(gt=ft)>>2]=mt,i[gt+4>>2]=l,gt=0|L(0,Et^yt|0,32),i[(yt=St)>>2]=gt,i[yt+4>>2]=l,At=At+1|0}while(10!=(0|At));gt=0|i[(yt=ot)>>2],St=0|i[yt+4>>2],mt=0|i[(Et=yt=ot+8|0)>>2],ft=0|i[Et+4>>2],vt=0|i[(_t=Et=ot+16|0)>>2],Tt=0|i[_t+4>>2],bt=0|i[(Ct=_t=ot+24|0)>>2],Pt=0|i[Ct+4>>2],Ot=0|i[(Mt=Ct=ot+32|0)>>2],It=0|i[Mt+4>>2],Rt=0|i[(wt=Mt=ot+40|0)>>2],Dt=0|i[wt+4>>2],Lt=0|i[(Nt=wt=ot+48|0)>>2],kt=0|i[Nt+4>>2],Ut=0|i[(Gt=Nt=ot+56|0)>>2],Ft=0|i[Gt+4>>2],Bt=0|i[(xt=Gt=ot+64|0)>>2],Kt=0|i[xt+4>>2],jt=0|i[(Yt=xt=ot+72|0)>>2],Wt=0|i[Yt+4>>2],Yt=0|G(0|(Ht=0|i[(Yt=ct)>>2]),0|(Vt=0|i[Yt+4>>2]),0|gt,0|St),i[($t=ot)>>2]=Yt,i[$t+4>>2]=l,Yt=0|G(0|(zt=0|i[(Yt=$t=ct+8|0)>>2]),0|(qt=0|i[Yt+4>>2]),0|mt,0|ft),i[(Jt=yt)>>2]=Yt,i[Jt+4>>2]=l,Yt=0|G(0|(yt=0|i[(Yt=Jt=ct+16|0)>>2]),0|(Qt=0|i[Yt+4>>2]),0|vt,0|Tt),i[(Xt=Et)>>2]=Yt,i[Xt+4>>2]=l,Yt=0|G(0|(Et=0|i[(Yt=Xt=ct+24|0)>>2]),0|(Zt=0|i[Yt+4>>2]),0|bt,0|Pt),i[(er=_t)>>2]=Yt,i[er+4>>2]=l,Yt=0|G(0|(_t=0|i[(Yt=er=ct+32|0)>>2]),0|(tr=0|i[Yt+4>>2]),0|Ot,0|It),i[(rr=Ct)>>2]=Yt,i[rr+4>>2]=l,Yt=0|G(0|(Ct=0|i[(Yt=rr=ct+40|0)>>2]),0|(nr=0|i[Yt+4>>2]),0|Rt,0|Dt),i[(ir=Mt)>>2]=Yt,i[ir+4>>2]=l,Yt=0|G(0|(Mt=0|i[(Yt=ir=ct+48|0)>>2]),0|(ar=0|i[Yt+4>>2]),0|Lt,0|kt),i[(sr=wt)>>2]=Yt,i[sr+4>>2]=l,Yt=0|G(0|(wt=0|i[(Yt=sr=ct+56|0)>>2]),0|(or=0|i[Yt+4>>2]),0|Ut,0|Ft),i[(lr=Nt)>>2]=Yt,i[lr+4>>2]=l,Yt=0|G(0|(Nt=0|i[(Yt=lr=ct+64|0)>>2]),0|(cr=0|i[Yt+4>>2]),0|Bt,0|Kt),i[(dr=Gt)>>2]=Yt,i[dr+4>>2]=l,Yt=0|G(0|(Gt=0|i[(Yt=dr=ct+72|0)>>2]),0|(ur=0|i[Yt+4>>2]),0|jt,0|Wt),i[(pr=xt)>>2]=Yt,i[pr+4>>2]=l,pr=0|k(0|gt,0|St,0|Ht,0|Vt),i[(Vt=ct)>>2]=pr,i[Vt+4>>2]=l,Vt=0|k(0|mt,0|ft,0|zt,0|qt),i[(qt=$t)>>2]=Vt,i[qt+4>>2]=l,qt=0|k(0|vt,0|Tt,0|yt,0|Qt),i[(Qt=Jt)>>2]=qt,i[Qt+4>>2]=l,Qt=0|k(0|bt,0|Pt,0|Et,0|Zt),i[(Zt=Xt)>>2]=Qt,i[Zt+4>>2]=l,Zt=0|k(0|Ot,0|It,0|_t,0|tr),i[(tr=er)>>2]=Zt,i[tr+4>>2]=l,tr=0|k(0|Rt,0|Dt,0|Ct,0|nr),i[(nr=rr)>>2]=tr,i[nr+4>>2]=l,nr=0|k(0|Lt,0|kt,0|Mt,0|ar),i[(ar=ir)>>2]=nr,i[ar+4>>2]=l,ar=0|k(0|Ut,0|Ft,0|wt,0|or),i[(or=sr)>>2]=ar,i[or+4>>2]=l,or=0|k(0|Bt,0|Kt,0|Nt,0|cr),i[(cr=lr)>>2]=or,i[cr+4>>2]=l,cr=0|k(0|jt,0|Wt,0|Gt,0|ur),i[(ur=dr)>>2]=cr,i[ur+4>>2]=l,cr=0|i[(ur=nt)>>2],dr=0|i[ur+4>>2],Wt=0|i[(Gt=ur=nt+8|0)>>2],jt=0|i[Gt+4>>2],lr=0|i[(or=Gt=nt+16|0)>>2],Nt=0|i[or+4>>2],Bt=0|i[(Kt=or=nt+24|0)>>2],ar=0|i[Kt+4>>2],wt=0|i[(sr=Kt=nt+32|0)>>2],Ft=0|i[sr+4>>2],nr=0|i[(Ut=sr=nt+40|0)>>2],ir=0|i[Ut+4>>2],kt=0|i[(Mt=Ut=nt+48|0)>>2],Lt=0|i[Mt+4>>2],rr=0|i[(tr=Mt=nt+56|0)>>2],Ct=0|i[tr+4>>2],Rt=0|i[(Dt=tr=nt+64|0)>>2],Zt=0|i[Dt+4>>2],_t=0|i[(er=Dt=nt+72|0)>>2],It=0|i[er+4>>2],er=0|G(0|(Ot=0|i[(er=at)>>2]),0|(Qt=0|i[er+4>>2]),0|cr,0|dr),i[(Xt=nt)>>2]=er,i[Xt+4>>2]=l,er=0|G(0|(Et=0|i[(er=Xt=at+8|0)>>2]),0|(Pt=0|i[er+4>>2]),0|Wt,0|jt),i[(bt=ur)>>2]=er,i[bt+4>>2]=l,er=0|G(0|(ur=0|i[(er=bt=at+16|0)>>2]),0|(qt=0|i[er+4>>2]),0|lr,0|Nt),i[(Jt=Gt)>>2]=er,i[Jt+4>>2]=l,er=0|G(0|(Gt=0|i[(er=Jt=at+24|0)>>2]),0|(yt=0|i[er+4>>2]),0|Bt,0|ar),i[(Tt=or)>>2]=er,i[Tt+4>>2]=l,er=0|G(0|(or=0|i[(er=Tt=at+32|0)>>2]),0|(vt=0|i[er+4>>2]),0|wt,0|Ft),i[(Vt=Kt)>>2]=er,i[Vt+4>>2]=l,er=0|G(0|(Kt=0|i[(er=Vt=at+40|0)>>2]),0|($t=0|i[er+4>>2]),0|nr,0|ir),i[(zt=sr)>>2]=er,i[zt+4>>2]=l,er=0|G(0|(sr=0|i[(er=zt=at+48|0)>>2]),0|(ft=0|i[er+4>>2]),0|kt,0|Lt),i[(mt=Ut)>>2]=er,i[mt+4>>2]=l,er=0|G(0|(Ut=0|i[(er=mt=at+56|0)>>2]),0|(pr=0|i[er+4>>2]),0|rr,0|Ct),i[(Ht=Mt)>>2]=er,i[Ht+4>>2]=l,er=0|G(0|(Mt=0|i[(er=Ht=at+64|0)>>2]),0|(St=0|i[er+4>>2]),0|Rt,0|Zt),i[(gt=tr)>>2]=er,i[gt+4>>2]=l,er=0|G(0|(tr=0|i[(er=gt=at+72|0)>>2]),0|(Yt=0|i[er+4>>2]),0|_t,0|It),i[(xt=Dt)>>2]=er,i[xt+4>>2]=l,xt=0|k(0|cr,0|dr,0|Ot,0|Qt),i[(Qt=at)>>2]=xt,i[Qt+4>>2]=l,Qt=0|k(0|Wt,0|jt,0|Et,0|Pt),i[(Pt=Xt)>>2]=Qt,i[Pt+4>>2]=l,Pt=0|k(0|lr,0|Nt,0|ur,0|qt),i[(qt=bt)>>2]=Pt,i[qt+4>>2]=l,qt=0|k(0|Bt,0|ar,0|Gt,0|yt),i[(yt=Jt)>>2]=qt,i[yt+4>>2]=l,yt=0|k(0|wt,0|Ft,0|or,0|vt),i[(vt=Tt)>>2]=yt,i[vt+4>>2]=l,vt=0|k(0|nr,0|ir,0|Kt,0|$t),i[($t=Vt)>>2]=vt,i[$t+4>>2]=l,$t=0|k(0|kt,0|Lt,0|sr,0|ft),i[(ft=zt)>>2]=$t,i[ft+4>>2]=l,ft=0|k(0|rr,0|Ct,0|Ut,0|pr),i[(pr=mt)>>2]=ft,i[pr+4>>2]=l,pr=0|k(0|Rt,0|Zt,0|Mt,0|St),i[(St=Ht)>>2]=pr,i[St+4>>2]=l,St=0|k(0|_t,0|It,0|tr,0|Yt),i[(Yt=gt)>>2]=St,i[Yt+4>>2]=l,P(Me,nt,ct),P(Oe,ot,at),St=0|i[(Yt=$e)>>2],gt=0|i[Yt+4>>2],tr=0|i[(Yt=r)>>2],It=0|i[Yt+4>>2],Yt=0|B(0|St,0|gt,18,0),_t=l,pr=0|G(0|tr,0|It,0|St,0|gt),gt=0|G(0|pr,0|l,0|Yt,0|_t),i[(_t=r)>>2]=gt,i[_t+4>>2]=l,gt=0|i[(_t=Je)>>2],Yt=0|i[_t+4>>2],pr=0|i[(_t=qe)>>2],St=0|i[_t+4>>2],_t=0|B(0|gt,0|Yt,18,0),It=l,tr=0|G(0|pr,0|St,0|gt,0|Yt),Yt=0|G(0|tr,0|l,0|_t,0|It),i[(It=qe)>>2]=Yt,i[It+4>>2]=l,Yt=0|i[(It=ze)>>2],_t=0|i[It+4>>2],tr=0|i[(It=Ve)>>2],gt=0|i[It+4>>2],It=0|B(0|Yt,0|_t,18,0),St=l,pr=0|G(0|tr,0|gt,0|Yt,0|_t),_t=0|G(0|pr,0|l,0|It,0|St),i[(St=Ve)>>2]=_t,i[St+4>>2]=l,_t=0|i[(St=He)>>2],It=0|i[St+4>>2],pr=0|i[(St=We)>>2],Yt=0|i[St+4>>2],St=0|B(0|_t,0|It,18,0),gt=l,tr=0|G(0|pr,0|Yt,0|_t,0|It),It=0|G(0|tr,0|l,0|St,0|gt),i[(gt=We)>>2]=It,i[gt+4>>2]=l,It=0|i[(gt=p)>>2],St=0|i[gt+4>>2],tr=0|i[(gt=h)>>2],_t=0|i[gt+4>>2],gt=0|B(0|It,0|St,18,0),Yt=l,pr=0|G(0|tr,0|_t,0|It,0|St),St=0|G(0|pr,0|l,0|gt,0|Yt),i[(Yt=h)>>2]=St,i[Yt+4>>2]=l,St=0|i[(Yt=f)>>2],gt=0|i[Yt+4>>2],pr=0|i[(Yt=_)>>2],It=0|i[Yt+4>>2],Yt=0|B(0|St,0|gt,18,0),_t=l,tr=0|G(0|pr,0|It,0|St,0|gt),gt=0|G(0|tr,0|l,0|Yt,0|_t),i[(_t=_)>>2]=gt,i[_t+4>>2]=l,gt=0|i[(_t=m)>>2],Yt=0|i[_t+4>>2],tr=0|i[(_t=g)>>2],St=0|i[_t+4>>2],_t=0|B(0|gt,0|Yt,18,0),It=l,pr=0|G(0|tr,0|St,0|gt,0|Yt),Yt=0|G(0|pr,0|l,0|_t,0|It),i[(It=g)>>2]=Yt,i[It+4>>2]=l,Yt=0|i[(It=y)>>2],_t=0|i[It+4>>2],pr=0|i[(It=E)>>2],gt=0|i[It+4>>2],It=0|B(0|Yt,0|_t,18,0),St=l,tr=0|G(0|pr,0|gt,0|Yt,0|_t),_t=0|G(0|tr,0|l,0|It,0|St),i[(St=E)>>2]=_t,i[St+4>>2]=l,_t=0|i[(St=S)>>2],It=0|i[St+4>>2],tr=0|i[(St=Me)>>2],Yt=0|i[St+4>>2],St=0|B(0|_t,0|It,18,0),gt=l,pr=0|G(0|tr,0|Yt,0|_t,0|It),It=0|G(0|pr,0|l,0|St,0|gt),gt=l,i[(St=Me)>>2]=It,i[St+4>>2]=gt,i[(St=S)>>2]=0,i[St+4>>2]=0,St=gt,gt=It,It=0;do{tr=0|k(0|gt,0|St,0|(Yt=0|x(0|(_t=0|L(0|(pr=0|G(St>>31>>>6|0,0,0|gt,0|St)),0|l,26)),0|(pr=l),26)),0|l),i[(Yt=Me+(It<<3)|0)>>2]=tr,i[Yt+4>>2]=l,Zt=0|k(0|(Ht=0|G(0|_t,0|pr,0|i[(tr=Yt=Me+((1|It)<<3)|0)>>2],0|i[tr+4>>2])),0|(tr=l),0|(Mt=0|x(0|(_t=0|L(0|(pr=0|G(tr>>31>>>7|0,0,0|Ht,0|tr)),0|l,25)),0|(pr=l),25)),0|l),i[(Mt=Yt)>>2]=Zt,i[Mt+4>>2]=l,gt=0|G(0|_t,0|pr,0|i[(Zt=Mt=Me+((It=It+2|0)<<3)|0)>>2],0|i[Zt+4>>2]),St=l,i[(Zt=Mt)>>2]=gt,i[Zt+4>>2]=St}while(It>>>0<10);St=0|i[(It=S)>>2],gt=0|i[It+4>>2],Zt=0|i[(It=Me)>>2],Mt=0|i[It+4>>2],It=0|B(0|St,0|gt,18,0),pr=l,_t=0|G(0|Zt,0|Mt,0|St,0|gt),gt=0|G(0|_t,0|l,0|It,0|pr),pr=l,i[(It=S)>>2]=0,i[It+4>>2]=0,Mt=0|k(0|gt,0|pr,0|(St=0|x(0|(_t=0|L(0|(It=0|G(pr>>31>>>6|0,0,0|gt,0|pr)),0|l,26)),0|(It=l),26)),0|l),St=l,i[(pr=Me)>>2]=Mt,i[pr+4>>2]=St,gt=0|G(0|_t,0|It,0|i[(pr=E)>>2],0|i[pr+4>>2]),pr=l,i[(It=E)>>2]=gt,i[It+4>>2]=pr,_t=0|i[(It=v)>>2],Zt=0|i[It+4>>2],Yt=0|i[(It=T)>>2],tr=0|i[It+4>>2],It=0|B(0|_t,0|Zt,18,0),Ht=l,Rt=0|G(0|Yt,0|tr,0|_t,0|Zt),Zt=0|G(0|Rt,0|l,0|It,0|Ht),i[(Ht=T)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=A)>>2],It=0|i[Ht+4>>2],Rt=0|i[(Ht=C)>>2],_t=0|i[Ht+4>>2],Ht=0|B(0|Zt,0|It,18,0),tr=l,Yt=0|G(0|Rt,0|_t,0|Zt,0|It),It=0|G(0|Yt,0|l,0|Ht,0|tr),i[(tr=C)>>2]=It,i[tr+4>>2]=l,It=0|i[(tr=O)>>2],Ht=0|i[tr+4>>2],Yt=0|i[(tr=I)>>2],Zt=0|i[tr+4>>2],tr=0|B(0|It,0|Ht,18,0),_t=l,Rt=0|G(0|Yt,0|Zt,0|It,0|Ht),Ht=0|G(0|Rt,0|l,0|tr,0|_t),i[(_t=I)>>2]=Ht,i[_t+4>>2]=l,Ht=0|i[(_t=w)>>2],tr=0|i[_t+4>>2],Rt=0|i[(_t=R)>>2],It=0|i[_t+4>>2],_t=0|B(0|Ht,0|tr,18,0),Zt=l,Yt=0|G(0|Rt,0|It,0|Ht,0|tr),tr=0|G(0|Yt,0|l,0|_t,0|Zt),i[(Zt=R)>>2]=tr,i[Zt+4>>2]=l,tr=0|i[(Zt=D)>>2],_t=0|i[Zt+4>>2],Yt=0|i[(Zt=N)>>2],Ht=0|i[Zt+4>>2],Zt=0|B(0|tr,0|_t,18,0),It=l,Rt=0|G(0|Yt,0|Ht,0|tr,0|_t),_t=0|G(0|Rt,0|l,0|Zt,0|It),i[(It=N)>>2]=_t,i[It+4>>2]=l,_t=0|i[(It=K)>>2],Zt=0|i[It+4>>2],Rt=0|i[(It=Y)>>2],tr=0|i[It+4>>2],It=0|B(0|_t,0|Zt,18,0),Ht=l,Yt=0|G(0|Rt,0|tr,0|_t,0|Zt),Zt=0|G(0|Yt,0|l,0|It,0|Ht),i[(Ht=Y)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=j)>>2],It=0|i[Ht+4>>2],Yt=0|i[(Ht=W)>>2],_t=0|i[Ht+4>>2],Ht=0|B(0|Zt,0|It,18,0),tr=l,Rt=0|G(0|Yt,0|_t,0|Zt,0|It),It=0|G(0|Rt,0|l,0|Ht,0|tr),i[(tr=W)>>2]=It,i[tr+4>>2]=l,It=0|i[(tr=H)>>2],Ht=0|i[tr+4>>2],Rt=0|i[(tr=V)>>2],Zt=0|i[tr+4>>2],tr=0|B(0|It,0|Ht,18,0),_t=l,Yt=0|G(0|Rt,0|Zt,0|It,0|Ht),Ht=0|G(0|Yt,0|l,0|tr,0|_t),i[(_t=V)>>2]=Ht,i[_t+4>>2]=l,Ht=0|i[(_t=$)>>2],tr=0|i[_t+4>>2],Yt=0|i[(_t=Oe)>>2],It=0|i[_t+4>>2],_t=0|B(0|Ht,0|tr,18,0),Zt=l,Rt=0|G(0|Yt,0|It,0|Ht,0|tr),tr=0|G(0|Rt,0|l,0|_t,0|Zt),Zt=l,i[(_t=Oe)>>2]=tr,i[_t+4>>2]=Zt,i[(_t=$)>>2]=0,i[_t+4>>2]=0,_t=Zt,Zt=tr,tr=0;do{Yt=0|k(0|Zt,0|_t,0|(It=0|x(0|(Ht=0|L(0|(Rt=0|G(_t>>31>>>6|0,0,0|Zt,0|_t)),0|l,26)),0|(Rt=l),26)),0|l),i[(It=Oe+(tr<<3)|0)>>2]=Yt,i[It+4>>2]=l,Ut=0|k(0|(ft=0|G(0|Ht,0|Rt,0|i[(Yt=It=Oe+((1|tr)<<3)|0)>>2],0|i[Yt+4>>2])),0|(Yt=l),0|(mt=0|x(0|(Ht=0|L(0|(Rt=0|G(Yt>>31>>>7|0,0,0|ft,0|Yt)),0|l,25)),0|(Rt=l),25)),0|l),i[(mt=It)>>2]=Ut,i[mt+4>>2]=l,Zt=0|G(0|Ht,0|Rt,0|i[(Ut=mt=Oe+((tr=tr+2|0)<<3)|0)>>2],0|i[Ut+4>>2]),_t=l,i[(Ut=mt)>>2]=Zt,i[Ut+4>>2]=_t}while(tr>>>0<10);_t=0|i[(tr=$)>>2],Zt=0|i[tr+4>>2],Ut=0|i[(tr=Oe)>>2],mt=0|i[tr+4>>2],tr=0|B(0|_t,0|Zt,18,0),Rt=l,Ht=0|G(0|Ut,0|mt,0|_t,0|Zt),Zt=0|G(0|Ht,0|l,0|tr,0|Rt),Rt=l,i[(tr=$)>>2]=0,i[tr+4>>2]=0,mt=0|k(0|Zt,0|Rt,0|(_t=0|x(0|(Ht=0|L(0|(tr=0|G(Rt>>31>>>6|0,0,0|Zt,0|Rt)),0|l,26)),0|(tr=l),26)),0|l),_t=l,Zt=0|G(0|Ht,0|tr,0|i[(Rt=V)>>2],0|i[Rt+4>>2]),Rt=l,Ht=0|i[(tr=g)>>2],Ut=0|i[tr+4>>2],It=0|i[(tr=_)>>2],Yt=0|i[tr+4>>2],ft=0|i[(tr=h)>>2],Ct=0|i[tr+4>>2],rr=0|i[(tr=We)>>2],$t=0|i[tr+4>>2],zt=0|i[(tr=Ve)>>2],sr=0|i[tr+4>>2],Lt=0|i[(tr=qe)>>2],kt=0|i[tr+4>>2],vt=0|i[(tr=r)>>2],Vt=0|i[tr+4>>2],Kt=0|i[(tr=z)>>2],ir=0|i[tr+4>>2],tr=0|G(0|mt,0|_t,0|Mt,0|St),i[(nr=Me)>>2]=tr,i[nr+4>>2]=l,nr=0|G(0|Zt,0|Rt,0|gt,0|pr),i[(tr=E)>>2]=nr,i[tr+4>>2]=l,tr=0|G(0|(nr=0|i[(tr=W)>>2]),0|(yt=0|i[tr+4>>2]),0|Ht,0|Ut),i[(Tt=g)>>2]=tr,i[Tt+4>>2]=l,Tt=0|G(0|(tr=0|i[(Tt=Y)>>2]),0|(or=0|i[Tt+4>>2]),0|It,0|Yt),i[(Ft=_)>>2]=Tt,i[Ft+4>>2]=l,Ft=0|G(0|(Tt=0|i[(Ft=N)>>2]),0|(wt=0|i[Ft+4>>2]),0|ft,0|Ct),i[(qt=h)>>2]=Ft,i[qt+4>>2]=l,qt=0|G(0|(Ft=0|i[(qt=R)>>2]),0|(Jt=0|i[qt+4>>2]),0|rr,0|$t),i[(Gt=We)>>2]=qt,i[Gt+4>>2]=l,Gt=0|G(0|(qt=0|i[(Gt=I)>>2]),0|(ar=0|i[Gt+4>>2]),0|zt,0|sr),i[(Bt=Ve)>>2]=Gt,i[Bt+4>>2]=l,Bt=0|G(0|(Gt=0|i[(Bt=C)>>2]),0|(Pt=0|i[Bt+4>>2]),0|Lt,0|kt),i[(bt=qe)>>2]=Bt,i[bt+4>>2]=l,bt=0|G(0|(Bt=0|i[(bt=T)>>2]),0|(ur=0|i[bt+4>>2]),0|vt,0|Vt),i[(Nt=r)>>2]=bt,i[Nt+4>>2]=l,Nt=0|G(0|(bt=0|i[(Nt=q)>>2]),0|(lr=0|i[Nt+4>>2]),0|Kt,0|ir),i[(Qt=z)>>2]=Nt,i[Qt+4>>2]=l,Qt=0|k(0|Mt,0|St,0|mt,0|_t),i[(_t=Oe)>>2]=Qt,i[_t+4>>2]=l,_t=0|k(0|gt,0|pr,0|Zt,0|Rt),i[(Rt=V)>>2]=_t,i[Rt+4>>2]=l,Rt=0|k(0|Ht,0|Ut,0|nr,0|yt),i[(yt=W)>>2]=Rt,i[yt+4>>2]=l,yt=0|k(0|It,0|Yt,0|tr,0|or),i[(or=Y)>>2]=yt,i[or+4>>2]=l,or=0|k(0|ft,0|Ct,0|Tt,0|wt),i[(wt=N)>>2]=or,i[wt+4>>2]=l,wt=0|k(0|rr,0|$t,0|Ft,0|Jt),i[(Jt=R)>>2]=wt,i[Jt+4>>2]=l,Jt=0|k(0|zt,0|sr,0|qt,0|ar),i[(ar=I)>>2]=Jt,i[ar+4>>2]=l,ar=0|k(0|Lt,0|kt,0|Gt,0|Pt),i[(Pt=C)>>2]=ar,i[Pt+4>>2]=l,Pt=0|k(0|vt,0|Vt,0|Bt,0|ur),i[(ur=T)>>2]=Pt,i[ur+4>>2]=l,ur=0|k(0|Kt,0|ir,0|bt,0|lr),i[(lr=q)>>2]=ur,i[lr+4>>2]=l,M(we,Me),M(Ie,Oe),P(Oe,Ie,d),ur=0|i[(lr=v)>>2],bt=0|i[lr+4>>2],ir=0|i[(lr=T)>>2],Kt=0|i[lr+4>>2],lr=0|B(0|ur,0|bt,18,0),Pt=l,Bt=0|G(0|ir,0|Kt,0|ur,0|bt),bt=0|G(0|Bt,0|l,0|lr,0|Pt),i[(Pt=T)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=A)>>2],lr=0|i[Pt+4>>2],Bt=0|i[(Pt=C)>>2],ur=0|i[Pt+4>>2],Pt=0|B(0|bt,0|lr,18,0),Kt=l,ir=0|G(0|Bt,0|ur,0|bt,0|lr),lr=0|G(0|ir,0|l,0|Pt,0|Kt),i[(Kt=C)>>2]=lr,i[Kt+4>>2]=l,lr=0|i[(Kt=O)>>2],Pt=0|i[Kt+4>>2],ir=0|i[(Kt=I)>>2],bt=0|i[Kt+4>>2],Kt=0|B(0|lr,0|Pt,18,0),ur=l,Bt=0|G(0|ir,0|bt,0|lr,0|Pt),Pt=0|G(0|Bt,0|l,0|Kt,0|ur),i[(ur=I)>>2]=Pt,i[ur+4>>2]=l,Pt=0|i[(ur=w)>>2],Kt=0|i[ur+4>>2],Bt=0|i[(ur=R)>>2],lr=0|i[ur+4>>2],ur=0|B(0|Pt,0|Kt,18,0),bt=l,ir=0|G(0|Bt,0|lr,0|Pt,0|Kt),Kt=0|G(0|ir,0|l,0|ur,0|bt),i[(bt=R)>>2]=Kt,i[bt+4>>2]=l,Kt=0|i[(bt=D)>>2],ur=0|i[bt+4>>2],ir=0|i[(bt=N)>>2],Pt=0|i[bt+4>>2],bt=0|B(0|Kt,0|ur,18,0),lr=l,Bt=0|G(0|ir,0|Pt,0|Kt,0|ur),ur=0|G(0|Bt,0|l,0|bt,0|lr),i[(lr=N)>>2]=ur,i[lr+4>>2]=l,ur=0|i[(lr=K)>>2],bt=0|i[lr+4>>2],Bt=0|i[(lr=Y)>>2],Kt=0|i[lr+4>>2],lr=0|B(0|ur,0|bt,18,0),Pt=l,ir=0|G(0|Bt,0|Kt,0|ur,0|bt),bt=0|G(0|ir,0|l,0|lr,0|Pt),i[(Pt=Y)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=j)>>2],lr=0|i[Pt+4>>2],ir=0|i[(Pt=W)>>2],ur=0|i[Pt+4>>2],Pt=0|B(0|bt,0|lr,18,0),Kt=l,Bt=0|G(0|ir,0|ur,0|bt,0|lr),lr=0|G(0|Bt,0|l,0|Pt,0|Kt),i[(Kt=W)>>2]=lr,i[Kt+4>>2]=l,lr=0|i[(Kt=H)>>2],Pt=0|i[Kt+4>>2],Bt=0|i[(Kt=V)>>2],bt=0|i[Kt+4>>2],Kt=0|B(0|lr,0|Pt,18,0),ur=l,ir=0|G(0|Bt,0|bt,0|lr,0|Pt),Pt=0|G(0|ir,0|l,0|Kt,0|ur),i[(ur=V)>>2]=Pt,i[ur+4>>2]=l,Pt=0|i[(ur=$)>>2],Kt=0|i[ur+4>>2],ir=0|i[(ur=Oe)>>2],lr=0|i[ur+4>>2],ur=0|B(0|Pt,0|Kt,18,0),bt=l,Bt=0|G(0|ir,0|lr,0|Pt,0|Kt),Kt=0|G(0|Bt,0|l,0|ur,0|bt),bt=l,i[(ur=Oe)>>2]=Kt,i[ur+4>>2]=bt,i[(ur=$)>>2]=0,i[ur+4>>2]=0,ur=bt,bt=Kt,Kt=0;do{ir=0|k(0|bt,0|ur,0|(lr=0|x(0|(Pt=0|L(0|(Bt=0|G(ur>>31>>>6|0,0,0|bt,0|ur)),0|l,26)),0|(Bt=l),26)),0|l),i[(lr=Oe+(Kt<<3)|0)>>2]=ir,i[lr+4>>2]=l,ar=0|k(0|(Vt=0|G(0|Pt,0|Bt,0|i[(ir=lr=Oe+((1|Kt)<<3)|0)>>2],0|i[ir+4>>2])),0|(ir=l),0|(vt=0|x(0|(Pt=0|L(0|(Bt=0|G(ir>>31>>>7|0,0,0|Vt,0|ir)),0|l,25)),0|(Bt=l),25)),0|l),i[(vt=lr)>>2]=ar,i[vt+4>>2]=l,bt=0|G(0|Pt,0|Bt,0|i[(ar=vt=Oe+((Kt=Kt+2|0)<<3)|0)>>2],0|i[ar+4>>2]),ur=l,i[(ar=vt)>>2]=bt,i[ar+4>>2]=ur}while(Kt>>>0<10);ur=0|i[(Kt=$)>>2],bt=0|i[Kt+4>>2],pr=0|i[(Kt=Oe)>>2],gt=0|i[Kt+4>>2],Kt=0|B(0|ur,0|bt,18,0),St=l,Mt=0|G(0|pr,0|gt,0|ur,0|bt),bt=0|G(0|Mt,0|l,0|Kt,0|St),St=l,i[(Kt=$)>>2]=0,i[Kt+4>>2]=0,gt=0|k(0|bt,0|St,0|(ur=0|x(0|(Mt=0|L(0|(Kt=0|G(St>>31>>>6|0,0,0|bt,0|St)),0|l,26)),0|(Kt=l),26)),0|l),i[(ur=Oe)>>2]=gt,i[ur+4>>2]=l,gt=0|G(0|Mt,0|Kt,0|i[(ur=V)>>2],0|i[ur+4>>2]),i[(ur=V)>>2]=gt,i[ur+4>>2]=l,je=we,t=(Ye=it)+80|0;do{i[Ye>>2]=i[je>>2],Ye=Ye+4|0,je=je+4|0}while((0|Ye)<(0|t));je=Oe,t=(Ye=st)+80|0;do{i[Ye>>2]=i[je>>2],Ye=Ye+4|0,je=je+4|0}while((0|Ye)<(0|t));M(be,ot),M(Pe,ct),P(lt,be,Pe),gt=0|i[(ur=lt+144|0)>>2],Kt=0|i[ur+4>>2],St=0|i[(Mt=ur=lt+64|0)>>2],bt=0|i[Mt+4>>2],Mt=0|B(0|gt,0|Kt,18,0),pr=l,ar=0|G(0|St,0|bt,0|gt,0|Kt),Kt=0|G(0|ar,0|l,0|Mt,0|pr),i[(pr=ur)>>2]=Kt,i[pr+4>>2]=l,Kt=0|i[(pr=lt+136|0)>>2],ur=0|i[pr+4>>2],ar=0|i[(Mt=pr=lt+56|0)>>2],gt=0|i[Mt+4>>2],Mt=0|B(0|Kt,0|ur,18,0),bt=l,St=0|G(0|ar,0|gt,0|Kt,0|ur),ur=0|G(0|St,0|l,0|Mt,0|bt),i[(bt=pr)>>2]=ur,i[bt+4>>2]=l,ur=0|i[(bt=lt+128|0)>>2],pr=0|i[bt+4>>2],St=0|i[(Mt=bt=lt+48|0)>>2],Kt=0|i[Mt+4>>2],Mt=0|B(0|ur,0|pr,18,0),gt=l,ar=0|G(0|St,0|Kt,0|ur,0|pr),pr=0|G(0|ar,0|l,0|Mt,0|gt),i[(gt=bt)>>2]=pr,i[gt+4>>2]=l,pr=0|i[(gt=lt+120|0)>>2],bt=0|i[gt+4>>2],ar=0|i[(Mt=gt=lt+40|0)>>2],ur=0|i[Mt+4>>2],Mt=0|B(0|pr,0|bt,18,0),Kt=l,St=0|G(0|ar,0|ur,0|pr,0|bt),bt=0|G(0|St,0|l,0|Mt,0|Kt),i[(Kt=gt)>>2]=bt,i[Kt+4>>2]=l,bt=0|i[(Kt=lt+112|0)>>2],gt=0|i[Kt+4>>2],St=0|i[(Mt=Kt=lt+32|0)>>2],pr=0|i[Mt+4>>2],Mt=0|B(0|bt,0|gt,18,0),ur=l,ar=0|G(0|St,0|pr,0|bt,0|gt),gt=0|G(0|ar,0|l,0|Mt,0|ur),i[(ur=Kt)>>2]=gt,i[ur+4>>2]=l,gt=0|i[(ur=lt+104|0)>>2],Kt=0|i[ur+4>>2],ar=0|i[(Mt=ur=lt+24|0)>>2],bt=0|i[Mt+4>>2],Mt=0|B(0|gt,0|Kt,18,0),pr=l,St=0|G(0|ar,0|bt,0|gt,0|Kt),Kt=0|G(0|St,0|l,0|Mt,0|pr),i[(pr=ur)>>2]=Kt,i[pr+4>>2]=l,Kt=0|i[(pr=lt+96|0)>>2],ur=0|i[pr+4>>2],St=0|i[(Mt=pr=lt+16|0)>>2],gt=0|i[Mt+4>>2],Mt=0|B(0|Kt,0|ur,18,0),bt=l,ar=0|G(0|St,0|gt,0|Kt,0|ur),ur=0|G(0|ar,0|l,0|Mt,0|bt),i[(bt=pr)>>2]=ur,i[bt+4>>2]=l,ur=0|i[(bt=lt+88|0)>>2],pr=0|i[bt+4>>2],ar=0|i[(Mt=bt=lt+8|0)>>2],Kt=0|i[Mt+4>>2],Mt=0|B(0|ur,0|pr,18,0),gt=l,St=0|G(0|ar,0|Kt,0|ur,0|pr),pr=0|G(0|St,0|l,0|Mt,0|gt),i[(gt=bt)>>2]=pr,i[gt+4>>2]=l,Mt=0|i[(pr=gt=lt+80|0)>>2],St=0|i[pr+4>>2],ur=0|i[(pr=lt)>>2],Kt=0|i[pr+4>>2],pr=0|B(0|Mt,0|St,18,0),ar=l,vt=0|G(0|ur,0|Kt,0|Mt,0|St),St=0|G(0|vt,0|l,0|pr,0|ar),ar=l,i[(pr=lt)>>2]=St,i[pr+4>>2]=ar,i[(pr=gt)>>2]=0,i[pr+4>>2]=0,pr=ar,ar=St,St=0;do{ur=0|k(0|ar,0|pr,0|(Kt=0|x(0|(Mt=0|L(0|(vt=0|G(pr>>31>>>6|0,0,0|ar,0|pr)),0|l,26)),0|(vt=l),26)),0|l),i[(Kt=lt+(St<<3)|0)>>2]=ur,i[Kt+4>>2]=l,lr=0|k(0|(Bt=0|G(0|Mt,0|vt,0|i[(ur=Kt=lt+((1|St)<<3)|0)>>2],0|i[ur+4>>2])),0|(ur=l),0|(Pt=0|x(0|(Mt=0|L(0|(vt=0|G(ur>>31>>>7|0,0,0|Bt,0|ur)),0|l,25)),0|(vt=l),25)),0|l),i[(Pt=Kt)>>2]=lr,i[Pt+4>>2]=l,ar=0|G(0|Mt,0|vt,0|i[(lr=Pt=lt+((St=St+2|0)<<3)|0)>>2],0|i[lr+4>>2]),pr=l,i[(lr=Pt)>>2]=ar,i[lr+4>>2]=pr}while(St>>>0<10);pr=0|i[(St=gt)>>2],ar=0|i[St+4>>2],lr=0|i[(St=lt)>>2],Pt=0|i[St+4>>2],St=0|B(0|pr,0|ar,18,0),vt=l,Mt=0|G(0|lr,0|Pt,0|pr,0|ar),ar=0|G(0|Mt,0|l,0|St,0|vt),vt=l,i[(St=gt)>>2]=0,i[St+4>>2]=0,Pt=0|k(0|ar,0|vt,0|(pr=0|x(0|(Mt=0|L(0|(St=0|G(vt>>31>>>6|0,0,0|ar,0|vt)),0|l,26)),0|(St=l),26)),0|l),i[(pr=lt)>>2]=Pt,i[pr+4>>2]=l,Pt=0|G(0|Mt,0|St,0|i[(pr=bt)>>2],0|i[pr+4>>2]),i[(pr=bt)>>2]=Pt,i[pr+4>>2]=l,Mt=0|k(0|(Pt=0|i[(pr=be)>>2]),0|(St=0|i[pr+4>>2]),0|i[(pr=Pe)>>2],0|i[pr+4>>2]),pr=l,i[(vt=Pe)>>2]=Mt,i[vt+4>>2]=pr,Kt=0|k(0|(ar=0|i[(vt=J)>>2]),0|(lr=0|i[vt+4>>2]),0|i[(vt=Q)>>2],0|i[vt+4>>2]),vt=l,i[(ur=Q)>>2]=Kt,i[ur+4>>2]=vt,Vt=0|k(0|(Bt=0|i[(ur=X)>>2]),0|(ir=0|i[ur+4>>2]),0|i[(ur=Z)>>2],0|i[ur+4>>2]),ur=l,i[(Gt=Z)>>2]=Vt,i[Gt+4>>2]=ur,Jt=0|k(0|(kt=0|i[(Gt=ee)>>2]),0|(Lt=0|i[Gt+4>>2]),0|i[(Gt=te)>>2],0|i[Gt+4>>2]),Gt=l,i[(qt=te)>>2]=Jt,i[qt+4>>2]=Gt,wt=0|k(0|(sr=0|i[(qt=re)>>2]),0|(zt=0|i[qt+4>>2]),0|i[(qt=ne)>>2],0|i[qt+4>>2]),qt=l,i[(Ft=ne)>>2]=wt,i[Ft+4>>2]=qt,or=0|k(0|($t=0|i[(Ft=ie)>>2]),0|(rr=0|i[Ft+4>>2]),0|i[(Ft=ae)>>2],0|i[Ft+4>>2]),Ft=l,i[(Tt=ae)>>2]=or,i[Tt+4>>2]=Ft,yt=0|k(0|(Ct=0|i[(Tt=se)>>2]),0|(ft=0|i[Tt+4>>2]),0|i[(Tt=oe)>>2],0|i[Tt+4>>2]),Tt=l,i[(tr=oe)>>2]=yt,i[tr+4>>2]=Tt,Rt=0|k(0|(Yt=0|i[(tr=le)>>2]),0|(It=0|i[tr+4>>2]),0|i[(tr=ce)>>2],0|i[tr+4>>2]),tr=l,i[(nr=ce)>>2]=Rt,i[nr+4>>2]=tr,_t=0|k(0|(Ut=0|i[(nr=de)>>2]),0|(Ht=0|i[nr+4>>2]),0|i[(nr=ue)>>2],0|i[nr+4>>2]),nr=l,i[(Zt=ue)>>2]=_t,i[Zt+4>>2]=nr,Nt=0|k(0|(Qt=0|i[(Zt=pe)>>2]),0|(mt=0|i[Zt+4>>2]),0|i[(Zt=he)>>2],0|i[Zt+4>>2]),Zt=l,i[(Xt=he)>>2]=Nt,i[Xt+4>>2]=Zt,t=(Ye=fe)+72|0;do{i[Ye>>2]=0,Ye=Ye+4|0}while((0|Ye)<(0|t));bt=0|B(0|Mt,0|pr,121665,0),gt=l,i[(Xt=Ce)>>2]=bt,i[Xt+4>>2]=gt,Xt=0|B(0|Kt,0|vt,121665,0),i[(Et=_e)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|Vt,0|ur,121665,0),i[(Xt=me)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Jt,0|Gt,121665,0),i[(Et=ge)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|wt,0|qt,121665,0),i[(Xt=ye)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|or,0|Ft,121665,0),i[(Et=Ee)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|yt,0|Tt,121665,0),i[(Xt=Se)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Rt,0|tr,121665,0),i[(Et=ve)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|_t,0|nr,121665,0),i[(Xt=Te)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Nt,0|Zt,121665,0),i[(Et=Ae)>>2]=Xt,i[Et+4>>2]=l,i[(Et=fe)>>2]=0,i[Et+4>>2]=0,Et=gt,gt=bt,bt=0;do{xt=0|k(0|gt,0|Et,0|(Wt=0|x(0|(jt=0|L(0|(Xt=0|G(Et>>31>>>6|0,0,0|gt,0|Et)),0|l,26)),0|(Xt=l),26)),0|l),i[(Wt=Ce+(bt<<3)|0)>>2]=xt,i[Wt+4>>2]=l,cr=0|k(0|(Ot=0|G(0|jt,0|Xt,0|i[(xt=Wt=Ce+((1|bt)<<3)|0)>>2],0|i[xt+4>>2])),0|(xt=l),0|(dr=0|x(0|(jt=0|L(0|(Xt=0|G(xt>>31>>>7|0,0,0|Ot,0|xt)),0|l,25)),0|(Xt=l),25)),0|l),i[(dr=Wt)>>2]=cr,i[dr+4>>2]=l,gt=0|G(0|jt,0|Xt,0|i[(cr=dr=Ce+((bt=bt+2|0)<<3)|0)>>2],0|i[cr+4>>2]),Et=l,i[(cr=dr)>>2]=gt,i[cr+4>>2]=Et}while(bt>>>0<10);Et=0|i[(bt=fe)>>2],gt=0|i[bt+4>>2],Zt=0|i[(bt=Ce)>>2],Nt=0|i[bt+4>>2],bt=0|B(0|Et,0|gt,18,0),nr=l,_t=0|G(0|Zt,0|Nt,0|Et,0|gt),gt=0|G(0|_t,0|l,0|bt,0|nr),nr=l,i[(bt=fe)>>2]=0,i[bt+4>>2]=0,Et=0|x(0|(_t=0|L(0|(bt=0|G(nr>>31>>>6|0,0,0|gt,0|nr)),0|l,26)),0|(bt=l),26),Nt=l,tr=0|i[(Zt=_e)>>2],Rt=0|i[Zt+4>>2],nr=0|k(0|(Zt=0|G(0|gt,0|nr,0|Pt,0|St)),0|l,0|Et,0|Nt),i[(Nt=Ce)>>2]=nr,i[Nt+4>>2]=l,Nt=0|G(0|tr,0|Rt,0|ar,0|lr),Rt=0|G(0|Nt,0|l,0|_t,0|bt),i[(bt=_e)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=me)>>2],0|i[bt+4>>2],0|Bt,0|ir),i[(bt=me)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ge)>>2],0|i[bt+4>>2],0|kt,0|Lt),i[(bt=ge)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ye)>>2],0|i[bt+4>>2],0|sr,0|zt),i[(bt=ye)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Ee)>>2],0|i[bt+4>>2],0|$t,0|rr),i[(bt=Ee)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Se)>>2],0|i[bt+4>>2],0|Ct,0|ft),i[(bt=Se)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ve)>>2],0|i[bt+4>>2],0|Yt,0|It),i[(bt=ve)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Te)>>2],0|i[bt+4>>2],0|Ut,0|Ht),i[(bt=Te)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Ae)>>2],0|i[bt+4>>2],0|Qt,0|mt),i[(bt=Ae)>>2]=Rt,i[bt+4>>2]=l,P(dt,Pe,Ce),Rt=0|i[(bt=dt+144|0)>>2],_t=0|i[bt+4>>2],tr=0|i[(Nt=bt=dt+64|0)>>2],nr=0|i[Nt+4>>2],Nt=0|B(0|Rt,0|_t,18,0),Et=l,Zt=0|G(0|tr,0|nr,0|Rt,0|_t),_t=0|G(0|Zt,0|l,0|Nt,0|Et),i[(Et=bt)>>2]=_t,i[Et+4>>2]=l,_t=0|i[(Et=dt+136|0)>>2],bt=0|i[Et+4>>2],Zt=0|i[(Nt=Et=dt+56|0)>>2],Rt=0|i[Nt+4>>2],Nt=0|B(0|_t,0|bt,18,0),nr=l,tr=0|G(0|Zt,0|Rt,0|_t,0|bt),bt=0|G(0|tr,0|l,0|Nt,0|nr),i[(nr=Et)>>2]=bt,i[nr+4>>2]=l,bt=0|i[(nr=dt+128|0)>>2],Et=0|i[nr+4>>2],tr=0|i[(Nt=nr=dt+48|0)>>2],_t=0|i[Nt+4>>2],Nt=0|B(0|bt,0|Et,18,0),Rt=l,Zt=0|G(0|tr,0|_t,0|bt,0|Et),Et=0|G(0|Zt,0|l,0|Nt,0|Rt),i[(Rt=nr)>>2]=Et,i[Rt+4>>2]=l,Et=0|i[(Rt=dt+120|0)>>2],nr=0|i[Rt+4>>2],Zt=0|i[(Nt=Rt=dt+40|0)>>2],bt=0|i[Nt+4>>2],Nt=0|B(0|Et,0|nr,18,0),_t=l,tr=0|G(0|Zt,0|bt,0|Et,0|nr),nr=0|G(0|tr,0|l,0|Nt,0|_t),i[(_t=Rt)>>2]=nr,i[_t+4>>2]=l,nr=0|i[(_t=dt+112|0)>>2],Rt=0|i[_t+4>>2],tr=0|i[(Nt=_t=dt+32|0)>>2],Et=0|i[Nt+4>>2],Nt=0|B(0|nr,0|Rt,18,0),bt=l,Zt=0|G(0|tr,0|Et,0|nr,0|Rt),Rt=0|G(0|Zt,0|l,0|Nt,0|bt),i[(bt=_t)>>2]=Rt,i[bt+4>>2]=l,Rt=0|i[(bt=dt+104|0)>>2],_t=0|i[bt+4>>2],Zt=0|i[(Nt=bt=dt+24|0)>>2],nr=0|i[Nt+4>>2],Nt=0|B(0|Rt,0|_t,18,0),Et=l,tr=0|G(0|Zt,0|nr,0|Rt,0|_t),_t=0|G(0|tr,0|l,0|Nt,0|Et),i[(Et=bt)>>2]=_t,i[Et+4>>2]=l,_t=0|i[(Et=dt+96|0)>>2],bt=0|i[Et+4>>2],tr=0|i[(Nt=Et=dt+16|0)>>2],Rt=0|i[Nt+4>>2],Nt=0|B(0|_t,0|bt,18,0),nr=l,Zt=0|G(0|tr,0|Rt,0|_t,0|bt),bt=0|G(0|Zt,0|l,0|Nt,0|nr),i[(nr=Et)>>2]=bt,i[nr+4>>2]=l,bt=0|i[(nr=dt+88|0)>>2],Et=0|i[nr+4>>2],Zt=0|i[(Nt=nr=dt+8|0)>>2],_t=0|i[Nt+4>>2],Nt=0|B(0|bt,0|Et,18,0),Rt=l,tr=0|G(0|Zt,0|_t,0|bt,0|Et),Et=0|G(0|tr,0|l,0|Nt,0|Rt),i[(Rt=nr)>>2]=Et,i[Rt+4>>2]=l,Nt=0|i[(Et=Rt=dt+80|0)>>2],tr=0|i[Et+4>>2],bt=0|i[(Et=dt)>>2],_t=0|i[Et+4>>2],Et=0|B(0|Nt,0|tr,18,0),Zt=l,gt=0|G(0|bt,0|_t,0|Nt,0|tr),tr=0|G(0|gt,0|l,0|Et,0|Zt),Zt=l,i[(Et=dt)>>2]=tr,i[Et+4>>2]=Zt,i[(Et=Rt)>>2]=0,i[Et+4>>2]=0,Et=Zt,Zt=tr,tr=0;do{bt=0|k(0|Zt,0|Et,0|(_t=0|x(0|(Nt=0|L(0|(gt=0|G(Et>>31>>>6|0,0,0|Zt,0|Et)),0|l,26)),0|(gt=l),26)),0|l),i[(_t=dt+(tr<<3)|0)>>2]=bt,i[_t+4>>2]=l,Ft=0|k(0|(Tt=0|G(0|Nt,0|gt,0|i[(bt=_t=dt+((1|tr)<<3)|0)>>2],0|i[bt+4>>2])),0|(bt=l),0|(yt=0|x(0|(Nt=0|L(0|(gt=0|G(bt>>31>>>7|0,0,0|Tt,0|bt)),0|l,25)),0|(gt=l),25)),0|l),i[(yt=_t)>>2]=Ft,i[yt+4>>2]=l,Zt=0|G(0|Nt,0|gt,0|i[(Ft=yt=dt+((tr=tr+2|0)<<3)|0)>>2],0|i[Ft+4>>2]),Et=l,i[(Ft=yt)>>2]=Zt,i[Ft+4>>2]=Et}while(tr>>>0<10);Et=0|i[(tr=Rt)>>2],Zt=0|i[tr+4>>2],mt=0|i[(tr=dt)>>2],Qt=0|i[tr+4>>2],tr=0|B(0|Et,0|Zt,18,0),Ht=l,Ut=0|G(0|mt,0|Qt,0|Et,0|Zt),Zt=0|G(0|Ut,0|l,0|tr,0|Ht),Ht=l,i[(tr=Rt)>>2]=0,i[tr+4>>2]=0,Qt=0|k(0|Zt,0|Ht,0|(Et=0|x(0|(Ut=0|L(0|(tr=0|G(Ht>>31>>>6|0,0,0|Zt,0|Ht)),0|l,26)),0|(tr=l),26)),0|l),i[(Et=dt)>>2]=Qt,i[Et+4>>2]=l,Qt=0|G(0|Ut,0|tr,0|i[(Et=nr)>>2],0|i[Et+4>>2]),i[(Et=nr)>>2]=Qt,i[Et+4>>2]=l,Et=0;do{Ut=0|i[(tr=Qt=lt+(Et<<3)|0)>>2],Ht=0|i[tr+4>>2],mt=0|i[(Zt=tr=it+(Et<<3)|0)>>2],Yt=((It=0|i[Zt+4>>2])^Ht)&ht,Ht=0|L(0,(Zt=(mt^Ut)&pt)^Ut|0,32),i[(Ut=Qt)>>2]=Ht,i[Ut+4>>2]=l,Ut=0|L(0,Zt^mt|0,32),i[(mt=tr)>>2]=Ut,i[mt+4>>2]=l,Et=Et+1|0}while(10!=(0|Et));hr=0;do{Rt=0|i[(nr=Et=dt+(hr<<3)|0)>>2],mt=0|i[nr+4>>2],tr=0|i[(Ut=nr=st+(hr<<3)|0)>>2],Ht=((Zt=0|i[Ut+4>>2])^mt)&ht,mt=0|L(0,(Ut=(tr^Rt)&pt)^Rt|0,32),i[(Rt=Et)>>2]=mt,i[Rt+4>>2]=l,Rt=0|L(0,Ut^tr|0,32),i[(tr=nr)>>2]=Rt,i[tr+4>>2]=l,hr=hr+1|0}while(10!=(0|hr));if(8==(0|(rt=rt+1|0))){fr=nt,_r=it,mr=at,gr=st,yr=ot,Er=lt,Sr=ct,vr=dt;break}ht=dt,pt=lt,tr=st,Rt=it,Fe=ut<<1&255,dt=ct,ct=ht,lt=ot,ot=pt,st=at,at=tr,it=nt,nt=Rt}if(32==(0|(nt=Qe+1|0))){Tr=Er,Ar=vr;break}Qe=nt,Xe=_r,Ze=fr,ke=gr,et=mr,Ge=Er,tt=yr,Ue=vr,Le=Sr}je=Tr,t=(Ye=xe)+80|0;do{i[Ye>>2]=i[je>>2],Ye=Ye+4|0,je=je+4|0}while((0|Ye)<(0|t));je=Ar,t=(Ye=Be)+80|0;do{i[Ye>>2]=i[je>>2],Ye=Ye+4|0,je=je+4|0}while((0|Ye)<(0|t));M(Ce,Be),M(Ne,Ce),M(De,Ne),b(be,De,Be),b(Pe,be,Ce),M(De,Pe),b(Me,De,be),M(De,Me),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),b(Oe,De,Me),M(De,Oe),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(Ie,Ne,Oe),M(De,Ie),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(De,Ne,Ie),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),b(we,De,Oe),M(De,we),M(Ne,De),Oe=2;do{M(De,Ne),M(Ne,De),Oe=Oe+2|0}while((0|Oe)<50);b(Re,Ne,we),M(Ne,Re),M(De,Ne),Oe=2;do{M(Ne,De),M(De,Ne),Oe=Oe+2|0}while((0|Oe)<100);b(Ne,De,Re),M(De,Ne),M(Ne,De),Re=2;do{M(De,Ne),M(Ne,De),Re=Re+2|0}while((0|Re)<50);for(b(De,Ne,we),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(Ke,Ne,Pe),b(Be,xe,Ke),Ke=0|i[Be>>2],i[Ce>>2]=Ke,i[(xe=Ce+4|0)>>2]=i[Be+8>>2],i[(Pe=Ce+8|0)>>2]=i[Be+16>>2],i[(Ne=Ce+12|0)>>2]=i[Be+24>>2],i[(De=Ce+16|0)>>2]=i[Be+32>>2],i[(we=Ce+20|0)>>2]=i[Be+40>>2],i[(Re=Ce+24|0)>>2]=i[Be+48>>2],i[(Oe=Ce+28|0)>>2]=i[Be+56>>2],i[(Ie=Ce+32|0)>>2]=i[Be+64>>2],i[(Me=Ce+36|0)>>2]=i[Be+72>>2],Be=Ke,Ke=0;be=Ce+(Ke<<2)|0,je=Be>>31&Be,1&Ke?(t=je>>25,i[be>>2]=(0|c(t,-33554432))+Be,Tr=(0|i[(je=Ce+((be=Ke+1|0)<<2)|0)>>2])+t|0,i[je>>2]=Tr,Cr=Tr,br=be):(Ye=je>>26,i[be>>2]=(0|c(Ye,-67108864))+Be,Tr=(0|i[(Ar=Ce+((t=Ke+1|0)<<2)|0)>>2])+Ye|0,i[Ar>>2]=Tr,Cr=Tr,br=t),9!=(0|br);)Be=Cr,Ke=br;for(Ke=((br=0|i[Me>>2])>>31&br)>>25,i[Me>>2]=(0|c(Ke,-33554432))+br,br=(19*Ke|0)+(0|i[Ce>>2])|0,i[Ce>>2]=br,Ke=br,br=0;Cr=Ce+(br<<2)|0,Be=Ke>>31&Ke,1&br?(t=Be>>25,i[Cr>>2]=(0|c(t,-33554432))+Ke,Tr=(0|i[(Be=Ce+((Cr=br+1|0)<<2)|0)>>2])+t|0,i[Be>>2]=Tr,Pr=Cr,Mr=Tr):(be=Be>>26,i[Cr>>2]=(0|c(be,-67108864))+Ke,t=(0|i[(je=Ce+((Tr=br+1|0)<<2)|0)>>2])+be|0,i[je>>2]=t,Pr=Tr,Mr=t),9!=(0|Pr);)Ke=Mr,br=Pr;for(br=((Pr=0|i[Me>>2])>>31&Pr)>>25,i[Me>>2]=(0|c(br,-33554432))+Pr,Pr=(19*br|0)+(0|i[Ce>>2])|0,Mr=(0|c(br=(Pr>>31&Pr)>>26,-67108864))+Pr|0,i[Ce>>2]=Mr,i[xe>>2]=br+(0|i[xe>>2]),br=Mr,Mr=0;Pr=Ce+(Mr<<2)|0,1&Mr?(i[Pr>>2]=33554431&br,Ke=(0|i[(Cr=Ce+((Pr=Mr+1|0)<<2)|0)>>2])+(br>>25)|0,i[Cr>>2]=Ke,Or=Pr,Ir=Ke):(i[Pr>>2]=67108863&br,Cr=(0|i[(Tr=Ce+((Ke=Mr+1|0)<<2)|0)>>2])+(br>>26)|0,i[Tr>>2]=Cr,Or=Ke,Ir=Cr),9!=(0|Or);)br=Ir,Mr=Or;for(Or=0|i[Me>>2],i[Me>>2]=33554431&Or,Mr=(19*(Or>>25)|0)+(0|i[Ce>>2])|0,i[Ce>>2]=Mr,Or=Mr,Mr=0;Ir=Ce+(Mr<<2)|0,1&Mr?(i[Ir>>2]=33554431&Or,br=(0|i[(Pr=Ce+((Ir=Mr+1|0)<<2)|0)>>2])+(Or>>25)|0,i[Pr>>2]=br,wr=Ir,Rr=br):(i[Ir>>2]=67108863&Or,Pr=(0|i[(Ke=Ce+((br=Mr+1|0)<<2)|0)>>2])+(Or>>26)|0,i[Ke>>2]=Pr,wr=br,Rr=Pr),9!=(0|wr);)Or=Rr,Mr=wr;for(Mr=33554431&(wr=0|i[Me>>2]),i[Me>>2]=Mr,Rr=(19*(wr>>25)|0)+(0|i[Ce>>2])|0,i[Ce>>2]=Rr,wr=1,Or=~(Rr+-67108845>>31);;){if(br=0|i[Ce+(wr<<2)>>2],Dr=1&wr?(br=(Pr=(br=(Pr=br<<16&(-33554432^br))<<8&Pr)<<4&br)<<2&Pr)<<1&br:(Pr=(Ir=(Pr=(Ir=br<<16&(-67108864^br))<<8&Ir)<<4&Pr)<<2&Ir)<<1&Pr,br=Dr>>31&Or,10==(0|(wr=wr+1|0))){Nr=br;break}Or=br}return Or=Rr-(67108845&Nr)|0,i[Ce>>2]=Or,Ce=67108863&Nr,Rr=33554431&Nr,Dr=(wr=(0|i[xe>>2])-Rr|0)<<2,Pr=(br=(0|i[Pe>>2])-Ce|0)<<3,Ke=(Ir=(0|i[Ne>>2])-Rr|0)<<5,Nr=(Cr=(0|i[De>>2])-Nr|0)<<6,Tr=(0|i[we>>2])-Rr|0,i[we>>2]=Tr,Be=(we=(0|i[Re>>2])-Ce|0)<<1,je=(t=(0|i[Oe>>2])-Rr|0)<<3,be=(0|i[Ie>>2])-Ce<<4,i[xe>>2]=Dr,i[Pe>>2]=Pr,i[Ne>>2]=Ke,i[De>>2]=Nr,i[Re>>2]=Be,i[Oe>>2]=je,i[Ie>>2]=be,i[Me>>2]=Mr-Rr<<6,n[e>>0]=Or,n[e+1>>0]=Or>>>8,n[e+2>>0]=Or>>>16,n[e+3>>0]=Dr|Or>>>24,n[e+4>>0]=wr>>>6,n[e+5>>0]=wr>>>14,n[e+6>>0]=Pr|wr>>>22,n[e+7>>0]=br>>>5,n[e+8>>0]=br>>>13,n[e+9>>0]=Ke|br>>>21,n[e+10>>0]=Ir>>>3,n[e+11>>0]=Ir>>>11,n[e+12>>0]=Nr|Ir>>>19,n[e+13>>0]=Cr>>>2,n[e+14>>0]=Cr>>>10,n[e+15>>0]=Cr>>>18,n[e+16>>0]=Tr,n[e+17>>0]=Tr>>>8,n[e+18>>0]=Tr>>>16,n[e+19>>0]=Tr>>>24|Be,n[e+20>>0]=we>>>7,n[e+21>>0]=we>>>15,n[e+22>>0]=we>>>23|je,n[e+23>>0]=t>>>5,n[e+24>>0]=t>>>13,je=0|i[Ie>>2],n[e+25>>0]=t>>>21|je,n[e+26>>0]=je>>>8,n[e+27>>0]=je>>>16,t=0|i[Me>>2],n[e+28>>0]=je>>>24|t,n[e+29>>0]=t>>>8,n[e+30>>0]=t>>>16,n[e+31>>0]=t>>>24,s=o,0},_free:function(e){var t,r,n=0,a=0,s=0,o=0,l=0,c=0,d=0,u=0,p=0,h=0,f=0,m=0,g=0,y=0,E=0,S=0,v=0,T=0,A=0,C=0,b=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,N=0,L=0,k=0,G=0,U=0,F=0;if(e|=0){(n=e+-8|0)>>>0<(a=0|i[47])>>>0&&_(),1==(0|(e=3&(t=0|i[e+-4>>2])))&&_(),r=n+(s=-8&t)|0;do{if(1&t)p=n,h=s;else{if(o=0|i[n>>2],!e)return;if(c=o+s|0,(l=n+(0-o)|0)>>>0<a>>>0&&_(),(0|l)==(0|i[48])){if(3!=(3&(u=0|i[(d=r+4|0)>>2])|0)){p=l,h=c;break}return i[45]=c,i[d>>2]=-2&u,i[l+4>>2]=1|c,void(i[l+c>>2]=c)}if(u=o>>>3,o>>>0<256){if(o=0|i[l+8>>2],d=0|i[l+12>>2],(0|o)!=(0|(f=212+(u<<1<<2)|0))&&(o>>>0<a>>>0&&_(),(0|i[o+12>>2])!=(0|l)&&_()),(0|d)==(0|o)){i[43]=i[43]&~(1<<u),p=l,h=c;break}(0|d)!=(0|f)?(d>>>0<a>>>0&&_(),(0|i[(f=d+8|0)>>2])==(0|l)?m=f:_()):m=d+8|0,i[o+12>>2]=d,i[m>>2]=o,p=l,h=c;break}o=0|i[l+24>>2],d=0|i[l+12>>2];do{if((0|d)==(0|l)){if(g=0|i[(u=(f=l+16|0)+4|0)>>2])S=g,v=u;else{if(!(y=0|i[f>>2])){E=0;break}S=y,v=f}for(;;)if(g=0|i[(u=S+20|0)>>2])S=g,v=u;else{if(!(g=0|i[(u=S+16|0)>>2])){T=S,A=v;break}S=g,v=u}if(!(A>>>0<a>>>0)){i[A>>2]=0,E=T;break}_()}else{if((u=0|i[l+8>>2])>>>0<a>>>0&&_(),(0|i[(g=u+12|0)>>2])!=(0|l)&&_(),(0|i[(f=d+8|0)>>2])==(0|l)){i[g>>2]=d,i[f>>2]=u,E=d;break}_()}}while(0);if(o){if(d=0|i[l+28>>2],(0|l)==(0|i[(u=476+(d<<2)|0)>>2])){if(i[u>>2]=E,!E){i[44]=i[44]&~(1<<d),p=l,h=c;break}}else if(o>>>0<(0|i[47])>>>0&&_(),(0|i[(d=o+16|0)>>2])==(0|l)?i[d>>2]=E:i[o+20>>2]=E,!E){p=l,h=c;break}E>>>0<(d=0|i[47])>>>0&&_(),i[E+24>>2]=o,f=0|i[(u=l+16|0)>>2];do{if(f){if(!(f>>>0<d>>>0)){i[E+16>>2]=f,i[f+24>>2]=E;break}_()}}while(0);if(f=0|i[u+4>>2]){if(!(f>>>0<(0|i[47])>>>0)){i[E+20>>2]=f,i[f+24>>2]=E,p=l,h=c;break}_()}else p=l,h=c}else p=l,h=c}}while(0);if(p>>>0>=r>>>0&&_(),1&(n=0|i[(s=r+4|0)>>2])||_(),2&n)i[s>>2]=-2&n,i[p+4>>2]=1|h,i[p+h>>2]=h,w=h;else{if((0|r)==(0|i[49])){if(E=(0|i[46])+h|0,i[46]=E,i[49]=p,i[p+4>>2]=1|E,(0|p)!=(0|i[48]))return;return i[48]=0,void(i[45]=0)}if((0|r)==(0|i[48]))return E=(0|i[45])+h|0,i[45]=E,i[48]=p,i[p+4>>2]=1|E,void(i[p+E>>2]=E);E=(-8&n)+h|0,a=n>>>3;do{if(n>>>0>=256){T=0|i[r+24>>2],A=0|i[r+12>>2];do{if((0|A)==(0|r)){if(m=0|i[(S=(v=r+16|0)+4|0)>>2])b=m,P=S;else{if(!(e=0|i[v>>2])){C=0;break}b=e,P=v}for(;;)if(m=0|i[(S=b+20|0)>>2])b=m,P=S;else{if(!(m=0|i[(S=b+16|0)>>2])){M=b,O=P;break}b=m,P=S}if(!(O>>>0<(0|i[47])>>>0)){i[O>>2]=0,C=M;break}_()}else{if((S=0|i[r+8>>2])>>>0<(0|i[47])>>>0&&_(),(0|i[(m=S+12|0)>>2])!=(0|r)&&_(),(0|i[(v=A+8|0)>>2])==(0|r)){i[m>>2]=A,i[v>>2]=S,C=A;break}_()}}while(0);if(T){if(A=0|i[r+28>>2],(0|r)==(0|i[(c=476+(A<<2)|0)>>2])){if(i[c>>2]=C,!C){i[44]=i[44]&~(1<<A);break}}else if(T>>>0<(0|i[47])>>>0&&_(),(0|i[(A=T+16|0)>>2])==(0|r)?i[A>>2]=C:i[T+20>>2]=C,!C)break;C>>>0<(A=0|i[47])>>>0&&_(),i[C+24>>2]=T,l=0|i[(c=r+16|0)>>2];do{if(l){if(!(l>>>0<A>>>0)){i[C+16>>2]=l,i[l+24>>2]=C;break}_()}}while(0);if(l=0|i[c+4>>2]){if(!(l>>>0<(0|i[47])>>>0)){i[C+20>>2]=l,i[l+24>>2]=C;break}_()}}}else{if(l=0|i[r+8>>2],A=0|i[r+12>>2],(0|l)!=(0|(T=212+(a<<1<<2)|0))&&(l>>>0<(0|i[47])>>>0&&_(),(0|i[l+12>>2])!=(0|r)&&_()),(0|A)==(0|l)){i[43]=i[43]&~(1<<a);break}(0|A)!=(0|T)?(A>>>0<(0|i[47])>>>0&&_(),(0|i[(T=A+8|0)>>2])==(0|r)?I=T:_()):I=A+8|0,i[l+12>>2]=A,i[I>>2]=l}}while(0);if(i[p+4>>2]=1|E,i[p+E>>2]=E,(0|p)==(0|i[48]))return void(i[45]=E);w=E}if(h=w>>>3,w>>>0<256)return n=212+(h<<1<<2)|0,(s=0|i[43])&(E=1<<h)?(I=0|i[(h=n+8|0)>>2])>>>0<(0|i[47])>>>0?_():(R=h,D=I):(i[43]=s|E,R=n+8|0,D=n),i[R>>2]=p,i[D+12>>2]=p,i[p+8>>2]=D,void(i[p+12>>2]=n);N=(n=w>>>8)?w>>>0>16777215?31:w>>>((s=14-((n=((R=n<<(D=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|D|(R=((E=R<<n)+245760|0)>>>16&2))+(E<<R>>>15)|0)+7|0)&1|s<<1:0,s=476+(N<<2)|0,i[p+28>>2]=N,i[p+20>>2]=0,i[p+16>>2]=0,R=0|i[44],E=1<<N;do{if(R&E){for(D=w<<(31==(0|N)?0:25-(N>>>1)|0),n=0|i[s>>2];;){if((-8&i[n+4>>2]|0)==(0|w)){L=n,k=130;break}if(!(h=0|i[(I=n+16+(D>>>31<<2)|0)>>2])){G=I,U=n,k=127;break}D<<=1,n=h}if(127==(0|k)){if(!(G>>>0<(0|i[47])>>>0)){i[G>>2]=p,i[p+24>>2]=U,i[p+12>>2]=p,i[p+8>>2]=p;break}_()}else if(130==(0|k)){if((D=0|i[(n=L+8|0)>>2])>>>0>=(c=0|i[47])>>>0&L>>>0>=c>>>0){i[D+12>>2]=p,i[n>>2]=p,i[p+8>>2]=D,i[p+12>>2]=L,i[p+24>>2]=0;break}_()}}else i[44]=R|E,i[s>>2]=p,i[p+24>>2]=s,i[p+12>>2]=p,i[p+8>>2]=p}while(0);if(p=(0|i[51])-1|0,i[51]=p,!p){for(F=628;p=0|i[F>>2];)F=p+8|0;i[51]=-1}}},_i64Add:G,_bitshift64Ashr:L,_i64Subtract:k,_memset:U,_malloc:function(e){e|=0;var t=0,r=0,n=0,a=0,s=0,o=0,l=0,c=0,d=0,u=0,p=0,h=0,f=0,y=0,E=0,S=0,v=0,T=0,C=0,b=0,P=0,M=0,I=0,w=0,R=0,D=0,N=0,L=0,k=0,G=0,U=0,F=0,x=0,B=0,K=0,Y=0,j=0,W=0,H=0,V=0,$=0,z=0,q=0,J=0,Q=0,X=0,Z=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,se=0,oe=0,le=0,ce=0,de=0,ue=0,pe=0,he=0,fe=0,_e=0,me=0,ge=0,ye=0,Ee=0,Se=0,ve=0,Te=0,Ae=0,Ce=0,be=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Ne=0,Le=0,ke=0,Ge=0,Ue=0,Fe=0,xe=0,Be=0,Ke=0,Ye=0;do{if(e>>>0<245){if(r=(t=e>>>0<11?16:e+11&-8)>>>3,3&(a=(n=0|i[43])>>>r)){c=0|i[(l=(o=212+((s=(1&a^1)+r|0)<<1<<2)|0)+8|0)>>2],u=0|i[(d=c+8|0)>>2];do{if((0|o)!=(0|u)){if(u>>>0<(0|i[47])>>>0&&_(),(0|i[(p=u+12|0)>>2])==(0|c)){i[p>>2]=o,i[l>>2]=u;break}_()}else i[43]=n&~(1<<s)}while(0);return u=s<<3,i[c+4>>2]=3|u,i[(l=c+u+4|0)>>2]=1|i[l>>2],0|d}if(t>>>0>(l=0|i[45])>>>0){if(a){h=0|i[(y=(f=212+((E=((u=(p=(u=((o=a<<r&((u=2<<r)|0-u))&0-o)-1|0)>>>(o=u>>>12&16))>>>5&8)|o|(p=(h=p>>>u)>>>2&4)|(h=(f=h>>>p)>>>1&2)|(f=(y=f>>>h)>>>1&1))+(y>>>f)|0)<<1<<2)|0)+8|0)>>2],o=0|i[(p=h+8|0)>>2];do{if((0|f)!=(0|o)){if(o>>>0<(0|i[47])>>>0&&_(),(0|i[(u=o+12|0)>>2])==(0|h)){i[u>>2]=f,i[y>>2]=o,S=0|i[45];break}_()}else i[43]=n&~(1<<E),S=l}while(0);return l=(E<<3)-t|0,i[h+4>>2]=3|t,i[(n=h+t|0)+4>>2]=1|l,i[n+l>>2]=l,S&&(o=0|i[48],f=212+((y=S>>>3)<<1<<2)|0,(r=0|i[43])&(a=1<<y)?(d=0|i[(y=f+8|0)>>2])>>>0<(0|i[47])>>>0?_():(v=y,T=d):(i[43]=r|a,v=f+8|0,T=f),i[v>>2]=o,i[T+12>>2]=o,i[o+8>>2]=T,i[o+12>>2]=f),i[45]=l,i[48]=n,0|p}if(n=0|i[44]){for(d=0|i[476+(((l=(f=(l=(n&0-n)-1|0)>>>(n=l>>>12&16))>>>5&8)|n|(f=(o=f>>>l)>>>2&4)|(o=(a=o>>>f)>>>1&2)|(a=(r=a>>>o)>>>1&1))+(r>>>a)<<2)>>2],a=(-8&i[d+4>>2])-t|0,r=d,o=d;;){if(d=0|i[r+16>>2])P=d;else{if(!(f=0|i[r+20>>2])){C=a,b=o;break}P=f}a=(f=(d=(-8&i[P+4>>2])-t|0)>>>0<a>>>0)?d:a,r=P,o=f?P:o}b>>>0<(o=0|i[47])>>>0&&_(),b>>>0>=(r=b+t|0)>>>0&&_(),a=0|i[b+24>>2],p=0|i[b+12>>2];do{if((0|p)==(0|b)){if(E=0|i[(h=b+20|0)>>2])I=E,w=h;else{if(!(d=0|i[(f=b+16|0)>>2])){M=0;break}I=d,w=f}for(;;)if(E=0|i[(h=I+20|0)>>2])I=E,w=h;else{if(!(E=0|i[(h=I+16|0)>>2])){R=I,D=w;break}I=E,w=h}if(!(D>>>0<o>>>0)){i[D>>2]=0,M=R;break}_()}else{if((h=0|i[b+8>>2])>>>0<o>>>0&&_(),(0|i[(E=h+12|0)>>2])!=(0|b)&&_(),(0|i[(f=p+8|0)>>2])==(0|b)){i[E>>2]=p,i[f>>2]=h,M=p;break}_()}}while(0);do{if(a){if(p=0|i[b+28>>2],(0|b)==(0|i[(o=476+(p<<2)|0)>>2])){if(i[o>>2]=M,!M){i[44]=i[44]&~(1<<p);break}}else if(a>>>0<(0|i[47])>>>0&&_(),(0|i[(p=a+16|0)>>2])==(0|b)?i[p>>2]=M:i[a+20>>2]=M,!M)break;M>>>0<(p=0|i[47])>>>0&&_(),i[M+24>>2]=a,o=0|i[b+16>>2];do{if(o){if(!(o>>>0<p>>>0)){i[M+16>>2]=o,i[o+24>>2]=M;break}_()}}while(0);if(o=0|i[b+20>>2]){if(!(o>>>0<(0|i[47])>>>0)){i[M+20>>2]=o,i[o+24>>2]=M;break}_()}}}while(0);return C>>>0<16?(a=C+t|0,i[b+4>>2]=3|a,i[(o=b+a+4|0)>>2]=1|i[o>>2]):(i[b+4>>2]=3|t,i[r+4>>2]=1|C,i[r+C>>2]=C,(o=0|i[45])&&(a=0|i[48],o=212+((p=o>>>3)<<1<<2)|0,(h=0|i[43])&(f=1<<p)?(E=0|i[(p=o+8|0)>>2])>>>0<(0|i[47])>>>0?_():(N=p,L=E):(i[43]=h|f,N=o+8|0,L=o),i[N>>2]=a,i[L+12>>2]=a,i[a+8>>2]=L,i[a+12>>2]=o),i[45]=C,i[48]=r),0|(b+8|0)}k=t}else k=t}else if(e>>>0<=4294967231)if(a=-8&(o=e+11|0),f=0|i[44]){h=0-a|0,G=(E=o>>>8)?a>>>0>16777215?31:a>>>((n=14-((E=((p=E<<(o=(E+1048320|0)>>>16&8))+520192|0)>>>16&4)|o|(p=((d=p<<E)+245760|0)>>>16&2))+(d<<p>>>15)|0)+7|0)&1|n<<1:0,n=0|i[476+(G<<2)>>2];e:do{if(n)for(p=h,d=0,o=a<<(31==(0|G)?0:25-(G>>>1)|0),E=n,l=0;;){if((c=(y=-8&i[E+4>>2])-a|0)>>>0<p>>>0){if((0|y)==(0|a)){K=c,Y=E,j=E,B=90;break e}W=c,H=E}else W=p,H=l;if(y=0==(0|(c=0|i[E+20>>2]))|(0|c)==(0|(E=0|i[E+16+(o>>>31<<2)>>2]))?d:c,c=0==(0|E)){U=W,F=y,x=H,B=86;break}p=W,d=y,o<<=1&c^1,l=H}else U=h,F=0,x=0,B=86}while(0);if(86==(0|B)){if(0==(0|F)&0==(0|x)){if(!(h=f&((n=2<<G)|0-n))){k=a;break}V=0|i[476+(((n=(t=(n=(h&0-h)-1|0)>>>(h=n>>>12&16))>>>5&8)|h|(t=(r=t>>>n)>>>2&4)|(r=(l=r>>>t)>>>1&2)|(l=(o=l>>>r)>>>1&1))+(o>>>l)<<2)>>2]}else V=F;V?(K=U,Y=V,j=x,B=90):($=U,z=x)}if(90==(0|B))for(;;)if(B=0,r=(o=(l=(-8&i[Y+4>>2])-a|0)>>>0<K>>>0)?l:K,l=o?Y:j,o=0|i[Y+16>>2])K=r,Y=o,j=l,B=90;else{if(!(Y=0|i[Y+20>>2])){$=r,z=l;break}K=r,j=l,B=90}if(0!=(0|z)&&$>>>0<((0|i[45])-a|0)>>>0){z>>>0<(f=0|i[47])>>>0&&_(),z>>>0>=(l=z+a|0)>>>0&&_(),r=0|i[z+24>>2],o=0|i[z+12>>2];do{if((0|o)==(0|z)){if(h=0|i[(t=z+20|0)>>2])J=h,Q=t;else{if(!(d=0|i[(n=z+16|0)>>2])){q=0;break}J=d,Q=n}for(;;)if(h=0|i[(t=J+20|0)>>2])J=h,Q=t;else{if(!(h=0|i[(t=J+16|0)>>2])){X=J,Z=Q;break}J=h,Q=t}if(!(Z>>>0<f>>>0)){i[Z>>2]=0,q=X;break}_()}else{if((t=0|i[z+8>>2])>>>0<f>>>0&&_(),(0|i[(h=t+12|0)>>2])!=(0|z)&&_(),(0|i[(n=o+8|0)>>2])==(0|z)){i[h>>2]=o,i[n>>2]=t,q=o;break}_()}}while(0);do{if(r){if(o=0|i[z+28>>2],(0|z)==(0|i[(f=476+(o<<2)|0)>>2])){if(i[f>>2]=q,!q){i[44]=i[44]&~(1<<o);break}}else if(r>>>0<(0|i[47])>>>0&&_(),(0|i[(o=r+16|0)>>2])==(0|z)?i[o>>2]=q:i[r+20>>2]=q,!q)break;q>>>0<(o=0|i[47])>>>0&&_(),i[q+24>>2]=r,f=0|i[z+16>>2];do{if(f){if(!(f>>>0<o>>>0)){i[q+16>>2]=f,i[f+24>>2]=q;break}_()}}while(0);if(f=0|i[z+20>>2]){if(!(f>>>0<(0|i[47])>>>0)){i[q+20>>2]=f,i[f+24>>2]=q;break}_()}}}while(0);do{if($>>>0>=16){if(i[z+4>>2]=3|a,i[l+4>>2]=1|$,i[l+$>>2]=$,r=$>>>3,$>>>0<256){f=212+(r<<1<<2)|0,(o=0|i[43])&(t=1<<r)?(n=0|i[(r=f+8|0)>>2])>>>0<(0|i[47])>>>0?_():(ee=r,te=n):(i[43]=o|t,ee=f+8|0,te=f),i[ee>>2]=l,i[te+12>>2]=l,i[l+8>>2]=te,i[l+12>>2]=f;break}if(re=(f=$>>>8)?$>>>0>16777215?31:$>>>((r=14-((f=((o=f<<(t=(f+1048320|0)>>>16&8))+520192|0)>>>16&4)|t|(o=((n=o<<f)+245760|0)>>>16&2))+(n<<o>>>15)|0)+7|0)&1|r<<1:0,r=476+(re<<2)|0,i[l+28>>2]=re,i[(o=l+16|0)+4>>2]=0,i[o>>2]=0,!((o=0|i[44])&(n=1<<re))){i[44]=o|n,i[r>>2]=l,i[l+24>>2]=r,i[l+12>>2]=l,i[l+8>>2]=l;break}for(n=$<<(31==(0|re)?0:25-(re>>>1)|0),o=0|i[r>>2];;){if((-8&i[o+4>>2]|0)==(0|$)){ne=o,B=148;break}if(!(t=0|i[(r=o+16+(n>>>31<<2)|0)>>2])){ie=r,ae=o,B=145;break}n<<=1,o=t}if(145==(0|B)){if(!(ie>>>0<(0|i[47])>>>0)){i[ie>>2]=l,i[l+24>>2]=ae,i[l+12>>2]=l,i[l+8>>2]=l;break}_()}else if(148==(0|B)){if((n=0|i[(o=ne+8|0)>>2])>>>0>=(t=0|i[47])>>>0&ne>>>0>=t>>>0){i[n+12>>2]=l,i[o>>2]=l,i[l+8>>2]=n,i[l+12>>2]=ne,i[l+24>>2]=0;break}_()}}else n=$+a|0,i[z+4>>2]=3|n,i[(o=z+n+4|0)>>2]=1|i[o>>2]}while(0);return 0|(z+8|0)}k=a}else k=a;else k=-1}while(0);if((z=0|i[45])>>>0>=k>>>0)return $=z-k|0,ne=0|i[48],$>>>0>15?(ae=ne+k|0,i[48]=ae,i[45]=$,i[ae+4>>2]=1|$,i[ae+$>>2]=$,i[ne+4>>2]=3|k):(i[45]=0,i[48]=0,i[ne+4>>2]=3|z,i[($=ne+z+4|0)>>2]=1|i[$>>2]),0|(ne+8|0);if((ne=0|i[46])>>>0>k>>>0)return $=ne-k|0,i[46]=$,z=(ne=0|i[49])+k|0,i[49]=z,i[z+4>>2]=1|$,i[ne+4>>2]=3|k,0|(ne+8|0);do{if(!(0|i[161])){if(!((ne=0|A(30))+-1&ne)){i[163]=ne,i[162]=ne,i[164]=-1,i[165]=-1,i[166]=0,i[154]=0,i[161]=-16&(0|g(0))^1431655768;break}_()}}while(0);if(ne=k+48|0,($=(ae=($=0|i[163])+(z=k+47|0)|0)&(ie=0-$|0))>>>0<=k>>>0)return 0|0;if(0!=(0|(re=0|i[153]))&&(ee=(te=0|i[151])+$|0)>>>0<=te>>>0|ee>>>0>re>>>0)return 0|0;e:do{if(4&i[154])B=190;else{re=0|i[49];t:do{if(re){for(ee=620;;){if((te=0|i[ee>>2])>>>0<=re>>>0&&(te+(0|i[(q=ee+4|0)>>2])|0)>>>0>re>>>0){se=ee,oe=q;break}if(!(ee=0|i[ee+8>>2])){B=173;break t}}if((ee=ae-(0|i[46])&ie)>>>0<2147483647)if((0|(q=0|m(0|ee)))==((0|i[se>>2])+(0|i[oe>>2])|0)){if(-1!=(0|q)){le=q,ce=ee,B=193;break e}}else de=q,ue=ee,B=183}else B=173}while(0);do{if(173==(0|B)&&-1!=(0|(re=0|m(0)))&&(a=re,pe=(q=(ee=0|i[162])+-1|0)&a?$-a+(q+a&0-ee)|0:$,a=(ee=0|i[151])+pe|0,pe>>>0>k>>>0&pe>>>0<2147483647)){if(0!=(0|(q=0|i[153]))&&a>>>0<=ee>>>0|a>>>0>q>>>0)break;if((0|(q=0|m(0|pe)))==(0|re)){le=re,ce=pe,B=193;break e}de=q,ue=pe,B=183}}while(0);t:do{if(183==(0|B)){q=0-ue|0;do{if(ne>>>0>ue>>>0&ue>>>0<2147483647&-1!=(0|de)&&(a=z-ue+(re=0|i[163])&0-re)>>>0<2147483647){if(-1==(0|m(0|a))){m(0|q);break t}he=a+ue|0;break}he=ue}while(0);if(-1!=(0|de)){le=de,ce=he,B=193;break e}}}while(0);i[154]=4|i[154],B=190}}while(0);if(190==(0|B)&&$>>>0<2147483647&&(he=0|m(0|$))>>>0<($=0|m(0))>>>0&-1!=(0|he)&-1!=(0|$)&&(de=$-he|0)>>>0>(k+40|0)>>>0&&(le=he,ce=de,B=193),193==(0|B)){de=(0|i[151])+ce|0,i[151]=de,de>>>0>(0|i[152])>>>0&&(i[152]=de),de=0|i[49];do{if(de){he=620;do{if((0|le)==(($=0|i[he>>2])+(z=0|i[(ue=he+4|0)>>2])|0)){fe=$,_e=ue,me=z,ge=he,B=203;break}he=0|i[he+8>>2]}while(0!=(0|he));if(203==(0|B)&&0==(8&i[ge+12>>2]|0)&&de>>>0<le>>>0&de>>>0>=fe>>>0){i[_e>>2]=me+ce,he=de+(z=0==(7&(he=de+8|0)|0)?0:0-he&7)|0,ue=ce-z+(0|i[46])|0,i[49]=he,i[46]=ue,i[he+4>>2]=1|ue,i[he+ue+4>>2]=40,i[50]=i[165];break}for(le>>>0<(ue=0|i[47])>>>0?(i[47]=le,ye=le):ye=ue,ue=le+ce|0,he=620;;){if((0|i[he>>2])==(0|ue)){Ee=he,Se=he,B=211;break}if(!(he=0|i[he+8>>2])){ve=620;break}}if(211==(0|B)){if(!(8&i[Se+12>>2])){i[Ee>>2]=le,i[(he=Se+4|0)>>2]=(0|i[he>>2])+ce,z=le+(0==(7&(he=le+8|0)|0)?0:0-he&7)|0,$=ue+(0==(7&(he=ue+8|0)|0)?0:0-he&7)|0,he=z+k|0,ne=$-z-k|0,i[z+4>>2]=3|k;do{if((0|$)!=(0|de)){if((0|$)==(0|i[48])){pe=(0|i[45])+ne|0,i[45]=pe,i[48]=he,i[he+4>>2]=1|pe,i[he+pe>>2]=pe;break}if(1==(3&(pe=0|i[$+4>>2])|0)){oe=-8&pe,se=pe>>>3;e:do{if(pe>>>0>=256){ie=0|i[$+24>>2],ae=0|i[$+12>>2];do{if((0|ae)==(0|$)){if(re=0|i[(a=(q=$+16|0)+4|0)>>2])Ae=re,Ce=a;else{if(!(ee=0|i[q>>2])){Te=0;break}Ae=ee,Ce=q}for(;;)if(re=0|i[(a=Ae+20|0)>>2])Ae=re,Ce=a;else{if(!(re=0|i[(a=Ae+16|0)>>2])){be=Ae,Pe=Ce;break}Ae=re,Ce=a}if(!(Pe>>>0<ye>>>0)){i[Pe>>2]=0,Te=be;break}_()}else{if((a=0|i[$+8>>2])>>>0<ye>>>0&&_(),(0|i[(re=a+12|0)>>2])!=(0|$)&&_(),(0|i[(q=ae+8|0)>>2])==(0|$)){i[re>>2]=ae,i[q>>2]=a,Te=ae;break}_()}}while(0);if(!ie)break;a=476+((ae=0|i[$+28>>2])<<2)|0;do{if((0|$)==(0|i[a>>2])){if(i[a>>2]=Te,Te)break;i[44]=i[44]&~(1<<ae);break e}if(ie>>>0<(0|i[47])>>>0&&_(),(0|i[(q=ie+16|0)>>2])==(0|$)?i[q>>2]=Te:i[ie+20>>2]=Te,!Te)break e}while(0);Te>>>0<(ae=0|i[47])>>>0&&_(),i[Te+24>>2]=ie,q=0|i[(a=$+16|0)>>2];do{if(q){if(!(q>>>0<ae>>>0)){i[Te+16>>2]=q,i[q+24>>2]=Te;break}_()}}while(0);if(!(q=0|i[a+4>>2]))break;if(!(q>>>0<(0|i[47])>>>0)){i[Te+20>>2]=q,i[q+24>>2]=Te;break}_()}else{q=0|i[$+8>>2],ae=0|i[$+12>>2],ie=212+(se<<1<<2)|0;do{if((0|q)!=(0|ie)){if(q>>>0<ye>>>0&&_(),(0|i[q+12>>2])==(0|$))break;_()}}while(0);if((0|ae)==(0|q)){i[43]=i[43]&~(1<<se);break}do{if((0|ae)==(0|ie))Me=ae+8|0;else{if(ae>>>0<ye>>>0&&_(),(0|i[(a=ae+8|0)>>2])==(0|$)){Me=a;break}_()}}while(0);i[q+12>>2]=ae,i[Me>>2]=q}}while(0);Oe=$+oe|0,Ie=oe+ne|0}else Oe=$,Ie=ne;if(i[(se=Oe+4|0)>>2]=-2&i[se>>2],i[he+4>>2]=1|Ie,i[he+Ie>>2]=Ie,se=Ie>>>3,Ie>>>0<256){pe=212+(se<<1<<2)|0,ie=0|i[43],a=1<<se;do{if(ie&a){if((re=0|i[(se=pe+8|0)>>2])>>>0>=(0|i[47])>>>0){we=se,Re=re;break}_()}else i[43]=ie|a,we=pe+8|0,Re=pe}while(0);i[we>>2]=he,i[Re+12>>2]=he,i[he+8>>2]=Re,i[he+12>>2]=pe;break}a=Ie>>>8;do{if(a){if(Ie>>>0>16777215){De=31;break}De=Ie>>>((ee=14-((re=((oe=a<<(ie=(a+1048320|0)>>>16&8))+520192|0)>>>16&4)|ie|(oe=((se=oe<<re)+245760|0)>>>16&2))+(se<<oe>>>15)|0)+7|0)&1|ee<<1}else De=0}while(0);if(a=476+(De<<2)|0,i[he+28>>2]=De,i[(pe=he+16|0)+4>>2]=0,i[pe>>2]=0,!((pe=0|i[44])&(ee=1<<De))){i[44]=pe|ee,i[a>>2]=he,i[he+24>>2]=a,i[he+12>>2]=he,i[he+8>>2]=he;break}for(ee=Ie<<(31==(0|De)?0:25-(De>>>1)|0),pe=0|i[a>>2];;){if((-8&i[pe+4>>2]|0)==(0|Ie)){Ne=pe,B=281;break}if(!(oe=0|i[(a=pe+16+(ee>>>31<<2)|0)>>2])){Le=a,ke=pe,B=278;break}ee<<=1,pe=oe}if(278==(0|B)){if(!(Le>>>0<(0|i[47])>>>0)){i[Le>>2]=he,i[he+24>>2]=ke,i[he+12>>2]=he,i[he+8>>2]=he;break}_()}else if(281==(0|B)){if((ee=0|i[(pe=Ne+8|0)>>2])>>>0>=(oe=0|i[47])>>>0&Ne>>>0>=oe>>>0){i[ee+12>>2]=he,i[pe>>2]=he,i[he+8>>2]=ee,i[he+12>>2]=Ne,i[he+24>>2]=0;break}_()}}else ee=(0|i[46])+ne|0,i[46]=ee,i[49]=he,i[he+4>>2]=1|ee}while(0);return 0|(z+8|0)}ve=620}for(;;){if((he=0|i[ve>>2])>>>0<=de>>>0&&(ne=he+(0|i[ve+4>>2])|0)>>>0>de>>>0){Ge=ne;break}ve=0|i[ve+8>>2]}he=(z=(he=(z=Ge+-47|0)+(0==(7&(ne=z+8|0)|0)?0:0-ne&7)|0)>>>0<(ne=de+16|0)>>>0?de:he)+8|0,$=le+(ue=0==(7&($=le+8|0)|0)?0:0-$&7)|0,ee=ce+-40-ue|0,i[49]=$,i[46]=ee,i[$+4>>2]=1|ee,i[$+ee+4>>2]=40,i[50]=i[165],i[(ee=z+4|0)>>2]=27,i[he>>2]=i[155],i[he+4>>2]=i[156],i[he+8>>2]=i[157],i[he+12>>2]=i[158],i[155]=le,i[156]=ce,i[158]=0,i[157]=he,he=z+24|0;do{i[(he=he+4|0)>>2]=7}while((he+4|0)>>>0<Ge>>>0);if((0|z)!=(0|de)){if(he=z-de|0,i[ee>>2]=-2&i[ee>>2],i[de+4>>2]=1|he,i[z>>2]=he,$=he>>>3,he>>>0<256){ue=212+($<<1<<2)|0,(pe=0|i[43])&(oe=1<<$)?(a=0|i[($=ue+8|0)>>2])>>>0<(0|i[47])>>>0?_():(Ue=$,Fe=a):(i[43]=pe|oe,Ue=ue+8|0,Fe=ue),i[Ue>>2]=de,i[Fe+12>>2]=de,i[de+8>>2]=Fe,i[de+12>>2]=ue;break}if(xe=(ue=he>>>8)?he>>>0>16777215?31:he>>>(($=14-((ue=((pe=ue<<(oe=(ue+1048320|0)>>>16&8))+520192|0)>>>16&4)|oe|(pe=((a=pe<<ue)+245760|0)>>>16&2))+(a<<pe>>>15)|0)+7|0)&1|$<<1:0,$=476+(xe<<2)|0,i[de+28>>2]=xe,i[de+20>>2]=0,i[ne>>2]=0,!((pe=0|i[44])&(a=1<<xe))){i[44]=pe|a,i[$>>2]=de,i[de+24>>2]=$,i[de+12>>2]=de,i[de+8>>2]=de;break}for(a=he<<(31==(0|xe)?0:25-(xe>>>1)|0),pe=0|i[$>>2];;){if((-8&i[pe+4>>2]|0)==(0|he)){Be=pe,B=307;break}if(!(oe=0|i[($=pe+16+(a>>>31<<2)|0)>>2])){Ke=$,Ye=pe,B=304;break}a<<=1,pe=oe}if(304==(0|B)){if(!(Ke>>>0<(0|i[47])>>>0)){i[Ke>>2]=de,i[de+24>>2]=Ye,i[de+12>>2]=de,i[de+8>>2]=de;break}_()}else if(307==(0|B)){if((a=0|i[(pe=Be+8|0)>>2])>>>0>=(he=0|i[47])>>>0&Be>>>0>=he>>>0){i[a+12>>2]=de,i[pe>>2]=de,i[de+8>>2]=a,i[de+12>>2]=Be,i[de+24>>2]=0;break}_()}}}else{0==(0|(a=0|i[47]))|le>>>0<a>>>0&&(i[47]=le),i[155]=le,i[156]=ce,i[158]=0,i[52]=i[161],i[51]=-1,a=0;do{i[(pe=212+(a<<1<<2)|0)+12>>2]=pe,i[pe+8>>2]=pe,a=a+1|0}while(32!=(0|a));a=le+(pe=0==(7&(a=le+8|0)|0)?0:0-a&7)|0,he=ce+-40-pe|0,i[49]=a,i[46]=he,i[a+4>>2]=1|he,i[a+he+4>>2]=40,i[50]=i[165]}}while(0);if((ce=0|i[46])>>>0>k>>>0)return le=ce-k|0,i[46]=le,de=(ce=0|i[49])+k|0,i[49]=de,i[de+4>>2]=1|le,i[ce+4>>2]=3|k,0|(ce+8|0)}return i[(0|O())>>2]=12,0|0},_memcpy:function(e,t,r){var a;if(e|=0,t|=0,(0|(r|=0))>=4096)return 0|y(0|e,0|t,0|r);if(a=0|e,(3&e)==(3&t)){for(;3&e;){if(!r)return 0|a;n[e>>0]=0|n[t>>0],e=e+1|0,t=t+1|0,r=r-1|0}for(;(0|r)>=4;)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0,r=r-4|0}for(;(0|r)>0;)n[e>>0]=0|n[t>>0],e=e+1|0,t=t+1|0,r=r-1|0;return 0|a},_bitshift64Lshr:F,_fflush:function e(t){t|=0;var r=0,n=0,a=0,s=0,o=0,l=0,c=0;do{if(t){if((0|i[t+76>>2])<=-1){r=0|N(t);break}n=0==(0|w()),a=0|N(t),n||R(),r=a}else{if(s=0|i[13]?0|e(0|i[13]):0,p(36),a=0|i[8])for(n=a,a=s;;){if(l=(0|i[n+76>>2])>-1?0|w():0,c=(0|i[n+20>>2])>>>0>(0|i[n+28>>2])>>>0?0|N(n)|a:a,l&&R(),!(n=0|i[n+56>>2])){o=c;break}a=c}else o=s;S(36),r=o}}while(0);return 0|r},___errno_location:O,_bitshift64Shl:x,runPostSets:function(){},stackAlloc:function(e){var t;return t=s,s=(s=s+(e|=0)|0)+15&-16,0|t},stackSave:function(){return 0|s},stackRestore:function(e){s=e|=0},establishStackSpace:function(e,t){s=e|=0,t|=0},setThrew:function(e,t){e|=0,t|=0,o||(o=e,t)},setTempRet0:function(e){l=e|=0},getTempRet0:function(){return 0|l},dynCall_ii:function(e,t){return t|=0,0|K[1&(e|=0)](0|t)},dynCall_iiii:function(e,t,r,n){return t|=0,r|=0,n|=0,0|Y[3&(e|=0)](0|t,0|r,0|n)},dynCall_vi:function(e,t){t|=0,j[1&(e|=0)](0|t)}}}(e.Na,e.Oa,buffer);e._curve25519_donna=Z._curve25519_donna;var Da=e._free=Z._free;e.runPostSets=Z.runPostSets;var cb=e._i64Add=Z._i64Add,ab=e._bitshift64Ashr=Z._bitshift64Ashr,bb=e._i64Subtract=Z._i64Subtract,db=e._memset=Z._memset,ua=e._malloc=Z._malloc,gc=e._memcpy=Z._memcpy,fb=e._bitshift64Lshr=Z._bitshift64Lshr;e._fflush=Z._fflush,e.___errno_location=Z.___errno_location;var gb=e._bitshift64Shl=Z._bitshift64Shl;function xc(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}e.dynCall_ii=Z.dynCall_ii,e.dynCall_iiii=Z.dynCall_iiii,e.dynCall_vi=Z.dynCall_vi,n.W=Z.stackAlloc,n.na=Z.stackSave,n.X=Z.stackRestore,n.md=Z.establishStackSpace,n.cb=Z.setTempRet0,n.Ua=Z.getTempRet0,xc.prototype=Error(),xc.prototype.constructor=xc;var Yc=null,Xa=function t(){e.calledRun||$c(),e.calledRun||(Xa=t)};function $c(t){function r(){if(!e.calledRun&&(e.calledRun=!0,!A)){if(xa||(xa=!0,Oa(Qa)),Oa(Ra),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e._main&&bd&&e.callMain(t),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)Ua(e.postRun.shift());Oa(Sa)}}if(t=t||e.arguments,null===Yc&&(Yc=Date.now()),!(0<L)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)Ta(e.preRun.shift());Oa(Pa),0<L||e.calledRun||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),r()}),1)):r())}}function ad(t,r){if(!r||!e.noExitRuntime)throw!e.noExitRuntime&&(A=!0,m=void 0,Oa(K),e.onExit)&&e.onExit(t),new xc(t)}e.callMain=e.jd=function(t){function r(){for(var e=0;3>e;e++)i.push(0)}assert(0==L,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==Pa.length,"cannot call main when preRun functions remain to be called"),t=t||[],xa||(xa=!0,Oa(Qa));var n=t.length+1,i=[G(Va(e.thisProgram),"i8",0)];r();for(var a=0;a<n-1;a+=1)i.push(G(Va(t[a]),"i8",0)),r();i.push(0),i=G(i,"i32",0);try{ad(e._main(n,i,0),!0)}catch(t){if(!(t instanceof xc)){if("SimulateInfiniteLoop"!=t)throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t;e.noExitRuntime=!0}}},e.run=e.run=$c,e.exit=e.exit=ad;var cd=[];function z(t){void 0!==t?(e.print(t),e.S(t),t=JSON.stringify(t)):t="",A=!0;var r="abort("+t+") at "+Ea()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw cd&&cd.forEach((function(e){r=e(r,t)})),r}if(e.abort=e.abort=z,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();var bd=!0;e.noInitialRun&&(bd=!1),$c(),module.exports=e},37360:e=>{var t;!function(){function e(e){if(this.mode=n.MODE_8BIT_BYTE,this.data=e,this.parsedData=[],e instanceof ArrayBuffer)this.parsedData=new Int8Array(e);else{for(var t=0,r=this.data.length;t<r;t++){var i=[],a=this.data.charCodeAt(t);a>65536?(i[0]=240|(1835008&a)>>>18,i[1]=128|(258048&a)>>>12,i[2]=128|(4032&a)>>>6,i[3]=128|63&a):a>2048?(i[0]=224|(61440&a)>>>12,i[1]=128|(4032&a)>>>6,i[2]=128|63&a):a>128?(i[0]=192|(1984&a)>>>6,i[1]=128|63&a):i[0]=a,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}}function r(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,r=this.parsedData.length;t<r;t++)e.put(this.parsedData[t],8)}},r.prototype={addData:function(t){var r=new e(t);this.dataList.push(r),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=r.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var r=-1;r<=7;r++)if(!(e+r<=-1||this.moduleCount<=e+r))for(var n=-1;n<=7;n++)t+n<=-1||this.moduleCount<=t+n||(this.modules[e+r][t+n]=0<=r&&r<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=n&&n<=4)},getBestMaskPattern:function(){for(var e=0,t=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=h.getLostPoint(this);(0==r||e>n)&&(e=n,t=r)}return t},createMovieClip:function(e,t,r){var n=e.createEmptyMovieClip(t,r);this.make();for(var i=0;i<this.modules.length;i++)for(var a=1*i,s=0;s<this.modules[i].length;s++){var o=1*s;this.modules[i][s]&&(n.beginFill(0,100),n.moveTo(o,a),n.lineTo(o+1,a),n.lineTo(o+1,a+1),n.lineTo(o,a+1),n.endFill())}return n},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=h.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var r=0;r<e.length;r++){var n=e[t],i=e[r];if(null==this.modules[n][i])for(var a=-2;a<=2;a++)for(var s=-2;s<=2;s++)this.modules[n+a][i+s]=-2==a||2==a||-2==s||2==s||0==a&&0==s}},setupTypeNumber:function(e){for(var t=h.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var n=!e&&1==(t>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!e&&1==(t>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},setupTypeInfo:function(e,t){for(var r=this.errorCorrectLevel<<3|t,n=h.getBCHTypeInfo(r),i=0;i<15;i++){var a=!e&&1==(n>>i&1);i<6?this.modules[i][8]=a:i<8?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(i=0;i<15;i++){a=!e&&1==(n>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=a:i<9?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var r=-1,n=this.moduleCount-1,i=7,a=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var o=0;o<2;o++)if(null==this.modules[n][s-o]){var l=!1;a<e.length&&(l=1==(e[a]>>>i&1)),h.getMask(t,n,s-o)&&(l=!l),this.modules[n][s-o]=l,-1==--i&&(a++,i=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}}},r.PAD0=236,r.PAD1=17,r.createData=function(e,t,n){for(var i=g.getRSBlocks(e,t),a=new y,s=0;s<n.length;s++){var o=n[s];a.put(o.mode,4),a.put(o.getLength(),h.getLengthInBits(o.mode,e)),o.write(a)}var l=0;for(s=0;s<i.length;s++)l+=i[s].dataCount;if(a.getLengthInBits()>8*l)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*l+")");for(a.getLengthInBits()+4<=8*l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*l||(a.put(r.PAD0,8),a.getLengthInBits()>=8*l));)a.put(r.PAD1,8);return r.createBytes(a,i)},r.createBytes=function(e,t){for(var r=0,n=0,i=0,a=new Array(t.length),s=new Array(t.length),o=0;o<t.length;o++){var l=t[o].dataCount,c=t[o].totalCount-l;n=Math.max(n,l),i=Math.max(i,c),a[o]=new Array(l);for(var d=0;d<a[o].length;d++)a[o][d]=255&e.buffer[d+r];r+=l;var u=h.getErrorCorrectPolynomial(c),p=new m(a[o],u.getLength()-1).mod(u);s[o]=new Array(u.getLength()-1);for(d=0;d<s[o].length;d++){var f=d+p.getLength()-s[o].length;s[o][d]=f>=0?p.get(f):0}}var _=0;for(d=0;d<t.length;d++)_+=t[d].totalCount;var g=new Array(_),y=0;for(d=0;d<n;d++)for(o=0;o<t.length;o++)d<a[o].length&&(g[y++]=a[o][d]);for(d=0;d<i;d++)for(o=0;o<t.length;o++)d<s[o].length&&(g[y++]=s[o][d]);return g};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},a=0,s=1,o=2,l=3,c=4,d=5,u=6,p=7,h={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;h.getBCHDigit(t)-h.getBCHDigit(h.G15)>=0;)t^=h.G15<<h.getBCHDigit(t)-h.getBCHDigit(h.G15);return(e<<10|t)^h.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;h.getBCHDigit(t)-h.getBCHDigit(h.G18)>=0;)t^=h.G18<<h.getBCHDigit(t)-h.getBCHDigit(h.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return h.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,r){switch(e){case a:return(t+r)%2==0;case s:return t%2==0;case o:return r%3==0;case l:return(t+r)%3==0;case c:return(Math.floor(t/2)+Math.floor(r/3))%2==0;case d:return t*r%2+t*r%3==0;case u:return(t*r%2+t*r%3)%2==0;case p:return(t*r%3+(t+r)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new m([1],0),r=0;r<e;r++)t=t.multiply(new m([1,f.gexp(r)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),r=0,n=0;n<t;n++)for(var i=0;i<t;i++){for(var a=0,s=e.isDark(n,i),o=-1;o<=1;o++)if(!(n+o<0||t<=n+o))for(var l=-1;l<=1;l++)i+l<0||t<=i+l||0==o&&0==l||s==e.isDark(n+o,i+l)&&a++;a>5&&(r+=3+a-5)}for(n=0;n<t-1;n++)for(i=0;i<t-1;i++){var c=0;e.isDark(n,i)&&c++,e.isDark(n+1,i)&&c++,e.isDark(n,i+1)&&c++,e.isDark(n+1,i+1)&&c++,0!=c&&4!=c||(r+=3)}for(n=0;n<t;n++)for(i=0;i<t-6;i++)e.isDark(n,i)&&!e.isDark(n,i+1)&&e.isDark(n,i+2)&&e.isDark(n,i+3)&&e.isDark(n,i+4)&&!e.isDark(n,i+5)&&e.isDark(n,i+6)&&(r+=40);for(i=0;i<t;i++)for(n=0;n<t-6;n++)e.isDark(n,i)&&!e.isDark(n+1,i)&&e.isDark(n+2,i)&&e.isDark(n+3,i)&&e.isDark(n+4,i)&&!e.isDark(n+5,i)&&e.isDark(n+6,i)&&(r+=40);var d=0;for(i=0;i<t;i++)for(n=0;n<t;n++)e.isDark(n,i)&&d++;return r+=10*(Math.abs(100*d/t/t-50)/5)}},f={glog:function(e){if(e<1)throw new Error("glog("+e+")");return f.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return f.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},_=0;_<8;_++)f.EXP_TABLE[_]=1<<_;for(_=8;_<256;_++)f.EXP_TABLE[_]=f.EXP_TABLE[_-4]^f.EXP_TABLE[_-5]^f.EXP_TABLE[_-6]^f.EXP_TABLE[_-8];for(_=0;_<255;_++)f.LOG_TABLE[f.EXP_TABLE[_]]=_;function m(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var r=0;r<e.length&&0==e[r];)r++;this.num=new Array(e.length-r+t);for(var n=0;n<e.length-r;n++)this.num[n]=e[n+r]}function g(e,t){this.totalCount=e,this.dataCount=t}function y(){this.buffer=[],this.length=0}m.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var n=0;n<e.getLength();n++)t[r+n]^=f.gexp(f.glog(this.get(r))+f.glog(e.get(n)));return new m(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=f.glog(this.get(0))-f.glog(e.get(0)),r=new Array(this.getLength()),n=0;n<this.getLength();n++)r[n]=this.get(n);for(n=0;n<e.getLength();n++)r[n]^=f.gexp(f.glog(e.get(n))+t);return new m(r,0).mod(e)}},g.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],g.getRSBlocks=function(e,t){var r=g.getRsBlockTable(e,t);if(null==r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var n=r.length/3,i=[],a=0;a<n;a++)for(var s=r[3*a+0],o=r[3*a+1],l=r[3*a+2],c=0;c<s;c++)i.push(new g(o,l));return i},g.getRsBlockTable=function(e,t){switch(t){case i.L:return g.RS_BLOCK_TABLE[4*(e-1)+0];case i.M:return g.RS_BLOCK_TABLE[4*(e-1)+1];case i.Q:return g.RS_BLOCK_TABLE[4*(e-1)+2];case i.H:return g.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},y.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var E=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],S=function(e,t){this._bIsPainted=!1,this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,this._elCanvas.setAttribute("aria-label","Scan me!"),this._elCanvas.setAttribute("role","img"),e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};function v(e,t){for(var r=1,n=e instanceof ArrayBuffer?e.byteLength:function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e.length?3:0)}(e),a=0,s=E.length;a<=s;a++){var o=0;switch(t){case i.L:o=E[a][0];break;case i.M:o=E[a][1];break;case i.Q:o=E[a][2];break;case i.H:o=E[a][3]}if(n<=o)break;r++}if(r>E.length)throw new Error("Too long data");return r}S.prototype.draw=function(e){var t=this._oContext,r=this._htOption,n=e.getModuleCount(),i=r.width/n,a=r.height/n,s=Math.round(i),o=Math.round(a);this.clear();for(var l=0;l<n;l++)for(var c=0;c<n;c++){var d=e.isDark(l,c),u=c*i,p=l*a;t.strokeStyle=d?r.colorDark:r.colorLight,t.lineWidth=1,t.fillStyle=d?r.colorDark:r.colorLight,t.fillRect(u,p,i,a),t.strokeRect(Math.floor(u)+.5,Math.floor(p)+.5,s,o),t.strokeRect(Math.ceil(u)-.5,Math.ceil(p)-.5,s,o)}this._bIsPainted=!0},S.prototype.isPainted=function(){return this._bIsPainted},S.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},S.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},(t=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.H},"string"==typeof t&&(t={text:t}),t)for(var r in t)this._htOption[r]=t[r];"string"==typeof e&&(e=document.getElementById(e)),this._el=e,this._oQRCode=null,this._oDrawing=new S(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new r(v(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode)},t.prototype.clear=function(){this._oDrawing.clear()},t.CorrectLevel=i}(),e.exports=t},6906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleSheet=t.StyleXSheet=void 0;var n,i=(n=r(41143))&&n.__esModule?n:{default:n};function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s="__fb-light-mode",o="__fb-dark-mode";function l(e,t){const r=[];r.push("".concat(e," {"));for(const e in t){const n=t[e];r.push("  --".concat(e,": ").concat(n,";"))}return r.push("}"),r.join("\n")}const c=/var\(--(.*?)\)/g;class d{constructor(e){var t;a(this,"rootTheme",void 0),a(this,"rootDarkTheme",void 0),a(this,"supportsVariables",void 0),a(this,"rules",void 0),a(this,"injected",void 0),a(this,"tag",void 0),a(this,"ruleForPriority",void 0),this.tag=null,this.injected=!1,this.ruleForPriority=new Map,this.rules=[],this.rootTheme=e.rootTheme,this.rootDarkTheme=e.rootDarkTheme,this.supportsVariables=null!==(t=e.supportsVariables)&&void 0!==t?t:null!=r.g.CSS&&null!=r.g.CSS.supports&&r.g.CSS.supports("--fake-var:0")}getVariableMatch(){return c}isHeadless(){var e,t;return null==this.tag||null==(null===(e=r.g)||void 0===e||null===(t=e.document)||void 0===t?void 0:t.body)}getTag(){const{tag:e}=this;return(0,i.default)(null!=e,"expected tag"),e}getCSS(){return this.rules.join("\n")}getRulePosition(e){return this.rules.indexOf(e)}getRuleCount(){return this.rules.length}inject(){var e;this.injected||(this.injected=!0,null!=(null===(e=r.g.document)||void 0===e?void 0:e.body)?(this.tag=function(){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-styled","true"),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}(),this.injectTheme()):this.injectTheme())}injectTheme(){null!=this.rootTheme&&this.insert(l(":root, .".concat(s),this.rootTheme),0),null!=this.rootDarkTheme&&this.insert(l(".".concat(o,":root, .").concat(o),this.rootDarkTheme),0)}__injectCustomThemeForTesting(e,t){null!=t&&this.insert(l(e,t),0)}delete(e){const t=this.rules.indexOf(e);if((0,i.default)(t>=0,"Couldn't find the index for rule %s",e),this.rules.splice(t,1),this.isHeadless())return;const r=this.getTag().sheet;(0,i.default)(r,"expected sheet"),r.deleteRule(t)}normalizeRule(e){const{rootTheme:t}=this;return this.supportsVariables||null==t?e:e.replace(c,((e,r)=>t[r]))}getInsertPositionForPriority(e){const t=this.ruleForPriority.get(e);if(null!=t)return this.rules.indexOf(t)+1;const r=Array.from(this.ruleForPriority.keys()).sort(((e,t)=>t-e)).filter((t=>t>e?1:0));if(0===r.length)return this.getRuleCount();const n=r.pop();return this.rules.indexOf(this.ruleForPriority.get(n))}insert(e,t,r){if(!1===this.injected&&this.inject(),null!=r)return this.insert(u(e,"html:not([dir='rtl'])"),t),void this.insert(u(r,"html[dir='rtl']"),t);const n=e;if(this.rules.includes(n))return;const i=this.normalizeRule(n),a=this.getInsertPositionForPriority(t);if(this.rules.splice(a,0,i),this.ruleForPriority.set(t,i),this.isHeadless())return;const s=this.getTag().sheet;if(null!=s)try{s.insertRule(i,a)}catch(e){}}}function u(e,t){if(!e.startsWith("@"))return"".concat(t," ").concat(e);const r=e.indexOf("{"),n=e.slice(0,r+1),i=e.slice(r+1);return"".concat(n).concat(t," ").concat(i)}t.StyleXSheet=d,a(d,"LIGHT_MODE_CLASS_NAME",s),a(d,"DARK_MODE_CLASS_NAME",o);const p=new d({supportsVariables:!0,rootTheme:{},rootDarkTheme:{}});t.styleSheet=p},56720:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(6906);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){for(var t=e.reverse(),r={};t.length;){var n=t.pop();if(Array.isArray(n))for(var i=n.length-1;i>=0;i--)t.push(n[i]);else{var a=n;if(null!=a&&"object"==typeof a)for(var s in a){var o=a[s];if("string"==typeof o)r[s]=o;else if("object"==typeof o){var l;r[s]=null!==(l=r[s])&&void 0!==l?l:{},Object.assign(r[s],o)}}}}return r}function l(...e){var t=o(e),r="";for(var n in t)if(Boolean(t[n]))if("string"==typeof t[n])r+=r?" "+t[n]:t[n];else if("object"==typeof t[n]){var i=t[n];for(var a in i){var s=i[a];r+=r?" "+s:s}}return r}l.compose=function(...e){return o(e)},l.create=function(e){throw new Error("stylex.create should never be called. It should be compiled away.")},l.keyframes=e=>{throw new Error("stylex.keyframes should never be called")},l.inject=(e,t,r=null)=>{n.styleSheet.insert(e,t,r)},l.dedupe=(...e)=>l(...e),l.absoluteFill={bottom:0,boxSizing:"border-box",end:0,position:"absolute",start:0,top:0},l.absoluteCenter={boxSizing:"border-box",left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"},l.blockBase={borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"block",flexGrow:1,flexShrink:1,margin:0,padding:0,position:"relative",zIndex:0},l.inlineBase=a(a({},l.blockBase),{},{display:"inline"}),l.buttonBase={appearance:"none",backgroundColor:"transparent",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",margin:0,padding:0,position:"relative",textAlign:"inherit",zIndex:0},l.flexBase={alignItems:"stretch",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"flex",flexDirection:"column",flexGrow:1,flexShrink:1,justifyContent:"space-between",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",zIndex:0},l.flexInlineBase=a(a({},l.flexBase),{},{display:"inline-flex"}),l.linkBase={backgroundColor:"transparent",backgroundImage:"none",boxSizing:"border-box",color:"inherit",cursor:"pointer",position:"relative",textDecoration:"none",zIndex:0},l.listBase={boxSizing:"border-box",listStyle:"none",marginBottom:0,marginTop:0,paddingStart:0},l.visuallyHidden={clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",width:1};var c=l;t.default=c},29127:(e,t,r)=>{var n={"./af.json":[88789,8288],"./ar.json":[58854,8801],"./az.json":[48758,1967],"./bg.json":[60624,1234],"./bn.json":[93511,677],"./ca.json":[98922,4451],"./cs.json":[40097,3539],"./da.json":[36117,9626],"./de.json":[3313,88],"./el.json":[24689,3004],"./en.json":[90084,7494],"./es.json":[96598,4739],"./et.json":[57633,9599],"./fa.json":[41076,4853],"./fi.json":[51701,9789],"./fil.json":[46387,3565],"./fr.json":[12785,7334],"./gu.json":[50387,1244],"./he.json":[62603,2422],"./hi.json":[27605,8606],"./hr.json":[54047,3853],"./hu.json":[92922,1389],"./id.json":[75608,4132],"./it.json":[54800,5881],"./ja.json":[66189,5608],"./kk.json":[47681,4260],"./kn.json":[78930,6700],"./ko.json":[28076,7020],"./lt.json":[37885,4169],"./lv.json":[22798,7938],"./mk.json":[79265,1592],"./ml.json":[7208,4794],"./mr.json":[30163,2771],"./ms.json":[13390,9911],"./nb.json":[49057,4046],"./nl.json":[23129,7055],"./pa.json":[66384,6032],"./pl.json":[75495,9566],"./pt.json":[8897,1992],"./ro.json":[64267,8945],"./ru.json":[34813,887],"./sk.json":[75785,7163],"./sl.json":[65608,7626],"./sq.json":[55915,6098],"./sr.json":[95742,2967],"./sv.json":[81244,4768],"./sw.json":[95881,6606],"./ta.json":[17574,3721],"./te.json":[96564,4771],"./th.json":[38728,5955],"./tr.json":[38704,8962],"./uk.json":[95304,5282],"./ur.json":[27814,2619],"./uz.json":[18192,7654],"./vi.json":[22521,5315],"./zh-CN.json":[59978,4680],"./zh-HK.json":[17133,7920],"./zh-TW.json":[37439,3421]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r.t(i,3)))}i.keys=()=>Object.keys(n),i.id=29127,e.exports=i},26299:(e,t,r)=>{var n={"./af":[50164,6365],"./af.js":[50164,6365],"./ar":[89511,8054],"./ar-XB":[12326,9995],"./ar-XB.js":[12326,9995],"./ar.js":[89511,8054],"./az":[4345,7072],"./az.js":[4345,7072],"./bg":[74774,7102],"./bg.js":[74774,7102],"./bn":[74342,8700],"./bn.js":[74342,8700],"./ca":[654,5632],"./ca.js":[654,5632],"./cs":[64654,165],"./cs.js":[64654,165],"./da":[3435,1628],"./da.js":[3435,1628],"./de":[55170,7216],"./de.js":[55170,7216],"./el":[31977,1204],"./el.js":[31977,1204],"./en":[77407,6933],"./en.js":[77407,6933],"./es":[82834,673],"./es.js":[82834,673],"./et":[65644,792],"./et.js":[65644,792],"./fa":[32949,9999],"./fa.js":[32949,9999],"./fi":[70971,9613],"./fi.js":[70971,9613],"./fil":[94399,907],"./fil.js":[94399,907],"./fr":[61945,6293],"./fr.js":[61945,6293],"./gu":[96432,6038],"./gu.js":[96432,6038],"./he":[44756,5729],"./he.js":[44756,5729],"./hi":[27135,3722],"./hi.js":[27135,3722],"./hr":[66762,5708],"./hr.js":[66762,5708],"./hu":[10728,2556],"./hu.js":[10728,2556],"./id":[18626,5128],"./id.js":[18626,5128],"./it":[47959,2830],"./it.js":[47959,2830],"./ja":[34101,5182],"./ja.js":[34101,5182],"./kk":[85821,9719],"./kk.js":[85821,9719],"./kn":[37038,155],"./kn.js":[37038,155],"./ko":[68736,820],"./ko.js":[68736,820],"./lt":[78935,1529],"./lt.js":[78935,1529],"./lv":[23480,4708],"./lv.js":[23480,4708],"./mk":[32209,6651],"./mk.js":[32209,6651],"./ml":[27102,6655],"./ml.js":[27102,6655],"./mr":[23268,1248],"./mr.js":[23268,1248],"./ms":[84545,5443],"./ms.js":[84545,5443],"./nb":[15070,7749],"./nb.js":[15070,7749],"./nl":[64606,9750],"./nl.js":[64606,9750],"./pa":[31818,9815],"./pa.js":[31818,9815],"./pl":[98120,8628],"./pl.js":[98120,8628],"./pt":[93710,6953],"./pt-BR":[70626,2091],"./pt-BR.js":[70626,2091],"./pt.js":[93710,6953],"./ro":[49526,7162],"./ro.js":[49526,7162],"./ru":[38976,8292],"./ru.js":[38976,8292],"./sk":[24928,1770],"./sk.js":[24928,1770],"./sl":[65516,4259],"./sl.js":[65516,4259],"./sq":[25177,9737],"./sq.js":[25177,9737],"./sr":[24165,6331],"./sr.js":[24165,6331],"./sv":[23012,2944],"./sv.js":[23012,2944],"./sw":[56916,3998],"./sw.js":[56916,3998],"./ta":[11227,2739],"./ta.js":[11227,2739],"./te":[24939,5650],"./te.js":[24939,5650],"./th":[34086,2135],"./th.js":[34086,2135],"./tr":[38953,248],"./tr.js":[38953,248],"./uk":[54945,906],"./uk.js":[54945,906],"./ur":[67882,4361],"./ur.js":[67882,4361],"./uz":[37754,4873],"./uz.js":[37754,4873],"./vi":[79973,8598],"./vi.js":[79973,8598],"./zh-CN":[98537,6483],"./zh-CN.js":[98537,6483],"./zh-HK":[72511,1081],"./zh-HK.js":[72511,1081],"./zh-TW":[70468,7542],"./zh-TW.js":[70468,7542]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r(i)))}i.keys=()=>Object.keys(n),i.id=26299,e.exports=i},19922:(e,t,r)=>{var n={"./af":[36249,3748],"./af.js":[36249,3748],"./ar":[96951,1473],"./ar-DZ":[31883,6884],"./ar-DZ.js":[31883,6884],"./ar-KW":[85371,6282],"./ar-KW.js":[85371,6282],"./ar-LY":[25108,5671],"./ar-LY.js":[25108,5671],"./ar-MA":[22992,2966],"./ar-MA.js":[22992,2966],"./ar-SA":[14344,9646],"./ar-SA.js":[14344,9646],"./ar-TN":[60476,9289],"./ar-TN.js":[60476,9289],"./ar-XB":[61547,3934],"./ar-XB.js":[61547,3934],"./ar.js":[96951,1473],"./az":[58317,5740],"./az.js":[58317,5740],"./bn":[79307,7728],"./bn.js":[79307,7728],"./ca":[72669,9817],"./ca.js":[72669,9817],"./cs":[4388,2023],"./cs.js":[4388,2023],"./da":[82098,7315],"./da.js":[82098,7315],"./de":[96264,5862],"./de.js":[96264,5862],"./el":[57882,1055],"./el.js":[57882,1055],"./en-AU":[82248,8678],"./en-AU.js":[82248,8678],"./en-CA":[18526,4616],"./en-CA.js":[18526,4616],"./en-GB":[87123,9227],"./en-GB.js":[87123,9227],"./en-IE":[40296,2979],"./en-IE.js":[40296,2979],"./en-NZ":[66060,3892],"./en-NZ.js":[66060,3892],"./es":[71689,1791],"./es-DO":[68592,2394],"./es-DO.js":[68592,2394],"./es.js":[71689,1791],"./et":[73429,4473],"./et.js":[73429,4473],"./fa":[6940,7662],"./fa.js":[6940,7662],"./fi":[63191,7386],"./fi.js":[63191,7386],"./fr":[81189,2445],"./fr-CA":[7908,9765],"./fr-CA.js":[7908,9765],"./fr-CH":[9925,8799],"./fr-CH.js":[9925,8799],"./fr.js":[81189,2445],"./gu":[62021,4468],"./gu.js":[62021,4468],"./he":[55897,5027],"./he.js":[55897,5027],"./hi":[55467,6709],"./hi.js":[55467,6709],"./hr":[23077,1381],"./hr.js":[23077,1381],"./hu":[85678,4339],"./hu.js":[85678,4339],"./id":[37827,6511],"./id.js":[37827,6511],"./it":[22365,5247],"./it.js":[22365,5247],"./kk":[65897,7074],"./kk.js":[65897,7074],"./kn":[23124,6568],"./kn.js":[23124,6568],"./ko":[77096,4818],"./ko.js":[77096,4818],"./lt":[66191,6920],"./lt.js":[66191,6920],"./mk":[4942,9545],"./mk.js":[4942,9545],"./ml":[28472,3113],"./ml.js":[28472,3113],"./mr":[84561,3422],"./mr.js":[84561,3422],"./ms":[95938,7739],"./ms-MY":[65012,1520],"./ms-MY.js":[65012,1520],"./ms.js":[95938,7739],"./nb":[98457,5959],"./nb.js":[98457,5959],"./nl":[68623,319],"./nl.js":[68623,319],"./pa-IN":[30837,8132],"./pa-IN.js":[30837,8132],"./pl":[40938,4980],"./pl.js":[40938,4980],"./pt":[80432,9116],"./pt-BR":[40725,6547],"./pt-BR.js":[40725,6547],"./pt.js":[80432,9116],"./ro":[46828,3569],"./ro.js":[46828,3569],"./ru":[84381,2957],"./ru.js":[84381,2957],"./sk":[31453,5965],"./sk.js":[31453,5965],"./sl":[96918,3501],"./sl.js":[96918,3501],"./sq":[46987,6496],"./sq.js":[46987,6496],"./sr":[7467,5170],"./sr-CYRL":[5879,5790],"./sr-CYRL.js":[5879,5790],"./sr.js":[7467,5170],"./sv":[38312,1069],"./sv.js":[38312,1069],"./sw":[47638,2017],"./sw.js":[47638,2017],"./ta":[50995,8634],"./ta.js":[50995,8634],"./te":[70008,3370],"./te.js":[70008,3370],"./th":[8448,951],"./th.js":[8448,951],"./tr":[47120,9313],"./tr.js":[47120,9313],"./uk":[75997,9682],"./uk.js":[75997,9682],"./ur":[98563,6163],"./ur.js":[98563,6163],"./uz":[16183,3017],"./uz-LATN":[75,8117],"./uz-LATN.js":[75,8117],"./uz.js":[16183,3017],"./zh-CN":[83718,3047],"./zh-CN.js":[83718,3047],"./zh-TW":[57924,5125],"./zh-TW.js":[57924,5125]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r(i)))}i.keys=()=>Object.keys(n),i.id=19922,e.exports=i},47466:e=>{"use strict";e.exports=JSON.parse('{"application/":{"applixware":"aw","atom+xml":"atom","atomcat+xml":"atomcat","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-":{"capability":"cdmia","container":"cdmic","domain":"cdmid","object":"cdmio","queue":"cdmiq"},"davmount+xml":"davmount","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","ecmascript":"ecma","emma+xml":"emma","epub+zip":"epub","exi":"exi","font-":{"tdpfr":"pfr","woff":"woff"},"gml+xml":"gml","gpx+xml":"gpx","gxf":"gxf","hyperstudio":"stk","inkml+xml":["ink","inkml"],"ipfix":"ipfix","java-":{"archive":"jar","vm":"class","serialized-object":"ser"},"javascript":"js","json":"json","jsonml+json":"jsonml","lost+xml":"lostxml","mac-":{"binhex40":"hqx","compactpro":"cpt"},"mads+xml":"mads","marc":"mrc","marcxml+xml":"mrcx","mathematica":["ma","nb","mb"],"mathml+xml":"mathml","mbox":"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods","mp21":["m21","mp21"],"mp4":"mp4s","msword":["doc","dot"],"mxf":"mxf","oda":"oda","ogg":"ogx","omdoc+xml":"omdoc","onenote":["onetoc","onetoc2","onetmp","onepkg"],"oxps":"oxps","pdf":"pdf","pgp-":{"encrypted":"pgp","signature":["asc","sig"]},"pkcs10":"p10","pkcs7-":{"mime":["p7m","p7c"],"signature":"p7s"},"pkcs8":"p8","pkix-":{"cert":"cer","crl":"crl","pkipath":"pkipath","attr-cert":"ac"},"pkixcmp":"pki","pls+xml":"pls","postscript":["ai","eps","ps"],"pskc+xml":"pskcxml","rdf+xml":"rdf","reginfo+xml":"rif","resource-":{"lists+xml":"rl","lists-diff+xml":"rld"},"rpki-":{"ghostbusters":"gbr","manifest":"mft","roa":"roa"},"rsd+xml":"rsd","rss+xml":"rss","rtf":"rtf","sbml+xml":"sbml","scvp-":{"cv-":{"request":"scq","response":"scs"},"vp-":{"request":"spq","response":"spp"}},"sdp":"sdp","set-":{"payment-initiation":"setpay","registration-initiation":"setreg"},"shf+xml":"shf","smil+xml":["smi","smil"],"sparql-":{"query":"rq","results+xml":"srx"},"srgs":"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","vnd.":{"acucobol":"acu","acucorp":["atc","acutc"],"adobe.":{"fxp":["fxp","fxpl"],"xdp+xml":"xdp","xfdf":"xfdf","formscentral.fcdt":"fcdt","air-application-installer-package+zip":"air"},"apple.":{"installer+xml":"mpkg","mpegurl":"m3u8"},"audiograph":"aep","bmi":"bmi","businessobjects":"rep","chemdraw+xml":"cdxml","cinderella":"cdy","claymore":"cla","commonspace":"csp","cosmocaller":"cmc","crick.":{"clicker":"clkx","clicker.":{"keyboard":"clkk","palette":"clkp","template":"clkt","wordbank":"clkw"}},"curl.":{"car":"car","pcurl":"pcurl"},"dart":"dart","dece.":{"data":["uvf","uvvf","uvd","uvvd"],"ttml+xml":["uvt","uvvt"],"unspecified":["uvx","uvvx"],"zip":["uvz","uvvz"]},"dna":"dna","dpgraph":"dpg","dreamfactory":"dfac","dvb.":{"ait":"ait","service":"svc"},"dynageo":"geo","enliven":"nml","epson.":{"esf":"esf","msf":"msf","quickanime":"qam","salt":"slt","ssf":"ssf"},"eszigno3+xml":["es3","et3"],"ezpix-":{"album":"ez2","package":"ez3"},"fdf":"fdf","fdsn.":{"mseed":"mseed","seed":["seed","dataless"]},"flographit":"gph","framemaker":["fm","frame","maker","book"],"frogans.":{"fnc":"fnc","ltf":"ltf"},"fujitsu.":{"oasys":"oas","oasys2":"oa2","oasys3":"oa3","oasysgp":"fg5","oasysprs":"bh2"},"fujixerox.":{"ddd":"ddd","docuworks":"xdw","docuworks.binder":"xbd"},"fuzzysheet":"fzs","geogebra.":{"file":"ggb","tool":"ggt"},"geonext":"gxt","geoplan":"g2w","geospace":"g3w","gmx":"gmx","grafeq":["gqf","gqs"],"groove-":{"account":"gac","help":"ghf","injector":"grv","tool-":{"message":"gtm","template":"tpl"},"vcard":"vcg","identity-message":"gim"},"hal+xml":"hal","hbci":"hbci","hp-":{"hpgl":"hpgl","hpid":"hpid","hps":"hps","jlyt":"jlt","pcl":"pcl","pclxl":"pclxl"},"ibm.":{"minipay":"mpy","modcap":["afp","listafp","list3820"],"rights-management":"irm","secure-container":"sc"},"iccprofile":["icc","icm"],"igloader":"igl","immervision-":{"ivp":"ivp","ivu":"ivu"},"intergeo":"i2g","intu.":{"qbo":"qbo","qfx":"qfx"},"jam":"jam","jisp":"jisp","kahootz":["ktz","ktr"],"kde.":{"karbon":"karbon","kchart":"chrt","kformula":"kfo","kivio":"flw","kontour":"kon","kpresenter":["kpr","kpt"],"kspread":"ksp","kword":["kwd","kwt"]},"kenameaapp":"htke","kidspiration":"kia","kinar":["kne","knp"],"koan":["skp","skd","skt","skm"],"lotus-":{"approach":"apr","freelance":"pre","notes":"nsf","organizer":"org","screencam":"scm","wordpro":"lwp","1-2-3":"123"},"mcd":"mcd","medcalcdata":"mc1","mfer":"mwf","mfmp":"mfm","micrografx.":{"flo":"flo","igx":"igx"},"mif":"mif","mobius.":{"daf":"daf","dis":"dis","mbk":"mbk","mqy":"mqy","msl":"msl","plc":"plc","txf":"txf"},"mophun.":{"application":"mpn","certificate":"mpc"},"ms-":{"artgalry":"cil","excel":["xls","xlm","xla","xlc","xlt","xlw"],"excel.":{"sheet.":{"macroenabled.12":"xlsm","binary.macroenabled.12":"xlsb"},"addin.macroenabled.12":"xlam","template.macroenabled.12":"xltm"},"fontobject":"eot","htmlhelp":"chm","ims":"ims","lrm":"lrm","outlook":"msg","officetheme":"thmx","pki.":{"seccat":"cat","stl":"stl"},"powerpoint":["ppt","pps","pot"],"powerpoint.":{"addin.macroenabled.12":"ppam","presentation.macroenabled.12":"pptm","slide.macroenabled.12":"sldm","slideshow.macroenabled.12":"ppsm","template.macroenabled.12":"potm"},"project":["mpp","mpt"],"word.":{"document.macroenabled.12":"docm","template.macroenabled.12":"dotm"},"works":["wps","wks","wcm","wdb"],"wpl":"wpl","xpsdocument":"xps","cab-compressed":"cab"},"mseq":"mseq","musician":"mus","mynfc":"taglet","nitf":["ntf","nitf"],"noblenet-":{"directory":"nnd","sealer":"nns","web":"nnw"},"nokia.":{"radio-":{"preset":"rpst","presets":"rpss"},"n-gage.":{"data":"ngdat","symbian.install":"n-gage"}},"novadigm.":{"edm":"edm","edx":"edx","ext":"ext"},"osgi.":{"dp":"dp","subsystem":"esa"},"palm":["pdb","pqa","oprc"],"pawaafile":"paw","pg.":{"format":"str","osasli":"ei6"},"picsel":"efif","pocketlearn":"plf","powerbuilder6":"pbd","recordare.":{"musicxml":"mxl","musicxml+xml":"musicxml"},"rn-":{"realmedia":"rm","realmedia-vbr":"rmvb"},"seemail":"see","sema":"sema","semd":"semd","semf":"semf","smaf":"mmf","spotfire.":{"dxp":"dxp","sfs":"sfs"},"stardivision.":{"calc":"sdc","draw":"sda","impress":"sdd","math":"smf","writer":["sdw","vor"],"writer-global":"sgl"},"stepmania.":{"package":"smzip","stepchart":"sm"},"svd":"svd","syncml+xml":"xsm","syncml.":{"dm+wbxml":"bdm","dm+xml":"xdm"},"trueapp":"tra","ufdl":["ufd","ufdl"],"umajin":"umj","unity":"unityweb","uoml+xml":"uoml","vcx":"vcx","visio":["vsd","vst","vss","vsw"],"visionary":"vis","vsf":"vsf","Webd.":{"wbxml":"wbxml","wmlc":"wmlc","wmlscriptc":"wmlsc"},"webturbo":"wtb","wordperfect":"wpd","wqd":"wqd","xara":"xar","xfdl":"xfdl","yamaha.":{"hv-":{"dic":"hvd","script":"hvs","voice":"hvp"},"openscoreformat":"osf","smaf-":{"audio":"saf","phrase":"spf"},"openscoreformat.osfpvg+xml":"osfpvg"},"zul":["zir","zirz"],"3gpp2.tcap":"tcap","accpac.simply.":{"aso":"aso","imp":"imp"},"ahead.space":"ahead","airzip.filesecure.":{"azf":"azf","azs":"azs"},"amazon.ebook":"azw","americandynamics.acc":"acc","amiga.ami":"ami","anser-web-":{"certificate-issue-initiation":"cii","funds-transfer-initiation":"fti"},"aristanetworks.swi":"swi","blueice.multipass":"mpm","cloanto.rp9":"rp9","clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"cluetrust.cartomobile-":{"config":"c11amc","config-pkg":"c11amz"},"contact.cmsg":"cdbcmsg","criticaltools.wbs+xml":"wbs","ctc-posml":"pml","cups-ppd":"ppd","dolby.mlp":"mlp","ds-keypoint":"kpxx","ecowin.chart":"mag","fluxtime.clip":"ftc","fsc.weblaunch":"fsc","genomatix.tuxedo":"txd","geometry-explorer":["gex","gre"],"google-earth.":{"kml+xml":"kml","kmz":"kmz"},"handheld-entertainment+xml":"zmm","insors.igm":"igm","intercon.formnet":["xpw","xpx"],"ipunplugged.rcprofile":"rcprofile","irepository.package+xml":"irp","is-xpr":"xpr","isac.fcs":"fcs","kodak-descriptor":"sse","las.las+xml":"lasxml","macports.portpkg":"portpkg","mediastation.cdkey":"cdkey","mozilla.xul+xml":"xul","muvee.style":"msty","neurolanguage.nlu":"nlu","oasis.opendocument.":{"chart":"odc","database":"odb","formula":"odf","graphics":"odg","image":"odi","presentation":"odp","spreadsheet":"ods","text":"odt","text-":{"master":"odm","template":"ott","web":"oth"},"chart-template":"otc","formula-template":"odft","graphics-template":"otg","image-template":"oti","presentation-template":"otp","spreadsheet-template":"ots"},"olpc-sugar":"xo","oma.dd2+xml":"dd2","openofficeorg.extension":"oxt","openxmlformats-officedocument.":{"presentationml.":{"presentation":"pptx","slide":"sldx","slideshow":"ppsx","template":"potx"},"spreadsheetml.":{"sheet":"xlsx","template":"xltx"},"wordprocessingml.":{"document":"docx","template":"dotx"}},"pmi.widget":"wg","previewsystems.box":"box","proteus.magazine":"mgz","pvi.ptid1":"ptid","quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"realvnc.bed":"bed","rig.cryptonote":"cryptonote","rim.cod":"cod","route66.link66+xml":"link66","sailingtracker.track":"st","shana.informed.":{"formdata":"ifm","formtemplate":"itp","interchange":"iif","package":"ipk"},"simtech-mindmapper":["twd","twds"],"smart.teacher":"teacher","solent.sdkm+xml":["sdkm","sdkd"],"sun.xml.":{"calc":"sxc","draw":"sxd","impress":"sxi","math":"sxm","writer":"sxw","writer.":{"global":"sxg","template":"stw"},"calc.template":"stc","draw.template":"std","impress.template":"sti"},"sus-calendar":["sus","susp"],"symbian.install":["sis","sisx"],"tcpdump.pcap":["pcap","cap","dmp"],"tmobile-livetv":"tmo","trid.tpt":"tpt","triscape.mxs":"mxs","uiq.theme":"utz","wolfram.player":"nbp","wt.stf":"stf","zzazz.deck+xml":"zaz","3gpp.pic-bw-":{"large":"plb","small":"psb","var":"pvb"},"3m.post-it-notes":"pwn","android.package-archive":"apk","antix.game-component":"atx","astraea-software.iota":"iota","chipnuts.karaoke-mmd":"mmd","data-vision.rdz":"rdz","denovo.fcselayout-link":"fe_launch","hhe.lesson-player":"les","hydrostatix.sof-data":"sfd-hdstx","jcp.javame.midlet-rms":"rms","joost.joda-archive":"joda","llamagraphics.life-balance.":{"desktop":"lbd","exchange+xml":"lbe"},"osgeo.mapguide.package":"mgp","publishare-delta-tree":"qps","tao.intent-module-archive":"tao","yellowriver-custom-menu":"cmp"},"voicexml+xml":"vxml","widget":"wgt","winhlp":"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-":{"abiword":"abw","authorware-":{"bin":["aab","x32","u32","vox"],"map":"aam","seg":"aas"},"bcpio":"bcpio","bittorrent":"torrent","blorb":["blb","blorb"],"bzip":"bz","bzip2":["bz2","boz"],"cbr":["cbr","cba","cbt","cbz","cb7"],"cdlink":"vcd","chat":"chat","conference":"nsc","cpio":"cpio","csh":"csh","director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"doom":"wad","dtbncx+xml":"ncx","dtbook+xml":"dtb","dtbresource+xml":"res","dvi":"dvi","envoy":"evy","eva":"eva","font-":{"bdf":"bdf","ghostscript":"gsf","otf":"otf","pcf":"pcf","snf":"snf","ttf":["ttf","ttc"],"type1":["pfa","pfb","pfm","afm"],"linux-psf":"psf"},"freearc":"arc","futuresplash":"spl","glulx":"ulx","gnumeric":"gnumeric","gtar":"gtar","hdf":"hdf","latex":"latex","mie":"mie","ms-":{"application":"application","shortcut":"lnk","wmd":"wmd","wmz":"wmz","xbap":"xbap"},"msaccess":"mdb","msbinder":"obd","mscardfile":"crd","msclip":"clp","msdownload":["exe","dll","com","bat","msi"],"msmediaview":["mvb","m13","m14"],"msmetafile":["wmf","wmz","emf","emz"],"msmoney":"mny","mspublisher":"pub","msschedule":"scd","msterminal":"trm","mswrite":"wri","netcdf":["nc","cdf"],"nzb":"nzb","pkcs12":["p12","pfx"],"pkcs7-":{"certificates":["p7b","spc"],"certreqresp":"p7r"},"sh":"sh","shar":"shar","sql":"sql","stuffit":"sit","stuffitx":"sitx","subrip":"srt","sv4cpio":"sv4cpio","sv4crc":"sv4crc","tads":"gam","tar":"tar","tcl":"tcl","tex":"tex","texinfo":["texinfo","texi"],"tgif":"obj","ustar":"ustar","xfig":"fig","xliff+xml":"xlf","xpinstall":"xpi","xz":"xz","zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"7z-compressed":"7z","ace-compressed":"ace","apple-diskimage":"dmg","cfs-compressed":"cfs","chess-pgn":"pgn","debian-package":["deb","udeb"],"dgc-compressed":"dgc","gca-compressed":"gca","gramps-xml":"gramps","install-instructions":"install","iso9660-image":"iso","lzh-compressed":["lzh","lha"],"mobipocket-ebook":["prc","mobi"],"rar-compressed":"rar","shockwave-flash":"swf","silverlight-app":"xap","t3vm-image":"t3","tex-tfm":"tfm","wais-source":"src","java-jnlp-file":"jnlp","research-info-systems":"ris","x509-ca-cert":["der","crt"]},"xaml+xml":"xaml","xenc+xml":"xenc","xhtml+xml":["xhtml","xht"],"xml":["xml","xsl"],"xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xspf+xml":"xspf","xv+xml":["mxml","xhvml","xvml","xvm"],"yang":"yang","yin+xml":"yin","zip":"zip","andrew-inset":"ez","cu-seeme":"cu","octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"oebps-package+xml":"opf","pics-rules":"prf","prs.cww":"cww","rls-services+xml":"rs","timestamped-data":"tsd","xcap-diff+xml":"xdf","xml-dtd":"dtd","patch-ops-error+xml":"xer","relax-ng-compact-syntax":"rnc"},"audio/":{"adpcm":"adp","basic":["au","snd"],"midi":["mid","midi","kar","rmi"],"mp4":["m4a","mp4a"],"mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"ogg":["oga","ogg","spx"],"s3m":"s3m","silk":"sil","vnd.":{"dra":"dra","dts":"dts","nuera.":{"ecelp4800":"ecelp4800","ecelp7470":"ecelp7470","ecelp9600":"ecelp9600"},"rip":"rip","dece.audio":["uva","uvva"],"digital-winds":"eol","dts.hd":"dtshd","lucent.voice":"lvp","ms-playready.media.pya":"pya"},"webm":"weba","x-":{"aac":"aac","aiff":["aif","aiff","aifc"],"caf":"caf","flac":"flac","matroska":"mka","mpegurl":"m3u","ms-":{"wax":"wax","wma":"wma"},"pn-":{"realaudio":["ram","ra"],"realaudio-plugin":"rmp"},"wav":"wav"},"xm":"xm"},"image/":{"bmp":"bmp","cgm":"cgm","g3fax":"g3","gif":"gif","ief":"ief","jpeg":["jpeg","jpg","jpe"],"ktx":"ktx","png":"png","sgi":"sgi","svg+xml":["svg","svgz"],"tiff":["tiff","tif"],"vnd.":{"djvu":["djvu","djv"],"dwg":"dwg","dxf":"dxf","fastbidsheet":"fbs","fpx":"fpx","fst":"fst","ms-":{"modi":"mdi","photo":"wdp"},"xiff":"xif","adobe.photoshop":"psd","dece.graphic":["uvi","uvvi","uvg","uvvg"],"dvb.subtitle":"sub","fujixerox.edmics-":{"mmr":"mmr","rlc":"rlc"},"net-fpx":"npx","wap.wbmp":"wbmp"},"webp":"webp","x-":{"3ds":"3ds","cmx":"cmx","freehand":["fh","fhc","fh4","fh5","fh7"],"icon":"ico","pcx":"pcx","pict":["pic","pct"],"portable-":{"anymap":"pnm","bitmap":"pbm","graymap":"pgm","pixmap":"ppm"},"rgb":"rgb","tga":"tga","xbitmap":"xbm","xpixmap":"xpm","xwindowdump":"xwd","cmu-raster":"ras","mrsid-image":"sid"},"prs.btif":"btif"},"model/":{"iges":["igs","iges"],"mesh":["msh","mesh","silo"],"vnd.":{"collada+xml":"dae","dwf":"dwf","gdl":"gdl","gtw":"gtw","mts":"mts","vtu":"vtu"},"vrml":["wrl","vrml"],"x3d+binary":["x3db","x3dbz"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"]},"text/":{"calendar":["ics","ifb"],"css":"css","csv":"csv","html":["html","htm"],"n3":"n3","plain":["txt","text","conf","def","list","log","in"],"richtext":"rtx","sgml":["sgml","sgm"],"troff":["t","tr","roff","man","me","ms"],"turtle":"ttl","vcard":"vcard","vnd.":{"curl":"curl","curl.":{"dcurl":"dcurl","mcurl":"mcurl","scurl":"scurl"},"fly":"fly","graphviz":"gv","in3d.":{"3dml":"3dml","spot":"spot"},"wap.":{"wml":"wml","wmlscript":"wmls"},"dvb.subtitle":"sub","fmi.flexstor":"flx","sun.j2me.app-descriptor":"jad"},"x-":{"asm":["s","asm"],"c":["c","cc","cxx","cpp","h","hh","dic"],"fortran":["f","for","f77","f90"],"nfo":"nfo","opml":"opml","pascal":["p","pas"],"setext":"etx","sfv":"sfv","uuencode":"uu","vcalendar":"vcs","vcard":"vcf","java-source":"java"},"cache-manifest":"appcache","uri-list":["uri","uris","urls"],"prs.lines.tag":"dsc","tab-separated-values":"tsv"},"video/":{"3gpp":"3gp","3gpp2":"3g2","h261":"h261","h263":"h263","h264":"h264","jpeg":"jpgv","jpm":["jpm","jpgm"],"mj2":["mj2","mjp2"],"mp4":["mp4","mp4v","mpg4"],"mpeg":["mpeg","mpg","mpe","m1v","m2v"],"ogg":"ogv","quicktime":["qt","mov"],"vnd.":{"dece.":{"hd":["uvh","uvvh"],"mobile":["uvm","uvvm"],"pd":["uvp","uvvp"],"sd":["uvs","uvvs"],"video":["uvv","uvvv"]},"fvt":"fvt","mpegurl":["mxu","m4u"],"vivo":"viv","dvb.file":"dvb","uvvu.mp4":["uvu","uvvu"],"ms-playready.media.pyv":"pyv"},"webm":"webm","x-":{"f4v":"f4v","fli":"fli","flv":"flv","m4v":"m4v","matroska":["mkv","mk3d","mks"],"mng":"mng","ms-":{"asf":["asf","asx"],"vob":"vob","wm":"wm","wmv":"wmv","wmx":"wmx","wvx":"wvx"},"msvideo":"avi","smv":"smv","sgi-movie":"movie"}},"chemical/x-":{"cdx":"cdx","cif":"cif","cmdf":"cmdf","cml":"cml","csml":"csml","xyz":"xyz"},"message/rfc822":["eml","mime"],"x-conference/x-cooltalk":"ice"}')},62129:e=>{"use strict";e.exports=JSON.parse('{"prefixHash":"ca4d318e0a1519cffe6030ba0fbd2bf1"}')},89580:e=>{"use strict";e.exports=JSON.parse('{"🤝🏻":"🤝","🤝🏼":"🤝","🤝🏽":"🤝","🤝🏾":"🤝","🤝🏿":"🤝","👯🏻":"👯","👯🏼":"👯","👯🏽":"👯","👯🏾":"👯","👯🏿":"👯","👯🏻‍♂":"👯‍♂","👯🏼‍♂":"👯‍♂","👯🏽‍♂":"👯‍♂","👯🏾‍♂":"👯‍♂","👯🏿‍♂":"👯‍♂"}')},43756:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n=[["","Collection __collectionName__, see all","Click to edit __fieldName__","Error: __error__","__author__:","Open the product context menu","Remove image number __imageNumber__","Result: __name__","Turn off send as sticker","Turn on send as sticker","Sticker with: __emojis__","__count__ @ message","Changing __count__ label","The label could not be updated","__count__ label changed","Adding new label: __labelName__","Couldn't block __participant__","__participant__ blocked","Blocking __participant__","Couldn't delete broadcast list.","Broadcast list deleted","Deleting broadcast list","Couldn't archive chat.","Chat archived","Archiving chat","Couldn't clear chat.","Chat cleared","Clearing chat","Couldn't delete chat.","Chat deleted","Deleting chat","Couldn't mark chat as read.","Couldn't mark chat as unread.","Marked as read","Marked as unread","Marking as read","Marking as unread","Couldn't mute chat.","Chat muted","Muting chat","Couldn't pin chat","You can only pin up to 3 chats.","Chat pinned","Pinning chat","Couldn't unarchive chat.","Chat unarchived","Unarchiving chat","Unmute","Couldn't unmute chat.","Chat unmuted","Unmuting chat","Couldn't unpin chat","Chat unpinned","Unpinning chat","Deleting label: __labelName__ failed","Deleted label: __labelName__","Deleting label: __labelName__","Couldn't create group.","Please enter a shorter subject.","Can't add more than __max__ participants","Created group","Creating group","Couldn't delete group.","Group deleted","Deleting group","Couldn't exit group.","Exited group","Exiting group","Couldn't remove group icon.","Group icon removed","Removing group icon","Group icon set","Couldn't set group icon.","Setting group icon","Couldn't mute group.","Group muted","Muting group","Couldn't rename group.","Group renamed to __subject__","Renaming group","Group subject can't be empty","Couldn't unmute group.","Group unmuted","Unmuting group","Stop sharing live location with __name__?","Stop sharing live location with __name__?","Marking as not spam","Couldn't mark as not spam","Marked as not spam","Couldn't delete message because the message may have expired","Couldn't delete message","__count__ message deleted","Deleting message","Couldn't star message because the message may have expired","Couldn't star message","__count__ message starred","Starring message","Couldn't unstar all messages","Couldn't unstar message because the message may have expired","Couldn't unstar message","__count__ message unstarred","All messages unstarred","Unstarring message","Unstarring all messages","Failed to add label: __labelName__","Label: __labelName__ added successfully","Couldn't add __participantNames__.","You added __participantNames__.","Adding __participantNames__.","Removing __participantNames__ as an admin failed.","You can't dismiss __participant__ as admin because they created this group.","__participantNames__ is no longer a group admin.","Removing __participantNames__ as a group admin.","They are no longer in this group.","You can't add this participant because they left the group recently.","Couldn't make __participantNames__ an admin.","__participantNames__ is now a group admin.","Making __participantNames__ a group admin.","Couldn't remove __participantNames__.","You can't remove __participant__ because they created this group.","You removed __participantNames__.","Removing __participantNames__.","Couldn't remove profile photo.","Profile photo removed","Removing profile photo","Profile photo set","Couldn't set profile photo.","Setting profile photo","Your name can't be empty","Your name changed","Couldn't change your name.","Changing your name","Reporting spam","Couldn't report spam","Reported spam","About can't be empty","About changed","Couldn't change About.","Changing About…","Try again.","Couldn't unblock __participant__","__participant__ unblocked","Unblocking __participant__","Undo","Add a caption…","Blocked contacts will no longer be able to call you or send you messages","Add blocked contact","Add to a group","Add group icon","Add profile photo","Drag the image to adjust","Only __admins__ can send messages","Archive chat","No archived chats","Archived chats","Document","__count__ Page","Contact","__number__ audio file you tried adding has no content.","Your browser doesn’t support audio playback.","__number__ audio you tried adding is larger than the __maxSize__ limit.","Using __deviceName__ as your __deviceType__ for your WhatsApp calls",'"__businessName__" registered as a business account, but WhatsApp hasn’t verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This official business account changed its name to "__businessName__". Click for more info.','WhatsApp has verified that this official business account changed its name and now uses the name "__businessName__".',"__businessName__ used other companies to store and manage this message.","__businessName__ used Facebook and other companies to store and manage this message.","This message was delivered directly from __businessName__.","This message was delivered directly to __businessName__.","__businessName__ used Facebook to store and manage this message.",'"__businessName__" registered as a business account, but WhatsApp hasn’t verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This chat is now with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','This chat is no longer with the official business account of "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the official business account of "__businessName__".',"Block","Block __contact__? Blocked contacts will no longer be able to call you or send you messages.","List of contacts that you have blocked","No blocked contacts yet","Blocked contacts","WhatsApp secures messages while they're being delivered to and from the companies that store and manage this chat for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__.","__businessName__ is registered as a business account.","__businessName__ is registered as an official business account.","__businessName__ is registered as an official business account. The business is saved as a different name in your contacts.","This chat is with the official business account of __businessName__.","This chat is with the official business account of __businessName__. The business is saved as a different name in your contacts.","__businessName__ is now registered as a business account, instead of an official business account.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook or other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ no longer uses other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ is now registered as a business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account. Click to learn more.","__businessName__ now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__, but it's saved as a different name in your contacts. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account. This business uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","__businessName__ now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","This chat is with the official business account of __businessName__. Click to learn more.","__businessName__ now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as a business account.","__businessName__ now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. Click to learn more.","__businessName__ is no longer an official business account. This business now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as an official business account. Click to learn more.","Broadcast list deleted","Browser not supported","__closed__, opens at __time__","End Time","Start Time","__open__ 24 hours","__openTime__ - __closeTime__ and __additionalOpenTime__ - __additionalCloseTime__","__open__ by appointment only","__open__ until __time__","__open__ until __time__, __additionalOpenTime__ - __additionalCloseTime__","This verified business is not in your contact list.","__streetAddress__, __city__","__streetAddress__, __city__ __zipCode__","Confirmed as __businessName__","End Time","This name will be visible to your WhatsApp customers and can be edited from the app on your mobile device.","Something went wrong","An error occurred while saving.  Please try again.","__verified__ as __businessName__","Use Here","__count__ message couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.","__count__ message couldn't be forwarded because the file is missing.","__count__ message couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.","Can't Load WhatsApp","Qty __quantity__","Received cart","Failed to send review request.","We will review the collection and if it meets our guidelines, it will be added to your catalog.","Something went wrong and your request wasn't submitted. Try again.","__updated__ Item Updated","By using this feature, you're using a __fb_product_link__ and agree that the __fb_commerce_link__ and __wa_commerce_policy_link__ apply.","If you feel this is not correct, you can __request_review_link__.","We reviewed this item again and found it didn't follow product or service guidelines. __learn_more_link__.","We will review the item and if it meets our guidelines, it will be added to your catalog.","This item wasn't approved because it doesn't follow our product or service guidelines. __learn_more_link__.","This item is being reviewed. If it’s been approved, your customers will be able to see it on your profile. __learn_more_link__.","This item is being reviewed. You hid it, so customers won’t see it in your catalog when it’s approved. __learn_more_link__.","Turn this on to let customers add items to a cart when shopping in your catalog. Turning this off won't affect carts you've already received. __learn_more_link__","View __catalogOwnerName__'s Catalog on WhatsApp","__productName__ from __catalogOwnerName__ on WhatsApp.","View all","Change group icon","__name__ changed their phone number. You're currently chatting with their new number.","__name__ changed their phone number to a new number.","__name__ changed their phone number to a new number. Click to message the new number.","Change profile photo","Charge your phone to keep using WhatsApp","Archived","You are not an admin","Search for messages within __chatName__.","No Internet connection","Clear messages","click here for group info","click here for contact info","Update WhatsApp","Click to reload QR code","Click to save, ESC to cancel","Click to update WhatsApp","Close chat","__count__ item","This collection wasn't approved because its name violates __collections_rejected_policy_adult__","This collection wasn't approved because its name violates __collections_rejected_policy_alcohol__","This collection wasn't approved because its name violates __collections_rejected_policy_animals__","This collection wasn't approved because its name violates __collections_rejected_policy_body_parts_fluids__","This collection wasn't approved because its name violates __collections_rejected_policy_community_standards__","This collection wasn't approved because its name violates __collections_rejected_policy_digital_services_products__","This collection wasn't approved because its name violates __collections_rejected_policy_discrimination__","This collection wasn't approved because its name violates __collections_rejected_policy_drugs__","This collection wasn't approved because its name violates __collections_rejected_policy_gambling__","This collection wasn't approved because its name violates __collections_rejected_policy_hazardous_goods_and_materials__","This collection wasn't approved because its name violates __collections_rejected_policy_healthcare__","This collection wasn't approved because its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__","This collection wasn't approved because its name violates __collections_rejected_policy_illegal_products__","This collection wasn't approved because its name violates __collections_rejected_policy_misleading__","You can __rename_collection_link__ or __request_another_review_link__.","This collection wasn't approved because its name violates __collections_rejected_policy_other_violation__","This collection wasn't approved because its name violates __collections_rejected_policy_overtly_sexualized_positioning__","This collection wasn't approved because its name violates __collections_rejected_policy_real_fake_currency__","This collection wasn't approved because its name violates __collections_rejected_policy_stolen_goods__","This collection wasn't approved because its name violates __collections_rejected_policy_supplements__","This collection wasn't approved because its name violates __collections_rejected_policy_thrid_party_infringements__","This collection wasn't approved because its name violates __collections_rejected_policy_tobacco__","This collection wasn't approved because its name violates __collections_rejected_policy_unauthorized_media__","This collection wasn't approved because its name violates __collections_rejected_policy_weapons__","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_adult__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_alcohol__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_animals__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_body_parts_fluids__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_community_standards__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_digital_services_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_discrimination__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_drugs__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_gambling__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_hazardous_goods_and_materials__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_healthcare__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_illegal_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_misleading__.","You can __rename_collection_link__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_other_violation__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_overtly_sexualized_positioning__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_real_fake_currency__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_stolen_goods__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_supplements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_thrid_party_infringements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_tobacco__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_unauthorized_media__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_weapons__.","Add __participant__ to “__subject__” group?","Add __participants__ to “__subject__” group?","You are closing WhatsApp.","Some messages can’t be forwarded, do you want to forward rest of the messages?","Can't forward all messages","Forward to __chat__?","Log out?","Make __participant__ an admin for “__subject__” group?","Remove __participant__ from “__subject__” group?","Send __count__ contact to “__chat__”?","Send __count__ contact to “__chat__”?","Send __count__ contact to “__chat__”?","Unblock __chat__ and forward messages?","Unblock __contact__","Unmute this chat?","Unmute this group?","Connecting…","Connecting to WhatsApp","Connecting","Block __contact__","__number__ group in common","About and phone number","Unblock __contact__","Loading About…","View contact","__number__ contact that you tried to add has no content.","The contact that you tried to add is larger than the __maxSize__ limit.","Older messages may be available","Use WhatsApp on your phone to search messages from before __date__.","Use WhatsApp on your phone to see the complete chat history.","Search for messages with __chatName__.","WhatsApp message","Default","Delete chat","Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete this label?","Delete message","Delete message?","Tell us about your issue","Please Update WhatsApp","New version available","Desktop Settings","Update","To continue using WhatsApp, click Update and install the latest version.","Couldn't Update Automatically","Downloading an update to WhatsApp. This may take several minutes. WhatsApp will automatically update and restart when the download finishes.","Updating WhatsApp","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after they’re sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after they’re sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after they’re sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after they’re sent. Click to learn more.","Dismiss","Docs","__count__ Doc","“__name__” downloaded.","__number__ document you tried adding has no content.","__number__ document you tried adding is larger than the __maxSize__ limit.","End-to-end encrypted","Edit","Add text to your image…","Turn on desktop notifications","& "," • ",", ","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","__name__ turned off disappearing messages.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","__name__ turned off disappearing messages. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","Turning on this setting will make new messages disappear from this chat after 7 days. Recipients can still save these messages elsewhere.","Turning on this setting will make new messages disappear from this chat after a selected amount of time. Recipients can still save these messages elsewhere.","All new messages will disappear from this chat __number__ day after they're sent.","All new messages will disappear from this chat __number__ hour after they're sent.","All new messages will disappear from this chat __number__ minute after they're sent.","All new messages will disappear from this chat __number__ second after they're sent.","Anyone in this chat can change this setting.","Group admins control who can change this setting.","This message will disappear from this chat __number__ day after they're sent.","This message will disappear from this chat __number__ hour after they're sent.","This message will disappear from this chat __number__ minute after they're sent.","This message will disappear from this chat __number__ second after they're sent.","Off","On","__number__ day","__number__ hour","__number__ minute","__number__ second","Wait until the message finishes sending and displays a checkmark before forwarding.","Wait until this message is fully delivered before forwarding.","Unable to forward unsent message.","Can’t Forward","__progress__% (__eta__)","__number__ file you tried adding has no content.","__count__ file failed to be downloaded because it's no longer on your phone.","__number__ file could not be added.","__number__ file you tried adding is not supported.","__number__ file you tried adding is larger than the __maxSize__ limit.","B","GB","kB","MB","Forward","You can only share with up to __count__ chat","Forwarded many times. You can only share with up to __count__ chat.","Forward message","Forward message to","Forwarded __count__ time","Found a contact card for this number. View contact card?","Older results may be available","Microsoft Edge","Google Chrome","Mozilla Firefox","Opera","Safari (macOS 11+ Only)","Custom GIF animations are currently not supported. Please use provided GIF selection feature.","Sad","Sports","Trending","TV","Incoming calls off","Incoming calls off. Click to restore.","Incoming calls enabled","Alerts and sounds off","Alerts and sounds off for 1 day","Alerts and sounds off for 1 hour","Alerts and sounds off for 1 week","Alerts and sounds off for 8 hours","Incoming calls off for 1 day","Incoming calls off for 1 hour","Incoming calls off for 1 week","Incoming calls off for 8 hours","Alerts and sounds off. Click to restore.","Notifications enabled","Go to message","Messages and calls are now end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.","Failed to load Google Maps","GOT IT","Group","You were added by someone who's not in your contacts","Group deleted","Description","Can't Join.","You can't join this group because you were removed.","You can't join this group because it has ended.","You can't join this group because you are already a member of it.","You can't join this group because this invite link was reset.","You can't join this group because it is full.","","Couldn't join this group. Please try again.","Cancel","Checking invite link","__count__ contact","Reset link","Join group","Invite to group via link","Anyone with WhatsApp can follow this link to join this group. Only share it with people you trust.","","","","","","__count__ participant","You can't view this group's invite link because you're not an admin.","You can't view this group's invite link because you're no longer a participant.","You can't view this group's invite link because this group has ended.","This invite link doesn't match any WhatsApp groups.","","Failed to revoke this invite.","You can't revoke this group invite because you are not an admin of this group.","You can't revoke this group invite because you are not a participant of this group.","You can't revoke this group invite because this group has ended.","Can't revoke invite. Please try again.","Are you sure you want to reset the invite link for __groupName__? If you reset the link, no one will be able to use it to join this group.","Resetting the invite link for __groupName__.","The previous invite link is now reset and a new invite link has been created.","Send link to","Log in to WhatsApp Web to join this WhatsApp group","Joining group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Joining group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't join group","Viewing and revoking group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Viewing and revoking group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't view group invite details","","","","","View group","Group muted","Type contact name","__count__ other","All participants","Edit group info","Disappearing messages","Allow","Frequently forwarded messages","Messages forwarded many times","Don't allow","Choose to allow participants to send messages to the group that have been forwarded many times.","Only admins","Send messages","Group settings","Follow this link to join my WhatsApp group:","View all (__more__)","__count__ more","Group Subject","Invitation to join my WhatsApp group","Invite Expired","__number__ invited","Couldn't add __participant__. You can invite them privately to join this group.","WhatsApp group invite","Invited","View invite","Group video call","Group voice call","Send invite to...","Reset invite for __participant__? If you reset the invite, __participant__ won't be able to use it to join this group.","To take photos, click “Allow” above to give WhatsApp access to your computer's camera.","To take photos, click “Yes” below to give WhatsApp access to your computer's camera.","To take photos, WhatsApp needs access to your computer's camera. Click __chrome_media_error__ in the URL bar and choose “Always allow web.whatsapp.com to access your camera.”","To take photos, WhatsApp needs access to your computer’s camera. Refresh the page, try sending a camera image, and select “Yes” from the menu that appears.","To take photos, WhatsApp needs access to your computer’s camera. Click __firefox_lock__ in the URL bar and set “Use the Camera” to “Allow.”","To take photos, WhatsApp needs access to your computer’s camera. Click __opera_media__ in the URL bar and click “Clear This Setting and Reload.”","To take photos, WhatsApp needs access to your computer’s camera. Open your browser’s Preferences → Websites and change camera setting for web.whatsapp.com to “Allow”.","You can’t take a photo because it looks like your computer doesn’t have a camera. Try connecting one or if you have one connected, try restarting your browser.","Camera Not Found","Allow camera","To record Voice Messages, click “Allow” above to give WhatsApp access to your computer's microphone.","To record Voice Messages, click “Yes” below to give WhatsApp access to your computer's microphone.","To record Voice Messages, WhatsApp needs access to your microphone. Click __chrome_media_error__ in the URL bar and choose “Always allow web.whatsapp.com to access your microphone.”","To record Voice Messages, WhatsApp needs access to your computer’s microphone. Refresh the page, try sending a Voice Message, and select “Yes” from the menu that appears.","To record Voice Messages, WhatsApp needs access to your computer’s microphone. Click __firefox_lock__ in the URL bar and set “Use the Microphone” to “Allow.”","To record Voice Messages, WhatsApp needs access to your computer’s microphone. Click __opera_media__ in the URL bar and click “Clear This Setting and Reload.”","To record Voice Messages, WhatsApp needs access to your computer’s microphone. Open your browser’s Preferences → Websites and change microphone setting for web.whatsapp.com to “Allow”.","You can’t record a Voice Message because it looks like your computer doesn’t have a microphone. Try connecting one or if you have one connected, try restarting your browser.","Microphone Not Found","Can’t record voice messages during a WhatsApp call.","Allow microphone","To get notifications for new messages, click “Allow” above.","To get notifications for new messages, click “Yes” below.","To get notifications for new messages, select “Allow notifications” from the prompt below the URL bar.","Allow notifications","Help","New Message","Message from __author__","__unreadCount__ New Message","Hide About from...","Hide Last seen from...","Hide Profile photo from...","You'll be logged out after several minutes of inactivity","Failed to load image","__number__ image you tried adding has no content.","Image may be subject to copyright.","Image search failed","Enter search term here","No images found","Search for images","Image Search","Terms of Service","__number__ image you tried adding is larger than the __maxSize__ limit.","Check your phone to answer","WhatsApp group video call from __name__","WhatsApp group voice call from __name__","WhatsApp video call from __name__","WhatsApp voice call from __name__","Increase Speed of Selected Voice Message","Send and receive messages without connecting your phone.","Use WhatsApp on up to 4 devices at the same time.","WhatsApp Web","WhatsApp connects to your phone to sync messages. To reduce data usage, connect your phone to Wi-Fi.","With this update, your phone won’t need to stay online to use WhatsApp on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","With this update, your phone won’t need to stay online to use WhatsApp Business on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone won’t need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone won’t need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone won’t need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone won’t need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","Make calls and send messages without connecting your phone.","WhatsApp for Desktop","Now send and receive messages without keeping your phone online.","Use WhatsApp on up to 4 linked devices and 1 phone at the same time.","Get it here","WhatsApp is available for Mac. __get_it_here__.","Make calls from desktop with WhatsApp for Mac. __get_it_here__.","WhatsApp is available for Windows. __get_it_here__.","Make calls from desktop with WhatsApp for Windows. __get_it_here__.","Keep your phone connected","New WhatsApp Web available","New WhatsApp Desktop available","UPDATE NOW","Expires at __time__","Expires in __number__ day","Invite expired","Keep starred messages","Emoji Panel","Gif Panel","Sticker Panel","Keyboard shortcuts","Catalog","Catalog (temporarily disabled)","Choose color","Enter reason for this request...","__count__ item","Label items","Item Code (Optional)","Description (Optional)","Link (Optional)","Name","Price __currencySymbol__ (Optional)","Enter reason for this request...","Search in __labelName__...","Labels","There was an unexpected error, please click to reload the application.","Learn more","Licenses","Couldn't copy to clipboard. Copy using mouse or keyboard.","Link copied to clipboard.","Links","__count__ Link","Accurate to __accuracy__ M","__count__ people","Live location ended","Expired Location","Last updated __date__ at __time__","Last updated today at __time__","Last updated __date__ at __time__","Last updated yesterday at __time__","Live until __time__","Map view","Satellite view","Terrain view","Hide traffic","Show traffic","Live Location is not available on this device. View location on your phone.","Click to continue viewing live location","__hours__h left","__hours__h __minutes__m left","__minutes__m left","__sharers__ is sharing live location","__name__ is sharing live location","__count__ person is sharing live location","You are sharing live location","You and __name__ are sharing live location","You and __count__ other person are sharing live location","You are sharing live location","Stop Sharing","__name__ stopped sharing","Live Location","Updated __hours__h ago","Updated __hours__h __minutes__m ago","Updated just now","Updated __minutes__m ago","View Live Location","load earlier messages…","load recent messages…","Loading…","loading messages…","Log in","Menu __android_menu_icon__","Click to reload QR code","Need help to get started?","Settings __iphone_settings_icon__","Open WhatsApp on your phone","Tap __android_menu__ or __iphone_settings__ and select __whatsapp_web_menu_item__","Point your phone to this screen to capture the code","Tap on __login_step_3_md_link_device__","Link a Device","To use WhatsApp on your computer:","WhatsApp Web","Linked Devices","This business account is not in your contact list.","More than 1GB storage usage detected. Please be aware that remaining storage is low.","Low storage warning","Make sure your computer has an active Internet connection.","Make sure your phone has an active Internet connection.","Manage","Edit group admins","Mark as read","Mark as unread","You've reached the maximum number of images to add.","Now use WhatsApp Web without keeping your phone online.","Downloading messages: __progress__%","Don't close this window. Your messages are downloading.","With this update, your phone won’t need to stay online to use WhatsApp Web.","With this update, you can use WhatsApp Business on 4 other web devices without keeping your phone online.","With this update, your phone won’t need to stay online to use WhatsApp Desktop.","New WhatsApp Web available","New WhatsApp Desktop available","Update WhatsApp Web","Update WhatsApp Desktop","This version will expire today at __time__. Update to use WhatsApp Web without keeping your phone online.","This version will expire today at __time__. Update to use WhatsApp Desktop without keeping your phone online.","Update complete. Scan the QR code to use WhatsApp Desktop.","Update complete. Scan the QR code to use WhatsApp Web.","Check your internet connection and try again.","Media","Voice Messages are always automatically downloaded for the best communication experience","Add a caption","Background","Done","Failed to add image","Bryndan Write","Norican","Oswald","Sans Serif","Serif","No preview available","Reset","Crop & Rotate","Delete","Emoji","Outline","Smooth","Straight","Paint","Redo","Rotate left","Rotate right","Sticker","Text","Undo","Type something","The item you tried adding failed to load.","This file was changed from original.","Media, links and docs","Media, links, docs and products","Archived","Blocked","Desktop settings","Help","Keep me signed in","Log out","Make group admin","Media auto-download","Notifications","Privacy","Profile","Profile","Remove","Security","Settings","Starred messages","Theme","Chat wallpaper","Attach","Menu","Message","Message admin","This audio is too large. You can send audio up to __maxSize__.","Message __author__","This document is too large. You can send documents up to __maxSize__.","This file is too large. You can send files up to __maxSize__.","This image is too large. You can send images up to __maxSize__.","Message info","Delivered","Delivered to","Played","Played by","Read","Read by","__count__ remaining","Seen","Seen by","Seen","Seen by","Opened","Opened by","Couldn't find message","The message you’re pasting is too long. Try shortening it or sending it in multiple parts.","Message Too Long","This video is too large. You can send videos up to __maxSize__.","WhatsApp needs a microphone for calls and voice messages. Allow access in your computer's settings.","Allow WhatsApp to access your microphone?","Can’t play this Voice Message because it's no longer on your phone.","Voice Message Unavailable","Can’t view this contact because it's no longer on your phone.","Contact Unavailable","Can’t download this document because it's no longer on your phone.","Document Unavailable","Can’t view this GIF because it's no longer on your phone.","GIF Unavailable","Media Message Unavailable","Can’t view this photo because it's no longer on your phone.","Photo Unavailable","Can’t download this sticker because it's no longer on your phone.","Sticker Unavailable","Can’t play this video because it's no longer on your phone.","Video Unavailable","Couldn't display message info. Try again later.","Phone number shared via url is invalid.","Send message to","Log in to WhatsApp Web to share","__contactName__ and __count__ other contact","No contacts","__count__ contact","You can only send up to __count__ contact","View all","1 Day","1 Hour","1 Week","1 Year","8 Hours","Always","Mute “__name__” for…","__A__, __B__","__A__, and __B__","__A__, __B__","__A__ and __B__","Archive Chat","Close Window","WhatsApp needed to restart because of a problem.","Problem Detected","Delete Chat","Delete Group","Exit Group","Log Out","Mark as Read","Mark as Unread","Call","Always On Top","Chat","File","Help","Help Center","Terms and Privacy Policy","Copy Image","Copy Link","About WhatsApp","Hide","Hide Others","Preferences","Quit WhatsApp","Services","Show All","Search","Next Chat","Previous Chat","Search Chat","Add to dictionary","Copy Image","Copy Link","Window","Bring All to Front","Minimize","Zoom","Do Not Move","Move to Applications","You can move WhatsApp to Applications so it's easier to find.","Move WhatsApp to Applications?","Mute","New Chat","New Group","Pin Chat","Profile and About","Unarchive Chat","Cancel Mute","Unpin Chat","Cancel","End Call","Are you sure you want to end the current call?","This video is unavailable. Please try again.","New chat","","New group","NEW","Next","You need to create a catalog on the phone first","No chats","No contacts","No Docs","No groups","No Links","No Media","No Media, Links and Docs","No Media, Links, Docs and Products","No products","No profile photo","No result found for '__labelName__'","No results","No starred messages","No thanks","No update found","No views yet","Not spam","Notifications","__number__ of __totalNumber__","+__number__","Click to get started","Set up your profile","Get started","Group items into collections to stay organized.","Create new collection","Click to get started","Showcase your products","Simpler for you to keep track of order inquiries, manage requests, and close sales.","New: Add to Cart",'This chat is with the official business account of "WhatsApp". Click for more info.','This is the official business account of "WhatsApp".','This is the official business account of "WhatsApp". This account is saved with a different name in your address book.',"This official business account is not in your contact list.","OK, got it","Only admins can edit this group's info","Opening link in new window...","You will now be directed to","Audio","Start WhatsApp at Login","Incoming Call Ringtone","Desktop Alerts","Documents","","","Show Previews","Display message text in desktop alerts","Outgoing Message Tone","Toggles the audio tone that plays when you send a message","Photos","Sounds","Videos","Ask for total","Create order","Create order","Decline order","Yes cancel","We have canceled your order.","The user will be notified that the order has been canceled.","Cancel this order?","The seller has deleted your sent cart. Contact the seller for more information.","Order Detail","Your Order","Review and Pay","Review Order","__subtotal__ (estimated)","Qty __quantity__","__total__ (estimated total)","Use WhatsApp on your mobile device to view this order.","Orders can’t be viewed on WhatsApp Web","No Items","Your order was canceled.","Your order has been completed.","Your order is pending.","Your order is processing.","Your order has been shipped.","View cart","View sent cart","Organizing messages","This message can't be viewed in WhatsApp Desktop. View it on your phone instead.","This message can't be viewed in WhatsApp Web. View it on your phone instead.","Favorite","Recent","Already blocked","Payment","Order #__order__","Total","Not Now","Phone battery low","Update now to use WhatsApp Web on other devices without keeping your phone online.","Get update","WhatsApp is open on another computer or browser. Click “Use Here” to use WhatsApp in this window.","Phone not connected",'The version of WhatsApp on your phone is too old. Please update to the latest version, then click "LOG IN" to continue using WhatsApp.',"The video can't be played.","Open the link","This video is playing in picture in picture.","Currently playing video was revoked.","Pin chat","Waiting for this message. This may take a while.","Previous","Who can see my About","Privacy","Who can add me to groups","Admins who can't add you to a group will have the option of inviting you privately instead.","If you don't share your Last Seen, you won't be able to see other people's Last Seen","My contacts","My contacts except...","__count__ contact excluded","Everyone","Nobody","Who can see my Profile Photo","Failed to get privacy settings, please try again.","Failed to update Read receipts, please try again.","About","Blocked contacts","Groups","Last seen","Profile photo","Read receipts","If turned off, you won't send or receive Read receipts. Read receipts are always sent for group chats.","Who can see my personal info","Reply privately","Add to cart","Item added to cart","Catalog","More","Send catalog","Follow this link to view our catalog on WhatsApp:","Something went wrong","Catalog","View catalog","Country of Origin","Item is a service or non-physical good","Not Applicable","Add a country of origin","Address of Importer","Importer City","Add an importer city","Importer Country","Add an importer country","Importer Zip/Postal Code","Importer Region","Importer Address Line 1","Add an importer address line 1","Importer Address Line 2","Importer Name","Add an importer name","Name of Importer","Optional","More information","This item is out of stock.","Details","You hid this item. Your customers can't see it in your catalog","Product link","View items","Items in this message are no longer available","Message Business","Can not send product before media is ready","View","Out of Stock","Remove from cart","This product or service has been removed","This is abusive, harmful or illegal","This appears to be a knockoff or counterfeit item","The pictures or descriptions don't match the item","Other","Tell us more","This is fraud or a scam","This is spam","Submit","Couldn't report product","Thanks for your feedback","Reporting product","Please select a reason.","Follow this link to view our item on WhatsApp:","Waiting for network","Products","__count__ Product","This photo is too small. Please select a photo with height and width of at least __size__ pixel.","Couldn't send this Voice Message.","…","Your name","This is not your username or pin. This name will be visible to your WhatsApp contacts.","__pinEmoji__ __address__","Map Location","address","hours","profile","Group • __groupName__","All","Reactions notifications enabled","Reacted __reaction__ to","Read more","Reconnect","Remove","","Remove from favorites","Remove this group's icon?",'Remove label "__labelName__" from __count__ item',"Remove photo","Remove your profile photo?","Reply","Report","Report and block","Report business","Block business and clear chat","Report this business to WhatsApp?","Report contact","Block contact and clear chat","Report this contact to WhatsApp?","Report __contactInfo__","Report group","Exit group and clear chat","Report this group to WhatsApp?","Report product","Report Product","We will review the product and if it does not meet our guidelines, it will be removed.","Your report has now been submitted.","Report this product?","Tell Us More","Report spam","The last 5 messages from this business will be forwarded to WhatsApp.","The last 5 messages from this contact will be forwarded to WhatsApp.","The last 5 messages from this group will be forwarded to WhatsApp.","This business will not be notified.","This contact will not be notified.","No one in this group will be notified.","The last 5 messages in this group will be forwarded to WhatsApp.","No one in this group will be notified.","The last 5 messages from this user will be forwarded to WhatsApp.","This contact will not be notified.","The last 5 messages from this business will be forwarded to WhatsApp.","This business will not be notified.","Request review","Click to resend","Retake","Retry","Retry Now","Upload","Retrying…","Retrying in __duration__…","Retrying in __number__ second…","Delete for everyone","Revoke invite","Messages you selected will be deleted for everyone on the latest version of WhatsApp in this chat.","Save","Scan Database Usage","Search…","Search contacts","Search Emoji","Search GIFs via __service__","Search groups","Search Messages","No chats, contacts or messages found","No contacts found","No groups found","No messages found","No results found for '__keyword__'","Search or start new chat","Search Participants","Search results not yet available. Try again later.","Search via WhatsApp sticker store","Search Web","Couldn't search the web. Check your computer's internet connection and try again.","Would you like to search this on the web? This will upload the message to Google.","Looking for chats, contacts or messages…","Searching for images...","Looking for messages…","Security code notifications are no longer available for this chat.","Learn which chats are end to end encrypted","Get notified when your security code changes for a contact. If you have multiple devices, this setting must be enabled on each device where you want to get notifications.","Get notified when your security code changes for a contact’s phone. If you have multiple devices, this setting must be enabled on each device where you want to get notifications.","Get notified when your security code changes for a contact in an end-to-end encrypted chat. If you have multiple devices, this setting must be enabled on each device where you want to get notifications.","Show security notifications","Show security notifications on this computer","WhatsApp secures your conversations with end-to-end encryption. This means your messages, calls and status updates stay between you and the people you choose. Not even WhatsApp can read or listen to them.","Messages and calls in end-to-end encrypted chats stay between you and the people you choose. Not even WhatsApp can read or listen to them.","Security","See __count__ archived chat","See Location","See more","Select All Toggle","__count__ selected","Photo set to send as sticker","Send contact","Send contacts","Couldn't send this message.","Send link via WhatsApp","send","Feedback/Question about WhatsApp","Email address","Confirm email address","Please enter a valid email address","The email addresses do not match","Subject","Please upload images 10 MB or smaller","Question about WhatsApp Business for Mac","Question about WhatsApp for Mac","Release to add...","Add Screenshots","Feedback sent","Please enter a subject.","Contact us","__count__ Screenshot Maximum","Please add more to your description","Question about WhatsApp Business for Web","Question about WhatsApp for Web","Question about WhatsApp Business for Windows","Question about WhatsApp for Windows","To verify, send a message to __name__ and try again.","Send product","Send products","The sender is not in your contact list","Settings","Shop","Shops","__days__d","__hours__h","__minutes__m","__seconds__s","Search in Broadcast lists","Search in chats with contacts","Broadcast lists","Contacts","Non-contacts","Unread chats","Search in Groups","Labels","Search in chats with non contacts","Search unread chats","Some of your messages are still sending.","Star all","Star message","No starred messages","Starred messages","Starting chat","Status","Camera","HIDE","SHOW","Status update not found","MUTED","My Status","No updates","Click on a contact to view their status updates","RECENT","Sending reply…","You received a status, but your version of WhatsApp doesn't support it.","Update your status","Upload","View status","View your updates","VIEWED","Created by __name__","You don't have any stickers yet. Download sticker packs on your phone to get started.","Angry","Celebrate","Greetings","Happy","Love","Sad","You haven't sent any stickers yet","You haven't favorited any stickers yet","WhatsApp Sticker Store","Sticker Details","WhatsApp Sticker Store","Unable to find sticker pack","Send to this chat","Subject","This chat has been closed","Include device information? (optional)","Technical details like your model and settings can help us answer your question.","Tell us how we can help","Your question has been sent to WhatsApp Support. We'll respond in a WhatsApp chat shortly.","Contact us","The support request form is not yet available for desktop. Use your phone to submit it.","WhatsApp secures your messages and calls with this account.","Learn more about chats with WhatsApp Support.","Click to learn how messages and calls are secured.","Security","This chat is with the official account of WhatsApp Support. Click to learn more.","WhatsApp Support","Dismiss","Learn more","This group is no longer available. Please contact WhatsApp Support for help.","Support","Group unavailable","This group is no longer available. Please contact __support__ for help.","WhatsApp Support","Suspicious link","__count__ suspicious link","Open link","This link contains unusual characters. It may be trying to appear as another site.","Take photo","You'll be able to use WhatsApp again in __duration__","You're temporarily banned from WhatsApp because you sent too many messages to people who don’t have __phone__ in their address books.","You're temporarily banned from WhatsApp because too many people blocked you.","You're temporarily banned from WhatsApp because you created too many groups with people who don’t have __phone__ in their address books.","You're temporarily banned from WhatsApp because you sent the same message to too many people.","You're temporarily banned from WhatsApp because you sent too many messages to a broadcast list.","You're temporarily banned from WhatsApp because you may have violated our terms of service.","Terms and Privacy Policy","Dark","Light","Choose theme","System default","This Month","__time__ left","Business Account","Maximum number of files uploaded. __number__ file has been ignored.","Trying to reach phone","Turn off all desktop incoming calls","Turn off all desktop incoming calls for:","Turn off all desktop notifications","Turn off all desktop notifications for:","Turn off all reactions notifications","Turn off all reactions notifications for:","Type a message","Type a reply…","Unarchive chat","Unblock","Unblock __contact__?","Unblock Contact","unknown subject","Unpin chat","__count__ @ message not synced","__count__ unread message","Unread messages","Could not forward this message because the file is no longer on your phone.","Unstar all","Unstar","Unstar all messages?","Unstar all","Unstar message","You received a message on your phone, but your version of WhatsApp Desktop doesn't support it.","This message can't be shown on WhatsApp Desktop. Open WhatsApp on your phone to view.","You received a message, but your version of WhatsApp doesn't support it.","You received a reaction. Update your version of WhatsApp to see reactions.","You sent a reaction. Update your version of WhatsApp to see reactions.","You sent a message from your phone, but your version of WhatsApp Web doesn't support it.","You received a message on your phone, but your version of WhatsApp Web doesn't support it.","Click here to update.","This message can't be shown on WhatsApp Web. Open WhatsApp on your phone to view.","Until __date__ at __time__","Until today at __time__","Until tomorrow at __time__","Until __day__ at __time__","Untitled","Update available","Download Microsoft Edge","Update Google Chrome","Update Mozilla Firefox","Update Safari","Updating WhatsApp","WhatsApp is out of date. Updating now…","Updating","Your phone will no longer need to stay online to use WhatsApp on web, desktop or other devices. __learn_more__","Your phone will no longer need to stay online to use WhatsApp Business on web, desktop or other devices. __learn_more__","This update will log out WhatsApp Web, and you can link immediately with your phone.","This update will log out WhatsApp Web, and you can link immediately with your phone.","This update will log out WhatsApp Desktop, and you can link immediately with your phone.","Logout Information","Upload photo","__participants__ joined using your invite","You invited __participants__","AIM","Birthday","Description","Business Name","Mobile","Email","Home","Home Fax","ICQ","iPhone","Jabber","Main","Windows Live","Nickname","Pager","Skype","Work","Work Fax","Yahoo","Version __version__","Video call","Switch","__number__ video you tried adding has no content.","Your browser doesn’t support video playback.","__number__ video you tried adding is larger than the __maxSize__ limit.","View business","View Contact Card","Expired","This view once photo has expired. Please ask __name__ to re-send it.","This view once video has expired. Please ask __name__ to re-send it.","Photo expired","Video expired","For more privacy, your photo or video will disappear from the chat after the recipient opens it once. Remember, people can always take screenshots.","Send photos and videos that can be viewed only once","Photo","Photo set to view once","For more privacy, this photo will disappear after you close it.","This photo is set to view once","Video set to view once","For more privacy, this video will disappear after you close it.","This video is set to view once","Video","Opened","View or edit catalog","View photo","View Shop","View Pack","Viewed by __count__","Views are not visible if you have disabled Read Receipts in Settings > Account > Privacy on your phone","Voice call","End call","Mute microphone","Turn off camera","Stop screen sharing","Turn on camera","Start screen sharing","Unmute microphone","You can turn on your camera after __callee__ answers","Request to switch to video call","Calling…","Camera not found","camera off","Call ended","Call failed","Call answered on your connected phone","In call","Your call will end in a few seconds because your microphone and sound output device were disconnected.","Your call will end in a few seconds because your microphone was disconnected.","Microphone not found","Call not answered","__name__'s camera and mic are off","The other person's camera and mic are off","__name__'s camera is off","The other person's camera is off","__name__'s mic is muted","The other person's mic is muted","Reconnecting…","Call declined","Your connected phone is already on a WhatsApp call","__name__ is requesting to switch to a video call","Requesting to switch to a video call...","Requesting to switch to a video call...","requesting video call...","Ringing…","Your call will end in a few seconds because your sound output device was disconnected.","Your microphone is muted","Camera","Use System Setting","Microphone","Audio Device","Default Communications Device","You can turn off your camera after __callee__ answers","WhatsApp didn't connect to a video or audio device. Try starting the call again. If the problem continues, you may have to restart WhatsApp or your computer.","Call could not be started","Please contact us with the make and model of your camera. ","WhatsApp doesn't work with your camera yet","You are already on a WhatsApp call","Call cannot be placed for more than __count__ participant","Couldn't place call: all recipients are using old versions of WhatsApp or incompatible devices.","You can only call up to __count__ contact","__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.","__count__ others","WhatsApp needs a camera for video calls. Connect one to your computer.","WhatsApp could not find a connected camera","WhatsApp needs a microphone for calls. Connect one to your computer.","WhatsApp could not find a connected microphone","Make sure your computer has an active Internet connection and try again.","Computer not connected to the Internet","Make sure your phone has an active Internet connection and try again.","Phone not connected to the Internet","WhatsApp needs an audio output device for calls. Connect one to your computer.","WhatsApp could not find a connected audio device","Call could not connect","__callee__ is in a country where WhatsApp Calling is unavailable","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","WhatsApp Calling is unavailable in your country.","Couldn't place call: __callee__ is unable to receive WhatsApp calls at this time.","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is not registered on WhatsApp","Unblock this contact to call them.","Couldn't place call: __callee__ is unable to receive WhatsApp video calls at this time.","Your audio device is unavailable","Your audio device or microphone is unavailable","Your camera is unavailable or used by another app","Allow WhatsApp to access your camera in computer's settings","Your microphone is unavailable. Switch to another microphone or end the call and try again.","Allow WhatsApp to access your microphone in computer's settings","Accept","Decline","Ignore","WhatsApp voice call","WhatsApp group voice call","WhatsApp group video call","WhatsApp video call","WhatsApp will use your computer's camera for video calls and taking photos. You can always change this later in your computer's settings.","WhatsApp will use your computer's microphone for calls and voice messages. You can always change this later in your computer's settings.","Call could not connect","__contactName__ - WhatsApp voice call","__contactName__ - WhatsApp video call","Add WhatsApp Doodles","Chat wallpaper set","Chat wallpaper doodles added","Chat wallpaper doodles removed","Set Chat Wallpaper","Wallpaper Preview","Your security code with __contactName__ changed because there was a login on a new device of theirs.","Your security code with __contactName__ changed because you logged into a new device.",'Your security code with all recipients changed because there was a login on a new device of yours. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Your security code with __contactName__ changed because there was a login on a new device of yours.",'Your security code with all participants changed because there was a login on a new device of yours. To verify a contact\'s security code, open their Contact Info page and click "Encryption"',"Your security code with __contactName__ changed because there was a login on this device.",'Your security code with all recipients changed because there was a login on this device. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Messages are end-to-end encrypted. Click to learn more.","Messages you send to this broadcast list are secured with end-to-end encryption. Click to learn more.","Messages you send to this broadcast list are secured with end-to-end encryption, which means WhatsApp and third parties can't read them.","Your security code with all recipients changed. Click to learn more.",'WhatsApp has verified that this is the official business account of "__businessName__".',"WhatsApp has verified that this is the official business account of __businessName__. This account is saved with a different name in your contacts.","This may be a business. WhatsApp hasn't verified their name yet.","Download","Add label","Delete label","Remove label","Your security code could not be verified with __contactName__. Click to learn more.","Verify your security code with __contactName__ because there was an error with their list of linked devices.","Cancel","You can't send messages to this group because you're no longer a participant.","Can't send a message to blocked contact __contact__.","Your security code with __contactName__ changed because there was a login or logout from one or more of their devices.",'Your security code with all recipients changed because there was a login or logout from one or more of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Your security code with __contactName__ changed because there was a login or logout from one or more of your devices.",'Your security code with all participants changed because there was a login or logout from one or more of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"WhatsApp secures your conversations with end-to-end encryption. This means your messages and status updates stay between you and the people you choose. Not even WhatsApp can read or listen to them.","WhatsApp secures your conversations with end-to-end encryption. This means your messages, calls and status updates stay between you and the people you choose. Not even WhatsApp can read or listen to them.","Muted","Chats","Close","Contact info","Messages are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.","Messages to this chat are secured with end-to-end encryption. __businessName__ may use another company to store, read and respond to your messages. Click to learn more.","Messages are end-to-end encrypted. Click to verify.","Messages and calls are end-to-end encrypted. Click to verify.","Messages and calls are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.","Contacts","Continue","online","typing…","recording audio…","last seen __date__ at __time__","last seen today at __time__","last seen __date__ at __time__","last seen yesterday at __time__","__participant__ is typing…","__participant__ is recording audio…","Audio","Contact","__count__ page","Document","Photo","Live location","Location","Product","Sticker","Video","Voice message","This business can’t chat with phone numbers with your country code.","This business can’t chat with phone numbers with your country code.","Delete","Delete group","Delete broadcast list","Download “__name__”","Encryption","Exit","Exit group","Frequently Contacted","Go",'Your security code with all participants changed because there was a login on this device. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Group admin","Only admins can message this group.","__name__ changed this group's settings to allow all participants to send messages to this group.","You changed this group's settings to allow all participants to send messages to this group.","__name__ changed this group's settings to allow only admins to send messages to this group.","You allowed only admins to send messages to this group","An admin created this group","__name__ created group “__subject__”","__name__ created this group","An admin created group “__subject__”","You created group “__subject__”","You created this group","Created __date__ at __time__","Created __date__ at __time__","Group created by __name__, on __date__ at __time__","Group created by you, on __date__ at __time__","Created today at __time__","Created today at __time__","Group created by __name__, today at __time__","Group created by you, today at __time__","Created __day__ at __time__","Created __day__ at __time__","Created yesterday at __time__","Created yesterday at __time__","Group created by __name__, yesterday at __time__","Group created by you, yesterday at __time__","__name__ changed the group description. Click to view.","__name__ changed the group description.","A participant changed the group description. Click to view.","A participant changed the group description.","You changed the group description. Click to view.","Group Description","This group has ended","Group info","Messages are end-to-end encrypted. Click to learn more.","Messages and calls are end-to-end encrypted. Click to learn more.","Messages are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.","Messages you send to this group are secured with end-to-end encryption, which means WhatsApp and third parties can't read them.","Messages and calls to this group are secured with end-to-end encryption, which means WhatsApp and third parties can't read or listen to them.","Messages and calls are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.","Group participants have changed. Click to view","__name__ reset this group's invite link. Click to view the new invite link.","You reset this group's invite link. Click to view the new invite link.","__name__ changed this group's settings to allow messages that have been forwarded many times.","You changed this group's settings to allow messages that have been forwarded many times.","__name__ changed this group's settings to not allow messages that have been forwarded many times.","You changed this group's settings to not allow messages that have been forwarded many times.","__name__ was added","You were added","__name__ changed their phone number to a new number.","__name__ changed to __new_number__","__participants__ is no longer an admin","You're no longer an admin","__name__ joined via an invite link","You joined via an invite link","__name__ left","You left","__participants__ is now an admin","You're now an admin","__name__ was removed","You were removed","__name__ added __participants__","__name__ added you","__name__ removed __participants__","__name__ removed you","A participant added __participants__","A participant added you","A participant removed __participants__","A participant removed you","You added __participants__","You removed __participants__","__name__ changed this group's settings to allow all participants to edit this group's info.","You changed this group's settings to allow all participants to edit this group's info.","__name__ changed this group's settings to allow only admins to edit this group's info.","You changed this group's settings to allow only admins to edit this group's info.","Your security code with all participants changed. Click to learn more.","__name__ changed the subject to “__subject__”","A participant changed the subject to “__subject__”","You changed the subject to “__subject__”","Invite to group","__num__ invite sent","Invite reset","Groups","Groups in common","Messages to this chat and calls are secured with end-to-end encryption, which means that WhatsApp and third parties can’t read or listen to them. __businessName__ may use a service to store, read and respond to your messages and calls. Contact __businessName__ for information on their privacy practices.","Learn more","Broadcast list info","__name__ added to the list","__name__ removed from the list","Logging Out","Do not close this window","Messages will only be removed from this device and your devices on the newer versions of WhatsApp.","Messages will only be removed from this device and your devices on the newer versions of WhatsApp.","One or more group participants are using old versions of WhatsApp that can't receive messages sent from this device. Use your phone to message them instead.","__name__ and possibly other group participants are using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message this group.","This message couldn’t be delivered","__name__ is using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message them.","Clearing or deleting entire chats will remove messages from this device only. They will not be removed from other devices.","Changes to clearing or deleting a chat","Clearing or deleting entire chats will only remove messages from this device and your devices on the newer versions of WhatsApp.","Messages will be removed from this device only.","Messages will be removed from this device only.","Your computer does not have enough space for WhatsApp to run. Please create more storage by deleting unused files from your computer, then log in again.","You can only pin up to 3 chats","Unpin All","Some of your pinned chats can't be seen on this device. To pin a different chat, unpin all chats first.","The last 5 messages in this group will be forwarded to WhatsApp. If you exit the group and clear the chat, messages will only be removed from this device and your devices on the newer versions of WhatsApp.","The last 5 messages in this group will be forwarded to WhatsApp. If you exit the group and clear the chat, it will be deleted from this device only.","The last 5 messages from this contact will be forwarded to WhatsApp. If you block this contact and clear the chat, messages will only be removed from this device and your devices on the newer versions of WhatsApp.","The last 5 messages from this contact will be forwarded to WhatsApp. If you block this contact and clear the chat, it will be deleted from this device only.","The last 5 messages from this business will be forwarded to WhatsApp. If you block this business and clear the chat, messages will only be removed from this device and your devices on the newer versions of WhatsApp.","The last 5 messages from this business will be forwarded to WhatsApp. If you block this business and clear the chat, it will be deleted from this device only.","This happened likely because __contactName__ or you recently changed which devices you use WhatsApp on. Please verify the security code again.","Your security code with __contactName__ changed","Pinning chats from web/desktop is not yet available on the multi-device beta","Can't pin chat","To verify that messages and calls with __contactName__ are end-to-end encrypted, open this screen on your phone, and follow the instructions.","To verify that messages and calls with __contactName__ are end-to-end encrypted, scan or upload this code on their device. You can also compare the number above instead.","Catalog","New group","Mute notifications","Unmute notifications","New chat","Shop","About","Status","Could not deliver message","Messages","Missed group video call","Missed group video call at __time__","Missed group voice call","Missed group voice call at __time__","Missed video call","Missed video call at __time__","Missed voice call","Missed voice call at __time__","No","The business account for __businessName__ has registered as a standard user account and may no longer belong to the business.","The business account you were chatting with is now a standard account. Click for more info.","OK","Other contacts","__count__ participant","To receive a payment from __senderName__, set up your payment account on your phone.","__contactName__ canceled their payment request for __currencyAndAmount__","You canceled your payment request to __contactName__ for __currencyAndAmount__","__contactName__ declined your payment request for __currencyAndAmount__.","You declined __contactName__'s payment request for __currencyAndAmount__.","__senderName__'s payment request for __currencyAndAmount__ to you expired.","Your payment request to __receiverName__ for __currencyAndAmount__ expired.","You notified __receiverName__ that you are trying to send a payment.","You can now send __receiverName__ a payment.","Waiting for this payment message's note. This may take a while.","Payment message • Amount unavailable","This payment message has a note but your version of WhatsApp doesn't support viewing it.","__invitee__ has set up payments","You invited __otherUser__ to use payments","__otherUser__ invited you to use payments","Requested from __receiverName__","Requested __amount__ from You","__senderName__ requested __amount__ from You","__senderName__ requested __amount__ from __receiverName__","Sent __amount__ to You","__senderName__ sent __amount__ to You","__senderName__ sent __amount__ to __receiverName__","Sent to __receiverName__","Canceled","Completed","Failed","Expired","In Review","Pending","Pending (expiring)","Pending (expires __timeSpan__)","Pending (expires in less than 1 minute)","Processing","__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.","__senderName__'s payment __relativeTime__ is complete.","Declined","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__  was refunded __relativeTime__.","on Friday","on Monday","on Saturday","on __date__","on Sunday","on Thursday","on Tuesday","on Wednesday","__name__ changed this group's icon","You changed this group's icon","__name__ deleted this group's icon","You deleted this group's icon","Preview","OFFICIAL ANNOUNCEMENTS","Recent chats","Recipients","__count__ recipient","Your security code with __contactName__ changed because there was a logout from one of their devices.",'Your security code with all recipients changed because there was a logout from one of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Your security code with __contactName__ changed because there was a logout from one of your devices.",'Your security code with all participants changed because there was a logout from one of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Reset link","Web Search","Your security code with __contactName__ changed. Click to learn more.","Your security code with __name__ changed because there was a registration on a new device of theirs.",'Your security code with all recipients changed because there was a registration on a new device of yours. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Your security code with __name__ changed because there was a registration on a new device of yours.",'Your security code with all participants changed because there was a registration on a new device of yours. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',"Select messages","Help Center","Share","This business uses WhatsApp Business, which allows them to add their opening hours, address, website and catalog of products or services.",'WhatsApp has verified that this is the official business account of "__businessName__". This business uses WhatsApp Business, which allows them to add their opening hours, address, website and catalog of products or services.',"Learn about getting the app","About WhatsApp Business","If you’re a business, the free WhatsApp Business app can help.","If you’re a business, you can benefit from switching to the free WhatsApp Business app. It has tools to connect with customers and manage messages.","Scan this code to get the WhatsApp Business App. Or, you can install it from the App Store or Google Play Store.","WhatsApp Business app","We are updating our WhatsApp Business Terms of Service. Agree to our new Terms on your phone to continue using WhatsApp Business.",'We are updating our WhatsApp Business Terms of Service. Agree to our new Terms on your phone to continue using WhatsApp Business. If you have accepted the Terms of Service, click "LOG IN" to continue using WhatsApp Business.',"Starred messages","About",'This chat is with the verified business account for "__businessName__". Click for more info.','WhatsApp has made changes to the business account types. "Verified Business" will now be labeled as "Official Business Account".','This chat is with the business account for "__businessName__". Click for more info.','WhatsApp has made changes to the business account types. "Confirmed Business" will now be labeled as "Business Account".',"This chat may be with a business account. Click for more info.","__businessName__ may be a business account, but WhatsApp hasn’t verified their name yet.",'The business account you’re chatting with is now verified as "__businessName__". Click for more info.','WhatsApp has made changes to the business account types. "Verified Business" will now be labeled as "Official Business Account".',"This business account has now registered as a standard account. Click for more info.","This account was previously a business account and has now registered as a standard account. It may no longer belong to the business.",'The business account you’re chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account you’re chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account you’re chatting with is no longer confirmed as "__businessName__". Click for more info.','WhatsApp is no longer able to confirm that this is the account for "__businessName__".',"This account has registered as a business account. Click for more info.",'This account has registered as a business account and WhatsApp has confirmed that this is the account for "__businessName__".',"This chat may be with a business account. Click for more info.","__businessName__ registered as a business account, but WhatsApp hasn’t verified their name yet.",'The business account you\'re chatting with belongs to "__businessName__".','WhatsApp has made changes to the business account types. This "Confirmed Business" will now be labeled as "Business Account".',"WhatsApp is updating our Terms and Privacy Policy to reflect new features and comply with the new European Union data protection laws. Open WhatsApp on your phone to read our Terms and Privacy Policy and learn more about the choices you have.","WhatsApp is updating our Terms and Privacy Policy to reflect new features and comply with the new European Union data protection laws. Open WhatsApp on your phone to read our Terms and Privacy Policy and learn more about the choices you have.","This update provides more information about how you can securely chat with businesses. Open this chat on your phone to review and learn more about the WhatsApp update.","WhatsApp’s terms and privacy policy update","WhatsApp recently updated its terms and privacy policy. This business uses a secure service from the Facebook company to manage chats. Open WhatsApp on your phone to read our Terms and Privacy Policy and learn more about the choices you have.","To chat with __contact__, review and accept WhatsApp’s updated terms and privacy policy on your phone.",'WhatsApp is updating our Terms and Privacy Policy to reflect new features and comply with the new European Union data protection laws. Open WhatsApp on your phone to read our Terms and Privacy Policy and learn more about the choices you have. If you have accepted the Terms and Privacy Policy, click "LOG IN" to continue using WhatsApp.',"__date__ at __time__","today","today at __time__","Try Again","There is already another active WhatsApp Web tab in this browser. WhatsApp Web does not support multiple active tabs in this browser. Please use the existing tab or close it and refresh this tab.","Refresh","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","The business account you're chatting with is now unverified. Click for more info.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.","This chat is with a verified business account. Click for more info.","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","This chat is with an unverified business account. Click for more info.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.","The business account you're chatting with is now verified. Click for more info.","Verify","Download code","Release to verify…","The image does not contain a valid identity verification QR code.",'You opened "Verify security code" for the wrong phone number. Open it for the correct number to verify __contact__.','__contact__ opened "Verify security code" for the wrong phone number. Ask __contact__ to open it for your phone number.',"Scan the code on your contact's phone, or ask them to scan your code, to verify your messages and calls to them are end-to-end encrypted. You can also compare the number above to verify. This is optional.","Couldn't display security code. You can verify using the QR code instead.","Verify Security Code","Upload Code","Turn Off Camera","Please try increasing the brightness or reducing light reflection.","Scan Code","WHATSAPP VIDEO CALL","WHATSAPP VOICE CALL","Yes","yesterday","yesterday at __time__","You","You created a broadcast list with __count__ recipient","You","To use WhatsApp, update __chrome_update__ or use __firefox_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Google Chrome __min_version_chrome__+","WhatsApp Commerce Policies","To use WhatsApp, update __edge_homepage__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","WhatsApp works with Microsoft Edge __min_version_edge__+","To use WhatsApp, update __firefox_update__ or use __chrome_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Mozilla Firefox __min_version_firefox__+","WhatsApp group invite","WhatsApp","To use WhatsApp, update __safari_update__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","To use all of WhatsApp's features like photo capturing and Voice Message recording, we recommend using __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","Using Safari","WhatsApp works with Safari __min_version_safari__+","WhatsApp","Send and receive WhatsApp messages right from your computer.","WhatsApp is open in another window. Click “Use Here” to use WhatsApp in this window.","Quickly send and receive WhatsApp messages right from your computer.","We recommend using WhatsApp with one of the following browsers:","WhatsApp also supports:","You can't add more than __count__ labels","Shop disabled","This shop has been disabled for not complying with our policies. Learn more in Commerce Manager.","This shop has been disabled for not complying with our Business or Commerce policies.","Manage shop on Commerce Manager","Go to Commerce Manager to update your Facebook shop."],{11:"__count__ @ messages",12:"Changing __count__ labels",13:"Some labels could not be updated",14:"__count__ labels changed",89:"Couldn't delete __count__ messages because the messages may have expired",90:"Couldn't delete messages",91:"__count__ messages deleted",92:"Deleting messages",93:"Couldn't star messages because the messages may have expired",94:"Couldn't star messages",95:"__count__ messages starred",96:"Starring messages",98:"Couldn't unstar messages because the messages may have expired",99:"Couldn't unstar messages",100:"__count__ messages unstarred",102:"Unstarring messages",106:"Couldn't add __participantNames__.",107:"You added __participantNames__.",108:"Adding __participantNames__.",109:"Removing __participantNames__ as admins failed.",111:"__participantNames__ are no longer group admins.",112:"Removing __participantNames__ as group admins.",113:"They are no longer in this group.",114:"You can't add these participants because they left the group recently.",115:"Couldn't make __participantNames__ admins.",116:"__participantNames__ are now group admins.",117:"Making __participantNames__ group admins.",118:"Couldn't remove __participantNames__.",120:"You removed __participantNames__.",121:"Removing __participantNames__.",156:"__count__ Pages",158:"__number__ audio files you tried adding have no content.",160:"__number__ audio files you tried adding are larger than the __maxSize__ limit.",264:"__count__ messages couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.",266:"__count__ messages couldn't be forwarded because the file is missing.",267:"__count__ messages couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.",275:"__updated__ Items Updated",305:"__count__ items",363:"Send __count__ contacts to “__chat__”?",364:"Send __count__ contacts to “__chat__”?",365:"Send __count__ contacts to “__chat__”?",374:"__number__ groups in common",379:"__number__ contacts that you tried to add have no content.",380:"The contacts that you tried to add are larger than the __maxSize__ limit.",388:"Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete these labels?",389:"Delete messages",390:"Delete messages?",400:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after they’re sent. Click to learn more.",401:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after they’re sent. Click to learn more.",402:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after they’re sent. Click to learn more.",403:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after they’re sent. Click to learn more.",404:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after they’re sent. Click to learn more.",405:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after they’re sent. Click to learn more.",406:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after they’re sent. Click to learn more.",407:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after they’re sent. Click to learn more.",410:"__count__ Docs",412:"__number__ documents you tried adding have no content.",413:"__number__ documents you tried adding are larger than the __maxSize__ limit.",421:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent.",422:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent.",423:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent.",424:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent.",425:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",426:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",427:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",428:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",430:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",431:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",432:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",433:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",434:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",435:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",436:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",437:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",438:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",439:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",440:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",441:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",443:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",444:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",445:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",446:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",449:"All new messages will disappear from this chat __number__ days after they're sent.",450:"All new messages will disappear from this chat __number__ hours after they're sent.",451:"All new messages will disappear from this chat __number__ minutes after they're sent.",452:"All new messages will disappear from this chat __number__ seconds after they're sent.",455:"This message will disappear from this chat __number__ days after they're sent.",456:"This message will disappear from this chat __number__ hours after they're sent.",457:"This message will disappear from this chat __number__ minutes after they're sent.",458:"This message will disappear from this chat __number__ seconds after they're sent.",461:"__number__ days",462:"__number__ hours",463:"__number__ minutes",464:"__number__ seconds",465:"Wait until the messages finish sending and displays a checkmark before forwarding.",470:"__number__ files you tried adding have no content.",471:"__count__ files failed to be downloaded because they are no longer on your phone.",472:"__number__ files could not be added.",473:"__number__ files you tried adding are not supported.",474:"__number__ files you tried adding are larger than the __maxSize__ limit.",480:"You can only share with up to __count__ chats",481:"Forwarded many times. You can only share with up to __count__ chats.",482:"Forward messages",483:"Forward messages to",484:"Forwarded __count__ times",485:"Found contact cards for this number. View contact cards?",529:"__count__ contacts",539:"__count__ participants",568:"__count__ others",582:"__count__ more",587:"Couldn't add __participant__. You can invite them privately to join this group.",623:"__unreadCount__ New Messages",629:"__number__ images you tried adding have no content.",637:"__number__ images you tried adding are larger than the __maxSize__ limit.",650:"This version expires in __num_days__ days. With the update, your phone won’t need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",651:"This version expires in __num_days__ days. With the update, your phone won’t need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",668:"Expires in __number__ days",679:"__count__ items",695:"__count__ Links",696:"Accurate to __accuracy__ M",697:"__count__ people",704:"Live until __time__",712:"__hours__h left",714:"__minutes__m left",715:"__sharers__ are sharing live location",717:"__count__ people are sharing live location",720:"You and __count__ others are sharing live location",725:"Updated __hours__h ago",728:"Updated __minutes__m ago",837:"__count__ remaining",869:"__contactName__ and __count__ other contacts",871:"__count__ contacts",872:"You can only send up to __count__ contacts",1051:"__count__ contacts excluded",1121:"__count__ Products",1122:"This photo is too small. Please select a photo with height and width of at least __size__ pixels.",1133:"All",1142:'Remove label "__labelName__" from __count__ items',1185:"Retrying in __number__ seconds…",1222:"See __count__ archived chats",1226:"__count__ selected",1247:"__count__ Screenshots Maximum",1260:"__days__d",1261:"__hours__h",1262:"__minutes__m",1263:"__seconds__s",1276:"Star messages",1334:"__count__ suspicious links",1351:"__time__ left",1353:"Maximum number of files uploaded. __number__ files have been ignored.",1369:"__count__ @ messages not synced",1370:"__count__ unread messages",1377:"Unstar messages",1407:"__participants__ joined using your invite",1408:"You invited __participants__",1431:"__number__ videos you tried adding have no content.",1433:"__number__ videos you tried adding are larger than the __maxSize__ limit.",1435:"View Contact Cards",1506:"Call cannot be placed for more than __count__ participants",1508:"You can only call up to __count__ contacts",1509:"__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.",1510:"__count__ others",1605:"__count__ pages",1677:"__participants__ are no longer admins",1683:"__participants__ are now admins",1706:"__num__ invites sent",1713:"__name__ were added to the list",1714:"__name__ were removed from the list",1755:"Missed group video call at __time__",1757:"Missed group voice call at __time__",1759:"Missed video call at __time__",1761:"Missed voice call at __time__",1767:"__count__ participants",1769:"__contactName__ canceled their payment request for __currencyAndAmount__",1770:"You canceled your payment request to __contactName__ for __currencyAndAmount__",1771:"__contactName__ declined your payment request for __currencyAndAmount__.",1772:"You declined __contactName__'s payment request for __currencyAndAmount__.",1773:"__senderName__'s payment request for __currencyAndAmount__ to you expired.",1774:"Your payment request to __receiverName__ for __currencyAndAmount__ expired.",1784:"Requested __amount__ from You",1785:"__senderName__ requested __amount__ from You",1786:"__senderName__ requested __amount__ from __receiverName__",1787:"Sent __amount__ to You",1788:"__senderName__ sent __amount__ to You",1789:"__senderName__ sent __amount__ to __receiverName__",1801:"__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.",1823:"__count__ recipients",1912:"You created a broadcast list with __count__ recipients"}]},11609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Offline=t.Disconnected=void 0;var n=r(40265);const i=(0,n.customError)("Disconnected",!1);t.Disconnected=i;const a=(0,n.customError)("Offline",!1,i);t.Offline=a},48338:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AckParser=void 0,t.ackMatchesTemplate=function(e,t){return e.id===t.id&&(void 0===t.class||e.class===t.class)&&(void 0===t.type||e.type===t.type)&&(void 0===t.from||d(e.from,t.from))&&(void 0===t.participant||e.participant===t.participant)&&(void 0===t.ts||e.ts===t.ts)},t.fromJidsAreEqual=d;var n=r(74391),i=r(71914);const{defaultDeviceJidForUser:a,extractDeviceId:s,extractFromJid:o,extractUserJid:l}=(0,n.getJidUtilsApi)(),c=new i.WapParser("ack",(e=>(e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null})));function d(e,t){return o(e)===t||("user"===e.jidType?a(e.userJid)===t:"device"===e.jidType&&(0===s(e.deviceJid)&&l(e.deviceJid)===t))}t.AckParser=c},36184:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castStanza=function(e){const t=C("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.forceResetSocketLoop=function(){C("forceResetSocketLoop").socketLoop.reset()},t.isSocketConnected=S,t.maybeResetSocketLoop=function(){S()||C("maybeResetSocketLoop").socketLoop.reset()},t.onStreamErrorReceived=function(){C("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=E,t.requireNetwork=function(){if(null==g){const e=new s.JobRequirement("network");return g=e,_.resolveWasCalled()||e.addBlocker(_.promise),e}return g},t.resetStateForTests=function(){f=null,_=new d.Resolvable,m=1,g=null},t.sendIq=function(e,t){return A(e,t,!1)},t.sendIqIfConnectedWithin=function(e,t,r){const n=C("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);return new Promise(((t,s)=>{const o=setTimeout((()=>{const e=C("sendIq"),t=e.pendingIqs.get(i);if(!t)throw new Error(`Unexisting stanza to be cancelled ${i}`);e.removeHandler(t),s(new a.Offline)}),1e3*r),l={type:"iq",resolve:t,stanza:e,attachedToSocketId:0,orderedId:m++,timeoutId:o};n.pendingIqs.set(i,l),n.socket?n.sendPendingIq(l):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`})).then((e=>b(t,e)))},t.sendIqWithoutRetry=function(e,t){return A(e,t,!0)},t.sendPing=function(e,t){const r=C("sendPing"),n=e.attrs.id;if(!n||"string"!=typeof n)throw new Error(`Comms:sendPing given iq without id: ${String(e)}`);if(!r.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(r.activePing&&r.activePing.socketId===r.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();r.activePing&&r.activePing.handler.resolve();const i=new d.Resolvable;return r.activePing={socketId:r.socketId,stanzaId:n,handler:i},r.callStanza(e),i.promise.then((e=>e&&b(t,e)))},t.sendSmaxIq=function(e,t){return A(e,t,!1)},t.sendStanzaAndReturnAck=T,t.sendStanzaAndWaitForAck=function(e,t){return T(e,t).then((()=>{}))},t.singletonOrThrowIfUninitialized=C,t.socketLoopIteration=v,t.startComms=function(e,t,r,n,i,a){if(f)return;f=new y(e,t,r,n,i,a),setTimeout(E,0)},t.startHandlingRequests=function(){return C("startHandlingRequests").startHandlingRequests()},t.stopComms=function(){const e=C("stopComms");e.socketLoop.endWithValue(),e.socket&&e.socket.close()},t.waitForConnection=function(){return C("waitForConnection").sendPing(),_.promise};var n=r(48338),i=r(47151),a=(r(61103),r(11609)),s=r(18269),o=r(20221),l=r(65095),c=r(72287),d=r(88156),u=r(57319),p=r(31914),h=r(71914);let f=null,_=new d.Resolvable,m=1,g=null;class y{constructor(e,t,r,n,i,a){this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new d.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.deadSocketTimer=null,this.handleStanza=(e,t)=>{const r=M(e);if(null!=r){const t=this.pendingIqs.get(r);t?(this.pendingIqs.delete(r),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${r}`}else{if("ack"!==e.tag)return this._recvBlocker.promise.then((()=>this._handleStanza(e,t)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new u.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this._handleStanza=e,this.sendPing=t,this.onConnectionChange=(0,o.notifyConnectionChangeFactory)(i,a),this.gzipInflate=n,this.details=r,this.socketLoop=new c.PromiseRetryLoop({name:"MainSocketLoop",code:v,timer:{jitter:.1,max:r.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function r(r){e(r)&&t.push(r)}return this.pendingIqs.forEach(r),this.ackHandlers.forEach(r),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanza(e){var t;this.castStanza(e),null===(t=this.deadSocketTimer)||void 0===t||t.onOrBefore(this.details.deadSocketTime),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{t.sendFrame((0,p.encodeStanza)(e))}catch(e){__LOG__(4,void 0,new Error)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){return __LOG__(2)`Comms.startHandlingRequests`,this._recvBlocker.resolve(),this._recvBlocker.promise.then((()=>{}))}parseAndHandleStanza(e,t){var r;e===this.socketId&&(null===(r=this.deadSocketTimer)||void 0===r||r.cancel(),_.resolveWasCalled()||_.resolve());const n=(0,p.decodeStanza)(t,this.gzipInflate).catch((e=>{throw __LOG__(4,void 0,new Error)`Failure parsing stanza!`,e})).then((t=>{const r=this.activePing;return r&&r.socketId===e&&r.stanzaId===M(t)?(this.activePing=null,r.handler.resolve(t),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(t,e)})).then((t=>{if(e===this.socketId){if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:this.castStanza(t);return"NO_ACK"}}));this._pending.add(n),n.finally((()=>{this._pending.delete(n)}))}handleAck(e){const t=this.ackHandlers;let r=-1,n=null;for(;!n&&++r<t.length;)n=t[r].parseAndTest(e);if(n){const e=t[r];(0,i.removeIndexWithoutPreservingOrder)(t,r),e.resolve(n),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,i.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new a.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.details.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}function E(){C("openSocketLoop").socketLoop.start()}function S(){var e;return!!(null===(e=f)||void 0===e?void 0:e.socket)}function v(){const e=C("socketLoopIteration"),t=e.nextSocketId++;return __LOG__(2)`Comms: Socket ${t} opening`,(0,l.openChatSocket)(e.details,(()=>{e.onConnectionChange("in_handshake")})).then((r=>{const n=new d.Resolvable;__LOG__(2)`Comms: Socket ${t} opened`,e.socketId=t,e.socket=r;const i=new u.ShiftTimer((()=>{__LOG__(2)`Comms: Socket ${t} expired`,n.resolve(),i===e.deadSocketTimer&&(e.deadSocketTimer=null)}));return e.deadSocketTimer=i,e.socketLoop.resetTimeoutAfter(1e4),e.maybeScheduleHealthCheck(),r.setOnFrame((r=>e.parseAndHandleStanza(t,r))),r.setOnClose((()=>{var r;if(__LOG__(2)`Comms: Socket ${t} closed`,e.activePing&&t===e.activePing.socketId&&(e.activePing.handler.resolve(),e.activePing=null),e.filterPending((e=>e.attachedToSocketId===t)).forEach((t=>{e.removeHandler(t)})),t!==e.socketId)return;e.socketId=0,e.socket=null;const i=e.deadSocketTimer;null!=i&&(i.cancel(),e.deadSocketTimer=null),e.onConnectionChange("disconnected"),n.resolve(),_=new d.Resolvable,null===(r=g)||void 0===r||r.addBlocker(_.promise)})),e.onConnectionChange("connected"),e.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((t=>{"iq"===t.type?e.sendPendingIq(t):e.callStanza(t.stanza)})),n.promise})).catch((e=>{e instanceof a.Disconnected?__LOG__(2)`socketLoopIteration socket closed while in noise handshake`:__LOG__(4,void 0,new Error)`socketLoopIteration failed ${e}`}))}function T(e,t){return new Promise((r=>{const i=C("sendStanzaAndWaitForAck");i.ackHandlers.push({type:"ack",parseAndTest:e=>{const r=n.AckParser.parse(e);return!r.error&&(0,n.ackMatchesTemplate)(r.success,t)?e:null},resolve:r,stanza:e,attachedToSocketId:0,orderedId:m++}),i.socket?i.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function A(e,t,r){return new Promise((t=>{const n=C("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const s=n.socketId;if(r&&!s)return void t(Promise.reject(new a.Offline));const o={type:"iq",resolve:t,stanza:e,attachedToSocketId:r?s:0,orderedId:m++};n.pendingIqs.set(i,o),n.socket?n.sendPendingIq(o):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`})).then((e=>b(t,e)))}function C(e){if(f)return f;throw new Error(`Comms::${e} called before startComms`)}function b(e,t){const r=t.content;if(r&&Array.isArray(r)&&r[0]){const e=r[0];if("error"===e.tag){const t=e.attrs||{};return{success:!1,errorCode:parseInt(t.code,10),errorText:(0,p.decodeAsString)(t.text)||"",errorType:(0,p.decodeAsString)(t.type)||"",customError:void 0,errorBackoff:parseInt(t.backoff,10),toString:P}}}return e instanceof h.WapParser?{success:!0,result:e.parseOrThrow(t)}:{success:!0,result:e(t)}}function P(){return`IqError ${this.errorCode}: ${this.errorText}`}function M(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,p.decodeAsString)(e.attrs.id)||null}return null}},20221:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notifyConnectionChangeFactory=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;const n={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},i=()=>{const{optimismLevel:e,connectionStatus:i}=n;"optimist"===e?n.timeoutID=setTimeout((()=>{n.optimismLevel="realist",t(i)}),r):t(i)};return r=>{n.connectionStatus=r,"disconnected"===r||"in_handshake"===r?i():(null!=n.timeoutID&&(clearTimeout(n.timeoutID),n.timeoutID=null),t(r)),e(r)}}},34308:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmppParsingFailure=t.ParsableWapNode=void 0;var n=r(8584),i=r(74391),a=r(52230),s=r(8243),o=r(91560),l=r(17793),c=r(92844),d=r(31914),u=r(45506);const{defaultDeviceJidForUser:p,extractFromJid:h,extractUserJid:f,interpretAndValidateJid:_,interpretAsDeviceId:m}=(0,i.getJidUtilsApi)();class g{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmppParsingFailure: ${this.parser}: ${this.reason}`}}t.XmppParsingFailure=g;class y extends o.ParsableXmlNode{constructor(e,t){super(e,t)}assertFromServer(){const e=this.attrString("from");e!==a.WA_SERVER_DOMAIN&&this.throw(`to have "from"="s.whatsapp.net", but instead has "${e}"`)}attrUserJid(e){const t=this.attrString(e);return _(t).userJid||this.throw(`to have "${e}"={UserJid}, but instead has "${t}"`)}maybeAttrUserJid(e){return this.hasAttr(e)?this.attrUserJid(e):null}attrGroupJid(e){const t=this.attrString(e);return _(t).groupJid||this.throw(`to have "${e}"={GroupJid}, but instead has "${t}"`)}maybeAttrGroupJid(e){return this.hasAttr(e)?this.attrGroupJid(e):null}attrChatJid(e){const t=this.attrString(e),r=_(t);return r.userJid||r.groupJid||this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrDeviceJid(e){const t=this.attrString(e),r=_(t);return r.deviceJid?r.deviceJid:r.userJid?p(r.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${t}"`)}attrDeviceId(e){const t=this.attrInt(e);return m(t)}attrFromJidChat(){const e=this.attrJidWithType();switch(e.jidType){case"user":{const t=e.userJid,r=p(t);return{type:"device",chat:t,deviceJid:r,author:r}}case"device":{const t=e.deviceJid;return{type:"device",chat:f(t),deviceJid:t,author:t}}case"group":{const t=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:t}}case"broadcast":{const t=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:f(t),author:t}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");case"lidUser":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.lidUserJid}`,new Error("ParsableWapNode: attrFromJid() does not support LidUserJid");case"lidDevice":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.lidDeviceJid}`,new Error("ParsableWapNode: attrFromJid() does not support LidDeviceJid");default:return e.jidType,this.throw("attrFromJidChat should not be used with a status jid")}}attrFromJid(){const e=this.attrJidWithType(),t=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return"status"===e.jidType?t?{type:"status",author:t}:this.throw("to have participant for status msg"):this.attrFromJidChat()}attrJidWithType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),r=_(t);return"unknown"===r.jidType?this.throw(`to have "${e}"={Jid}, but instead has "${t}"`):r}attrWapJid(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),r=_(t);return"unknown"===r.jidType?u.WapJid.create(null,t):(0,d.JID)(h(r))}attrLongInt(e){const t=this.attrString(e);return(0,s.decimalStringToLongInt)(t)}attrTime(e){return(0,c.castToUnixTime)(this.attrInt(e))}attrFutureTime(e){const t=this.attrInt(e);return(0,c.futureUnixTime)(t)}contentString(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){const e=new n.Binary(this.contentBytes());return e.readString(e.size())}return this.throw("to have content")}decodeAsString(e){return(0,d.decodeAsString)(e)}contentSerializedPubKey(){return this.hasContent()?(0,l.serializeIdentity)(this.contentBytes()):this.throw("to have content")}throw(e){throw new g(this.name(),`expected <${this.tag()}> ${e}`)}}t.ParsableWapNode=y},31914:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.BIG_ENDIAN_CONTENT=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=e;const n=new Uint8Array(t);for(let e=t-1;e>=0;e--)n[e]=255&r,r>>>=8;return n},t.BROADCAST_JID=function(e){return j(e)},t.CALL_JID=function(e){return j(e)},t.CUSTOM_STRING=function(e){return e},t.DEVICE_JID=function(e){return j(e)},t.DROP_ATTR=void 0,t.GROUP_JID=function(e){return j(e)},t.G_US=void 0,t.INT=function(e){return e.toString()},t.JID=j,t.LONG_INT=function(e){return(0,s.longIntToDecimalString)(e)},t.MAYBE_CUSTOM_STRING=function(e){if(null==e)return E;return e},t.PARTICIPANT_JID=function(e){return"status"===e.type||"group"===e.type||"broadcast"===e.type?j(e.author):E},t.S_WHATSAPP_NET=t.STATUS_BROADCAST=void 0,t.TO_JID=function(e){return j(Y(e))},t.TO_WAP_JID=function(e){return"device"===e.jidType?j(e.deviceJid):"user"===e.jidType?j(e.userJid):"group"===e.jidType?j(e.groupJid):"status"===e.jidType?j(e.statusJid):"call"===e.jidType?j(e.callJid):"lidUser"===e.jidType?j(e.lidUserJid):"lidDevice"===e.jidType?j(e.lidDeviceJid):(e.jidType,j(e.broadcastJid))},t.USER_JID=function(e){return j(e)},t.WapNode=void 0,t.decodeAsString=function(e){if(e instanceof l.WapJid)return e.toString();return e},t.decodeStanza=function(e,t){const r=new i.Binary(e);if(2&r.readUint8())return __LOG__(2)`Decoding compressed stanza`,t(r.readByteArray()).then((e=>F(new i.Binary(e))));return Promise.resolve(F(r))},t.encodeStanza=function(e){const t=e instanceof C?e:M(e),r=new i.Binary;O(t,r);const n=r.readByteArray(),a=new Uint8Array(1+n.length);return a[0]=0,a.set(n,1),a},t.extractParticipantJid=function(e){switch(e.type){case"group":case"status":case"broadcast":return e.author;default:return e.type,null}},t.extractToJid=Y,t.generateId=function(){if(!g){const e=new Uint16Array(2);self.crypto.getRandomValues(e),g=`${String(e[0])}.${String(e[1])}-`}return`${g}${y++}`},t.makeStanza=M,t.makeWapNode=b,t.wap=void 0;var i=r(8584),a=r(52230),s=r(8243),o=r(27498),l=r(45506),c=(n(r(17890)),r(74277));const d=a.MSGR_USER_DOMAIN.replace("@",""),u=a.WA_USER_DOMAIN.replace("@",""),p=[236,237,238,239],h=248,f=249,_=["0","1","2","3","4","5","6","7","8","9","-",".","�","�","�","�"],m=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];let g="",y=1;const E={sentinel:"DROP_ATTR"};t.DROP_ATTR=E;const S=l.WapJid.create(null,"g.us");t.G_US=S;const v=l.WapJid.create(null,a.WA_SERVER_DOMAIN);t.S_WHATSAPP_NET=v;const T=l.WapJid.create("status","broadcast");t.STATUS_BROADCAST=T;const A={};class C{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=r}toString(){let e="<"+this.tag;e+=(0,c.attrsToString)(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:e+=t?`>${(0,c.uint8ArrayToDebugString)(t)}</${this.tag}>`:" />",e}}function b(e,t,r){let n=null;if(t&&null!=t.children)throw new Error('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(r))n=r.filter(Boolean);else if("string"==typeof r)n=i.Binary.build(r).readByteArray();else if(r instanceof ArrayBuffer)n=new Uint8Array(r);else if(r instanceof Uint8Array)n=r;else{const e=[];for(let t=2;t<arguments.length;t++){const r=arguments[t];r&&e.push(r)}n=e}Array.isArray(n)&&0===n.length&&(n=null);const a={};if(t){const r=t;Object.keys(r).forEach((t=>{const n=r[t];if(null==n)throw new Error(`Attr ${t} in <${e}> is null`);n!==E&&(a[t]=n)}))}return new C(e,a,n)}t.WapNode=C;const P=b;function M(e){let t=e.content;return Array.isArray(t)?t=t.map(M):"string"==typeof t&&(t=i.Binary.build(t).readByteArray()),new C(e.tag,e.attrs||A,t)}function O(e,t){if(null==e)t.writeUint8(0);else if(e instanceof C)I(e,t);else if(e instanceof l.WapJid)!function(e,t){const r=e.getInnerJid();if(r.type===l.WAP_JID_SUBTYPE.JID_AD){const{user:e,agent:n,device:i}=r;t.writeUint8(247),t.writeUint8(n),t.writeUint8(i),O(e,t)}else if(r.type===l.WAP_JID_SUBTYPE.JID_FB){const{user:e,device:n}=r;t.writeUint8(246),O(e,t),t.writeUint16(n),O(u,t)}else{const{user:e,server:n}=r;t.writeUint8(250),null!=e?O(e,t):t.writeUint8(0),O(n,t)}}(e,t);else if("string"==typeof e)N(e,t);else{if(!(e instanceof Uint8Array))throw new Error("Invalid payload type "+typeof e);!function(e,t){k(e.length,t),t.writeByteArray(e)}(e,t)}}function I(e,t){if(void 0===e.tag)return t.writeUint8(h),void t.writeUint8(0);let r=1;e.attrs&&(r+=2*Object.keys(e.attrs).length),e.content&&r++,r<256?(t.writeUint8(h),t.writeUint8(r)):r<65536&&(t.writeUint8(f),t.writeUint16(r)),O(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach((r=>{N(r,t),O(e.attrs[r],t)}));const n=e.content;if(Array.isArray(n)){n.length<256?(t.writeUint8(h),t.writeUint8(n.length)):n.length<65536&&(t.writeUint8(f),t.writeUint16(n.length));for(let e=0;e<n.length;e++)I(n[e],t)}else n&&O(n,t)}let w,R;function D(e){const t=new Map;for(let r=0;r<e.length;r++)t.set(e[r],r);return t}function N(e,t){if(""===e)return t.writeUint8(252),void t.writeUint8(0);null==w&&(w=D(o.SINGLE_BYTE_TOKEN));const r=w.get(e);if(null!=r)return void t.writeUint8(r+1);if(null==R){R=[];for(let e=0;e<o.DICTIONARIES.length;++e)R.push(D(o.DICTIONARIES[e]))}for(let r=0;r<R.length;++r){const n=R[r].get(e);if(null!=n)return t.writeUint8(p[r]),void t.writeUint8(n)}const n=(0,i.numUtf8Bytes)(e);if(n<128){if(!/[^0-9.-]+?/.exec(e))return void L(e,255,t);if(!/[^0-9A-F]+?/.exec(e))return void L(e,251,t)}k(n,t),t.writeString(e)}function L(e,t,r){const n=e.length%2==1;r.writeUint8(t);let i=Math.ceil(e.length/2);n&&(i|=128),r.writeUint8(i);let a=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);let s=null;if(48<=i&&i<=57?s=i-48:255===t?45===i?s=10:46===i&&(s=11):251===t&&65<=i&&i<=70&&(s=i-55),null==s)throw new Error(`Cannot nibble encode ${i}`);n%2==0?(a=s<<4,n===e.length-1&&(a|=15,r.writeUint8(a))):(a|=s,r.writeUint8(a))}}function k(e,t){if(e<256)t.writeUint8(252),t.writeUint8(e);else if(e<1048576)t.writeUint8(253),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(255&e);else{if(!(e<4294967296))throw new Error(`Binary with length ${e} is too big for WAP protocol`);t.writeUint8(254),t.writeUint32(e)}}function G(e,t){const r=e.readUint8();if(0===r)return null;if(r===h)return U(e,e.readUint8());if(r===f)return U(e,e.readUint16());if(252===r){const r=e.readUint8();return B(e,r,t)}if(253===r){const r=e.readUint8(),n=e.readUint8(),i=e.readUint8();return B(e,((15&r)<<16)+(n<<8)+i,t)}if(254===r){const r=e.readUint32();return B(e,r,t)}if(250===r)return function(e){const t=function(e){const t=G(e,!0);if(null!=t&&"string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}(e),r=x(e);return l.WapJid.create(t,r)}(e);if(246===r)return function(e){const t=x(e),r=e.readUint16();return x(e),l.WapJid.createFbJid(t,r)}(e);if(247===r)return function(e){const t=e.readUint8(),r=e.readUint8(),n=x(e);return l.WapJid.createAD(n,t,r)}(e);if(255===r){const t=e.readUint8();return K(e,_,t>>>7,127&t)}if(251===r){const t=e.readUint8();return K(e,m,t>>>7,127&t)}if(r<=0||r>=240)throw new Error("Unable to decode WAP buffer");if(r>=236&&r<=239){const t=r-236,n=o.DICTIONARIES[t];if(void 0===n)throw new Error(`Missing WAP dictionary ${t}`);const i=e.readUint8(),a=n[i];if(void 0===a)throw new Error(`Invalid value index ${i} in dict ${t}`);return a}const n=o.SINGLE_BYTE_TOKEN[r-1];if(void 0===n)throw new Error(`Undefined token with index ${r}`);return n}function U(e,t){const r=[];for(let n=0;n<t;n++)r.push(F(e));return r}function F(e){const t=e.readUint8();let r,n;if(t===h)r=e.readUint8();else{if(t!==f)throw new Error(`Failed to decode node since type byte ${String(t)} is invalid`);r=e.readUint16()}let i=null;if(0===r)throw new Error("Failed to decode node, list cannot be empty");const a=x(e);for(r-=1;r>1;){n||(n={});const t=x(e),i=G(e,!0);n[t]=i,r-=2}return 1===r&&(i=G(e,!1),i instanceof l.WapJid&&(i=String(i))),new C(a,n,i)}function x(e){const t=G(e,!0);if("string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}function B(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?e.readString(t):e.readByteArray(t)}function K(e,t,r,n){const i=new Array(2*n-r);for(let r=0;r<i.length-1;r+=2){const n=e.readUint8();i[r]=t[n>>>4],i[r+1]=t[15&n]}if(r){const r=e.readUint8();i[i.length-1]=t[r>>>4]}return i.join("")}function Y(e){switch(e.type){case"group":return e.groupJid;case"status":return a.STATUS_JID;case"device":return e.deviceJid;default:return e.type,e.broadcastJid}}function j(e){let[t,r]=e.split("@"),n=null,i=null;return r!==u&&r!==d||(-1!==t.indexOf(":")&&([t,i]=t.split(":"),i=parseInt(i,10)),-1!==t.indexOf(".")&&([t,n]=t.split("."),n=parseInt(n,10))),r===d?l.WapJid.createFbJid(t,i):null!=i&&0!==i||null!=n&&0!==n?l.WapJid.createAD(t,n,i):l.WapJid.create(t,r)}t.wap=P},27498:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SINGLE_BYTE_TOKEN=t.DICT_VERSION=t.DICTIONARY_3_TOKEN=t.DICTIONARY_2_TOKEN=t.DICTIONARY_1_TOKEN=t.DICTIONARY_0_TOKEN=t.DICTIONARIES=void 0;t.DICT_VERSION=2;t.SINGLE_BYTE_TOKEN=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","broadcast","status","message","notification","notify","to","jid","user","class","offline","g.us","result","mediatype","enc","skmsg","off_cnt","xmlns","presence","participants","ack","t","iq","device_hash","read","value","media","picture","chatstate","unavailable","text","urn:xmpp:whatsapp:push","devices","verified_name","contact","composing","edge_routing","routing_info","item","image","verified_level","get","fallback_hostname","2","media_conn","1","v","handshake","fallback_class","count","config","offline_preview","download_buckets","w:profile:picture","set","creation","location","fallback_ip4","msg","urn:xmpp:ping","fallback_ip6","call-creator","relaylatency","success","subscribe","video","business_hours_config","platform","hostname","version","unknown","0","ping","hash","edit","subject","max_buckets","download","delivery","props","sticker","name","last","contacts","business","primary","preview","w:p","pkmsg","call-id","retry","prop","call","auth_ttl","available","relay_id","last_id","day_of_week","w","host","seen","bits","list","atn","upload","is_new","w:stats","key","paused","specific_hours","multicast","stream:error","mmg.whatsapp.net","code","deny","played","profile","fna","device-list","close_time","latency","gcm","pop","audio","26","w:web","open_time","error","auth","ip4","update","profile_options","config_value","category","catalog_not_created","00","config_code","mode","catalog_status","ip6","blocklist","registration","7","web","fail","w:m","cart_enabled","ttl","gif","300","device_orientation","identity","query","401","media-gig2-1.cdn.whatsapp.net","in","3","te2","add","fallback","categories","ptt","encrypt","notice","thumbnail-document","item-not-found","12","thumbnail-image","stage","thumbnail-link","usync","out","thumbnail-video","8","01","context","sidelist","thumbnail-gif","terminate","not-authorized","orientation","dhash","capability","side_list","md-app-state","description","serial","readreceipts","te","business_hours","md-msg-hist","tag","attribute_padding","document","open_24h","delete","expiration","active","prev_v_id","true","passive","index","4","conflict","remove","w:gp2","config_expo_key","screen_height","replaced","02","screen_width","uploadfieldstat","2:47DEQpj8","media-bog1-1.cdn.whatsapp.net","encopt","url","catalog_exists","keygen","rate","offer","opus","media-mia3-1.cdn.whatsapp.net","privacy","media-mia3-2.cdn.whatsapp.net","signature","preaccept","token_id","media-eze1-1.cdn.whatsapp.net"];const r=["media-for1-1.cdn.whatsapp.net","relay","media-gru2-2.cdn.whatsapp.net","uncompressed","medium","voip_settings","device","reason","media-lim1-1.cdn.whatsapp.net","media-qro1-2.cdn.whatsapp.net","media-gru1-2.cdn.whatsapp.net","action","features","media-gru2-1.cdn.whatsapp.net","media-gru1-1.cdn.whatsapp.net","media-otp1-1.cdn.whatsapp.net","kyc-id","priority","phash","mute","token","100","media-qro1-1.cdn.whatsapp.net","none","media-mrs2-2.cdn.whatsapp.net","sign_credential","03","media-mrs2-1.cdn.whatsapp.net","protocol","timezone","transport","eph_setting","1080","original_dimensions","media-frx5-1.cdn.whatsapp.net","background","disable","original_image_url","5","transaction-id","direct_path","103","appointment_only","request_image_url","peer_pid","address","105","104","102","media-cdt1-1.cdn.whatsapp.net","101","109","110","106","background_location","v_id","sync","status-old","111","107","ppic","media-scl2-1.cdn.whatsapp.net","business_profile","108","invite","04","audio_duration","media-mct1-1.cdn.whatsapp.net","media-cdg2-1.cdn.whatsapp.net","media-los2-1.cdn.whatsapp.net","invis","net","voip_payload_type","status-revoke-delay","404","state","use_correct_order_for_hmac_sha1","ver","media-mad1-1.cdn.whatsapp.net","order","540","skey","blinded_credential","android","contact_remove","enable_downlink_relay_latency_only","duration","enable_vid_one_way_codec_nego","6","media-sof1-1.cdn.whatsapp.net","accept","all","signed_credential","media-atl3-1.cdn.whatsapp.net","media-lhr8-1.cdn.whatsapp.net","website","05","latitude","media-dfw5-1.cdn.whatsapp.net","forbidden","enable_audio_piggyback_network_mtu_fix","media-dfw5-2.cdn.whatsapp.net","note.m4r","media-atl3-2.cdn.whatsapp.net","jb_nack_discard_count_fix","longitude","Opening.m4r","media-arn2-1.cdn.whatsapp.net","email","timestamp","admin","media-pmo1-1.cdn.whatsapp.net","America/Sao_Paulo","contact_add","media-sin6-1.cdn.whatsapp.net","interactive","8000","acs_public_key","sigquit_anr_detector_release_rollover_percent","media.fmed1-2.fna.whatsapp.net","groupadd","enabled_for_video_upgrade","latency_update_threshold","media-frt3-2.cdn.whatsapp.net","calls_row_constraint_layout","media.fgbb2-1.fna.whatsapp.net","mms4_media_retry_notification_encryption_enabled","timeout","media-sin6-3.cdn.whatsapp.net","audio_nack_jitter_multiplier","jb_discard_count_adjust_pct_rc","audio_reserve_bps","delta","account_sync","default","media.fjed4-6.fna.whatsapp.net","06","lock_video_orientation","media-frt3-1.cdn.whatsapp.net","w:g2","media-sin6-2.cdn.whatsapp.net","audio_nack_algo_mask","media.fgbb2-2.fna.whatsapp.net","media.fmed1-1.fna.whatsapp.net","cond_range_target_bitrate","mms4_server_error_receipt_encryption_enabled","vid_rc_dyn","fri","cart_v1_1_order_message_changes_enabled","reg_push","jb_hist_deposit_value","privatestats","media.fist7-2.fna.whatsapp.net","thu","jb_discard_count_adjust_pct","mon","group_call_video_maximization_enabled","mms_cat_v1_forward_hot_override_enabled","audio_nack_new_rtt","media.fsub2-3.fna.whatsapp.net","media_upload_aggressive_retry_exponential_backoff_enabled","tue","wed","media.fruh4-2.fna.whatsapp.net","audio_nack_max_seq_req","max_rtp_audio_packet_resends","jb_hist_max_cdf_value","07","audio_nack_max_jb_delay","mms_forward_partially_downloaded_video","media-lcy1-1.cdn.whatsapp.net","resume","jb_inband_fec_aware","new_commerce_entry_point_enabled","480","payments_upi_generate_qr_amount_limit","sigquit_anr_detector_rollover_percent","media.fsdu2-1.fna.whatsapp.net","fbns","aud_pkt_reorder_pct","dec","stop_probing_before_accept_send","media_upload_max_aggressive_retries","edit_business_profile_new_mode_enabled","media.fhex4-1.fna.whatsapp.net","media.fjed4-3.fna.whatsapp.net","sigquit_anr_detector_64bit_rollover_percent","cond_range_ema_jb_last_delay","watls_enable_early_data_http_get","media.fsdu2-2.fna.whatsapp.net","message_qr_disambiguation_enabled","media-mxp1-1.cdn.whatsapp.net","sat","vertical","media.fruh4-5.fna.whatsapp.net","200","media-sof1-2.cdn.whatsapp.net","-1","height","product_catalog_hide_show_items_enabled","deep_copy_frm_last","tsoffline","vp8/h.264","media.fgye5-3.fna.whatsapp.net","media.ftuc1-2.fna.whatsapp.net","smb_upsell_chat_banner_enabled","canonical","08","9",".","media.fgyd4-4.fna.whatsapp.net","media.fsti4-1.fna.whatsapp.net","mms_vcache_aggregation_enabled","mms_hot_content_timespan_in_seconds","nse_ver","rte","third_party_sticker_web_sync","cond_range_target_total_bitrate","media_upload_aggressive_retry_enabled","instrument_spam_report_enabled","disable_reconnect_tone","move_media_folder_from_sister_app","one_tap_calling_in_group_chat_size","10","storage_mgmt_banner_threshold_mb","enable_backup_passive_mode","sharechat_inline_player_enabled","media.fcnq2-1.fna.whatsapp.net","media.fhex4-2.fna.whatsapp.net","media.fist6-3.fna.whatsapp.net","ephemeral_drop_column_stage","reconnecting_after_network_change_threshold_ms","media-lhr8-2.cdn.whatsapp.net","cond_jb_last_delay_ema_alpha","entry_point_block_logging_enabled","critical_event_upload_log_config","respect_initial_bitrate_estimate","smaller_image_thumbs_status_enabled","media.fbtz1-4.fna.whatsapp.net","media.fjed4-1.fna.whatsapp.net","width","720","enable_frame_dropper","enable_one_side_mode","urn:xmpp:whatsapp:dirty","new_sticker_animation_behavior_v2","media.flim3-2.fna.whatsapp.net","media.fuio6-2.fna.whatsapp.net","skip_forced_signaling","dleq_proof","status_video_max_bitrate","lazy_send_probing_req","enhanced_storage_management","android_privatestats_endpoint_dit_enabled","media.fscl13-2.fna.whatsapp.net","video_duration"];t.DICTIONARY_0_TOKEN=r;const n=["group_call_discoverability_enabled","media.faep9-2.fna.whatsapp.net","msgr","bloks_loggedin_access_app_id","db_status_migration_step","watls_prefer_ip6","jabber:iq:privacy","68","media.fsaw1-11.fna.whatsapp.net","mms4_media_conn_persist_enabled","animated_stickers_thread_clean_up","media.fcgk3-2.fna.whatsapp.net","media.fcgk4-6.fna.whatsapp.net","media.fgye5-2.fna.whatsapp.net","media.flpb1-1.fna.whatsapp.net","media.fsub2-1.fna.whatsapp.net","media.fuio6-3.fna.whatsapp.net","not-allowed","partial_pjpeg_bw_threshold","cap_estimated_bitrate","mms_chatd_resume_check_over_thrift","smb_upsell_business_profile_enabled","product_catalog_webclient","groups","sigquit_anr_detector_release_updated_rollout","syncd_key_rotation_enabled","media.fdmm2-1.fna.whatsapp.net","media-hou1-1.cdn.whatsapp.net","remove_old_chat_notifications","smb_biztools_deeplink_enabled","use_downloadable_filters_int","group_qr_codes_enabled","max_receipt_processing_time","optimistic_image_processing_enabled","smaller_video_thumbs_status_enabled","watls_early_data","reconnecting_before_relay_failover_threshold_ms","cond_range_packet_loss_pct","groups_privacy_blacklist","status-revoke-drop","stickers_animated_thumbnail_download","dedupe_transcode_shared_images","dedupe_transcode_shared_videos","media.fcnq2-2.fna.whatsapp.net","media.fgyd4-1.fna.whatsapp.net","media.fist7-1.fna.whatsapp.net","media.flim3-3.fna.whatsapp.net","add_contact_by_qr_enabled","https://faq.whatsapp.com/payments","multicast_limit_global","sticker_notification_preview","smb_better_catalog_list_adapters_enabled","bloks_use_minscript_android","pen_smoothing_enabled","media.fcgk4-5.fna.whatsapp.net","media.fevn1-3.fna.whatsapp.net","media.fpoj7-1.fna.whatsapp.net","media-arn2-2.cdn.whatsapp.net","reconnecting_before_network_change_threshold_ms","android_media_use_fresco_for_gifs","cond_in_congestion","status_image_max_edge","sticker_search_enabled","starred_stickers_web_sync","db_blank_me_jid_migration_step","media.fist6-2.fna.whatsapp.net","media.ftuc1-1.fna.whatsapp.net","09","anr_fast_logs_upload_rollout","camera_core_integration_enabled","11","third_party_sticker_caching","thread_dump_contact_support","wam_privatestats_enabled","vcard_as_document_size_kb","maxfpp","fbip","ephemeral_allow_group_members","media-bom1-2.cdn.whatsapp.net","media-xsp1-1.cdn.whatsapp.net","disable_prewarm","frequently_forwarded_max","media.fbtz1-5.fna.whatsapp.net","media.fevn7-1.fna.whatsapp.net","media.fgyd4-2.fna.whatsapp.net","sticker_tray_animation_fully_visible_items","green_alert_banner_duration","reconnecting_after_p2p_failover_threshold_ms","connected","share_biz_vcard_enabled","stickers_animation","0a","1200","WhatsApp","group_description_length","p_v_id","payments_upi_intent_transaction_limit","frequently_forwarded_messages","media-xsp1-2.cdn.whatsapp.net","media.faep8-1.fna.whatsapp.net","media.faep8-2.fna.whatsapp.net","media.faep9-1.fna.whatsapp.net","media.fdmm2-2.fna.whatsapp.net","media.fgzt3-1.fna.whatsapp.net","media.flim4-2.fna.whatsapp.net","media.frao1-1.fna.whatsapp.net","media.fscl9-2.fna.whatsapp.net","media.fsub2-2.fna.whatsapp.net","superadmin","media.fbog10-1.fna.whatsapp.net","media.fcgh28-1.fna.whatsapp.net","media.fjdo10-1.fna.whatsapp.net","third_party_animated_sticker_import","delay_fec","attachment_picker_refresh","android_linked_devices_re_auth_enabled","rc_dyn","green_alert_block_jitter","add_contact_logging_enabled","biz_message_logging_enabled","conversation_media_preview_v2","media-jnb1-1.cdn.whatsapp.net","ab_key","media.fcgk4-2.fna.whatsapp.net","media.fevn1-1.fna.whatsapp.net","media.fist6-1.fna.whatsapp.net","media.fruh4-4.fna.whatsapp.net","media.fsti4-2.fna.whatsapp.net","mms_vcard_autodownload_size_kb","watls_enabled","notif_ch_override_off","media.fsaw1-14.fna.whatsapp.net","media.fscl13-1.fna.whatsapp.net","db_group_participant_migration_step","1020","cond_range_sterm_rtt","invites_logging_enabled","triggered_block_enabled","group_call_max_participants","media-iad3-1.cdn.whatsapp.net","product_catalog_open_deeplink","shops_required_tos_version","image_max_kbytes","cond_low_quality_vid_mode","db_receipt_migration_step","jb_early_prob_hist_shrink","media.fdmm2-3.fna.whatsapp.net","media.fdmm2-4.fna.whatsapp.net","media.fruh4-1.fna.whatsapp.net","media.fsaw2-2.fna.whatsapp.net","remove_geolocation_videos","new_animation_behavior","fieldstats_beacon_chance","403","authkey_reset_on_ban","continuous_ptt_playback","reconnecting_after_relay_failover_threshold_ms","false","group","sun","conversation_swipe_to_reply","ephemeral_messages_setting","smaller_video_thumbs_enabled","md_device_sync_enabled","bloks_shops_pdp_url_regex","lasso_integration_enabled","media-bom1-1.cdn.whatsapp.net","new_backup_format_enabled","256","media.faep6-1.fna.whatsapp.net","media.fasr1-1.fna.whatsapp.net","media.fbtz1-7.fna.whatsapp.net","media.fesb4-1.fna.whatsapp.net","media.fjdo1-2.fna.whatsapp.net","media.frba2-1.fna.whatsapp.net","watls_no_dns","600","db_broadcast_me_jid_migration_step","new_wam_runtime_enabled","group_update","enhanced_block_enabled","sync_wifi_threshold_kb","mms_download_nc_cat","bloks_minification_enabled","ephemeral_messages_enabled","reject","voip_outgoing_xml_signaling","creator","dl_bw","payments_request_messages","target_bitrate","bloks_rendercore_enabled","media-hbe1-1.cdn.whatsapp.net","media-hel3-1.cdn.whatsapp.net","media-kut2-2.cdn.whatsapp.net","media-lax3-1.cdn.whatsapp.net","media-lax3-2.cdn.whatsapp.net","sticker_pack_deeplink_enabled","hq_image_bw_threshold","status_info","voip","dedupe_transcode_videos","grp_uii_cleanup","linked_device_max_count","media.flim1-1.fna.whatsapp.net","media.fsaw2-1.fna.whatsapp.net","reconnecting_after_call_active_threshold_ms","1140","catalog_pdp_new_design","media.fbtz1-10.fna.whatsapp.net","media.fsaw1-15.fna.whatsapp.net","0b","consumer_rc_provider","mms_async_fast_forward_ttl","jb_eff_size_fix","voip_incoming_xml_signaling","media_provider_share_by_uuid","suspicious_links","dedupe_transcode_images","green_alert_modal_start","media-cgk1-1.cdn.whatsapp.net","media-lga3-1.cdn.whatsapp.net","template_doc_mime_types","important_messages","user_add","vcard_max_size_kb","media.fada2-1.fna.whatsapp.net","media.fbog2-5.fna.whatsapp.net","media.fbtz1-3.fna.whatsapp.net","media.fcgk3-1.fna.whatsapp.net","media.fcgk7-1.fna.whatsapp.net","media.flim1-3.fna.whatsapp.net","media.fscl9-1.fna.whatsapp.net","ctwa_context_enterprise_enabled","media.fsaw1-13.fna.whatsapp.net","media.fuio11-2.fna.whatsapp.net","status_collapse_muted","db_migration_level_force","recent_stickers_web_sync","bloks_session_state","bloks_shops_enabled","green_alert_setting_deep_links_enabled","restrict_groups","battery","green_alert_block_start","refresh","ctwa_context_enabled","md_messaging_enabled","status_image_quality","md_blocklist_v2_server","media-del1-1.cdn.whatsapp.net","13","userrate","a_v_id","cond_rtt_ema_alpha","invalid"];t.DICTIONARY_1_TOKEN=n;const i=["media.fada1-1.fna.whatsapp.net","media.fadb3-2.fna.whatsapp.net","media.fbhz2-1.fna.whatsapp.net","media.fcor2-1.fna.whatsapp.net","media.fjed4-2.fna.whatsapp.net","media.flhe4-1.fna.whatsapp.net","media.frak1-2.fna.whatsapp.net","media.fsub6-3.fna.whatsapp.net","media.fsub6-7.fna.whatsapp.net","media.fvvi1-1.fna.whatsapp.net","search_v5_eligible","wam_real_time_enabled","report_disk_event","max_tx_rott_based_bitrate","product","media.fjdo10-2.fna.whatsapp.net","video_frame_crc_sample_interval","media_max_autodownload","15","h.264","wam_privatestats_buffer_count","md_phash_v2_enabled","account_transfer_enabled","business_product_catalog","enable_non_dyn_codec_param_fix","is_user_under_epd_jurisdiction","media.fbog2-4.fna.whatsapp.net","media.fbtz1-2.fna.whatsapp.net","media.fcfc1-1.fna.whatsapp.net","media.fjed4-5.fna.whatsapp.net","media.flhe4-2.fna.whatsapp.net","media.flim1-2.fna.whatsapp.net","media.flos5-1.fna.whatsapp.net","android_key_store_auth_ver","010","anr_process_monitor","delete_old_auth_key","media.fcor10-3.fna.whatsapp.net","storage_usage_enabled","android_camera2_support_level","dirty","consumer_content_provider","status_video_max_duration","0c","bloks_cache_enabled","media.fadb2-2.fna.whatsapp.net","media.fbko1-1.fna.whatsapp.net","media.fbtz1-9.fna.whatsapp.net","media.fcgk4-4.fna.whatsapp.net","media.fesb4-2.fna.whatsapp.net","media.fevn1-2.fna.whatsapp.net","media.fist2-4.fna.whatsapp.net","media.fjdo1-1.fna.whatsapp.net","media.fruh4-6.fna.whatsapp.net","media.fsrg5-1.fna.whatsapp.net","media.fsub6-6.fna.whatsapp.net","minfpp","5000","locales","video_max_bitrate","use_new_auth_key","bloks_http_enabled","heartbeat_interval","media.fbog11-1.fna.whatsapp.net","ephemeral_group_query_ts","fec_nack","search_in_storage_usage","c","media-amt2-1.cdn.whatsapp.net","linked_devices_ui_enabled","14","async_data_load_on_startup","voip_incoming_xml_ack","16","db_migration_step","init_bwe","max_participants","wam_buffer_count","media.fada2-2.fna.whatsapp.net","media.fadb3-1.fna.whatsapp.net","media.fcor2-2.fna.whatsapp.net","media.fdiy1-2.fna.whatsapp.net","media.frba3-2.fna.whatsapp.net","media.fsaw2-3.fna.whatsapp.net","1280","status_grid_enabled","w:biz","product_catalog_deeplink","media.fgye10-2.fna.whatsapp.net","media.fuio11-1.fna.whatsapp.net","optimistic_upload","work_manager_init","lc","catalog_message","cond_net_medium","enable_periodical_aud_rr_processing","cond_range_ema_rtt","media-tir2-1.cdn.whatsapp.net","frame_ms","group_invite_sending","payments_web_enabled","wallpapers_v2","0d","browser","hq_image_max_edge","image_edit_zoom","linked_devices_re_auth_enabled","media.faly3-2.fna.whatsapp.net","media.fdoh5-3.fna.whatsapp.net","media.fesb3-1.fna.whatsapp.net","media.fknu1-1.fna.whatsapp.net","media.fmex3-1.fna.whatsapp.net","media.fruh4-3.fna.whatsapp.net","255","web_upgrade_to_md_modal","audio_piggyback_timeout_msec","enable_audio_oob_fec_feature","from_ip","image_max_edge","message_qr_enabled","powersave","receipt_pre_acking","video_max_edge","full","011","012","enable_audio_oob_fec_for_sender","md_voip_enabled","enable_privatestats","max_fec_ratio","payments_cs_faq_url","media-xsp1-3.cdn.whatsapp.net","hq_image_quality","media.fasr1-2.fna.whatsapp.net","media.fbog3-1.fna.whatsapp.net","media.ffjr1-6.fna.whatsapp.net","media.fist2-3.fna.whatsapp.net","media.flim4-3.fna.whatsapp.net","media.fpbc2-4.fna.whatsapp.net","media.fpku1-1.fna.whatsapp.net","media.frba1-1.fna.whatsapp.net","media.fudi1-1.fna.whatsapp.net","media.fvvi1-2.fna.whatsapp.net","gcm_fg_service","enable_dec_ltr_size_check","clear","lg","media.fgru11-1.fna.whatsapp.net","18","media-lga3-2.cdn.whatsapp.net","pkey","0e","max_subject","cond_range_lterm_rtt","announcement_groups","biz_profile_options","s_t","media.fabv2-1.fna.whatsapp.net","media.fcai3-1.fna.whatsapp.net","media.fcgh1-1.fna.whatsapp.net","media.fctg1-4.fna.whatsapp.net","media.fdiy1-1.fna.whatsapp.net","media.fisb4-1.fna.whatsapp.net","media.fpku1-2.fna.whatsapp.net","media.fros9-1.fna.whatsapp.net","status_v3_text","usync_sidelist","17","announcement","...","md_group_notification","0f","animated_pack_in_store","013","America/Mexico_City","1260","media-ams4-1.cdn.whatsapp.net","media-cgk1-2.cdn.whatsapp.net","media-cpt1-1.cdn.whatsapp.net","media-maa2-1.cdn.whatsapp.net","media.fgye10-1.fna.whatsapp.net","e","catalog_cart","hfm_string_changes","init_bitrate","packless_hsm","group_info","America/Belem","50","960","cond_range_bwe","decode","encode","media.fada1-8.fna.whatsapp.net","media.fadb1-2.fna.whatsapp.net","media.fasu6-1.fna.whatsapp.net","media.fbog4-1.fna.whatsapp.net","media.fcgk9-2.fna.whatsapp.net","media.fdoh5-2.fna.whatsapp.net","media.ffjr1-2.fna.whatsapp.net","media.fgua1-1.fna.whatsapp.net","media.fgye1-1.fna.whatsapp.net","media.fist1-4.fna.whatsapp.net","media.fpbc2-2.fna.whatsapp.net","media.fres2-1.fna.whatsapp.net","media.fsdq1-2.fna.whatsapp.net","media.fsub6-5.fna.whatsapp.net","profilo_enabled","template_hsm","use_disorder_prefetching_timer","video_codec_priority","vpx_max_qp","ptt_reduce_recording_delay","25","iphone","Windows","s_o","Africa/Lagos","abt","media-kut2-1.cdn.whatsapp.net","media-mba1-1.cdn.whatsapp.net","media-mxp1-2.cdn.whatsapp.net","md_blocklist_v2","url_text","enable_short_offset","group_join_permissions","enable_audio_piggyback_feature","image_quality","media.fcgk7-2.fna.whatsapp.net","media.fcgk8-2.fna.whatsapp.net","media.fclo7-1.fna.whatsapp.net","media.fcmn1-1.fna.whatsapp.net","media.feoh1-1.fna.whatsapp.net","media.fgyd4-3.fna.whatsapp.net","media.fjed4-4.fna.whatsapp.net","media.flim1-4.fna.whatsapp.net","media.flim2-4.fna.whatsapp.net","media.fplu6-1.fna.whatsapp.net","media.frak1-1.fna.whatsapp.net","media.fsdq1-1.fna.whatsapp.net","to_ip","015","vp8","19","21","1320","auth_key_ver","message_processing_dedup","server-error","wap4_enabled","420","014","cond_range_rtt","ptt_fast_lock_enabled","media-ort2-1.cdn.whatsapp.net","fwd_ui_start_ts"];t.DICTIONARY_2_TOKEN=i;const a=["contact_blacklist","Asia/Jakarta","media.fepa10-1.fna.whatsapp.net","media.fmex10-3.fna.whatsapp.net","disorder_prefetching_start_when_empty","America/Bogota","use_local_probing_rx_bitrate","America/Argentina/Buenos_Aires","cross_post","media.fabb1-1.fna.whatsapp.net","media.fbog4-2.fna.whatsapp.net","media.fcgk9-1.fna.whatsapp.net","media.fcmn2-1.fna.whatsapp.net","media.fdel3-1.fna.whatsapp.net","media.ffjr1-1.fna.whatsapp.net","media.fgdl5-1.fna.whatsapp.net","media.flpb1-2.fna.whatsapp.net","media.fmex2-1.fna.whatsapp.net","media.frba2-2.fna.whatsapp.net","media.fros2-2.fna.whatsapp.net","media.fruh2-1.fna.whatsapp.net","media.fybz2-2.fna.whatsapp.net","options","20","a","017","018","mute_always","user_notice","Asia/Kolkata","gif_provider","locked","media-gua1-1.cdn.whatsapp.net","piggyback_exclude_force_flush","24","media.frec39-1.fna.whatsapp.net","user_remove","file_max_size","cond_packet_loss_pct_ema_alpha","media.facc1-1.fna.whatsapp.net","media.fadb2-1.fna.whatsapp.net","media.faly3-1.fna.whatsapp.net","media.fbdo6-2.fna.whatsapp.net","media.fcmn2-2.fna.whatsapp.net","media.fctg1-3.fna.whatsapp.net","media.ffez1-2.fna.whatsapp.net","media.fist1-3.fna.whatsapp.net","media.fist2-2.fna.whatsapp.net","media.flim2-2.fna.whatsapp.net","media.fmct2-3.fna.whatsapp.net","media.fpei3-1.fna.whatsapp.net","media.frba3-1.fna.whatsapp.net","media.fsdu8-2.fna.whatsapp.net","media.fstu2-1.fna.whatsapp.net","media_type","receipt_agg","016","enable_pli_for_crc_mismatch","live","enc_rekey","frskmsg","d","media.fdel11-2.fna.whatsapp.net","proto","2250","audio_piggyback_enable_cache","skip_nack_if_ltrp_sent","mark_dtx_jb_frames","web_service_delay","7282","catalog_send_all","outgoing","360","30","LIMITED","019","audio_picker","bpv2_phase","media.fada1-7.fna.whatsapp.net","media.faep7-1.fna.whatsapp.net","media.fbko1-2.fna.whatsapp.net","media.fbni1-2.fna.whatsapp.net","media.fbtz1-1.fna.whatsapp.net","media.fbtz1-8.fna.whatsapp.net","media.fcjs3-1.fna.whatsapp.net","media.fesb3-2.fna.whatsapp.net","media.fgdl5-4.fna.whatsapp.net","media.fist2-1.fna.whatsapp.net","media.flhe2-2.fna.whatsapp.net","media.flim2-1.fna.whatsapp.net","media.fmex1-1.fna.whatsapp.net","media.fpat3-2.fna.whatsapp.net","media.fpat3-3.fna.whatsapp.net","media.fros2-1.fna.whatsapp.net","media.fsdu8-1.fna.whatsapp.net","media.fsub3-2.fna.whatsapp.net","payments_chat_plugin","cond_congestion_no_rtcp_thr","green_alert","not-a-biz","..","shops_pdp_urls_config","source","media-dus1-1.cdn.whatsapp.net","mute_video","01b","currency","max_keys","resume_check","contact_array","qr_scanning","23","b","media.fbfh15-1.fna.whatsapp.net","media.flim22-1.fna.whatsapp.net","media.fsdu11-1.fna.whatsapp.net","media.fsdu15-1.fna.whatsapp.net","Chrome","fts_version","60","media.fada1-6.fna.whatsapp.net","media.faep4-2.fna.whatsapp.net","media.fbaq5-1.fna.whatsapp.net","media.fbni1-1.fna.whatsapp.net","media.fcai3-2.fna.whatsapp.net","media.fdel3-2.fna.whatsapp.net","media.fdmm3-2.fna.whatsapp.net","media.fhex3-1.fna.whatsapp.net","media.fisb4-2.fna.whatsapp.net","media.fkhi5-2.fna.whatsapp.net","media.flos2-1.fna.whatsapp.net","media.fmct2-1.fna.whatsapp.net","media.fntr7-1.fna.whatsapp.net","media.frak3-1.fna.whatsapp.net","media.fruh5-2.fna.whatsapp.net","media.fsub6-1.fna.whatsapp.net","media.fuab1-2.fna.whatsapp.net","media.fuio1-1.fna.whatsapp.net","media.fver1-1.fna.whatsapp.net","media.fymy1-1.fna.whatsapp.net","product_catalog","1380","audio_oob_fec_max_pkts","22","254","media-ort2-2.cdn.whatsapp.net","media-sjc3-1.cdn.whatsapp.net","1600","01a","01c","405","key_frame_interval","body","media.fcgh20-1.fna.whatsapp.net","media.fesb10-2.fna.whatsapp.net","125","2000","media.fbsb1-1.fna.whatsapp.net","media.fcmn3-2.fna.whatsapp.net","media.fcpq1-1.fna.whatsapp.net","media.fdel1-2.fna.whatsapp.net","media.ffor2-1.fna.whatsapp.net","media.fgdl1-4.fna.whatsapp.net","media.fhex2-1.fna.whatsapp.net","media.fist1-2.fna.whatsapp.net","media.fjed5-2.fna.whatsapp.net","media.flim6-4.fna.whatsapp.net","media.flos2-2.fna.whatsapp.net","media.fntr6-2.fna.whatsapp.net","media.fpku3-2.fna.whatsapp.net","media.fros8-1.fna.whatsapp.net","media.fymy1-2.fna.whatsapp.net","ul_bw","ltrp_qp_offset","request","nack","dtx_delay_state_reset","timeoffline","28","01f","32","enable_ltr_pool","wa_msys_crypto","01d","58","dtx_freeze_hg_update","nack_if_rpsi_throttled","253","840","media.famd15-1.fna.whatsapp.net","media.fbog17-2.fna.whatsapp.net","media.fcai19-2.fna.whatsapp.net","media.fcai21-4.fna.whatsapp.net","media.fesb10-4.fna.whatsapp.net","media.fesb10-5.fna.whatsapp.net","media.fmaa12-1.fna.whatsapp.net","media.fmex11-3.fna.whatsapp.net","media.fpoa33-1.fna.whatsapp.net","1050","021","clean","cond_range_ema_packet_loss_pct","media.fadb6-5.fna.whatsapp.net","media.faqp4-1.fna.whatsapp.net","media.fbaq3-1.fna.whatsapp.net","media.fbel2-1.fna.whatsapp.net","media.fblr4-2.fna.whatsapp.net","media.fclo8-1.fna.whatsapp.net","media.fcoo1-2.fna.whatsapp.net","media.ffjr1-4.fna.whatsapp.net","media.ffor9-1.fna.whatsapp.net","media.fisb3-1.fna.whatsapp.net","media.fkhi2-2.fna.whatsapp.net","media.fkhi4-1.fna.whatsapp.net","media.fpbc1-2.fna.whatsapp.net","media.fruh2-2.fna.whatsapp.net","media.fruh5-1.fna.whatsapp.net","media.fsub3-1.fna.whatsapp.net","payments_transaction_limit","252","27","29","tintagel","01e","237","780","callee_updated_payload","020","257","price","025","239","payments_cs_phone_number","mediaretry","w:auth:backup:token","Glass.caf","max_bitrate","240","251","660","media.fbog16-1.fna.whatsapp.net","media.fcgh21-1.fna.whatsapp.net","media.fkul19-2.fna.whatsapp.net","media.flim21-2.fna.whatsapp.net","media.fmex10-4.fna.whatsapp.net","64","33","34","35","interruption","media.fabv3-1.fna.whatsapp.net","media.fadb6-1.fna.whatsapp.net","media.fagr1-1.fna.whatsapp.net","media.famd1-1.fna.whatsapp.net","media.famm6-1.fna.whatsapp.net","media.faqp2-3.fna.whatsapp.net"];t.DICTIONARY_3_TOKEN=a;const s=[r,n,i,a];t.DICTIONARIES=s},45506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapJid=t.WAP_JID_SUBTYPE=void 0;var n=r(52230);const i={JID:0,JID_AD:1,JID_FB:3};t.WAP_JID_SUBTYPE=i;class a{constructor(e){this._jid=e}static createAD(e,t,r){return new a({type:i.JID_AD,user:e,device:null==r?0:r,agent:null==t?0:t})}static createFbJid(e,t){return new a({type:i.JID_FB,user:e,device:null==t?0:t})}static create(e,t){return new a({type:i.JID,user:e,server:t})}toString(){if(this._jid.type===i.JID_AD){const{user:e,agent:t,device:r}=this._jid,i=n.WA_USER_JID_SUFFIX;return 0===t&&0===r?`${e}@${i}`:0!==t&&0===r?`${e}.${t}@${i}`:0===t&&0!==r?`${e}:${r}@${i}`:`${e}.${t}:${r}@${i}`}if(this._jid.type===i.JID_FB){const{user:e,device:t}=this._jid;return`${e}:${t}@${n.MSGR_USER_JID_SUFFIX}`}{this._jid.type;const{user:e,server:t}=this._jid;return null!=e?`${e}@${t}`:t}}getInnerJid(){return this._jid}}t.WapJid=a},71914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapParser=void 0;var n=r(34308);t.WapParser=class{constructor(e,t){this._name=e,this._parser=t}parse(e){const t=new n.ParsableWapNode(this._name,e);try{return{success:this._parser(t)}}catch(e){if(e instanceof n.XmppParsingFailure)return{error:e};throw e}}parseOrThrow(e){const t=this.parse(e);if(t.error)throw new Error(String(t.error));return t.success}}},61070:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_MEDIA_KEY_TTL=void 0,t.isMediaKeyReusable=function(e){const t=Math.floor(Math.random()*i);return null!=e&&(0,n.happenedWithin)(e,a+t)};var n=r(92844);const i=n.DAY_SECONDS,a=2*n.DAY_SECONDS;t.MMS_MEDIA_KEY_TTL=a},2555:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_MEDIA=void 0,t.castToServerMediaType=function(e){switch(e){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":return e;default:return null}};t.SERVER_MEDIA=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","novi-video","novi-image","product","product-catalog-image"]},71610:(e,t)=>{"use strict";function r(e){return 16*parseInt((e+15)/16,10)}Object.defineProperty(t,"__esModule",{value:!0}),t.alignChunkLengthsToMultipleOfAesBlockSize=function(e,t){const n=[];let i=0,a=0,s=0;for(let o=0;o<e.length;++o){if(i+=e[o],o===e.length-1&&null!=t){i>a?n.push(t-a):(n.pop(),n.push(t-s));break}if(i>a){const e=r(i-a);s=a,n.push(e),a+=e}}return n},t.alignChunkSizeToMultipleAesBlockSize=r},17525:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketClosed=t.FrameSocket=void 0;var n=r(8584);class i extends Error{constructor(e){const t="SocketClosed";super(null!=e?e:t),this.name=t}}t.SocketClosed=i;function a(e){if(e.size()<3)return!1;return s(e)<=e.size()}function s(e){return e.readUint8()<<16|e.readUint16()}t.FrameSocket=class{constructor(e,t){this._incoming=new n.Binary,this.closed=!1,this._draining=!1,this.onFrame=null,this.onClose=null,this._handleData=e=>{this._incoming.writeByteArray(e),this.convertBufferedToFrames()},this._handleClose=()=>{if(this._incoming.peek(a))return __LOG__(2)`FrameSocket closed, waiting for pending processing`,void(this._draining=!0);this._doClose()},this._doClose=()=>{if(this.closed)return;__LOG__(2)`FrameSocket closed`,this._draining=!1,this.closed=!0;const e=this.onClose;e&&e()},this._handleError=e=>{__LOG__(4,void 0,new Error)`FrameSocket error ${e}`},this._introToSend=t,this._socket=e,e.onData=this._handleData,e.onClose=this._handleClose,e.onError=this._handleError}sendFrame(e){if(this._draining)return;this.throwIfClosed();const t=this._introToSend,r=e.byteLength,n=this._socket.dataToSend;t?(this._introToSend=null,n.ensureAdditionalCapacity(t.length+3+r),n.writeByteArray(t)):n.ensureAdditionalCapacity(3+r),n.writeUint8(r>>16),n.writeUint16(65535&r),n.write(e),this._socket.requestSend()}convertBufferedToFrames(){const e=this._incoming;let t=this.onFrame;for(;t&&e.peek(a);){const r=s(e);__LOG__(2)`FrameSocket.onFrame(${r} bytes)`;t(e.readByteArray(r)),t=this.onFrame}this._draining&&!e.peek(a)&&this._doClose(),t&&e.size()&&__LOG__(2)`FrameSocket: queueing partial frame of ${e.size()} bytes`}throwIfClosed(){if(this.closed)throw new i}close(){this._socket.close()}}},10095:(e,t,r)=>{"use strict";var n=r(71954);Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseHandshake=void 0;var i=r(8584),a=n(r(81576)),s=r(11609),o=r(43891),l=r(88156);const c=Promise.reject("UNINITIALIZED HANDSHAKE"),d=new Uint8Array(0);c.catch((()=>{}));function u(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["encrypt","decrypt"];return self.crypto.subtle.importKey("raw",new Uint8Array(e),"AES-GCM",!1,t)}function h(e,t){return a.extract(new Uint8Array(e),t).then((e=>a.expand(new Uint8Array(e),"",64))).then((e=>[e.slice(0,32),e.slice(32)]))}function f(e){e.catch((()=>{}))}t.NoiseHandshake=class{constructor(e){this._hash=c,this._salt=c,this._cryptoKey=c,this._counter=0,this._socket=e,this._rejectOnClose=new l.Resolvable,e.onClose=()=>{this._rejectOnClose.reject(new s.Disconnected("NoiseHandshake: SocketClosed"))},f(this._rejectOnClose.promise)}start(e,t){const r=i.Binary.build(e).readBuffer(),n=32===r.byteLength?Promise.resolve(r):self.crypto.subtle.digest("SHA-256",r);this._hash=n,this._salt=n,this._cryptoKey=n.then(p),this.authenticate(t)}sendAndReceive(e){const t=this._socket,r=new Promise((r=>{t.onFrame=e=>{t.onFrame=null,r(e)},t.sendFrame(e)}));return this._orRejectOnClose(r)}send(e){this._socket.sendFrame(e)}authenticate(e){this._hash=Promise.all([this._hash,e]).then((e=>{let[t,r]=e;const n=i.Binary.build(t,r).readByteArray();return self.crypto.subtle.digest("SHA-256",n)}))}encrypt(e){const t=this._counter++,r=Promise.all([this._cryptoKey,this._hash,e]).then((e=>{let[r,n,i]=e;return function(e,t,r,n){return self.crypto.subtle.encrypt({name:"AES-GCM",iv:u(t),additionalData:r?new Uint8Array(r):d},e,n)}(r,t,n,i)}));return this.authenticate(r),this._orRejectOnClose(r)}decrypt(e){const t=this._counter++,r=Promise.all([this._cryptoKey,this._hash]).then((r=>{let[n,i]=r;return function(e,t,r,n){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:u(t),additionalData:r?new Uint8Array(r):d},e,n)}(n,t,i,e)}));return this.authenticate(e),this._orRejectOnClose(r)}finish(){const e=this._salt.then((e=>h(e,new Uint8Array(0)))).then((e=>{let[t,r]=e;return Promise.all([p(t,["encrypt"]),p(r,["decrypt"])])})).then((e=>{let[t,r]=e;return new o.NoiseSocket(this._socket,t,r)}));return this._orRejectOnClose(e)}mixIntoKey(e){this._counter=0;const t=Promise.all([this._salt,e]).then((e=>{let[t,r]=e;return h(t,new Uint8Array(r))}));this._salt=t.then((e=>e[0])),this._cryptoKey=t.then((e=>p(e[1]))),f(this._salt),f(this._cryptoKey)}_orRejectOnClose(e){return Promise.race([e,this._rejectOnClose.promise]).then((e=>this._rejectOnClose.resolveWasCalled()?this._rejectOnClose.promise:e))}}},43891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseSocket=void 0;var n=r(27870);const i=Promise.reject("UNINITIALIZED HANDSHAKE"),a=new Uint8Array(0);i.catch((()=>{}));function s(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}t.NoiseSocket=class{constructor(e,t,r){this._incoming=[],this._readQueue=new n.PromiseQueue,this._sendQueue=new n.PromiseQueue,this._readCounter=0,this._writeCounter=0,this._draining=!1,this._sendCiphertextFrame=e=>{this._socket.closed?__LOG__(2)`NoiseSocket socket closed while encrypting frame`:this._socket.sendFrame(e)},this._handleCiphertext=e=>{const t=this._readCounter++;this._readQueue.enqueueHandlers(function(e,t,r,n){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:s(t),additionalData:r?new Uint8Array(r):a},e,n)}(this._readKey,t,void 0,e),this._handlePlaintext)},this._handleOnClose=()=>{this._draining=!0,this._readQueue.wait().then((()=>{this._draining=!1;const e=this._onClose;e&&e()}))},this._handlePlaintext=e=>{this._onFrame?this._onFrame(e):this._incoming.push(e)},this._socket=e,this._writeKey=t,this._readKey=r,e.onFrame=this._handleCiphertext,this._socket.onClose=this._handleOnClose,e.convertBufferedToFrames()}sendFrame(e){if(this._draining)return;this._socket.throwIfClosed();const t=this._writeCounter++;var r,n,i,o;this._sendQueue.enqueueHandlers((r=this._writeKey,n=t,i=void 0,o=e,self.crypto.subtle.encrypt({name:"AES-GCM",iv:s(n),additionalData:i?new Uint8Array(i):a},r,o)),this._sendCiphertextFrame)}setOnFrame(e){this._onFrame=e}setOnClose(e){this._onClose=e}close(){this._socket.close()}}},65095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.doFullHandshake=d,t.openChatSocket=function(e,t){return e.openSocket().then((r=>{let u;Promise.resolve().then(t);const p=e.edgeInfo;if(p){const e=new n.Binary;e.write("ED",0,1),e.writeUint8(p.byteLength>>16),e.writeUint16(65535&p.byteLength),e.writeBuffer(p),u=e.readByteArray(),__LOG__(2)`openChatSocket preIntro ${u}`}const h=e.getClientPayload(),f=new i.Curve25519(e.curveSignalDependencies),_=u?n.Binary.build(u,e.protoHeader).readByteArray():e.protoHeader,m=new a.FrameSocket(r,_),g=e.serverInfoIfKnown();return g?(__LOG__(2)`openChatSocket performing resume handshake`,function(e,t,r,n,i){const a=new s.NoiseHandshake(e);a.start(o,i.protoHeader);const d=n.generatePublicKey();a.authenticate(r),a.authenticate(d),a.mixIntoKey(n.generateSharedSecret(r));const u=a.encrypt(i.staticKeyPair.generatePublicKey());a.mixIntoKey(i.staticKeyPair.generateSharedSecret(r));const p=a.encrypt(Promise.resolve(t));return Promise.all([d,p,u]).then((e=>{let[t,r,n]=e;return __LOG__(2)`resumeNoiseHandshake send hello`,a.sendAndReceive(i.encodeHandshakeHello({ephemeral:t,payload:r,static:n}))})).then((r=>{__LOG__(2)`resumeNoiseHandshake rcv hello`;const o=i.decodeServerHello(r),{ephemeral:d,static:u,payload:p}=o||{};if(null==u){if(__LOG__(2)`resumeNoiseHandshake continuing resume handshake`,!d)throw new Error("serverHello missing serverEphemeral");if(!p)throw new Error("serverHello missing certificateCiphertext");return a.authenticate(d),a.mixIntoKey(n.generateSharedSecret(d)),a.mixIntoKey(i.staticKeyPair.generateSharedSecret(d)),a.decrypt(p).then((()=>(__LOG__(2)`resumeNoiseHandshake deriving secrets`,a.finish())))}return __LOG__(2)`resumeNoiseHandshake performing fallback handshake`,function(e,t,r,n,i){const a=new s.NoiseHandshake(e);a.start(l,i.protoHeader);const o=n.generatePublicKey();return a.authenticate(o),__LOG__(2)`doFallbackHandshake continuing handshake with given server hello`,c(a,t,r,n,i)}(e,o,t,n,i)}))}(m,h,g.staticKey,f,e)):(__LOG__(2)`openChatSocket performing full handshake`,d(m,h,f,e))}))};var n=r(8584),i=r(1637),a=r(17525),s=r(10095);const o="Noise_IK_25519_AESGCM_SHA256\0\0\0\0",l="Noise_XXfallback_25519_AESGCM_SHA256";function c(e,t,r,n,i){const{ephemeral:a,static:s,payload:o}=t||{};if(null==a||null==s||null==o)return Promise.reject(new Error("doFullHandshakeCore server hello invalid proto"));e.authenticate(a),e.mixIntoKey(n.generateSharedSecret(a));const l=e.decrypt(s);e.mixIntoKey(l.then((e=>n.generateSharedSecret(e))));const c=e.decrypt(o);return Promise.all([l,c]).then((e=>{let[t,r]=e;return __LOG__(2)`doFullHandshakeCore parsing and verifying server certificate`,i.processCertificate({certificate:r,serverStatic:t})})).then((()=>{const t=e.encrypt(i.staticKeyPair.generatePublicKey());e.mixIntoKey(i.staticKeyPair.generateSharedSecret(a));const n=e.encrypt(Promise.resolve(r));return Promise.all([t,n])})).then((t=>{let[r,n]=t;return __LOG__(2)`doFullHandshakeCore client finish and deriving secrets`,e.send(i.encodeHandshakeFinish({static:r,payload:n})),e.finish()}))}function d(e,t,r,n){const i=new s.NoiseHandshake(e);i.start("Noise_XX_25519_AESGCM_SHA256\0\0\0\0",n.protoHeader);const a=r.generatePublicKey();return i.authenticate(a),a.then((e=>(__LOG__(2)`fullNoiseHandshake send hello`,i.sendAndReceive(n.encodeHandshakeHello({ephemeral:e}))))).then((e=>{__LOG__(2)`fullNoiseHandshake rcv hello`;const a=n.decodeServerHello(e);return c(i,a,t,r,n)}))}},44396:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleError=function(e){return a.parse(e),"NO_ACK"};var n=r(71914);const i=479,a=new n.WapParser("errorParser",(e=>{e.assertTag("error");const t=e.attrInt("code");switch(t){case i:return __LOG__(4,void 0,new Error,!0)`Invalid stanza sent (smax-invalid)`,void SEND_LOGS("smax-invalid");default:return function(e){__LOG__(4,void 0,new Error,!0)`Unknown error code: ${e}`,SEND_LOGS("unknown-error-code")}(t)}}))},48095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaConnParser=void 0;var n=r(2555);const i=new(r(71914).WapParser)("mediaConnParser",(e=>{var t,r;const n=e.child("media_conn");return{hosts:n.mapChildrenWithTag("host",s),authToken:n.attrString("auth"),authTTL:n.hasAttr("auth_ttl")?n.attrFutureTime("auth_ttl"):null,authExpires:n.attrFutureTime("ttl"),maxBuckets:n.hasAttr("max_buckets")?n.attrInt("max_buckets"):null,maxManualRetry:null!==(t=n.maybeAttrInt("max_manual_retry",0,4))&&void 0!==t?t:3,maxAutoDownloadRetry:null!==(r=n.maybeAttrInt("max_auto_download_retry",0,4))&&void 0!==r?r:3}}));function a(e){var t,r;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:null!==(t=e.maybeAttrString("fallback_ip4"))&&void 0!==t?t:void 0,ip6:null!==(r=e.maybeAttrString("fallback_ip6"))&&void 0!==r?r:void 0}}function s(e){var t,r,n,i;return{domain:e.attrString("hostname"),fallback:a(e),uploadable:o(e,"upload"),downloadable:o(e,"download"),isFallback:"fallback"===e.maybeAttrString("type"),downloadBuckets:null!==(t=null===(r=e.maybeChild("download_buckets"))||void 0===r?void 0:r.mapChildren((e=>parseInt(e.tag(),10))))&&void 0!==t?t:[],class:e.maybeAttrString("class"),ip4:null!==(n=e.maybeAttrString("ip4"))&&void 0!==n?n:void 0,ip6:null!==(i=e.maybeAttrString("ip6"))&&void 0!==i?i:void 0}}function o(e,t){return e.hasChild(t)?e.child(t).mapChildren((e=>{const t=e.tag();return(0,n.castToServerMediaType)(t)})).filter(Boolean):n.SERVER_MEDIA}t.mediaConnParser=i},97245:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(e){return(0,u.redeemPrivateStatsToken)().then((t=>t?{result:t}:m(e).then((e=>{const t=(0,i.default)({},e),{result:r}=e;return r?(0,u.savePrivateStatsToken)(r).then((()=>t)):t}))))},t.issuePrivateStatsToken=m;var i=n(r(73982)),a=r(8584),s=r(36184),o=r(11609),l=r(72287),c=r(92844),d=r(47957),u=r(11562),p=r(31914),h=r(71914),f=r(14462);const _=new h.WapParser("issuePrivateStatsToken",(e=>{const t=e.child("sign_credential");return{signedCredential:t.child("signed_credential").contentBytes(),acsPublicKey:t.child("acs_public_key").contentBytes()}}));function m(e){const t=(0,c.monotonicTime)(),r={overallStartTime:t,retryStartTime:t,retryAttemptsLeft:3},n=new Uint8Array(32);self.crypto.getRandomValues(n);const u=new Uint8Array(32);self.crypto.getRandomValues(u);const h=(0,d.blindToken)(n,u),m=new l.PromiseRetryLoop({name:"issuePrivateStatsToken",timer:{algo:{type:"exponential",first:250},max:1e3},code:t=>{r.retryAttemptsLeft<3&&(r.retryStartTime=(0,c.monotonicTime)());const l=(0,p.wap)("iq",{xmlns:"privatestats",id:(0,p.generateId)(),type:"get",to:p.S_WHATSAPP_NET},(0,p.wap)("sign_credential",{version:"1"},(0,p.wap)("blinded_credential",null,h)));return(e||s.sendIqWithoutRetry)(l,_).then((e=>{if(!e.success){const n=function(e){switch(e.errorCode){case 400:return"bad-request";case 500:return"internal-server-error";case 501:return"feature-not-implemented";case 503:return"service-unavailable";default:return"unknown"}}(e);return __LOG__(3)`issuePrivateStatsToken: failed ${n}`,void("internal-server-error"!==n||r.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:n})}):r.retryAttemptsLeft--)}const{signedCredential:s,acsPublicKey:o}=e.result,l=(0,d.unblindToken)(s,u,o);if(null==l)return __LOG__(3)`issuePrivateStatsToken: failed to unblind the signed token`,void t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:"decryption-error"})});const c=a.Binary.build(n,l),p=(0,f.hash)(c.readByteArray());t({result:{token:n,sharedSecret:p},metric:(0,i.default)((0,i.default)({},r),{},{result:"success"})})})).catch((e=>{if(!(e instanceof o.Disconnected))return Promise.reject(e);__LOG__(3)`issuePrivateStatsToken: Disconnected`,r.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:"disconnected"})}):r.retryAttemptsLeft--}))}});return m.start(),m.promise()}},14604:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFinishedPrivateStatsBuffers=function(e){return(0,c.getFinishedStreamBuffers)("private").then((t=>v(t,e)))},t.upload_UNSAFE_INTERNAL_DO_NOT_USE=v;var i=n(r(11504)),a=r(15688),s=r(81576),o=r(72287),l=r(92844),c=r(11562);const d="https://dit.whatsapp.net/deidentified_telemetry",u="245118376424571|3e7d275052f1522bf3200afcf53841a7",p="WAMEventBuffer.dat",h=111e3,f=3067002,_=3067003,m=3067004;function g(e){return{result:e.result,httpResponseCode:e.httpResponseCode,uploadTime:(0,l.monotonicTimeSince)(e.uploadStartTime)}}function y(){return(y=(0,i.default)((function*(e,t,r,n){if((yield(0,c.privateStatsKillSwitchGetBlockedToken)())===u)return __LOG__(2)`Removing private stats buffer without submitting it (kill switch)`,(0,c.removeBufferByKey)(r.key).then((()=>{e()}));const i=(0,l.monotonicTime)(),o=yield n();if(null==o)return __LOG__(4,void 0,new Error)`Couldn't get token to submit a private stats buffer`,void e();const h=new FormData;h.append("access_token",u);const f=yield(0,s.hmacSha256)(o.sharedSecret,r.content),_=(0,a.encodeB64UrlSafe)(o.token,!0),m=(0,a.encodeB64UrlSafe)(f,!0);let g;h.append("credential",`${_}+${m}`),h.append("message",new Blob([r.content],{type:"application/octet-stream"}),p),h.append("meta_data",JSON.stringify({t:(0,l.unixTime)(),p:0}));try{g=yield fetch(d,{method:"POST",body:h,"Content-Type":"multipart/form-data"})}catch(e){return __LOG__(3)`Upload of a private stats buffer failed: ${e}`,void t({uploadStartTime:i,result:"error-other"})}const y=g.status,S=t=>{e({uploadStartTime:i,httpResponseCode:y,result:t})},v=e=>{t({uploadStartTime:i,httpResponseCode:y,result:e})};switch(y){case 200:return(0,c.removeBufferByKey)(r.key).then((()=>{S("success")}));case 429:return void S("error-server-other");case 401:return Promise.all([(0,c.privateStatsKillSwitchSet)(u),(0,c.removeBufferByKey)(r.key)]).then((()=>{S("error-access-token")}));case 400:{const{result:r,shouldRetry:n}=yield E(g),a={uploadStartTime:i,httpResponseCode:y,result:r};return void("retry"===n?t(a):e(a))}case 500:return void v("error-server-other")}__LOG__(3)`Unsupported response status code from PrivateStats upload request: ${y}`,v("error-other")}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=yield e.json().catch((()=>{}));if("object"!=typeof t)return __LOG__(3)`Unable to parse error response 400 from PrivateStats upload request or parsed response is not an object`,{result:"error-other",shouldRetry:"retry"};const{error:r}=t;if("object"!=typeof r)return __LOG__(3)`Incorrect or missing error entry in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};const{code:n,error_subcode:i}=r;if("number"!=typeof n||"number"!=typeof i)return __LOG__(3)`Incorrect code or subcode in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};switch(n){case 9:return{result:"error-server-other",shouldRetry:"no-retry"};case h:switch(i){case f:return{result:"error-parsing",shouldRetry:"retry"};case _:return{result:"error-decoding",shouldRetry:"retry"};case m:return{result:"error-credential",shouldRetry:"retry"};default:return __LOG__(3)`Unsupported subcode value in the error response 400 from PrivateStats upload request: ${i}`,{result:"error-other",shouldRetry:"retry"}}default:return __LOG__(3)`Unsupported code value in the error response 400 from PrivateStats upload request: ${n}`,{result:"error-other",shouldRetry:"retry"}}}))).apply(this,arguments)}function v(e,t){const r=e.map((e=>{let r=3;const n=[],i=new o.PromiseRetryLoop({name:"uploadPrivateStatsBuffer",timer:{algo:{type:"exponential",first:250},max:1e3},code:i=>function(){return y.apply(this,arguments)}(i,(e=>{const t=g(e);n.push(t),r<=0?i():r--}),e,t)});return i.start(),i.promise().then((t=>{if(null!=t){const e=g(t);n.push(e)}return{uploadedBufferKey:"success"===(null==t?void 0:t.result)?e.key:null,metrics:n}}))}));return Promise.all(r).then((e=>{const t=e.reduce(((e,t)=>(e.push(...t.metrics),e)),[]);return{uploadedBufferKeys:e.reduce(((e,t)=>(null!=t.uploadedBufferKey&&e.push(t.uploadedBufferKey),e)),[]),metrics:t}}))}},2486:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_HANDLED=t.DynamicRouter=void 0;const r={sentinel:"RESPONSE_NAMESPACE"},n={sentinel:"NOT_HANDLED"};t.NOT_HANDLED=n;function i(e,t){const n=t.namespace;return n===r?a:e.get(n)}function a(e,t,r){r(t)}function s(e){if(null!=e&&("object"==typeof e||"function"==typeof e)){const t=e.then;return"function"==typeof t?t:null}return null}t.DynamicRouter=class{constructor(){var e=this;this._basePromise=Promise.resolve(),this._handlers=new Map,this._handlerChangeCount=0,this._firstRoute=null,this._nextRoute=null,this._lastRoute=null,this.fireAndForget=function(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e._schedule(t,r,n,null,i)},this.sendAndReceive=function(t,n,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(((o,l)=>{e._schedule(t,n,i,(t=>{try{const n=s(t);n?n.call(t,(t=>{e._schedule(r,"",t,o,a)}),(t=>{e._schedule(r,"",t,l,!1)})):e._schedule(r,"",t,o,a)}catch(t){e._schedule(r,"",t,l,!1)}}),a)}))},this._run=()=>{let e=this._nextRoute;if(!e)return;const t=this._handlers;let r;for(;e&&!(r=i(t,e));)this._nextRoute=e=e.nextRoute;if(!e||!r)return;const a=this._runHandler(r,e);let s=!0;if(a!==n){const t=e.prevRoute,r=e.nextRoute;this._nextRoute===e&&(this._nextRoute=r),t?t.nextRoute=r:this._firstRoute=r,r?r.prevRoute=t:(s=!1,this._lastRoute=t)}return s&&this._basePromise.then(this._run),a}}hasHandlerForNamespace(e){return this._handlers.has(e)}getHandledNamespaces(){return Array.from(this._handlers.keys())}setNamespaceHandler(e,t){const r=this._handlers,n=r.get(e);if(n!==t&&(++this._handlerChangeCount,r.set(e,t),!n)){const e=this._firstRoute;e&&(this._nextRoute||this._basePromise.then(this._run),this._nextRoute=e)}}setHandlers(e,t){this.setNamespaceHandler(e,(function(e,r,n){const i=t[e](r);n&&n(i)}))}_schedule(e,t,r,n,a){const s=this._lastRoute,o={namespace:e,route:t,arg:r,resolver:n,prevRoute:s,nextRoute:null,silentLog:a};this._lastRoute=o;let l=!0;s?(s.nextRoute=o,l=!this._nextRoute):this._firstRoute=o,l&&i(this._handlers,o)&&(this._nextRoute=o,this._basePromise.then(this._run))}_runHandler(e,t){const{route:r,arg:i,resolver:a,silentLog:s}=t,o=this._handlerChangeCount;let l=null,c=null;try{l=e(r,i,a,s)}catch(e){c=Promise.reject(e)}if(l===n){if(o!==this._handlerChangeCount)return n;c=Promise.reject(new Error("DynamicRouter: NOT_HANDLED can only be used when updating handlers"))}if(!a)return c;c&&a(c)}}},1637:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Curve25519=void 0;t.Curve25519=class{constructor(e,t){this.signalDependencies=e,this.keyPair=t?Promise.resolve(t):this.signalDependencies.generateIdentityKeyPair()}generatePublicKey(){return this.keyPair.then((e=>e.publicKey))}generateSharedSecret(e){return this.keyPair.then((t=>{let{privateKey:r}=t;return __LOG__(2)`Curve25519.generateSharedSecret pubkey:${e}`,this.signalDependencies.calculateAgreement(new Uint8Array(e),r)}))}}},30141:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allocate=s,t.elligator=A,t.fieldElement=o,t.hashSha512=function(e,t,r){n.lowlevel.crypto_hash(e,t,r)},t.hashToPoint=function(e){return a((()=>function(e){const{unpack25519:t}=n.lowlevel,r=(0,n.hash)(e),i=(128&r[31])>>7;r[31]&=127;const a=o();t(a,r);const l=o();A(l,a);const c=u();!function(e,t,r){const{unpack25519:i,M:a}=n.lowlevel,l=o();i(l,v);const c=o();!function(e,t){const{Z:r,A:i,M:a}=n.lowlevel,s=d(),l=o(),c=o(),u=o();r(l,t,s),i(c,t,s),b(u,c),a(e,l,u)}(c,t);const u=o();_(u,t);const p=o();!function(e,t){const{unpack25519:r,pow2523:i,M:a,S:s}=n.lowlevel,l=o();r(l,g);const c=o();i(c,t);const d=o();a(d,t,c);const u=o();s(u,d);const p=o();a(p,d,l),m(d,p,1^(h=u,f=t,P(h,f)?0:1)),e.set(d);var h,f}(p,u);const h=o();a(h,t,l);const f=o();b(f,p);const E=o();a(E,h,f);const S=o();y(S,E),m(E,S,function(e){const{pack25519:t}=n.lowlevel,r=s(Uint8Array,32);return t(r,e),1&r[0]}(E)^r),e[0].set(E),e[1].set(c),e[2].set(d()),a(e[3],e[0],e[1])}(c,l,i);const h=u();return function(e,t){const r=[o(),o(),o(),o()],i=p();(function(e,t){const r=p();(function(e,t){e[0].set(t[0]),e[1].set(t[1]),e[2].set(t[2])})(r,t),S(e,r)})(r,t),E(i,r),S(r,i),E(i,r),S(r,i),function(e,t){const{M:r}=n.lowlevel;r(e[0],t[0],t[3]),r(e[1],t[1],t[2]),r(e[2],t[2],t[3]),r(e[3],t[0],t[1])}(e,r)}(h,c),h}(e)))},t.inv25519=b,t.modL=l,t.p3Element=u,t.pack=C,t.reduce=function(e,t){for(let r=0;r<64;++r)t[r]=e[r],e[r]=0;l(e,t),t.fill(0)},t.runInAllocationScope=a,t.scalarmultBase=function(e,t){const r=[o(),o(),o(),o()];n.lowlevel.scalarbase(r,t),C(e,r)},t.unpack=function(e,t){const r=u();if(0!==M(r,t))return-1;return function(e,t){y(e[0],t[0]),e[1].set(t[1]),e[2].set(t[2]),y(e[3],t[3])}(e,r),0},t.unpackneg=M;var n=r(14462);let i=null;function a(e){const t=i;i=[];try{return e()}finally{var r;(null!==(r=i)&&void 0!==r?r:[]).forEach((e=>{e.fill(0)})),i=t}}function s(e,t){if(null==i)throw new Error("allocate called outside of active scope");return new e(t)}function o(e){const t=s(Float64Array,16);if(e){if(e.length>16)throw new Error("Incorrect initialiser array provided to the fieldElement");for(let r=0;r<e.length;r++)t[r]=e[r]}return t}function l(e,t){n.lowlevel.modL(e,t)}const c=()=>o([0]),d=()=>o([1]);function u(){return[o(),o(),o(),o()]}function p(){return[o(),o(),o()]}function h(e,t){let r=0,n=t;for(;n>0;){const t=n%65536;e[r]=t,n=(n-t)/65536,r++}}function f(e,t){const{S:r,M:i}=n.lowlevel,a=o([2]),s=o();r(s,t),i(e,a,s)}function _(e,t){const{S:r,M:i,A:a}=n.lowlevel,s=c(),l=d(),u=o(),p=o(),f=o(),_=o();h(s,486662),r(u,t),i(p,s,t),a(f,u,p),a(_,f,l),i(e,t,_)}function m(e,t,r){1===r&&e.set(t)}const g=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function y(e,t){const{Z:r}=n.lowlevel;r(e,c(),t)}function E(e,t){const{M:r}=n.lowlevel;r(e[0],t[0],t[3]),r(e[1],t[1],t[2]),r(e[2],t[2],t[3])}function S(e,t){const{S:r,A:i,Z:a}=n.lowlevel;r(e[0],t[0]),r(e[2],t[1]),f(e[3],t[2]),i(e[1],t[0],t[1]);const s=o();r(s,e[1]),i(e[1],e[2],e[0]),a(e[2],e[2],e[0]),a(e[0],s,e[1]),a(e[3],e[3],e[2])}const v=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function T(e,t){const{M:r,A:i}=n.lowlevel,a=d(),s=c();h(s,486662);const l=o();f(l,t);const u=o();i(u,l,a);const p=o();b(p,u);const g=o();r(g,p,s);const E=o();y(E,g);const S=o();_(S,E);const v=function(e){const{S:t,M:r,pow2523:i,pack25519:a}=n.lowlevel,s=o(),l=o(),c=o(),d=o(),u=o();i(s,e),t(l,s),t(c,l),r(d,c,e),r(u,d,e);const p=new Uint8Array(32);return a(p,u),1&p[31]}(S),T=o([0]);m(T,s,v);const A=o();i(A,E,T);const C=o();y(C,A),m(A,C,v),e.set(A)}function A(e,t){return a((()=>T(e,t)))}function C(e,t){const r=o(),i=o(),a=o(),{M:s,pack25519:l}=n.lowlevel;b(a,t[2]),s(r,t[0],a),s(i,t[1],a),l(e,i);const c=new Uint8Array(32);l(c,r),e[31]^=(1&c[0])<<7}function b(e,t){const r=o();r.set(t);const{M:i,S:a}=n.lowlevel;for(let e=253;e>=0;--e)a(r,r),2!==e&&4!==e&&i(r,r,t);e.set(r)}function P(e,t){const{pack25519:r,crypto_verify_32:i}=n.lowlevel,a=new Uint8Array(32),s=new Uint8Array(32);return r(a,e),r(s,t),i(a,0,s,0)}function M(e,t){const{set25519:r,S:i,M:a,Z:s,A:l,D:u,unpack25519:p,pow2523:h}=n.lowlevel,f=o(),_=o(),m=o(),g=o(),y=o(),E=o(),S=o();return r(e[2],d()),p(e[1],t),i(m,e[1]),a(g,m,u),s(m,m,e[2]),l(g,e[2],g),i(y,g),i(E,y),a(S,E,y),a(f,S,m),a(f,f,g),h(f,f),a(f,f,m),a(f,f,g),a(f,f,g),a(e[0],f,g),i(_,e[0]),a(_,_,g),P(_,m)&&a(e[0],e[0],o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])),i(_,e[0]),a(_,_,g),P(_,m)?-1:(function(e){const{pack25519:t}=n.lowlevel,r=new Uint8Array(32);return t(r,e),1&r[0]}(e[0])===t[31]>>7&&s(e[0],c(),e[0]),a(e[3],e[0],e[1]),0)}},81576:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeKey=s,t.expand=c,t.extract=l,t.extractAndExpand=function(e,t,r){return l(null,e).then((e=>c(new Uint8Array(e),t,r)))},t.extractWithSaltAndExpand=function(e,t,r,n){return l(t,e).then((e=>c(new Uint8Array(e),r,n)))},t.hmacSha256=function(e,t){return s(e).then((e=>o(e,t)))};var n=r(8584);const i=new Uint8Array(32),a={name:"HMAC",hash:"SHA-256"};function s(e){return self.crypto.subtle.importKey("raw",e,a,!1,["sign"])}function o(e,t){return self.crypto.subtle.sign(a,e,t)}function l(e,t){return s(e||i).then((e=>o(e,t)))}function c(e,t,r){if(r<0||r>8160)return Promise.reject(new Error(`HKDF::expand given bad length ${r}`));let i;const a=Math.ceil(r/32),l=n.Binary.build(t).readByteArray(),c=new n.Binary;let d=s(e).then((e=>(i=e,new Uint8Array(0))));for(let e=1;e<=a;e++)d=d.then((t=>o(i,n.Binary.build(t,l,e).readByteArray()))).then((e=>{const t=new Uint8Array(e);return c.writeByteArray(t),t}));return d.then((()=>c.readBuffer(r)))}},7589:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areBuffersEqual=function(e,t){return i(new Uint8Array(e),new Uint8Array(t))},t.areBytesEqual=i,t.randomNumberLessThan=function(e){if(e!==(0|e))throw new Error("bound must be int32");if(e<=0)throw new Error("bound must not be positive");const t=new Int32Array(1),r=e*Math.floor((-1>>>1)/e);let n=-1;for(;-1===n;){self.crypto.getRandomValues(t);const i=t[0]>>>1;i<r&&(n=i%e)}return n};var n=r(14462);function i(e,t){return 0===e.length&&0===t.length||(0,n.verify)(e,t)}},61103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDevToolBridge=function(){return s},t.sendNewStanzaToDevTool=function(e,t){const r=(0,i.attrInt)(e,"t"),n=r.success?(0,a.castToUnixTime)(r.value):(0,a.unixTime)();s.fireAndForget("devtool","newStanza",{ts:n,type:e.tag,isOutgoing:t,stanza:e.toString()})};var n=r(2486),i=r(8790),a=r(92844);const s=new n.DynamicRouter},96573:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.addMessageIds=function(e,t){if(null!=t){const r=new Set;[e.ids,t].forEach((e=>e.forEach((e=>{r.has(e)||r.add(e)})))),e.ids=Array.from(r.values())}},t.buildEntry=function(e,t){if(!e||0===e.length)throw new Error("FtsIndexEntry: Expected non-empty blindIndices in constructor");return{ids:(0,i.default)(t,"ids"),prefixes:e,token:e[e.length-1]}};var i=n(r(45095))},44152:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildEntry=function(e,t,r,n){return{id:e,chatId:t,token:r,timestamp:n}}},14056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildDBEntry=function(e,t,r,n,i){return{ftsRowId:e,id:t,chatId:r,timestamp:n,prefixes:i}},t.buildEntry=function(e,t,r,n){return{id:e,chatId:t,timestamp:r,prefixes:n}}},74391:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getJidUtilsApi=function(){return function(){if(null==i)throw new Error("Globals called before set");return i}().jidUtils},t.setGlobals=a;var n=r(52230);let i=null;function a(e){i=e}a({jidUtils:(0,n.createJidUtils)({platform:"whatsapp"})})},18269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnsatisfiableJobRequirement=t.JobRequirement=void 0,t.joinRequirements=function(e,t){const r=e.filter((e=>!e.isSatisfiable()));if(r.length>0){const e=r.map((e=>e.name));return n=>(null==t||t("unsatisfiable",e,n),r[0].waitUntilSatisfied())}let n=e.map((()=>Promise.resolve())),i=Promise.resolve(),a=null;const s=()=>{if(n.every(((t,r)=>t===e[r].waitUntilSatisfied())))return void(a=null);const t=[],r=e.map((e=>{const r=e.waitUntilSatisfied();return e.isSatisfied()||(t.push(e.name),r.then((()=>{const r=t.indexOf(e.name);t.splice(r,1)}))),r}));return n=r,a=t,Promise.all(r).then(s)};return e=>{if(null==a){const e=s();null!=e&&(i=i.then((()=>e)))}return null==t||t(null==a?"satisfied":"unsatisfied",a,e),i}};class r{constructor(e){this._waitingOn=Promise.resolve(),this._satisfied=!0,this._newBlockers=null,this._blockersFinished=()=>{const e=this._newBlockers;if(null!=e)return this._newBlockers=null,Promise.all(e).then(this._blockersFinished);this._satisfied=!0},this.name=e}addBlocker(e){const t=e.catch((e=>{__LOG__(4,void 0,new Error,!0)`JobRequirement[${this.name}] blocker errored ${e}`,SEND_LOGS("job-blocker-rejected")}));if(this._satisfied)this._satisfied=!1,this._waitingOn=Promise.all([this._waitingOn,t]).then(this._blockersFinished);else{const e=this._newBlockers;null!=e?e.push(t):this._newBlockers=[t]}}waitUntilSatisfied(){return this._waitingOn}isSatisfied(){return this._satisfied}isSatisfiable(){return!0}}t.JobRequirement=r;t.UnsatisfiableJobRequirement=class extends r{constructor(e){super(e),super.addBlocker(new Promise((()=>{})))}addBlocker(){}isSatisfiable(){return!1}}},47901:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTARTED_JOB=t.RetryOnBackoff=t.RequiresPage=t.PersistedJobManager=t.InterruptJob=t.FINISHED_JOB=void 0;var i=n(r(11504)),a=r(18269),s=r(37178),o=r(92844);class l{constructor(e){this.feature=e}toString(){return`RequiresPage: ${this.feature}`}}t.RequiresPage=l;class c{constructor(e){this.backoffOptions=e}toString(){return"RetryOnBackoff"}}t.RetryOnBackoff=c;class d{constructor(e){this.result=e}}t.InterruptJob=d;const u="$unstarted";t.UNSTARTED_JOB=u;const p="$finished";t.FINISHED_JOB=p;function h(e){return`Job[${e.jobId}] (${e.type})`}function f(e){return`Job[${e.jobId}] (${e.type}.${e.step})`}function _(e,t,r){"unsatisfiable"===e?__LOG__(2)`${f(r)} halting because of ${t}`:"unsatisfied"===e&&__LOG__(2)`${f(r)} waiting on ${t}`}function m(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{jobStartTime:e.startTime,afterCrash:t,interruptJob:g}}function g(e){return new d(e)}t.PersistedJobManager=class{constructor(e){const{isRestartAfterCrash:t,accessors:r,unfinishedJobEntries:n}=e,i=new Map,a=n.then((e=>{const n=[],a=[];return e.forEach((e=>{e.stepHardStartCountAfterTimeout>=5?n.push(e):a.push(e)})),Promise.all(n.map((e=>{var t;return __LOG__(4,void 0,new Error,!0)`${t=e,`[Job ${t.type}] `}: stuck on the step ${e.step}, aborting the job`,SEND_LOGS(`job-stuck-${e.type}`),r.deletePersistedJob(e.jobId)}))).then((()=>{a.forEach((e=>{i.has(e.jobId)||(__LOG__(2)`${h(e)}: restarting`,i.set(e.jobId,this._runJob(e,t)))}))}))}));this.implementationLoaders=new Map,this.implementations=new Map,this.stepBlockers=new WeakMap,this.accessors=r,this.activeJobs=i,this.initialJobsPromise=a,this.listeners=e.listeners,this.deprecatedJobs=e.deprecatedJobs}loadAndRunJobFromId(e){const t=this.activeJobs.get(e);if(null!=t)return t;const r=this._loadAndRunJobFromId(e);return this.activeJobs.set(e,r),r}_loadAndRunJobFromId(e){var t=this;return(0,i.default)((function*(){const{initialJobsPromise:r,accessors:n}=t;yield r;const i=yield n.readPersistedJob(e);return i?t._runJob(i,!1):(__LOG__(4,void 0,new Error,!0)`No entry for job ${e}`,SEND_LOGS("missing-job-entry"),null)}))()}_getJobImplementation(e){const{implementations:t,implementationLoaders:r}=this,n=t.get(e);if(n)return n;const i=r.get(e);if(!i)return null;const a=i();return t.set(e,a),a}_waitForBlockers(e,t){if(null==t||0===t.length)return Promise.resolve();const{stepBlockers:r}=this;let n=r.get(t);return null==n&&(n=(0,a.joinRequirements)(t.map((e=>e())),_),r.set(t,n)),n(e)}_runRemainingSteps(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const{step:i}=e,a=t.findIndex((e=>e.stepName===i)),{requirements:s,code:l}=t[a].info(e.current,e.original,m(e,r));let c=this._waitForBlockers(e,s);return n&&(c=c.then(n)),c.then((()=>(__LOG__(2)`${f(e)}: running step`,l(e.current,e.original,m(e,r))))).then((n=>{if(n instanceof d)return __LOG__(2)`${f(e)}: InterruptJob`,n.result;const i=a+1;if(i>=t.length)return n;const s=t[i];return e.step=s.stepName,e.current=n,e.stepHardStartCountAfterTimeout=0,e.stepFirstStartTime=(0,o.unixTime)(),e.stepUnexpectedErrorCount=0,e.waitUntil=null,e.backedOffCount=0,this.accessors.updatePersistedJob(e).then((()=>this._runRemainingSteps(e,t,r)))}))}_runJob(e,t){var r=this;return(0,i.default)((function*(){var n;const{accessors:a,activeJobs:d,deprecatedJobs:_,listeners:{onJobFinished:g,onJobStarted:y}}=r,E=yield r._getJobImplementation(e.type);if(!E)return _.includes(e.type)?__LOG__(3)`No implementation for deprecated ${e.type}, job deleted`:(__LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}. Maybe it should have been put to the deprecated list?`,SEND_LOGS("missing-job-implementation")),yield a.deletePersistedJob(e.jobId),null;_.includes(e.type);const S=null!==(n=e.stepFirstStartTime)&&void 0!==n?n:(0,o.unixTime)();if(e.stepFirstStartTime=S,e.stepUnexpectedErrorCount=e.stepUnexpectedErrorCount||0,e.backedOffCount=e.backedOffCount||0,e.step===p){let t=e.waitUntil;const n=(0,o.secondsUntil)(S);return null!=t&&(0,o.isInFuture)(t)&&n>0&&(__LOG__(2)`${h(e)}: skew detected, adjusting accordingly`,t=(0,o.castToUnixTime)(t-n),(0,o.isInFuture)(t)&&(e.stepFirstStartTime=(0,o.castToUnixTime)(S-n),e.waitUntil=t,yield r.accessors.updatePersistedJob(e))),null!=t&&(0,o.isInFuture)(t)||(__LOG__(2)`${h(e)}: removing completed, expired job from db`,yield a.deletePersistedJob(e.jobId)),d.delete(e.jobId),e.current}const v=e.step!==u?E.find((t=>t.stepName===e.step)):E[0];if(!v)return __LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}.${e.step}`,SEND_LOGS("missing-job-step"),yield a.deletePersistedJob(e.jobId),null;e.step=v.stepName;const T=()=>{const n=e.waitUntil;let i=Promise.resolve();if(null!=n){const t=(0,o.futureUnixTime)(o.DAY_SECONDS);n>t?(__LOG__(2)`${f(e)}: trim wait from ${n} to ${t}`,e.waitUntil=t,i=r.accessors.updatePersistedJob(e).then((()=>(0,o.delayUntil)(t)))):(__LOG__(2)`${f(e)}: delaying until ${n}`,i=(0,o.delayUntil)(n))}return i.then((()=>r._runRemainingSteps(e,E,t,(()=>(e.waitUntil=null,(0,o.happenedWithin)(S,o.DAY_SECONDS)||e.stepHardStartCountAfterTimeout++,r.accessors.updatePersistedJob(e)))).catch((t=>{if(t instanceof l)return __LOG__(2)`${f(e)}: requires page`,e.stepHardStartCountAfterTimeout>0&&(--e.stepHardStartCountAfterTimeout,r.accessors.updatePersistedJob(e)),new Promise((()=>{}));if(t instanceof c){__LOG__(2)`${f(e)}: RetryOnBackoff`;const n=(0,s.getDelay)(++e.backedOffCount,t.backoffOptions);return e.waitUntil=(0,o.futureUnixTime)(Math.ceil(n/1e3)),e.stepHardStartCountAfterTimeout>0&&--e.stepHardStartCountAfterTimeout,r.accessors.updatePersistedJob(e).then(T)}if(e.stepUnexpectedErrorCount<1)return __LOG__(3)`${f(e)}: Unhandled exception. Tried ${e.stepUnexpectedErrorCount} times`,e.stepUnexpectedErrorCount++,r.accessors.updatePersistedJob(e).then(T);throw t}))))},A=T(),C=A.then(function(){var t=(0,i.default)((function*(t){__LOG__(2)`${f(e)}: finished job`;let n=null;try{n=g(e.jobId,e.type,e.original,t)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobFinished for ${e.type} threw exception ${t}`,SEND_LOGS("onJobFinished-threw")}null!=n&&n>0?(e.waitUntil=(0,o.futureUnixTime)(Math.ceil(n/1e3)),e.step=p,e.current=t,e.stepFirstStartTime=(0,o.unixTime)(),yield r.accessors.updatePersistedJob(e)):(yield a.deletePersistedJob(e.jobId),d.delete(e.jobId))}));return function(){return t.apply(this,arguments)}}(),function(){var r=(0,i.default)((function*(r){__LOG__(4,void 0,new Error,!0)`${e.type} failed with error ${r}`,SEND_LOGS(`job-threw-exception-${e.type}`);const n=E.find((t=>t.stepName===e.step));if(n){const r=n.info(e.current,e.original,m(e,t));null!=r.stopRetryIf&&(yield r.stopRetryIf.onStopRetry(e.current,e.original,m(e,t)))}else __LOG__(4,void 0,new Error)`${e.type}: ${e.step} step not found`;yield a.deletePersistedJob(e.jobId),d.delete(e.jobId)}));return function(){return r.apply(this,arguments)}}());try{y(e.jobId,e.type,e.original)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobStarted for ${e.type} threw exception ${t}`,SEND_LOGS("onJobStarted-threw")}return C.then((()=>A))}))()}addPersistedJobImplementation(e,t){const{implementationLoaders:r,deprecatedJobs:n}=this;if(r.has(e))return __LOG__(4,void 0,new Error,!0)`addPersistedJobImplementation called twice for ${e}`,void SEND_LOGS("repeat-job-loader");n&&n.includes(e),r.set(e,t)}fireAndForget(e){this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}waitUntilPersisted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;this.loadAndRunJobFromId(t)}))}waitUntilCompleted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}}},89385:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbortError=t.ABORT_ERROR=void 0,t.catchAbort=function(e){return t=>{if(t.name===a)return e(t);throw t}};var n=r(40265);class i extends((0,n.customError)("AbortError")){}t.AbortError=i;const a="AbortError";t.ABORT_ERROR=a},50796:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filteredCatch=function(e,t){return r=>{if(Array.isArray(e)?e.some((e=>r instanceof e)):r instanceof e)return t(r);throw r}}},856:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseAny=function(e){if(0===e.length)return Promise.reject(new n.AggregateError([]));return Promise.all(e.map(i)).then((e=>{throw new n.AggregateError(e)}),(e=>e))};var n=r(40265);function i(e){return new Promise(((t,r)=>Promise.resolve(e).then(r,t)))}},37178:(e,t)=>{"use strict";function r(e){const{relativeDelay:t=!1}=e;let r=null;const a=i(e.algo);return function(){if(null==r)return r=t?Date.now():0,0;let i=n(e,a());if(t){const e=Date.now(),t=e-r;t>0&&(i=Math.max(0,i-t)),r=e}return i}}function n(e,t){let{max:r,min:n,jitter:i=.1}=e,a=t;return null!=r&&a>r&&(a=r),null!=n&&a<n&&(a=n),0!==i&&(a=Math.ceil(a*(1+i*Math.random()))),a}function i(e){switch(e.type){case"fibonacci":return function(e){let t=e.second-e.first,r=e.first-t;return function(){const e=t+r;return r=t,t=e,e}}(e);case"exponential":return function(e){const{base:t=2}=e;let r=e.first;return function(){const e=r;return r*=t,e}}(e);case"constant":return function(e){const t=e.delay;return function(){return t}}(e);case"adjust":return function(e){const{toMs:t,backoff:r}=e,n=i(r);return function(){return t(n())}}(e);default:throw new Error(`makeTimeFunc unrecognized backoff ${e.type}`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseTimer=function(e){const t=r(e);return function(e){return new Promise((r=>{const n=t();n>0?setTimeout(r,n,e):r(e)}))}},t.createTimer=r,t.getDelay=function(e,t){if(0===e)return 0;const r=i(t.algo);for(let t=1;t<e;t++)r();return n(t,r())}},18412:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseCallSync=function(e,t){try{for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return Promise.resolve(e.apply(t,n))}catch(e){return Promise.reject(e)}}},13959:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delayMs=function(e,t){return new Promise(((r,i)=>{if(null==t?void 0:t.aborted)throw new n.AbortError;const a=setTimeout((function(){null==t||t.removeEventListener("abort",s),r()}),e);function s(){null==t||t.removeEventListener("abort",s),clearTimeout(a),i(new n.AbortError)}null==t||t.addEventListener("abort",s)}))},t.withTimeout=function(e,t,r){return new Promise(((n,i)=>{const a=setTimeout((()=>{try{n(r())}catch(e){i(e)}}),t);e.then((e=>{clearTimeout(a),n(e)}),(e=>{clearTimeout(a),i(e)}))}))};var n=r(89385)},69719:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseEach=void 0;var i=n(r(11504));const a=function(){var e=(0,i.default)((function*(e,t){const r=[];for(let n=0;n<e.length;n++)r.push(yield t(e[n]));return r}));return function(){return e.apply(this,arguments)}}();t.promiseEach=a},4352:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseLoop=function(){return a.apply(this,arguments)};var i=n(r(11504));function a(){return(a=(0,i.default)((function*(e,t){let r,n=!1;const i=e=>{n=!0,r=e};let a=0,s=t;for(;!n;)s=yield e(i,s,a),a++;return r}))).apply(this,arguments)}},67602:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseProps=function(e){const t=Object.keys(e);return Promise.all(t.map((t=>e[t]))).then((function(e){const r={};for(let n=0;n<e.length;n++)r[t[n]]=e[n];return r}))}},27870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueueMap=t.PromiseQueue=void 0;t.PromiseQueue=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._promise=Promise.resolve(),this._maxDelay=e}wait(){return this._promise}enqueueHandlers(e,t,n){const i=this._promise.then((()=>e)).then(t,n),a=i.then();return this._promise=r(i,this._maxDelay),a}enqueue(e){const t=this._promise.then(e),n=t.then();return this._promise=r(t,this._maxDelay),n}};function r(e,t){return t>=0?new Promise((r=>{const n=()=>{r()};e.then(n,n),setTimeout(n,t)})):e.then(n,n)}function n(){}t.PromiseQueueMap=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._map=new Map,this._maxDelay=e}waitIfPending(e){return this._map.get(e)}wait(e){return this._map.get(e)||Promise.resolve()}enqueueHandlers(e,t,r,n){const i=this.wait(e).then((()=>t)).then(r,n);return this._addToMap(e,i)}enqueue(e,t){const r=this.wait(e).then(t);return this._addToMap(e,r)}_addToMap(e,t){const n=t.then();let i;const a=()=>{this._map.get(e)===i&&this._map.delete(e)};return i=r(t,this._maxDelay).then(a,a),this._map.set(e,i),n}}},66751:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseReduce=void 0;var i=n(r(11504));const a=function(){var e=(0,i.default)((function*(e,t,r){let n=r;const i=e.length;for(let r=0;r<i;r++)n=yield t(n,e[r],r);return n}));return function(){return e.apply(this,arguments)}}();t.promiseReduce=a},72287:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseRetryLoop=void 0;var n=r(37178),i=r(13959),a=r(88156);t.PromiseRetryLoop=class{constructor(e){this._resolvable=new a.Resolvable,this._promise=null,this._resetTime=null,this._currentLoopIdentificator=0,this.endWithValue=e=>{this._currentLoopIdentificator++,this._resolvable.resolve(e)},this._options=e}resetTimeoutAfter(e){this._resetTime=Date.now()+e}cancelReset(){this._resetTime=null}reset(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: resetting ${this._options.name}`,this._currentLoopIdentificator++,this._runLoop())}start(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: starting ${this._options.name}`,0!==this._currentLoopIdentificator&&__LOG__(4,void 0,new Error)`PromiseRetryLoop was called several times. You may have race conditions`,this._currentLoopIdentificator++,this._runLoop())}_runLoop(){const e=this._options,t=this._currentLoopIdentificator;let r=(0,n.createTimer)(this._options.timer);r();const a=()=>{if(this._resolvable.resolveWasCalled())return;if(t!==this._currentLoopIdentificator)return;const s=Date.now();return this._promise=(0,e.code)(this.endWithValue).then((()=>{if(this._resolvable.resolveWasCalled())return;const{resetDelay:t}=e;(void 0!==t&&Date.now()>=s+t||null!=this._resetTime&&this._resetTime<=Date.now())&&(__LOG__(2)`PromiseRetryLoop: resetting ${e.name}`,r=(0,n.createTimer)(this._options.timer)),this._resetTime=null;const o=r();return __LOG__(2)`PromiseRetryLoop: retrying ${e.name} in ${o}ms`,(0,i.delayMs)(o).then(a)})),this._promise};this._promise=Promise.resolve().then(a)}promise(){return this._resolvable.resolveWasCalled()?this._resolvable.promise:this._promise?Promise.race([this._resolvable.promise,this._promise.then((()=>this._resolvable.promise))]):Promise.reject(new Error(`PromiseRetryLoop ${this._options.name} had promise() called before start()`))}}},38284:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseTimeout=void 0;var n=r(40265);t.promiseTimeout=(e,t,r)=>{let i=null,a=null;const s=new Promise(((e,s)=>{a=s,i=setTimeout((()=>{s(new n.TimeoutError(r)),clearTimeout(i)}),t)}));return Promise.race([e,s]).finally((()=>{a&&a(new Error),clearTimeout(i)}))}},20461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseWrapSync=function(e){return function(){try{return Promise.resolve(e.apply(this,arguments))}catch(e){return Promise.reject(e)}}}},88156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resolvable=void 0;t.Resolvable=class{constructor(){this._isResolved=!1,this.promise=new Promise((e=>{this._resolve=e}))}resolve(e){this._isResolved=!0,this._resolve(e)}reject(e){this.resolve(Promise.reject(e))}resolveWasCalled(){return this._isResolved}}},97197:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;t.Semaphore=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._count=0,this._queue=[],this._size=e}acquire(){return new Promise(((e,t)=>{this._performAcquisition(e,t)}))}availablePermits(){return this._size-this._count}_performRelease(){this._count--,this._dequeue()}_performAcquisition(e,t){if(this._count<this._size){this._count++;let t=!1;e({release:()=>{if(t)throw new Error("Permit has already been released");t=!0,this._performRelease()}})}else this._enqueue(e,t)}_enqueue(e,t){this._queue.push([e,t])}_dequeue(){if(0===this._queue.length)return;const[e,t]=this._queue.shift();this._performAcquisition(e,t)}}},74121:(e,t)=>{"use strict";t.Z=y;const r="undefined"!=typeof Promise?Promise:null,n="function"==typeof setImmediate?setImmediate:null;let i=0;const a=[],s=[],o=[],l={sentinel:"CONTINUE_AS_IF_NO_HANDLER"},c={sentinel:"RETRY_ASYNCHRONOUSLY"},d={sentinel:"TO_STRING"},u={sentinel:"DID_ERROR"};let p=null;const h=[],f=64,_=128,m=512,g="undefined"==typeof self?void 0:self;function y(e,t){this._flags=0,this._value=void 0,this._onFulfilled=void 0,this._onRejected=void 0,this._context=void 0,this._resolveLevel=0,this._control=void 0,this.x=void 0,this._thenableParent=null,this._parent=void 0,this._child=void 0,this._children=void 0,this.control=void 0,t&&(this._context=t.this),"function"==typeof e&&(this._onFulfilled=e,this._flags|=4,this._flags|=256,Y(e,this._context,(e=>R(this,0,!0,!1,e)),(e=>R(this,0,!1,!1,e))))}let E,S;function v(e){if(void 0===e)return E;if(I(e))return e;{const t=new y;return R(t,0,!0,!1,e),H(t,m),t}}function T(e){const t=new y;return t._value=e,H(t,514),h.push(t),t}function A(e){let t="";if(e._flags&_){t=(e._onFulfilled||e._onRejected).call(e._context,d)}else if(e._control)t=`.addRawControl(${e._control.name}, ${e._control.foo})`;else if(16&e._flags)t=`.endWithControls(${Object.keys(e.control)})`;else if(e._flags&m)t=1&e._flags?`Promise.resolve(${void 0===e._value?"":e._value})`:`Promise.reject(${void 0===e._value?"":e._value})`;else if(256&e._flags)switch(3&e._flags){case 2:case 0:case 1:t=`new Promise(${e._onFulfilled})`}else e._onFulfilled&&e._onRejected?t=`.then(${e._onFulfilled}, ${e._onRejected})`:e._onFulfilled?t=`.then(${e._onFulfilled})`:e._onRejected&&(t=`.catch(${e._onRejected})`);return t}function C(e){this.message=e,this.stack=new Error(e||this.name).stack}function b(){0===i&&(s.length||h.length)&&(i=1,S||(S=function(){let e,t,i=0;return"undefined"==typeof MutationObserver||g&&g.navigator&&g.navigator.standalone?r?function(){r.resolve().then(x)}:"function"==typeof n?function(){n(x)}:function(){setTimeout(x,0)}:(e=document.createTextNode(""),t=new MutationObserver(x),t.observe(e,{characterData:!0}),function(){e.data=i=1-i})}()),S())}function P(e,t){H(e,8),t._parent=e,e._children?e._children.push(t):e._child?(e._children=[e._child,t],e._child=void 0):e._child=t}function M(e){if(e&&("object"==typeof e||"function"==typeof e)){let t;try{t=e.then}catch(e){return p=e,u}if("function"==typeof t)return t}}function O(e){if(!e||I(e))return e;const t=M(e);if(t===u)return T(p);if(t){const r=new y((function(r,n){t.call(e,r,n)}));return r._thenableParent=e,r}return e}function I(e){return e instanceof y}function w(e,t,r){const n=I(e=O(e));let i,a,s,o,d=!1;if(n){if(!(3&e._flags))return H(e.then(t,r),32);H(e,8),d=!!(e._flags&f),s=e._context,i=1&e._flags?t:r,a=e._value}else i=t,a=e;if(!i)return v(e).then();if(a=W(i,s,a,!0),a===u)o=T(p);else{if(a===c)return v(e).then(t,r);if(a===l)return n?e.then():v(e);o=v(a)}return d&&(o=o.cancellable()),void 0!==s&&(o=o.then(),o._context=s),o}function R(e,t,r,n,i){if(t!==e._resolveLevel)return;const a=++e._resolveLevel;if(H(e,4),e._thenableParent=null,r)if(i===e)e._parent=void 0,G(e,!1,n,new TypeError("promise resolved to itself"));else if(I(i)){const t=3&i._flags;0===t?P(i,e):(e._parent=i,H(e,1024),H(i,8),G(e,1===t,n,i._value))}else{const t=M(i);t===u?(e._parent=void 0,G(e,!1,n,p)):t?(e._parent=void 0,e._thenableParent=i,Y(t,i,(t=>R(e,a,!0,!1,t)),(t=>R(e,a,!1,!1,t)))):G(e,!0,n,i)}else G(e,!1,n,i)}function D(e,t,r,n,i){t===e._resolveLevel&&(N(e),R(e,t,r,n,i))}function N(e){if(e._parent){const t=e._parent;if(e._parent=void 0,t._child===e)t._child=void 0;else if(t._children){const r=t._children;for(let t=0;t<r.length;t++)if(r[t]===e){r.splice(t,1);break}0===r.length&&(t._children=void 0)}}}function L(e){if(null==e)throw new Error(`Invalid .catch guard ${e}`);if("function"==typeof e)return e;if("object"==typeof e)throw new Error("Object guards in .catch are currently unsupported");return function(t){return t===e}}function k(e,t){return function(r,n){return r===d?`.catch(..., ${t})`:e&&!function(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n===Error||n.prototype instanceof Error){if(t instanceof n)return!0}else if(n(t))return!0}return!1}(e,r)?l:n?c:t.call(this,r)}}function G(e,t,r,n){if(H(e,4|(t?1:2)),e._value=n,e._child)U(e._child,t,r,n),e._child=void 0;else if(e._children){const i=e._children;e._children=void 0;for(let e=0;e<i.length;e++)U(i[e],t,r,n)}else t||8&e._flags||h.push(e)}function U(e,t,r,n){e._resolveLevel++;const i=j(e,t);if(i&&32&e._flags){H(e,4);const a=W(i,e._context,n,!0);if(a!==c)return void(a===u?(e._parent=void 0,G(e,!1,r,p)):a===l?G(e,t,r,n):(e._parent=void 0,R(e,e._resolveLevel,!0,r,a)));e._flags&=-5}i?((r?o:s).push(e),b()):G(e,t,r,n)}function F(e,t){for(;0!==e.length;)t.push(e.pop())}function x(){for(;0!==a.length||0!==s.length;){0===a.length&&F(s,a);const e=a.pop(),t=e._parent;let r=!!(t&&1&t._flags),n=t&&t._value;const i=j(e,r);if(H(e,4),i){let t;do{t=W(i,e._context,n,!1)}while(t===c);t===u?(n=p,r=!1,e._parent=void 0):t!==l&&(n=t,r=!0,e._parent=void 0)}3&e._flags||(R(e,e._resolveLevel,r,!0,n),F(o,a))}for(i--;0!==h.length;){const e=h.pop();8&e._flags||K(e,e._value)}}y.resolve=v,y.reject=T,y.prototype.then=function(e,t){"function"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0);const r=new y;r._onFulfilled=e,r._onRejected=t,r._context=this._context,this._flags&f&&H(r,f);const n=3&this._flags;return 0===n?P(this,r):(H(this,8),(1===n?e:t)?(r._parent=this,s.push(r),b()):(r._parent=this,H(r,n),r._value=this._value,2===n&&h.push(r))),r},y.prototype.catch=function(e){const t=arguments.length-1;if(0===t)return this.then(void 0,e);const r=new Array(t);for(let e=0;e<t;e++)r[e]=L(arguments[e]);const n=k(r,arguments[t]),i=w(this,void 0,n);return i._onRejected&&H(i,_),i},y.all=function(e){return new y((function(t,r){let n=e.length;if(0===n)return void t([]);const i=new Array(e.length);function a(e){if(0==--n){const r=[];for(let t=0;t<i.length;t++){const n=i[t];r.push(n&&3&n._flags?n._value:e)}t(r)}return e}for(let t=0;t<e.length;t++)i[t]=w(e[t],a,r)}))},y.allSettled=function(e){return new y((function(t){const r=Array.from(e);let n=r.length;if(0===n)return void t([]);const i=new Array(r.length);function a(e){return function(r){const a=e?{status:"rejected",reason:r}:{status:"fulfilled",value:r};if(0==--n){const e=[];for(let t=0;t<i.length;t++){const r=i[t];e.push(r&&3&r._flags?r._value:a)}t(e)}return a}}const s=a(!1),o=a(!0);for(let e=0;e<r.length;e++)i[e]=w(r[e],s,o)}))},y.race=function(e){const t=O(e);if(I(t)){const e=t.then((e=>y.race(e)));return e._context=void 0,e._flags&=-65,e}return new y((function(e,r){for(let n=0;n<t.length;n++){const i=O(t[n]);if(!I(i)||3&i._flags)for(e(i),n++;n<t.length;n++){const e=t[n];I(e)&&H(e,8)}else i.then(e,r)}}))},y.prototype.toString=function(){const e=[];let t;for(let r=this,n=!1;r;r=r._parent){t=r,!n&&3&r._flags&&(n=!0,r._flags&m||(1&r._flags?e.push(`[resolved value: ${r._value}]`):e.push(`[rejected reason: ${r._value}]`)));let i=A(r);1024&r._flags&&(i=`~${i}`),e.push(i)}return e.reverse(),768&t._flags||(e[0]=`[Promise]${e[0]}`),e.join("\n")},y.prototype.finally=function(e){function t(t){return t===d?`.finally(${e})`:(e.call(this),l)}return H(this.then(t,t),_)},C.prototype=Object.create(Error.prototype,{name:{value:"AbortError"}}),y.CancellationError=C,y.prototype.cancellable=function(){return H(this.then(),f)},y.prototype.cancel=function(e){let t;for(let e=this;e&&!(3&e._flags);e=e._parent)e._flags&f&&(t=e);if(t)if(void 0===e&&(e=new C),j(t,!1)){const r=new y;N(t),P(r,t),D(r,0,!1,!1,e)}else D(t,t._resolveLevel,!1,!1,e)};const B=null==(null==g?void 0:g.dispatchEvent)?null:class extends Event{constructor(e,t){super(e,{cancelable:!0}),Object.defineProperties(this,{promise:{value:t.promise,enumerable:!0},reason:{value:t.reason,enumerable:!0}})}};function K(e,t){if(null!=(null==g?void 0:g.dispatchEvent)){const r=new B("unhandledrejection",{promise:e,reason:t});if(g.dispatchEvent(r),!g.PromiseRejectionEvent&&g.onunhandledrejection)try{g.onunhandledrejection(r)}catch(e){}}else"undefined"!=typeof process&&null!=process.emit?process.emit("unhandledRejection",t,e):console.error(`StackPromise did not catch ${t}`,e,t)}function Y(e,t,r,n){try{e.call(t,r,n)}catch(e){n(e)}}function j(e,t){if(!(4&e._flags))return t?e._onFulfilled:e._onRejected}function W(e,t,r,n){try{return n?e.call(t,r,!0):e.call(t,r)}catch(e){return p=e,u}}function H(e,t){return e._flags|=t,e}E=new y,R(E,0,!0,!1,void 0)},8243:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decimalStringToLongInt=function(e){if(!/^-?\d+$/.test(e))throw __LOG__(2)`"${e}" is not a valid decimal string`,new Error("decimalStringToLongInt is given an invalid decimal string");const t="-"===e[0],r=e.replace(/^-?0*/,""),i=r.length;if(i<16||16===i&&r<="9007199254740991")return t?-Number(r):Number(r);if(i>20||20===i&&r>"18446744073709551615"||t&&(i>19||19===i&&r>"9223372036854775807"))throw __LOG__(2)`"${e}" is over 64 bits`,new Error("decimalStringToHexLong is given value over 64 bits");let a=0,s=0;for(let e=0;e<i;e++)a=10*a+Number(r[e]),s=10*s+Math.floor(a/4294967296),a%=4294967296;return(0,n.createHexLongFrom32Bits)(s,a,t)},t.isBiggerLongInt=function(e,t){if("number"==typeof e&&"number"==typeof t)return e>t;const r="number"==typeof e?(0,n.hexLongFromNumber)(e):e,i="number"==typeof t?(0,n.hexLongFromNumber)(t):t;return(0,n.isBiggerHexLong)(r,i)},t.longIntToDecimalString=function(e){if("number"==typeof e)return e.toString(10);const t=(0,n.hexLongToHex)(e),r=[0];let i=0;for(let e=0;e<t.length;e++){i=(0,n.hexAt)(t,e);for(let e=0;e<r.length;e++)r[e]=16*r[e]+i,i=r[e]/10|0,r[e]%=10;for(;i>0;)r.push(i%10),i=i/10|0}const a=r.reverse().join("");return(0,n.hexLongIsNegative)(e)?"-"+a:a},t.maybeNumberOrThrowIfTooLarge=void 0,t.numberOrThrowIfTooLarge=i;var n=r(87614);function i(e){if("number"!=typeof e)throw __LOG__(2)`${e} is not a safe integer`,new Error("numberOrThrowIfTooLarge is given a non-safe integer");return e}t.maybeNumberOrThrowIfTooLarge=e=>null==e?e:i(e)},42098:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spec=void 0,t.compileSpec=function(e){if(e.internalCompiledSpec)return e.internalCompiledSpec;const t=e.internalSpec;if(!t)throw new Error(`Message Class ${String(e)} does not have internalSpec`);const r=e.internalDefaults||{},s=Object.keys(t).filter((e=>e!==n.KEYS.ONEOF)),o=new Array(s.length),l=[],c=[],d=new Array(s.length),u=t[n.KEYS.ONEOF]||{};s.sort(((e,r)=>{const n=a(t,e),i=a(t,r);return n[0]-i[0]}));for(let e=0;e<s.length;e++){const i=s[e],u=a(t,i);d[e]=r[i];const p=u[1],h=u[0];if(l.push(h),c.push(p),(p&n.TYPE_MASK)===n.TYPES.MESSAGE)o[e]=u[2];else if((p&n.TYPE_MASK)===n.TYPES.ENUM){const t=u[2];if("function"==typeof t.cast)o[e]=t;else{let r,n=!0,i=0;for(const e in t)n&&e!==i++&&(n=!1);if(n){r=[];for(let e=0;e<i;e++)r.push(!0)}else{r={};for(const e in t)r[t[e]]=!0}o[e]=r}}else o[e]=null}const p={};for(const e in u)u[e].forEach((t=>{p[t]||(p[t]=[]),p[t].push(e)}));const h=t[n.KEYS.RESERVED]&&t[n.KEYS.RESERVED][n.KEYS.RESERVED_TAGS],f=t[n.KEYS.RESERVED]&&t[n.KEYS.RESERVED][n.KEYS.RESERVED_FIELDS],_=new i(s,l,c,d,o,u,p,h,f);return e.internalCompiledSpec=_,_};var n=r(1390);class i{constructor(e,t,r,n,i,a,s,o,l){this.names=e,this.fields=t,this.types=r,this.defaults=n,this.meta=i,this.oneofToFields=a,this.fieldToOneof=s,this.reservedTags=o?o.reduce(((e,t)=>(e[t]=!0,e)),{}):{},this.reservedFields=l?l.reduce(((e,t)=>(e[t]=!0,e)),{}):{}}}function a(e,t){const r=e[t];if(null==r)throw new Error(`fieldData of ${t} is missing`);return r}t.Spec=i},1390:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_MASK=t.TYPES=t.KEYS=t.FLAGS=t.ENC=void 0;t.FLAGS={REPEATED:64,PACKED:128,REQUIRED:256};t.TYPE_MASK=31;t.TYPES={INT32:1,INT64:2,UINT32:3,UINT64:4,SINT32:5,SINT64:6,BOOL:7,ENUM:8,FIXED64:9,SFIXED64:10,DOUBLE:11,STRING:12,BYTES:13,MESSAGE:14,FIXED32:15,SFIXED32:16,FLOAT:17};t.ENC={VARINT:0,BIT64:1,BINARY:2,BIT32:5};t.KEYS={ONEOF:"__oneofs__",RESERVED:"__reserved__",RESERVED_TAGS:"tags",RESERVED_FIELDS:"fields"}},72058:(e,t,r)=>{"use strict";var n=r(71954);Object.defineProperty(t,"__esModule",{value:!0}),t.typeToEncType=function(e){if(e&a.PACKED)return l.BINARY;const t=e&o;return t<=s.ENUM?l.VARINT:t<=s.DOUBLE?l.BIT64:t<=s.MESSAGE?l.BINARY:l.BIT32};var i=n(r(1390));const{FLAGS:a,TYPES:s,TYPE_MASK:o,ENC:l}=i},49259:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequirements=l,t.checkValid=function(e,t){l(e,t);const r=_(t,e);if(r)throw r.path.reverse(),new TypeError(`Invalid value at ${r.path.join(".")}: ${r.error}`)};var i=n(r(33344)),a=r(42098),s=r(1390);const o=Number.MAX_SAFE_INTEGER;function l(e,t){const r=c(e,t);if(r)throw r.reverse(),new TypeError(`Message missing required value ${r.join(".")}`)}function c(e,t){const{names:r,types:n,meta:o}=(0,a.compileSpec)(e);let l;for(let e=0;e<n.length&&!l;e++){const a=n[e],d=r[e],u=(0,i.default)(t,d)?t[d]:void 0;if(a&s.FLAGS.REQUIRED&&null==u)l=[d];else if((a&s.TYPE_MASK)===s.TYPES.MESSAGE&&a&s.FLAGS.REPEATED&&null!=u){const t=o[e];let r;for(r=0;r<u.length&&!l;r++)l=c(t,u[r]);l&&l.push(`${d}[${r}]`)}else(a&s.TYPE_MASK)===s.TYPES.MESSAGE&&null!=u&&(l=c(o[e],u),l&&l.push(d))}return l}function d(e,t,r){return"string"==typeof e?!/^-?0x[0-9a-f]{16}$/i.test(e)&&(__LOG__(2)`"${h(e)}" is not a valid long`,{path:[],error:"value must be a hex string of the form '0x123...' or '-0x123...' where the tail is always 16 characters long"}):u(e,t,r)}function u(e,t,r){return"number"!=typeof e||e!=e||Math.floor(e)!==e?(__LOG__(2)`"${h(e)}" is not a valid int`,{path:[],error:"value must be an int"}):(e<t||e>=r)&&(__LOG__(2)`"${h(e)}" is out of range`,{path:[],error:"value is out of range"})}function p(e,t,r){return e?void 0:(__LOG__(2)`"${h(r)}" is not ${t}`,{path:[],error:"value is invalid"})}function h(e){return"string"==typeof e?`"${e}"`:Array.isArray(e)?`[${e.join(", ")}]`:`${e}`}const f=[void 0,e=>u(e,-2147483648,2147483648),e=>d(e,-o,o+1),e=>u(e,0,4294967296),e=>d(e,0,o+1),e=>u(e,-2147483648,2147483648),e=>d(e,-o,o+1),e=>p("boolean"==typeof e,"boolean",e),(e,t)=>p("number"==typeof e&&(t[e]||void 0!==t.cast(e)),"in enum",e),e=>d(e,0,o+1),e=>d(e,-o,o+1),e=>p("number"==typeof e,"number",e),e=>p("string"==typeof e,"string",e),e=>p(e instanceof ArrayBuffer||e instanceof Uint8Array,"ArrayBuffer or Uint8Array",e),_,e=>u(e,0,4294967296),e=>u(e,-2147483648,2147483648),e=>p("number"==typeof e,"number",e)];function _(e,t){const{names:r,fields:n,types:i,meta:o,oneofToFields:l,fieldToOneof:c,reservedTags:d,reservedFields:u}=(0,a.compileSpec)(t);let p;for(let t=0;t<r.length&&!p;t++){const a=r[t],_=i[t],m=e[a],g=_&s.TYPE_MASK,y=f[g];if(void 0===y)throw new Error(`Can not find the validator for type ${g}`);if(_&(s.FLAGS.PACKED|s.FLAGS.REPEATED)&&null!=m)if(Array.isArray(m)){const e=o[t];for(let t=0;t<m.length&&!p;t++)p=y(m[t],e),p&&p.path.push(`${a}[${t}]`)}else __LOG__(2)`"${h(m)}" is not an array`,p={path:[a],error:"repeated field must be array"};else if(null!=m){p=y(m,o[t]),p&&p.path.push(a);const r=c[a];r&&r.forEach((t=>{l[t].filter((e=>e!==a)).forEach((r=>{void 0!==e[r]&&(p={path:[t],error:`oneof has fields '${a}' and '${r}' set`})}))})),d[n[t]]&&(p={path:[a],error:`tag ${n[t]} is reserved`}),u[a]&&(p={path:[a],error:"field name is reserved"})}}return p}},84902:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeProtobuf=function(e,t){const r=new a.Binary(t),n=y(e,r,void 0,!1);return(0,u.checkRequirements)(e,n),n},t.decodeProtobufWithUnknowns=function(e,t){const r=new a.Binary(t),n=y(e,r,void 0,!0);return(0,u.checkRequirements)(e,n),n},t.getUnknownFields=function(e){return(0,s.default)(e,"unsafeUnknownFields")?e.unsafeUnknownFields:null};var i=n(r(73982)),a=r(8584),s=n(r(33344)),o=r(87614),l=r(42098),c=r(1390),d=r(72058),u=r(49259);function p(e,t,r){if(e!==(0,d.typeToEncType)(t))throw new Error(`FormatError: ${r} encoded with wire type ${e}`)}function h(e,t,r){switch(t){case c.TYPES.INT32:return f(r,-2147483648,2147483648,e,a.parseInt64OrThrow);case c.TYPES.INT64:return r.readVarInt(_);case c.TYPES.UINT32:return f(r,0,4294967296,e,a.parseUint64OrThrow);case c.TYPES.UINT64:return r.readVarInt(m);case c.TYPES.SINT32:{const t=f(r,0,4294967296,e,a.parseInt64OrThrow);return 1&t?~(t>>>1):t>>>1}case c.TYPES.SINT64:return r.readVarInt(g);case c.TYPES.BOOL:return!!f(r,0,2,e,a.parseUint64OrThrow);case c.TYPES.ENUM:return r.readVarInt(a.parseInt64OrThrow);case c.TYPES.FIXED64:return r.readLong(m,!0);case c.TYPES.SFIXED64:return r.readLong(_,!0);case c.TYPES.DOUBLE:return r.readFloat64(!0);case c.TYPES.STRING:return r.readString(r.readVarInt(a.parseUint64OrThrow));case c.TYPES.BYTES:return r.readBuffer(r.readVarInt(a.parseUint64OrThrow));case c.TYPES.FIXED32:return r.readUint32(!0);case c.TYPES.SFIXED32:return r.readInt32(!0);case c.TYPES.FLOAT:return r.readFloat32(!0)}}function f(e,t,r,n,i){const a=e.readVarInt(i);if(a<t||a>=r)throw new Error(`FormatError: ${n} encoded with out-of-range value ${a}`);return a}function _(e,t){if((0,a.longFitsInDouble)(!0,e,t)){return 4294967296*e+E(t)}{const r=e<0;let n;n=r?0===t?-e:~e:e;const i=r?-t:t;return(0,o.createHexLongFrom32Bits)(n,i,r)}}function m(e,t){if((0,a.longFitsInDouble)(!1,e,t)){return 4294967296*E(e)+E(t)}return(0,o.createHexLongFrom32Bits)(e,t)}function g(e,t){let r=e>>>1,n=e<<31|t>>>1;return 1&t&&(r=~r,n=~n),_(r,n)}function y(e,t,r,n){const{names:s,fields:o,types:d,meta:u,oneofToFields:_,fieldToOneof:m,reservedTags:g,reservedFields:E}=(0,l.compileSpec)(e),{internalDefaults:S}=e,v=r||(0,i.default)({},S)||{};for(let e=0;e<s.length;e++)d[e]&c.FLAGS.REPEATED&&(v[s[e]]=[]);let T=0,A=o[0];for(;t.size();){const e=f(t,0,4294967296,"field and enc type",a.parseInt64OrThrow),r=7&e,i=e>>>3;if(i!==A){const e=T;do{++T===o.length&&(T=0),A=o[T]}while(i!==A&&T!==e)}if(i===A){const e=s[T],o=d[T];p(r,o,e);const l=o&c.TYPE_MASK,f=u[T];if(o&c.FLAGS.PACKED){const r=t.readVarInt(a.parseUint64OrThrow),n=t.readBinary(r);for(;n.size();){const t=h(e,l,n);(l!==c.TYPES.ENUM||f[t]||void 0!==f.cast(t))&&v[e].push(t)}}else if(l===c.TYPES.MESSAGE){const r=t.readVarInt(a.parseUint64OrThrow),i=t.readBinary(r);if(o&c.FLAGS.REPEATED)v[e].push(y(f,i,void 0,n));else{const t=v[e];v[e]=y(f,i,t,n)}}else{const r=h(e,l,t);(l!==c.TYPES.ENUM||f[r]||void 0!==f.cast(r))&&(o&c.FLAGS.REPEATED?v[e].push(r):v[e]=r)}const S=m[e];S&&void 0!==v[e]&&S.forEach((t=>{_[t].filter((t=>t!==e)).forEach((e=>{delete v[e]}))})),(g[i]||E[e])&&delete v[e]}else if(n){let e;switch(v.unsafeUnknownFields||(v.unsafeUnknownFields={}),r){case c.ENC.VARINT:e=t.readVarInt(a.parseInt64OrThrow);break;case c.ENC.BIT64:e=t.readBinary(8);break;case c.ENC.BINARY:e=t.readBinary(t.readVarInt(a.parseUint64OrThrow));break;case c.ENC.BIT32:e=t.readBinary(4)}v.unsafeUnknownFields[i]=e}else r===c.ENC.VARINT?t.readVarInt(a.parseInt64OrThrow):r===c.ENC.BIT64?t.advance(8):r===c.ENC.BINARY?t.advance(t.readVarInt(a.parseUint64OrThrow)):r===c.ENC.BIT32&&t.advance(4)}return v}function E(e){return e>=0?e:4294967296+e}},60980:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeErrorInfo=function(){return void 0!==c?`Last encoded value for ${c}`:"No information known"},t.encodeProtobuf=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Binary;return(0,l.checkValid)(e,t),_(r,t,e),c=void 0,r};var n=r(8584),i=r(87614),a=r(42098),s=r(1390),o=r(72058),l=r(49259);let c;function d(e,t){e.writeVarInt(t)}function u(e,t){if("number"==typeof t&&t<4503599627370496&&t>=-4503599627370496)e.writeVarInt(t>=0?2*t:2*-t-1);else{const r=new n.Binary;let a;"number"==typeof t?(a=t<0,r.writeVarInt(a?-t:t)):(a=(0,i.hexLongIsNegative)(t),r.writeVarIntFromHexLong(a?(0,i.negateHexLong)(t):t));const s=r.peek((()=>r.readByteArray())),o=s.byteLength;if(a){let e,t=0;do{e=s[t],s[t]=128&e|(127&e)-1&127,t++}while(255===s[t-1])}let l=a?1:0;for(let e=0;e<o;e++){const t=s[e],r=128&t|(63&t)<<1|l;l=(64&t)>>6,s[e]=r}1===l&&(s[o-1]|=128,r.writeInt8(1)),e.writeBinary(r)}}function p(e,t){"number"==typeof t?e.writeVarInt(t):e.writeVarIntFromHexLong(t)}const h=[void 0,d,p,d,p,u,u,(e,t)=>{e.writeVarInt(t?1:0)},d,(e,t)=>{"number"==typeof t?e.writeUint64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{"number"==typeof t?e.writeInt64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{e.writeFloat64(t,!0)},function(e,t){e.writeVarInt((0,n.numUtf8Bytes)(t)),e.writeString(t)},function(e,t){e.writeVarInt(t.byteLength),e.writeBuffer(t)},function(e,t,r){e.writeWithVarIntLength(((e,t)=>_(e,t,r)),t)},(e,t)=>{e.writeUint32(t,!0)},(e,t)=>{e.writeInt32(t,!0)},(e,t)=>{e.writeFloat32(t,!0)}],f=h.map((e=>{if(null!=e)return(e,r)=>{e.writeWithVarIntLength(t,r)};function t(t,r){for(let n=0;n<r.length;n++)e(t,r[n])}}));function _(e,t,r){const{names:n,fields:i,types:l,meta:d}=(0,a.compileSpec)(r),{internalDefaults:u}=r;for(let r=0;r<n.length;r++){const a=n[r];let p=t[a];if(null==p&&u&&(p=u[a]),null!=p){c=a;const t=i[r],n=l[r],u=n&s.TYPE_MASK,_=d[r],m=8*t|(0,o.typeToEncType)(n);if(n&s.FLAGS.PACKED){if(p.length>0){e.writeVarInt(m);(0,f[u])(e,p,_)}}else if(n&s.FLAGS.REPEATED)for(let t=0;t<p.length;t++){e.writeVarInt(m);(0,h[u])(e,p[t],_)}else{e.writeVarInt(m);(0,h[u])(e,p,_)}}}}},17793:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_TYPE=void 0,t.castToPreKeyId=h,t.castToSerializedPubKey=f,t.deserializePreKey=function(e){try{const{id:t,publicKey:r,privateKey:s}=(0,a.decodeProtobuf)(n.PreKeyRecordStructureSpec,e);return null==t||null==r||null==s?null:{id:h(t),keyPair:d((0,i.toBytes)(s,32),f(new Uint8Array(r)))}}catch(e){return null}},t.ecdh=function(e,t){return(0,s.scalarMult)(e,t.subarray(1)).buffer},t.makeKeyPair=c,t.makeKeyPairFrom=function(e){const{publicKey:t,secretKey:r}=s.box.keyPair.fromSecretKey(e);return l((0,i.ensureSize)(t,32),(0,i.ensureSize)(r,32))},t.makeKeyPairFromArrayBuffers=function(e,t){return{publicKey:(0,i.toBytes)(e,32),privateKey:(0,i.toBytes)(t,32)}},t.makeKeyPairFromSerialized=d,t.makePreKeys=function(e,t){let r=(e-1)%o;r<=0&&(r+=o);const a=[];for(let e=0;e<t;e++){const e=r===o?1:r+1,t=c(),s=(0,i.encodeSignalProto)(n.PreKeyRecordStructureSpec,{id:e,publicKey:p(t),privateKey:t.privateKey});a.push({plainObject:{id:e,keyPair:t},record:s}),r=e}return a},t.makeRawSenderKey=function(){const e=(0,i.makeBytes)(32);return self.crypto.getRandomValues(e),e},t.makeSerializedKeyPair=function(){const e=c();return u(e.privateKey,p(e))},t.makeSerializedKeyPairFrom=u,t.serializeIdentity=function(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set((0,i.ensureSize)(e,32),1),t},t.serializePubKey=p,t.toSerializeKeyPair=function(e){return u(e.privateKey,p(e))};var n=r(93638),i=r(27764),a=r(84902),s=r(14462);t.KEY_TYPE=5;const o=16777215;function l(e,t){return{publicKey:e,privateKey:t}}function c(){const{publicKey:e,secretKey:t}=s.box.keyPair();return t[0]&=248,t[31]=64|63&t[31],l((0,i.ensureSize)(e,32),(0,i.ensureSize)(t,32))}function d(e,t){return l((0,i.sliceBytes)(t,1,32),e)}function u(e,t){return{serializedPubKey:t,privateKey:e}}function p(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set(e.publicKey,1),t}function h(e){return(0,i.ensureIntInRange)(e,1,o)}function f(e){if(0===e.length||5!==e[0])throw new Error("Unrecognized public key type");return(0,i.ensureSize)(e,33)}},27764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HMAC_SHA256=t.AES_CBC=void 0,t.castRegistrationId=function(e){return d(e)},t.castSenderKeyId=function(e){return d(e)},t.castToByteEncoded=function(e){return e},t.decodeSignalProto=function(e,t,r){return r((0,a.decodeProtobuf)(e,t))},t.encodeSignalProto=function(e,t){return(0,s.encodeProtobuf)(e,t).readByteArray()},t.ensureIntInRange=d,t.ensureSize=c,t.hkdf=function(e,t,r,i){return(0,n.extractWithSaltAndExpand)(e,t,r,i).then((e=>new Uint8Array(e)))},t.makeBytes=function(e){return new Uint8Array(e)},t.makeCryptoKey=function(e,t){let r,n;"hmac-sha256"===t?(r=l,n=["sign"]):(r=o,n=["encrypt","decrypt"]);return self.crypto.subtle.importKey("raw",e,r,!1,n)},t.makeRegistrationId=function(e){const t="extendedRange"===e?2147483646:16380;return(0,i.randomNumberLessThan)(t)+1},t.makeSenderKeyId=function(){return(0,i.randomNumberLessThan)(-1>>>1)+1},t.readBytes=function(e,t){return e.readByteArray(t)},t.sliceBytes=function(e,t,r){if(e.length-t<r)throw new Error(`Can not split off ${r} bytes from index ${t} of ${e.length} bytes`);return e.slice(t,t+r)},t.toBuffer=function(e){const t=e.buffer,r=e.byteOffset,n=e.length;return 0===r&&n===t.byteLength?t:t.slice(r,r+n)},t.toBytes=function(e,t){return c(new Uint8Array(e),t)};var n=r(81576),i=r(7589),a=r(84902),s=r(60980);const o={name:"AES-CBC"};t.AES_CBC=o;const l={name:"HMAC",hash:"SHA-256"};function c(e,t){if(e.length!==t)throw new Error(`Signal expected ${t} bytes, given ${e.length}`);return e}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967296;if("number"==typeof e&&t<=e&&e<r&&Math.floor(e)===e)return e;throw new Error(`Expected integer in range [${t}, ${r}), given ${String(e)}`)}t.HMAC_SHA256=l},93638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignedPreKeyRecordStructureSpec=t.SessionStructureSpec=t.SenderSigningKeySpec=t.SenderMessageKeySpec=t.SenderKeyStateStructureSpec=t.SenderKeyRecordStructureSpec=t.SenderChainKeySpec=t.RecordStructureSpec=t.PreKeyRecordStructureSpec=t.PendingPreKeySpec=t.PendingKeyExchangeSpec=t.MessageKeySpec=t.IdentityKeyPairStructureSpec=t.ChainSpec=t.ChainKeySpec=void 0;var n=r(1390);const i={};t.SessionStructureSpec=i;const a={};t.PendingPreKeySpec=a;const s={};t.PendingKeyExchangeSpec=s;const o={};t.ChainSpec=o;const l={};t.MessageKeySpec=l;const c={};t.ChainKeySpec=c;const d={};t.RecordStructureSpec=d;const u={};t.PreKeyRecordStructureSpec=u;const p={};t.SignedPreKeyRecordStructureSpec=p;const h={};t.IdentityKeyPairStructureSpec=h;const f={};t.SenderKeyStateStructureSpec=f;const _={};t.SenderSigningKeySpec=_;const m={};t.SenderMessageKeySpec=m;const g={};t.SenderChainKeySpec=g;const y={};t.SenderKeyRecordStructureSpec=y,i.internalSpec={sessionVersion:[1,n.TYPES.UINT32],localIdentityPublic:[2,n.TYPES.BYTES],remoteIdentityPublic:[3,n.TYPES.BYTES],rootKey:[4,n.TYPES.BYTES],previousCounter:[5,n.TYPES.UINT32],senderChain:[6,n.TYPES.MESSAGE,o],receiverChains:[7,n.FLAGS.REPEATED|n.TYPES.MESSAGE,o],pendingKeyExchange:[8,n.TYPES.MESSAGE,s],pendingPreKey:[9,n.TYPES.MESSAGE,a],remoteRegistrationId:[10,n.TYPES.UINT32],localRegistrationId:[11,n.TYPES.UINT32],needsRefresh:[12,n.TYPES.BOOL],aliceBaseKey:[13,n.TYPES.BYTES]},a.internalSpec={preKeyId:[1,n.TYPES.UINT32],signedPreKeyId:[3,n.TYPES.INT32],baseKey:[2,n.TYPES.BYTES]},s.internalSpec={sequence:[1,n.TYPES.UINT32],localBaseKey:[2,n.TYPES.BYTES],localBaseKeyPrivate:[3,n.TYPES.BYTES],localRatchetKey:[4,n.TYPES.BYTES],localRatchetKeyPrivate:[5,n.TYPES.BYTES],localIdentityKey:[7,n.TYPES.BYTES],localIdentityKeyPrivate:[8,n.TYPES.BYTES]},o.internalSpec={senderRatchetKey:[1,n.TYPES.BYTES],senderRatchetKeyPrivate:[2,n.TYPES.BYTES],chainKey:[3,n.TYPES.MESSAGE,c],messageKeys:[4,n.FLAGS.REPEATED|n.TYPES.MESSAGE,l]},l.internalSpec={index:[1,n.TYPES.UINT32],cipherKey:[2,n.TYPES.BYTES],macKey:[3,n.TYPES.BYTES],iv:[4,n.TYPES.BYTES]},c.internalSpec={index:[1,n.TYPES.UINT32],key:[2,n.TYPES.BYTES]},d.internalSpec={currentSession:[1,n.TYPES.MESSAGE,i],previousSessions:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,i]},u.internalSpec={id:[1,n.TYPES.UINT32],publicKey:[2,n.TYPES.BYTES],privateKey:[3,n.TYPES.BYTES]},p.internalSpec={id:[1,n.TYPES.UINT32],publicKey:[2,n.TYPES.BYTES],privateKey:[3,n.TYPES.BYTES],signature:[4,n.TYPES.BYTES],timestamp:[5,n.TYPES.FIXED64]},h.internalSpec={publicKey:[1,n.TYPES.BYTES],privateKey:[2,n.TYPES.BYTES]},f.internalSpec={senderKeyId:[1,n.TYPES.UINT32],senderChainKey:[2,n.TYPES.MESSAGE,g],senderSigningKey:[3,n.TYPES.MESSAGE,_],senderMessageKeys:[4,n.FLAGS.REPEATED|n.TYPES.MESSAGE,m]},_.internalSpec={public:[1,n.TYPES.BYTES],private:[2,n.TYPES.BYTES]},m.internalSpec={iteration:[1,n.TYPES.UINT32],seed:[2,n.TYPES.BYTES]},g.internalSpec={iteration:[1,n.TYPES.UINT32],seed:[2,n.TYPES.BYTES]},y.internalSpec={senderKeyStates:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,f]}},4276:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.parseGetExperimentConfigResponseSuccess=function(e){const t=(0,o.assertTag)(e,"iq");if(!t.success)return t;const r=(0,s.parseIQResultResponse)(e);if(!r.success)return r;const n=(0,o.flattenedChildWithTag)(e,"props");if(!n.success)return n;const c=(0,o.assertAttr)(n.value,"protocol","1");if(!c.success)return c;const d=(0,o.optional)(o.attrString,n.value,"ab_key");if(!d.success)return d;const u=(0,o.optional)(o.attrString,n.value,"hash");if(!u.success)return u;const p=(0,o.optional)(o.attrIntRange,n.value,"refresh",0,void 0);if(!p.success)return p;const h=(0,o.optional)(o.attrIntRange,n.value,"refresh_id",0,void 0);if(!h.success)return h;const f=(0,o.mapChildrenWithTag)(n.value,"prop",0,1/0,l);return f.success?(0,a.makeSuccess)((0,i.default)((0,i.default)({},r.value),{},{propsAbKey:d.value,propsHash:u.value,propsRefresh:p.value,propsRefreshId:h.value,propsProp:f.value})):f},t.parseGetExperimentConfigResponseSuccessPropsProp=l;var i=n(r(73982)),a=r(87040),s=r(65363),o=r(8790);function l(e){const t=(0,o.assertTag)(e,"prop");if(!t.success)return t;const r=(0,o.mixinOr)(e,s.parseExperimentConfig,s.parseSamplingConfig,"ExperimentConfig","SamplingConfig");return r.success,r}},65363:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseExperimentConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"config_code",1,void 0);if(!r.success)return r;const a=(0,i.attrString)(e,"config_value");if(!a.success)return a;const s=(0,i.optional)(i.attrIntRange,e,"config_expo_key",0,void 0);return s.success?(0,n.makeSuccess)({configCode:r.value,configValue:a.value,configExpoKey:s.value}):s},t.parseIQErrorBadRequest=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","bad-request");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","400");return n.success?i.voidSuccess:n},t.parseIQErrorFeatureNotImplemented=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","feature-not-implemented");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","501");return n.success?i.voidSuccess:n},t.parseIQErrorInternalServerError=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","internal-server-error");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","500");return n.success?i.voidSuccess:n},t.parseIQErrorResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const r=(0,i.assertAttr)(e,"type","error");return r.success?i.voidSuccess:r},t.parseIQResultResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const r=(0,i.assertAttr)(e,"type","result");return r.success?i.voidSuccess:r},t.parseSamplingConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"event_code",1,void 0);if(!r.success)return r;const a=(0,i.attrIntRange)(e,"sampling_weight",-1e4,1e4);return a.success?(0,n.makeSuccess)({eventCode:r.value,samplingWeight:a.value}):a},t.parseServerNotification=function(e){const t=(0,i.assertTag)(e,"notification");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"t",0,void 0);if(!r.success)return r;const a=(0,i.optional)(i.attrIntRange,e,"offline",0,1024);return a.success?(0,n.makeSuccess)({t:r.value,offline:a.value}):a};var n=r(87040),i=r(8790)},8790:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.SmaxParsingFailure=void 0,t.assertAttr=function(e,t,r){const n=c(e,t);if(!n.success)return n;if(n.value!==r)return f(e,`to have "${t}"="${r}", but instead has "${n.value}"`);return o},t.assertTag=function(e,t){if(e.tag!==t)return f(e,`to be <${t}>`);return o},t.attrInt=d,t.attrIntRange=function(e,t,r,n){const i=d(e,t);if(!i.success)return i;const a=i.value;if(void 0!==r&&a<r)return f(e,`to have "${t}"={at least ${r}} but has value ${a}`);if(void 0!==n&&a>=n)return f(e,`to have "${t}"={below ${n}} but has value ${a}`);return(0,s.makeSuccess)(a)},t.attrString=c,t.childWithTag=function(e,t,r){const n=p(e,t,r);if(!n.success)return n;const i=n.value;if(null==i)return f(e,`to have 1 child <${t}>, but found 0`);return(0,s.makeSuccess)(i)},t.countChildrenWithTag=function(e,t,r,n,i){const a=m(e,t,r,n);if(!a.success)return a;const o=a.value.length;for(let e=0;e<o;e++){const t=i(a.value[e]);if(!t.success)return t}return(0,s.makeSuccess)(o)},t.flattenedChildWithTag=function(e,t){const r=u(e,t);if(!r.success)return r;if(null==r.value)return f(e,`to have 1 child <${t}>, but found 0`);return(0,s.makeSuccess)(r.value)},t.hasLiteralAttr=function(e,t,r){const n=c(e,t);return n.success&&n.value===r},t.identity=function(e){return e},t.mapChildrenWithTag=function(e,t,r,n,i){const a=m(e,t,r,n);if(!a.success)return a;const o=[];for(let e=0;e<a.value.length;e++){const t=i(a.value[e]);if(!t.success)return t;o.push(t.value)}return(0,s.makeSuccess)(o)},t.mixinOr=function(e,t,r,n,a){const o=t(e);if(o.success)return(0,s.makeSuccess)((0,i.default)((0,i.default)({},o.value),{},{mixinName:n}));const l=r(e);if(l.success)return(0,s.makeSuccess)((0,i.default)((0,i.default)({},l.value),{},{mixinName:a}));return f(e,[`to match either ${n} or ${a}, but both mixins failed.`,`${n}: ${o.error}`,`${a}: ${l.error}`].join(" "))},t.optional=function(e,t,r,n,i){return h(t,r)?e(t,r,n,i):o},t.optionalChild=u,t.optionallChildWithTag=p,t.voidSuccess=void 0;var i=n(r(73982)),a=n(r(33344)),s=r(87040);const o=(0,s.makeSuccess)();t.voidSuccess=o;class l extends Error{constructor(){super(...arguments),this.name="SmaxParsingFailure"}}function c(e,t){return h(e,t)?function(e,t){if("string"!=typeof t)return f(e,`decodeAsString: attribute is ${typeof t} not a string: ${String(t)}`);return(0,s.makeSuccess)(t)}(e,e.attrs[t]):f(e,`to have attribute "${t}"`)}function d(e,t){const r=c(e,t);if(!r.success)return r;const n=parseInt(r.value,10);return Number.isNaN(n)?f(e,`to have "${t}"={integer} but has value "${r.value}"`):(0,s.makeSuccess)(n)}function u(e,t){const r=_(e);if(!r.success)return r;const n=r.value;if(null==n)return o;let i=null;for(let r=0;r<n.length;r++){const a=n[r];if(a.tag===t){if(null!=i)return f(e,`to have 1 child <${t}>, but found more than 1`);i=a}}return(0,s.makeSuccess)(i)}function p(e,t,r){const n=u(e,t);return n.success?null==n.value?o:r(n.value):n}function h(e,t){return(0,a.default)(e.attrs,t)}function f(e,t){return(0,s.makeError)(`expected <${e.tag}>: ${t}`)}function _(e){const t=e.content;return t instanceof Uint8Array?f(e,"to have children"):(0,s.makeSuccess)(t)}function m(e,t,r,n){const i=_(e);if(!i.success)return i;const a=i.value;if(null==a)return 0!==r?f(e,`to have at least ${r} <${t}> children, but found 0`):(0,s.makeSuccess)([]);const o=[];for(let e=0;e<a.length;e++){const r=a[e];r.tag===t&&o.push(r)}const l=o.length;return l<r?f(e,`to have at least ${r} <${t}> children, but found ${l}`):l>n?f(e,`to have at most ${n} <${t}> children, but found ${l}`):(0,s.makeSuccess)(o)}t.SmaxParsingFailure=l},76100:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferMod=function(e,t){const r=new Uint8Array(e);if(t>8388607)throw new Error("Divisor is too big");let n=0;for(let e=0;e<r.length;++e)n=((n<<8)+r[e])%t;return n},t.arrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},t.arrayBuffersEqualUNSAFE=function(e,t){const n=new Uint8Array(e),i=new Uint8Array(t);return r(n,i)},t.concatBuffers=function(e){const t=e.map((e=>new Uint8Array(e))),r=t.reduce(((e,t)=>e+t.byteLength),0),n=new Uint8Array(r);return t.reduce(((e,t)=>(n.set(t,e),e+t.byteLength)),0),n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)},t.largeStringToArrayBuffer=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e5;return new Promise((r=>{const n=e.length,i=new ArrayBuffer(n),a=new Uint8Array(i);let s=0;requestAnimationFrame((function o(){const l=Math.min(s+t,n);for(;s<l;)a[s]=e.charCodeAt(s),s++;if(s===n)return void r(i);requestAnimationFrame(o)}))}))},t.stringToArrayBuffer=function(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);let n,i;for(n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return r.buffer},t.uint8ArraysEqualUNSAFE=r;function r(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r!==e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}},47151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeIndexWithoutPreservingOrder=function(e,t){const r=e.pop();t<e.length&&(e[t]=r)}},84973:e=>{e.exports=function(e){throw new Error(`Impossible value, the default statement should never be reached for value: ${e}`)}},15688:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BASE64_DATA_URL_SCHEME=void 0,t.decodeB64=function(e){const t=a(e,43,47,61);if(t)return t.buffer;throw new Error("Base64.decode given invalid string")},t.decodeB64ToJsArray=function(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):a(e,43,47,61);return t&&Array.from(t)},t.decodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=a(e,45,95,t?61:-1);if(r)return r.buffer;throw new Error("Base64.decode given invalid string")},t.encodeB64=function(e){return n(e,43,47,!0)},t.encodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n(e,45,95,t)},t.sizeWhenB64Decoded=function(e){return Math.floor(3*e.length/4)};const r=3e3;function n(e,t,n,a){const s=Array.isArray(e)||e instanceof ArrayBuffer?new Uint8Array(e):e;if(s.length<=r)return i(s,t,n,a);{const e=[];for(let o=0;o<s.length;o+=r)e.push(i(s.subarray(o,o+r),t,n,a));return e.join("")}}function i(e,t,r,n){const i=Math.ceil(4*e.length/3),a=4*Math.ceil(e.length/3),s=new Array(a);for(let t=0,r=0;t<a;t+=4,r+=3){const n=e[r]<<16|e[r+1]<<8|e[r+2];s[t]=n>>18,s[t+1]=n>>12&63,s[t+2]=n>>6&63,s[t+3]=63&n}for(let e=0;e<i;e++){const n=s[e];s[e]=n<26?65+n:n<52?71+n:n<62?n-4:62===n?t:r}for(let e=i;e<a;e++)s[e]=61;const o=String.fromCharCode.apply(String,s);return n?o:o.substring(0,i)}function a(e,t,r,n){let i=e.length;const a=new Int32Array(i+i%4);for(let s=0;s<i;s++){const o=e.charCodeAt(s);if(65<=o&&o<=90)a[s]=o-65;else if(97<=o&&o<=122)a[s]=o-71;else if(48<=o&&o<=57)a[s]=o+4;else if(o===t)a[s]=62;else{if(o!==r){if(o===n){i=s;break}return null!=self.ERROR&&__LOG__(4,void 0,new Error)`Found unexpected character code while decoding B64 at index ${s}, length ${i}: ${o}`,null}a[s]=63}}const s=a.length/4;for(let e=0,t=0;e<s;e++,t+=4)a[e]=a[t]<<18|a[t+1]<<12|a[t+2]<<6|a[t+3];const o=Math.floor(3*i/4),l=new Uint8Array(o);let c=0,d=0;for(;d+3<=o;c++,d+=3){const e=a[c];l[d]=e>>16,l[d+1]=e>>8&255,l[d+2]=255&e}switch(o-d){case 2:l[d]=a[c]>>16,l[d+1]=a[c]>>8&255;break;case 1:l[d]=a[c]>>16}return l}t.BASE64_DATA_URL_SCHEME="data:image/jpeg;base64,"},8584:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binary=void 0,t.longFitsInDouble=u,t.numUtf8Bytes=d,t.parseInt64OrThrow=j,t.parseUint64OrThrow=W;var n=r(87614);const i=65533,a=new Uint8Array(10),s=new Uint8Array(0);class o{constructor(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.write=function(){for(let t=0;t<arguments.length;t++){const r=t<0||arguments.length<=t?void 0:arguments[t];"string"==typeof r?e.writeString(r):"number"==typeof r?e.writeUint8(r):r instanceof o?e.writeBinary(r):r instanceof ArrayBuffer?e.writeBuffer(r):r instanceof Uint8Array&&e.writeByteArray(r)}},t instanceof ArrayBuffer?(this._buffer=new Uint8Array(t),this._readEndIndex=this._writeIndex=t.byteLength):t instanceof Uint8Array&&(this._buffer=t,this._readEndIndex=this._writeIndex=t.length),this._bytesTrashed=0,this._earliestIndex=this._readIndex=0,this._view=null,this._littleEndian=r,this._hiddenReads=0,this._hiddenWrites=0}size(){return this._readEndIndex-this._readIndex}peek(e,t){this._hiddenReads++;const r=this._readIndex,n=this._bytesTrashed;try{return e(this,t)}finally{this._hiddenReads--,this._readIndex=r-(this._bytesTrashed-n)}}advance(e){this._shiftReadOrThrow(e)}readWithViewParser(e,t,r,n){return t(this._getView(),this._shiftReadOrThrow(e),e,r,n)}readWithBytesParser(e,t,r,n){return t(this._buffer,this._shiftReadOrThrow(e),e,r,n)}readUint8(){return p(this,1,f,!1)}readInt8(){return p(this,1,f,!0)}readUint16(){return p(this,2,_,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt32(){return p(this,4,m,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint32(){return p(this,4,g,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt64(){return p(this,8,y,j,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint64(){return p(this,8,y,W,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readLong(e){return p(this,8,y,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}readFloat32(){return p(this,4,E,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readFloat64(){return p(this,8,S,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readVarInt(e){const t=h(this,0,v,this.size());return h(this,t,T,e)}readBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new ArrayBuffer(0):h(this,e,A)}readByteArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new Uint8Array(0):h(this,e,C)}readBinary(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;if(0===e)return new o(void 0,t);const r=h(this,e,C);return new o(r,t)}indexOf(e){if(0===e.length)return 0;const t=this._buffer,r=this._readEndIndex,n=this._readIndex;let i=0,a=n;for(let s=n;s<r;s++)if(t[s]===e[i]){if(0===i&&(a=s),i++,i===e.byteLength)return s-n-e.byteLength+1}else i>0&&(i=0,s=a);return-1}readString(e){return h(this,e,b)}ensureCapacity(e){this._maybeReallocate(this._readIndex+e)}ensureAdditionalCapacity(e){this._maybeReallocate(this._writeIndex+e)}writeToView(e,t,r,n){const i=this._shiftWriteMaybeReallocate(e);return t(this._getView(),i,e,r,n)}writeToBytes(e,t,r,n){const i=this._shiftWriteMaybeReallocate(e);return t(this._buffer,i,e,r,n)}writeUint8(e){K(e,0,256,"uint8"),M(this,1,O,e,!1)}writeInt8(e){K(e,-128,128,"signed int8"),M(this,1,O,e,!0)}writeUint16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,65536,"uint16"),P(this,2,I,e,t)}writeInt16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-32768,32768,"signed int16"),P(this,2,w,e,t)}writeUint32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,4294967296,"uint32"),P(this,4,R,e,t)}writeInt32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-2147483648,2147483648,"signed int32"),P(this,4,D,e,t)}writeUint64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,0x10000000000000000,"uint64"),P(this,8,N,e,t)}writeInt64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-0x8000000000000000,0x8000000000000000,"signed int64"),P(this,8,N,e,t)}writeFloat32(e){P(this,4,L,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeFloat64(e){P(this,8,k,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeVarInt(e){K(e,-0x8000000000000000,0x8000000000000000,"varint (signed int64)");const t=e<0,r=t?-e:e;let n=Math.floor(r/4294967296),i=r-4294967296*n;t&&(n=~n,0===i?n++:i=-i);M(this,B(n,i),G,n,i)}writeVarIntFromHexLong(e){const t=(0,n.hexLongIsNegative)(e),r=t?(0,n.negateHexLong)(e):e,i=(0,n.hexLongToHex)(r);let a=0,s=0;for(let e=0;e<n.NUM_HEX_IN_LONG;e++)a=a<<4|s>>>28,s=s<<4|(0,n.hexAt)(i,e);t&&(a=~a,0===s?a++:s=-s);M(this,B(a,s),G,a,s)}writeBinary(e){const t=e.peek((e=>e.readByteArray()));if(t.length){const e=this._shiftWriteMaybeReallocate(t.length);this._buffer.set(t,e)}}writeBuffer(e){this.writeByteArray(new Uint8Array(e))}writeByteArray(e){const t=this._shiftWriteMaybeReallocate(e.length);this._buffer.set(e,t)}writeBufferView(e){this.writeByteArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}writeString(e){M(this,d(e),U,e)}writeHexLong(e){P(this,8,F,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeBytes(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(let e=0;e<t.length;e++)K(t[e],0,256,"byte");M(this,t.length,x,t)}writeAtomically(e,t){this._hiddenWrites++;let r=this._writeIndex,n=this._bytesTrashed;try{const i=e(this,t);return r=this._writeIndex,n=this._bytesTrashed,i}finally{this._hiddenWrites--,this._writeIndex=r-(this._bytesTrashed-n)}}writeWithVarIntLength(e,t){const r=this._writeIndex,n=this.writeAtomically(e,t),i=this._writeIndex;this.writeVarInt(i-r);const s=this._writeIndex-i,o=this._buffer;for(let e=0;e<s;e++)a[e]=o[i+e];for(let e=i-1;e>=r;e--)o[e+s]=o[e];for(let e=0;e<s;e++)o[r+e]=a[e];return n}static build(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=0;for(let e=0;e<t.length;e++){const r=t[e];"string"==typeof r?n+=d(r):"number"==typeof r?n++:r instanceof o?n+=r.size():r instanceof ArrayBuffer?n+=r.byteLength:r instanceof Uint8Array&&(n+=r.length)}const i=new o;return i.ensureCapacity(n),i.write.apply(i,arguments),i}_getView(){return this._view||(this._view=new DataView(this._buffer.buffer,this._buffer.byteOffset))}_shiftReadOrThrow(e){if(e<0)throw new Error("ReadError: given negative number of bytes to read");const t=this._readIndex,r=t+e;if(r>this._readEndIndex)throw new Error(t===this._readEndIndex?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");return this._readIndex=r,this._hiddenReads||(this._earliestIndex=r),t}_maybeReallocate(e){const t=this._buffer;if(e<=t.length)return e;{const r=this._earliestIndex,n=e-r,i=Math.max(n,2*(t.length-r),64),a=new Uint8Array(i);return r?(a.set(t.subarray(r)),this._bytesTrashed+=r,this._readIndex-=r,this._readEndIndex-=r,this._writeIndex-=r,this._earliestIndex=0):a.set(t),this._buffer=a,this._view=null,n}}_shiftWriteMaybeReallocate(e){const t=this._maybeReallocate(this._writeIndex+e),r=this._writeIndex;return this._writeIndex=t,this._hiddenWrites||(this._readEndIndex=t),r}}t.Binary=o;let l="",c=0;function d(e){if(e===l)return c;const t=e.length;let r=0;for(let n=0;n<t;n++){const i=e.charCodeAt(n);if(i<128)r++;else if(i<2048)r+=2;else if(i<55296||57344<=i&&i<=65535)r+=3;else if(55296<=i&&i<56320&&n+1!==t){const t=e.charCodeAt(n+1);56320<=t&&t<57344?(n++,r+=4):r+=3}else r+=3}return l=e,c=r}function u(e,t,r){const n=t>>21;if(e){const e=Boolean(2097151&t||r);return 0===n||-1===n&&e}return 0===n}function p(e,t,r,n,i){return e.readWithViewParser(t,r,n,i)}function h(e,t,r,n,i){return e.readWithBytesParser(t,r,n,i)}function f(e,t,r,n){return n?e.getInt8(t):e.getUint8(t)}function _(e,t,r,n){return e.getUint16(t,n)}function m(e,t,r,n){return e.getInt32(t,n)}function g(e,t,r,n){return e.getUint32(t,n)}function y(e,t,r,n,i){return n(e.getInt32(i?t+4:t,i),e.getInt32(i?t:t+4,i))}function E(e,t,r,n){return e.getFloat32(t,n)}function S(e,t,r,n){return e.getFloat64(t,n)}function v(e,t,r,n){const i=Math.min(n,10);let a=0,s=128;for(;a<i&&128&s;)s=e[t+a++];if(10===a&&s>1)throw new Error("ParseError: varint exceeds 64 bits");return 128&s?a+1:a}function T(e,t,r,n){let i=0,a=0,s=r;10===r&&(s--,a=1&e[t+s]);for(let r=s-1;r>=0;r--)i=i<<7|a>>>25,a=a<<7|127&e[t+r];return n(i,a)}function A(e,t,r){const n=t+e.byteOffset,i=e.buffer;return 0===n&&r===i.byteLength?i:i.slice(n,n+r)}function C(e,t,r){return e.subarray(t,t+r)}function b(e,t,r){const n=t+r;let a=[],s=null;for(let r=t;r<n;r++){a.length>5e3&&(s||(s=[]),s.push(String.fromCharCode.apply(String,a)),a=[]);const t=0|e[r];if(0==(128&t))a.push(t);else if(192==(224&t)){const s=H(e,r+1,n);if(s){r++;const e=(31&t)<<6|63&s;e>=128?a.push(e):a.push(i)}else a.push(i)}else if(224==(240&t)){const s=H(e,r+1,n),o=H(e,r+2,n);if(s&&o){r+=2;const e=(15&t)<<12|(63&s)<<6|63&o;e>=2048&&!(55296<=e&&e<57344)?a.push(e):a.push(i)}else s?(r++,a.push(i)):a.push(i)}else if(240==(248&t)){const s=H(e,r+1,n),o=H(e,r+2,n),l=H(e,r+3,n);if(s&&o&&l){r+=3;const e=(7&t)<<18|(63&s)<<12|(63&o)<<6|63&l;if(e>=65536&&e<=1114111){const t=e-65536;a.push(55296|t>>10,56320|1023&t)}else a.push(i)}else s&&o?(r+=2,a.push(i)):s?(r++,a.push(i)):a.push(i)}else a.push(i)}const o=String.fromCharCode.apply(String,a);return s?(s.push(o),s.join("")):o}function P(e,t,r,n,i){return e.writeToView(t,r,n,i)}function M(e,t,r,n,i){return e.writeToBytes(t,r,n,i)}function O(e,t,r,n){e[t]=n}function I(e,t,r,n,i){e.setUint16(t,n,i)}function w(e,t,r,n,i){e.setInt16(t,n,i)}function R(e,t,r,n,i){e.setUint32(t,n,i)}function D(e,t,r,n,i){e.setInt32(t,n,i)}function N(e,t,r,n,i){const a=n<0,s=a?-n:n;let o=Math.floor(s/4294967296),l=s-4294967296*o;a&&(o=~o,0===l?o++:l=-l),e.setUint32(i?t+4:t,o,i),e.setUint32(i?t:t+4,l,i)}function L(e,t,r,n,i){e.setFloat32(t,n,i)}function k(e,t,r,n,i){e.setFloat64(t,n,i)}function G(e,t,r,n,i){let a=n,s=i;const o=t+r-1;for(let r=t;r<o;r++)e[r]=128|127&s,s=a<<25|s>>>7,a>>>=7;e[o]=s}function U(e,t,r,n){let i=t;const a=n.length;for(let t=0;t<a;t++){const r=n.charCodeAt(t);if(r<128)e[i++]=r;else if(r<2048)e[i++]=192|r>>6,e[i++]=128|63&r;else if(r<55296||57344<=r)e[i++]=224|r>>12,e[i++]=128|r>>6&63,e[i++]=128|63&r;else if(55296<=r&&r<56320&&t+1!==a){const a=n.charCodeAt(t+1);if(56320<=a&&a<57344){t++;const n=65536+((1023&r)<<10|1023&a);e[i++]=240|n>>18,e[i++]=128|n>>12&63,e[i++]=128|n>>6&63,e[i++]=128|63&n}else e[i++]=239,e[i++]=191,e[i++]=189}else e[i++]=239,e[i++]=191,e[i++]=189}}function F(e,t,r,i,a){const s=(0,n.hexLongIsNegative)(i),o=(0,n.hexLongToHex)(i);let l=0,c=0;for(let e=0;e<16;e++)l=l<<4|c>>>28,c=c<<4|(0,n.hexAt)(o,e);s&&(l=~l,0===c?l++:c=-c),e.setUint32(a?t+4:t,l,a),e.setUint32(a?t:t+4,c,a)}function x(e,t,r,n){for(let i=0;i<r;i++)e[t+i]=n[i]}function B(e,t){let r,n;for(e?(r=5,n=e>>>3):(r=1,n=t>>>7);n;)r++,n>>>=7;return r}function K(e,t,r,n){if("number"!=typeof e||e!=e||Math.floor(e)!==e||e<t||e>=r)throw new TypeError("string"==typeof e?`WriteError: string "${e}" is not a valid ${n}`:`WriteError: ${String(e)} is not a valid ${n}`)}function Y(e,t,r){let n;n=t>=0||e?t:4294967296+t;const i=4294967296*n+(r>=0?r:4294967296+r);if(!u(e,t,r))throw new Error(`ReadError: integer exceeded 53 bits (${i})`);return i}function j(e,t){return Y(!0,e,t)}function W(e,t){return Y(!1,e,t)}function H(e,t,r){if(t>=r)return 0;const n=0|e[t];return 128==(192&n)?n:0}},42341:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r=[];r[34]="ES",r[49]="DE",r[52]="MX",r[44]="GB",r[966]="SA",r[39]="IT",r[93]="AF",r[355]="AL",r[213]="DZ",r[376]="AD",r[244]="AO",r[54]="AR",r[374]="AM",r[297]="AW",r[61]="AU",r[43]="AT",r[994]="AZ",r[973]="BH",r[880]="BD",r[375]="BY",r[32]="BE",r[501]="BZ",r[229]="BJ",r[975]="BT",r[591]="BO",r[387]="BA",r[267]="BW",r[55]="BR",r[246]="IO",r[673]="BN",r[359]="BG",r[226]="BF",r[257]="BI",r[225]="CI",r[855]="KH",r[237]="CM",r[238]="CV",r[236]="CF",r[235]="TD",r[56]="CL",r[86]="CN",r[57]="CO",r[269]="KM",r[242]="CG",r[243]="CD",r[682]="CK",r[506]="CR",r[385]="HR",r[53]="CU",r[599]="CW",r[357]="CY",r[420]="CZ",r[45]="DK",r[253]="DJ",r[593]="EC",r[20]="EG",r[503]="SV",r[240]="GQ",r[291]="ER",r[372]="EE",r[251]="ET",r[298]="FO",r[679]="FJ",r[358]="FI",r[33]="FR",r[594]="GF",r[689]="PF",r[241]="GA",r[220]="GM",r[995]="GE",r[233]="GH",r[350]="GI",r[30]="GR",r[299]="GL",r[590]="GP",r[502]="GT",r[224]="GN",r[245]="GW",r[592]="GY",r[509]="HT",r[504]="HN",r[852]="HK",r[36]="HU",r[354]="IS",r[91]="IN",r[62]="ID",r[98]="IR",r[964]="IQ",r[353]="IE",r[972]="IL",r[81]="JP",r[962]="JO",r[254]="KE",r[965]="KW",r[996]="KG",r[856]="LA",r[371]="LV",r[961]="LB",r[266]="LS",r[231]="LR",r[218]="LY",r[423]="LI",r[370]="LT",r[352]="LU",r[853]="MO",r[389]="MK",r[261]="MG",r[265]="MW",r[60]="MY",r[960]="MV",r[223]="ML",r[356]="MT",r[692]="MH",r[596]="MQ",r[222]="MR",r[230]="MU",r[691]="FM",r[373]="MD",r[377]="MC",r[976]="MN",r[382]="ME",r[212]="MA",r[258]="MZ",r[95]="MM",r[264]="NA",r[674]="NR",r[977]="NP",r[31]="NL",r[687]="NC",r[64]="NZ",r[505]="NI",r[227]="NE",r[234]="NG",r[672]="NF",r[850]="KP",r[47]="NO",r[968]="OM",r[92]="PK",r[680]="PW",r[970]="PS",r[507]="PA",r[675]="PG",r[595]="PY",r[51]="PE",r[63]="PH",r[48]="PL",r[351]="PT",r[974]="QA",r[40]="RO",r[7]="RU",r[250]="RW",r[262]="RE",r[508]="PM",r[685]="WS",r[378]="SM",r[221]="SN",r[381]="RS",r[248]="SC",r[232]="SL",r[65]="SG",r[421]="SK",r[386]="SI",r[677]="SB",r[252]="SO",r[27]="ZA",r[82]="KR",r[211]="SS",r[94]="LK",r[249]="SD",r[597]="SR",r[268]="SZ",r[46]="SE",r[41]="CH",r[963]="SY",r[239]="ST",r[886]="TW",r[992]="TJ",r[255]="TZ",r[66]="TH",r[670]="TL",r[228]="TG",r[676]="TO",r[216]="TN",r[90]="TR",r[993]="TM",r[256]="UG",r[380]="UA",r[971]="AE",r[1]="US",r[598]="UY",r[998]="UZ",r[678]="VU",r[58]="VE",r[84]="VN",r[681]="WF",r[967]="YE",r[260]="ZM",r[263]="ZW",r[383]="XK";var n=r;t.default=n},81574:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={1:'[334,-1,"($1) $2-$3"],10',20:'["Ah","[23]"],[334,"1[0125]|[89]00"],["Bg","1[35]|[4-6]|[89][2-9]"],[9,10]',211:"333,9",212:'["[5-7]BF","5(2[015-7]|3[0-4])|[67]",1],["[58]CE",["5(2[2-489]|3[5-9]|92)|892","5(2([2-48]|9[0-7])|3([5-79]|8[0-7])|924)|892"],1],["5DD",["5(29|38)","5(29|38)[89]"],1],["[5]BBBB","5(4[067]|5[03])"],["8[09];G","8(0|9[013-9])",1],9',213:'["[5-8]BBBB","[5-8]"],["9ACBB",9],9',216:"233,8",218:'[27,"[25-79]",1],9',220:"34,7",221:'[2322,"[379]"],[3222,8],9',222:'"[2-48]ABBB",8',223:'[2222,"[246-9]"],8',224:'[2222,3],[3222,"[67]"],[8,9]',225:"2222,8",226:'[2222,"[025-7]"],8',227:'[233,"08"],[2222,"[0289]"],8',228:'[2222,"[279]"],8',229:"2222,8",230:'[34,"[2-46]|8[013]"],[44,5],[7,8]',231:'[133,"[45]"],[233,2],[234,"[23578]"],[7,8,9]',232:"26,8",233:'[234,"[235]"],9',234:'["CCd","[7-9]"],["CDe","[78]"],["CEf","[78]"],10',235:"2222,8",236:"2222,8",237:'[2222,88],[12222,"[26]"],[8,9]',238:"322,7",239:"34,7",240:'[333,"[235]"],[36,"[89]"],9',241:"[2222,0],8",242:'[234,"[02]"],[144,8],9',243:'[234,1],[333,"[89]"],9',244:'[333,"[29]"],9',245:'[333,"44|9[567]"],[34,40],[7,9]',246:"[34,3],7",247:"5",248:'[133,"[246]"],7',249:'[234,"[19]"],9',250:'["2BCC",2],["[7-9]BCC","[7-9]"],9',251:'"[1-59]ACD",9',252:'[17,"24|[67]"],["BA{5,7}","15|28|6[1-35-9]|799|9[2-9]"],[333,"3[59]|4[89]|6[24-6]|79|8[08]|90"],[8,9]',253:"2222,8",254:'["BA{5,7}","[24-6]"],[36,7],["CCd","[89]"],9',255:'["[24]ACD","[24]"],["[67]BCC","[67]"],["[89]BBD","[89]"],9',256:'[45,[202,2024]],[36,"[27-9]|4(6[45]|[7-9])"],[27,"[34]"],9',257:"2222,8",258:'["[28]ACd","2|8[2-7]"],["80ACC",80],9',260:'["[29]AG","[29]"],["800;CC",8],9',261:'[2232,"[23]"],9',262:'"[268]BBBB",9',263:'["7ACd",7],["86BCC","86[24]"],["CCd","2(1[39]|2[0157]|6[14]|7[35]|84)|329"],["[235]ACd","[23]9|54"],["[25]CA{3,5}",["(25|54)8","258[23]|5483"]],["8CF",86],["80ACD",80],[9,10]',264:'["8ACD","8[1235]"],["6ACd",6],["870;CC",870],9',265:'["2BCC",2],[3222,"[1789]"],9',266:"44,8",267:'["7ACC",7],8',268:'[44,"[027]"],8',269:"322,7",27:'[333,860],[234,"[1-9]"],9',290:"[4,5]",291:"133,7",297:"34,7",298:"6,6",299:"222,6",30:'[244,"21|7"],[46,"2(2|3[2-57-9]|4[2-469]|5[2-59]|6[2-9]|7[2-69]|8[2-49])"],[334,"[2689]"],10',31:'["[1-578]ACD","1[035]|2[0346]|3[03568]|4[0356]|5[0358]|7|8[4578]"],["[1-5]BCC","1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"],["6;H","6[0-57-9]"],["66;G",66],["[89]0AA{4,7}","80|9"],[9,11]',32:"[3222,4],9",33:'[3222,8],[12222,"[1-79]"],9',34:'["[89]00;CC","[89]00"],["[5-9]BBBB","[568]|[79][0-8]"],9',350:"[35,2],8",351:'["2ACD","2[12]"],["[2-46-9]BCC","2[3-9]|[346-9]"],9',352:'[2223,20],[333,6],["BBBBb","2([0367]|4[3-8])"],["BBBA{1,5}","[3-57]|8[13-9]|9(0[89]|[2-579])|(2|80)[2-9]"],9',353:'["AdD",1],["BCd","[2569]|4[1-69]|7[14]"],[333,70],[333,81],[234,"[78]"],[433,1],[2134,8],[244,4],9',354:'[34,"[4-9]"],["3BCC",3],[7,8,9]',355:'["6[6-9];CD",6],9',356:'[44,"[2357-9]"],8',357:"26,8",358:'["CA{3,7}","([1-3]00|[6-8]0)"],["116C",116],["BA{4,10}","[14]|2[09]|50|7[135]"],["AA{4,11}","[25689][1-8]|3"],[6,7,8,9,10,11]',359:'[333,999],["BCd","48|8[7-9]|9[08]"],9',36:'["BCd","[2-9]"],9',370:'[134,"52[0-79]"],[323,"[7-9]"],[26,"37|4([15]|6[1-8])"],[35,"[3-6]"],8',371:'[233,"[269]|8[01]"],8',372:'["[3-79]BD",["[369]|4[3-8]|5([0-2]|5[0-478]|6[45])|7[1-9]","[369]|4[3-8]|5([02]|1([0-8]|95)|5[0-478]|6(4[0-4]|5[1-589]))|7[1-9]"]],["70;BD",70],["8000;CC",[800,8000]],["[458]Cd",["40|5|8(00|[1-5])","40|5|8(00[1-9]|[1-5])"]],[7,8]',373:'[233,"22|3"],["[25-7]BBC","2[13-9]|[5-7]"],["[89]BE","[89]"],8',374:'[26,"1|47"],[26,"4[1349]|[5-7]|9[1-9]"],[35,"[23]"],[323,"8|90"],8',375:'[2322,["17[0-3589]|2[4-9]|[34]","17([02358]|1[0-2]|9[0189])|2[4-9]|[34]"],"$1 $2-$3-$4"],[3222,["1(5[24]|6[235]|7[467])|2(1[246]|2[25]|3[26])","1(5[24]|6(2|3[04-9]|5[0346-9])|7([46]|7[37-9]))|2(1[246]|2[25]|3[26])"],"$1 $2-$3-$4"],[423,["1(5[169]|6[3-5]|7[179])|2(1[35]|2[34]|3[3-5])","1(5[169]|6(3[1-3]|4|5[125])|7(1[3-9]|7[0-24-6]|9[2-7]))|2(1[35]|2[34]|3[3-5])"],"$1 $2-$3"],["[89]BCD","8[01]|9"],["82ADD",82],["800;BA{2,4}",800],9',376:'[33,"[135-9]"],[44,1],[333,6],[6,9]',377:'[2222,"[39]"],[233,4],["6;BBBB",6],[332,8],[8,9]',378:'[2222,"[5-7]"],["0549;F",0,"($1) $2"],8',379:"10",380:'[333,["6[12][29]|(3[1-8]|4[136-8]|5[12457]|6[49])2|(56|65)[24]","6[12][29]|(35|4[1378]|5[12457]|6[49])2|(56|65)[24]|(3[1-46-8]|46)2[013-9]"]],[234,["4[45][0-5]|5(0|6[37])|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]","4[45][0-5]|5(0|6(3[14-7]|7))|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]"]],[45,"[3-6]"],["CCd","[89]"],9',381:'["[23]BA{4,9}","(2[389]|39)0"],["[1-3]AA{5,10}","1|2([0-24-7]|[389][1-9])|3([0-8]|9[1-9])"],["6AA{6,8}",6],["[89]BA{3,9}","[89]"],["7[26];A{4,9}","7[26]"],["7[08]AA{4,9}","7[08]"],[8,9,10]',382:'[233,"[2-57-9]|6[036-9]"],[8,9]',383:'[233,"[23][89]|4[3-79]"],[35,"[89]00"],333,8',385:'["1;DC",1],["[2-5]ACd","[2-5]"],["9ACd",9],["[67]ACd","[67]"],["80[01];Bc",8],["80[01];CC",8],[8,9]',386:'[1322,"[12]|3[24-8]|4[24-8]|5[2-8]|7[3-8]"],["[3-7]ACC","[37][01]|4[0139]|51|6"],["[89][09];A{3,6}","[89][09]"],["[58]BE","59|8[1-3]"],8',387:'[233,"6[1-356]|[7-9]"],[233,"[3-5]","$1 $2-$3"],[2223,6],[8,9]',389:'["2;CD",2],["[347]ACC","[347]"],["[58]BABB","[58]"],8',39:'["BdD","0[26]|55"],["0[26];DE","0[26]"],["0BdD","0[13-57-9][0159]"],["CA{3,6}",["0[13-57-9][0159]|8(03|4[17]|9[245])","0[13-57-9][0159]|8(03|4[17]|9(2|[45][0-4]))"]],["0CCD","0[13-57-9][2-46-8]"],["0CA{2,6}","0[13-57-9][2-46-8]"],["CCd",["[13]|8(00|4[08]|9[59])","[13]|8(00|4[08]|9(5[5-9]|9))"]],[344,3],[9,10]',40:'[234,"[23]1"],[333,"[23][3-7]|[7-9]"],9',41:'["[2-9]ACBB","[2-7]|[89]1"],["[89]BCC","8[047]|90"],[32322,860],9',420:'["[2-9]BCC","[2-8]|9[015-7]"],["96ACCC",96],["9ACCC","9[36]"],9',421:'["2;CCB",2,"$1/$2 $3 $4"],["[3-5]ACBB","[3-5]","$1/$2 $3 $4"],["[689]BCC","[689]"],9',423:'[322,"[237-9]"],[234,69],[333,6],7',43:'["1;A{3,12}",1],["5ADA{4,7}","5[079]"],["CA{3,10}","316|46|51|732|6(5[0-3579]|[6-9])|7([28]0)|[89]"],["DA{3,9}","2|3(1[1-578]|[3-8])|4[2378]|5[2-6]|6([12]|4[1-9]|5[468])|7(2[1-8]|35|4[1-8]|[5-79])"],[10,11,12,13]',44:'["Ee",["1(38|5[23]|69|76|94)","1((38|69)7|5(24|39)|768|946)","1(3873|5(242|39[4-6])|(697|768)[347]|9467)"]],["Df","1([2-69][02-9]|[78])"],[244,["[25]|7(0|6[024-9])","[25]|7(0|6([04-9]|2[356]))"]],[46,7],[334,"[1389]"],10',45:"2222,8",46:'["8;ccB",8],["[1-69]AcBB","1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90"],[3222,"1[2457]|2([247-9]|5[0138])|3[0247-9]|4[1357-9]|5[0-35-9]|6([124-689]|7[0-2])|9([125-8]|3[0-5]|4[0-3])"],["7ACBB",7],["9[034]ABBC","9[034]"],[32322,"25[245]|67[3-6]"],9',47:'["[489]BBC","[489]"],["[235-7]ABBB","[235-7]"],8',48:'[2322,"[14]|2[0-57-9]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145]"],[333,"26|39|5[0137]|6[0469]|7[02389]|8[08]"],9',49:'["BA{3,13}","3[02]|40|[68]9"],["CA{3,12}",["2(0[1-389]|1[124]|2[18]|3[14])|3([35-9][15]|4[015])|906|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1","2(0[1-389]|12[0-8])|3([35-9][15]|4[015])|906|2([13][14]|2[18])|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1"]],["DA{2,11}",["[24-6]|3([3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]","[24-6]|3(3(0[1-467]|2[127-9]|3[124578]|7[1257-9]|8[1256]|9[145])|4(2[135]|4[13578]|9[1346])|5(0[14]|2[1-3589]|6[1-4]|7[13468]|8[13568])|6(2[1-489]|3[124-6]|6[13]|7[12579]|8[1-356]|9[135])|7(2[1-7]|4[145]|6[1-5]|7[1-4])|8(21|3[1468]|6|7[1467]|8[136])|9(0[12479]|2[1358]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]|3[68]4[1347]|3(47|60)[1356]|3(3[46]|46|5[49])[1246]|3[4579]3[1357]"]],[34,138],["EA{2,10}",3],["CA{5,11}",181],["CAA{4,10}","1(3|80)|9"],["Ch","1[67]"],["CA{7,12}",8],[56,[185,1850,18500]],[344,7],[47,"18[68]"],[56,"15[0568]"],[47,"15[1279]"],[38,18],["CBh","1(6[023]|7)"],[427,"15[279]"],[328,15],[7,8,9,10,11,12]',500:"5",501:'[34,"[2-8]",1],["0;800;DC",0,1],7',502:'[44,"[2-7]"],[434,1],8',503:'[44,"[267]"],[344,"[89]"],8',504:'[44,"[237-9]",1],8',505:"44,8",506:'[44,"[24-7]|8[3-9]"],[334,"[89]0",1],8',507:"[44,6,1],8",508:'"[45]ABB",6',509:"224,8",51:"[333,9],9",52:'[244,"33|5[56]|81"],[334,"[2-9]"],[1244,"1(33|5[56]|81)"],[1334,1],[10,11]',53:'["Ag",7],["BA{4,6}","[2-4]"],[17,5],8',54:'[424,["2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9])","2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8]))|2(2[24-9]|3[1-59]|47)","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5[56][46]|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(4[35][56]|58[45]|8([38]5|54|76))[4-6]","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|58|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|54(4|5[13-7]|6[89])|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(454|85[56])[46]|3(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2-$3"],[244,1,"$1 $2-$3"],[334,"[23]","$1 $2-$3"],[334,"[68]",1],[1424,["9(2[2-469]|3[3-578])","9(2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9]))","9(2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8])))|92(2[24-9]|3[1-59]|47)","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5([56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4[35][56]|58[45]|8([38]5|54|76))[4-6]","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|5(4[46]|8)|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|5(4(4|5[13-7]|6[89])|[56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2 $3-$4"],[1244,91,"$1 $2 $3-$4"],[1334,9,"$1 $2 $3-$4"],[10,11]',55:'[244,"[1-9][1-9]","$1 $2-$3"],[254,"([14689][1-9]|2[12478]|3[1-578]|5[1-5]|7[13-579])9","$1 $2-$3"],["[3589]00;cD","[3589]00"],[10,11]',56:'[144,"2[23]"],[234,"[357]|4[1-35]|6[13-57]"],["9;DD",9],["44;CD",44],["[68]00;Cd","60|8"],["600;CBC",60],["1230;CD",1],[54,219],9',57:'[17,["1(8[2-9]|9[0-3]|[2-7])|[24-8]","1(8[2-9]|9(09|[1-3])|[2-7])|[24-8]"]],[37,3],["1;CG",["1(80|9[04])","1(800|9(0[01]|4[78]))"]],[8,10]',58:"[37,-1,1],10",590:'["[56]90;BD",-1,"$1 $2-$3"],9',591:'[17,"[23]|4[46]"],[8,"[67]"],[324,8],8',592:"34,7",593:'[134,"[247]|[356][2-8]",1],[234,9],["1800;Cd",1],[8,9]',594:"3222,9",595:'["BCd","([26]1|3[289]|4[124678]|7[123]|8[1236])"],["CA{3,6}","[2-9]0"],[36,"9[1-9]"],[234,8700],[333,"[2-8][1-9]"],9',596:"3222,9",597:'[34,"[6-8]",1],7',598:'[233,9],[44,"[24]"],8',599:'[34,"[13-7]"],["9;CD",9],[7,8]',60:'["3;DD",3,"$1-$2 $3"],["[18]ACd","1[02-46-9][1-9]|8","$1-$2 $3"],["1;[36-8]00;BD","1[36-8]0",1],["11;DD",11,"$1-$2 $3"],["15[49];CD",15,"$1-$2 $3"],[9,10]',61:'["BCA{2,4}",16],[333,"14|[45]"],[144,"[2378]"],[433,"1(30|[89])"],9',62:'["BA{5,9}","2[124]|[36]1"],["CA{5,7}",800],["CA{5,8}","[2-79]"],["CdC","8[1-35-9]",1],["CA{6,8}",1],[334,804],[3133,80],["CDe",8,1],[2434,0],[9,10,11,12]',63:'["DA{4,6}",["3(23|39|46)|4(2[3-6]|[35]9|4[26]|76)|544|88[245]|(52|64|86)2","3(230|397|461)|4(2(35|[46]4|51)|396|4(22|63)|59[347]|76[15])|5(221|446)|642[23]|8(622|8([24]2|5[13]))"]],[334,"[89]"],[434,1],["DbCD",1],10',64:'[323,"[89]0"],[134,"24|[346]|7[2-57-9]|9[2-9]","$1-$2 $3"],["CCd","2(10|74)|[59]|80"],["BdD","2[028]"],["BCA{3,5}","2([169]|7[0-35-9])|7|86"],[8,9,10]',65:'["[3689]CD","[369]|8[1-9]"],["1[89]00;CD","1[89]"],["7000;DC",70],["800;CD",80],8',66:'["BCd","14|[3-9]"],[433,1],9',670:"[44,7],8",672:"[24,1],[15,3],[5,6]",673:'"[2-578]BD",7',674:"34,7",675:'[34,"[13-689]|27"],[44,"20|7"],[7,8]',676:'[34,"7[5-9]|8[47-9]"],[43,0],7',677:'[25,"[7-9]"],7',678:'[34,"[579]"],7',679:'[34,"[35-9]"],[434,0],7',680:"34,7",681:"222,6",682:"23,5",683:"4",685:'["8Bd",8],["7AE",7],[6,7]',686:"8",687:'[222,"[2-46-9]|5[0-4]","$1.$2.$3"],6',688:"[6,7]",689:'[2222,"4[09]|8[79]"],[222,44],[6,8]',690:"[4,5,6,7]",691:"34,7",692:"[34,-1,1],7",7:'[4222,["7(1[0-8]|2[1-9])","7(1([0-6]2|7|8[27])|2(1[23]|[2-9]2))","7(1([0-6]2|7|8[27])|2(13[03-69]|62[013-9]))|72[1-57-9]2"]],[5122,["7(1[0-68]|2[1-9])","7(1([06][3-6]|[18]|2[35]|[3-5][3-5])|2([13][3-5]|[24-689]|7[457]))","7(1(0([356]|4[023])|[18]|2(3[013-9]|5)|3[45]|43[013-79]|5(3[1-8]|4[1-7]|5)|6(3[0-35-9]|[4-6]))|2(1(3[178]|[45])|[24-689]|3[35]|7[457]))|7(14|23)4[0-8]|71(33|45)[1-79]"]],[334,7],[3322,"[3489]","$1 $2-$3-$4"],10',81:'[334,800,1],["DBd","0077",1],[424,"0088",1],["DCd","00(37|66)",1],["DDe","00(37|66)",1],["DEf","00(37|66)",1],["DFg","00(37|66)",1],[244,"[2579]0|80[1-9]",1],10',82:'["AdD",2,1],[234,"60|8",1],["BdD","[1346]|5[1-5]",1],[244,"[57]",1],[533,["003","0030"]],[254,5,1],["EdD",0],[5234,0],[9,10]',84:'[244,"2[48]"],[343,"2[0-35-79]"],["[89]ACBB","8(8|9[89])|9"],["1[2689]ACD","1([26]|8[68]|99)"],["[3578]ACD","[357]|8[1-5]"],["86[89];CC","86[89]"],["1[89]00;A{4,6}",["1[89]0","1[89]00"]],[9,10]',850:"[334,1],10",852:'[44,"[235-7]|[89](0[1-9]|[1-9])"],["800;CC",800],["900;BCC",900],["900;A{2,5}",900],8',853:'"[268]CD",8',855:'["BCd","[1-9]"],[433,1],[8,9]',856:"[2233,2],10",86:'["21;DA{4,6}",21],[344,"3(11|7[179])|4([15]1|3[1-35])|5(1|2[37]|3[12]|51|7[13-79]|9[15])|7(31|5[457]|6[09]|91)|8([57]1|98)"],[434,[807,8078]],[344,"1[3-578]"],["10800;CD",[108,1080,10800]],["Ch",950],11',880:'["CA{3,7}","3([67]|8[013-9])|4(6[168]|7|[89][18])|5(6[128]|9)|6(28|4[14]|5)|7[2-589]|8(0[014-9]|[12])|9[358]|(3[2-5]|4[235]|5[2-578]|6[0389]|76|8[3-7]|9[24])1|(44|66)[01346-9]",1],["DA{3,6}","[13-9]",1],10',886:'["AdD","[25][2-8]|[346]|7[1-9]|8[237-9]"],[234,"[258]"],[333,9],[244,7],9',90:'[334,"512|8[0589]|90"],[3322,["5([0-59]|61)","5([0-59]|616)","5([0-59]|6161)"]],[3322,"[24][1-8]|3[1-9]"],10',91:'[55,["600|7([02-8]|19|9[037-9])|8(0[015-9]|[1-9]|20)|9","600|7([078]|19[0-5]|2([02356-9]|[14][017-9]|9[389])|3([025-9]|1[07-9]|[34][017-9])|4([0-35689]|[47][017-9])|5([02346-9]|1[017-9]|5[017-9])|6([02-9]|1[0-257-9])|9([089]|31|7[02-9]))|8(0([01589]|6[67]|7[02-9])|1([0-57-9]|6[07-9])|2(0[078]|[14][07-9]|[235-9])|3([0357-9]|[126][07-9]|4[1-9])|[45]|6([02457-9]|[136][07-9])|7([078][07-9]|[1-69])|8([0-25-9]|3[07-9]|4[047-9])|9([02-9]|1[027-9]))|9","600|7(0|19[0-5]|2([0235679]|[14][017-9]|8([0-569]|[78][089])|9[389])|3([05-8]|1([089]|7[5-9])|2([5-8]|[0-49][089])|3[017-9]|4([07-9]|11)|9([01689]|[2345][089]|40|7[0189]))|4([056]|1([0135-9]|[23][089]|2[089]|4[089])|2(0[089]|[1-7][089]|[89])|3([0-8][089]|9)|4([089]|11|7[02-8])|7([089]|11|7[02-8])|8([0-24-7][089]|[389])|9([0-7][089]|[89]))|5([0346-9]|1[017-9]|2([03-9]|[12][089])|5[017-9])|6([0346-9]|1[0-257-9]|2([0-4].|[5-9][089])|5([0-367][089]|[4589]))|7(0([02-9]|1[089])|[1-9])|8([0-79]|8(0[0189]|11|8[013-9]|9))|9([089]|313|7([02-8]|9[07-9])))|8(0([01589]|6[67]|7([02-8]|9[05-9]))|1([02-57-9]|1([0-35-9]|4[0-46-9])|6([089]|7[02-8]))|2(0([08]|7[02])|[14]([089]|7[02-8])|[235-9])|3([0357-9]|1([089]|7[02-6])|2([09]|77|8[0-689])|4[1-9]|6([089]|7[02-7]))|[45]|6([02457-9]|1([089]|7[02-8])|3([089]|7[02358])|6([08]|7[02-8]|9[01]))|7(0[07-9]|[1-69]|7([089]|7[02-8])|8([089]|7[02-8]))|8([0-25-9]|3([089]|7[02-8])|4([0489]|7[02-68]))|9([02-9]|1([0289]|7[2-6])))|9"]],[244,"11|2[02]|33|4[04]|79[1-9]|80[2-46]"],[334,"1(2[0-249]|3[0-25]|4[145]|[569][14]|7[1257]|8[1346]|[68][1-9])|2(1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(1[025]|[36][25]|22|4[28]|5[12]|[78]1|9[15])|6(12|[2345]1|57|6[13]|7[14]|80)|7(12|2[14]|3[134]|4[47]|5[15]|[67]1|88)|8(16|2[014]|3[126]|6[136]|7[078]|8[34]|91)"],[433,"1([23579]|[468][1-9])|[2-8]"],[2343,"008"],[334,140],[424,[160,1600]],["DA{2,4};D",[180,1800]],["DdD",[186,1860]],[4333,"18[06]"],10',92:'["Bh","(2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"],["Cg",["2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8])","9(2[3-8]|98)|(2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(22|3[27-9]|4[2-6]|6[3569]|9[25-7]))[2-9]"]],[55,58],[37,3],[2333,"2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91"],[3333,"[24-9]"],10',93:'["[2-7]ACD","[2-7]"],9',94:'[234,7],[333,"[1-689]"],9',95:'["ACd","[12]"],["BCd","[4-7]|8[1-35]"],["ACA{4,6}","9(2[0-4]|[35-9]|4[137-9])"],[144,2],[334,8],[1333,92],[154,9],[8,9,10]',960:'[34,"[3467]|9([1-9]|0[1-9])",1],[334,"[89]00"],7',961:'[133,"[13-69]|7([2-57]|62|8[0-7]|9[04-9])|8[02-9]"],[233,"[7-9]"],[7,8]',962:'["7;DD","7[457-9]"],["Cf","70|8[0158]|9"],9',963:'["BCd","[1-5]"],["9BCC",9],9',964:'["BCd","[2-6]"],[334,7],[9,10]',965:'["Dd","[169]|2([235]|4[1-35-9])|52"],[35,"[25]"],8',966:'[45,9],[234,1],[234,5],["CCd",81],[334,8],9',967:'["7BCC","7[0137]"],9',968:'["CA{4,6}","[58]"],[26,2],[44,"[79]"],8',970:'["5[69]ACC",5],["1[78]00;CC","1[78]"],9',971:'["CA{2,9}","60|8"],[315,"[479]"],[234,5],9',972:'[234,"[57]",1],[433,12,1],[46,159,1],[1333,"1[7-9]",1],["CbCD",15,"$1-$2 $3-$4"],9',973:"44,8",974:'["[3-7]CD","[3-7]"],8',975:'[2222,"1|77"],8',976:'["[12]ABD","[12]1"],["[12]2Af","[12]2[1-3]"],["[12]CE",["[12](27|[3-5])","[12](27|[3-5].)2"]],[44,"[57-9]"],["[12]De",["[12](27|[3-5])","[12](27|[3-5].)[4-9]"]],8',977:'["9BG","9(6[013]|7[245]|8)",1],10',98:'[244,"[1-8]"],["CCd",9],10',992:'[612,[331,3317]],[324,"[34]7|91[78]"],[414,3],[234,"[457-9]"],9',993:'[2222,12,"$1 $2-$3-$4"],[26,6],[3122,"13|[2-5]","$1 $2-$3-$4"],8',994:'[3222,9],[2322,["[12]|365","[12]|365","[12]|365([0-46-9]|5[0-35-9])"]],[2322,"[3-8]"],9',995:'[3222,"[348]"],[333,7],[3222,5],9',996:'[45,"3(1[346]|[24-79])"],[333,"[235-79]"],["CCAc",8],9',998:'[2322,"[679]"],[7,8,9]'}},40265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedError=t.UnimplementedMethod=t.TimeoutError=t.HttpError=t.AggregateError=void 0,t.customError=n,t.hasSupressedQuotaExceededError=function(){return l},t.obtainErrorSummary=function(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))},t.supressQuotaExceededError=function(e){if(null==e||"QuotaExceededError"!==e.name)throw e;l=!0};const r=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function n(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;function i(r){const n=Error.call(this,r);this.message=r,n.name=e,this.name=e,t&&(this.stack=n.stack)}return i.prototype=Object.create(n?n.prototype:r),i.prototype.constructor=i,i}class i extends(n("AggregateError",!0)){constructor(e,t){super(null!=t&&t.length>0?t:function(e){return 0===e.length?"No errors":1===e.length?e[0].message:e.map((e=>"- "+e.message)).join("\n")}(e)),this.errors=e}}t.AggregateError=i;class a extends(n("TimeoutError",!1)){}t.TimeoutError=a;class s extends(n("HttpError",!1)){constructor(e,t){super(e),this.code=t}}t.HttpError=s;class o extends(n("UnimplementedMethod")){}t.UnimplementedMethod=o;let l=!1;class c extends Error{constructor(e,t){super(e),this.inner=t}}t.WrappedError=c},72651:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GzipWrapper=void 0,t.createDeflate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new i(e)},t.inflate=function(e){return(0,n.decompressSync)(e)};var n=r(56856);class i extends n.Gzip{constructor(e){super(e),this._chunks=[],this.ondata=(e,t)=>{if(this._chunks.push(e),!t)return;let r=0;this._chunks.forEach((e=>{r+=e.length}));const n=new Uint8Array(r);let i=0;this._chunks.forEach((e=>{n.set(e,i),i+=e.length})),this._result=n}}push(e,t){if(null!=this._result)throw new Error("Tried to push chunk to compressor after final block");e instanceof Uint8Array?super.push(e,t):e instanceof ArrayBuffer?super.push(new Uint8Array(e),t):super.push((0,n.strToU8)(e),t)}result(){if(null==this._result)throw new Error("Tried to access result before adding final block");return this._result}}t.GzipWrapper=i},33344:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},32176:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null===e)return"null";switch(typeof e){case"undefined":return"undefined";case"number":return`n:${e}`;case"string":return`s:${e}`;case"boolean":return`b:${e.toString()}`;case"object":{let t=r.get(e);return null==t&&(t=n++,r.set(e,t)),`o:${t}`}default:throw new Error("Unsupported type")}};const r=new WeakMap;let n=0},87614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NUM_HEX_IN_LONG=t.HEX_LOWER=void 0,t.bytesToBuffer=function(e){const t=e.buffer;return 0===e.byteOffset&&e.length===t.byteLength?t:t.slice(e.byteOffset,e.byteOffset+e.length)},t.bytesToDebugString=function(e){let t=!0,r=e.length;for(;t&&r;){const n=e[--r];t=32<=n&&n<127}return t?JSON.stringify(String.fromCharCode.apply(String,e)):i(e)},t.createHexLong=o,t.createHexLongFrom32Bits=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=p(e),i=p(t);return`${r?"-":""}0x${n}${i}`},t.hexAt=a,t.hexLongFromNumber=function(e){const t=e<0;return o(t?(-e).toString(16):e.toString(16),t)},t.hexLongIsNegative=d,t.hexLongToHex=c,t.hexOrThrow=s,t.isBiggerHexLong=function(e,t){const r=d(e),n=d(t);if(r!==n)return!r;const i=c(e)>c(t);return r?!i:i},t.negateHexLong=function(e){return d(e)?e.slice(1):"-"+e},t.parseHex=function(e){const t=s(e);if(t.length%2!=0)throw new Error(`parseHex given hex "${t}" which is not a multiple of 8-bits.`);const r=new Uint8Array(t.length>>1);for(let e=0,n=0;e<t.length;e+=2,n++)r[n]=a(t,e)<<4|a(t,e+1);return r.buffer},t.randomHex=function(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t),i(t)},t.toHex=i,t.toLowerCaseHex=function(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];t.push(n[i>>4],n[15&i])}return String.fromCharCode.apply(String,t)};t.NUM_HEX_IN_LONG=16;const r=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],n=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102];function i(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(r[i>>4],r[15&i])}return String.fromCharCode.apply(String,t)}function a(e,t){const r=e.charCodeAt(t);return r<=57?r-48:r<=70?10+r-65:10+r-97}function s(e){if(/[^0-9a-fA-F]/.test(e))throw new Error(`"${e}" is not a valid hex`);return e}function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=s(e);return u(r,16),`${t?"-":""}0x${l(r,16)}`}function l(e,t){const r=t-e.length;let n=e;for(let e=0;e<r;e++)n="0"+n;return n}function c(e){return e.substring(e.indexOf("0x")+2)}function d(e){return"-"===e[0]}function u(e,t){if(e.length>t)throw new Error(`"${e}" is longer than ${4*t} bits.`)}function p(e){if(e>4294967295||e<-4294967296)throw new Error("uint32ToLowerCaseHex given number over 32 bits");return l((e>=0?e:4294967296+e).toString(16),8)}t.HEX_LOWER=n},89181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inflatePhoneRegex=function(e){let t;t="number"==typeof e?String(e).split("").map((e=>".".repeat(Number(e)))).join(")("):e.replace(/;|[a-zA-Z]+/g,(e=>";"===e?")(":e.split("").map((e=>{const t=e.charCodeAt(0);return t>=97?".".repeat(t-96)+"?":".".repeat(t-64)})).join(")(")));return`(${t})`}},19797:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userIdFromJid=t.unsafeCoerceToUserJid=t.unsafeCoerceToGroupJid=t.unsafeCoerceToDeviceJid=t.unsafeCoerceToDeviceId=t.toUserJid=t.toGroupJid=t.toDeviceJid=t.toBroadcastJid=t.switchOnMulticastJidType=t.switchOnJidType=t.switchOnChatJidType=t.stripAgentIdFromDeviceJid=t.sanitizeJidForLogging=t.phoneNumberFromJid=t.parseJidParts=t.maybeSanitizeLogLineText=t.jidUtils=t.isPrimaryDevice=t.interpretAsUserJid=t.interpretAsNumber=t.interpretAsGroupJid=t.interpretAsDeviceId=t.interpretAndValidateJid=t.groupIdFromJid=t.getUserDomain=t.getServerDomain=t.getGroupDomain=t.getGroupCallDomain=t.fullFormDeviceJidString=t.extractUserJid=t.extractUserId=t.extractJidFromJidWithType=t.extractFromJid=t.extractDeviceId=t.extractDeviceIDParts=t.defaultLidDeviceJidForLidUserJid=t.defaultDeviceJidForUser=t.authorToUserId=t.authorAsUserJid=t.asStatusJid=t.asMulticastJid=t.asChatJid=void 0;const n=(0,r(52230).createJidUtils)({platform:"whatsapp"});t.jidUtils=n;const i=n.toDeviceJid;t.toDeviceJid=i;const a=n.toUserJid;t.toUserJid=a;const s=n.toGroupJid;t.toGroupJid=s;const o=n.extractUserId;t.extractUserId=o;const l=n.extractDeviceIDParts;t.extractDeviceIDParts=l;const c=n.extractDeviceId;t.extractDeviceId=c;const d=n.authorToUserId;t.authorToUserId=d;const u=n.authorAsUserJid;t.authorAsUserJid=u;const p=n.getUserDomain;t.getUserDomain=p;const h=n.getGroupDomain;t.getGroupDomain=h;const f=n.getServerDomain;t.getServerDomain=f;const _=n.getGroupCallDomain;t.getGroupCallDomain=_;const m=n.phoneNumberFromJid;t.phoneNumberFromJid=m;const g=n.interpretAsUserJid;t.interpretAsUserJid=g;const y=n.userIdFromJid;t.userIdFromJid=y;const E=n.extractUserJid;t.extractUserJid=E;const S=n.extractJidFromJidWithType;t.extractJidFromJidWithType=S;const v=n.interpretAsGroupJid;t.interpretAsGroupJid=v;const T=n.switchOnChatJidType;t.switchOnChatJidType=T;const A=n.defaultDeviceJidForUser;t.defaultDeviceJidForUser=A;const C=n.defaultLidDeviceJidForLidUserJid;t.defaultLidDeviceJidForLidUserJid=C;const b=n.isPrimaryDevice;t.isPrimaryDevice=b;const P=n.interpretAsDeviceId;t.interpretAsDeviceId=P;const M=n.interpretAsNumber;t.interpretAsNumber=M;const O=n.parseJidParts;t.parseJidParts=O;const I=n.fullFormDeviceJidString;t.fullFormDeviceJidString=I;const w=n.extractFromJid;t.extractFromJid=w;const R=n.interpretAndValidateJid;t.interpretAndValidateJid=R;const D=n.unsafeCoerceToDeviceJid;t.unsafeCoerceToDeviceJid=D;const N=n.unsafeCoerceToUserJid;t.unsafeCoerceToUserJid=N;const L=n.unsafeCoerceToGroupJid;t.unsafeCoerceToGroupJid=L;const k=n.unsafeCoerceToDeviceId;t.unsafeCoerceToDeviceId=k;const G=n.asMulticastJid;t.asMulticastJid=G;const U=n.stripAgentIdFromDeviceJid;t.stripAgentIdFromDeviceJid=U;const F=n.groupIdFromJid;t.groupIdFromJid=F;const x=n.switchOnJidType;t.switchOnJidType=x;const B=n.asChatJid;t.asChatJid=B;const K=n.asStatusJid;t.asStatusJid=K;const Y=n.switchOnMulticastJidType;t.switchOnMulticastJidType=Y;const j=n.toBroadcastJid;t.toBroadcastJid=j;const W=n.sanitizeJidForLogging;t.sanitizeJidForLogging=W;const H=n.maybeSanitizeLogLineText;t.maybeSanitizeLogLineText=H},52230:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.WA_USER_JID_SUFFIX=t.WA_USER_DOMAIN=t.WA_SERVER_DOMAIN=t.SURVEY_USER_JID=t.STATUS_JID=t.MSGR_USER_JID_SUFFIX=t.MSGR_USER_DOMAIN=t.DEFAULT_DEVICE_ID=t.AUTHOR_SYSTEM=t.AUTHOR_ME=void 0,t.createJidUtils=function(e){let{platform:t}=e;const r="msgr"===t?c:_,n="msgr"===t?d:m,h="msgr"===t?u:g,C="msgr"===t?p:m,b="msgr"===t?l:f,P="@g.us";function M(e,t){return`${k(e)}:${t}${b}`}function O(e,t){return`${function(e){if(!e.endsWith(y))throw new Error(`lidFromLidUserJid called with non-LidUserJid "${e}"`);return e.slice(0,-y.length)}(e)}:${t}@lid`}function I(e){return`${e}${b}`}function w(e){return e.endsWith(P)?e:`${e}@g.us`}function R(e){return e.split("@")[0]}function D(e){const t=e.split("@")[0].split(":"),r=t[0],n=t[1];return{userId:r,deviceID:parseInt(n,10)}}function N(e){return D(e).deviceID}function L(e){return e.endsWith(b)?e:null}function k(e){if(!e.endsWith(b))throw new Error(`userIdFromJid called with non-user jid "${e}"`);return e.slice(0,-b.length)}function G(e){return e.endsWith(P)?e:null}function U(e,t){if(null!=L(e))return t.user(e);if(null!=G(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function F(e){const[t,r]=e.split("@"),[n,i]=t.split(":"),[a,s]=n.split(".");return{user:a,device:i,agent:s,server:r}}function x(e){switch(e.jidType){case"user":return e.userJid;case"group":return e.groupJid;case"status":return e.statusJid;case"device":return e.deviceJid;case"broadcast":return e.broadcastJid;case"call":return e.callJid;case"lidUser":return e.lidUserJid;case"lidDevice":return e.lidDeviceJid;default:return(0,i.default)(e.jidType)}}function B(e){if(e===o)return{jidType:"status",statusJid:o};if(n.test(e))return{jidType:"user",userJid:e};if(C.test(e)){return{jidType:"user",userJid:I(e.substr(0,e.indexOf(":")))}}return r.test(e)?{jidType:"device",deviceJid:e}:h.test(e)?{jidType:"group",groupJid:w(e)}:v.test(e)?{jidType:"broadcast",broadcastJid:e}:T.test(e)?{jidType:"call",callJid:e}:E.test(e)?{jidType:"lidUser",lidUserJid:e}:S.test(e)?{jidType:"lidDevice",lidDeviceJid:e}:{jidType:"unknown"}}function K(e){return e}function Y(e){return e}function j(e){return e}function W(e){return e}function H(e){const t=B(e);return"unknown"===t.jidType?e:"status"===t.jidType?t.statusJid:(t.jidType,x(t).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3"))}return{toDeviceJid:M,toUserJid:I,toGroupJid:w,toBroadcastJid:function(e){return`${e}@broadcast`},extractUserId:R,extractDeviceIDParts:D,extractDeviceId:N,authorToUserId:function(e,t){return e===a||e===s?t:R(e)},authorAsUserJid:function(e){return e===a||e===s?null:e},getUserDomain:function(){return b},getGroupDomain:function(){return P},getServerDomain:function(){return"@s.whatsapp.net"},getGroupCallDomain:function(){return"@call"},phoneNumberFromJid:function(e){if(!e.endsWith(b))throw new Error(`phoneNumberFromJid called with non-user jid "${e}"`);return e.slice(0,-b.length)},interpretAsUserJid:L,asChatJid:function(e){return e===o?null:e},asStatusJid:function(e){return e===o?o:null},userIdFromJid:k,extractUserJid:function(e){const t=e.split("@");let r=t[0];const n=t[1];return r=r.split(":")[0],r=r.split(".")[0],`${r}@${n}`},extractJidFromJidWithType:function(e){return"device"===e.jidType?e.deviceJid:"user"===e.jidType?e.userJid:"group"===e.jidType?e.groupJid:"status"===e.jidType?e.statusJid:"call"===e.jidType?e.callJid:"lidUser"===e.jidType?e.lidUserJid:"lidDevice"===e.jidType?e.lidDeviceJid:(e.jidType,e.broadcastJid)},interpretAsGroupJid:G,switchOnChatJidType:U,switchOnJidType:function(e,t){return e===o?t.status():U(e,{user:t.user,group:t.group})},switchOnMulticastJidType:function(e,t){return e===o?t.multicast(o):U(e,{user:t.user,group:t.multicast})},defaultDeviceJidForUser:function(e){return M(e,0)},defaultLidDeviceJidForLidUserJid:function(e){return O(e,0)},isPrimaryDevice:function(e){return 0===N(e)},interpretAsDeviceId:function(e){return e},interpretAsNumber:function(e){return e},parseJidParts:F,fullFormDeviceJidString:function(e){const{user:t,agent:r="0",device:n="0",server:i}=F(e);return`${t}.${r}:${n}@${i}`},extractFromJid:x,interpretAndValidateJid:B,unsafeCoerceToDeviceJid:K,unsafeCoerceToUserJid:Y,unsafeCoerceToGroupJid:j,unsafeCoerceToDeviceId:W,asMulticastJid:function(e){return null==L(e)?e:null},stripAgentIdFromDeviceJid:function(e){const{user:t,device:r="0",server:n}=F(e);return`${t}:${r}@${n}`},groupIdFromJid:function(e){if(!e.endsWith(P))throw new Error(`groupId called with non-group jid "${e}"`);return e.slice(0,-P.length)},sanitizeJidForLogging:H,maybeSanitizeLogLineText:function(e){return e.includes("@")?e.replace(A,H):e}}},t.isAuthorMe=function(e){return"@me"===e},t.isAuthorSystem=function(e){return"@system"===e};var i=n(r(84973));t.DEFAULT_DEVICE_ID=0;const a="@me";t.AUTHOR_ME=a;const s="@system";t.AUTHOR_SYSTEM=s;const o="status@broadcast";t.STATUS_JID=o;const l="@msgr";t.MSGR_USER_DOMAIN=l;t.MSGR_USER_JID_SUFFIX="msgr";const c=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,d=/^([1-9][0-9]{0,19})@msgr$/,u=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,p=/^([1-9][0-9]{0,19}):0?@msgr$/,h="s.whatsapp.net";t.WA_SERVER_DOMAIN=h;const f="@s.whatsapp.net";t.WA_USER_DOMAIN=f;t.WA_USER_JID_SUFFIX="s.whatsapp.net";const _=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,m=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,g=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,y="@lid",E=/^([1-9][0-9]{0,14})@lid$/,S=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,v=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,T=/^([0-9a-fA-F]{18,32})@call$/;t.SURVEY_USER_JID="16505361212@s.whatsapp.net";const A=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g},45095:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(null==e)throw new Error(`Unexpected null or undefined: ${t}`);return e}},40277:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDigits=function(e){const t=e.match(/\d+/g);return null!=t?t.join(""):""},t.findCC=p,t.formatPhone=h,t.formattedPhoneNumber=function(e){return h((0,s.phoneNumberFromJid)(e))},t.isPotentiallyPhoneNumber=function(e){return f.test(e)},t.isPotentiallyValid=function(e,t){if(!/^\d+$/.test(t))return!1;const r=d[e]||u(e);if(!r)return!1;return"number"==typeof r.lengths?r.lengths===t.length:r.lengths.includes(t.length)},t.phoneCC=function(e){return p(e)};var i=n(r(81574)),a=r(89181),s=r(19797);const o=/^(1|2[07]|3[0-469]|4[013-9]|5[1-8]|6[0-6]|7|8[1246]|9[0-58])/,l=new Map;class c{constructor(e){let t;if(Array.isArray(e)){t=e[0];let r=e[1];null!=r&&-1!==r&&(Array.isArray(r)||(r=[r]),this._leadins=r.map((function(e){return new RegExp("^("+e+")")}))),this._formatString=e[2]}else t=e;this._regex=new RegExp(`^${(0,a.inflatePhoneRegex)(t)}$`)}_testAndFormat(e){if(!this._regex.test(e)||!this._checkLeadins(e))return!1;if("string"==typeof this._formatString)return e.replace(this._regex,this._formatString);const t=this._regex.exec(e);return null!=t?t.slice(1).join(null!=this._formatString?"-":" "):void 0}_checkLeadins(e){return!this._leadins||this._leadins.some((function(t){return t.test(e)}))}}const d={};function u(e){const t=null!=i.default[e]?JSON.parse(`[${i.default[e]}]`):null;if(null==t)return null;const r=t.pop();return d[e]={lengths:r,formats:t.map((function(e){return new c(e)}))}}function p(e){const t=e.match(o);return t?t[0]:e.length>=3?e.substring(0,3):e}function h(e){let t=l.get(e);return null==t&&(t=function(e){const t=e.length>0&&"+"===e[0]?e.substring(1):e,r=p(t);if(!r)return t;const n=t.substring(r.length),i=d[r]||u(r);if(!i)return"+"+r+" "+n;const a=i.formats;for(let e=0;e<a.length;e++){const t=a[e]._testAndFormat(n);if(null!=t&&!1!==t&&""!==t)return"+"+r+" "+t}return"+"+r+" "+n}(e),l.set(e,t)),t}const f=/^\+*[\d ()]+$/},87040:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeError=function(e){return{success:!1,error:e}},t.makeSuccess=function(e){return{success:!0,value:e}}},57319:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShiftTimer=void 0;function r(e){if(!(e>=0))throw new Error("ShiftTimer must be given delay >= 0")}t.ShiftTimer=class{constructor(e){this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,this._run=()=>{const e=this._arg,t=this._foo;this._rafId=0,this._timer=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,t(e)},this.onOrBefore=(e,t)=>{r(e);const n=Date.now()+e,i=this._upperBound;if(0!==i&&i<n)return;const a=this._lowerBound;0!==a&&n<a||(this._upperBound=n,this._rafId||this._timer&&!(n<this.ts)||this._setDelay(n,e,t))},this.forceRunNow=e=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._arg=e,this._run()},this.cancel=()=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0},this._foo=e}onOrBeforeRepaint(e){if(this._rafId)return;const t=Date.now(),r=this._lowerBound;if(0!==r&&t<r)return;const n=this._upperBound;(0===n||t<n)&&(this._upperBound=t),this._timer&&(clearTimeout(this._timer),this._timer=0),(!this.ts||this.ts>t)&&(this.ts=t),this._arg=e,this._rafId=requestAnimationFrame(this._run)}onOrAfter(e,t){r(e);const n=Date.now()+e,i=this._lowerBound;if(0!==i&&n<i)return;const a=this._upperBound;0!==a&&a<n||(this._lowerBound=n,(!this._timer||this.ts<n)&&this._setDelay(n,e,t))}debounce(e,t){r(e),this._debounce(Date.now(),e,t)}debounceAndCap(e,t,n){r(e),r(t);const i=Date.now(),a=i+t,s=this._lowerBound,o=this._upperBound;(0===s||s<=a)&&(0===o||a<o)&&(this._upperBound=a),this._debounce(i,e,n)}forceRunNowIfScheduled(){this._timer?(clearTimeout(this._timer),this._run()):this._rafId&&(cancelAnimationFrame(this._rafId),this._run())}isScheduled(){return 0!==this._timer||0!==this._rafId}_debounce(e,t,r){const n=e+t,i=this._lowerBound;if(0!==i&&n<i)return;const a=this.ts,s=this._upperBound;0!==s&&s<n?a<s&&this._setDelay(s,s-e,r):a<n&&this._setDelay(n,t,r)}_setDelay(e,t,r){if(this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._arg=r,this.ts=e,this._timer){const t=e-this._timerTs;if(-16<t&&t<16)return;clearTimeout(this._timer)}this._timer=setTimeout(this._run,t),this._timerTs=e}}},2821:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DO_NOT_RESCHEDULE=void 0,t.awaitTaskPromise=function(e){return l("awaitTaskPromise").awaitTaskPromise(e)},t.deactivate=function(e){o(e,i.DUMMY_UNIXTIME)},t.getScheduledTime=function(e){return l("getScheduledTime").getScheduledTime(e)},t.registerTask=function(e,t){l("registerTask").registerTask(e,t)},t.reschedule=o,t.rescheduleNow=function(e){o(e,(0,i.unixTime)())},t.startScheduler=function(e){__LOG__(2)`startScheduler invoked`,s||(s=new a(e))};var n=r(37178),i=r(92844);t.DO_NOT_RESCHEDULE="no_reschedule";class a{constructor(e){this._started=!1,this._resolvers={},this._timers={},this._timeoutIDs={},this._taskImplementations=new Map,this._scheduledTimeResolver=e.scheduledTimeResolver}_startTask(e){const t=this._taskImplementations.get(e);null!=t?this._scheduledTimeResolver.get(e).then((r=>{const n=null==r;if(!n&&r===i.DUMMY_UNIXTIME)return void __LOG__(2)`Task ${e} deactivated`;let a=null==r?0:1e3*r-(0,i.unixTimeMs)();a=Math.max(0,a),a=Math.min(a,~(1<<31)),__LOG__(2)`Scheduling task ${e} in ${a}ms`,this._timeoutIDs[e]=setTimeout((()=>{delete this._timeoutIDs[e],__LOG__(2)`Firing task ${e}`,t(n).then((t=>{if("no_reschedule"===t)return new Promise((()=>{}));let r;return t===i.DUMMY_UNIXTIME?(__LOG__(2)`Task ${e} complete, deactivating`,delete this._timers[e],r=i.DUMMY_UNIXTIME):t>=0?(__LOG__(2)`Task ${e} complete, waiting ${t}`,delete this._timers[e],r=(0,i.futureUnixTime)(t)):(__LOG__(2)`Task ${e} will try again later`,r=this._getNextRun(e)),this._scheduledTimeResolver.set(e,r)})).then((()=>{this._startTask(e),this._resolvers[e]&&(this._resolvers[e].forEach((e=>e())),delete this._resolvers[e])})).catch((t=>(__LOG__(2)`Task ${e} failed, try again later: ${t}`,this._scheduledTimeResolver.set(e,this._getNextRun(e)).then((()=>{this._startTask(e)})))))}),a)})):__LOG__(4,void 0,new Error)`Tried to start task ${e} before registering its implementation`}_getNextRun(e){return this._timers[e]||(this._timers[e]=(0,n.createTimer)({jitter:.1,max:1e3*i.HOUR_SECONDS,algo:{type:"fibonacci",first:1e3,second:2e3}})),(0,i.futureUnixTime)(Math.round(this._timers[e]()/1e3))}_registerResolver(e,t){this._resolvers[e]||(this._resolvers[e]=[]),this._resolvers[e].push(t)}awaitTaskPromise(e){return new Promise((t=>{this._registerResolver(e,t)}))}reschedule(e,t){this._started?(this._scheduledTimeResolver.set(e,t),null!=this._timeoutIDs[e]&&clearTimeout(this._timeoutIDs[e]),this._startTask(e)):this._scheduledTimeResolver.set(e,t)}registerTask(e,t){this._started||(this._started=!0),this._taskImplementations.set(e,t),this._startTask(e)}getScheduledTime(e){return this._scheduledTimeResolver.get(e)}}let s=null;function o(e,t){l("reschedule").reschedule(e,t)}function l(e){if(s)return s;throw new Error(`TaskScheduler::${e} called before startScheduler`)}},92844:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YEAR_SECONDS=t.WEEK_SECONDS=t.WEEK_MILLISECONDS=t.MonotonicTimer=t.MINUTE_MILLISECONDS=t.MAX_INT=t.HOUR_SECONDS=t.HOUR_MILLISECONDS=t.DUMMY_UNIXTIME=t.DAY_SECONDS=t.DAY_MILLISECONDS=void 0,t.cappedMillisecondsUntil=f,t.castLongIntToUnixTime=function(e){return"number"!=typeof e?(0,n.hexLongIsNegative)(e)?d:c:h(e)},t.castToUnixTime=h,t.delayUntil=function(e){const t=f(e);return new Promise((e=>{setTimeout(e,t)}))},t.futureUnixTime=function(e,t){const r=null!=t?t:_();return h(Math.ceil(r+Math.max(e,0)))},t.getClockSkew=function(){return p},t.happenedWithin=function(e,t){return E(_(),e,t)},t.happenedWithinAt=E,t.isInFuture=function(e){return m(e)>0},t.isOverflowTime=function(e){return e<d||e>c},t.isWithinNext24h=function(e){return e-_()<=a},t.midnight=function(){return h((new Date).setHours(0,0,0,0)/1e3-p)},t.midnightOn=function(e){return h(S(e).setHours(0,0,0,0)/1e3-p)},t.monotonicTime=g,t.monotonicTimeSince=y,t.oldest=function(e,t){return e<t?e:t},t.pastUnixTime=function(e,t){const r=null!=t?t:_();return h(Math.ceil(r-Math.max(e,0)))},t.performanceAbsoluteNow=function(){return Date.now()},t.sameDay=function(e,t){if(Math.abs(e-t)>a)return!1;const r=u.time===e?u.day:S(e+p).getDay(),n=u.time===t?u.day:S(t+p).getDay();return u.time=t,u.day=n,r===n},t.secondsUntil=m,t.setClockSkew=function(e){p=e},t.timeSince_USE_ONLY_IF_APPROVED=function(e){return Math.max(_()-e,0)},t.timeoutFor=function(e,t){const r=_(),n=Math.max(e+t-r,0);return Math.min(1e3*n,~(1<<31))},t.toDate=S,t.toHttpHeaderDate=function(e){return S(e).toUTCString()},t.unixTime=_,t.unixTimeMs=function(){return Date.now()-1e3*p},t.unskewedDate_USE_ONLY_IF_APPROVED=function(){return new Date};var n=r(87614);const i=3600;t.HOUR_SECONDS=i;const a=86400;t.DAY_SECONDS=a;t.WEEK_SECONDS=604800;t.YEAR_SECONDS=31536e3;t.MINUTE_MILLISECONDS=6e4;const s=36e5;t.HOUR_MILLISECONDS=s;const o=864e5;t.DAY_MILLISECONDS=o;t.WEEK_MILLISECONDS=6048e5;const l=1<<31;t.DUMMY_UNIXTIME=l;const c=2147483647;t.MAX_INT=c;const d=-2147483647,u={time:0,day:-4};let p=0;function h(e){return Math.max(d,Math.min(0|e,c))}function f(e){const t=Math.max(e-_(),0);return Math.min(1e3*t,~(1<<31))}function _(){return h(Date.now()/1e3-p)}function m(e){return Math.max(e-_(),0)}function g(){return performance.now()}function y(e){return Math.floor(performance.now()-e)}function E(e,t,r){return Math.abs(e-t)<=r}function S(e){return new Date(1e3*e)}t.MonotonicTimer=class{constructor(){const e=g();this._initTime=e,this._startTime=e}reset(){this._startTime=g()}elapsed(){return y(this._startTime)}cumulative(){return y(this._initTime)}}},32428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatArrayBuffers=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(n);let a=0;return t.forEach((e=>{i.set(new Uint8Array(e),a),a+=e.byteLength})),i.buffer}},95024:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBuffersDeepEqual=function(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(let e=0;e<r.byteLength;e++)if(r.getUint8(e)!==n.getUint8(e))return!1;return!0}},30138:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=[],n=e.length,i=t.length,a=Math.max(n,i);for(let s=0;s<a;s++)s<n&&r.push(e[s]),s<i&&r.push(t[s]);return r}},48206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayMoveMutate=t.arrayMove=void 0;const r=function(e,t,r){const n=r<0?e.length+r:r,i=e.splice(t,1)[0];e.splice(n,0,i)};t.arrayMoveMutate=r;t.arrayMove=function(e,t,n){const i=e.slice();return r(i,t,n),i}},93131:(e,t,r)=>{"use strict";let n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.dir=function(e){!function(){if(n)return;const e=r(12182).D,t=e.length/2;n=new Int32Array(t),i=new Int32Array(t);for(let r=0,a=0;r<t;r++,a+=2)n[r]=e[a]+(0===r?0:n[r-1]),i[r]=e[a+1]}();for(let t=0;t<e.length;t++){let r=0|e.charCodeAt(t);if(55296<=r&&r<56320){if(++t===e.length)break;const n=e.charCodeAt(t);if(!(56320<=n&&n<57344))continue;r=65536+((1023&r)<<10|1023&n)}else if(56320<=r&&r<57344)continue;if(r<n[0])continue;const a=0|n.length;let s=0,o=a-1|0;for(;s<o;){const e=o+s>>1;if(n[e]>r)o=e-1|0;else{if(n[e+1]>r){o=e;break}s=e+1|0}}const l=i[o],c=n[o]+Math.abs(l)|0;if(r<c)return l<0?"rtl":"ltr"}return}},12182:(e,t)=>{"use strict";t.D=void 0;t.D=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,49,55,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-3,4,-24,28,-1,10,-1,4,-1,6,-43,46,-119,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,8,2,7,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,4,1,13,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,17,1,8,2,3,11,12,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,11,12,3,4,41,43,4,9,3,4,3,4,2,6,14,18,26,28,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,2,5,6,24,25,1,2,10,11,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,89,96,5,7,34,35,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,60,67,43,45,11,22,1,14,1,8,4,5,6,7,3,5,1,6,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,43,44,94,95,48,96,45,48,48,64,28,31,50,65,12,16,167,171,99,101,31,32,6592,6656,20989,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,55,57,9,51,13,14,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,13,14,38,46,25,36,2,13,30,36,48,49,2,6,2,4,16,17,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,58,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,86,2,67,45,176,29,32,49,96,36,45,30,35,38,48,30,31,37,41,14,56,158,160,10,16,36,40,36,40,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-484,488,-8,18,-294,325,-44,46,-153,164,-175,175,1,2,54,69,7,31,10,28,49,53,2,4,7,18,1,3,25,32,10,19,36,41,1,10,18,26,35,36,3,14,52,61,10,14,2,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,163,56,64,2,5,1,2,21,22,1,2,3,33,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,2,1,8,10,64,27,32,2,6,1,10,16,208,47,56,1,3,1,101,83,95,8,10,1,3,8,9,2,3,30,31,2,6,1,2,4,5,3,12,10,80,8,10,42,50,4,5,4,31,1,7,2,4,40,46,2,6,8,17,1,7,2,5,46,59,1,3,9,38,57,320,9,10,38,52,8,18,29,32,32,57,1,8,1,3,1,76,7,8,2,3,38,59,1,10,10,16,6,7,2,3,37,41,2,3,1,2,1,8,10,320,19,21,4,187,1,16,21,63,923,1025,111,112,5,16,196,2944,1071,1072,9,4048,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,707,91,192,75,80,56,67,13,77,2,3,1,13,2,16,6136,6144,1238,1280,9,8960,287,336,3,20,4,12,396,2704,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,306,20,128,25,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,1659,45,55,7,9,10,14,2,370,44,48,10,1296,-208,215,-109,116,-1445,1447,-270,542,31,32,58,64,61,118,29,42,44,48,9,16,2,3504,42718,42752,4149,4160,222,224,5762,5776,7473,10576,542,2048,4939,786432,65534,65536,65534]},42430:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LruCache=void 0;var n=r(57319);class i{constructor(e,t){this.key=e,this.value=t,this.prev=null,this.next=null}}t.LruCache=class{constructor(e){var t;this._keyToNode=new Map,this.purgeNow=()=>{for(let e=this._dummyTail.prev;this._currentSize>this._sizeLimit&&e!==this._dummyHead;e=e?e.prev:null){if(null==e)throw new Error("The linked list is not constructed properly.");const{key:t,value:r}=e;this._shouldEvict(t,r)&&(this.delete(t),this._onEvict&&this._onEvict(t,r))}this._onPurge&&this._onPurge(this._keyToNode)},this._sizeLimit=e.sizeLimit,this._getSize=e.getSize,this._onPurge=e.onPurge,this._shouldEvict=null!==(t=e.shouldEvict)&&void 0!==t?t:()=>!0,this._onEvict=e.onEvict,this._onAdd=e.onAdd,this._onDelete=e.onDelete,this._currentSize=0,this._dummyHead=new i("dummy-head",null),this._dummyTail=new i("dummy-tail",null),this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._purgeTimer=new n.ShiftTimer((()=>this.purgeNow()))}get(e){if(!this._keyToNode.has(e))return null;const t=this._keyToNode.get(e);if(null==t)return null;const r=t.prev,n=t.next;r&&(r.next=n),n&&(n.prev=r);const i=this._dummyHead.next;if(null==i)throw new Error("The linked list is not constructed properly.");return this._dummyHead.next=t,i.prev=t,t.prev=this._dummyHead,t.next=i,t.value}has(e){return this._keyToNode.has(e)}touch(e){this.get(e)}put(e,t){0!==this._sizeLimit&&(this._getSize(t)>this._sizeLimit?__LOG__(3)`Blob size is larger than the limit of the whole store.`:(this.delete(e),this._add(e,t),this.schedulePurge()))}_add(e,t){const r=new i(e,t);this._keyToNode.set(e,r);const n=this._dummyHead.next;if(null==n)throw new Error("The linked list is not constructed properly.");this._dummyHead.next=r,n.prev=r,r.prev=this._dummyHead,r.next=n,this._currentSize+=this._getSize(t),this._onAdd&&this._onAdd(e,t)}delete(e){if(!this._keyToNode.has(e))return;const t=this._keyToNode.get(e);if(null==t)return;this._currentSize-=this._getSize(t.value);const r=t.prev,n=t.next;r&&(r.next=n),n&&(n.prev=r),this._keyToNode.delete(e),this._onDelete&&this._onDelete(e,t.value)}clear(){this._keyToNode.clear(),this._currentSize=0,this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._onClear&&this._onClear()}schedulePurge(){this._purgeTimer.onOrBefore(1e3)}}},9006:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t){this._valueFn=e,this._heap=[],this._load(t)}size(){return this._heap.length}_load(e){(null==e?void 0:e.length)&&e.forEach((e=>{this.push(e)}))}_swap(e,t){const r=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=r}_siftUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e)return;const t=this._getParent(e),r=2*t+1,n=2*t+2,i=this._heap.length;if(e>=i)return;let a=this._getVal(t),s=t;if(r<i){const e=this._getVal(r);a>e&&(s=r,a=e)}if(n<i){a>this._getVal(n)&&(s=n)}s!==t&&(this._swap(s,t),this._siftUp(t))}_doHeapify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=2*e+1,r=2*e+2,n=this._heap.length;if(e>=n)return;let i=this._getVal(e),a=e;if(t<n){const e=this._getVal(t);i>e&&(a=t,i=e)}if(r<n){i>this._getVal(r)&&(a=r)}a!==e&&this._swap(a,e),t<n&&this._doHeapify(t),r<n&&this._doHeapify(r)}_getVal(e){return this._valueFn(this._heap[e])}_getParent(e){return e%2==0?(e-2)/2:(e-1)/2}push(e){this._heap.push(e);const t=this._heap.length-1;this._siftUp(t)}pull(){const e=this._heap.shift();return this.heapify(),e}heapify(){this._doHeapify(0)}peek(){return this._heap[0]}}},55205:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(45095));class a{constructor(e){this._children={},this._indices=[],e&&(this._data=e)}static fromBackwardsStrings(e,t){return e.reduce(((e,t,r)=>e.addBackwardsString(t,r)),new a(t))._optimize()}addBackwardsString(e,t){let r=e.length-1,n=this;for(;r>=0;){const i=e.charAt(r);n._addIndex(t),n=n.get(i)||n.set(i,new a),r--}return n._addIndex(t),this}static fromForwardsStrings(e,t){return e.reduce(((e,t,r)=>e.addForwardsString(t,r)),new a(t))._optimize()}addForwardsString(e,t){let r=0,n=this;for(;r<e.length;){const i=e.charAt(r);n._addIndex(t),n=n.get(i)||n.set(i,new a),r++}return n._addIndex(t),this}set(e,t){return this._children[e]=t,t}get(e){return this._children[e]}getChildren(){return Object.keys(this._children).map((e=>({prefix:e,node:(0,i.default)(this.get(e),"this.get(prefix)")})))}hasChildren(){return!function(e){for(const t in e)return!1;return!0}(this._children)}search(e){const t=this._data;if(!t)return[];let r=this;for(let t=0;t<e.length&&r;t++){const n=e[t];r=r.get(n)}if(!r)return[];return r.getIndices().map((e=>t[e]))}_addIndex(e){this._indices.push(e)}getIndices(){const e=this._indices,t=Object.keys(this._children);return 1===t.length&&0===this._indices.length?this._children[t[0]].getIndices():e}_optimize(){if(!this.hasChildren())return this;const e=Object.keys(this._children),t=this._children[e[0]]._indices;return e.forEach((e=>{this._children[e]._optimize()})),1===e.length&&this._indices.length===t.length&&(this._indices=[]),this}testOnlyGetChildrenProperty(){return this._children}testOnlyGetIndicesProperty(){return this._indices}}t.default=a},63438:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;return e.every(((e,r)=>e===t[r]))}},29984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNonZeroNumber=function(e){return null!=e&&0!==e&&!isNaN(e)}},65023:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.astralRange=void 0,t.length=function(e){const t=e.match(r);return t?t.length:0},t.substring=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i=e.match(r);if(!i)return"";return i.slice(Math.max(0,t),Math.max(0,n)).join("")},t.toArray=function(e){return e.match(r)||[]};const r=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]?|[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*/g;t.astralRange=r},82572:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,r,o){const l=e.split(".");let p,h=!1;if(l.forEach((e=>{if(h=!e.match(u),h){if(p)return null;p=e}})),null==p||h)return null;const f=[];let _=!0;const m=(0,i.toArray)(p);for(let e=0;e<m.length;e++){const t=m[e];if(_=_&&d(t),!_&&a[t]){if(f.length>=2)return null;f.push(t)}}if(_)return c(r)||c(t)||o.some((e=>function(e){return s.has(e)}(e)))?null:new Set(m);if(!f.length)return null;const g=f.filter((e=>{const i=a[e];if(null==i)return!1;if(o.some((e=>i.includes(e))))return!1;const s=new Set;for(let e=0;e<i.length;e++){const t=n.LANGUAGE_TO_REGIONS[i[e]];if(null!=t)for(let e=0;e<t.length;e++)s.add(t[e])}return!s.has(r)&&!s.has(t)}));return g.length?new Set(g):null};var n=r(36349),i=r(65023);const a={í:["ast","ksf","bas","ca","cs","dua","nl","ee","ewo","fo","fr","gl","kl","hu","is","ga","dyo","kea","kkj","nmg","lkt","lag","ln","lu","mas","nnh","jgo","pt","qu","seh","sk","es","to","vai","vi","wae","cy","fy","yav","yo"],î:["af","agq","bss","bfd","bas","bkv","btt","nl","igb","ewo","fr","fur","gaj","gby","kl","jab","atg","jbu","kkj","naq","ksh","ku","nmb","lmp","ln","mda","mg","mas","mzm","jgo","nin","ann","ro","sg","scn","srn","yer","tr","wa","cy","yav","yle"],ü:["agg","ast","az","br","ca","co","cs","nl","etr","et","fr","gl","de","tof","god","hu","tbd","geb","ksh","kup","nds","lb","arn","oc","sg","sk","es","gsw","dts","tr","tk","vo","wa","wae","fy","yll"],ċ:["mt"],ī:["agq","bss","bfd","bas","bkv","btt","ddn","igb","kjy","ich","gux","haw","jab","iby","idu","jbu","kub","nmg","lv","mda","mi","mas","mql","nin","prg","gd","to","yba","yav"],ı:["az","crh","tr"],ļ:["lv"],ł:["dsb","nv","pl","hsb"],š:["bs","hr","cs","dzg","et","fi","smn","geb","khq","ses","kun","lkt","lv","lt","dsb","se","nso","prg","sr","sh","sms","sk","sl","taq","twq","tuq","hsb","wqe","dje"],ƙ:["ckl","ank","ha","ikx","kai","hia","mbu","anc","nin","pip","tal","tan","wja","wji"],ǀ:["naq"],ǁ:["naq"],ȯ:["liv"],ɑ:["fmp","dud","tmh"],ɓ:["fub","yay","bkc","bjt","bcn","bas","bsq","bmq","fue","bys","bwr","cky","fuq","ckl","asg","dbq","dnj","dgh","dow","dua","enn","ff","gby","gba","gmm","ank","gde","gkp","jgk","ha","hbb","ikx","kkj","hig","kzr","kai","kpe","nmg","hia","ffm","mbo","mbu","mif","mzm","mua","sur","anc","fuv","nin","dgi","pbi","pip","fuf","cla","sav","srr","sld","sok","tal","tan","yer","ttr","tik","kdl","tsw","vai","vut","wja","wji","fuh","gnd"],ḍ:["tzm","kab","okr","shi","tmh","taq"],ṛ:["tzm","kab","shi"],ṭ:["tzm","kab","shi","tmh","taq"],ẉ:[],ạ:["izi","yaz","blt","vi"],ẹ:["yay","bom","bin","mfn","dzg","igb","enn","gkn","iby","ikk","ikw","izi","okr","yaz","blt","tan","tuq","vi","yo"],ị:["avu","mfn","igb","enn","iby","ig","ige","ikk","ikw","izi","okr","blt","tan","vi"]},s=new Set(["abq","ab","ady","av","az","ba","be","bs","bg","bua","ce","ckt","cu","cv","crh","dar","dng","myv","evn","gag","inh","kbd","xal","krc","kaa","kk","kjh","kca","ky","kv","koi","kpy","kum","lbe","lez","mk","mns","chm","mdf","mn","ttt","gld","yrk","nog","os","ru","rue","sr","sh","cjs","alt","tab","tg","tt","tkr","tk","tyv","ude","udm","uk","uz","mrj","sah"]),o=new Set(["374","994","375","387","359","995","7","383","996","389","373","976","382","381","992","993","380","998"]),l="авгекмнорстухшщьѕіјѡѵүһӏԁԛԝԧꚙ";function c(e){return o.has(e)}function d(e){return l.includes(e)}const u=new RegExp("^[a-z0-9-]+$")},36349:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANGUAGE_TO_REGIONS=void 0;t.LANGUAGE_TO_REGIONS={fub:["237","235","234"],af:["237","27"],agq:["237"],yay:["234"],bss:["237"],agg:["675"],ast:["34"],avu:["243","211"],az:["994"],bkc:["237","241"],ksf:["237"],bfd:["237"],bjt:["221"],bcn:["234"],bas:["237"],bsq:["231"],bkv:["234"],bom:["234"],btt:["234"],bin:["234"],bmq:["226","223"],bs:["387","385","383","382","381"],fue:["229","228"],br:["33"],bys:["234"],bwr:["234"],cky:["234"],ca:["376","33","39","34"],tzm:["212"],fuq:["234"],ckl:["234"],asg:["234"],co:["33","39"],crh:["7"],hr:["387","385","383","382","381"],mfn:["234"],cs:["420","421"],dbq:["237","234"],dnj:["225","231"],dzg:["235","227"],ddn:["229"],dgh:["234"],dow:["237"],dua:["229"],nl:["297","32","599","31","1","597"],igb:["234"],etr:["675"],enn:["234"],kgy:["675"],et:["372"],ich:["234"],ee:["229","233","228"],ewo:["237"],fo:["298"],fmp:["237"],fi:["358","46"],fr:["32","229","226","257","237","1","236","242","243","235","269","253","240","33","241","509","225","352","261","223","377","227","250","221","248","41","228","678"],fur:["39"],ff:["237","224","222","221"],gaj:["675"],gl:["34"],gby:["234"],gba:["236"],gmm:["237"],de:["43","32","49","423","352","41"],tof:["675"],god:["225"],ank:["234"],gkn:["234"],gux:["229","226","227","228"],gde:["237","234"],gkp:["224"],kl:["299"],jgk:["234"],ha:["229","237","235","233","225","227","234","249","228"],haw:["1"],hbb:["234"],hu:["36"],dud:["234"],jab:["234"],iby:["234"],is:["354"],idu:["234"],ig:["240"],ige:["234"],ikx:["256"],ikk:["234"],ikq:["234"],smn:["358"],ga:["353","44"],atg:["234"],izi:["234"],dyo:["220","221"],jbu:["237","234"],kab:["213"],kea:["238"],tbd:["675"],hig:["234"],kai:["234"],kkj:["237","236","242"],kzr:["237","235"],naq:["264"],geb:["675"],okr:["234"],ksh:["49"],ses:["223"],khq:["223"],kun:["291","251"],kup:["675"],kub:["237","234"],kpe:["224","231"],nmg:["237","240"],ku:["963","90"],lkt:["1"],hia:["234"],lag:["255"],lv:["371"],lmp:["237"],ln:["242","243"],liv:[],lt:["370"],yaz:["234"],nds:["55","49","31"],dsb:["49"],lu:["243"],lb:["32","33","49","352"],mda:["234"],mb:["261"],mt:["356"],mi:["64"],arn:["56"],mas:["254","255"],ffm:["223"],mql:["229","228"],mbo:["237"],mbu:["234"],mif:["237"],mzm:["234"],mua:["237","235"],sur:["234"],nv:["1"],anc:["234"],nnh:["237"],jgo:["237"],fuv:["237","234"],nin:["234"],dgi:["226"],se:["358","46","47"],nso:["27"],ann:["234"],oc:["33","39","377","34"],pbi:["237"],pip:["234"],pl:["48"],pt:["244","55","238","240","245","853","258","351","239","670"],prg:[],fuf:["224","223","221","232"],qu:["54","591","57","593","51"],ro:["373","40"],cla:["234"],sav:["221"],sg:["236","235","243"],gd:["44"],seh:["258"],sr:["387","385","383","382","381"],sh:["387","385","383","382","381"],srr:["220","221"],sch:["39"],sld:["226"],sms:["358"],sk:["420","421"],sl:["386"],sok:["235"],es:["54","501","591","56","57","506","53","593","503","240","502","504","52","505","507","595","51","34","1","598","58"],srn:["597"],gsw:["43","33","49","423","41"],shi:["212"],tal:["234"],tmh:["223"],taq:["226","223"],tan:["234"],twq:["227"],blt:["856","84"],yer:["234"],tuq:["235","218","227","234"],ttr:["234"],tik:["237"],to:["676"],dts:["223"],kdl:["234"],tsw:["234"],tr:["90"],tk:["993"],hsb:["49"],vai:["231","232"],vi:["855","84"],vo:[],vut:["237","234"],wja:["234"],wa:["32"],wae:["43","39","423","41"],wji:["234"],cy:["44"],fy:["31"],fuh:["229","226","227"],yba:["234"],yav:["237"],yle:["675"],yll:["675"],yo:["229","234"],dje:["227"],gnd:["237"]}},53659:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,r,s){const o=e.match(a),l=o&&o[1];if(null==l)return null;const c=(0,i.phoneCC)(r),d="whatsapp"===t?"":(0,i.phoneCC)(t),u=s.map((e=>e.toLowerCase()));return(0,n.findSuspiciousCharacters)(l,d,c,u)};var n=r(82572),i=r(40277);const a=/^(?:https?:\/\/)?([^/?#]+)(?:[/?#]|$)/i},46269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castTypedArrays=function(e,t){if(t instanceof e)return t;if("string"==typeof t)return new e((0,n.decodeB64)(t));return new e(t)};var n=r(15688)},60977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatTypedArrays=function(e,t){const r=t.reduce(((e,t)=>e+t.length),0),n=new e(r);let i=0;return t.forEach((e=>{n.set(e,i),i+=e.length})),n}},91560:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.ParsableXmlNode=void 0,t.convertBytesToUint=s;var i=n(r(33344)),a=r(56225);function s(e,t){let r=0;for(let n=0;n<t;n++)r=256*r+e[n];return r}t.ParsableXmlNode=class{constructor(e,t){this._name=e,this._node=t,this._children=Array.isArray(t.content)?t.content.map((t=>new this.constructor(e,t))):null}name(){return this._name}node(){return this._node}hasAttr(e){return(0,i.default)(this._node.attrs,e)}assertTag(e){this._node.tag!==e&&this.throw(`to be <${e}>`)}tag(){return this._node.tag}maybeChild(e){const t=this._children;if(!t)return null;for(let r=0;r<t.length;r++)if(t[r].tag()===e)return t[r];return null}hasChild(e){return!!this.maybeChild(e)}child(e){const t=this.maybeChild(e);return t||this.throw(`to have child <${e}>`)}assertAttr(e,t){const r=this.attrString(e);r!==t&&this.throw(`to have "${e}"="${t}", but instead has "${r}"`)}attrString(e){return(0,i.default)(this._node.attrs,e)?this.decodeAsString(this._node.attrs[e]):this.throw(`to have attribute "${e}"`)}forEachAttributeKey(e){const t=this._node.attrs;Object.keys(t).forEach((t=>e(t)))}maybeAttrString(e){return this.hasAttr(e)?this.decodeAsString(this._node.attrs[e]):null}maybeAttrInt(e,t,r){return this.hasAttr(e)?this.attrInt(e,t,r):null}attrEnumValues(e,t){const r=new Set(t),n=this.attrString(e);if(!r.has(n)){const t=Array.from(r).join("|");return this.throw(`to have "${e}"={${t}} but has value "${n}"`)}return n}attrEnum(e,t){const r=this.attrString(e);if(!(0,i.default)(t,r)){const n=Object.keys(t).join("|");return this.throw(`to have "${e}"={${n}} but has value "${r}"`)}return t[r]}attrEnumOrNullIfUnknown(e,t){const r=this.attrString(e);return(0,i.default)(t,r)?t[r]:null}attrEnumOrDefault(e,t,r){return this.hasAttr(e)?this.attrEnum(e,t):r}attrInt(e,t,r){const n=this.attrString(e);return this._parseInt(n,e,t,r)}_parseInt(e,t,r,n){const i=parseInt(e,10);return Number.isNaN(i)?this.throw(`to have "${t}"={integer} but has value "${e}"`):void 0!==r&&i<r?this.throw(`to have "${t}"={at least ${r}} but has value ${i}`):void 0!==n&&i>=n?this.throw(`to have "${t}"={below ${n}} but has value ${i}`):i}forEachChild(e){const t=this._children;if(t)t.forEach((t=>e(t)));else if(null!=this._node.content)return this.throw("to have children")}forEachChildWithTag(e,t){this.forEachChild((r=>{r.tag()===e&&t(r)}))}mapChildren(e){const t=this._children;return t||null==this._node.content?t?t.map((t=>e(t))):[]:this.throw("to have children")}mapChildrenWithTag(e,t){const r=this._children;return r||null==this._node.content?r?r.filter((t=>t.tag()===e)).map((e=>t(e))):[]:this.throw("to have children")}mapFirstChild(e){const t=this._children;return t&&0!==t.length?e(t[0]):this.throw("to have children")}hasContent(){return!this._children&&!!this._node.content}hasChildren(){return null!=this._children}getChildren(){return this._children}getNode(){return this._node}unsafeSetChildren(e){this._children=e}unsafeSetNodeContent(e){this._node.content=e}contentUint(e){return s(this.contentBytes(e),e)}contentBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this._children)return this.throw("to have binary content, but has children instead");if(null!=this._node.content){const t=this._node.content;return-1!==e&&t.length!==e?this.throw(`to be ${e} bytes, but got ${t.length} instead`):t}return this.throw("to have content")}contentString(){return this._children?this.throw("to have string content, but has children instead"):null!=this._node.content?this._node.content:this.throw("to have content")}contentInt(e,t){const r=this.contentString();return this._parseInt(r,"content",e,t)}contentEnum(e){const t=this.contentString();if(!(0,i.default)(e,t)){const r=Object.keys(e).join("|");return this.throw(`to have content {${r}} but has value "${t}"`)}return e[t]}decodeAsString(e){if("string"!=typeof e)throw new Error(`decodeAsString: attribute is ${typeof e} not a string: ${e}`);return e}throw(e){throw new a.XmlParsingFailure(this._name,`expected <${this._node.tag}> ${e}`)}toString(){return this._node.toString()}}},17890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),r=t.length;let n=!1,i=0,a="",s=0;const o=["\n"];for(s=0;s<100;s++)o.push(o[s]+"    ");const l=function(e,t){const r=/^<[\w:\-.,]+/.exec(e[t-1]),n=/^<\/[\w:\-.,]+/.exec(e[t]);return null!=r&&null!=n&&r[0]===n[0]};for(s=0;s<r;s++)t[s].search(/<!/)>-1?(a+=o[i]+t[s],n=!0,(t[s].search(/-->/)>-1||t[s].search(/\]>/)>-1||t[s].search(/!DOCTYPE/)>-1)&&(n=!1)):t[s].search(/-->/)>-1||t[s].search(/\]>/)>-1?(a+=t[s],n=!1):l(t,s)?(a+=t[s],n||i--):t[s].search(/<\w/)>-1&&-1===t[s].search(/<\//)&&-1===t[s].search(/\/>/)?a=a+=n?t[s]:o[i++]+t[s]:t[s].search(/<\w/)>-1&&t[s].search(/<\//)>-1?a=a+=n?t[s]:o[i]+t[s]:t[s].search(/<\//)>-1?a=a+=n?t[s]:o[--i]+t[s]:t[s].search(/\/>/)>-1?a=a+=n?t[s]:o[i]+t[s]:t[s].search(/<\?/)>-1||t[s].search(/xmlns:/)>-1||t[s].search(/xmlns=/)>-1?a+=o[i]+t[s]:a+=t[s];return"\n"===a[0]?a.slice(1):a}},74277:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlNode=void 0,t.attrsToString=a,t.uint8ArrayToDebugString=s;var n=r(87614);const i={};function a(e){const t=Object.keys(e);let r="";for(let n=0;n<t.length;n++){const i=t[n];r+=` ${i}="${e[i].toString()}"`}return r}function s(e){let t="";return t=0===e.length?"\x3c!-- empty binary --\x3e":e.length<50?(0,n.bytesToDebugString)(e):`\x3c!-- ${e.length} bytes --\x3e`,t}t.XmlNode=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=r}toString(){let e="<"+this.tag;e+=a(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:t instanceof Uint8Array?e+=`>${s(t)}</${this.tag}>`:e+=null!=t?`>${String(t)}</${this.tag}>`:" />",e}}},56225:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlParsingFailure=void 0;t.XmlParsingFailure=class{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmlParsingFailure: ${this.parser}: ${this.reason}`}}},28970:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=void 0;var n=r(69719),i=r(57319),a=r(21282);t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=113760892;const s={putBuffer:()=>Promise.resolve()};t.Wam=class{constructor(e){this._pending=[],this._globals=new Map,this._initialized=!1,this._buffers=new Map,this._streamId=-1,this._sink=s,this._getNextSequenceNumber=null,this.deinitialize=()=>{this._initialized=!1,this._pending=[],this._globals.clear(),this._buffers=new Map,this._streamId=-1,this._sink=s,this.serializePending.cancel(),this.finalizeBuffers.cancel()},this.enqueueEvent=(e,t,r,n,i,a)=>{this._pending.push({type:1,id:e,commitTime:t,psIdIntValue:r,weight:i,fields:n,resolve:a}),this._initialized&&this.serializePending.onOrBefore(3e3)},this.enqueueAttributesUpdate=e=>{const t={type:2,delta:[]};e.forEach(((e,r)=>{void 0!==e&&t.delta.push([r,e])})),t.delta.length>0&&(__LOG__(2)`WAM: Enqueued ${t.delta.length} attribute keys for update`,this._pending.push(t))},this.finalizeBuffers=new i.ShiftTimer((()=>{this._finalizeBuffers()})),this.serializePending=new i.ShiftTimer((()=>{this._serializePending()})),this.forceSerializePending=()=>{this._initialized&&this._hasPendingEvents()&&this.serializePending.forceRunNow()},this._channel=e}initialize(e,t,r,n){if(this._initialized)return __LOG__(4,void 0,new Error,!0)`WAM: Failed to initialize already initialized WAM`,void SEND_LOGS("wam-initialize");this._options=n,this._streamId=e,this._sink=r,this._getNextSequenceNumber=t,this._hasPendingEvents()&&this.serializePending.forceRunNow(),this._initialized=!0,__LOG__(2)`WAM: Initialized with stream id ${this._streamId}`}_finalizeBuffers(){this._buffers.forEach((e=>{e.finalize()})),this._buffers.size>0&&this.serializePending.onOrBefore(3e3)}_getKeyHashIntForSequence(e){var t;return(null===(t=this._options)||void 0===t?void 0:t.multipleSequences)?0===e?"null-psid":e:"regular"}_maybeCreateNewBuffer(e){let t=this._buffers.get(e);if(t)return t;const r=this._getKeyHashIntForSequence(e);if(null==this._getNextSequenceNumber)return __LOG__(4,void 0,new Error,!0)`WAM: Sequence number generator not initialised for channel ${this._channel}`,void SEND_LOGS("wam-serializePending");const n=this._getNextSequenceNumber(r);if(t=new a.WamBuffer(this._channel,this._streamId,n,this._globals),this._buffers.set(e,t),"regular"!==e)if(null==this._privateStatsIds)__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats ids`,SEND_LOGS("wam-serializePending");else{const r=0===e?"none":this._privateStatsIds.get(e);null==r?(__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats id`,SEND_LOGS("wam-serializePending")):t.writeGlobal(6005,r)}return t}_serializePending(){const e=[];this.finalizeBuffers.onOrBefore(3e5);const t=new Map;let r=-1;this._pending.forEach(((n,i)=>{if(1===n.type){let s=!0;t.forEach((e=>{(0,a.canWriteGlobal)(e)||(s=!1)}));const o=(0,a.canWriteEvent)(n.fields);if(o&&s){let e;"regular"===this._channel?e=this._maybeCreateNewBuffer("regular"):(this._channel,null==n.psIdIntValue?(__LOG__(4,void 0,new Error,!0)`A WAM event in channel private was dropped before serialization. Reason: missing psIdIntValue in the event payload`,SEND_LOGS("wam-serializePending")):e=this._maybeCreateNewBuffer(n.psIdIntValue)),null!=e&&(t.forEach(((e,t)=>{const r=this._globals.get(t);void 0!==r&&r===e||(this._buffers.forEach((r=>r.writeGlobal(t,e))),this._globals.set(t,e))})),t.clear(),e.writeEvent(n.commitTime,n.id,n.fields,n.weight))}else __LOG__(3)`A WAM event in channel ${this._channel} was dropped before serialization. Event correct: ${o}, pending attributes correct: ${s}`;null!=n.resolve&&e.push(n.resolve),r=i}else{n.type;for(let e=0;e<n.delta.length;++e){const[r,i]=n.delta[e];t.set(r,i)}}}));let i=!1;this._buffers.forEach((e=>{(e.isFinalized()||e.getSize()>65536)&&(i=!0)}));const s=[];this._buffers.forEach(((e,t)=>{e.hasEvents()?s.push([e.getKey(),e.peek(),this._getKeyHashIntForSequence(t)]):__LOG__(3)`Skipping putting buffer to sink, as it does not contain any events`}));const o=(0,n.promiseEach)(s,(e=>{let[t,r,n]=e;return this._sink.putBuffer(t,r,i,n)})).then((()=>{e.forEach((e=>{e()}))}));return this._pending=this._pending.slice(r+1),i&&(this._buffers=new Map,this.finalizeBuffers.cancel()),o}_hasPendingEvents(){return this._pending.length>0&&this._pending.some((e=>1===e.type))}isInitialized(){return this._initialized}updatePrivateStatsIds(e){if("private"!==this._channel)return __LOG__(4,void 0,new Error,!0)`WAM: Tried to set private stats ids on a non-private channel`,void SEND_LOGS("wam-updatePrivateStatsIds");this._privateStatsIds=e}}},21282:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamBuffer=void 0,t.canWriteEvent=function(e){const t=c(e);for(let r=0;r<=t;r+=3){const t=e[r+2];if(null!=t){if(e[r+1]===i.TYPES.INT&&isNaN(t))return!1}}return!0},t.canWriteGlobal=function(e){if("number"==typeof e)return!isNaN(e);return!0};var n=r(8584),i=r(68518);function a(e,t,r,n){0===n?l(e,t,16|r):1===n?l(e,t,32|r):-128<=n&&n<128?(l(e,t,48|r),e.writeInt8(n)):-32768<=n&&n<32768?(l(e,t,64|r),e.writeInt16(n)):-2147483648<=n&&n<2147483648?(l(e,t,80|r),e.writeInt32(n)):(l(e,t,96|r),e.writeInt64(n))}function s(e,t,r,n){l(e,t,112|r),e.writeFloat64(n)}function o(e,t,r,i){const a=(0,n.numUtf8Bytes)(i);a<256?(l(e,t,128|r),e.writeUint8(a)):a<65536?(l(e,t,144|r),e.writeUint16(a)):(l(e,t,160|r),e.writeUint32(a)),e.writeString(i)}function l(e,t,r){t<256?(e.writeUint8(r),e.writeUint8(t)):(e.writeUint8(8|r),e.writeUint16(t))}function c(e){let t=-1;for(let r=0;r<e.length;r+=3)null!=e[r+2]&&(t=r);return t}t.WamBuffer=class{constructor(e,t,r,i){this._finalized=!1,this._hasEvents=!1;const a=new n.Binary(void 0,!0);switch(a.writeString("WAM"),a.writeUint8(5),a.writeUint8(t),a.writeUint16(r),e){case"regular":a.writeUint8(0);break;default:a.writeUint8(2)}this._channel=e,this._buffer=a,this._sequenceNumber=r,this._streamId=t,i.forEach(((e,t)=>{this.writeGlobal(t,e)}))}writeGlobal(e,t){if(null!=t)if("string"==typeof t)o(this._buffer,e,0,t);else if("number"==typeof t)a(this._buffer,e,0,t);else{if("boolean"!=typeof t)throw new Error("Incorrect value type "+typeof t);a(this._buffer,e,0,t?1:0)}else l(this._buffer,e,0)}writeEvent(e,t,r,n){const l=this._buffer;a(l,47,0,Math.floor(e/1e3));const d=c(r);a(l,t,-1===d?5:1,n);for(let e=0;e<=d;e+=3){const t=r[e+2];if(null!=t){const n=r[e],c=r[e+1],u=e===d?6:2;c===i.TYPES.INT?a(l,n,u,t):c===i.TYPES.BOOL?a(l,n,u,t?1:0):c===i.TYPES.STRING?o(l,n,u,t):s(l,n,u,t)}}this._hasEvents=!0}getKey(){return{streamId:this._streamId,sequenceNumber:this._sequenceNumber,channel:this._channel}}getSize(){return this._buffer.size()}peek(){return this._buffer.peek((e=>e.readByteArray()))}isFinalized(){return this._finalized}finalize(){this._finalized=!0}hasEvents(){return this._hasEvents}}},42114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeChannelManager=function(){null!=n&&n.close()},t.getChannelManager=function(){null==n&&(n=new r);return n};class r{constructor(){this._sinkIsBusy=new Map,this._initializedChannel=new Map}getChannelInitialized(e){return this._initializedChannel.get(e)||!1}setChannelInitialized(e){this._initializedChannel.set(e,!0)}isSinkBusy(e){return this._sinkIsBusy.get(e)||!1}setSinkBusy(e,t){this._sinkIsBusy.set(e,t)}close(){this._sinkIsBusy.forEach(((e,t)=>{this._sinkIsBusy.set(t,!1)})),this._initializedChannel.forEach(((e,t)=>{this._initializedChannel.set(t,!1)}))}}let n},7879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinitializeWAM=function(){o().deinitialize()},t.enableDebugMode=function(){a=!0},t.forceFlushBuffers=function(){o().forceFlushBuffers()},t.initializeWAM=function(e,t,r,n,i){o().initialize(r,e,t,n,i)},t.log=function(e,t,r,n,a){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();o().enqueueEvent(e,t,l,r,(0,i.appendRawFields)(n,a),s)},t.logAsync=function(e,t,r,n,a){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();return new Promise((c=>{o().enqueueEvent(e,t,l,r,(0,i.appendRawFields)(n,a),s,c)}))},t.logAttributes=function(e,t){const r=(0,i.getDeltaFromAttributes)(e);if(null==r)return;const{deltaRegular:n,deltaPrivate:a}=r;n.size>0&&o().enqueueAttributesUpdate("regular",n);a.size>0&&o().enqueueAttributesUpdate("private",a)},t.rotateBuffers=function(){o().rotateBuffers()},t.updatePrivateStatsIds=function(e){o().updatePrivateStatsIds(e)};var n=r(26305),i=r(56521);let a=!1,s=null;function o(){return s||(s=new n.WamManager),s}},26305:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamManager=void 0;var n=r(28970);class i{constructor(e){this._sequenceNumbers=new Map,this._options=e}_setSequenceNumber(e,t){null==t||0===t||t<0?this._sequenceNumbers.set(e,"uninitialized"):this._sequenceNumbers.set(e,t)}initializeForChannel(e,t){t.forEach(((t,r)=>{var n;if("regular"===e&&"regular"===r)this._setSequenceNumber(r,t);else if("private"===e&&"regular"!==r)this._setSequenceNumber(r,t);else if("private"!==e||(null===(n=this._options)||void 0===n?void 0:n.multipleSequences)){var i;__LOG__(4,void 0,new Error)`SequenceNumberGenerator::initializeForChannel: Incorrect combination of parameters: ${e} ${r} ${null===(i=this._options)||void 0===i?void 0:i.multipleSequences}`}else this._setSequenceNumber(r,t)}))}next(e){const t=this._sequenceNumbers.get(e);let r;return null==t||"uninitialized"===t?r=1:(r=t+1,r>65535&&(r=1)),this._sequenceNumbers.set(e,r),r}}t.WamManager=class{constructor(){this._wamInstances=new Map,this._sequenceNumberGenerator=null}getWamInstance(e){let t=this._wamInstances.get(e);return t||(t=new n.Wam(e),this._wamInstances.set(e,t)),t}initialize(e,t,r,n,a){const s=this.getWamInstance(e);if(s.isInitialized())return void __LOG__(3)`WAM instance for channel ${e} has already been initialized`;null==this._sequenceNumberGenerator&&(this._sequenceNumberGenerator=new i(a));const o=this._sequenceNumberGenerator;this._sequenceNumberGenerator.initializeForChannel(e,r),s.initialize(t,(e=>o.next(e)),n,a)}deinitialize(){this._wamInstances.forEach(((e,t)=>{e.isInitialized()&&(__LOG__(2)`WamManager: Deinitializing WAM Channel ${t}`,e.deinitialize())})),this._sequenceNumberGenerator=null}enqueueEvent(e,t,r,n,i,a,s){this.getWamInstance(e).enqueueEvent(t,r,n,i,a,s)}enqueueAttributesUpdate(e,t){this.getWamInstance(e).enqueueAttributesUpdate(t)}updatePrivateStatsIds(e){this.getWamInstance("private").updatePrivateStatsIds(e)}forceFlushBuffers(){this._wamInstances.forEach((e=>{e.forceSerializePending()}))}rotateBuffers(){this._wamInstances.forEach((e=>{e.finalizeBuffers.forceRunNow()}))}}},47957:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blindToken=function(e,t){return(0,n.runInAllocationScope)((()=>{const r=(0,n.p3Element)(),s=(0,n.allocate)(Uint8Array,32);s.set(t),a(s),i.lowlevel.scalarbase(r,s);const o=(0,n.hashToPoint)(e);(0,i.lowlevel.add)(o,r);const l=new Uint8Array(32);return(0,n.pack)(l,o),l}))},t.unblindToken=function(e,t,r){return(0,n.runInAllocationScope)((()=>{const s=(0,n.p3Element)();if((0,n.unpack)(s,e))return null;const o=(0,n.p3Element)();if(0!==(0,n.unpackneg)(o,r))return null;const l=(0,n.allocate)(Uint8Array,32);l.set(t),a(l);const c=(0,n.p3Element)();i.lowlevel.scalarmult(c,o,l);(0,i.lowlevel.add)(s,c);const d=new Uint8Array(32);return(0,n.pack)(d,s),d}))};var n=r(30141),i=r(14462);function a(e){e[0]&=248,e[31]&=127,e[31]|=64}},11562:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStorage=function(){(0,a.deinitializeWAM)(),(0,i.closeChannelManager)(),l=null,o=null},t.getFinishedStreamBuffers=function(e){return c("getFinishedStreamBuffers").getBuffers().then((t=>(0,s.getFinishedBuffers)(e,t)))},t.initializeWAMSink=function(e,t,r,n){const l=c("initializeWAMSink"),d=(0,i.getChannelManager)();if(d.getChannelInitialized(t))return Promise.resolve();d.setChannelInitialized(t);const u=l.getStreamId(e),p={putBuffer(e,n,i,a){if(d.isSinkBusy(t))return __LOG__(3)`WamStorage: Sink flush did not happen within timeout, buffer is not saved`,Promise.resolve();d.setSinkBusy(t,!0);const{bufferKey:o,meta:c,bufferRow:p}=(0,s.asBufferEntry)(e,t,u,n,i);return l.saveBuffer(c,p,a).then((()=>{const t=[e.streamId,e.sequenceNumber];__LOG__(2)`WamStorage: Successfully put buffer ${t} to sink`,i&&(r(),__LOG__(2)`WamStorage: Buffer ${o} is scheduled for send`)})).finally((()=>{d.setSinkBusy(t,!1)}))}};null==o&&(o=l.finishBuffer(u));return o.then((()=>{if(l.getStartingSequenceNumbers)return l.getStartingSequenceRow,l.getStartingSequenceNumbers(t,u);if(l.getStartingSequenceRow,null==n?void 0:n.multipleSequences)throw new Error("getStartingSequenceRow must not used when enabling support for multiple sequences");return l.getStartingSequenceRow(u).then((e=>{const t=(0,s.getSequenceNumber)(e),r=new Map;return r.set("regular",t),r}))})).then((e=>{(0,a.initializeWAM)(u,e,t,p,n),"private"===t&&l.updatePrivateStatsIds&&l.updatePrivateStatsIds().then(a.updatePrivateStatsIds)}))},t.nukeMetrics=function(){return c("nukeMetrics").nukeMetrics()},t.privateStatsKillSwitchGetBlockedToken=function(){const e=c("privateStatsKillSwitchGetBlockedToken");if(!e.privateStatsKillSwitchGetBlockedToken)throw new Error("privateStatsKillSwitchGetBlockedToken not implemented for WAM DB");return e.privateStatsKillSwitchGetBlockedToken()},t.privateStatsKillSwitchSet=function(e){const t=c("privateStatsKillSwitchSet");if(!t.privateStatsKillSwitchSet)throw new Error("privateStatsKillSwitchSet not implemented for WAM DB");return t.privateStatsKillSwitchSet(e)},t.redeemPrivateStatsToken=function(){const e=c("getPrivateStatsToken");if(!e.redeemPrivateStatsToken)throw new Error("redeemPrivateStatsToken not implemented for WAM DB");return e.redeemPrivateStatsToken(u)},t.removeBufferByKey=function(e){return c("removeBufferByKey").removeBufferByKey(e)},t.savePrivateStatsToken=function(e){const t=c("savePrivateStatsToken");if(!t.savePrivateStatsToken)throw new Error("savePrivateStatsToken not implemented for WAM DB");return t.savePrivateStatsToken(e)},t.startWamStorage=function(e){null==l?l=e:(__LOG__(3,void 0,void 0,!0)`startWamStorage: called again`,SEND_LOGS("startWamStorage"))};var n=r(92844),i=r(42114),a=r(7879),s=r(56521);let o=null,l=null;function c(e){if(l)return l;throw new Error(`WamStorage::${e} called before startWamStorage`)}const d=n.DAY_SECONDS,u=(e,t)=>{const r={maxRedeemCount:(null==t?void 0:t.maxRedeemCount)||64,maxExpirySeconds:(null==t?void 0:t.maxExpirySeconds)||d};return(0,n.happenedWithin)(e.creationTs,r.maxExpirySeconds)?!(e.redeemCount>=r.maxRedeemCount)||(__LOG__(2)`The private stats token was redeemed maximum number of time. The client shall re-issue a new one`,!1):(__LOG__(2)`The private stats token expired. The client shall re-issue a new one`,!1)}},68518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPES=void 0;t.TYPES={INT:0,BOOL:1,STRING:2,FLOAT:3}},56521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendRawFields=function(e,t){if(null==t||0===t.length)return e;const r=new Map;for(let t=0;t<e.length;t+=3){const n=e[t];r.set(n,t)}for(let n=0;n<t.length;++n){const[i,s,o]=t[n];if(null==o)continue;const l=r.get(i);if(null!=l){if(void 0!==e[l+2])continue}a[s]===typeof o&&(null==l?(r.set(i,e.length),e.push(i,s,o)):e[l+2]=o)}return e},t.asBufferEntry=function(e,t,r,i,a){const s=function(e){return JSON.stringify([e.streamId,e.sequenceNumber,e.channel])}(e);return{bufferKey:s,meta:{streamId:e.streamId,sequenceNumber:e.sequenceNumber},bufferRow:{key:s,channel:t,streamId:r,buffer:(0,n.encodeB64)(i),finished:a}}},t.getDeltaFromAttributes=function(e){const t=new Map,r=new Map;for(let n=0;n<e.length;n+=4){const a=e[n],s=e[n+1],o=e[n+2],l=e[n+3];if(o===i.TYPES.FLOAT)throw new Error("Float attributes are currently not supported in runtime");if(!Array.isArray(a))return __LOG__(4,void 0,new Error,!0)`logAttributes WAM channel is not an array`,void SEND_LOGS("wam-log-attributes");a.includes("regular")&&t.set(s,l),a.includes("private")&&r.set(s,l)}return{deltaRegular:t,deltaPrivate:r}},t.getFinishedBuffers=function(e,t){const r=[];return t.forEach((t=>{const{channel:i}=t;if(null==i){if("regular"!==e)return}else if(i!==e)return;if(t.finished){const e=new Uint8Array((0,n.decodeB64)(t.buffer)),i=t.key;r.push({key:i,content:e})}})),r},t.getSequenceNumber=function(e){let t=null;e&&(t=e.sequenceNumber);return t};var n=r(15688),i=r(68518);const a={[i.TYPES.INT]:"number",[i.TYPES.FLOAT]:"number",[i.TYPES.STRING]:"string",[i.TYPES.BOOL]:"boolean"}},46977:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){return e===a.BUSINESS_CATEGORY_EMPTY_STR_ID?(0,o.queryBusinessCategories)(""):(0,o.queryBusinessCategories)(e)},t.queryBusinessProfile=function(e,t){return(0,s.queryBusinessProfile)(e,t)},t.queryBusinessPublicKey=function(e){return(0,s.queryBusinessPublicKey)(e)},t.querySignedUserInfo=function(){return d.apply(this,arguments)},t.updateCartEnabled=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(32742),s=r(79235),o=r(40346),l=r(99234);function c(){return(c=(0,i.default)((function*(e){const t=r(93581).BusinessProfileCollection,n=yield(0,s.updateCartEnabled)(e),i=t.getValid((0,l.getMeUser)()),a=null==i?void 0:i.profileOptions;i&&a&&(a.cartEnabled=n,t.add(i,{merge:!0}))}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){const{phoneNumber:t,phoneNumberSignature:r,phoneNumberSignatureExpiration:n,businessDomain:i}=yield(0,s.querySignedUserInfo)(e);if(null==t||null==n||null==r||null==i)throw new Error("Unexpected null or undefined");return{phoneNumber:t,phoneNumberSignature:r,phoneNumberSignatureExpiration:n,businessDomain:i}}))).apply(this,arguments)}},9762:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(90257),s=r(99234),o=r(5819),l=r(30849),c=r(64551);function d(){return(d=(0,i.default)((function*(e,t,r){const n=m(t),i=m(r),a=[h(e,t,r),_(e,n,i),f(e,n,i)];yield Promise.all(a.map((t=>t?(0,o.handleSingleMsgMD)(e,t):null)))}))).apply(this,arguments)}const u={CONSUMER:{CONSUMER:null,BIZ_NOT_HIGH:["biz_intro_bottom",null],BIZ_HIGH:["biz_intro_top","CURRENT"]},BIZ_NOT_HIGH:{CONSUMER:["biz_move_to_consumer_app",null],BIZ_NOT_HIGH:null,BIZ_HIGH:["biz_verified_transition_bottom_to_top","CURRENT"]},BIZ_HIGH:{CONSUMER:["biz_move_to_consumer_app",null],BIZ_NOT_HIGH:["biz_verified_transition_top_to_bottom","PREVIOUS"],BIZ_HIGH:null}};function p(e){return e.isBusiness?e.isVerifiedHigh?"BIZ_HIGH":"BIZ_NOT_HIGH":"CONSUMER"}function h(e,t,r){if(c.ServerProps.bspSystemMessageEnabled)return;if(t.isVerifiedHigh&&r.isVerifiedHigh&&null!=t.verifiedName&&null!=r.verifiedName&&t.verifiedName!==r.verifiedName)return(0,a.genTealNotificationTemplateMsg)(e,"biz_name_change",[r.verifiedName]);const n=u[p(t)][p(r)];if(null==n)return;const[i,s]=n,o=[];return"PREVIOUS"===s&&t.verifiedName?o.push(t.verifiedName):"CURRENT"===s&&r.verifiedName&&o.push(r.verifiedName),(0,a.genTealNotificationTemplateMsg)(e,i,o)}function f(e,t,r){if(c.ServerProps.bspSystemMessageEnabled&&!0===(0,s.getGlobalSecurityNotifications)())return t===l.ReducedPrivacyMode.E2EE&&r!==l.ReducedPrivacyMode.E2EE?(0,a.genEncryptNotificationMsg)(e,"e2e_identity_unavailable"):void 0}function _(e,t,r){if(c.ServerProps.bspSystemMessageEnabled&&t!==r)switch(r){case l.ReducedPrivacyMode.E2EE:return(0,a.genEncryptNotificationMsg)(e,"encrypt_now");case l.ReducedPrivacyMode.BSP:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_bsp");case l.ReducedPrivacyMode.FB:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_fb")}}function m(e){return(0,l.getReducedPrivacyMode)(e.isBusiness&&e.isEnterprise?e.privacyMode:null)}},96519:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,l.addProduct)(e,t,r)},t.appealProduct=function(e,t){return(0,l.appealProduct)(e,t)},t.createBusinessCatalog=function(){return(0,l.createCatalog)()},Object.defineProperty(t,"createProductCatalog",{enumerable:!0,get:function(){return d.createProductCatalog}}),t.deleteProducts=function(e){return(0,l.deleteProducts)(e)},t.editProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,l.editProduct)(e,t,r)},t.queryCatalog=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return(0,l.queryCatalog)(e,t,r,n,i,a,s)},t.queryProduct=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return(0,l.queryProduct)(e,t,r,n,i,a)},t.queryProductList=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0;return(0,l.queryProductList)(e,t,r,n,i)},t.reportProduct=function(e,t,r){return(0,l.reportProduct)(e,t,r)},t.sendProductToChat=function(e,t,r){const{catalogWid:n}=e;if(!t)return;const l=t.productCollection.get(e.id),d=l?(0,c.unproxy)(l):(0,c.unproxy)(e);if(!d)return;const u=d.getProductImageCollectionHead(),p=null==u?void 0:u.mediaData;if(!p)return;(0,s.findChat)(n).then((function(e){i.Cmd.openChatFromUnread(e).then((t=>{if(t){const t=(0,c.unproxy)((0,o.createProductInquiry)(d,n,p,null==r?void 0:r.session.toString()));e.composeQuotedMsg=t,i.Cmd.focusChatTextInput(e),window.innerWidth<=a.default.LAYOUT_2COLUMNS_MAX_WIDTH&&i.Cmd.closeDrawerRight()}}))}))};var i=r(88102),a=n(r(69618)),s=r(50101),o=r(17304),l=r(21374),c=(r(27798),r(31019)),d=r(90880)},92002:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProductListHeaderImageRejected=function(e,t){var r,i,a;const s=n.MsgCollection.get(t),o=null==s||null===(r=s.list)||void 0===r||null===(i=r.productListInfo)||void 0===i||null===(a=i.headerImage)||void 0===a?void 0:a.productId;e.id===o&&null!=s&&(s.productHeaderImageRejected=!0)};var n=r(59871)},31452:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyContactBusinessProps=void 0,t.updateContactsWithVerifiedNames=h;var i=n(r(48926)),a=n(r(45095)),s=n(r(69618)),o=r(19380),l=r(7293),c=r(49714),d=r(64551),u=r(68708),p=r(58021);function h(e,t){const r={};for(const t of e){const{id:e}=t;r[e.user]=t}for(const e of t){const{id:t}=e,n=r[t.user],i=Boolean(n),{level:a,name:s,isApi:o,privacyMode:l}=n||{},c={isBusiness:i,isEnterprise:Boolean(o),verifiedLevel:_(a),verifiedName:s,privacyMode:d.ServerProps.bspSystemMessageEnabled?l:null};e.set(c)}}const f=function(){var e=(0,i.default)((function*(){if(!l.GK.supportsFeature(l.GK.F.MD_BACKEND))return;h((yield(0,u.getAllVerifiedNames)()).map((e=>{let{id:t,name:r,level:n,isApi:i,privacyMode:s}=e;return{id:(0,p.createUserWid)(t),name:r,level:n,isApi:i,privacyMode:s?{actualActors:(0,a.default)(c.ActualActorsEnumType.cast(s.actualActors),"ActualActorsEnumType.cast(privacyMode.actualActors)"),hostStorage:(0,a.default)(c.HostStorageEnumType.cast(s.hostStorage),"HostStorageEnumType.cast(privacyMode.hostStorage)"),privacyModeTs:s.privacyModeTs}:null}})),o.ContactCollection.toArray())}));return function(){return e.apply(this,arguments)}}();function _(e){if(null!=e){switch(e){case"unknown":return s.default.VERIFIED_LEVEL.UNKNOWN;case"low":return s.default.VERIFIED_LEVEL.LOW;case"high":return s.default.VERIFIED_LEVEL.HIGH}return s.default.VERIFIED_LEVEL.UNKNOWN}}t.applyContactBusinessProps=f},66167:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndUpdateContactPropertiesOnNewChat=function(){return f.apply(this,arguments)},t.updateVerifiedInfo=p;var i=n(r(48926)),a=r(19380),s=r(7293),o=r(39354),l=n(r(69722)),c=r(64551),d=r(31452),u=r(68708);function p(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){const r=e.id,{name:n,level:i,isApi:a,serial:l}=t,p=c.ServerProps.bspSystemMessageEnabled?t.privacyMode:null;s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&null!=p&&(yield(0,o.handlePrivacyModeTransition)(r,p,null,!0)),(0,d.updateContactsWithVerifiedNames)([{id:r,name:n,level:i,isApi:a,privacyMode:p}],[e]),yield(0,u.createOrUpdateVerifiedBusinessName)({id:r.user,level:i,serial:l,name:n,isApi:a,privacyMode:p?{actualActors:p.actualActors,hostStorage:p.hostStorage,privacyModeTs:p.privacyModeTs}:null})}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const t=yield(0,l.default)(e);if(null==t)return;const{bizInfo:r}=t;if(r){const t=a.ContactCollection.get(e);if(null==t)return __LOG__(4,void 0,new Error,!0)`queryAndUpdateContactPropertiesOnNewChat contact does not exist ${""}`,void SEND_LOGS("queryAndUpdateContactPropertiesOnNewChat contact does not exist");yield p(t,r.verifiedName)}}}))).apply(this,arguments)}},92027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedNameSync=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(7293),s=r(39354),o=r(31452),l=r(85808);function c(){return(c=(0,i.default)((function*(e){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND)||0===e.length)return;yield e.map((e=>{let{id:t,verifiedName:{privacyMode:n}}=e;if(null==n)return;const i=r(69951).ChatCollection.get(t);return null!=i&&!0!==i.shouldAppearInList?(0,s.handlePrivacyModeTransition)(t,n,i,!0):void 0}));const t=e.map((e=>{let{id:t,verifiedName:{level:r,serial:n,name:i,isApi:a,privacyMode:s}}=e;return{id:t.user,level:r,serial:n,name:i,isApi:a,privacyMode:s?{actualActors:s.actualActors,hostStorage:s.hostStorage,privacyModeTs:s.privacyModeTs}:null}}));yield(0,l.getTable)().bulkCreateOrReplace(t),yield(0,o.applyContactBusinessProps)()}))).apply(this,arguments)}},29179:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.changeEphemeralDuration=function(){return y.apply(this,arguments)},t.maybeUpdateEphemeralSetting=function(){return E.apply(this,arguments)},t.updateEphemeralSettingTimestamp=g;var i=n(r(48926)),a=r(22683),s=n(r(69618)),o=n(r(89520)),l=r(96751),c=r(99234),d=r(40763),u=r(4914),p=n(r(32219)),h=r(15860),f=r(75887),_=r(31035),m=r(58871);function g(e,t){if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.updateEphemeralSettingTimestamp should not be called for group ${e.id.toString()}`,void SEND_LOGS("update-ephemeral-setting-timestamp");(0,m.updateLocal)(e.id,{ephemeralSettingTimestamp:t}).then((()=>{e.ephemeralSettingTimestamp=t,__LOG__(2)`chat.updateEphemeralSettingTimestamp chatId=${e.id.toString()} ephemeralSettingTimestamp=${t}`}))}function y(){return(y=(0,i.default)((function*(e,t){if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.changeEphemeralDuration should not be called for group ${e.id.toString()}`,SEND_LOGS("change-ephemeral-duration"),Promise.resolve();const r=e.contact;if(r.isUser&&r.isContactBlocked)return Promise.reject(new o.default("changing ephemeral setting for contact is blocked",r));const n={id:new p.default({id:(0,h.newTag)(),remote:e.id,fromMe:!0}),from:(0,c.getMaybeMeUser)(),to:e.id,t:a.Clock.globalUnixTime(),type:s.default.MSG_TYPE.PROTOCOL,subtype:"ephemeral_setting",ephemeralDuration:t,local:!0,isNewMsg:!0,self:"out"};g(e,null==e.ephemeralSettingTimestamp?1:e.ephemeralSettingTimestamp+1),yield(0,f.addAndSendMsgToChat)(e,n)[1],yield(0,m.updateLocal)(e.id,{ephemeralDuration:t,disappearingModeInitiator:l.DisappearingModeInitiator.ChangedInChat}),e.ephemeralDuration=t,e.disappearingModeInitiator=l.DisappearingModeInitiator.ChangedInChat,__LOG__(2)`chat.changeEphemeralDuration chatId=${e.id.toString()} ephemeralDuration=${t}`}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,r){var n,i;let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.maybeUpdateEphemeralSetting should not be called for group ${e.id.toString()}`,SEND_LOGS("handle-ephemeral-sync-response"),!1;if(!(0,u.isEphemeralDurationAllowed)(t))return __LOG__(2)`chat.maybeUpdateEphemeralSetting called with invalid setting ${t} seconds for chat ${e.id.toString()}`,!1;const s=null!==(n=e.ephemeralSettingTimestamp)&&void 0!==n?n:0,o=null!==(i=e.ephemeralDuration)&&void 0!==i?i:0,c=e.id,p=(0,_.shouldUpdateEphemeralSetting)({oldDuration:o,oldSettingTimestamp:s,newDuration:t,newSettingTimestamp:r,chatId:c});return p&&(yield(0,m.updateLocal)(e.id,{ephemeralDuration:t,ephemeralSettingTimestamp:r,disappearingModeInitiator:l.DisappearingModeInitiator.ChangedInChat}),o!==t&&a&&(yield(0,d.generateEphemeralSystemMessage)(e,t)),e.ephemeralDuration=t,e.ephemeralSettingTimestamp=r,e.disappearingModeInitiator=l.DisappearingModeInitiator.ChangedInChat,__LOG__(2)`chat.maybeUpdateEphemeralSetting updated chatId=${e.id.toString()} ephemeralDuration=${t} ephemeralSettingTimestamp=${r}`),p}))).apply(this,arguments)}},50101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.findChat=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(89385),s=r(91829),o=r(9025);function l(){return(l=(0,i.default)((function*(e,t,r){if(null==r?void 0:r.aborted)throw new a.AbortError;const n=yield(0,o.getExisting)(e);if(n)return n;if(null==r?void 0:r.aborted)throw new a.AbortError;return yield(0,s.create)(e,{createdLocally:!0},{forceUsync:t})}))).apply(this,arguments)}},60629:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createChatOnNewMsg=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(19380),s=r(91829),o=r(30849);function l(){return(l=(0,i.default)((function*(e,t,r){if(!e.isUserNotPSA())return;const n=a.ContactCollection.gadd(e);(0,o.comparePrivacyMode)(r,n.privacyMode)>0&&(n.privacyMode=r),yield(0,s.create)(e,{createdLocally:!1},{firstIncomingMsg:t,nextPrivacyMode:n.privacyMode})}))).apply(this,arguments)}},371:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearPresence=function(e){e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"));e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.typing=!1},t.markComposing=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.typing){const t=e.id;(0,s.sendChatStateComposing)(t).catch((0,a.filteredCatch)(u.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence composing error ${t.toString()}`}))).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>h(e)),o.default.PRESENCE_RESEND_WAIT)}e.typing=!0,e.pausedTimerId&&clearTimeout(e.pausedTimerId);e.pausedTimerId=setTimeout((()=>p(e)),o.default.SEND_PAUSED_WAIT)}((0,d.unproxy)(e))},t.markPaused=function(e){return p((0,d.unproxy)(e))},t.markRecording=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.recording){const t=e.id;(0,s.sendChatStateRecording)(t).catch((0,a.filteredCatch)(u.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence recording error ${t.toString()}`}))).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>h(e)),o.default.PRESENCE_RESEND_WAIT)}e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.recording=!0,e.typing=!1}((0,d.unproxy)(e))},t.presenceOnlineChanged=function(e){e.presence.isOnline?h(e):e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"))},t.sendPresenceAvailable=function(){(0,c.setPresenceAvailable)()},t.sendPresenceUnavailable=function(){(0,c.setPresenceUnavailable)()};var a=r(50796),s=r(76931),o=i(r(69618)),l=n(r(64103)),c=r(1985),d=r(31019),u=r(77591);function p(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&(e.typing||e.recording)){const t=e.id;(0,s.sendChatStatePaused)(t).catch((0,a.filteredCatch)(u.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence paused error ${t.toString()}`}))).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId")),e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId")),e.typing=e.recording=!1}function h(e){const t=e.id;if(e.recording)(0,s.sendChatStateRecording)(t).catch((0,a.filteredCatch)(u.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend recording error ${t.toString()}`}))).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined],(()=>{})));else{if(!e.typing)return void e.unset("presenceResendTimerId");(0,s.sendChatStateComposing)(t).catch((0,a.filteredCatch)(u.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend composing error ${t.toString()}`}))).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId=setTimeout((()=>h(e)),o.default.PRESENCE_RESEND_WAIT)}},83802:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearChat=E,t.clearMessagesInChatModel=S,t.createEncryptionSystemMessage=function(e,t){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!t){const{handleSingleMsgMD:t}=r(5819),n=(0,d.default)(e.id,e.contact.privacyMode);return t(n.from,n)}return Promise.resolve()},t.sendClear=function(e,t){return y((0,f.unproxy)(e),t)};var i=n(r(48926)),a=r(50796),s=n(r(48360)),o=r(46331),l=r(91177),c=r(88102),d=n(r(25868)),u=r(7293),p=r(57701),h=n(r(43725)),f=r(31019),_=r(58871),m=r(77591),g=r(85893);function y(e,t){const{promises:n}=e;if(n.sendClear)return n.sendClear;const f=e.getLastMsgKeyForAction(),v=n.sendClear=(0,l.sendClear)(e,f,t),T=new o.ActionType(h.default.t(27)),A=v.then(function(){var t=(0,i.default)((function*(){const t=r(63183).ConversationEndOfHistoryTransferModelPropType;return e.endOfHistoryTransferType=t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY,yield(0,_.updateLocal)(e.id,{endOfHistoryTransferType:t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY}),u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!(0,p.clearOrDeleteChatSyncEnabled)()?new o.ActionType(s.default._("Chat cleared from this device",null,{hk:"1XIeYe"})):new o.ActionType(h.default.t(26))}));return function(){return t.apply(this,arguments)}}()).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>{if(e.status>=400)return new o.ActionType(h.default.t(25))}))).catch((()=>(__LOG__(3)`models:chat:sendClear dropped`,new o.ActionType(h.default.t(25),{actionText:h.default.t(139),actionHandler:()=>y(e,t)}))));return c.Cmd.openToast((0,g.jsx)(o.ActionToast,{id:(0,o.genId)(),initialAction:T,pendingAction:A})),v.then((n=>{if(!n._duplicate)if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){if(!(0,p.clearOrDeleteChatSyncEnabled)()){E(e,t);const{handleSingleMsgMD:n}=r(5819),i=(0,d.default)(e.id,e.contact.privacyMode);return n(i.from,i)}n.result&&S(e,n.result)}else E(e,t)})).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(()=>{}))).finally((()=>{n.sendClear=null}))}function E(e,t){if(e){const r=e.getLastMsgKeyForAction(),n=r?e.msgs.get(r):void 0;e.deleteMsgsBeforeMsgInclusive(n,t)}}function S(e,t){e&&t&&e.deleteMessages(t)}},75887:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addAndSendMsgToChat=function(e,t,n){return function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const a=Promise.resolve(t).then((t=>{const i=r(59871).MsgCollection,a=(0,s.default)({},t);if(E.ServerProps.bspSystemMessageEnabled){const t=(0,g.getContactPrivacyMode)(e.id);null!=t&&(a.privacyModeWhenSent=t)}const c=i.add(a)[0];if(c){var m;p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&(c.wamMessageSendPerfReporter=new _.MessageSendPerfReporter(c.to,c.getWamMediaType(),c.getWamMessageType())),n=(0,u.default)(c,e);const t=n?[n,a]:[a];return null===(m=c.wamMessageSendPerfReporter)||void 0===m||m.startSavedStage(),(0,f.storeMessages)(t,e.id).then((()=>{var e;if(null===(e=c.wamMessageSendPerfReporter)||void 0===e||e.postSavedStage(),c.type===l.default.MSG_TYPE.GROUPS_V4_INVITE)return(0,h.persistGroupInviteV4Msg)(c.id.toString(),{id:c.id.toString(),from:c.from.toString(),to:c.to.toString(),groupId:c.inviteGrp,expiration:parseInt(c.inviteCodeExp,10),expired:o.Clock.globalUnixTime()>=parseInt(c.inviteCodeExp,10)})})).then((()=>c.waitForPrep().then((()=>c))))}throw new d.ModelCreateError("Msg",a)})),c=e.addQueue.enqueue(a).then((t=>{var r;return null===(r=t.wamMessageSendPerfReporter)||void 0===r||r.startRenderedStage(),n&&e.msgs.add(n),e.msgs.add(t)[0]})).then((e=>{var t;return null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.postRenderedStage(),e})),m=i?c.then(i).then((()=>c)):c,y=v(e,m);return[c,y]}((0,S.unproxy)(e),t,n)},t.resendMsgToChat=function(e,t){return v((0,S.unproxy)(e),t)};var a=i(r(48926)),s=i(r(81109)),o=r(22683),l=i(r(69618)),c=r(1973),d=n(r(64103)),u=i(r(43239)),p=r(7293),h=r(62415),f=r(84886),_=r(30097),m=r(29731),g=r(30849),y=r(19708),E=(r(13705),r(64551)),S=r(31019);function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e,t){if(p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&e.isGroup){const t=r(63928).default;yield t.find(e.id)}return new m.NonPersistJob("sendMessage",(0,a.default)((function*(){const r=yield e.sendQueue.enqueue(t);return(0,y.sendMsgRecord)(r)})),{priority:c.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}},19569:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotSpam=function(e,t){return E((0,f.unproxy)(e),t)},t.sendSpamBlockClear=function(e,t){return function(e,t){const{promises:r,isGroup:n,contact:i}=e;if(r.reportSpamBlockClear)return r.reportSpamBlockClear;if(n)return Promise.reject(new c.ActionError);const a=y(e,t);return r.reportSpamBlockClear=a.then((()=>(0,o.blockContact)(i))).then((()=>(0,p.sendClear)(e,!1))).catch((()=>{})).finally((()=>{r.reportSpamBlockClear=null})),r.reportSpamBlockClear}((0,f.unproxy)(e),t)},t.sendSpamExitClear=function(e,t){return function(e,t){const{promises:r,isGroup:n,isReadOnly:i,msgs:a}=e;if(r.reportSpamExitClear)return r.reportSpamExitClear;if(!n)return Promise.reject(new c.ActionError);let s;const o=y(e,t);if(i)s=o;else{const t=(0,d.sendExitGroup)(e),r=(0,_.default)(a,"change:last",(e=>e.isGroupLeave()));s=Promise.all([o,t,r])}return r.reportSpamExitClear=s.then((()=>(0,p.sendClear)(e,!1))).catch((()=>{})).finally((()=>{r.reportSpamExitClear=null})),r.reportSpamExitClear}((0,f.unproxy)(e),t)},t.sendSpamReport=function(e,t){return y((0,f.unproxy)(e),t)};var a=r(50796),s=r(46331),o=r(80140),l=r(88102),c=i(r(64103)),d=r(5501),u=n(r(43725)),p=r(83802),h=r(26707),f=(r(38839),r(31019)),_=n(r(17072)),m=r(77591),g=r(85893);function y(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.genId)();const{promises:n}=e;if(n.sendSpamReport)return n.sendSpamReport;const i=n.sendSpamReport=(0,h.sendSpamReport)(e,t),o=new s.ActionType(u.default.t(132)),c=i.then((()=>new s.ActionType(u.default.t(134)))).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(()=>new s.ActionType(u.default.t(133))))).catch((()=>(__LOG__(3)`models:chat:sendSpamReport dropped`,new s.ActionType(u.default.t(133),{actionText:u.default.t(139),actionHandler:()=>y(e,t,r)}))));return l.Cmd.openToast((0,g.jsx)(s.ActionToast,{id:r,initialAction:o,pendingAction:c})),i.finally((()=>{n.sendSpamReport=null}))}function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.genId)();const{promises:n,notSpam:i}=e;if(i)return Promise.resolve();if(n.sendNotSpam)return n.sendNotSpam;const o=n.sendNotSpam=(0,h.sendNotSpam)(e);if(t){const n=new s.ActionType(u.default.t(86)),i=o.then((()=>new s.ActionType(u.default.t(88)))).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(()=>new s.ActionType(u.default.t(87))))).catch((()=>(__LOG__(3)`models:chat:sendNotSpam dropped`,new s.ActionType(u.default.t(87),{actionText:u.default.t(139),actionHandler:()=>E(e,t,r)}))));l.Cmd.openToast((0,g.jsx)(s.ActionToast,{id:r,initialAction:n,pendingAction:i}))}return o.then((()=>{e.set({notSpam:!0})})).finally((()=>{e.isTrusted(),n.sendNotSpam=null}))}},41088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendTcToken=function(){return u.apply(this,arguments)},t.sendTcTokenWhenDeviceIdentityChange=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(92844),s=r(69951),o=r(4484),l=r(22683),c=r(76214),d=r(80079);function u(){return(u=(0,i.default)((function*(e){if(!e.isUserNotPSA())return;const t=s.ChatCollection.get(e);if(null!=t&&(0,o.shouldSendNewToken)(t.tcTokenSenderTimestamp))try{const r=(0,a.castToUnixTime)(l.Clock.globalUnixTime());yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],r);const n={tcTokenSenderTimestamp:r};t.set(n),yield(0,c.getChatTable)().merge(e.toString(),n)}catch(e){__LOG__(3,!0,void 0,!0)`sendTcToken failed - ${e}`,SEND_LOGS("send-tc-token-failed")}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=s.ChatCollection.get(e);if(null==t)return;const r=t.tcTokenSenderTimestamp;if(null!=r&&!(0,o.isTokenExpired)(r,o.TcTokenMode.Sender))try{yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],(0,a.castToUnixTime)(r))}catch(e){__LOG__(3,!0,void 0,!0)`sendTcTokenWhenDeviceIdentityChange failed - ${e}`,SEND_LOGS("send-tc-token-device-identity-change-failed")}}))).apply(this,arguments)}},3553:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unstarAllMessages=function(e,t){return f(e,t?(0,u.unproxy)(t):t)};var i=r(50796),a=r(46331),s=r(88102),o=n(r(43725)),l=r(69694),c=n(r(11810)),d=r(19011),u=r(31019),p=r(77591),h=r(85893);function f(e,t){const n=r(69951).ChatCollection,u=t?t.promises:n.promises,_=t?t.id:void 0;if(u.sendUnstarAll)return u.sendUnstarAll;const m=u.sendUnstarAll=(0,l.sendUnstarAll)(e,_),g=new a.ActionType(o.default.t(103)),y=m.then((()=>new a.ActionType(o.default.t(101)))).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(e=>{if(e.statusCode>=400)return new a.ActionType(o.default.t(97))}))).catch((()=>(__LOG__(3)`models:chat:sendUnstarAll dropped`,new a.ActionType(o.default.t(97),{actionText:o.default.t(139),actionHandler:()=>f(e,t)}))));return s.Cmd.openToast((0,h.jsx)(a.ActionToast,{id:(0,a.genId)(),initialAction:g,pendingAction:y})),m.then((()=>{e.forEach((e=>{e.set("star",!1)})),t?(0,d.removeStarredMsgs)(e):(d.AllStarredMsgsCollection.reset(),c.default.reset(),n.forEach((e=>{e.starredMsgs&&e.starredMsgs.reset()})))})).finally((()=>{u.sendUnstarAll=null}))}},59201:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setTcToken=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(95024),s=r(91829),o=r(9025),l=r(76214);function c(){return(c=(0,i.default)((function*(e,t,r){if(null==r)return;if(!e.isUserNotPSA())return;let n=yield(0,o.getExisting)(e);if(null==n)return void(n=yield(0,s.create)(e,{tcToken:r,tcTokenTimestamp:t,pendingInitialLoading:!1,createdLocally:!1}));if(null!=n.tcToken&&(0,a.arrayBuffersDeepEqual)(n.tcToken,r)||null!=n.tcTokenTimestamp&&n.tcTokenTimestamp>t)return;const i={tcToken:r,tcTokenTimestamp:t};n.set(i),yield(0,l.getChatTable)().merge(e.toString(),i)}))).apply(this,arguments)}},9609:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearUnreadMentions=function(e){var t;(0,f.isGroupCatchUpEnabled)()&&e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.unreadMentionMetadata.reset())},t.markSeen=v,t.markUnread=function(e,t){return A((0,m.unproxy)(e),t)},t.markUnseen=T,t.sendSeen=S,t.updateUnreadCountMD=O;var a=i(r(48926)),s=r(50796),o=r(46331),l=r(48285),c=r(88102),d=i(r(69618)),u=n(r(64103)),p=r(7293),h=i(r(43725)),f=r(10435),_=r(97848),m=r(31019),g=r(8080),y=r(77591),E=r(85893);function S(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return C((0,m.unproxy)(e),t).catch((0,s.filteredCatch)(y.ServerStatusCodeError,(e=>{__LOG__(3)`sendSeen: got status ${e.status}`})))}function v(e,t,r){return function(){return M.apply(this,arguments)}((0,m.unproxy)(e),t,r)}function T(e){!function(e){0!==e.unreadCount&&e.unreadCount!==d.default.MARKED_AS_UNREAD||(e.active&&(e.markedUnread=!0),(0,_.markConversationUnseen)(e.id).then((()=>{e.unreadCount=d.default.MARKED_AS_UNREAD})))}((0,m.unproxy)(e))}function A(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,o.genId)();t?e.active&&(e.markedUnread=!0):e.markedUnread=!1;const{promises:n}=e;if(n.markUnread)return n.markUnread;const i=n.markUnread=t?b(e):C(e),a=t?new o.ActionType(h.default.t(36)):new o.ActionType(h.default.t(35)),l=i.then((()=>{const n=t?h.default.t(34):h.default.t(33);return new o.ActionType(n,{actionText:h.default.t(143),actionHandler:()=>A(e,!t,r)})})).catch((0,s.filteredCatch)(y.ServerStatusCodeError,(e=>{if(e.status>=400)return t?new o.ActionType(h.default.t(32)):new o.ActionType(h.default.t(31));throw new Error("invalid response status")}))).catch((()=>{const n=t?h.default.t(32):h.default.t(31);return new o.ActionType(n,{actionText:h.default.t(139),actionHandler:()=>A(e,t,r)})}));return c.Cmd.openToast((0,E.jsx)(o.ActionToast,{id:r,initialAction:a,pendingAction:l})),i.then((()=>{})).catch((0,s.filteredCatch)(y.ServerStatusCodeError,(e=>{__LOG__(3)`markUnread: got status ${e.status}`}))).finally((()=>{n.markUnread=null}))}function C(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.markedUnread||0===e.unreadCount)return String(e.markedUnread),e.unreadCount,Promise.resolve();if(!g.Stream.available&&t)return e.listenToOnce(g.Stream,"change:available",(()=>S(e))),Promise.resolve();e.unreadCount,e.pendingSeenCount;const r=e.unreadCount-e.pendingSeenCount,n=-1===e.unreadCount&&-1===r;if(r<=0&&!n)return Promise.resolve();e.disableUnreadAnchor=!0,e.pendingSeenCount=e.unreadCount,e.pendingSeenCount;const i=()=>{e.pendingSeenCount=e.pendingSeenCount-r,e.pendingSeenCount,e.pendingSeenCount<0&&(__LOG__(3)`models:chat:sendSeen unread ${e.unreadCount} pending: ${e.pendingSeenCount} delta: ${r}`,e.pendingSeenCount=0)},a=e.getLastMsgKeyForAction();return(0,_.sendConversationSeen)(e,a,r).then((t=>{p.GK.supportsFeature(p.GK.F.MD_BACKEND)?O(e,r):t._duplicate?i():v(e,r,!0)})).catch((0,s.filteredCatch)(y.ServerStatusCodeError,(e=>(i(),Promise.reject(e))))).catch((0,s.filteredCatch)([y.WebdDrop,u.ProtoVersionUndefined],(()=>{i(),__LOG__(3)`models:chat:sendConversationSeen dropped`})))}function b(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e){const t=e.getLastMsgKeyForAction();try{yield(0,_.sendConversationUnseen)(e.id,t),T(e)}catch(t){return(0,s.filteredCatch)(y.ServerStatusCodeError,(t=>(e.markedUnread=!1,Promise.reject(t))))(t)}}))).apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];String(t);let n=null;null!=t?t>0&&t<=e.unreadCount?(n=e.unreadCount-t,String(n)):-1===t&&e.unreadCount<=0&&(n=0,String(n)):(n=0,String(n));const i=null==n?Promise.resolve():(0,_.markConversationSeen)(e.id,n);if(yield i,null!=t&&r){const r=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,r)}null!=n&&(e.unreadCount=n),e.unreadMsgAnchor=void 0,e.markedUnread=!1}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{unreadCount:n}=yield(0,l.getChatMeta)(e.id);if(e.unreadCount,e.unreadCount=n,e.unreadMsgAnchor=void 0,e.markedUnread=!1,r){const r=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,r)}}))).apply(this,arguments)}},53006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPushnameLocally=function(e){n.Conn.pushname=e,(0,i.setPushname)(e)};var n=r(17239),i=r(99234)},67146:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMeToContacts=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(19797),s=r(4233),o=r(99234),l=r(46582);function c(){return(c=(0,i.default)((function*(){const e=yield(0,l.requireContactCollection)(),t=(0,o.getMaybeMeUser)(),r=(0,a.toUserJid)(t.user);yield(0,s.getTable)().createOrMerge(r,{id:r}),e.gadd(t)}))).apply(this,arguments)}},66308:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkGenerateDeviceNotifications=function(){return _.apply(this,arguments)},t.createAndStoreDeviceNotifications=function(){return f.apply(this,arguments)},t.generateDeviceNotifications=p;var i=n(r(48926)),a=r(86945),s=n(r(69618)),o=r(90257),l=r(99234),c=r(76214),d=r(90641),u=r(58021);function p(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,r){const n={notifications:[],chatIds:[]};if(!(0,l.getGlobalSecurityNotifications)())return n;if((0,a.getABPropConfigValue)("adv_v2_m6"))return n;if(!(t.length>0||r.length>0))return n;let i=[];if(e.equals((0,l.getMeUser)()))try{(yield(0,c.getChatTable)().all()).forEach((e=>{e.id!==s.default.STATUS_WID&&i.push((0,u.createWid)(e.id))}))}catch(e){throw __LOG__(4,!0,new Error,!0)`get all from chat table failed`,SEND_LOGS("get all from chat table failed when creating device notification"),new Error("get all from chat table failed")}else try{const t=yield(0,c.getChatTable)().get(String(e)),r=yield(0,c.getParticipantTable)().equals(["participants"],String(e));i=r.map((e=>(0,u.createWid)(e.groupId))),t&&i.push((0,u.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chays failed")}const d=i.map((n=>(0,o.genDeviceNotificationMsg)(n,e,t,r)));return n.notifications=d,n.chatIds=i.map(String),n}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r){const{notifications:n}=yield p(e,t,r);yield Promise.all(n.map((e=>(0,d.storeMessageInTransaction)([e]))))}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){let t=[];const r=new Set;if((0,l.getGlobalSecurityNotifications)()){(yield Promise.all(e.map((e=>{let{wid:t,added:r,removed:n,isNewRecord:i}=e;return i?Promise.resolve(null):p(t,r,n)})))).forEach((e=>{e&&(t=t.concat(e.notifications),e.chatIds.forEach((e=>r.add(e))))}))}return t.length>0?{notifications:t,chatIds:Array.from(r)}:{notifications:[],chatIds:[]}}))).apply(this,arguments)}},54181:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceNotification=function(e){let{wid:t,devices:r,type:n}=e;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return null==n?Promise.reject(new Error("handleADVDeviceNotification: notification without type")):function(){return _.apply(this,arguments)}(t,r,n);return Promise.reject(new Error("This call is only supported in MD mode"))},t.handleADVDeviceSyncResult=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return function(){return m.apply(this,arguments)}(e);return Promise.reject(new Error("This call is only supported in MD mode"))},t.handleADVDeviceUpdateForMessage=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(86945),s=r(68268),o=r(5087),l=r(9108),c=r(7293),d=r(54678),u=n(r(76128)),p=r(17041),h=r(93832);function f(){return(f=(0,i.default)((function*(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){let l;return(0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(l=yield(0,s.getLastADVDeviceInfoCheckTime)()),(0,d.handleADVDeviceUpdateForMessage)(e,t,r,n,i,o,l)}return Promise.reject(new Error("This call is only supported in MD mode"))}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,n){let i=null;if("add"===n){const t=yield u.default.loadIdentityKey((0,h.createSignalAddress)(e).toString());i=t?(0,o.toCurveKeyPubKey)((0,h.strToBuffer)(t)):null}const c=yield(0,l.getDeviceRecord)(e.user);let d;(0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(d=yield(0,s.getLastADVDeviceInfoCheckTime)());const f=(0,r(81864).handleDeviceNotification)(e,n,t,i,c,d);if(f)return f.clearRecord&&(yield(0,p.clearDeviceRecord)(e,(null==c?void 0:c.devices)||[])),(0,p.bulkApplyDeviceUpdate)([{wid:e,update:f.update,currentRecord:c}])}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){__LOG__(2)`_handleADVDeviceSyncResult: start to handling ${e.length} updates`;const t=e.map((e=>e.wid)),n=e.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})),i=yield u.default.bulkLoadIdentityKey(n.map((e=>(0,h.createSignalAddress)(e.wid).toString()))),a=new Map;n.forEach(((e,t)=>{a.set(e.wid.user,i[t])}));const s=yield(0,l.bulkGetDeviceRecord)(t.map((e=>e.user))),c=[],d=[],f=r(81864).handleADVSyncResult;e.forEach(((e,t)=>{const r=a.get(e.wid.user),n=r?(0,o.toCurveKeyPubKey)((0,h.strToBuffer)(r)):null,i=s[t],l=f(e.wid,e.devices,n,i);null!=l&&(l.clearRecord?(c.push({wid:e.wid,currentList:(null==i?void 0:i.devices)||[]}),d.push({wid:e.wid,currentRecord:{id:e.wid.user,deleted:!0},update:l.update})):d.push({wid:e.wid,currentRecord:i,update:l.update}))})),yield Promise.all(c.map((e=>{let{wid:t,currentList:r}=e;return(0,p.clearDeviceRecord)(t,r)}))),yield(0,p.bulkApplyDeviceUpdate)(d)}))).apply(this,arguments)}},17041:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkApplyDeviceUpdate=function(){return y.apply(this,arguments)},t.clearDeviceRecord=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=n(r(91966)),s=n(r(69618)),o=r(66308),l=r(9108),c=r(99234),d=r(41796),u=r(84051),p=r(14748),h=n(r(29783)),f=r(90641),_=r(58928),m=r(58021);function g(){return(g=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=r(69551).d;yield Promise.all(t.filter((e=>e.id!==s.default.DEVICE.PRIMARY_DEVICE)).map((t=>a((0,m.createDeviceWidFromUserAndDevice)(e.user,t.id)))));const o=[],c=t.map((e=>e.id)).filter((e=>e!==s.default.DEVICE.PRIMARY_DEVICE)),{encryptedNotifications:d,chatIds:u}=yield E([{wid:e,added:o,removed:c,isNewRecord:!1}],n);yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=d.length>0?(0,f.storeEncryptedMessage)(d,u,!1):Promise.resolve(),r=(0,_.updateGroupParticipantsInTransaction)(e,o,c),n=(0,l.createOrReplaceDeviceRecord)({id:e.user,deleted:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove from device list table failed`,SEND_LOGS("remove from device list table failed when clearing device record"),new Error("remove from device list table failed")}));yield Promise.all([t,r,n])})),d.length>0)}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=[],o=[];let d=!1;e.forEach((e=>{let{wid:t,update:r,currentRecord:i}=e;const{devices:l}=r,u=l.map((e=>e.id)),p=i&&!i.deleted?i.devices.map((e=>e.id)):[],h=(0,a.default)(u,p).filter((e=>e!==s.default.DEVICE.PRIMARY_DEVICE)),f=(0,a.default)(p,u).filter((e=>e!==s.default.DEVICE.PRIMARY_DEVICE));n.push({wid:t,added:h,removed:f,isNewRecord:null==i}),f.forEach((e=>{o.push((0,m.createDeviceWidFromUserAndDevice)(t.user,e))})),t.user===(0,c.getMeUser)().user&&f.length>0&&(d=!0)}));const{encryptedNotifications:h,chatIds:g}=yield E(n,t),y=r(69551).d;Promise.all(o.map((e=>y(e)))),yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=h.length>0?(0,f.storeEncryptedMessage)(h,g,!1):Promise.resolve(),r=(0,_.bulkUpdateGroupParticipantsInTransaction)(n),i=(0,l.bulkCreateOrReplaceDeviceRecord)(e.map((e=>e.update))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into device list table failed`,SEND_LOGS("bulkCreateOrReplace into device list table failed when applying device update"),new Error("bulkCreateOrReplace into device list table failed")})),a=d?i.then((()=>(0,u.updateMissingKeyDevices)().catch((e=>{__LOG__(3)`syncd: updateMissingKeyDevices failed with error:
${e}`})))):Promise.resolve();yield Promise.all([t,r,i,a])})),h.length>0)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{notifications:r,chatIds:n}=yield(0,o.bulkGenerateDeviceNotifications)(e);if(t)return h.default.addOfflineMessage(r.map((e=>({msg:e})))),{chatIds:[],encryptedNotifications:[]};{const e=yield(0,f.encryptMultipleMsgs)(r);return v(r),{chatIds:n,encryptedNotifications:e}}}))).apply(this,arguments)}function v(e){return Promise.all(e.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,d.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})))}},58928:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkUpdateGroupParticipantsInTransaction=function(){return c.apply(this,arguments)},t.updateGroupParticipantsInTransaction=function(){return l.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(76214),o=r(58021);function l(){return(l=(0,a.default)((function*(e,t,r){const n=(yield(0,s.getParticipantTable)().equals(["participants"],String(e))).map((n=>{let a=n.rotateKey;const s=new Map(n.senderKey);return r.forEach((t=>{s.delete(String((0,o.createDeviceWidFromUserAndDevice)(e.user,t)))})),t.forEach((t=>{s.set(String((0,o.createDeviceWidFromUserAndDevice)(e.user,t)),!1)})),r.length>0&&(a=!0),(0,i.default)((0,i.default)({},n),{},{senderKey:s,rotateKey:a})}));return(0,s.getParticipantTable)().bulkCreateOrReplace(n)}))).apply(this,arguments)}function c(){return(c=(0,a.default)((function*(e){if(0===e.length)return;const t=yield(0,s.getParticipantTable)().anyOf(["participants"],e.map((e=>String(e.wid))));if(0===t.length)return;const r=new Map;e.forEach((e=>{r.set(String(e.wid),e)}));const n=t.map((e=>{let t=e.rotateKey;const n=new Map(e.senderKey);return e.participants.forEach((e=>{const i=r.get(e);if(!i)return;const{added:a,removed:s}=i;s.forEach((e=>{n.delete(String((0,o.createDeviceWidFromUserAndDevice)(i.wid.user,e)))})),a.forEach((e=>{n.set(String((0,o.createDeviceWidFromUserAndDevice)(i.wid.user,e)),!1)})),s.length>0&&(t=!0)})),(0,i.default)((0,i.default)({},e),{},{senderKey:n,rotateKey:t})}));return(0,s.getParticipantTable)().bulkCreateOrReplace(n)}))).apply(this,arguments)}},89333:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeExpectedTsForDeviceRecord=function(e,t,r){const n=null==t?void 0:t.timestamp;if(null==n)return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};let i,s,o;null==t||t.deleted||(i=t.expectedTs,s=t.expectedTsLastDeviceJobTs,o=t.expectedTsUpdateTs);return a(e,n,r,i,s,o)},t.computeNewExpectedTs=a,t.shouldClearExpectedTs=function(e,t,r,i){if(!(0,n.getABPropConfigValue)("adv_v2_m4_m5"))return!1;if(null==r||r.deleted)return!1;if(null==r.expectedTs)return!1;if(e>=r.expectedTs)return!0;if(e<r.expectedTs&&t===r.expectedTs&&null!=i&&(null==r.expectedTsLastDeviceJobTs||i>r.expectedTsLastDeviceJobTs))return!0;return!1};var n=r(86945),i=r(22683);function a(e,t,r,a,s,o){if(!(0,n.getABPropConfigValue)("adv_v2_m4_m5"))return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};const l={expectedTs:a,expectedTsLastDeviceJobTs:s,expectedTsUpdateTs:o};return t>=e||null!=a&&a>=e||(l.expectedTs=e,l.expectedTsLastDeviceJobTs=r,(null==a||t>=a)&&(l.expectedTsUpdateTs=i.Clock.localUnixTime())),l}},65414:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleICDCData=function(e,t,r){if(_.GK.supportsFeature(_.GK.F.MD_BACKEND))return null!=r&&(0,c.getABPropConfigValue)("adv_v2_m4_m5")?g.enqueue((()=>function(){return y.apply(this,arguments)}(e,t,r))):Promise.resolve();return Promise.reject(new Error("handleICDCData: not supported for non md"))};var i=n(r(81109)),a=n(r(48926)),s=r(8243),o=r(27870),l=r(92844),c=r(86945),d=r(68268),u=n(r(69618)),p=r(9108),h=r(89333),f=r(99234),_=r(7293),m=r(81864);const g=new o.PromiseQueue;function y(){return(y=(0,a.default)((function*(e,t,r){const{deviceListMetadata:n}=r;if(null==n)return void __LOG__(2,void 0,void 0,void 0,["handleICDCData"])`get empty device list metadata`;if((null==e.device||e.device===u.default.DEVICE.PRIMARY_DEVICE)&&null!=n.senderTimestamp&&null==n.senderKeyHash){const t=(0,s.numberOrThrowIfTooLarge)(n.senderTimestamp)+1;return void(0,m.handleADVSyncResult)(e,{deviceList:[{id:u.default.DEVICE.PRIMARY_DEVICE,keyIndex:0}],keyIndex:{ts:(0,l.castToUnixTime)(t),signedKeyIndexBytes:null}},null,null)}const a=[],o=e.user===(0,f.getMeUser)().user;a.push({id:e.user,ts:n.senderTimestamp}),o&&null!=t&&a.push({id:t.user,ts:n.recipientTimestamp});const c=yield(0,d.getLastADVDeviceInfoCheckTime)(),_=yield(0,p.bulkGetDeviceRecord)(a.map((e=>e.id))),g=[];return _.forEach(((e,t)=>{const r=a[t].ts;if(null==e||e.deleted||null==r)return;const n=(0,h.computeExpectedTsForDeviceRecord)((0,s.numberOrThrowIfTooLarge)(r),e,c);n.expectedTs===e.expectedTs&&n.expectedTsLastDeviceJobTs===e.expectedTsLastDeviceJobTs&&e.expectedTsUpdateTs==e.expectedTsUpdateTs||(__LOG__(2)`handleICDCData: update expectd timestamp for ${e.id}`,g.push((0,i.default)((0,i.default)({},e),n)))})),g.length>0?(0,p.bulkCreateOrReplaceDeviceRecord)(g):void 0}))).apply(this,arguments)}},84135:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleListReset=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(8243),s=r(92844),o=n(r(41143)),l=r(86945),c=n(r(69618)),d=r(5087),u=r(89333),p=r(52083),h=r(17041),f=r(93832),_=r(58021);function m(){return(m=(0,i.default)((function*(e,t,r,n,i){let m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6?arguments[6]:void 0;const{rawId:y,timestamp:E,keyIndex:S}=t,v=(0,a.numberOrThrowIfTooLarge)(E),T=(0,l.getABPropConfigValue)("adv_v2_m4_m5"),A=e.device;(0,o.default)(null!=A&&A!==c.default.DEVICE.PRIMARY_DEVICE,"handleADVDeviceIdentity: called for primary device");const C=(0,_.toUserWid)(e);let b=0;if(T&&(b=(null==i?void 0:i.timestamp)||(0,s.pastUnixTime)(((0,l.getABPropConfigValue)("num_days_key_index_list_expiration")-1)*s.DAY_SECONDS)),null!=i&&!i.deleted){if(i.timestamp>v)throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");yield(0,h.clearDeviceRecord)(C,i.devices,m)}r&&(yield(0,p.getSignalProtocolStore)().saveIdentity((0,f.createSignalAddress)(C).toString(),(0,d.toSignalCurvePubKey)(r)));const P={id:e.user,rawId:y,timestamp:b,devices:[{id:A,keyIndex:S},{id:c.default.DEVICE.PRIMARY_DEVICE,keyIndex:0}],validIndexes:null,currentIndex:null,deleted:!1};if(T){const e=(0,u.computeExpectedTsForDeviceRecord)(v,P,g);P.expectedTs=e.expectedTs,P.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,P.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,h.bulkApplyDeviceUpdate)([{wid:C,update:P,currentRecord:null}],m),yield(0,p.getSignalProtocolStore)().saveIdentity((0,f.createSignalAddress)(e).toString(),(0,d.toSignalCurvePubKey)(n))}))).apply(this,arguments)}},80405:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleNoListReset=function(){return m.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(8243),o=n(r(41143)),l=r(86945),c=n(r(69618)),d=r(5087),u=r(89333),p=r(52083),h=r(17041),f=r(93832),_=r(58021);function m(){return(m=(0,a.default)((function*(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=arguments.length>5?arguments[5]:void 0;const{timestamp:g,keyIndex:y}=t,E=(0,s.numberOrThrowIfTooLarge)(g),S=e.device;if((0,o.default)(null!=S&&S!==c.default.DEVICE.PRIMARY_DEVICE,"handleADVDeviceIdentity: called for primary device"),n.timestamp>=E&&n.validIndexes&&!n.validIndexes.includes(y))throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");const v=new Map(n.devices.map((e=>[e.id,e.keyIndex])));if(!v.has(S)||v.get(S)!==y){v.set(S,y);const t=Array.from(v.entries()).map((e=>{let[t,r]=e;return{id:t,keyIndex:r}})),s=(0,i.default)((0,i.default)({},n),{},{devices:t,deleted:!1});if((0,l.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,u.computeExpectedTsForDeviceRecord)(E,s,m);s.expectedTs=e.expectedTs,s.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,s.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,h.bulkApplyDeviceUpdate)([{wid:(0,_.toUserWid)(e),update:s,currentRecord:n}],a),yield(0,p.getSignalProtocolStore)().saveIdentity((0,f.createSignalAddress)(e).toString(),(0,d.toSignalCurvePubKey)(r))}}))).apply(this,arguments)}},54678:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceUpdateForMessage=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=n(r(41143)),s=n(r(69618)),o=r(9108),l=r(84135),c=r(80405),d=r(93832),u=r(58021);function p(){return(p=(0,i.default)((function*(e,t,r,n,i){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6?arguments[6]:void 0;const{rawId:f,timestamp:_,keyIndex:m}=t;(0,a.default)(null!=f,"handleADVDeviceIdentity: rawId of deviceIdentity should not be null"),(0,a.default)(null!=_,"handleADVDeviceIdentity: timestamp of deviceIdentity should not be null"),(0,a.default)(null!=m,"handleADVDeviceIdentity: keyIndex of deviceIdentity should not be null");const g={rawId:f,timestamp:_,keyIndex:m},y=e.device;(0,a.default)(null!=y&&y!==s.default.DEVICE.PRIMARY_DEVICE,"handleADVDeviceIdentity: called for primary device");const E=(0,u.toUserWid)(e),S=yield(0,o.getDeviceRecord)(E.user),v=null==r||null!=n&&!(0,d.bufferEqual)(r,n);return!S||S.deleted||S.rawId!==f||v?(0,l.handleListReset)(e,g,v?n:null,i,S,p,h):(0,c.handleNoListReset)(e,g,i,S,p,h)}))).apply(this,arguments)}},79156:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleDeviceAddNotification=function(e,t,r,n,i,d,u){if(!d||d.deleted)return null;if(r<d.timestamp)return null;if(null==i)return null;const p=(0,c.decodeSignedKeyIndexBytes)(i,n);if(!p)return null;const h=p.rawId,f=(0,a.numberOrThrowIfTooLarge)(p.timestamp);if(f!==r)return null;let _=!1,m=null;const g=d.timestamp;d.rawId!==h?_=!0:m=d.devices;const y=new Set(p.validIndexes),E=p.currentIndex||0,S=null==m?[]:m.filter((e=>e.id!==o.default.DEVICE.PRIMARY_DEVICE&&(y.has(e.keyIndex)||e.keyIndex>E)));t.forEach((e=>{const{id:t,keyIndex:r}=e;t!==o.default.DEVICE.PRIMARY_DEVICE&&null!=r&&y.has(r)&&S.push({id:t,keyIndex:r})})),S.push({id:o.default.DEVICE.PRIMARY_DEVICE,keyIndex:0});const v={id:e.user,rawId:h,timestamp:g,validIndexes:Array.from(y),devices:S,currentIndex:p.currentIndex,deleted:!1};if((0,s.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,l.computeExpectedTsForDeviceRecord)(f,v,u);v.expectedTs=e.expectedTs,v.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,v.expectedTsUpdateTs=e.expectedTsUpdateTs}return{update:v,clearRecord:_}},t.handleDeviceRemoveNotification=function(e,t,r){if(null==r||r.deleted)return null;if(t<r.timestamp)return null;const n=new Map(e.map((e=>[e.id,e.keyIndex]))),a=r.devices.filter((e=>{if(e.id!==o.default.DEVICE.PRIMARY_DEVICE){const t=n.get(e.id);return null==t||t!==e.keyIndex}return!1}));return a.push({id:o.default.DEVICE.PRIMARY_DEVICE,keyIndex:0}),{update:(0,i.default)((0,i.default)({},r),{},{devices:a}),clearRecord:!1}};var i=n(r(81109)),a=r(8243),s=r(86945),o=n(r(69618)),l=r(89333),c=r(87622)},40626:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleKeyIndexResult=function(e,t,r,n,l,c,d,u){if(null!=(null==c?void 0:c.timestamp)&&r<c.timestamp)return null;if(null==l)return null;const p=(0,o.decodeSignedKeyIndexBytes)(l,n);if(!p)return null;const h=p.rawId,f=(0,i.numberOrThrowIfTooLarge)(p.timestamp);if(f!==r)return null;let _=!1,m=null,g=t;c&&!c.deleted&&(null==g&&(g=c.devices),c.rawId!==h?_=!0:m=c.devices);const y=new Map,E=new Set(p.validIndexes),S=p.currentIndex||0;g&&g.forEach((e=>{null!=e.keyIndex&&E.has(e.keyIndex)&&y.set(e.id,e.keyIndex)}));null!=m&&m.forEach((e=>{e.keyIndex>S&&y.set(e.id,e.keyIndex)}));y.set(a.default.DEVICE.PRIMARY_DEVICE,0);const v=Array.from(y.entries()).map((e=>{let[t,r]=e;return{id:t,keyIndex:r}})),T={id:e.user,rawId:h,timestamp:f,validIndexes:Array.from(E),devices:v,currentIndex:p.currentIndex,deleted:!1};_||(0,s.shouldClearExpectedTs)(f,u,c,d)||c&&!c.deleted&&(T.expectedTs=c.expectedTs,T.expectedTsLastDeviceJobTs=c.expectedTsLastDeviceJobTs,T.expectedTsUpdateTs=c.expectedTsUpdateTs);return{update:T,clearRecord:_}};var i=r(8243),a=n(r(69618)),s=r(89333),o=r(87622)},49884:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleOmittedResult=function(e,t,r,n){if(!t||t.deleted)return null;if(null!=e&&e<t.timestamp)return null;const o=(0,i.default)({},t);null!=e&&(o.timestamp=e,(0,s.shouldClearExpectedTs)(e,r,t,n)&&(o.expectedTs=void 0,o.expectedTsLastDeviceJobTs=void 0,o.expectedTsUpdateTs=void 0));return o.devices=[{id:a.default.DEVICE.PRIMARY_DEVICE,keyIndex:0}],{update:o,clearRecord:!1}};var i=n(r(81109)),a=n(r(69618)),s=r(89333)},81864:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVSyncResult=function(e,t,r,n,i){const{deviceList:s,keyIndex:c}=t;if(null==c||null==c.signedKeyIndexBytes)return null!=s&&s.some((e=>e.id!==a.default.DEVICE.PRIMARY_DEVICE))?void __LOG__(2)`processADVSyncResult: drop response with companion device but no keyIndexbytes`:(0,l.handleOmittedResult)(null==c?void 0:c.ts,n,null==c?void 0:c.expectedTs,i);{const{ts:t,expectedTs:a,signedKeyIndexBytes:l}=c;return(0,o.handleKeyIndexResult)(e,s,t,l,r,n,i,a)}},t.handleDeviceNotification=function(e,t,r,n,a,o){const{deviceList:l,keyIndex:c}=r;(0,i.default)(null!=l,`handleDeviceNotification: device list should not be none for device ${t} notification`),(0,i.default)(null!=c,`handleDeviceNotification: keyIndex should not be none for device ${t} notification`);const{ts:d,signedKeyIndexBytes:u}=c;if("add"===t)return(0,i.default)(null!=u,`handleDeviceNotification: signedKeyIndexBytes should not be none for device ${t} notification`),(0,s.handleDeviceAddNotification)(e,l,d,u,n,a,o);if("remove"===t)return(0,s.handleDeviceRemoveNotification)(l,c.ts,a)};var i=n(r(41143)),a=n(r(69618)),s=r(79156),o=r(40626),l=r(49884)},87622:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeSignedKeyIndexBytes=function(e,t){let r,s;try{r=(0,n.decodeProtobuf)(i.ADVSignedKeyIndexListSpec,t)}catch(e){return null}if(!(0,a.verifyKeyIndexListAccountSignature)(r,e))return null;try{s=(0,n.decodeProtobuf)(i.ADVKeyIndexListSpec,r.details)}catch(e){return null}const{timestamp:o,rawId:l,validIndexes:c,currentIndex:d}=s;if(null==o)return null;if(null==l)return null;return{timestamp:o,rawId:l,validIndexes:c,currentIndex:d}};var n=r(84902),i=r(61438),a=r(24863)},80140:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockContact=function(e){return p((0,c.unproxy)(e),!0)},t.unblockContact=function(e){return p((0,c.unproxy)(e),!1)};var i=r(46331),a=r(30312),s=r(32826),o=r(88102),l=n(r(43725)),c=r(31019),d=r(77591),u=r(85893);function p(e,t,r){const{id:n}=e,c=e.isBlocked();if(t&&c||!t&&!c)return Promise.resolve();const h=(0,a.sendSetBlock)(t,n).then((e=>{e&&(t?s.BlocklistCollection.add({id:n}):s.BlocklistCollection.remove(n))}));return function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,i.genId)();const a={participant:e.formattedName},s=r?new i.ActionType(l.default.t(18,a)):new i.ActionType(l.default.t(142,a)),c=t.then((()=>{const t=r?l.default.t(17,a):l.default.t(141,a);return new i.ActionType(t,{actionText:l.default.t(143),actionHandler:()=>p(e,!r,n)})})).catch((t=>{if(!(t instanceof d.ServerStatusCodeError)){__LOG__(3)`action:setBlock dropped`;const t=r?l.default.t(16,a):l.default.t(140,a);throw new i.ActionType(t,{actionText:l.default.t(139),actionHandler:()=>p(e,r,n)})}if(t.statusCode>=400)throw r?new i.ActionType(l.default.t(16,a)):new i.ActionType(l.default.t(140,a))}));o.Cmd.openToast((0,u.jsx)(i.ActionToast,{id:n,initialAction:s,pendingAction:c}))}(e,h,t,r),h}},352:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onIsBusinessChange=function(e){const t=(0,i.unproxy)(e),{businessProfile:a,id:s}=t,o=t.isBusiness||t.isMe&&n.Conn.isSMB;o&&!a?t.addChild("businessProfile",r(93581).BusinessProfileCollection.gadd(s)):!o&&a&&(t.stopListening(a),t.businessProfile=void 0,a.delete())};var n=r(17239),i=r(31019)},43024:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactFindQuery=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(1255),s=n(r(69618)),o=r(7293),l=r(76285),c=n(r(56891));function d(){return(d=(0,i.default)((function*(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const t=performance.now(),n={},i=yield c.default.contactFindQuery(e.retry,(e=>{n.binarySize=e.binarySize}));if("preempted"===i.data)return Promise.reject(new a.CollectionSilentQueryError("contacts preempted"));{n.count=i.data.length,n.timing=Math.ceil(performance.now()-t);const e=r(19380).ContactCollection;return e.trigger(s.default.COLLECTION_HAS_SYNCED,n),(0,l.mungePSAContact)(i.data),i.checksum&&(e.setChecksum(i.checksum),__LOG__(2)`Store:Contact:query update checksum ${i.checksum}`),Promise.resolve(i.data)}}))).apply(this,arguments)}},75888:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(69951),s=r(91036),o=r(19380),l=r(7293),c=r(10435),d=n(r(69722)),u=n(r(72639)),p=n(r(10911));function h(){return(h=(0,i.default)((function*(e){const t=o.ContactCollection.get(e);var r,n;if(null!=t&&(null!=t.name||null!=a.ChatCollection.get(e)))return Promise.resolve({wid:e,biz:t.isBusiness,bizInfo:t.isBusiness?{verifiedName:{level:(0,p.default)(t.verifiedLevel),serial:null,name:t.verifiedName,isApi:Boolean(t.isEnterprise),privacyMode:t.privacyMode}}:null,disappearingMode:(0,c.isDisappearingModeEnabled)()?{duration:null!==(r=t.disappearingModeDuration)&&void 0!==r?r:0,settingTimestamp:null!==(n=t.disappearingModeSettingTimestamp)&&void 0!==n?n:0}:null});const i=yield(0,d.default)(e);if(i){const{biz:r,bizInfo:n,disappearingMode:a}=i;return l.GK.supportsFeature(l.GK.F.QUERY_VNAME)&&r&&(0,u.default)(e,n),(0,c.isDisappearingModeEnabled)()&&a&&null!=t&&(0,s.updateDisappearingMode)(e,a.duration,a.settingTimestamp),i}return Promise.reject(new Error("Invalid number"))}))).apply(this,arguments)}},84765:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryIdentity=function(e){const t=(0,a.unproxy)(e),{verificationBinary:r,verificationString:n,id:l}=t;if(r&&n)return Promise.resolve();if(t.promises.queryIdentity)return t.promises.queryIdentity;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));t.promises.queryIdentity=s.default.queryIdentity(l).then((t=>{o(e,t)})).catch((e=>{__LOG__(3)`models:contact:queryIdentity error: ${String(e)}`})).finally((()=>{t.promises.queryIdentity=null}))},t.updateIdentity=o;var i=r(7293),a=r(31019),s=n(r(56891));function o(e,t){const r=(0,a.unproxy)(e);null!=t.status&&t.status>=400?(r.unset("verificationBinary"),r.unset("verificationString")):(r.verificationBinary=t.binary,r.verificationString=t.string)}},1291:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDeviceRecordForIdentityChange=m,t.handleNewIdentity=function(){return _.apply(this,arguments)},t.handleSelfPrimaryIdentityChange=function(){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){__LOG__(4,void 0,new Error,!0)`handleNewIdentity: ignore identity change for your own primary device`,SEND_LOGS("self-identity-change");const e=r(65044).Socket,t=r(83578).LogoutReason;e.logout(!1,t.PrimaryIdentityKeyChange)}};var i=n(r(48926)),a=r(19797),s=n(r(69618)),o=r(66308),l=r(9108),c=n(r(69153)),d=r(7293),u=r(99069),p=r(58928),h=r(84356),f=r(58021);function _(){return(_=(0,i.default)((function*(e){var t;if(!d.GK.supportsFeature(d.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in MD mode"));const n=Promise.resolve(),i=window.libsignal.SignalProtocolAddress.fromString(e).getName(),l=(0,f.createWid)((0,a.toUserJid)(i)),c=null!==(t=l.device)&&void 0!==t?t:s.default.DEVICE.PRIMARY_DEVICE,u=(0,f.toUserWid)(l);if(c===s.default.DEVICE.PRIMARY_DEVICE){h.Voip.notifyDeviceIdentityChangedOrDeleted(l,!0);const e=r(9701).addSecurityCodeChangedNotifications;yield m(u),yield e(u)}else yield(0,o.createAndStoreDeviceNotifications)(u,[c],[c]);return n}))).apply(this,arguments)}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!d.GK.supportsFeature(d.GK.F.MD_BACKEND))return Promise.reject(new Error("clearDeviceRecordForIdentityChange: This call is only supported in MD mode"));const n=[s.default.DEVICE.PRIMARY_DEVICE],i=[s.default.DEVICE.PRIMARY_DEVICE];if(t)c.default.addOfflinePendingDevice(String(e),null),yield(0,u.getStorage)().lock(["participant"],(()=>(0,p.updateGroupParticipantsInTransaction)(e,i,n)));else{const t=yield(0,l.getDeviceRecord)(e.user);t&&!t.deleted&&t.devices.forEach((e=>{e.id!==s.default.DEVICE.PRIMARY_DEVICE&&n.push(e.id)}));const a=r(77605).Session;Promise.all(n.map((t=>t===s.default.DEVICE.PRIMARY_DEVICE?Promise.resolve():a.deleteRemoteInfo((0,f.createDeviceWidFromUserAndDevice)(e.user,t))))),yield Promise.all([(0,u.getStorage)().lock(["participant"],(()=>(0,p.updateGroupParticipantsInTransaction)(e,i,n))),(0,l.createOrReplaceDeviceRecord)({id:e.user,deleted:!0})])}}))).apply(this,arguments)}},3879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLiveLocation=function(e,t){const r=(0,n.unproxy)(e);r.liveLocations||(r.liveLocations=[]);const{liveLocations:i}=r;i.push(t)},t.removeLiveLocation=function(e,t){const r=(0,n.unproxy)(e),{liveLocations:i}=r;if(!i)return;for(let e=i.length-1;e>=0;e--)if(i[e]===t){i.splice(e,1);break}0===i.length&&(r.liveLocations=null)};var n=r(31019)},16150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updatePushname=function(e,t){const r=(0,s.toUserWid)(e);return o.enqueue((()=>{(0,i.getBridge)().sendAndReceive("contact_collection","updatePushname",{contactId:r,pushname:t}).then((e=>{if(e||void 0===e)return __LOG__(2)`updatePushName: set pushname for ${String(r)}`,(0,a.updateLocal)(r,{pushname:t})}))}))};var n=r(27870),i=r(41796),a=r(27211),s=r(58021);const o=new n.PromiseQueue},32613:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resyncContacts=function(e){void 0!==i.ContactCollection.checksum&&void 0!==e&&(i.ContactCollection.checksum!==e?i.ContactCollection.findQuery({retry:!0}).then((e=>{if(Array.isArray(e)){(0,l.mungePSAContact)(e),__LOG__(2)`Store:Contact:resync success`;const t=(0,o.getContactsToRemove)(e);let r=Promise.resolve();if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)&&t.length){const e=t.map((e=>e.id.toString()));r=(0,s.getContactTable)().bulkRemove(e).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from contact table failed`,SEND_LOGS("bulkRemove from contact table failed when resyncing contacts"),new Error("bulkRemove from contact table failed")}))}r.then((()=>{t.forEach((e=>{e.unset("name"),e.unset("shortName")}))}))}else __LOG__(3)`Store:Contact.resync error ${JSON.stringify(e)}`})).catch((0,n.filteredCatch)(c.WebdDrop,(()=>{}))):__LOG__(2)`Store:Contact:resync checksum match`)};var n=r(50796),i=r(19380),a=r(7293),s=r(76214),o=r(88129),l=r(76285),c=r(77591)},9701:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSecurityCodeChangedNotifications=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(90257),s=r(99234),o=r(7293),l=r(41796),c=r(76214),d=n(r(29783)),u=r(90641),p=r(58021);function h(){return(h=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const{notifications:r,chatIds:n}=yield f(e);if(0===r.length)return;if(!t){Promise.all(r.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,l.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})));const e=yield(0,u.encryptMultipleMsgs)(r);return(0,u.storeEncryptedMessage)(e,n,!1)}d.default.addOfflineMessage(r.map((e=>({msg:e}))))}}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t={notifications:[],chatIds:[]};if(!(0,s.getGlobalSecurityNotifications)())return t;let r=[];try{const t=yield(0,c.getChatTable)().get(String(e));r=(yield(0,c.getParticipantTable)().equals(["participants"],String(e))).map((e=>(0,p.createWid)(e.groupId))),t&&r.push((0,p.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chats failed")}const n=r.map((t=>(0,a.genSecurityCodeNotificationMsg)(t,e)));return t.notifications=n,t.chatIds=r.map(String),t}))).apply(this,arguments)}},76285:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mungePSAContact=function(e){if(Array.isArray(e)){const t=e.findIndex((e=>e&&a.default.isPSA(e.id))),r=e[t];t>-1&&r&&(r.name=i.default.t(1922),r.shortName=i.default.t(1922))}};var i=n(r(43725)),a=n(r(39546))},56489:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return S(e,t,r,n,void 0,i)},t.sendForNeededAddRequest=v;var i=n(r(81109)),a=r(50796),s=n(r(48360)),o=r(46331),l=r(88102),c=r(19380),d=r(79583),u=r(50101),p=r(7293),h=n(r(43725)),f=r(3764),_=r(82039),m=r(15860),g=r(77591),y=r(58021),E=r(85893);function S(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,o.genId)(),c=arguments.length>5?arguments[5]:void 0;const p=n.map((e=>e.id)),y=void 0,T=(0,d.sendCreateGroup)(e,p,y,(0,m.newTag)(),!1,!1,c),A=new o.ActionType(h.default.t(61)),C=T.then((t=>(v(t,e,y),new o.ActionType(h.default.t(60))))).catch((0,a.filteredCatch)(g.ServerStatusCodeError,(e=>406===e.status?new o.ActionType(h.default.t(57)+" "+h.default.t(58)):429===e.status?new o.ActionType(h.default.t(57)+" "+s.default._("You've created too many groups too quickly. Try again later.",null,{hk:"2fN2Us"}).toString()):void 0))).catch((()=>(__LOG__(3)`models:chatCollection:createGroup dropped`,new o.ActionType(h.default.t(57),{actionText:h.default.t(139),actionHandler:()=>S(e,t,r,n,i,c)}))));return l.Cmd.openToast((0,E.jsx)(o.ActionToast,{id:i,initialAction:A,pendingAction:C})),T.then((e=>{if(e.gid&&(0,u.findChat)(e.gid).then((e=>{l.Cmd.openChatBottom(e).then((t=>{t&&l.Cmd.focusChatTextInput(e)}))})),!e._duplicate&&t&&r){const n=_.ProfilePicThumbCollection.gadd(e.gid);return(0,f.setProfilePic)(n,t,r)}e._duplicate&&__LOG__(3)`createGroup failed to set picture.`})).catch((0,a.filteredCatch)(g.ServerStatusCodeError,(()=>{})))}function v(e,t,r,n){if(!p.GK.supportsFeature(p.GK.F.GROUPS_V_4_JOIN_PERMISSION))return;if(!e.participants)return;const a=n||e.gid;a||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Group add request was provided with undefined gid"));const s=e.participants.reduce(((e,t)=>{const r=Object.keys(t)[0];if("403"!==t[r].code)return e;const n=(0,y.createWid)(r),a=c.ContactCollection.gadd(n,{silent:!0});return[...e,(0,i.default)((0,i.default)({},t[r]),{},{contact:a})]}),[]);s.length>0&&a&&l.Cmd.openGroupV4InviteRequestFlow(s,a,t,r)}},5501:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.localExitGroup=m,t.sendExitGroup=function(e){return _((0,p.unproxy)(e))};var a=r(50796),s=r(46331),o=r(88102),l=i(r(64103)),c=r(90447),d=r(99234),u=n(r(43725)),p=r(31019),h=r(77591),f=r(85893);function _(e){const{isGroup:t,promises:r}=e;if(!t)return Promise.reject(new l.ActionError);if(r.sendExit)return r.sendExit;const n=r.sendExit=(0,c.sendExitGroup)(e.id),i=new s.ActionType(u.default.t(67)),d=n.then((function(){return new s.ActionType(u.default.t(66))})).catch((0,a.filteredCatch)(h.ServerStatusCodeError,(e=>{if(e.status>=400)return new s.ActionType(u.default.t(65))}))).catch((function(){return __LOG__(3)`actions:chat:sendExit dropped`,new s.ActionType(u.default.t(65),{actionText:u.default.t(139),actionHandler:()=>_(e)})}));return o.Cmd.openToast((0,f.jsx)(s.ActionToast,{id:(0,s.genId)(),initialAction:i,pendingAction:d})),n.then((t=>{t._duplicate||m(e)})).finally((()=>{r.sendExit=null})).catch((0,a.filteredCatch)(h.ServerStatusCodeError,(()=>{})))}function m(e){var t;e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.participants.remove((0,d.getMaybeMeUser)()),(0,c.markExited)(e.id).then((()=>{e.isReadOnly=!0})).catch((e=>{throw __LOG__(4,!0,new Error,!0)`failed to merge chat table`,SEND_LOGS("failed to merge chat table when exiting group: "+e),new Error("failed to merge chat table")})))}},36098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_ACTIONS=void 0;const r=Object.freeze({SUBJECT:"subject",ADD:"add",PROMOTE:"promote",DEMOTE:"demote",REMOVE:"remove",MODIFY:"modify",INVITE_CODE:"invite",DESC_ADD:"desc_add",DESC_REMOVE:"desc_remove",RESTRICT:"restrict",ANNOUNCE:"announce",NO_FORWARD:"no_frequently_forwarded",EPHEMERAL:"ephemeral",REVOKE_INVITE:"revoke_invite",SUSPEND:"suspend",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked"});t.GROUP_ACTIONS=r},42952:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupAction=function(e,t,r){return function(e,t,r){const n=(0,i.default)(e.groupMetadata,"chat.groupMetadata"),{action:l}=r;switch(r.action){case s.GROUP_ACTIONS.SUBJECT:const i={name:r.subject};e.contact.set(i);break;case s.GROUP_ACTIONS.ADD:case s.GROUP_ACTIONS.PROMOTE:case s.GROUP_ACTIONS.DEMOTE:const c=r.participants.map((e=>({id:e,isAdmin:"promote"===l})));n.participants.add(c,{merge:!0}),"add"===l&&(r.participants.forEach((t=>{o.default.trigger(`group_participant_change_${t.toString()}`,e.id)})),t&&!a.ContactCollection.get(t)&&n.set({notAddedByContact:!0,addedBy:t}));break;case s.GROUP_ACTIONS.REMOVE:r.participants.forEach((e=>{n.participants.remove(e)})),r.participants.forEach((t=>{o.default.trigger(`group_participant_change_${t.toString()}`,e.id)}));break;case s.GROUP_ACTIONS.MODIFY:if(t&&r.participants&&r.participants.length>0){const e=r.participants[0],i=n.participants.remove(t);let a=!1,s=!1;i.length&&i[0]&&(a=i[0].isAdmin,s=i[0].isSuperAdmin);const o={id:e,isAdmin:a,isSuperAdmin:s};n.participants.add(o)}break;case s.GROUP_ACTIONS.INVITE_CODE:r.code?n.inviteCode=r.code:__LOG__(3)`model:chat:handleGroupAction:invalid invite code: ${r.code} for ${e.id.toString()}`;break;case s.GROUP_ACTIONS.DESC_ADD:n.set({desc:r.desc,descId:r.descId,descTime:r.descTime,descOwner:null==t?void 0:t.toString()});break;case s.GROUP_ACTIONS.DESC_REMOVE:if(n.descId===r.descId){n.set({desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0});break}break;case s.GROUP_ACTIONS.RESTRICT:n.restrict=!!r.value;break;case s.GROUP_ACTIONS.SUSPEND:n.suspended=!!r.value;break;case s.GROUP_ACTIONS.ANNOUNCE:n.announce=!!r.value;break;case s.GROUP_ACTIONS.NO_FORWARD:n.noFrequentlyForwarded=!!r.value;break;case s.GROUP_ACTIONS.EPHEMERAL:n.ephemeralDuration=r.duration;break;case s.GROUP_ACTIONS.REVOKE_INVITE:break;case s.GROUP_ACTIONS.GROWTH_UNLOCKED:n.growthLockExpiration=void 0,n.growthLockType=void 0;break;case s.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===r.type&&(n.growthLockExpiration=r.expiration,n.growthLockType=r.type);break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupAction`}return Promise.resolve()}((0,l.unproxy)(e),t,r)};var i=n(r(45095)),a=r(19380),s=r(36098),o=n(r(63928)),l=r(31019)},34648:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupActionMD=function(e,t,r){if(h.GK.supportsFeature(h.GK.F.MD_BACKEND))return function(){return I.apply(this,arguments)}(e,t,r);return Promise.reject(new Error("handleGroupActionMD: only supported on MD"))},t.handleGroupActionWap=function(e,t){const{chatId:n,author:i}=e,a=r(69951).ChatCollection.get(n);if(!a)return void __LOG__(3)`model:chat: unknown chat for ${n.toString()}, action ${JSON.stringify(t)}`;(0,y.handleGroupAction)(a,i,t)},t.handleGroupCreation=function(e,t,r){if(h.GK.supportsFeature(h.GK.F.MD_BACKEND))return function(){return M.apply(this,arguments)}(e,t,r);return Promise.reject(new Error("handleGroupCreation: should not be called in wap mode"))};var i=n(r(48926)),a=r(50796),s=n(r(45095)),o=r(19380),l=r(91829),c=r(57062),d=r(76581),u=r(99234),p=r(9025),h=r(7293),f=r(57701),_=r(62415),m=r(90101),g=r(36098),y=r(42952),E=r(84886),S=n(r(11339)),v=r(59871),T=r(70405),A=r(80474),C=r(16150),b=r(10790),P=r(92188);function M(){return(M=(0,i.default)((function*(e,t,r){var n,i,a;__LOG__(2,void 0,void 0,void 0,["groups"])`inside handleGroupCreationMD`;const{chatId:s,author:d,pushname:h}=e;null!=e.author&&e.author.equals((0,u.getMaybeMeUser)())||new S.default.GroupJoinC({}).commit(),d&&h&&(0,C.updatePushname)(d,h),yield Promise.all([(0,A.updateParticipantsJob)(t.id,t.participants,t.pvId,r),(0,c.updateGroupMetadataTableJob)([t])]),__LOG__(2,void 0,void 0,void 0,["groups"])`updated GroupMetadata and participants tables`;let _=yield(0,p.getExisting)(s);if(_){var m;(0,b.updateSubject)(s,t.subject),null===(m=_.groupMetadata)||void 0===m||m.set(t)}else{var g;_=yield(0,l.create)(s,{t:t.creation,pendingInitialLoading:!1,createdLocally:!1}),null===(g=_.groupMetadata)||void 0===g||g.set(t),__LOG__(2,void 0,void 0,void 0,["groups"])`updated chat model and table`;o.ContactCollection.gadd(t.id).set({name:t.subject}),__LOG__(2,void 0,void 0,void 0,["groups"])`updated contact name`}const y=(null!==(n=null===(i=_.groupMetadata)||void 0===i?void 0:i.participants)&&void 0!==n?n:[]).length,E=null===(a=_.groupMetadata)||void 0===a?void 0:a.announce;!r&&!E&&y&&(0,f.sendKeyDistributionMsgToNewGroups)()&&y>=(0,f.sendKeyDistributionMsgMinGroupSize)()&&(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message`,(0,P.sendKeyDistributionMsg)(_).then((()=>{__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message: done`})).catch((e=>{__LOG__(3,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message failed: ${e}`})))}))).apply(this,arguments)}function O(e,t){return t?(0,c.markGroupAsDirtyJob)(e):(0,b.sendQueryGroup)(e)}function I(){return(I=(0,i.default)((function*(e,t,n){var i,l,p;__LOG__(2,void 0,void 0,void 0,["groups"])`inside _handleGroupActionMD`;const{chatId:h,author:f,pushname:S}=e;f&&S&&(0,C.updatePushname)(f,S);const b=[],P=r(69951).ChatCollection.get(h);switch(t.action){case g.GROUP_ACTIONS.ADD:f&&!o.ContactCollection.get(f)&&b.push((0,m.persistGroupMetadata)(h,{notAddedByContact:!0,addedBy:f.toString()})),b.push((0,A.addParticipantsJob)(h,t.participants,t.version,t.prevVersion,n).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`addParticipants: out-of-sync group notification`,O(h,n)}))));break;case g.GROUP_ACTIONS.REMOVE:b.push((0,A.removeParticipantsJob)(h,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(h,n)}))));const e=(0,u.getMaybeMeUser)();e&&t.participants.find((t=>t.equals(e)))&&(0,u.removeUserSentMessageToChat)(h);break;case g.GROUP_ACTIONS.DEMOTE:b.push((0,A.demoteParticipantsJob)(h,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(h,n)}))));break;case g.GROUP_ACTIONS.PROMOTE:b.push((0,A.promoteParticipantsJob)(h,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(h,n)}))));break;case g.GROUP_ACTIONS.REVOKE_INVITE:const r=null===(i=(0,u.getMaybeMeUser)())||void 0===i?void 0:i.toString();if(!r)return void __LOG__(3)`getMaybeMeUser returned null, can't process action ${t}`;const y=null==f?void 0:f.toString();let S=[];if(null==y)return void __LOG__(3)`Received revoke without an admin jid ${t}`;if(y===r)S=t.participants.map((e=>({from:r,to:e.id.toString(),groupId:h.toString(),expiration:e.expiration})));else{const e=t.participants.find((e=>e.id.toString()===r));if(!e)return __LOG__(4,void 0,new Error,!0)`Received group invite revokation from ${y}, but user not in participants list`,void SEND_LOGS("bad-revoke");S=[{from:y,to:r,groupId:h.toString(),expiration:e.expiration}]}const C=yield Promise.all(S.map((e=>(0,_.revokeGroupInvites)(e.from,e.to,e.groupId,e.expiration)))),P=[];C.flat().map((e=>{(null==e?void 0:e.id)&&P.push(e.id)})),(yield(0,d.msgFindByIds)(P)).map((e=>{var t;null===(t=v.MsgCollection.get(e.id))||void 0===t||t.set({inviteCodeExp:"0"}),e.inviteCodeExp="0",(0,E.updateExistingMessages)([e],e.id.remote)}));break;case g.GROUP_ACTIONS.MODIFY:if(1!==t.participants.length){__LOG__(3)`_handleGroupActionMD: participants length should be 1, but is ${t.participants.length}`;break}b.push((0,c.modifyGroupParticipantJob)(h,(0,s.default)(f,"author"),t.participants[0],null!==(l=t.prevVersion)&&void 0!==l?l:-1,null!==(p=t.version)&&void 0!==p?p:-1));break;case g.GROUP_ACTIONS.SUBJECT:b.push((0,m.persistGroupMetadata)(h,{subject:t.subject}));break;case g.GROUP_ACTIONS.DESC_ADD:b.push((0,m.persistGroupMetadata)(h,{desc:t.desc,descId:t.descId,descTime:t.descTime,descOwner:null==f?void 0:f.toString()}));break;case g.GROUP_ACTIONS.DESC_REMOVE:b.push((0,m.persistGroupMetadata)(h,{desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0}));break;case g.GROUP_ACTIONS.RESTRICT:b.push((0,m.persistGroupMetadata)(h,{restrict:!!t.value}));break;case g.GROUP_ACTIONS.SUSPEND:b.push((0,m.persistGroupMetadata)(h,{suspended:!!t.value}));break;case g.GROUP_ACTIONS.ANNOUNCE:b.push((0,m.persistGroupMetadata)(h,{announce:!!t.value}));break;case g.GROUP_ACTIONS.NO_FORWARD:b.push((0,m.persistGroupMetadata)(h,{noFrequentlyForwarded:!!t.value}));break;case g.GROUP_ACTIONS.EPHEMERAL:b.push((0,m.persistGroupMetadata)(h,{ephemeralDuration:t.duration}));break;case g.GROUP_ACTIONS.INVITE_CODE:break;case g.GROUP_ACTIONS.GROWTH_UNLOCKED:b.push((0,m.persistGroupMetadata)(h,{growthLockExpiration:void 0,growthLockType:void 0}));break;case g.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===t.type&&b.push((0,m.persistGroupMetadata)(h,{growthLockExpiration:t.expiration,growthLockType:t.type}));break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupActionMD for action ${JSON.stringify(t)}`}yield Promise.all(b),__LOG__(2,void 0,void 0,void 0,["groups"])`finished all storageTasks`,P&&(0,y.handleGroupAction)(P,f,t)}))).apply(this,arguments)}},48537:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(e,t,r,n){return(0,l.sendJoinGroupViaInviteV4)(e,t,r,n)},t.queryGroupInviteV4Info=function(){return d.apply(this,arguments)},t.revokeGroupInviteV4=function(e,t){return(0,l.sendRevokeGroupInviteV4)(e,t)};var i=n(r(48926)),a=r(69951),s=r(19380),o=r(53686),l=r(64808),c=r(58021);function d(){return(d=(0,i.default)((function*(e,t,n,i){let d=null;const u=r(63928).default.get(n);return u&&(d=yield(0,o.phashV1)(u.participants.map((e=>e.id)))),(0,l.sendQueryGroupInviteV4)(e,t,n,i,d).then((e=>{if(null!=e.status&&e.status>0)return e;if(null!=e.id)return s.ContactCollection.gadd(e.id),e;{const e=r(63928).default.assertGet((0,c.createWidFromWidLike)(n)),t=a.ChatCollection.assertGet(e.id).contact.name;return{id:e.id,owner:e.owner,creation:e.creation,desc:e.desc,descId:e.descId,descOwner:e.descOwner,descTime:e.descTime,restrict:e.restrict,announce:e.announce,ephemeralDuration:e.ephemeralDuration,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,noFrequentlyForwarded:e.noFrequentlyForwarded,subject:t,participants:e.participants.map((e=>({id:e.id,isAdmin:e.isAdmin,isSuperAdmin:e.isSuperAdmin})))}}}))}))).apply(this,arguments)}},96269:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupFromPhone=function(){return u.apply(this,arguments)},t.queryGroupInviteInfo=function(){return p.apply(this,arguments)};var i=n(r(6479)),a=n(r(48926)),s=n(r(81629)),o=r(19380),l=n(r(14423)),c=r(10790);const d=["status","subject"];function u(){return(u=(0,a.default)((function*(e){const t=yield(0,c.groupMetadataFindFromPhone)(e);return"ok"===t.status?t.data:"missing"!==t.status?"error"===t.status?(__LOG__(3)`model:GroupMetadata:find error ${t.info}`,Promise.reject(new Error("model:GroupMetadata:find error"))):void 0:void(0,s.default)((()=>{r(69951).ChatCollection.assertGet(e).delete()}))}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){const t=yield(0,c.sendQueryGroupInvite)(e),{status:n,subject:a}=t,s=(0,i.default)(t,d),u=new l.default(s);o.ContactCollection.gadd(u.id);const p=r(69951).ChatCollection.get(u.id);return{status:n,subject:a,groupMetadata:u,inGroup:!!p&&!p.isReadOnly}}))).apply(this,arguments)}},74028:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndUpdateAllGroupMetadata=function(){return m.apply(this,arguments)},t.queryAndUpdateGroupMetadataById=function(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return(0,_.queryGroupJob)(e).then(function(){var e=(0,i.default)((function*(e){yield(0,s.updateGroupParticipantTableWithoutDeviceSyncJob)([e]),E(e)}));return function(){return e.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(48926)),a=r(22683),s=r(57062),o=r(7293),l=r(37654),c=n(r(63928)),d=r(50313),u=r(5819),p=r(53686),h=r(85057),f=r(10790),_=r(61051);function m(){return(m=(0,i.default)((function*(){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const e=yield(0,h.queryAllGroups)();if(!e)return;e.forEach((e=>{E(e),g(e)})),yield(0,s.updateGroupMetadataTableJob)(e),yield(0,s.updateGroupParticipantTableWithoutDeviceSyncJob)(e)}return Promise.resolve()}))).apply(this,arguments)}function g(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const t=(0,d.getInitialGroupPhash)(e.id.toString()),r=yield(0,p.phashV1)(e.participants.map((e=>e.id))),n=r.substring(2);t!==r&&t!==n&&(0,u.handleSingleMsgMD)(e.id,(0,l.genIntialPhashMismatchMsg)(e.id,a.Clock.globalUnixTime()))}))).apply(this,arguments)}function E(e){var t,r,n;(0,f.updateSubject)(e.id,e.subject),c.default.gadd({id:e.id,owner:e.owner,creation:e.creation,desc:e.desc,descId:e.descId,descOwner:e.descOwner,descTime:e.descTime,restrict:e.restrict||!1,announce:e.announce||!1,noFrequentlyForwarded:e.noFrequentlyForwarded||!1,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,participants:e.participants,support:null!==(t=e.support)&&void 0!==t&&t,suspended:null!==(r=e.suspended)&&void 0!==r&&r,isParentGroup:null!==(n=e.parent)&&void 0!==n&&n,parentGroup:e.parentGroup})}},54248:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(0,a.getMaybeMeUser)().equals(e.id)){const r=s.PresenceCollection.get(e.id);r&&("unsubscribe"===e.type?r.set({isSubscribed:!1,stale:!0}):(o(r,e),t&&r.set({stale:!1})))}return Promise.resolve()};var i=n(r(69618)),a=r(99234),s=r(68315);function o(e,t){let r,n=!1;if(void 0===t.type?t.type=e.chatstate.type||"unavailable":"paused"===t.type&&(n=!0,t.type="available"),e.isGroup&&"available"!==t.type&&(t.updateTime=Date.now()),e.isGroup){if(!t.participant)return;t.id=t.participant,t.participant=void 0,r=e.chatstates.gadd(t.id)}else r=e.chatstate;n&&"composing"!==r.type&&"recording"!==r.type||r.set(t),r.expireTimerId&&clearTimeout(r.expireTimerId),"composing"===r.type||"recording"===r.type?r.expireTimerId=setTimeout((()=>function(e){const t=e.type;"composing"!==t&&"recording"!==t||(e.type="available")}(r)),i.default.PRESENCE_COMPOSING_TIMEOUT):r.expireTimerId=void 0;const a=e.forceDisplay||e.isOnline||e.isUser&&!e.chatstate.deny;e.set({hasData:!0,isSubscribed:!0,forceDisplay:a})}},37638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeProfilePicThumb=function(e,t){return n.ProfilePicThumbCollection.imageChanged(e,t),Promise.resolve()};var n=r(82039)},78027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.processOrphanAck=function(){return g.apply(this,arguments)},t.updateMsgAck=_;var i=n(r(48926)),a=r(25680),s=n(r(69618)),o=r(7293),l=r(41796),c=r(39354),d=r(59871),u=r(64551),p=n(r(83147)),h=n(r(39546)),f=r(58021);function _(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,r){const{ack:n,t:i,from:a,to:d}=r,{remote:_,id:m}=e.id;if(e.updateAck(n,i),o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const{deliveryPrivacyMode:t}=r;u.ServerProps.bspSystemMessageEnabled&&n===s.default.ACK.RECEIVED&&null!=t&&e.isSentByMe&&(yield(0,c.handlePrivacyModeTransition)(_,t).catch((()=>{__LOG__(4,void 0,new Error,!0)`msg ack: handlePrivacyModeTransition failed`,SEND_LOGS("msg ack: handlePrivacyModeTransition failed")})),yield(0,p.default)(e,t))}const g=(0,l.getBridge)();if(yield g.sendAndReceive("msg_collection","updateLastReceipt",{wid:_,t:i}),h.default.isUser(_)){if(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:m,from:a,to:d,ack:n,participant:_,t:i}),t&&h.default.isBroadcast(t)){const e=t instanceof h.default?t:(0,f.createWid)(t);yield g.sendAndReceive("msg_info_collection","updateInfo",{id:m,from:a,to:e,ack:n,participant:_,t:i})}}else h.default.isStatusV3(_)&&(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:m,from:a,to:_,ack:n,participant:d,t:i}))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const r=d.MsgCollection.get(e);if(!r)return Promise.reject(new Error(`processOrphanAck: no msg found for id ${e.toString()}`));try{const e=yield(0,a.getHighestAck)(r);if(!e||e.ack===r.ack)return;return _(r,t,e)}catch(e){__LOG__(4,void 0,new Error)`Assertion failed: processOrphanAck failed!`}}))).apply(this,arguments)}},8765:(e,t,r)=>{"use strict";var n=r(95318);t.o0=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),s=r(92844),o=r(84902),l=n(r(69618)),c=r(24808),d=r(99234),u=r(57701),p=r(49714),h=r(45033),f=r(76332),_=r(99069),m=r(93832),g=r(12896),y=n(r(39546));function E(e){let t;const r=e.id.remote,n={externalId:e.id.id,ts:(0,s.castToUnixTime)(e.t),edit:-1,isHsm:!1,count:null,chat:r,pushname:null};var i;y.default.isGroup(r)?t=(0,a.default)((0,a.default)({},n),{},{type:p.MESSAGE_TYPE.GROUP,author:null!==(i=e.author)&&void 0!==i?i:(0,d.getMeUser)(),isDirect:!1}):t=(0,a.default)((0,a.default)({},n),{},{author:e.from,type:p.MESSAGE_TYPE.CHAT});return{msgInfo:t,e2eInfoType:h.CiphertextType.Msg,paymentInfo:null,bizInfo:{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null}}}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){try{const t=(0,g.hydrateMessage)(e),n=t.id.remote;if(!(0,u.receiveReactionsEnabled)())return null;if(!y.default.isGroup(n)&&!y.default.isUser(n))return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: Reaction FutureProof msg.chat is an unexpected type`,null;const{msgInfo:i,e2eInfoType:a,paymentInfo:s,bizInfo:d}=E(t);if(null==t.futureproofBuffer)return null;const p=(0,m.unpad)(t.futureproofBuffer),h=(0,o.decodeProtobuf)(c.MessageSpec,p),f=r(27286).parseMessage,_=yield f(i,a,h,s,d,t.futureproofBuffer);if(null==_.renderableMsgs||null==_.renderableMsgs[0]||_.renderableMsgs[0].type!==l.default.MSG_TYPE.REACTION)return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: unexpected renderableMsgs`,null;const S=r(53348).createReactionsRow;return yield S(_.renderableMsgs[0],i)}catch(e){return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: reparse error`,null}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){try{let t=[];const n=e.filter((e=>e.type===l.default.MSG_TYPE.UNKNOWN&&e.subtype===l.default.MSG_TYPE.REACTION)),a=(yield Promise.all(n.map((e=>S(e))))).filter(Boolean);if(0===a.length)return;const s=a.map((e=>e.msgKey));yield(0,_.getStorage)().lock(["message","reactions"],function(){var e=(0,i.default)((function*(e){let[r,n]=e;t=yield(0,f.addOrUpdateReactionsDBBulk)(a),yield r.bulkRemove(s)}));return function(){return e.apply(this,arguments)}}()),t.forEach((e=>{(0,f.addOrUpdateReactionsModelCollection)(e,!1)})),s.forEach((e=>{const t=r(59871).MsgCollection.get(e);null==t||t.delete()}))}catch(e){__LOG__(4,void 0,new Error)`reparseReactionFutureProof: storeReactionsAndDeleteFP error`}}))).apply(this,arguments)}},39354:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePrivacyModeTransition=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(69618)),s=n(r(9762)),o=r(64551),l=r(68708);function c(){return(c=(0,i.default)((function*(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.isUserNotPSA())return;let c=n;if(null==c){const t=r(9025).getExisting;c=yield t(e)}if(null==c)return;const d=c.contact;if(null!=d.privacyMode&&d.privacyMode.privacyModeTs>=t.privacyModeTs)return;const u={verifiedName:d.verifiedName,isVerifiedHigh:d.verifiedLevel===a.default.VERIFIED_LEVEL.HIGH,isBusiness:d.isBusiness,isEnterprise:d.isEnterprise,privacyMode:d.privacyMode},p={verifiedName:d.verifiedName,isVerifiedHigh:d.verifiedLevel===a.default.VERIFIED_LEVEL.HIGH,isBusiness:!0,isEnterprise:!0,privacyMode:t};d.set({isBusiness:!0,isEnterprise:!0,privacyMode:t}),yield Promise.all([i?null:(0,l.createOrUpdateVerifiedBusinessName)({id:d.id.user,isApi:!0,privacyMode:o.ServerProps.bspSystemMessageEnabled?{actualActors:t.actualActors,hostStorage:t.hostStorage,privacyModeTs:t.privacyModeTs}:null},l.VerifiedBusinessNameUpdateType.Merge),(0,s.default)(d.id,u,p)])}))).apply(this,arguments)}},35288:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeHandlerAction=void 0;const n=r(54302).Mirrored(["DropMessage","SkipUI"]);t.ActiveRangeHandlerAction=n},91525:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ActiveRangeHandlerAction",{enumerable:!0,get:function(){return p.ActiveRangeHandlerAction}}),Object.defineProperty(t,"RangeContain",{enumerable:!0,get:function(){return c.RangeContain}}),t.handleForActiveMessageRange=A,t.handleOfflineForMessageRange=function(){return b.apply(this,arguments)};var a=i(r(48926)),s=r(84902),o=r(69702),l=r(38342),c=r(87845),d=i(r(69618)),u=i(r(73407)),p=r(35288),h=n(r(13332)),f=r(22701),_=r(93824),m=r(58021);const g=new Set,y=e=>e.reduce(((e,t)=>new Set([...e,...t])),new Set);function E(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,r){let n=null;switch(e.action){case o.ActiveRangeAction.Archive:return e.actionValue.archived?yield h.handleForArchive(e,r):yield h.handleForUnarchive(e,r),g;case o.ActiveRangeAction.MarkChatAsRead:return yield h.handleForMarkAsReadUnread(e,r,!!e.actionValue.read),g;case o.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case o.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return n=h.handleForClearChat(e,r),n?new Set([n]):g;case o.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case o.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return(yield v(t.id))?g:(n=h.handleForClearChat(e,r),n?new Set([n]):g);case o.ActiveRangeAction.DeleteChatDeleteMedia:case o.ActiveRangeAction.DeleteChatKeepMedia:return n=h.handleForDeleteChat(e,r),n?new Set([n]):g}return __LOG__(3)`handleMessageContainment called with unknwon message range action action: ${e.action}`,g}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e){const t=(0,_.constructStarMsgKeyFromMsgKey)(e),r=yield u.default.getSyncAction(t);if(r){var n;return(null===(n=(0,s.decodeProtobuf)(f.SyncActionValueSpec,r.binarySyncAction).starAction)||void 0===n?void 0:n.starred)||!1}return!1}))).apply(this,arguments)}function A(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e,t){if(d.default.SYSTEM_MESSAGE_TYPES.includes(t.type))return g;const r=(yield(0,l.getActiveMessageRanges)(e.toString())).map((e=>[e,(0,c.rangeContainsMessage)(e.actionValue.messageRange,t)])),n=r.filter((e=>{let[,t]=e;return t===c.RangeContain.CONTAINS_BY_ADDITIONAL})).map((e=>{let[t]=e;return t}));n.forEach((e=>{e.remainingMessages--})),yield(0,l.bulkUpdateActiveMessageRanges)(n);const i=r.map((e=>{let[r,n]=e;return E(r,t,n)})),a=yield Promise.all(i);return y(a)}))).apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e){const t=new Map;e.forEach((e=>{if(d.default.SYSTEM_MESSAGE_TYPES.includes(e.type))return;const r=t.get(e.id.remote.toString());(null==r||r.t<e.t)&&t.set(e.id.remote.toString(),e)})),yield Promise.all([...t.entries()].map((e=>{let[t,r]=e;return A((0,m.createWid)(t),r)})))}))).apply(this,arguments)}},13332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleForArchive=function(){return u.apply(this,arguments)},t.handleForClearChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return o.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForDeleteChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return o.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForMarkAsReadUnread=function(){return h.apply(this,arguments)},t.handleForUnarchive=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(38342),s=r(87845),o=r(35288),l=r(57701),c=n(r(68132)),d=r(58021);function u(){return(u=(0,i.default)((function*(e,t){if(t===s.RangeContain.DOES_NOT_CONTAIN){const t=r(74362).default;(0,l.archiveV2Supported)()&&c.default.showArchiveV2||t.setArchive([{id:e.chatId,archive:!1}]),yield(0,a.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){t!==s.RangeContain.DOES_NOT_CONTAIN&&0!==e.remainingMessages||(yield(0,a.removeActiveMessageRange)(e.chatId,e.action))}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n){if(t===s.RangeContain.DOES_NOT_CONTAIN)yield(0,a.removeActiveMessageRange)(e.chatId,e.action);else if(0===e.remainingMessages){const t=r(69951).ChatCollection.get((0,d.createWid)(e.chatId));if(t){const e=r(9609);n?e.markSeen(t):e.markUnseen(t)}yield(0,a.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}},5819:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleInitialSyncMsgs=function(e){const t={add:"last",isHistory:!0},n=Object.keys(e).map((r=>(0,p.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:(0,C.createWid)(r),msgObjs:e[r].msgs,meta:t,chatMsgsCollection:null})));return Promise.all([...n,(0,_.storeInitialSyncMessages)(e)]).then((()=>{const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].msgs.map((e=>e.id.toString())))));return(0,g.checkOrphanMutations)(t,Object.keys(e))})).then((()=>{if((0,u.parseWMIReaction)()){const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].reactionMessages)));return(0,r(53348).storeReactionMsgBulk)(t)}})).then((()=>{})).catch((0,s.filteredCatch)(T.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleMsgsMD=function(e,t){const r=t.length;if(!r)return Promise.resolve();if(!(e instanceof A.default))return Promise.resolve();const n={add:"before",isHistory:!0};for(let e=0;e<r;e++){t[e].invis=!0}const i=(0,p.getBridge)();return i.fireAndForget("msg_collection","trigger",{name:"handle:msg_history",args:{count:t.length}}),(0,_.storeMessages)(t,e,!0).then((()=>{const r=t.map((e=>e.id.toString()));(0,g.checkOrphanMutations)(r,[e.toString()]),(0,u.receiveReactionsEnabled)()&&(0,S.checkUpdateForOrphanReactions)(r)})).then((()=>i.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:t,meta:n,chatMsgsCollection:null}))).catch((0,s.filteredCatch)(T.LogoutDrop,(()=>{}))).catch((t=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${r} Chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleProgressiveHistorySyncMsgs=function(){return P.apply(this,arguments)},t.handleSingleMsgMD=function(){return b.apply(this,arguments)};var a=i(r(48926)),s=r(50796),o=r(13959),l=r(4352),c=r(22683),d=i(r(69618)),u=r(57701),p=r(41796),h=r(62415),f=r(91525),_=r(84886),m=r(63728),g=r(12600),y=r(49831),E=r(90641),S=r(76332),v=n(r(22906)),T=r(77591),A=i(r(39546)),C=r(58021);function b(){return(b=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i={add:"after",update:r,isHistory:!1},s=(0,p.getBridge)(),C=t.type===d.default.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(t.subtype);let b=t;if(!C){const e=yield(0,y.applyOrphanRevoke)([b]);if(0===e.length)return;b=e[0]}const P=yield(0,f.handleForActiveMessageRange)(e,b);if(P.has(f.ActiveRangeHandlerAction.DropMessage))return;const M=P.has(f.ActiveRangeHandlerAction.SkipUI);try{A.default.isStatusV3(e)&&(yield s.sendAndReceive("status_v3_collection","handleUpdate",{rawMsg:b,checksum:null,isMsgUpdate:!1})),yield(0,l.promiseLoop)(function(){var t=(0,a.default)((function*(t,n,a){const s=(0,o.delayMs)(v.expBackoff(a,12e4,1e3,.1));try{if(r)yield(0,_.updateMessage)(b),__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`placeholder populate successful`;else if(C)yield(0,_.processRevokeMsgs)([{revokeMsgKey:b.protocolMessageKey,newMsgKey:b.id,timestamp:b.t,subtype:b.subtype,sender:b.author}]);else try{yield(0,_.storeMessages)([b],e),b.type===d.default.MSG_TYPE.CIPHERTEXT&&(0,m.addPlaceHolderAction)(b)}catch(e){if(!(e instanceof _.DuplicateMessageError))throw e;b.type===d.default.MSG_TYPE.CIPHERTEXT?__LOG__(2)`processPlaceholderMsg: skip creating duplicate placeholder`:(__LOG__(2)`storeMessages loop: detect resend message`,yield(0,_.updateMessage)(b),i.update=!0)}if(b.type===d.default.MSG_TYPE.GROUPS_V4_INVITE){const e=b.id.toString();yield(0,h.persistGroupInviteV4Msg)(e,{id:e,from:b.from.toString(),to:b.to.toString(),groupId:b.inviteGrp,expiration:parseInt(b.inviteCodeExp,10),expired:c.Clock.globalUnixTime()>=parseInt(b.inviteCodeExp,10)})}__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop`,t()}catch(e){return __LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop: failed with error ${e}.`,a>3?(__LOG__(3)`storeMessages loop: Gave up after ${a} tries`,Promise.reject(e)):s}}));return function(){return t.apply(this,arguments)}}()),__LOG__(2,void 0,void 0,void 0,["messaging"])`handleSingleMsgMD: msgId::${b.id.id}, write message to db done, overwrite: ${r}, skipUI: ${M}`;try{yield(0,g.checkOrphanMutations)([b.id.toString()],[e.toString()]),(0,u.receiveReactionsEnabled)()&&(yield(0,S.checkUpdateForOrphanReactions)([b.id.toString()]))}catch(t){__LOG__(4,void 0,new Error)`handleSingleMsgMD: checkOrphanMutations failed during handleSingleMsgMD for: ${String(b.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`}M||(b.recvFresh=!0,b.isNewMsg=!0,yield s.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:[b],meta:i,chatMsgsCollection:null,preserveOrder:n}))}catch(t){if(t instanceof T.LogoutDrop)return;if(t instanceof E.PreviousMsgNotPlaceholderError)return __LOG__(2,void 0,void 0,!0)`Msg: ${String(b.id)} chat: ${String(e)} Error: PreviousMsgNotPlaceholderError`,void SEND_LOGS("msg_handler for MD: error storing/processing single message");__LOG__(4,void 0,new Error,!0,["messaging"])`Msg: ${String(b.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing single message")}}))).apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t,n,i){return yield Promise.resolve(),(0,_.storeRecentAndFullHistSyncMessages)(e,t,!0,!0).then((()=>{const r=t.map((e=>e)),n=e.map((e=>e.id.toString()));return(0,g.checkOrphanMutations)(n,r)})).then((()=>{if((0,u.parseWMIReaction)()){return(0,r(53348).storeReactionMsgBulk)(n)}})).then((()=>{const e=(0,p.getBridge)(),t=r(69951).ChatCollection;i.forEach((r=>{if(!r||!r.id||!r.id.remote)return;const n=r.id.remote,i=t.get(n);i&&0===i.msgs.length&&!i.pendingInitialLoading&&e.fireAndForget("msg_collection","processMultipleMessages",{chatId:n,msgObjs:[r],meta:{add:"last",isHistory:!0},chatMsgsCollection:null})}))})).catch((0,s.filteredCatch)(T.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("handleProgressiveHistorySyncMsgs: error storing/processing multiple messages")}))}))).apply(this,arguments)}},52821:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateMsgInfo=function(e,t,r,n){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return function(e,t,r,n){const i=e.id;o.default.isUser(i.remote)?function(e,t,r,n){t===l.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===l.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===l.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}(e,t,r,n):function(e,t,r,n){let i=l.CLOCK;e.played.get(r)?i=l.PLAYED:e.read.get(r)?i=l.READ:e.delivery.get(r)&&(i=l.RECEIVED);if(t<=i)return;if(t>l.RECEIVED){const t=e.delivery.get(r);t?e.delivery.remove(t):e.deliveryRemaining-=1}if(t>l.READ){const t=e.read.get(r);t?e.read.remove(t):e.readRemaining-=1}t===l.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===l.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===l.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}(e,t,r,n)}((0,s.unproxy)(e),t,r,n);return function(e,t,r,n){const i=e.id;if(!o.default.isUser(i.remote)){if(t!==l.RECEIVED){const t=e.delivery.get(r);t&&e.delivery.remove(t)}if(t!==l.READ){const t=e.read.get(r);t&&e.read.remove(t)}if(t!==l.PLAYED){const t=e.played.get(r);t&&e.played.remove(t)}}t===l.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===l.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===l.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}((0,s.unproxy)(e),t,r,n)};var i=n(r(69618)),a=r(7293),s=r(31019),o=n(r(39546));const{ACK:l}=i.default},4280:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelOrDeclinePaymentRequest=function(){return o.apply(this,arguments)},t.fulfillPaymentRequest=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(90641),s=r(12896);function o(){return(o=(0,i.default)((function*(e){const t=r(59871).MsgCollection,n=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([n]);i&&i.forEach((r=>{const n=t.get(r.id);n?n.set((0,s.hydrateMessage)(r),{merge:!0}):r.id===e.id.toString()&&(e.type=r.type,e.templateParams=r.templateParams)}))}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=r(59871).MsgCollection,n=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([n]);i&&i.forEach((e=>{const r=t.get(e.id);r&&r.set((0,s.hydrateMessage)(e),{merge:!0})}))}))).apply(this,arguments)}},17780:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._processMultipleMessages=function(){return A.apply(this,arguments)};var a=i(r(48926)),s=i(r(47545)),o=r(71473),l=r(22683),c=i(r(69618)),d=i(r(61516)),u=r(99234),p=i(r(46931)),h=r(7293),f=r(57701),_=r(32554),m=r(78986),g=r(58668),y=n(r(54676)),E=r(92671),S=r(91692),v=r(64551),T=i(r(39546));function A(){return(A=(0,a.default)((function*(e,t,n,i){const{filteredRecs:a,reorderRecs:A,updates:b}=(0,p.default)(e,t,n,i);yield Promise.all(b);const P=r(69951).ChatCollection,M=r(50101).findChat,O=r(59871).MsgCollection,{MSG_TYPE:I}=c.default;if(0===a.length&&0===A.length){if(e&&n.pendingMsgsDone){const t=P.get(e);t&&(t.pendingMsgs=!1)}return t.map((e=>O.get(e.id))).filter((e=>e))}if(!e)return C(a).then((()=>t.map((e=>O.get(e.id))).filter((e=>e&&!!e.chat))));let w;const R=t[0];if(T.default.isStatusV3(e)){const e=R.id.fromMe?(0,u.getMaybeMeUser)():R.author;w=r(59387).StatusV3Collection.find(e)}else w=M(e);const D=yield w,N=yield C(a),L="after"===n.add||"last"===n.add,k=!n.isHistory;let G,U,F=!1;if("unread"===n.add?(G=i,D.msgChunks.push(G),U=n.firstUnreadKey):"last"===n.add&&n.resume?(G=i,F=!0):G="function"==typeof i?i():i,(0,s.default)(t,N,A,D,L,G||D.msgs,U,F),n.pendingMsgsDone&&(D.pendingMsgs=!1),k&&T.default.isBroadcast(e)&&!T.default.isStatusV3(e)&&N.forEach((function(e){e&&e.recvFresh&&!e.isNotification&&y.broadcastFanout(e)})),h.GK.supportsFeature(h.GK.F.RECENT_EMOJI_SYNC))for(let e=0;e<N.length;e++){const t=N[e];if(t.isNewMsg&&t.isSentByMe&&t.containsEmoji){E.RecentEmojiCollection.throttledSync();break}}if(h.GK.supportsFeature(h.GK.F.MD_BACKEND)&&v.ServerProps.webServerStickerPanel){const e=N.map((e=>{if(!(e.isSentByMe&&e.type===I.STICKER))return;const{mediaData:t,mediaObject:r}=e,n=e.id.toString(),i=null==r?void 0:r.entries.entries[0];return[{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:(null==i?void 0:i.encFilehash)||t.encFilehash,mediaKey:(null==i?void 0:i.mediaKey)||t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:l.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:g.OUTWARD_TYPES.STICKER,index:0},e.t,n]})).filter(Boolean);r(49264).RecentStickerCollectionMd.enqueue(e)}if(h.GK.isRecentStickersEnabled()){const e=N.map((e=>{if(!(e.isNewMsg&&e.isSentByMe&&e.type===I.STICKER))return;const{mediaData:t}=e;return{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:t.encFilehash,mediaKey:t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:l.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:g.OUTWARD_TYPES.STICKER,index:0}})).filter(Boolean);S.RecentStickerCollection.enqueue(e)}if((0,f.webMediaAutoDownloadEnabled)()&&!T.default.isStatusV3(e)&&N.map((e=>e.asAutoDownloadableMedia)).filter(Boolean).forEach((e=>{o.AutoDownloadQueue.enqueue(e,o.AUTO_DOWNLOAD_TYPES.MEDIA)})),v.ServerProps.webDownloadDocumentThumbMmsEnabled&&N.map((e=>e.asDoc)).filter(Boolean).forEach((e=>{(0,f.webMediaAutoDownloadEnabled)()?o.AutoDownloadQueue.enqueue(e,o.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,d.default)({msg:e,isPreload:!0})})),N.map((e=>e.asUrl)).filter(Boolean).forEach((e=>{(0,_.hqLinkPreviewExpired)(e.t)||((0,f.webMediaAutoDownloadEnabled)()?o.AutoDownloadQueue.enqueue(e,o.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,d.default)({msg:e,isPreload:!0}))})),h.GK.supportsFeature(h.GK.F.DOWNLOAD_STATUS_THUMB_MMS)&&T.default.isStatusV3(e)){const e=(0,u.getLastStatusUsage)();(null==e||Date.now()-e<12096e5)&&N.map((e=>e.asImage||e.asVideo)).filter(Boolean).forEach((e=>{(0,f.webMediaAutoDownloadEnabled)()?o.AutoDownloadQueue.enqueue(e,o.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,m.downloadStatusV3Thumbnail)({msg:e,isPreload:!0})}))}return t.map((e=>O.get(e.id))).filter((e=>e))}))).apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e){let t=r(59871).MsgCollection.add(e,{merge:!0});return h.GK.supportsFeature(h.GK.F.MD_BACKEND)&&(t=t.filter(((t,r)=>(null==t&&(__LOG__(4,void 0,new Error,!0)`Get empty message with id ${e[r].id}.`,SEND_LOGS("msgPrepWork-empty-message")),null!=t)))),yield Promise.all(t.map((e=>e.waitForPrep().catch((e=>{__LOG__(4,void 0,new Error,!0)`Assertion failed! ${String(e)}`,SEND_LOGS("bad-msg-prep")}))))),t}))).apply(this,arguments)}},47545:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n,a,s,o,l){const c=function(e,t,r,n,i){const a={},s={};let o,l,c,d=r.length,u=i;if(0===d)return{msgs:t,collection:u};for(o=0;o<d;o++)l=r[o],s[l.id]=l;for(d=t.length,o=0;o<d;o++)l=t[o],l&&(a[l.id]=l);const p=[];for(d=e.length,o=0;o<d;o++)if(l=e[o],l&&(c=a[l.id],c&&p.push(c),c=s[l.id],c))if(c.recvFresh)p.push(c),n.removeMsg(c),c.unset("recvFresh");else{const e=n.getAllCMCs().find((function(e){return e.get(c.id)}));i&&e===i||(e?(e.forEach((function(e){p.push(e),delete s[e.id]})),e===n.msgs?(n.replaceMsgsCollection(i),u=n.msgs):(n.notifyMsgCollectionMerge(i,e,i),n.removeMsgsCollection(e))):(__LOG__(3)`models:Msg:reorder trying to merge CMC of orphaned message ${l.id}`,p.push(s[l.id])))}return{msgs:p,collection:u}}(e,t,r,n,s);i.addRecordsToChat(c.msgs,n,a,c.collection,o,l)};var i=n(r(54676))},46931:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){const a=[],I=[],w=[],R=r(69951).ChatCollection,D=r(59871).MsgCollection;return t.forEach((function(t){var N;t.id instanceof y.default||(__LOG__(4,void 0,new Error,!0)`_processMultipleMessages: el.id is not a MsgKey`,SEND_LOGS("forgot-to-create-msgkey"),t.id=new y.default({from:t.from,to:t.to,id:t.id,participant:t.participant,selfDir:t.self})),(0,b.isString)(e)&&M.default.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<d.default.ACK.CLOCK&&(t.ack=d.default.ACK.CLOCK),null!=t.hydratedButtons&&((N=t).buttons=new C.TemplateButtonCollection,N.buttons.add(N.hydratedButtons.map(((e,t)=>{const r=`${null!=e.index?e.index:t}`;return e.quickReplyButton?new A.default({id:r,displayText:e.quickReplyButton.displayText,selectionId:e.quickReplyButton.id,subtype:"quick_reply"}):e.callButton?new A.default({id:r,displayText:e.callButton.displayText,phoneNumber:e.callButton.phoneNumber,subtype:"call"}):new A.default({id:r,displayText:null===(n=e.urlButton)||void 0===n?void 0:n.displayText,url:null===(i=e.urlButton)||void 0===i?void 0:i.url,subtype:"url"});var n,i})))),null!=t.dynamicReplyButtons&&function(e){e.replyButtons=new c.ButtonCollection,e.replyButtons.add(e.dynamicReplyButtons.map((e=>{let{buttonId:t,buttonText:r}=e;return new l.default({id:t,displayText:null==r?void 0:r.displayText})})))}(t);let L=D.get(t.id);if(t.type===d.default.MSG_TYPE.PROTOCOL&&"ephemeral_setting"!==t.subtype)switch(t.subtype){case"admin_revoke":if(L=D.get(t.protocolMessageKey),L)if(L.isGroupMsg)if(M.default.equals(L.id.remote,t.id.remote)){__LOG__(2)`getMsgUpdates: admin revoked ${L.id.toString()}`;const e=new m.Msg(t);if((0,h.adminRevokeReceiverEnabled)()){const t=(0,o.default)(L.chat.groupMetadata,"m.chat.groupMetadata"),r=t.participants.get(e.sender);if(!r||!r.isAdmin){if(t.participants.add({id:e.sender,isAdmin:!0},{merge:!0}),!r){const t={action:_.GROUP_ACTIONS.ADD,participants:[e.sender]},r=(0,f.genGroupNotificationMsg)({author:void 0,chatId:L.chat.id,ts:e.t},t);(0,g.handleSingleMsgMD)(r.from,r)}(0,S.markGroupAsDirty)({group:L.chat.id})}}(0,T.revoke)(L,{msgKey:e.id,subtype:e.subtype,sender:e.sender})}else __LOG__(2)`getMsgUpdates: ${L.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke came for the different group than the original message was in`;else __LOG__(2)`getMsgUpdates: ${L.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke was sent to a non-group chat`;break;case"sender_revoke":if(L=D.get(t.protocolMessageKey),L){const n=new m.Msg(t);M.default.equals(L.sender,n.sender)?(__LOG__(2)`getMsgUpdates: sender revoked ${L.id.toString()}`,M.default.isStatusV3(e)&&L.msgChunk&&L.msgChunk.remove(L),(0,T.revoke)(L,{msgKey:n.id,subtype:n.subtype,sender:n.sender}),M.default.isStatusV3(e)&&r(59387).StatusV3Collection.find(L.sender).then((e=>{var t,r;if(p.GK.supportsFeature(p.GK.F.QUERY_STATUS_V_3_THUMBNAIL)&&(null===(t=L)||void 0===t||null===(r=t.msgChunk)||void 0===r?void 0:r.length)!==e.totalCount){if(p.GK.supportsFeature(p.GK.F.MD_BACKEND))throw new Error("Webd.statusQueryThumbnail is only supported in non-MD mode");P.default.statusQueryThumbnail(e.id)}}))):__LOG__(3)`getMsgUpdates: sender revoke: sender mismatch: ${n.id.toString()} <> ${L.id.toString()}`}break;case"ephemeral_sync_response":const n=R.get(t.id.remote);n&&(0,u.maybeUpdateEphemeralSetting)(n,t.ephemeralDuration,t.ephemeralSettingTimestamp);break;default:__LOG__(2)`unknown protocolMessage ${t.id.toString()}`}else if(L&&!L.asRevoked){t.ack<L.ack&&delete t.ack;for(const e in t)t.hasOwnProperty(e)&&void 0===t[e]&&delete t[e];t.id.fromMe&&!L.deprecatedMms3Url&&t.deprecatedMms3Url&&(t.phoneUploading=!1),n.isHistory&&(t.isNewMsg=!1);const e=L.t?(0,s.default)(t,["t","id","from","to"]):t,r=L.applyUpdate(e).then((()=>L));if(w.push(r),M.default.isBroadcast(L.id.remote)){const t=E.getBroadcastFanoutKeys(L);t&&t.forEach((t=>{const r=D.get(t);r&&w.push(r.applyUpdate(e).then((()=>L)))}))}n.isHistory&&(L.recvFresh||i)&&!L.search?(__LOG__(3)`model:Msg:handle:processMM:${L.recvFresh?"dup:":"overlap:"}${String(L.id)}`,I.push(L)):n.isHistory&&L.search?(L.search=!1,__LOG__(3)`model:Msg:handle:processMM load search as history ${String(L.id)}`,a.push({id:L.id})):"search"===n.add&&a.push({id:L.id})}else{"payment_action_request_declined"===t.subtype||"payment_transaction_request_cancelled"===t.subtype?w.push((0,v.cancelOrDeclinePaymentRequest)(t)):t.type===d.default.MSG_TYPE.PAYMENT&&"send"===t.subtype&&w.push((0,v.fulfillPaymentRequest)(t)),E.typeIsMms(t)&&!t.deprecatedMms3Url&&(t.phoneUploading=t.id.fromMe&&t.ack===d.default.ACK.CLOCK);const e=R.get(t.id.remote);"search"===n.add&&(t.search=!0),n.update||a.push(t),!n.isHistory&&"search"!==n.add&&e&&w.push(function(){return O.apply(this,arguments)}(t,e)),t.ephemeralOutOfSync&&__LOG__(2)`ephemeralOutOfSync msgId=${t.id.toString()} chatId=${null==e?void 0:e.id.toString()}`}})),{filteredRecs:a,reorderRecs:I,updates:w}};var a=i(r(48926)),s=i(r(57557)),o=i(r(45095)),l=i(r(15871)),c=r(47688),d=i(r(69618)),u=r(29179),p=r(7293),h=r(57701),f=r(37654),_=r(36098),m=r(17304),g=r(5819),y=i(r(32219)),E=n(r(54676)),S=r(51727),v=r(4280),T=r(81027),A=i(r(11897)),C=r(82988),b=r(31515),P=i(r(56891)),M=i(r(39546));function O(){return(O=(0,a.default)((function*(e,t){if(!e.isNewMsg||!e.recvFresh)return __LOG__(3,void 0,void 0,!0)`processLiveMessage should not be called with history message id ${e.id.toString()}`,SEND_LOGS("bad-process-live-message-call"),Promise.resolve();if(e.type===d.default.MSG_TYPE.GP2&&"delete"===e.subtype&&(t.isReadOnly=!0),t.isUser){var r;const a=null!==(r=e.ephemeralDuration)&&void 0!==r?r:0;let s,o=!1;e.type===d.default.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===e.subtype?s=e.t:e.ephemeralSettingTimestamp&&(s=e.ephemeralSettingTimestamp,o=!0);let l=!1;if(null!=s&&(l=yield(0,u.maybeUpdateEphemeralSetting)(t,a,s,o)),p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&!E.isNotification(e.type,e.subtype)){var n,i;const r=null!==(n=e.ephemeralDuration)&&void 0!==n?n:0,a=null!==(i=t.getEphemeralSetting())&&void 0!==i?i:0;e.ephemeralOutOfSync=r!==a&&!l}}}))).apply(this,arguments)}},76332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addOrUpdateReactions=function(){return y.apply(this,arguments)},t.addOrUpdateReactionsDB=_,t.addOrUpdateReactionsDBBulk=function(e){return(0,u.createOrUpdateReactions)(e)},t.addOrUpdateReactionsModelCollection=m,t.checkUpdateForOrphanReactions=function(){return b.apply(this,arguments)},t.deleteAllReactionsOfMsg=function(){return E.apply(this,arguments)},t.markReactionsAsRead=function(){return S.apply(this,arguments)},t.markReactionsAsReadByMessageKeys=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(54958),s=r(88102),o=n(r(69618)),l=r(30010),c=n(r(32219)),d=r(75250),u=r(63374),p=r(31464),h=r(57793),f=r(35099);function _(e){return(0,u.createOrUpdateReactions)([e])}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const{parentMsgKey:n}=e,i=t&&(0,l.shouldNotifyReaction)(e);let u;if(u=i?yield p.ReactionsCollection.find(n):p.ReactionsCollection.get(n),u){p.ReactionsCollection.addOrUpdateReaction(e);const t=u.reactions.length>0;yield(0,d.updateHasReactionInParent)(n,t)}else e.reactionText!==o.default.REVOKED_REACTION_TEXT&&(yield(0,d.updateHasReactionInParent)(n,!0));i&&s.Cmd.alertNewReactionMsg(e);const f=(0,h.isReactionByMe)(e.senderUserJid),_=c.default.fromString(n),m=_.fromMe;if((0,a.shouldUnarchiveChatOnReaction)(m,f,e.reactionText)){const e=r(69951).ChatCollection.get(_.remote.toString());e&&s.Cmd.archiveChat(e,!1,!1)}}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const[r]=yield _(e);r&&m(r,t)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){yield(0,u.deleteReactionsByParentMessageKey)(e.toString());p.ReactionsCollection.get(e)&&p.ReactionsCollection.deleteReactionsByParentMessageKey(e)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){yield(0,f.sendReactionReadReceipts)(e),yield(0,u.markReactionRowsAsRead)(A(e)),p.ReactionsCollection.markReactionsAsRead(C(e))}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=yield(0,u.markReactionsAsReadByMessageKeysInStore)(e);t&&p.ReactionsCollection.markReactionsAsRead(T(t))}))).apply(this,arguments)}function T(e){return e.map((e=>{let{parentMsgKey:t,msgKey:r,reactionText:n}=e;return{parentMsgKey:c.default.fromString(t),msgKey:c.default.fromString(r),reactionText:n}}))}function A(e){return e.map((e=>{let{parentMsgKey:t,senderUserJid:r}=e;return{parentMsgKey:t.toString(),senderUserJid:r}}))}function C(e){return e.map((e=>{let{parentMsgKey:t,msgKey:r,reactionText:n}=e;return{parentMsgKey:t,msgKey:r,reactionText:n}}))}function b(){return(b=(0,i.default)((function*(e){try{(yield(0,u.changeOrphanStateReactions)(e)).forEach((e=>{p.ReactionsCollection.get(e.parentMsgKey)&&p.ReactionsCollection.addOrUpdateReaction(e)}))}catch(e){__LOG__(3)`checkUpdateForOrphanReactions: error ${e}`}}))).apply(this,arguments)}},81027:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.revoke=O,t.sendRevoke=function(e,t,r){return function(e,t,r){const{id:n,t:i}=e;if(t===l.Revoke.Sender&&!n.fromMe)return Promise.reject(new Error("revoking received message"));let s;p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&n.remote.isGroup()&&(s=(0,u.getMeUser)());const o=new S.default({id:(0,A.newTag)(),remote:e.id.remote,fromMe:!0,participant:s}),h=function(e){switch(e){case l.Revoke.Sender:return"sender_revoke";case l.Revoke.Admin:return"admin_revoke"}}(t),f={id:o,to:n.remote,t:i,type:c.default.MSG_TYPE.PROTOCOL,subtype:h,protocolMessageKey:n,clearMedia:!!r,local:!0};return new T.NonPersistJob("sendMessage",(0,a.default)((function*(){try{yield(0,g.storeMessages)([f],e.chat.id)}catch(e){throw __LOG__(4,!0,new Error,!0)`_sendRevoke: failed to storeMessages into storage`,SEND_LOGS("storeMessages failed"),e}if((yield(0,C.sendMsgRecord)(new E.Msg(f)))===b.SendMsgResult.OK){const t=Math.trunc(Date.now()/1e3-e.t);return new y.default.SendRevokeMessage({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),revokeSendDelay:t}).commit(),(0,g.processRevokeMsgs)([{revokeMsgKey:e.id,newMsgKey:o,timestamp:e.t,subtype:h,sender:(0,u.getMeUser)()}]).then((()=>(O(e,{msgKey:o,subtype:h,sender:(0,u.getMeUser)()}),b.SendMsgResult.OK)))}return Promise.resolve(b.SendMsgResult.ERROR_UNKNOWN)})),{priority:d.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}((0,P.unproxy)(e),t,r)};var a=i(r(48926)),s=i(r(4788)),o=i(r(69048)),l=r(88102),c=i(r(69618)),d=r(1973),u=r(99234),p=r(7293),h=r(57701),f=r(11902),_=r(10435),m=n(r(78986)),g=r(84886),y=i(r(11339)),E=r(17304),S=i(r(32219)),v=n(r(54676)),T=r(29731),A=r(15860),C=r(19708),b=r(13705),P=r(31019),M=i(r(39546));function O(e,t){return function(e,t){var n;const i="admin_revoke"===t.subtype;if(i&&!(0,h.adminRevokeReceiverEnabled)())return void __LOG__(2)`revoke: admin revoke feature is disabled, ${e.id.toString()} has not been revoked`;if(i||(0,_.isNoDeleteMessageTimeLimitEnabled)()){const t=c.default.REVOKE_WINDOW_V2+c.default.REVOKE_WINDOW_V2_RECEIVER_MARGIN;if(!(Math.trunc(Date.now()/1e3)-e.t<=t))return void __LOG__(2)`revoke: outside of revoke window, ${e.id.toString()} has not been revoked`}r(16770).LabelCollection.removeAllLabelsMD(e),v.typeIsMms(e)&&m.deregisterMsg(e);e.chat&&e.chat.removeFromCollection(e);e.trigger("revoked");const a=e.getCollection(),l=e.id;e.msgChunk&&e.msgChunk.replaceId(l,t.msgKey);a.replaceId(l,t.msgKey);const d=null===(n=e.chat)||void 0===n?void 0:n.isUnreadMsg(e),u={id:t.msgKey,type:c.default.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",revokeSender:t.sender,body:void 0,caption:void 0,clientUrl:void 0,deprecatedMms3Url:void 0,loc:void 0,lat:void 0,lng:void 0,isLive:void 0,accuracy:void 0,speed:void 0,degrees:void 0,comment:void 0,sequence:void 0,shareDuration:void 0,finalLat:void 0,finalLng:void 0,finalAccuracy:void 0,finalThumbnail:void 0,finalSpeed:void 0,finalDegrees:void 0,finalTimeOffset:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,richPreviewType:void 0,doNotPlayInline:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mediaData:void 0,mentionedJidList:void 0,vcardList:void 0,star:!1};e.set(u),e.trigger("change:msgKey",{newKey:t.msgKey,oldKey:l}),e.chat&&(e.chat.updateMediasCountOnMsg(e,!0),l.equals(e.chat.lastReceivedKey)&&(0,f.setLastReceivedKey)(e.chat.id,t.msgKey).then((()=>{e.chat.lastReceivedKey=t.msgKey})),e.chat.composeQuotedMsg===e&&(e.chat.composeQuotedMsg=null),(0,_.isNoDeleteMessageTimeLimitEnabled)()&&d&&(e.chat.unreadCount=Math.max(e.chat.unreadCount-1,0)));e.isLive&&r(85865).LiveLocationCollection.removeMsg(e);if(M.default.isBroadcast(l.remote)){const r=v.getBroadcastFanoutKeys(l),n=v.getBroadcastFanoutKeys(t.msgKey);if(!r||!n||r.length!==n.length)return void __LOG__(2)`cannot fanout revoke: ${String(r)} ${String(n)}`;(0,s.default)(r,n).forEach((e=>{const r=a.get(e[0]);r&&O(r,{msgKey:e[1],subtype:t.subtype,sender:t.sender})})),p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&o.default.purge([String(e.rowId)])}}((0,P.unproxy)(e),t)}},40256:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(84886),s=r(59387);function o(){return(o=(0,i.default)((function*(e){const t=s.StatusV3Collection.getPSAStatus();if(!t)return;const r=t.msgs.filter((t=>t.campaignId===e));if(0===r.length)return;const n=r.map((e=>e.id.toString()));t.revokeMsgs(n),yield(0,a.removeMessagesFromHistory)(n),__LOG__(2,void 0,void 0,void 0,["revoke-status-psa"])`revokeStatusPSA completed`}))).apply(this,arguments)}},92188:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendKeyDistributionMsg=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(99234),s=n(r(63928)),o=n(r(32219)),l=r(15860),c=r(58021);function d(){return(d=(0,i.default)((function*(e){if(!e.isGroup)return Promise.reject(new Error("[messaging] sendKeyDistributionMsg: only group chats are supported`"));const t=e.id,n=(0,a.getMaybeMeUser)(),i=new o.default({from:n,to:t,id:(0,l.newTag)(),participant:(0,c.toUserWid)(n),selfDir:"out"});yield s.default.find(e.id);const{encryptAndSendKeyDistributionMsg:d}=r(95547);return d(i)}))).apply(this,arguments)}},19708:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMsgRecord=function(e){return(0,a.promiseCallSync)((()=>{const t=e.id,n=r(50101).findChat;let a;n(t.remote).then((e=>{e.isTrusted()||(0,y.sendNotSpam)(e).catch((()=>{}))})),v.default.isBroadcast(e.to)&&(a=(0,_.broadcastFanout)(e)),e.isNewMsg=!0;const T=e.type===l.default.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(e.subtype);if(!e.isGroupMsg&&!T&&o.BlocklistCollection.get(e.to))return Promise.reject(new c.default("Contact is blocked",d.ContactCollection.assertGet(e.to)));let A;T||(A=new h.default.WebcMessageSend({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),messageIsForward:Boolean(e.isForwarded)}));const C=r(59871).MsgCollection,b=r(7293).GK;return n(e.id.remote).then((t=>((0,E.sendSeen)(t),e.type===l.default.MSG_TYPE.REACTION||T||C.trigger(l.default.NEW_MSG_SENT),(0,s.promiseProps)({reply:(0,m.sendMsgRecord)(e),chat:t})))).then((r=>{var i;let{reply:s,chat:o}=r;const c=t.remote,d=(0,u.getMaybeMeUser)(),h=t.fromMe&&v.default.equals(t.remote,d)?3:s.data?s.data.ack:1;return e.updateAck(h,s.t),A&&(A.markMessageSendT(),A.commit()),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postWrittenWireStage(),[l.default.MSG_TYPE.PROTOCOL,l.default.MSG_TYPE.REACTION].includes(e.type)||(0,p.setLastReceivedKey)(o.id,t).then((()=>{o.lastReceivedKey=t})),C.updateLastReceipt(c,s.t),v.default.isBroadcast(c)&&(a?a.forEach((e=>{const r=new f.default({from:d,to:e,id:t.id}),i=C.get(r);i&&(i.ack=l.default.ACK.SENT,C.updateLastReceipt(e,i.t),null==i.ephemeralStartTimestamp&&i.updateEphemeralStartTimestamp(i.t),n(e).then((e=>{(0,p.setLastReceivedKey)(e.id,r).then((()=>{e.lastReceivedKey=r}))})))})):__LOG__(2)`model:msg:createRecord bclist server ack, no recipients`),g.SendMsgResult.OK})).catch((0,i.filteredCatch)(S.ServerStatusCodeError,(t=>{if(408!==t.status&&(__LOG__(4,void 0,new Error,!0)`Phone responded ${t.status}`,SEND_LOGS("send-not-200")),b.supportsFeature(b.F.MD_BACKEND)){const t=(0,m.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!1,t.messageSendResult=h.default.MESSAGE_SEND_RESULT_TYPE.ERROR_NETWORK,t.commit()}return g.SendMsgResult.ERROR_NETWORK}))).catch((t=>{if(__LOG__(3)`model:msg:createRecord dropped msg: ${e.id.toString()}`,__LOG__(4,void 0,new Error,!0)`Got error ${String(t)}`,SEND_LOGS("send-msg-error"),b.supportsFeature(b.F.MD_BACKEND)){const t=(0,m.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!0,t.messageSendResult=h.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,t.commit()}return g.SendMsgResult.ERROR_UNKNOWN}))})).finally((()=>{e.sendDeferred&&e.sendDeferred.resolve(),e.wamMessageSendPerfReporter=null}))};var i=r(50796),a=r(18412),s=r(67602),o=r(32826),l=n(r(69618)),c=n(r(89520)),d=r(19380),u=r(99234),p=r(11902),h=n(r(11339)),f=n(r(32219)),_=r(54676),m=r(90298),g=r(13705),y=r(19569),E=r(9609),S=r(77591),v=n(r(39546))},13705:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMsgResult=void 0;const n=r(54302).Mirrored(["OK","ERROR_NETWORK","ERROR_EXPIRED","ERROR_CANCELLED","ERROR_UPLOAD","ERROR_UNKNOWN"]);t.SendMsgResult=n},83147:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(90981),s=r(30849),o=r(64551),l=r(21224),c=n(r(39546));function d(){return(d=(0,i.default)((function*(e,t){if(!o.ServerProps.bspSystemMessageEnabled)return;if(!c.default.isUser(e.id.remote))return;const r=e.privacyModeWhenSent;if(null!=r&&r.privacyModeTs>t.privacyModeTs)return;const n=(0,s.getReducedPrivacyMode)(t);if(n===(0,s.getReducedPrivacyMode)(r))return;if(null!=e.bizPrivacyStatus)return void __LOG__(3)`msg.bizPrivacyStatus exist already, we can not assign a new value anymore`;const i=u(n);e.bizPrivacyStatus=i,yield(0,a.getTable)().merge(e.id.toString(),{bizPrivacyStatus:i})}))).apply(this,arguments)}function u(e){switch(e){case s.ReducedPrivacyMode.E2EE:return l.WebMessageInfoBizPrivacyStatus.E2EE;case s.ReducedPrivacyMode.BSP:return l.WebMessageInfoBizPrivacyStatus.BSP;case s.ReducedPrivacyMode.FB:return l.WebMessageInfoBizPrivacyStatus.FB}}},14810:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncPrivacyDisallowedLists=o,t.syncSinglePrivacyDisallowedList=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(61319),s=r(25338);function o(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){return{type:e,response:yield(0,s.queryPrivacyDisallowedList)(e)}}));return function(){return e.apply(this,arguments)}}())),r=[];return t.forEach((e=>{const{status:t,users:n,dhash:i}=e.response;"mismatch"===t&&null!=n&&null!=i&&r.push({id:e.type,disallowedList:n.map((e=>e.toString())),dhash:i})})),yield(0,a.getTable)().bulkCreateOrReplace(r),r}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){yield o([e])}))).apply(this,arguments)}},3764:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProfilePic=function(e){return m((0,p.unproxy)(e))},t.setProfilePic=function(e,t,r){return _((0,p.unproxy)(e),t,r)};var a=r(50796),s=r(46331),o=r(88102),l=i(r(64103)),c=r(99234),d=n(r(43725)),u=r(5018),p=r(31019),h=r(77591),f=r(85893);function _(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,s.genId)();const{id:i}=e;if(!e.canSet())return Promise.reject(new l.ActionError);const p=(0,u.sendSetPicture)(i,t,r);e.pendingPic=t;const m=(0,c.getMaybeMeUser)(),g=i.equals(m)?new s.ActionType(d.default.t(127)):new s.ActionType(d.default.t(73)),y=p.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:setPicture dropped`,i.equals(m)?new s.ActionType(d.default.t(126)):new s.ActionType(d.default.t(72))})).catch((0,a.filteredCatch)(h.ServerStatusCodeError,(a=>{if(a.status>=400){const a=i.equals(m)?d.default.t(126):d.default.t(72);return new s.ActionType(a,{actionText:d.default.t(139),actionHandler:()=>_(e,t,r,n)})}}))).then((()=>i.equals(m)?new s.ActionType(d.default.t(125)):new s.ActionType(d.default.t(71))));return o.Cmd.openToast((0,f.jsx)(s.ActionToast,{id:n,initialAction:g,pendingAction:y})),p.then((t=>{t._duplicate||e.set({tag:t.tag,eurl:t.eurl,token:t.token})})).finally((()=>{e.pendingPic=void 0}))}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.genId)();const{id:r}=e;if(!e.canDelete())return Promise.reject(new l.ActionError);const n=(0,u.requestDeletePicture)(r);e.pendingPic=e.fallbackType;const i=(0,c.getMaybeMeUser)(),p=r.equals(i)?new s.ActionType(d.default.t(124)):new s.ActionType(d.default.t(70)),_=n.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:deletePicture dropped`,r.equals(i)?new s.ActionType(d.default.t(122)):new s.ActionType(d.default.t(68))})).catch((0,a.filteredCatch)(h.ServerStatusCodeError,(n=>{if(n.status>=400){const n=r.equals(i)?d.default.t(122):d.default.t(68);return new s.ActionType(n,{actionText:d.default.t(139),actionHandler:()=>m(e,t)})}}))).then((()=>r.equals(i)?new s.ActionType(d.default.t(123)):new s.ActionType(d.default.t(69))));return o.Cmd.openToast((0,f.jsx)(s.ActionToast,{id:t,initialAction:p,pendingAction:_})),n.then((t=>{t._duplicate||e.set({tag:void 0,eurl:void 0})})).finally((()=>{e.pendingPic=void 0}))}},47569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){return o||(o=(0,i.queryServerProps)().then((e=>{a.ServerProps.updateProps(e),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps Start ---`,Object.keys(a.ServerProps.attributes).forEach((e=>{__LOG__(2,void 0,void 0,void 0,["serverprops"])`key: ${e}, value: ${a.ServerProps.attributes[e]}, type: ${typeof a.ServerProps.attributes[e]}`})),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps End ---`})).catch((0,n.filteredCatch)(s.ServerStatusCodeError,(()=>{}))).catch((0,n.filteredCatch)(s.WebdDrop,(()=>{}))).finally((()=>{o=null})),o)};var n=r(50796),i=r(8369),a=r(64551),s=r(77591);let o},92052:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setArchiveClassicSetting=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND))return __LOG__(4,void 0,new Error)`Settings:setArchiveClassicSetting is not supported on MD Companion device.`,Promise.resolve();return g(e)},t.setArchiveEnabledSetting=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND))return void __LOG__(4,void 0,new Error)`Settings:setArchiveEnabledSetting is not supported on MD Companion device.`;__LOG__(2)`Settings:setArchiveEnabledSetting value to ${e}`,h.default.archive.enabled!==e&&(h.default.archive=(0,a.default)((0,a.default)({},h.default.archive),{},{enabled:e}))};var i=n(r(48926)),a=n(r(81109)),s=r(50796),o=n(r(48360)),l=r(46331),c=r(88102),d=r(7293),u=n(r(43725)),p=n(r(11339)),h=n(r(68132)),f=n(r(56891)),_=r(77591),m=r(85893);function g(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,l.genId)();__LOG__(2)`Settings:setArchiveClassicSetting value to ${e}`;const r=f.default.setArchiveSetting(e).then((e=>{if(e.status&&200!==e.status)throw new _.ServerStatusCodeError(e.status)})),n=new l.ActionType(o.default._("Changing archive setting",null,{hk:"4s5LmI"})),i=Boolean(h.default.archive.classic),d=r.then((()=>{__LOG__(2)`Settings:setArchiveClassicSetting:success value sucessfully set to ${e}`;const r=e?o.default._("Archived chats will unarchive when you receive a new message.",null,{hk:"2VniT0"}):o.default._("Archived chats will remain archived when you receive a new message.",null,{hk:"4C3WnP"});return new l.ActionType(r,{actionText:u.default.t(143),actionHandler:()=>g(i,t)})})).catch((0,s.filteredCatch)(_.ServerStatusCodeError,(e=>{if(__LOG__(3)`models:settings:setArchiveClassicSetting failed with server error`,e.status>=400)return new l.ActionType(o.default._("Couldn't change archive setting.",null,{hk:"qovF4"}))}))).catch((()=>{throw __LOG__(3)`models:settings:setArchiveClassicSetting dropped`,new l.ActionType(o.default._("Couldn't change archive setting.",null,{hk:"qovF4"}),{actionText:u.default.t(139),actionHandler:()=>g(e,t)})}));c.Cmd.openToast((0,m.jsx)(l.ActionToast,{id:t,initialAction:n,pendingAction:d})),yield r,h.default.archive.classic!==e&&(new p.default.ArchiveSettings({keepChatsArchived:e}).commit(),h.default.archive=(0,a.default)((0,a.default)({},h.default.archive),{},{classic:e}))}))).apply(this,arguments)}},82350:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(){return f.apply(this,arguments)},t.setMyStatus=_;var a=i(r(48926)),s=r(46331),o=r(88102),l=n(r(64103)),c=r(99234),d=i(r(43725)),u=r(51316),p=r(31515),h=r(85893);function f(){return(f=(0,a.default)((function*(e){const t=yield(0,u.getStatus)(e),n={id:e};if((0,p.isNumber)(t.status))switch(t.status){case 429:case 401:case 403:case 404:case 304:n.stale=!0;const t=r(46133).StatusCollection.get(e);t&&!(0,p.isString)(t.status)&&(n.status="");break;default:n.status=""}else{let i=t.status;if(t.stale){const t=r(46133).StatusCollection.get(e);t&&(i=t.status)}n.status=i}return n}))).apply(this,arguments)}function _(){return m.apply(this,arguments)}function m(){return(m=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.genId)();const n=e.trim();if(!n)return Promise.reject(new l.ActionError);const i=(0,u.setMyStatus)(n),a=new s.ActionType(d.default.t(138)),p=(0,c.getMaybeMeUser)(),f=r(46133).StatusCollection,m=f.assertGet(p).status,g=i.then((e=>200===e.status?new s.ActionType(d.default.t(136),{actionText:d.default.t(143),actionHandler:()=>_(m,t)}):e.status>=400?new s.ActionType(d.default.t(137)):void 0)).catch((()=>{throw __LOG__(3)`models:statusCollection:setMyStatus dropped`,new s.ActionType(d.default.t(137),{actionText:d.default.t(139),actionHandler:()=>_(e,t)})}));o.Cmd.openToast((0,h.jsx)(s.ActionToast,{id:t,initialAction:a,pendingAction:g}));const y=yield i;200!==y.status||y._duplicate||(f.assertGet(p).status=e)}))).apply(this,arguments)}},77905:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFirstPartyStickers=function(){return h.apply(this,arguments)};var a=i(r(48926)),s=n(r(64103)),o=i(r(18561)),l=i(r(43725)),c=i(r(11339)),d=r(2541),u=i(r(23082));const p="https://static.whatsapp.net/sticker";function h(){return(h=(0,a.default)((function*(e,t){const r={cat:"sticker_pack_data",id:e,lg:l.default.getLocale()},n=d.URL.build(p,r),i=yield(0,o.default)(n,{signal:null==t?void 0:t.signal}),a=new c.default.StickerCommonQueryToStaticServer;if(a.set({httpResponseCode:i.status,params:new u.default(r).toString(),queryType:c.default.QUERY_TYPE.STICKER_PACK_DATA}),a.commit(),!i.ok)throw new s.InvalidServerResponseError(n,i.status.toString(),"Invalid response from WhatsApp stickers endpoint");const h=yield i.json();if(null==h||0===h.length)throw new s.InvalidServerResponseError(n,i.status.toString(),`Invalid response from WhatsApp stickers endpoint: ${JSON.stringify(h)}`);return h[0].stickers.map(((e,t)=>({mimetype:e.mimetype,width:e.width,height:e.height,index:t,filehash:e["file-hash"],directPath:e["direct-path"],mediaKey:e["media-key"],id:e["file-hash"],deprecatedMms3Url:e.url,encFilehash:e["enc-file-hash"],mediaKeyTimestamp:0})))}))).apply(this,arguments)}},76046:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleIncomingCallOffer=function(e,t){if(s.CallCollection.processIncomingCall(e.call_id,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:e.isVideoCall?p.default.isVideoCallEnabled():p.default.isVoiceCallEnabled(),offerTime:e.t}),!function(e){return e?p.default.isVideoCallEnabled():p.default.isVoiceCallEnabled()}(e.isVideoCall))return void u.Voip.handleIncomingSignalingMessage(e,t);const r=e.call_id;s.CallCollection.pendingOffers[r]=new a.Resolvable,s.CallCollection.pendingOffers[r].resolve(Promise.all([(0,d.default)(e,t),u.Voip.getNumParticipantsFromCallOffer(t)]).then((n=>{let[{result:i,retryCount:a},o]=n,c=!0;switch(o>0&&(__LOG__(4,void 0,new Error)`voip:incoming: Ignoring call offer since group calling is disabled`,c=!1),c=e.isVideoCall?c&&p.default.isVideoCallEnabled():c&&p.default.isVoiceCallEnabled(),i){case l.E2EProcessResult.SUCCESS:!function(e,t,r){const n=e.call_id;s.CallCollection.processIncomingCall(n,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:null!=r&&r,offerTime:e.t}),!1===r&&s.CallCollection.cleanupPendingOffer(n);u.Voip.handleIncomingSignalingMessage(e,t)}(e,t,c);break;case l.E2EProcessResult.RETRY:__LOG__(2)`voip:handleIncomingCallOffer reject call because of enc retry`,function(){f.apply(this,arguments)}(e,a);break;case l.E2EProcessResult.PARSE_ERROR:__LOG__(2)`voip:handleIncomingCallOffer ending call because of enc parse error`,u.Voip.endCall(r);break;default:throw new Error("invalid e2e result type")}})).finally((()=>{delete s.CallCollection.pendingOffers[r]})))},t.handleIncomingEncRekey=function(e,t){u.Voip.handleIncomingSignalingMessage(e,t)},t.handleIncomingSignalingMsg=function(e,t){u.Voip.handleIncomingSignalingMessage(e,t)};var i=n(r(48926)),a=r(88156),s=r(31218),o=n(r(69618)),l=r(49714),c=r(11849),d=n(r(84590)),u=r(84356),p=n(r(69594)),h=r(45473);function f(){return(f=(0,i.default)((function*(e){var t,r;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=yield c.waSignalStore.getRegistrationInfo();if(!i)throw Error("No registration info found");const{registrationId:a}=i,s=n+1;u.Voip.rejectCallWithoutCallCtx(e.call_id,null===(t=e.peer_jid)||void 0===t?void 0:t.toString({legacy:!0}),null===(r=e.call_creator)||void 0===r?void 0:r.toString({legacy:!0}),h.ENC_RETRY_RECEIPT_ATTRS.SINGLE_PARTICIPANT,s,a),s===o.default.RETRY.MAX_RETRY&&(__LOG__(2)`voip:rejectCallWithReasonEnc max retry reached, uploading fieldstats`,u.Voip.processMissedIncomingCallMaxRetry(e))}))).apply(this,arguments)}},42285:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,o,l){if(__LOG__(2)`voip:handleIncomingCallOfferNotice: callId ${t}`,i.Clock.globalUnixTime()-r>45)return void __LOG__(2)`voip:handleIncomingCallOfferNotice: Ignoring stale offer_notice`;n.CallCollection.add({id:t,isVideo:o,isGroup:l,offerTime:r,canHandleLocally:!1,peerJid:e},{merge:!0}),a.Cmd.alertCall((0,s.toUserWid)(e),t,o,l,!1),setTimeout((()=>{a.Cmd.cancelCall(e);const r=n.CallCollection.get(t);r&&n.CallCollection.remove(r)}),45e3)};var n=r(31218),i=r(22683),a=r(88102),s=r(58021)},56981:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceipt=function(e){return(0,n.prepareRetryReceiptBridge)(e)},t.queryCall=function(e,t){return(0,n.sendQueryCallBridge)(e,t)},t.sendCallEnd=function(e,t){return(0,n.sendCallEndBridge)(e,t)},t.sendCallOffer=function(e){return(0,n.sendCallOfferBridge)(e)},t.sendCallSignalingMsg=function(e,t){return(0,n.sendCallSignalingMsgBridge)(e,t)},t.sendEncRekey=function(e){return(0,n.sendEncRekeyBridge)(e)};var n=r(92486)},18438:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return x.apply(this,arguments)};var i=n(r(48926)),a=r(44396),s=r(31914),o=r(45823),l=r(40126),c=r(96429),d=n(r(83558)),u=n(r(69277)),p=r(27514),h=n(r(81367)),f=n(r(58626)),_=n(r(64054)),m=r(92419),g=r(46462),y=n(r(8898)),E=n(r(70605)),S=n(r(70569)),v=n(r(17234)),T=n(r(50404)),A=n(r(58645)),C=n(r(27258)),b=n(r(65347)),P=n(r(46007)),M=n(r(6571)),O=n(r(2276)),I=n(r(54341)),w=r(79711),R=r(56545),D=r(25773),N=n(r(87183)),L=n(r(95681)),k=r(89370),G=r(28237),U=r(97480);function F(e,t,r){const{attrs:n}=e;if(n.offline){const e=parseInt(n.t,10);G.OfflineMessageHandler.newOfflineStanza(),U.OfflineResumeReporter.logAddOfflineSizeBytes(r),U.OfflineResumeReporter.logOldestStanzaTime(e)}switch(e.tag){case"iq":return function(e){const{attrs:t,content:r}=e;if("urn:xmpp:ping"===t.xmlns)return(0,s.wap)("iq",{type:"result",to:t.from});if("md"!==t.xmlns)throw new Error(`handleIq unrecognized ${e.toString()}`);if(!Array.isArray(r)||!r.length)return;switch(r[0].tag){case"pair-device":return(0,T.default)(e);case"pair-success":return(0,A.default)(e)}}(e);case"receipt":return"retry"===n.type?(0,w.handleMessageRetryRequest)(e):"enc_rekey_retry"===n.type?(0,k.handleEncRekeyRetryRequest)(e):(0,v.default)(e);case"notification":switch(n.type){case"server_sync":return(0,D.handleServerSyncNotification)(e);case"w:gp2":return(0,m.handleGroupNotification)(e);case"picture":return(0,O.default)(e);case"business":return(0,c.handleBusinessNotification)(e);case"contacts":return(0,u.default)(e);case"devices":return(0,p.handleDevicesNotification)(e);case"disappearing_mode":return(0,f.default)(e);case"mediaretry":return(0,E.default)(e);case"encrypt":{const r=e.content;if(!Array.isArray(r)||!r.length)break;switch(r[0].tag){case"count":return(0,b.default)(e,t);case"identity":return(0,g.handleE2eIdentityChange)(e);case"digest":return(0,h.default)(e)}break}case"server":return(0,R.handleServerNotification)(e);case"status":return(0,o.handleAboutNotification)(e);case"account_sync":return(0,l.handleAccountSyncNotification)(e);case"pay":return(0,C.default)(e);case"psa":return(0,I.default)(e);case"privacy_token":return(0,M.default)(e)}if(__LOG__(3)`Comms.handleStanza unrecognized notification stanza ${e.toString()}`,n.hasOwnProperty("id"))return(0,s.wap)("ack",{id:n.id,class:"notification",from:n.to||s.DROP_ATTR,to:n.from||s.DROP_ATTR,type:n.type||s.DROP_ATTR,participant:n.participant||s.DROP_ATTR});break;case"chatstate":return(0,d.default)(e);case"presence":return(0,P.default)(e);case"message":return(0,S.default)(e);case"ib":return(0,y.default)(e);case"stream:error":return(0,N.default)(e);case"failure":return(0,_.default)(e);case"success":return(0,L.default)(e);case"call":return(0,k.handleCall)(e);case"error":return(0,a.handleError)(e)}__LOG__(3)`Comms.handleStanza unrecognized stanza ${e.toString()}`}function x(){return(x=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=yield Promise.resolve(F(e,t,r));return null==n?"NO_ACK":n}))).apply(this,arguments)}},24747:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){P&&P.deadSocketTimer.cancel()},t.castStanza=function(e){const t=L("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=L("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.onStreamErrorReceived=function(){L("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocket=O,t.openSocketLoop=M,t.resetStateForTests=function(){P=null,A=new p.Resolvable,C=1},t.sendIq=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return R(e,t,!1,r)},t.sendIqWithoutRetry=function(e,t){return R(e,t,!0)},t.sendPing=function(){return N.apply(this,arguments)},t.sendSmaxIq=function(e,t){return R(e,t,!1)},t.sendStanzaAndReturnAck=w,t.sendStanzaAndWaitForAck=function(){return I.apply(this,arguments)},t.singletonOrThrowIfUninitialized=L,t.startComms=function(e,t,r){if(P)return;P=new b(e,t,r),setTimeout(M,0)},t.startHandlingRequests=function(){return L("startHandlingRequests").startHandlingRequests()},t.stopComms=function(e){e&&_.Cmd.onStartingLogout();const t=L("stopComms");t.socketLoop.endWithValue(),t.socket&&t.socket.close();P=null},t.waitForConnection=function(){L("waitForConnection").sendPing(),A||(A=new p.Resolvable);return A.promise};var i=n(r(81109)),a=n(r(48926)),s=r(48338),o=r(47151),l=r(50796),c=r(72651),d=r(19797),u=r(72287),p=r(88156),h=r(57319),f=r(31914),_=r(88102),m=n(r(69618)),g=r(64103),y=(r(41796),r(58052)),E=n(r(85726)),S=n(r(23368)),v=r(34045),T=r(53967);r(85893);let A=null,C=1;class b{constructor(e,t,r){this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new p.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.socketLoop=new u.PromiseRetryLoop({name:"MainSocketLoop",code:O,timer:{jitter:.1,max:9e5,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4}),this.parseAndHandleStanza=(e,t)=>{e===this.socketId&&(this.deadSocketTimer.cancel(),A&&(A.resolve(),A=null));const r=(0,f.decodeStanza)(t,G).then((r=>{if(!r)return void __LOG__(3)`Failure parsing stanza!`;const n=this.activePing;return n&&n.socketId===e&&n.stanzaId===k(r)?(this.activePing=null,n.handler.resolve(r),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(r,e,t.byteLength)})).then((t=>{if(e===this.socketId)if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:t&&this.castStanza(t)}));this._pending.add(r),r.finally((()=>{this._pending.delete(r)}))},this.handleStanza=(e,t,r)=>{const n=k(e);if(null!=n){const t=this.pendingIqs.get(n);t?(this.pendingIqs.delete(n),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${n}`}else{if("ack"!==e.tag)return"failure"===e.tag?this._handleStanza(e,t,r):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,r)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new h.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this.deadSocketTimer=new h.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.socketStartOptions=r}filterPending(e){const t=[];function r(r){e(r)&&t.push(r)}return this.pendingIqs.forEach(r),this.ackHandlers.forEach(r),t}callStanza(e){this.castStanza(e),this.deadSocketTimer.onOrBefore(2e4,this.socketId),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{t.sendFrame((0,f.encodeStanza)(e))}catch(e){__LOG__(3)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){var e=this;return(0,a.default)((function*(){__LOG__(2)`Comms.startHandlingRequests`,e._recvBlocker.resolve(),yield e._recvBlocker.promise}))()}handleAck(e){const t=this.ackHandlers;let r=-1,n=null;for(;!n&&++r<t.length;)n=t[r].parseAndTest(e);if(n){const i=t[r];(0,o.removeIndexWithoutPreservingOrder)(t,r),(0,S.default)(e),i.resolve(n),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,o.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new g.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=1e4*Math.random()+2e4;this.healthCheckTimer.onOrBefore(e)}}let P=null;function M(){L("openSocketLoop").socketLoop.start()}function O(){var e;const t=L("openSocket"),r=t.nextSocketId++;return __LOG__(2)`Comms: Socket ${r} opening, passive mode: ${!!(null===(e=t.socketStartOptions)||void 0===e?void 0:e.passive)}`,_.Cmd.setSocketState(m.default.SOCKET_STATE.OPENING),(0,E.default)(t.socketStartOptions).then((e=>{t.socketStartOptions=null,_.Cmd.setSocketState(m.default.SOCKET_STATE.PAIRING);const n=new p.Resolvable;return __LOG__(2)`Comms: Socket ${r} opened`,t.socketId=r,t.socket=e,t.softCloseSocket=()=>{t.softCloseSocket=null,t.socket&&(t.socket.close(),t.socket=null),n.resolve()},t.socketLoop.resetTimeoutAfter(1e4),t.deadSocketTimer.cancel(),t.maybeScheduleHealthCheck(),e.setOnFrame((e=>t.parseAndHandleStanza(r,e))),e.setOnClose((()=>{__LOG__(2)`Comms: Socket ${r} closed`,t.activePing&&r===t.activePing.socketId&&(t.activePing.handler.resolve(),t.activePing=null),t.filterPending((e=>e.attachedToSocketId===r)).forEach((e=>{t.removeHandler(e)})),r===t.socketId&&(t.socketId=0,t.socket=null,_.Cmd.socketStreamDisconnected(),n.resolve())})),(0,y.isRegistered)()&&(_.Cmd.setSocketState(m.default.SOCKET_STATE.CONNECTED),_.Cmd.openSocketStream()),t.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((e=>{t.callStanza(e.stanza)})),n.promise})).catch((0,l.filteredCatch)(g.Disconnected,(()=>{__LOG__(2)`openSocket socket closed while in noise handshake`}))).catch((e=>{__LOG__(3)`openSocket failed ${e}`}))}function I(){return(I=(0,a.default)((function*(e,t){yield w(e,t)}))).apply(this,arguments)}function w(e,t){return new Promise((r=>{const n=L("sendStanzaAndWaitForAck");n.ackHandlers.push({type:"ack",parseAndTest:e=>{const r=s.AckParser.parse(e),n=(0,d.extractJidFromJidWithType)((0,T.widToJidWithType)(t.from)),a=null==t.participant?null:(0,T.widToDeviceJid)(t.participant);return!r.error&&(0,s.ackMatchesTemplate)(r.success,(0,i.default)((0,i.default)({},t),{},{from:n,participant:a}))?e:null},resolve:r,stanza:e,attachedToSocketId:0,orderedId:C++}),n.socket?n.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function R(){return D.apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e,t,r,n){const i=yield new Promise((t=>{const n=L("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const a=n.socketId;!r||a?(n.pendingIqs.set(i,{type:"iq",resolve:t,stanza:e,attachedToSocketId:r?a:0,orderedId:C++}),n.socket?n.callStanza(e):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`):t(Promise.reject(new g.Offline))}));return(0,v.parseIqResponse)(t,i,n)}))).apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t){const r=L("sendPing"),n=e.attrs.id;if(!n||"string"!=typeof n)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!r.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(r.activePing&&r.activePing.socketId===r.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();r.activePing&&r.activePing.handler.resolve();const i=new p.Resolvable;r.activePing={socketId:r.socketId,stanzaId:n,handler:i},r.callStanza(e);const a=yield i.promise;return a&&(0,v.parseIqResponse)(t,a)}))).apply(this,arguments)}function L(e){if(P)return P;throw new Error(`Comms::${e} called before startComms`)}function k(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,f.decodeAsString)(e.attrs.id)||null}return null}function G(e){return Promise.resolve((0,c.inflate)(e))}},23368:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{id:t,from:r,t:n}=e.attrs;"message"===e.attrs.class&&function(e,t,r){const n=new s.default({fromMe:!0,remote:t,id:e}),l=String(n);(0,a.getTable)().get(l).then((e=>o.MessagePropertyType.cast(null==e?void 0:e.messageRangeIndex.split("_")[1]))).then((e=>(0,a.getTable)().merge(l,{messageRangeIndex:(0,o.craftMessageRangeIndex)(t.toString(),!1,e===o.MessagePropertyType.SystemMessage,r)}))).catch((e=>{throw __LOG__(4,!0,new Error,!0)`processAckForOutgoingMessage: failed to update in storage`,SEND_LOGS("message processAckForOutgoingMessage failed"),e})),(0,i.checkAndRemoveActiveMessageRanges)(n,r)}(String(t),(0,l.createWid)(String(r)),parseInt(n,10))};var i=r(87845),a=r(90981),s=n(r(32219)),o=r(12896),l=r(58021)},29100:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockSendPing=function(){return d.apply(this,arguments)},t.sendPing=function(){const e=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,s.generateId)()},(0,s.wap)("ping",null));(0,l.sendPing)(e,c).then((e=>{(null==e?void 0:e.success)&&u(e.result)}))};var i=n(r(48926)),a=r(92844),s=r(31914),o=r(71914),l=r(24747);const c=new o.WapParser("ping",(e=>e.attrTime("t")));function d(){return(d=(0,i.default)((function*(){const e=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,s.generateId)()},(0,s.wap)("ping",null)),t=yield(0,l.sendPing)(e,c);(null==t?void 0:t.success)&&u(t.result)}))).apply(this,arguments)}function u(e){const t=Math.round(Date.now()/1e3-e);(0,a.setClockSkew)(t)}},34045:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorToString=a,t.parseIqResponse=function(e,t,r){const s=t.content;if(s&&Array.isArray(s)&&s[0]){const e=s[0];if("error"===e.tag){const t=e.attrs||{};return{success:!1,errorCode:parseInt(t.code,10),errorText:(0,n.decodeAsString)(t.text)||"",errorType:(0,n.decodeAsString)(t.type)||"",errorBackoff:parseInt(t.backoff,10),customError:r?r.parseOrThrow(e):void 0,toString:a}}}return e instanceof i.WapParser?{success:!0,result:e.parseOrThrow(t)}:{success:!0,result:e(t)}};var n=r(31914),i=r(71914);function a(){return`IqError ${this.errorCode}: ${this.errorText}`}},39410:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CHAT_JID=function(e){if(!(e instanceof o.default&&(e.isUser()||e.isGroup()||e.isBroadcast())))throw Error(`CHAT_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return s.WapJid.create(e.user,"c.us"===e.server?i.WA_USER_JID_SUFFIX:e.server)},t.DEVICE_JID=function(e){if(!(e instanceof o.default&&e.isUser()))throw Error(`DEVICE_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return s.WapJid.createAD(e.user,e.agent,e.device)},t.GROUP_CALL_JID=function(e){if(!(e instanceof o.default&&e.isGroupCall()))throw Error(`GROUP_CALL_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return s.WapJid.create(e.user,e.server)},t.GROUP_JID=function(e){if(!(e instanceof o.default&&e.isGroup()))throw Error(`GROUP_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return s.WapJid.create(e.user,e.server)},t.JID=function(e){if(!(e instanceof o.default))throw Error(`JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return null!=e.device&&0!==e.device||null!=e.agent&&0!==e.agent?s.WapJid.createAD(e.user,e.agent,e.device):s.WapJid.create(e.user,e.server)},t.USER_JID=function(e){if(!(e instanceof o.default&&e.isUser()))throw Error(`USER_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return s.WapJid.create(e.user,i.WA_USER_JID_SUFFIX)},t.wapNodeToVoipXml=t.voipXmlToWapNode=void 0;var i=r(52230),a=r(31914),s=r(45506),o=n(r(39546));t.voipXmlToWapNode=e=>{if(!e||!Array.isArray(e)||3!==e.length)throw Error("Invalid VOIP xml node");return function e(t){if(!t)return null;if(Array.isArray(t)){const r=t[0],n=t[1];let i;n&&Object.keys(n).map((e=>{i||(i={});let t=n[e];if(!t)throw Error("Attribute value is null");if("object"==typeof t){if(t.type!==s.WAP_JID_SUBTYPE.JID&&!s.WAP_JID_SUBTYPE.JID_AD)throw Error("Invalid attribute value type");t=new s.WapJid(t)}i[e]=t}));const o=t[2];let l=null;Array.isArray(o)&&o.length>0&&(l="number"==typeof o[0]?new Uint8Array(o):o.map(e).filter((e=>e)));const c=l;return new a.WapNode(r,i,c)}return t}(e)};t.wapNodeToVoipXml=e=>function e(t){const r=[];return r.push(t.tag),r.push(t.attrs||{}),Array.isArray(t.content)&&0===t.content.filter((e=>!Array.isArray(e)))?r.push(t.content):Array.isArray(t.content)?r.push(t.content.map((t=>e(t)))):null!=t.content?t.content instanceof Uint8Array?r.push(Array.from(t.content)):r.push(t.content):r.push(null),r}(e)},98969:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_IV_SIZE=void 0,t.decryptMediaRetryNotification=function(){return p.apply(this,arguments)},t.encryptServerErrorReceipt=function(e,t,r){return function(){return h.apply(this,arguments)}(e,t,function(e){__LOG__(2)`encodeServerErrorReceipt`;const t=new s.Binary;return(0,l.encodeProtobuf)(d.ServerErrorReceiptSpec,e,t),t.readByteArray()}({stanzaId:t}),r)};var a=i(r(48926)),s=r(8584),o=r(84902),l=r(60980),c=n(r(12206)),d=r(16258),u=i(r(42810));function p(){return(p=(0,a.default)((function*(e,t,r,n){const i=yield f(e,t,r,n);return(0,o.decodeProtobuf)(d.MediaRetryNotificationSpec,i)}))).apply(this,arguments)}function h(){return(h=(0,a.default)((function*(e,t,r,n){const i=(null==n?void 0:n.slice())||E(),{key:a,params:s}=yield g(e,t,i);return{ciphertext:yield u.default.encrypt(s,a,r),iv:i}}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,a.default)((function*(e,t,r,n){const{key:i,params:a}=yield g(e,t,r);return u.default.decrypt(a,i,n)}))).apply(this,arguments)}const m="WhatsApp Media Retry Notification";function g(){return y.apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t,r){const n=yield c.extractAndExpand(e,m,32),i=new s.Binary;i.write(t);const a=i.readByteArray();return{key:yield u.default.importKey("raw",new Uint8Array(n),"AES-GCM",!1,["encrypt","decrypt"]),params:{name:"AES-GCM",iv:r,additionalData:a}}}))).apply(this,arguments)}function E(){const e=new Uint8Array(12);return self.crypto.getRandomValues(e),e}t.ENC_IV_SIZE=12},16104:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getFanOutList=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(9108),s=r(99234),o=r(58021);function l(){return(l=(0,i.default)((function*(e){let{wids:t}=e;const r=yield(0,a.getDeviceIds)(t.map((e=>e.user))),n=[],i=(0,s.assertGetMe)();return r.forEach(((e,r)=>{if(e){const{devices:t,id:r}=e;t.forEach((e=>{const t=(0,o.createDeviceWidFromUserAndDevice)(r,e);t.equals(i)||n.push(t)}))}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`getFanOutList: no device is found, just send to the primary device`;const e=(0,o.toUserWid)(t[r]);e.equals(i)||n.push(e)}})),n}))).apply(this,arguments)}},86791:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateGroupMetadataTable=function(){return o.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(99069);function o(){return(o=(0,a.default)((function*(e){let{groupInfos:t}=e,r=[];yield(0,s.getStorage)().lock(["group-metadata"],function(){var e=(0,a.default)((function*(e){let[n]=e;const a=yield n.bulkGet(t.map((e=>e.id.toString())));return r=t.map(((e,t)=>{var r,n,s,o,l;const c=a[t];let d={subject:e.subject,subjectTime:e.subjectTime||0},u={announce:e.announce,a_v_id:e.a_v_id||0},p={desc:e.desc,descId:e.descId,descOwner:null===(r=e.descOwner)||void 0===r?void 0:r.toString(),descTime:e.descTime||0};if(c){const e=c.subjectTime||0,t=c.a_v_id||0,r=c.descTime||0;e>d.subjectTime&&(d={subject:c.subject,subjectTime:e}),t>u.a_v_id&&(u={announce:c.announce,a_v_id:t}),r>p.descTime&&(p={desc:c.desc,descId:c.descId,descOwner:c.descOwner,descTime:r})}return(0,i.default)((0,i.default)((0,i.default)({id:e.id.toString(),creation:e.creation,owner:null===(n=e.owner)||void 0===n?void 0:n.toString(),restrict:e.restrict,noFrequentlyForwarded:e.noFrequentlyForwarded,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,size:e.size||0,support:null!==(s=e.support)&&void 0!==s&&s,suspended:null!==(o=e.suspended)&&void 0!==o&&o,parentGroup:null===(l=e.parentGroup)||void 0===l?void 0:l.toString(),subgroups:[],isParentGroup:e.parent},d),p),u)})),n.bulkCreateOrMerge(r)}));return function(){return e.apply(this,arguments)}}())}))).apply(this,arguments)}},51727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirty=function(e){let{group:t}=e;return(0,c.getStorage)().lock(["participant"],(e=>{let[r]=e;return r.merge(String(t),{deviceSyncComplete:!1})}))},t.modifyGroupParticipant=function(e){let{group:t,oldId:r,newId:n,prevVersion:s,newVersion:o}=e;const u=String(t);return(0,c.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[t]=e;const a=yield t.get(u);if(!a)throw new l.GroupUnSyncedError(`modifyGroupParticipant: group participant info missing for group ${u}`);if(a.version&&(null==s||s!==a.version))throw new l.GroupUnSyncedError(`modifyGroupParticipant: prev version info missing for group ${u}`);return t.createOrReplace(function(e,t,r,n){const a=String(t),s=String(r),o=new Map(e.senderKey),l=e.participants.filter((e=>e!==a)).concat(s);Array.from(o.keys()).forEach((e=>{const r=(0,d.createWid)(e).user;t.user===r?o.delete(e):o.set(e,!1)})),o.set(s,!1);const c=e.admins.map((e=>e===a?s:e));return(0,i.default)((0,i.default)({},e),{},{participants:l,senderKey:o,admins:c,version:n,rotateKey:!0})}(a,r,n,o))}));return function(){return e.apply(this,arguments)}}())},t.replaceParticipants=function(e){let{group:t,participants:r,admins:n,deviceIds:i,version:a}=e;const o=t.toString();return(0,c.getStorage)().lock(["participant"],(e=>{let[t]=e;return t.get(o).then((e=>e?t.createOrReplace(function(e,t,r,n,i){let a=e.rotateKey;const o=e.senderKey,l=new Map;n.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e),r=o.get(t);null==r?l.set(t,!1):(l.set(t,r),o.delete(t))})),0!==o.size&&(a=!0);return{groupId:e.groupId,senderKey:l,participants:t.map(String),admins:r.map(String),rotateKey:a,version:i,deviceSyncComplete:!0}}(e,r,n,i,a)):t.create(function(e,t,r,n,i){const a=new Map;return n.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);a.has(t)||a.set(t,!1)})),{groupId:e,senderKey:a,participants:t.map(String),admins:r.map(String),rotateKey:!1,version:i,deviceSyncComplete:!0}}(o,r,n,i,a))))}))},t.updateGroupParticipantTableWithoutDeviceSync=function(){return u.apply(this,arguments)},t.updateParticipants=function(e,t){const{participants:r,version:n,prevVersion:i}=t,o=e.toString();return(0,c.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[a]=e;const c=yield a.get(o);if(!c)throw new l.GroupUnSyncedError(`updateParticipants: group participant info missing for group ${o}, action ${t.action}`);if(c.version&&(null==i||i!==c.version))throw new l.GroupUnSyncedError(`updateParticipants: prevVersion info missing for group ${o}, action ${t.action}`);switch(t.action){case l.PARTICIPANT_OPERATION.ADD:return a.createOrReplace(function(e,t,r,n){const i=new Map(e.senderKey);return r.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);i.set(t,!1)})),{groupId:e.groupId,senderKey:i,participants:e.participants.concat(t.map(String)),admins:e.admins,rotateKey:e.rotateKey,version:n,deviceSyncComplete:e.deviceSyncComplete}}(c,r,t.deviceIds,n));case l.PARTICIPANT_OPERATION.REMOVE:return a.createOrReplace(function(e,t,r){const n=new Map(e.senderKey);Array.from(n.keys()).forEach((e=>{const r=(0,d.createWid)(e).user;t.some((e=>e.user===r))?n.delete(e):n.set(e,!1)}));const i=t.map(String);return{groupId:e.groupId,senderKey:n,participants:e.participants.filter((e=>!i.includes(e))),admins:e.admins.filter((e=>!i.includes(e))),rotateKey:!0,version:r,deviceSyncComplete:e.deviceSyncComplete}}(c,r,n));case l.PARTICIPANT_OPERATION.DEMOTE:return a.createOrReplace(p(c,r,n,l.PARTICIPANT_OPERATION.DEMOTE));case l.PARTICIPANT_OPERATION.PROMOTE:return a.createOrReplace(p(c,r,n,l.PARTICIPANT_OPERATION.PROMOTE));default:throw new Error(`updateParticipants: failed with unknown action ${t.action}`)}}));return function(){return e.apply(this,arguments)}}())};var i=n(r(81109)),a=n(r(48926)),s=r(99234),o=r(76214),l=r(70405),c=r(99069),d=r(58021);function u(){return(u=(0,a.default)((function*(e){let{groupInfos:t}=e;const r=yield(0,o.getParticipantTable)().bulkGet(t.map((e=>e.id.toString()))),n=new Map;r.forEach((e=>e&&n.set(e.groupId,e.senderKey)));const i=t.map((e=>{var t;const r=[],i=[],a=e.id.toString(),s=n.get(a)||new Map;return null===(t=e.participants)||void 0===t||t.forEach((e=>{e.isAdmin&&i.push(e.id),r.push(e.id),s.set(String(e.id),!1)})),{groupId:a,participants:r.map(String),admins:i.map(String),senderKey:s,rotateKey:!1,deviceSyncComplete:!1}}));return(0,o.getParticipantTable)().bulkCreateOrReplace(i)}))).apply(this,arguments)}function p(e,t,r,n){let i=e.admins;const a=t.map(String);return n===l.PARTICIPANT_OPERATION.DEMOTE?i=e.admins.filter((e=>!a.includes(e))):n===l.PARTICIPANT_OPERATION.PROMOTE&&(i=e.admins.concat(a)),{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,admins:i,rotateKey:e.rotateKey,version:r,deviceSyncComplete:e.deviceSyncComplete}}},70405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PARTICIPANT_OPERATION=t.GroupUnSyncedError=void 0;const r=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote"});t.PARTICIPANT_OPERATION=r;class n extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}t.GroupUnSyncedError=n},7312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistedQueries=void 0;t.PersistedQueries={queryCatalogProductQuery:"5204508069583210"}},1321:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchQuery=function(){return p.apply(this,arguments)},t.graphql=function(){throw new Error("Invariant Violation")};var i=n(r(48926)),a=r(7312),s=n(r(69618)),o=n(r(43725));function l(){return r.e(4815).then(r.t.bind(r,44311,23)).then((e=>e.default))}class c extends Error{constructor(e){super(),this.name="GraphQLServerError",this.source=e}}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){const{Environment:e,Network:t,RecordSource:r,Store:n}=yield l(),d={Accept:"application/json","Content-Type":"application/json"},u=function(){var e=(0,i.default)((function*(e,t){const r={access_token:s.default.WHATSAPP_GRAPHQL_ACCESS_TOKEN,lang:o.default.getFullLocale().replace("-","_"),doc_id:a.PersistedQueries[e.name],variables:t},n=yield fetch(s.default.WHATSAPP_GRAPHQL_ENDPOINT,{method:"POST",headers:d,body:JSON.stringify(r)}),i=yield n.json();if(null!=(null==i?void 0:i.errors))throw new c({errors:i.errors});return i}));return function(){return e.apply(this,arguments)}}();return new e({network:t.create(u),store:new n(new r)})}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,r){const{fetchQuery:n}=yield l();return n(yield d(),e,t,r).toPromise()}))).apply(this,arguments)}},99805:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){throw new Error("Invariant Violation")}},79341:e=>{"use strict";const t={fragment:{argumentDefinitions:[r={defaultValue:null,kind:"LocalArgument",name:"catalogWid"},n={defaultValue:null,kind:"LocalArgument",name:"directConnectionEncryptedInfo"},i={defaultValue:null,kind:"LocalArgument",name:"fetchComplianceInfo"},a={defaultValue:null,kind:"LocalArgument",name:"height"},s={defaultValue:null,kind:"LocalArgument",name:"productId"},o={defaultValue:null,kind:"LocalArgument",name:"width"}],kind:"Fragment",metadata:null,name:"queryCatalogProductQuery",selections:d=[{alias:null,args:[{fields:[{fields:[{kind:"Variable",name:"direct_connection_encrypted_info",variableName:"directConnectionEncryptedInfo"},{kind:"Variable",name:"fetch_compliance_info",variableName:"fetchComplianceInfo"},{kind:"Variable",name:"height",variableName:"height"},{kind:"Variable",name:"jid",variableName:"catalogWid"},{kind:"Variable",name:"product_id",variableName:"productId"},{kind:"Variable",name:"width",variableName:"width"}],kind:"ObjectValue",name:"product"}],kind:"ObjectValue",name:"request"}],concreteType:"XWAProductCatalogGetProductResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",kind:"LinkedField",name:"product",plural:!1,selections:[{kind:"InlineFragment",selections:[l={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[c,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[r,s,o,a,i,n],kind:"Operation",name:"queryCatalogProductQuery",selections:d},params:{id:"queryCatalogProductQuery",metadata:{},name:"queryCatalogProductQuery",operationKind:"query",text:null}};var r,n,i,a,s,o,l,c,d;t.hash="f41f49948c98ed8c6844ceb09d2c1a0d",e.exports=t},69808:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseABProps=function(e){const t=new Map;e.forEach((e=>{if("ExperimentConfig"===e.mixinName){const{configCode:r,configValue:n,configExpoKey:i}=e;t.set(r,{configValue:n,configExpoKey:i})}}));const r=new Map;return Object.keys(n.ABPropConfigs).map((e=>{const i=n.ABPropConfigs[e][0],a=t.get(i),s=null==a?void 0:a.configValue,o=null==a?void 0:a.configExpoKey;r.set(i,{configValue:s,configExpoKey:null==o?null:o.toString()})})),r};var n=r(56042)},89981:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncABProps=h,t.syncABPropsTask=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(13959),s=r(4276),o=r(31914),l=r(34541),c=r(86945),d=r(64971),u=r(69808),p=r(24747);function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){let e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&(e=(0,d.getHash)());const r=(0,o.wap)("iq",{xmlns:"abt",id:(0,o.generateId)(),type:"get",to:o.S_WHATSAPP_NET},(0,o.wap)("props",{protocol:"1",hash:t&&null!=e?(0,o.CUSTOM_STRING)(e):o.DROP_ATTR})),n=yield(0,p.sendSmaxIq)(r,s.parseGetExperimentConfigResponseSuccess);if(!n.success||null==n.result||!n.result.success)return!1;const i=n.result.value,a=Date.now();if((0,d.updateAttributesLocalStorage)(i.propsAbKey,i.propsHash,i.propsRefresh,a),null==i.propsHash)return!1;try{return yield(0,l.updateABPropConfigs)((0,u.parseABProps)(i.propsProp)),!0}catch(e){__LOG__(4,!0,new Error,!0)`update ABProps config table failed`,SEND_LOGS("update ABProps config table failed when syncing ABProps")}return!1}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){const e=(0,d.isABPropsAfterFirstSync)();let t=3;for(;t-- >0;)try{if(yield h(e))return(0,c.updateABPropsFromStorage)()}catch(e){0===t&&(__LOG__(4,!0,new Error,!0)`failed to sync ABProps`,SEND_LOGS("failed to sync ABProps")),yield(0,a.delayMs)(1e4*Math.random())}}))).apply(this,arguments)}},41075:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ACCOUNT_SYNC_TYPE=void 0,t.getAndUpdateProfilePicture=function(){const e=(0,a.default)(u.ProfilePicThumbCollection.get((0,c.getMeUser)()),"// $FlowFixMe[incompatible-call] (T102990553) Upgrade to flow 0.161.1\nProfilePicThumbCollection.get(getMeUser())");return u.ProfilePicThumbCollection.resyncPictures([e])},t.getDevices=function(e){return(0,s.syncDeviceListJob)([(0,c.assertGetMe)()],e,null)},t.updateBlocklist=function(){return S.apply(this,arguments)},t.updateDefaultDisappearingMode=function(){return v.apply(this,arguments)},t.updatePrivacySettings=function(){return E.apply(this,arguments)},t.updateTosState=function(e){return e.forEach((e=>{m.TosManager.setState(e.id,e.state?"ACCEPTED":"NOT_ACCEPTED")})),Promise.resolve()};var i=n(r(48926)),a=n(r(45095)),s=r(10823),o=r(32826),l=r(91036),c=r(99234),d=r(61319),u=r(82039),p=r(92913),h=r(99192),f=r(4831),_=r(14810),m=r(70768);const g=r(54302)({BLOCKLIST:"blocklist",DEVICES:"devices",DISAPPEARING_MODE:"disappearing_mode",PICTURE:"picture",PRIVACY:"privacy",STATUS:"status",TOS:"tos"});function y(e,t){switch(t){case d.PrivacyDisallowedListType.About:return e.about===f.VISIBILITY.contact_blacklist;case d.PrivacyDisallowedListType.GroupAdd:return e.groupAdd===f.VISIBILITY.contact_blacklist;case d.PrivacyDisallowedListType.LastSeen:return e.lastSeen===f.VISIBILITY.contact_blacklist;case d.PrivacyDisallowedListType.ProfilePicture:return e.profilePicture===f.VISIBILITY.contact_blacklist}}function E(){return(E=(0,i.default)((function*(){const e=yield(0,f.getPrivacy)();(0,c.setUserPrivacySettings)(e);const t=[d.PrivacyDisallowedListType.About,d.PrivacyDisallowedListType.GroupAdd,d.PrivacyDisallowedListType.LastSeen,d.PrivacyDisallowedListType.ProfilePicture].filter((t=>y(e,t))),r=yield(0,_.syncPrivacyDisallowedLists)(t);return{privacySettings:e,privacyDisallowedRows:r}}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){const e=yield(0,p.fetchAndUpdateBlocklist)();e.dhash&&(o.BlocklistCollection.toArray().forEach((e=>o.BlocklistCollection.remove(e))),e.wids&&e.wids.forEach((e=>{o.BlocklistCollection.gadd(e)})))}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){const e=yield(0,h.queryDisappearingMode)();yield(0,l.updateDisappearingMode)((0,c.getMaybeMeUser)(),e.duration,e.t)}))).apply(this,arguments)}t.ACCOUNT_SYNC_TYPE=g},68268:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.AdvToSystemBridgeImpl=void 0,t.getLastADVDeviceInfoCheckTime=v,t.runAdvDeviceInfoCheck=I,t.scheduleAdvDeviceInfoCheck=M;var i=n(r(48926)),a=r(92844),s=r(86945),o=r(22683),l=n(r(69618)),c=r(9108),d=r(99234),u=n(r(11339)),p=r(46308),h=r(60998),f=r(17041),_=r(58021),m=r(65044);const g=25*a.HOUR_SECONDS;class y{constructor(e){this.advToSystemBridge=e}run(e){var t=this;return(0,i.default)((function*(){const r=t.advToSystemBridge,n=yield r.getUsersForExpiration(e),{usersExpired:i,usersCloseToExpiration:a}=n;r.removeCompanions(i),r.sendADVStoredTimestampExpiredEvents(i,e);const s=[...i.keys()].concat([...a.keys()]).filter((e=>!r.canRemoveUserDevices(e)));return r.sendOrQueueDeviceUsyncQuery(s).catch((()=>{})),r.recordLocalTimestamp()}))()}}class E{getNumDaysKeyIndexListExpiration(){return(0,s.getABPropConfigValue)("num_days_key_index_list_expiration")}getNumDaysBeforeDeviceExpiryCheck(){return(0,s.getABPropConfigValue)("num_days_before_device_expiry_check")}getUsersForExpiration(e){var t=this;return(0,i.default)((function*(){const r=yield(0,c.getAllDeviceLists)(),n=yield v(),i=t.getNumDaysKeyIndexListExpiration()*a.DAY_SECONDS,s=new Map,o=new Map;return r.forEach((r=>{r.deleted||function(e){return 1===e.devices.length&&e.devices[0].id===l.default.DEVICE.PRIMARY_DEVICE}(r)||(!function(e,t,r,n){if(e-r.timestamp>=t)return!0;if(null!=r.expectedTsUpdateTs)return e-r.expectedTsUpdateTs>=g&&r.expectedTsLastDeviceJobTs!==n;return!1}(e,i,r,n)?function(e,t,r){if(e-r.timestamp>=t)return!0;if(null!=r.expectedTs)return r.expectedTs>r.timestamp;return!1}(e,i-t.getNumDaysBeforeDeviceExpiryCheck()*a.DAY_SECONDS,r)&&o.set((0,_.createUserWid)(r.id),r):s.set((0,_.createUserWid)(r.id),r))})),{usersExpired:s,usersCloseToExpiration:o}}))()}sendADVStoredTimestampExpiredEvents(e,t){e.forEach((e=>{const r=t-(e.timestamp+this.getNumDaysKeyIndexListExpiration()*a.DAY_SECONDS);if(r<0)return;const n=Math.round(r/a.HOUR_SECONDS);new u.default.AdvStoredTimestampExpired({advExpireTimeInHours:n}).commit()}))}sendOrQueueDeviceUsyncQuery(e){return(0,i.default)((function*(){return yield(0,p.addUserToPendingDeviceSync)(e.map((e=>e.toString()))),(0,p.doPendingDeviceSync)()}))()}canRemoveUserDevices(){return!1}removeCompanions(e){return[...e.entries()].some((e=>{let[t,r]=e;t.user,(0,d.getMeUser)().user}))?(m.Socket.logout(),Promise.resolve()):Promise.all([...e.entries()].map((e=>{let[t,r]=e;return(0,f.clearDeviceRecord)(t,r.devices)})))}recordLocalTimestamp(){return Promise.resolve()}}let S;function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){if(null==S){yield(0,h.getTaskScheduledTime)("advDeviceInfoCheck")}return S}))).apply(this,arguments)}t.AdvToSystemBridgeImpl=E;const A=a.DAY_SECONDS,C="advDeviceInfoCheck";let b,P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){null!=b&&(clearTimeout(b),b=null);const e=o.Clock.localUnixTime(),t=yield v();let r=0,n=()=>Promise.resolve();null!=t&&(r=Math.max(A-(e-t),0),n=()=>(0,s.getABPropConfigValue)("adv_v2_m4_m5")?I():Promise.resolve()),b=setTimeout((0,i.default)((function*(){try{yield n()}catch(e){__LOG__(4,void 0,new Error,void 0,["adv_device_info_check"])`error running the adv device check job`}b=null,S=o.Clock.localUnixTime(),(0,h.updateTaskScheduledTime)(C,(0,a.castToUnixTime)(S)),M()})),1e3*r)}))).apply(this,arguments)}function I(){return null==P&&(P=new y(new E)),P.run(o.Clock.localUnixTime())}},56375:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockUser=function(e){return h.ServerProps.mdBlocklistV2?function(e){return E(e,!0)}(e):function(e){const t=l.BlocklistCollection.map((e=>e.id));return t.push(e),m((0,a.default)(t))}(e)},t.unblockUser=function(e){return h.ServerProps.mdBlocklistV2?function(e){return E(e,!1)}(e):function(e){const t=l.BlocklistCollection.map((e=>e.id));return t.splice(t.indexOf(e),1),m((0,a.default)(t))}(e)};var i=n(r(48926)),a=n(r(44908)),s=r(31914),o=r(71914),l=r(32826),c=r(24747),d=r(99234),u=r(85553),p=r(58052),h=r(64551),f=r(39410);const _=new o.WapParser("blockUser",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`sendBlocklist: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`sendBlocklist: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=0===e.length?(0,s.wap)("list",{name:"default"}):(0,s.wap)("list",{name:"default"},e.map((e=>(0,s.wap)("item",{action:"deny",type:"jid",value:(0,f.JID)(e),order:"1"})))),r=(0,s.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,f.JID)((0,d.assertGetMe)()),type:"set",id:(0,s.generateId)()},(0,s.wap)("query",null,t)),n=yield(0,c.sendIq)(r,_);if(n.success)return n.result;{const{errorCode:e,errorText:t}=n;return __LOG__(3)`sendBlocklist: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}const y=new o.WapParser("blockUserV2ResponseParser",(e=>{var t;if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`blockUserV2ResponseParser: server response with ${r}, ${n}`,{errorCode:r,errorText:n}}__LOG__(2)`block/unblock user: success`;return{blockedUsers:null===(t=e.child("list"))||void 0===t?void 0:t.mapChildrenWithTag("item",(e=>(0,u.userJidToUserWid)(e.attrUserJid("jid"))))}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const r=(0,p.getBlocklistHash)(),n=(0,s.wap)("iq",{xmlns:"blocklist",to:s.S_WHATSAPP_NET,type:"set",id:(0,s.generateId)()},(0,s.wap)("item",{dhash:null!=r?(0,s.CUSTOM_STRING)(r):s.DROP_ATTR,action:(0,s.CUSTOM_STRING)(t?"block":"unblock"),jid:(0,f.JID)(e)})),i=yield(0,c.sendIq)(n,y);if(!i.success){const{errorCode:e,errorText:t}=i;return __LOG__(3)`blockUnblockUserV2: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},8021:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.editBusinessProfile=function(){return h.apply(this,arguments)},t.updateCartEnabled=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer()})),d=new s.WapParser("commerceSettingsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("commerce_settings").child("cart").attrString("enabled")}));function u(e){let{note:t,timezone:r,config:n}=e;const i=[];for(const e in n){const t=n[e],{mode:r,hours:a}=t;if(a)for(const[t,n]of a)i.push({day_of_week:e,mode:r,open_time:t,close_time:n});else i.push({day_of_week:e,mode:r})}const s=[];return t&&s.push((0,a.wap)("business_hours_note",null,t)),s.push(...i.map((e=>(0,a.wap)("business_hours_config",{day_of_week:(0,a.CUSTOM_STRING)(e.day_of_week),mode:e.mode,open_time:e.open_time?(0,a.CUSTOM_STRING)(e.open_time.toString()):a.DROP_ATTR,close_time:e.close_time?(0,a.CUSTOM_STRING)(e.close_time.toString()):a.DROP_ATTR})))),(0,a.wap)("business_hours",{timezone:r?(0,a.CUSTOM_STRING)(r):a.DROP_ATTR},s)}function p(){return(p=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,smax_id:"25",xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"set"},(0,a.wap)("commerce_settings",null,(0,a.wap)("cart",{enabled:(0,a.CUSTOM_STRING)(e.toString())}))),r=yield(0,o.sendIq)(t,d);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){let{address:t,description:r,categories:n,email:i,website:s,businessHours:d}=e;const p=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"set"},(0,a.wap)("business_profile",{v:"3",mutation_type:"delta"},void 0!==t?(0,a.wap)("address",null,t):null,void 0!==r?(0,a.wap)("description",null,r):null,void 0!==i?(0,a.wap)("email",null,i):null,s&&0===s.length?(0,a.wap)("website",null):null,s&&s.length>0?(0,a.wap)("website",null,s[0]):null,s&&s.length>1?(0,a.wap)("website",null,s[1]):null,n?(0,a.wap)("categories",null,n.map((e=>(0,a.wap)("category",{id:(0,a.CUSTOM_STRING)(e.id)})))):null,d?u(d):null)),h=yield(0,o.sendIq)(p,c);if(!h.success)throw new l.ServerStatusCodeError(h.errorCode)}))).apply(this,arguments)}},16116:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleMessagesForChatThreadLogging=function(e){var t,r;return __LOG__(2)`chat_thread_logging: handling ${e.length} message(s)`,null!==(t=null===(r=d())||void 0===r?void 0:r.eventStore.handleMessages(e))&&void 0!==t?t:Promise.resolve()},t.initChatThreadLogging=function(){return u.apply(this,arguments)},t.setThreadDsTimeframeOffset=function(e){var t,r;return __LOG__(2)`chat_thread_logging: setting offset`,null!==(t=null===(r=d())||void 0===r?void 0:r.metadataStore.setOffset(e))&&void 0!==t?t:Promise.resolve(!1)},t.setThreadIdUserSecret=function(e){var t,r;return __LOG__(2)`chat_thread_logging: setting thread_id_user_secret`,null!==(t=null===(r=d())||void 0===r?void 0:r.metadataStore.setSecret(e))&&void 0!==t?t:Promise.resolve(!1)},t.uploadChatThreadLoggingEvents=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(86945),s=r(36112),o=r(7217),l=r(65120);let c=null;function d(){return null==c&&__LOG__(4,void 0,new Error)`getChatThreadLoggingState: init incomplete!`,c}function u(){return(u=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=e&&(yield(0,a.getABPropConfigValue)("message_count_logging_md_enabled")),r=new l.ChatThreadLoggingMetadataLocalStorage,n=t?new s.ChatThreadLoggingDirectWriteEventStore(r):{handleMessages:()=>Promise.resolve(),getEvent:()=>Promise.resolve(),getBeforeInclusive:()=>Promise.resolve([]),deleteBeforeInclusive:()=>Promise.resolve(0)},i=t?new o.ChatThreadLoggingEventUploaderImpl(r,n):{uploadEvents:()=>Promise.resolve(0)};return c={metadataStore:r,eventStore:n,eventUploader:i},Promise.resolve(c)}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){var e;__LOG__(2)`chat_thread_logging: uploading events`;const t=yield null===(e=d())||void 0===e?void 0:e.eventUploader.uploadEvents();__LOG__(2)`chat_thread_logging: uploaded ${t} events`}))).apply(this,arguments)}},85033:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeStartTs=function(e,t){const r=t%s.DAY_SECONDS,n=t-r;return r>=e?n+e:n-s.DAY_SECONDS+e},t.generateThreadID=function(){return d.apply(this,arguments)},t.getThreadDs=function(e){return(0,s.toDate)((0,s.castToUnixTime)(e-8*s.HOUR_SECONDS)).toISOString().split("T")[0].replace(/-/g,"/")};var i=n(r(48926)),a=r(15688),s=r(92844),o=n(r(39827));const l=new TextEncoder,c=e=>l.encode(e).buffer;function d(){return(d=(0,i.default)((function*(e,t,r){const n=c(t+r),i=new o.default(e),s=yield i.sign(n);return(0,a.encodeB64)(s)}))).apply(this,arguments)}},36112:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingDirectWriteEventStore=void 0,t._computeStartTs=function(e,t){const r=t%a.DAY_SECONDS,n=t-r;return r>e?n+e:n-a.DAY_SECONDS+e};var i=n(r(48926)),a=r(92844),s=r(60112),o=r(85033);t.ChatThreadLoggingDirectWriteEventStore=class{constructor(e){this.metadataStore=e}handleMessages(e){var t=this;return(0,i.default)((function*(){const r=yield t.metadataStore.getOffset();if(null==r)return void __LOG__(2)`ChatThreadLoggingDirectWriteEventStore: handleMessages: offset unset.`;const n=yield t.metadataStore.getLastUploadedStartTs();__LOG__(2)`ChatThreadLoggingDirectWriteEventStore: lastUploadedStartTs=${n}`,yield Promise.all(e.map((e=>{let{chatId:t,ts:i,fromMe:a}=e;const l=(0,o.computeStartTs)(r,i);if(l<=n)return;const c={};return a?c.addMsgsSent=1:c.addMsgsReceived=1,(0,s.createOrUpdateChatEvent)(t,l,c)})))}))()}getEvent(e,t){return(0,s.getChatEvent)(e,t)}getBeforeInclusive(e){return(0,s.getBeforeInclusive)(e)}deleteBeforeInclusive(e){return(0,s.deleteBeforeInclusive)(e)}}},7217:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventUploaderImpl=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(92844),o=r(85033),l=n(r(11339));t.ChatThreadLoggingEventUploaderImpl=class{constructor(e,t){this.eventStore=t,this.metadataStore=e}uploadEvents(e){var t=this;return(0,i.default)((function*(){var r,n;const c=null===(r=null==e?void 0:e.purgeAfter)||void 0===r||r,d=null!==(n=null==e?void 0:e.lastStartTs)&&void 0!==n?n:(0,o.computeStartTs)((0,a.default)(yield t.metadataStore.getOffset(),"yield _this.metadataStore.getOffset()"),(0,s.unixTime)()-s.DAY_SECONDS);if(null==t.secret){const e=yield t.metadataStore.getSecret();if(null==e)throw new Error("ChatThreadLoggingBatchEventUploader: secret not in store!");t.secret=e}const u=yield t.eventStore.getBeforeInclusive(d);if(yield Promise.all(u.map(function(){var e=(0,i.default)((function*(e){const r=(0,o.getThreadDs)(e.startTs);new l.default.ChatMessageCounts({messagesSent:e.msgsSent,messagesReceived:e.msgsReceived,threadDs:r,threadId:yield(0,o.generateThreadID)((0,a.default)(t.secret,"_this.secret"),e.chatId,r)}).commit()}));return function(){return e.apply(this,arguments)}}())),c){const e=yield t.eventStore.deleteBeforeInclusive(d);e!==u.length&&__LOG__(4,void 0,new Error)`uploadEvents: uploaded ${u.length} events but only deleted ${e} (they should be the same!)`}return yield t.metadataStore.setLastUploadedStartTs(d),u.length}))()}}},65120:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingMetadataLocalStorage=void 0;var n=r(15688),i=r(58052);t.ChatThreadLoggingMetadataLocalStorage=class{constructor(){null==(0,i.getChatThreadLoggingLastUploadedStartTs)()&&(0,i.setChatThreadLoggingLastUploadedStartTs)(0)}setOffset(e){return(0,i.setChatThreadLoggingOffset)(e),Promise.resolve(!0)}getOffset(){return Promise.resolve((0,i.getChatThreadLoggingOffset)())}setSecret(e){return(0,i.setChatThreadLoggingSecretB64)((0,n.encodeB64)(e)),Promise.resolve(!0)}getSecret(){const e=(0,i.getChatThreadLoggingSecretB64)();return null==e?Promise.resolve():Promise.resolve((0,n.decodeB64)(e))}setLastUploadedStartTs(e){return(0,i.setChatThreadLoggingLastUploadedStartTs)(e),Promise.resolve(!0)}getLastUploadedStartTs(){var e;return Promise.resolve(null!==(e=(0,i.getChatThreadLoggingLastUploadedStartTs)())&&void 0!==e?e:0)}}},99609:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDirtyBits=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747);const l=new s.WapParser("cleanDirtyReplyParser",(e=>(e.assertAttr("type","result"),{})));function c(){return(c=(0,i.default)((function*(e){if(0===e.length)return;const t=e.map((e=>(0,a.wap)("clean",{type:(0,a.CUSTOM_STRING)(e.type),timestamp:(0,a.INT)(e.timestamp)}))),r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:dirty",id:(0,a.generateId)()},t);try{yield(0,o.sendIq)(r,l),__LOG__(2)`clearDirtyBits: success for type: ${e.map((e=>e.type)).join(",")}`}catch(e){__LOG__(3)`clearDirtyBits: failed with error`}}))).apply(this,arguments)}},58853:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeMaybeMediaType=t.encodeMaybeDecryptFail=t.CIPHERTEXT_VERSION=void 0,t.encodeMediaType=o,t.maybeEncoder=l,t.mediaTypeFromProtobuf=function e(t){if(t.deviceSentMessage){const{message:r}=t.deviceSentMessage;return r?e(r):null}if(t.ephemeralMessage){const{message:r}=t.ephemeralMessage;return r?e(r):null}if(t.viewOnceMessage){const{message:r}=t.viewOnceMessage;return r?e(r):null}return t.imageMessage?a.MediaType.Photo:t.stickerMessage?a.MediaType.Sticker:t.locationMessage?a.MediaType.LiveLocation:t.contactMessage?a.MediaType.Contact:t.contactsArrayMessage?a.MediaType.ContactArray:t.documentMessage?a.MediaType.Document:t.audioMessage?t.audioMessage.ptt?a.MediaType.Ptt:a.MediaType.Audio:t.videoMessage?t.videoMessage.gifPlayback?a.MediaType.Gif:a.MediaType.Video:t.buttonsMessage?a.MediaType.Button:t.buttonsResponseMessage?a.MediaType.ButtonResponse:t.listMessage?a.MediaType.List:t.listResponseMessage?a.MediaType.ListResponse:t.orderMessage?a.MediaType.Order:t.productMessage?a.MediaType.Product:t.groupInviteMessage?a.MediaType.Url:null},t.metricsCiphertextType=function(e){switch(e){case a.CiphertextType.Skmsg:return s.default.E2E_CIPHERTEXT_TYPE.SENDER_KEY_MESSAGE;case a.CiphertextType.Pkmsg:return s.default.E2E_CIPHERTEXT_TYPE.PREKEY_MESSAGE;case a.CiphertextType.Msg:return s.default.E2E_CIPHERTEXT_TYPE.MESSAGE}},t.metricsDestinationType=function(e){if(e.isUser())return s.default.E2E_DESTINATION.INDIVIDUAL;if(e.isGroup())return s.default.E2E_DESTINATION.GROUP;if(e.isStatusV3())return s.default.E2E_DESTINATION.STATUS;if(e.isBroadcast())return s.default.E2E_DESTINATION.LIST;throw new Error},t.metricsMediaType=function(e){switch(e){case a.MediaType.Photo:return s.default.MEDIA_TYPE.PHOTO;case a.MediaType.Video:return s.default.MEDIA_TYPE.VIDEO;case a.MediaType.Audio:return s.default.MEDIA_TYPE.AUDIO;case a.MediaType.Ptt:return s.default.MEDIA_TYPE.PTT;case a.MediaType.Location:return s.default.MEDIA_TYPE.LOCATION;case a.MediaType.Contact:return s.default.MEDIA_TYPE.CONTACT;case a.MediaType.Document:return s.default.MEDIA_TYPE.DOCUMENT;case a.MediaType.Url:return s.default.MEDIA_TYPE.URL;case a.MediaType.Call:return s.default.MEDIA_TYPE.CALL;case a.MediaType.Gif:return s.default.MEDIA_TYPE.GIF;case a.MediaType.Future:return s.default.MEDIA_TYPE.FUTURE;case a.MediaType.ContactArray:return s.default.MEDIA_TYPE.CONTACT_ARRAY;case a.MediaType.LiveLocation:return s.default.MEDIA_TYPE.LIVE_LOCATION;case a.MediaType.ProfilePic:return s.default.MEDIA_TYPE.PROFILE_PIC;case a.MediaType.Sticker:return s.default.MEDIA_TYPE.STICKER;case a.MediaType.Hsm:return s.default.MEDIA_TYPE.HSM;case a.MediaType.ProductImage:return s.default.MEDIA_TYPE.PRODUCT_IMAGE;case a.MediaType.Template:return s.default.MEDIA_TYPE.TEMPLATE;case a.MediaType.MdAppState:return s.default.MEDIA_TYPE.MD_APP_STATE;case a.MediaType.MdHistorySync:return s.default.MEDIA_TYPE.MD_HISTORY_SYNC;case a.MediaType.List:return s.default.MEDIA_TYPE.LIST;case a.MediaType.ListResponse:return s.default.MEDIA_TYPE.LIST_REPLY;case a.MediaType.Button:return s.default.MEDIA_TYPE.BUTTON_MESSAGE;case a.MediaType.ButtonResponse:return s.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case a.MediaType.Order:return s.default.MEDIA_TYPE.ORDER;case a.MediaType.Product:return s.default.MEDIA_TYPE.PRODUCT_IMAGE}};var i=r(31914),a=r(45033),s=n(r(11339));function o(e){const t=(()=>{switch(e){case a.MediaType.Photo:return"image";case a.MediaType.Video:return"video";case a.MediaType.Audio:return"audio";case a.MediaType.Ptt:return"ptt";case a.MediaType.Contact:return"vcard";case a.MediaType.Document:return"document";case a.MediaType.Gif:return"gif";case a.MediaType.ContactArray:return"contact_array";case a.MediaType.LiveLocation:return"livelocation";case a.MediaType.Sticker:return"sticker";case a.MediaType.List:return"list";case a.MediaType.ListResponse:return"list_response";case a.MediaType.ButtonResponse:return"buttons_response";case a.MediaType.Order:return"order";case a.MediaType.Product:return"product";case a.MediaType.Url:return"url";default:return null}})();if(t)return(0,i.CUSTOM_STRING)(t);throw new Error("Unsupported type")}function l(e){return t=>null==t?i.DROP_ATTR:e(t)}t.CIPHERTEXT_VERSION=2;const c=l(o);t.encodeMaybeMediaType=c;const d=l((()=>(0,i.CUSTOM_STRING)("hide")));t.encodeMaybeDecryptFail=d},65508:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseErrorFields=void 0;const n=new(r(71914).WapParser)("parseErrorFields",(e=>{const t=[];return e.forEachChildWithTag("field",(e=>{const r=e.hasAttr("detail")?e.maybeAttrString("detail"):null;t.push({name:e.attrString("name"),reason:e.attrString("reason"),detail:r})})),t}));t.parseErrorFields=n},76199:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.maybeChild("address"),r=t?t.contentString():void 0,n=e.maybeChild("description"),s=n?n.contentString():void 0,o=e.maybeChild("email"),l=o?o.contentString():void 0,c=e.maybeChild("latitude"),d=c?parseFloat(c.contentString()):void 0,u=e.maybeChild("longitude"),p=u?parseFloat(u.contentString()):void 0,h=e.maybeChild("vertical");let f;if(h){const e=h.maybeAttrString("canonical"),t=h.hasContent()?h.contentString():void 0;f={name:t,canonical:e}}const _=[];e.forEachChildWithTag("website",(e=>{_.push(e.contentString())}));const m=[],g=e.maybeChild("categories");g&&g.forEachChildWithTag("category",(e=>{const t=e.attrString("id");m.push({id:t,localized_display_name:e.contentString()})}));let y;const E=e.maybeChild("business_hours");if(E){const e=E.maybeAttrString("timezone"),t=[];E.forEachChildWithTag("business_hours_config",(e=>{t.push({day_of_week:e.attrString("day_of_week"),mode:e.attrString("mode"),open_time:e.hasAttr("open_time")?parseInt(e.attrString("open_time"),10):0,close_time:e.hasAttr("close_time")?parseInt(e.attrString("close_time"),10):0})})),y={config:t,timezone:e}}let S;const v=e.maybeChild("profile_options");if(v){S={};const e=v.maybeChild("commerce_experience");var T;if(e)S.commerce_experience=null!==(T=i.COMMERCE_EXPERIENCE_TYPES.cast(e.contentString()))&&void 0!==T?T:i.COMMERCE_EXPERIENCE_TYPES.NONE;const t=v.maybeChild("cart_enabled");t&&(S.cart_enabled="true"===t.contentString());const r=v.maybeChild("shop_url");r&&(S.shop_url=r.contentString());const n=v.maybeChild("commerce_manager_url");n&&(S.commerce_manager_url=n.contentString());const a=v.maybeChild("is_banned");a&&(S.is_banned="true"===a.contentString());const s=v.maybeChild("direct_connection");s&&(S.direct_connection="true"===s.contentString())}const A=e.maybeChild("catalog_status"),C=A?A.attrString("status"):void 0,b={address:r,description:s,email:l,latitude:d,longitude:p,vertical:f,website:_,categories:m,business_hours:y,catalog_status:C,profile_options:S};return(0,a.default)(b)};var i=r(93170),a=n(r(62337))},27874:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.attrEnum("verified_level",i.VERIFIED_LEVEL),r=e.hasContent()?e.contentBytes():null,s=e.maybeAttrString("serial"),{serial:o,name:l,isApi:c}=r&&function(e){const t=(0,a.getParsedProtoObjects)(e);if(null==t?void 0:t.details){const{name:e,serial:r,isApi:n}=(0,a.extractCertificateDetailsParams)(t.details);return{name:e,serial:String(r),isApi:n}}}(r)||{},d=n.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),u=n.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),p=e.maybeAttrInt("privacy_mode_ts");return{level:t,serial:s||o,name:l,isApi:!0===c,privacyMode:null!=d&&null!=u&&null!=p?{actualActors:d,hostStorage:u,privacyModeTs:p}:null}};var n=r(49714),i=r(12037),a=r(51836)},40376:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.digestKey=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(15688),s=r(31914),o=r(71914),l=r(24747),c=r(11849),d=n(r(42810)),u=r(46669);const p=new o.WapParser("digestResponseParser",(e=>{const t=e.child("digest"),r=t.child("skey");return{regId:t.child("registration").contentUint(4),type:t.child("type").contentUint(1),identity:t.child("identity").contentBytes(32),skey:{id:r.child("id").contentUint(3),pubkey:r.child("value").contentBytes(32),signature:r.child("signature").contentBytes(64)},keys:t.child("list").mapChildren((e=>e.contentUint(3))),hash:t.child("hash").contentBytes(20)}}));function h(){return(h=(0,i.default)((function*(){const e=(0,s.wap)("iq",{xmlns:"encrypt",type:"get",to:s.S_WHATSAPP_NET,id:(0,s.generateId)()},(0,s.wap)("digest",null)),t=yield(0,l.sendIq)(e,p);let r=null;if(t.success)try{yield f(t.result),r=!1}catch(e){r=!1}else{const e=t.errorCode;404===e?(__LOG__(3)`digestKey: no record found for current user`,r=!0):406===e?(__LOG__(3)`digestKey: malformed request`,r=!1):503===e?(__LOG__(3)`digestKey: service unavailable`,r=!1):(__LOG__(3)`digestKey: server error ${e}`,r=!1)}if(null!=r&&r)return __LOG__(2)`digestKey: validate key bundle failed, upload prekeys again`,(0,u.uploadPreKeys)()}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const[t,r]=yield Promise.all([c.waSignalStore.getRegistrationInfo(),c.waSignalStore.getSignedPreKey()]);if(!t||!r)throw new Error("validateLocalKeyBundle: No registration info is available");if(e.regId!==t.registrationId)throw new Error("validateLocalKeyBundle: registation id mismatch");const n=t.identityKeyPair.pubKey,s=r.keyPair.pubKey,o=n.byteLength+s.byteLength+r.signature.byteLength+32*e.keys.length,l=new Uint8Array(o);let u=0;[n,s,r.signature].forEach((e=>{l.set(new Uint8Array(e),u),u+=e.byteLength}));const p=e.keys.map(function(){var e=(0,i.default)((function*(e){const t=yield c.waSignalStore.getPreKeyById(e);if(!t)throw Error(`validateLocalKeyBundle: missing prekey record for id ${e}`);return t.keyPair.pubKey}));return function(){return e.apply(this,arguments)}}());(yield Promise.all(p)).forEach((e=>{l.set(new Uint8Array(e),u),u+=e.byteLength}));const h=yield d.default.digest("SHA-1",l),f=(0,a.encodeB64)(h),_=(0,a.encodeB64)(e.hash);if(f!==_)throw Error(`validateLocalKeyBundle: hash mismatch remote:${_} local:${f}`);__LOG__(2)`validateLocalKeyBundle: success`}))).apply(this,arguments)}},66457:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(79942),s=r(52284),o=n(r(39546));function l(){return(l=(0,i.default)((function*(e){if(!o.default.isWid(e)||!e.isUser())return __LOG__(3)`getAbout: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withStatusProtocol().withUser((new a.USyncUser).withId(e)),r=yield t.execute();if(r.error.all||r.error.status){const t=r.error.all||r.error.status;return __LOG__(3)`getAbout: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}{const t=r.list;return t.length||Promise.reject(new Error("no status data returned for user")),{id:e,status:t[0].status}}}))).apply(this,arguments)}},37790:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(99234),c=r(85553),d=r(39410);const u=new s.WapParser("getBlocklistParser",(e=>e.hasChild("error")&&404===e.child("error").attrInt("code")?{wids:[]}:{wids:p(e)}));function p(e){return e.child("query").child("list").mapChildrenWithTag("item",(e=>(0,c.userJidToUserWid)(e.attrUserJid("value"))))}function h(){return(h=(0,i.default)((function*(){const e=yield(0,o.sendIq)((0,a.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,d.JID)((0,l.assertGetMe)()),type:"get",id:(0,a.generateId)()},(0,a.wap)("query",null,(0,a.wap)("list",{name:"default"}))),u);if(e.success)return __LOG__(2)`getBlocklist from server`,e.result;{const{errorCode:t,errorText:r}=e;return __LOG__(3)`getBlocklist: failed ${t}, ${r}`,{errorCode:t,errorText:r}}}))).apply(this,arguments)}},88445:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingMode=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(79942),s=r(52284),o=n(r(39546));function l(){return(l=(0,i.default)((function*(e){if(!o.default.isWid(e)||!e.isUser())return __LOG__(3)`getDisappearingMode: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withDisappearingModeProtocol().withUser((new a.USyncUser).withId(e)),r=yield t.execute();if(r.error.all||r.error.status){const t=r.error.all||r.error.status;return __LOG__(3)`getDisappearingMode: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}{const t=r.list;0!==t.length&&null!=t[0].disappearing_mode||Promise.reject(new Error("no disappearing_mode data returned for user"));const{duration:n,t:i}=t[0].disappearing_mode;return{id:e,disappearingModeDuration:n,disappearingModeSettingTimestamp:i}}}))).apply(this,arguments)}},53379:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndStoreIdentityKeys=function(){return f.apply(this,arguments)},t.getIdentityKeys=_;var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(5087),c=r(85553),d=n(r(76128)),u=r(93832),p=r(39410);const h=new s.WapParser("identityKeysParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");throw new Error(`identityKeysParser bad response: ${r} ${n}`)}return{type:e.child("type").contentBytes(1),identity:e.child("identity").contentBytes(32),user:(0,c.deviceJidToDeviceWid)(e.attrDeviceJid("jid"))}}))));function f(){return(f=(0,i.default)((function*(e){const t=yield d.default.bulkLoadIdentityKey(e.map((e=>String((0,u.createSignalAddress)(e))))),r=e.filter(((e,r)=>null==t[r]));if(0===r.length)return void __LOG__(2)`getAndStoreIdentityKeys: got 0 missing keys`;__LOG__(2)`getAndStoreIdentityKeys: query ${r.length} missing keys for ${e.length} contacts`;const n=(yield _(r)).map((e=>{const t=e.identity,r=(0,l.toSignalCurvePubKey)(t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset));return{identityKey:(0,u.bufferToStr)(r),identifier:(0,u.createSignalAddress)(e.user).toString()}}));return d.default.bulkCreateIdentity(n)}))).apply(this,arguments)}function _(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("user",{jid:(0,p.DEVICE_JID)(e)}))),r=(0,a.wap)("iq",{xmlns:"encrypt",type:"get",to:a.S_WHATSAPP_NET,id:(0,a.generateId)()},(0,a.wap)("identity",null,t)),n=yield(0,o.sendIq)(r,h);if(!n.success)throw new Error(`getIdentityKeys bad response ${String(n)}`);return n.result}))).apply(this,arguments)}},94943:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getProfilePicFull=function(e){return p(e,{preview:!1})},t.getProfilePicPreview=function(e,t){return p(e,{preview:!0,invite:t})};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(39410),c=r(77591);const d={preview:"preview",image:"image"},u=new s.WapParser("profilePicParser",(e=>{const t=e.child("picture");return{id:t.attrInt("id"),type:t.attrEnum("type",d),url:t.attrString("url")}}));function p(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){e.isBroadcast()&&(__LOG__(4,!0,new Error,!0)`getProfilePic failed with a broadcast WID type target}`,SEND_LOGS("getProfilePic failed with a broadcast WID type target"));const{preview:r,invite:n,photoId:i}=t,s=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,target:(0,l.CHAT_JID)(e),type:"get",xmlns:"w:profile:picture",id:(0,a.generateId)()},(0,a.wap)("picture",{invite:(0,a.MAYBE_CUSTOM_STRING)(n),type:r?"preview":a.DROP_ATTR,id:null!=i?(0,a.INT)(i):a.DROP_ATTR,query:"url"})),d=yield(0,o.sendIq)(s,u);if(d.success){const{id:t,url:r,type:n}=d.result;return __LOG__(2)`getProfilePic: ${e.toString()} ${t}, ${n}, ${r}`,{tag:t.toString(),eurl:r,type:n}}return Promise.reject(new c.ServerStatusCodeError(d.errorCode,d.errorText))}))).apply(this,arguments)}},26539:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(87614),s=r(31914),o=r(71914),l=r(24747),c=r(46920),d=r(85553),u=n(r(11339)),p=r(39410),h=r(77591),f=r(58021);const _=new o.WapParser("createGroupReplyParser",(e=>{var t;const r=e.child("group");let n;try{n=(0,f.createWid)(`${r.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=n)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");return{wid:n,subject:r.attrString("subject"),creator:(0,d.userJidToUserWid)(r.attrUserJid("creator")),ts:r.attrTime("creation"),participants:r.mapChildrenWithTag("participant",(e=>{const t=e.maybeChild("add_request");return{wid:(0,d.userJidToUserWid)(e.attrUserJid("jid")),error:e.hasAttr("error")?e.attrInt("error"):null,invite_code:t&&t.attrString("code"),invite_code_exp:t&&t.attrString("expiration"),type:e.attrEnumOrDefault("type",c.GROUP_PARTICIPANT_TYPES,"participant")}}))}}));function m(){return(m=(0,i.default)((function*(e,t,r){const n=(0,a.randomHex)(8),i=t.map((e=>(0,s.wap)("participant",{jid:(0,p.USER_JID)(e)})));null!=r&&0!==r&&i.unshift((0,s.wap)("ephemeral",{expiration:(0,s.INT)(r)}));const o=(0,s.wap)("iq",{to:s.G_US,type:"set",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("create",{subject:(0,s.CUSTOM_STRING)(e),key:(0,s.CUSTOM_STRING)(n)},i)),c=yield(0,l.sendIq)(o,_);return c.success?(new u.default.GroupCreateC({}).commit(),c.result):Promise.reject(new h.ServerStatusCodeError(c.errorCode,c.errorText))}))).apply(this,arguments)}},12594:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.leaveGroups=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(85553),c=r(39410),d=r(77591);const u=new s.WapParser("leaveGroupResultParser",(e=>{e.assertAttr("type","result");return{groups:e.child("leave").mapChildren((e=>(0,l.groupJidToWid)(e.attrGroupJid("id"))))}}));function p(){return(p=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("group",{id:(0,c.GROUP_JID)(e)}))),r=(0,a.wap)("iq",{to:a.G_US,type:"set",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("leave",null,t)),n=yield(0,o.sendIq)(r,u);return n.success?n.result:Promise.reject(new d.ServerStatusCodeError(n.errorCode,n.errorText))}))).apply(this,arguments)}},82394:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(){return _.apply(this,arguments)},t.queryGroupInviteV4=function(){return p.apply(this,arguments)},t.revokeGroupInviteV4=function(){return m.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(31914),o=r(71914),l=r(24747),c=r(85553),d=r(2182);const u=new o.WapParser("queryGroupInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}return e.hasChild("group")?{groupMetadata:(0,d.parseGroupNode)(e.child("group"))}:{phashMatch:!0}}));function p(){return(p=(0,a.default)((function*(e,t,r,n,a){const o=(0,s.wap)("iq",{to:(0,s.CUSTOM_STRING)(r),type:"get",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("query",{phash:(0,s.MAYBE_CUSTOM_STRING)(a)},(0,s.wap)("add_request",{code:(0,s.CUSTOM_STRING)(e),expiration:(0,s.CUSTOM_STRING)(t),admin:(0,s.CUSTOM_STRING)(n)}))),c=yield(0,l.sendIq)(o,u);if(c.success){const e=c.result,t={status:null!=e.errorCode&&e.errorCode>0?e.errorCode:200};return e.groupMetadata?(0,i.default)((0,i.default)({},t),{},{groupMetadata:e.groupMetadata}):t}return __LOG__(2)`parsing failed for queryGroupInviteV4: ${JSON.stringify(c)}`,{status:500}}))).apply(this,arguments)}const h=new o.WapParser("joinGroupViaInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text"),groupId:(0,c.groupJidToWid)(t.attrGroupJid("from"))}}return{groupId:(0,c.groupJidToWid)(e.attrGroupJid("from"))}})),f=new o.WapParser("revokeGroupV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}const t=e.child("revoke"),r=[];return t.mapChildrenWithTag("participant",(e=>{e.hasAttr("error")||r.push((0,c.userJidToUserWid)(e.attrUserJid("jid")))})),{revokedUsers:r}}));function _(){return(_=(0,a.default)((function*(e,t,r,n){const i=(0,s.wap)("iq",{to:(0,s.CUSTOM_STRING)(r),type:"set",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("accept",{code:(0,s.CUSTOM_STRING)(e),expiration:(0,s.CUSTOM_STRING)(t),admin:(0,s.CUSTOM_STRING)(n)})),a=yield(0,l.sendIq)(i,h);if(a.success){const e=a.result;return{status:null!=e.errorCode&&e.errorCode>0?e.errorCode:200,gid:e.groupId}}return __LOG__(2)`joinGroupV4Parser: parsing failed ${a.errorCode}:${a.errorType}`,{status:500}}))).apply(this,arguments)}function m(){return(m=(0,a.default)((function*(e,t){const r=(0,s.wap)("iq",{to:(0,s.CUSTOM_STRING)(t),type:"set",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("revoke",null,e.map((e=>(0,s.wap)("participant",{jid:(0,s.CUSTOM_STRING)(e)}))))),n=yield(0,l.sendIq)(r,f);if(n.success){const e=n.result;return{status:null!=e.errorCode&&e.errorCode>0?e.errorCode:200}}return __LOG__(2)`revokeGroupV4Parser: parsing failed ${n.errorCode}:${n.errorType}`,{status:500}}))).apply(this,arguments)}},85057:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAllGroups=function(){return p.apply(this,arguments)},t.queryGroupInvite=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(2182),c=r(77591);const d=new s.WapParser("queryGroupParser",(e=>e.hasChild("group")?(0,l.parseGroupNode)(e.child("group")):{phashMatch:!0})),u=new s.WapParser("queryAllGroupParser",(e=>e.child("groups").mapChildren(l.parseGroupNode)));function p(){return(p=(0,i.default)((function*(){const e=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("participating",null,(0,a.wap)("participants",null),(0,a.wap)("description",null))),t=yield(0,o.sendIq)(e,u);return t.success?t.result:(__LOG__(2)`queryAllGroups failed: ${t.errorCode}:${t.errorType}`,Promise.reject(new c.ServerStatusCodeError(t.errorCode,t.errorText)))}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("invite",{code:(0,a.CUSTOM_STRING)(e)})),r=yield(0,o.sendIq)(t,d);return r.success?r.result:(__LOG__(2)`queryGroupInvite failed: ${r.errorCode}:${r.errorType}`,Promise.reject(new c.ServerStatusCodeError(r.errorCode,r.errorText)))}))).apply(this,arguments)}},45823:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleAboutNotification=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){switch(__LOG__(2)`handleAboutNotification: received ${e.type}
for ${e.from.toString()}`,e.type){case d.SIDE_LIST_CHANGE:break;case d.CHANGE:const t=l.StatusCollection.get(e.from);t?t.status=e.content:__LOG__(3)`handleAboutNotification: get status update for unknown contact ${e.from}`;break;default:__LOG__(3)`handleAboutNotification: unhandled notification of
type ${e.type}`}return(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(e.stanzaId),to:"change"===e.type?(0,c.JID)(e.from):(0,a.CUSTOM_STRING)(e.from),class:"notification",type:"status"})}(t.success)};var i=n(r(81109)),a=r(31914),s=r(71914),o=r(85553),l=r(46133),c=r(39410);const d=Object.freeze({CHANGE:"change",SIDE_LIST_CHANGE:"sideListChange",UNKNOWN:"unknown"});t.NOTIFICATION_TYPE=d;const u=new s.WapParser("incomingAboutNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id")},r=e.hasChild("set")&&e.child("set");if(r&&!r.hasAttr("hash"))return(0,i.default)({type:d.CHANGE,from:(0,o.userJidToUserWid)(e.attrUserJid("from")),pushname:e.attrString("notify"),content:r.contentString(),ts:e.attrTime("t")},t);{let n=d.UNKNOWN;return r&&r.hasAttr("hash")&&(n=d.SIDE_LIST_CHANGE),(0,i.default)({type:n,from:e.attrString("from")},t)}}))},40126:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateStatus=A,t.handleAccountSyncNotification=function(){return b.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),s=r(31914),o=r(71914),l=r(41075),c=r(88102),d=r(91036),u=n(r(69153)),p=r(99234),h=n(r(66457)),f=r(88445),_=r(7293),m=r(28237),g=r(85553),y=r(10435),E=r(46308),S=r(46133),v=r(39410);const T=new o.WapParser("incomingAccountSyncNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),ts:e.attrTime("t"),from:(0,g.deviceJidToDeviceWid)(e.attrDeviceJid("from"))};if(e.hasChild("status")){const r=e.child("status"),n=r.hasAttr("action")?r.attrString("action"):void 0;return(0,a.default)({type:l.ACCOUNT_SYNC_TYPE.STATUS,action:n},t)}if(e.hasChild("privacy"))return(0,a.default)({type:l.ACCOUNT_SYNC_TYPE.PRIVACY},t);if(e.hasChild("devices"))return(0,a.default)({type:l.ACCOUNT_SYNC_TYPE.DEVICES},t);if(e.hasChild("blocklist"))return(0,a.default)({type:l.ACCOUNT_SYNC_TYPE.BLOCKLIST},t);if(e.hasChild("picture"))return(0,a.default)({type:l.ACCOUNT_SYNC_TYPE.PICTURE},t);if(e.hasChild("tos")){const r=e.child("tos"),n=[];return r.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),r=e.attrString("id");n.push({id:r,state:t})})),(0,a.default)({type:l.ACCOUNT_SYNC_TYPE.TOS,notices:n},t)}if(e.hasChild("disappearing_mode")){const r=e.child("disappearing_mode");let n,i,s;return r.hasAttr("action")?n=r.attrString("action"):(i=r.attrInt("duration"),s=r.attrInt("t")),(0,a.default)((0,a.default)({},t),{},{type:l.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE,action:n,disappearingModeDuration:i,disappearingModeSettingTimestamp:s})}throw new Error("notification type not supported")}));function A(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){const e=(0,p.assertGetMe)(),t=yield(0,h.default)(e);if(t.error)return __LOG__(3)`getStatus failed for ${e}: failed ${t.error.errorCode} : ${t.error.errorText}`,Promise.reject(t.error.errorText);{const e=t.status;e&&(S.StatusCollection.assertGet((0,p.getMaybeMeUser)()).status=e)}}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=T.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(r.stanzaId),to:(0,v.JID)(r.from),class:"notification",type:"account_sync"});switch(r.type){case l.ACCOUNT_SYNC_TYPE.STATUS:yield A();break;case l.ACCOUNT_SYNC_TYPE.DEVICES:if(_.GK.supportsFeature(_.GK.F.MD_BACKEND)){if(!m.OfflineMessageHandler.isResumeFromRestartComplete())return u.default.addOfflinePendingDevice(r.from.toString(),n),"NO_ACK";if(m.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,E.addUserToPendingDeviceSync)([r.from.toString()]),n}yield(0,l.getDevices)("notification");break;case l.ACCOUNT_SYNC_TYPE.PICTURE:yield(0,l.getAndUpdateProfilePicture)();break;case l.ACCOUNT_SYNC_TYPE.PRIVACY:(0,l.updatePrivacySettings)().then((e=>{c.Cmd.onAccountSyncForPrivacy(e)}));break;case l.ACCOUNT_SYNC_TYPE.BLOCKLIST:(0,l.updateBlocklist)();break;case l.ACCOUNT_SYNC_TYPE.TOS:r.notices&&(0,l.updateTosState)(r.notices);break;case l.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE:if((0,y.isDisappearingModeEnabled)()){const{action:e,from:t}=r;let n=r.disappearingModeDuration,i=r.disappearingModeSettingTimestamp;if("modify"===e){const e=yield(0,f.getDisappearingMode)(t);null==e.error&&null!=e.disappearingModeDuration&&null!=e.disappearingModeSettingTimestamp&&(n=e.disappearingModeDuration,i=e.disappearingModeSettingTimestamp)}null!=n&&null!=i&&(yield(0,d.updateDisappearingMode)(t,n,i));break}default:__LOG__(2)`account sync notification of type ${r.type} not supported`}return n}))).apply(this,arguments)}},97760:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedBusinessNameNotificationContact=function(){return b.apply(this,arguments)},t.handleVerifiedBusinessNameNotificationHash=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=n(r(69618)),c=r(19380),d=n(r(9762)),u=r(9961),p=r(64551),h=r(99069),f=r(31452),_=r(68708),m=n(r(27874)),g=r(39410);function y(e,t,r,n,i){const a=c.ContactCollection.get(e);return null!=a&&(0,f.updateContactsWithVerifiedNames)([{id:e,name:r,level:t,isApi:n,privacyMode:i}],[a]),Promise.resolve()}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){yield(0,h.getStorage)().lock(["verified-business-name"],(()=>(0,_.createOrUpdateVerifiedBusinessName)({id:e.wid.user,level:e.level,serial:parseInt(e.serial||"0",10),name:e.verifiedName,isApi:e.isApi,privacyMode:p.ServerProps.bspSystemMessageEnabled&&e.privacyMode?{actualActors:e.privacyMode.actualActors,hostStorage:e.privacyMode.hostStorage,privacyModeTs:e.privacyMode.privacyModeTs}:null})));const t=[],r=c.ContactCollection.get(e.wid);null!=r&&t.push((0,d.default)(e.wid,{verifiedName:r.verifiedName,isVerifiedHigh:r.verifiedLevel===l.default.VERIFIED_LEVEL.HIGH,isBusiness:r.isBusiness,isEnterprise:r.isEnterprise,privacyMode:r.privacyMode},{verifiedName:e.verifiedName,isVerifiedHigh:"high"===e.level,isBusiness:!0,isEnterprise:e.isApi,privacyMode:e.privacyMode})),t.push(y(e.wid,e.level,e.verifiedName,e.isApi,e.privacyMode)),yield Promise.all(t)}))).apply(this,arguments)}const v=new s.WapParser("verifiedNameParser",(e=>(0,m.default)(e.child("verified_name"))));function T(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz",id:(0,a.generateId)()},(0,a.wap)("verified_name",{jid:(0,g.DEVICE_JID)(e)})),r=yield(0,o.sendIq)(t,v);if(!r.success){if(404===r.errorCode)return void __LOG__(3)`verified name notification not found`;throw new Error("Could not send IQ in retrieveBusinessDetails")}return r.result}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){if("verified_name_hash"!==e.type)throw Error("Invalid notification type");const t=c.ContactCollection.resolveWidsFromHash(e.hash);if(!t)return!1;const r=yield Promise.all(t.map(function(){var e=(0,i.default)((function*(e){return{wid:e,verifiedName:yield T(e)}}));return function(){return e.apply(this,arguments)}}()));return r.length&&(yield Promise.all(r.map((t=>{let{wid:r,verifiedName:n}=t;if(n){const{name:t,level:i,serial:a,isApi:s,privacyMode:o}=n;return E({wid:r,verifiedName:t,level:i,stanzaId:e.stanzaId,ts:e.ts,serial:a,isApi:s,privacyMode:o})}if(void 0===n)return(0,u.handleBusinessRemoval)(r,e.stanzaId,e.ts)})))),!0}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){let{jid:t,stanzaId:r,ts:n,verifiedName:i}=e;const{serial:a="",level:s,isApi:o,privacyMode:l}=i;let d=i.name;var u;if(!d)if(null!=(null===(u=c.ContactCollection.get(t))||void 0===u?void 0:u.verifiedName)){var h;d=(null===(h=c.ContactCollection.get(t))||void 0===h?void 0:h.verifiedName)||""}else{const e=yield T(t);if(!e)return;d=e.name}return E({verifiedName:d,level:s,stanzaId:r,ts:n,wid:t,serial:a,isApi:o,privacyMode:p.ServerProps.bspSystemMessageEnabled?l:null})}))).apply(this,arguments)}},96429:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessNotification=function(e){const t=f.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";{const e=t.success;switch(e.type){case"verified_name_hash":return(0,o.handleVerifiedBusinessNameNotificationHash)(e).then((t=>_(e.stanzaId,e.from,!t)));case"verified_name_jid":return(0,o.handleVerifiedBusinessNameNotificationContact)(e).then((()=>_(e.stanzaId,e.from,!1)));case"remove_hash":return(0,c.handleBusinessRemovalNotificationHash)(e).then((t=>_(e.stanzaId,e.from,!t)));case"remove_jid":return(0,c.handleBusinessRemovalNotificationContact)(e).then((()=>_(e.stanzaId,e.from,!1)));case"profile":return(0,l.handleBusinessProfile)(e),Promise.resolve(_(e.stanzaId,e.from,!1));case"profile_hash":return(0,l.handleBusinessProfileHash)(e).then((t=>_(e.stanzaId,e.from,!t)));case"product":return(0,d.handleProductNotification)(e.productsIds).then((()=>_(e.stanzaId,e.from,!1)));case"collection":return(0,d.handleCollectionNotification)(e).then((()=>_(e.stanzaId,e.from,!1)));default:return Promise.resolve(_(e.stanzaId,e.from,!1))}}};var i=n(r(81109)),a=r(31914),s=r(71914),o=r(97760),l=r(91337),c=r(9961),d=r(80537),u=r(85553),p=n(r(76199)),h=n(r(27874));const f=new s.WapParser("businessNotificationParser",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),from:e.attrString("from"),ts:e.attrTime("t")};let r;if(e.hasChild("remove"))return r=e.child("remove"),r.hasAttr("jid")?(0,i.default)({type:"remove_jid",jid:(0,u.chatJidToChatWid)(r.attrChatJid("jid"))},t):(0,i.default)({type:"remove_hash",hash:r.attrString("hash")},t);if(e.hasChild("verified_name"))return r=e.child("verified_name"),r.hasAttr("jid")?(0,i.default)({type:"verified_name_jid",jid:(0,u.chatJidToChatWid)(r.attrChatJid("jid")),verifiedName:(0,h.default)(r)},t):(0,i.default)({type:"verified_name_hash",hash:r.attrString("hash")},t);if(e.hasChild("profile")){const r=e.child("profile"),n=r.maybeAttrString("hash");if(n)return(0,i.default)({type:"profile_hash",hash:n},t);const a=(0,p.default)(r);return(0,i.default)({type:"profile",profile:a},t)}if(e.hasChild("product_catalog")){const r=e.child("product_catalog");if(r.hasChild("product")){const e=[];return r.forEachChildWithTag("product",(t=>{const r=t.child("id").contentString();e.push(r)})),(0,i.default)({type:"product",productsIds:e},t)}if(r.hasChild("collection")){const e=[],n=[];return r.forEachChildWithTag("collection",(t=>{if(t.hasChild("status_info")){var r,i;const a={reviewStatus:t.child("status_info").child("status").contentString(),rejectReason:null===(r=t.child("status_info").maybeChild("reject_reason"))||void 0===r?void 0:r.contentString(),commerceUrl:null===(i=t.child("status_info").maybeChild("commerce_url"))||void 0===i?void 0:i.contentString()};e.push(t.attrString("id")),n.push(a)}})),(0,i.default)({type:"collection",collectionIds:e,reviewStatuses:n},t)}}return(0,i.default)({type:"unknown"},t)}));function _(e,t,r){return r?(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(e),to:(0,a.CUSTOM_STRING)(t),class:"notification",type:"business"},(0,a.wap)("user",{side_list:"out"})):(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(e),to:(0,a.CUSTOM_STRING)(t),class:"notification",type:"business"})}},91337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessProfileHash=t.handleBusinessProfile=void 0;var i=n(r(48926)),a=r(93581),s=r(94010),o=r(19380),l=r(99234),c=r(58021);t.handleBusinessProfile=e=>{let{from:t,profile:r}=e;const n=(0,c.createWidFromWidLike)(t),i=Boolean(a.BusinessProfileCollection.getValid(n)),o=(0,s.parseBusinessProfile)({id:n,profile:r,queryCatalog:!1}),d=a.BusinessProfileCollection.gaddUp(o);if(!i)return void(d.stale=!0);const u=(0,l.getMaybeMeUser)();n.equals(u)&&a.BusinessProfileCollection.fetchBizProfile(n)};const d=function(){var e=(0,i.default)((function*(e){let{hash:t}=e;const r=o.ContactCollection.resolveWidsFromHash(t);return!!r&&(yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){const t=Boolean(a.BusinessProfileCollection.getValid(e)),r=yield a.BusinessProfileCollection.update(e),n=Array.isArray(r)?r:[r];for(const e of n)t||(e.stale=!0)}));return function(){return e.apply(this,arguments)}}())),!0)}));return function(){return e.apply(this,arguments)}}();t.handleBusinessProfileHash=d},9961:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessRemoval=h,t.handleBusinessRemovalNotificationContact=function(){return m.apply(this,arguments)},t.handleBusinessRemovalNotificationHash=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=n(r(69618)),s=r(19380),o=n(r(9762)),l=r(99069);function c(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const r=yield e.get(t.user);if(null!=r)return r.isBusiness=!1,r.verifiedLevel=0,r.verifiedName="",e.merge(t.user,r)}))).apply(this,arguments)}function u(e,t){return e.remove(t.user)}const p={isVerifiedHigh:!1,isBusiness:!1,isEnterprise:!1};function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const t=s.ContactCollection.get(e),r=t?{verifiedName:t.verifiedName,isVerifiedHigh:t.verifiedLevel===a.default.VERIFIED_LEVEL.HIGH,isBusiness:t.isBusiness,isEnterprise:t.isEnterprise,privacyMode:t.privacyMode}:p;yield(0,l.getStorage)().lock(["contact","verified-business-name"],(t=>{let[r,n]=t;return Promise.all([c(r,e),u(n,e)])})).then((()=>{const t=s.ContactCollection.get(e);return null!=t&&t.set({isBusiness:!1,verifiedLevel:null,verifiedName:null}),(0,o.default)(e,r,p)}))}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){if("remove_hash"!==e.type)throw Error("Invalid notification type");const t=s.ContactCollection.resolveWidsFromHash(e.hash);return!!t&&(yield Promise.all(t.map((t=>h(t,e.stanzaId,e.ts)))),!0)}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){if("remove_jid"!==e.type)throw Error("Invalid notification type");yield h(e.jid,e.stanzaId,e.ts)}))).apply(this,arguments)}},80537:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleCollectionNotification=function(e){const t=a.CatalogCollection.get((0,s.getMeUser)().toString());if(null==t?void 0:t.collections)for(let r=0;r<e.collectionIds.length;r++){const n=t.collections.get(e.collectionIds[r]);n&&n.set(e.reviewStatuses[r])}return Promise.resolve()},t.handleProductNotification=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(99989),s=r(99234);function o(){return(o=(0,i.default)((function*(e){const t=a.CatalogCollection.get((0,s.getMeUser)().toString());if(t){const r=[];e.forEach((e=>{r.push(t.refreshProduct(e))})),yield Promise.all(r)}}))).apply(this,arguments)}},83558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,a.default)(t.success)};var i=r(71914),a=n(r(54248)),s=r(85553);const o=new i.WapParser("incomingChatStateParser",(e=>{let t;if(e.assertTag("chatstate"),e.hasChild("paused"))t="paused";else{if(!e.hasChild("composing"))return e.throw("Expected child of type paused or composing");t=e.child("composing").hasAttr("media")?"recording":"composing"}return{id:(0,s.chatJidToChatWid)(e.attrChatJid("from")),type:t,participant:e.hasAttr("participant")?(0,s.userJidToUserWid)(e.attrUserJid("participant")):void 0}}))},69277:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return M.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),s=n(r(45095)),o=r(31914),l=r(71914),c=r(68638),d=r(69951),u=r(9995),p=r(99234),h=r(85553),f=r(5819),_=n(r(32219)),m=r(68315),g=r(46328),y=r(37638),E=r(15860),S=r(82350),v=r(46133),T=r(58021);const A=new l.WapParser("incomingContactsNotification",(e=>{e.assertTag("notification");const t=e.attrString("id"),r={from:e.attrString("from"),ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:t};if(e.hasChild("update")){const t=e.child("update");return t.hasAttr("jid")?(0,a.default)({type:"update",jid:(0,h.userJidToUserWid)(t.attrUserJid("jid"))},r):(0,a.default)({type:"empty",jid:null},r)}if(e.hasChild("add")){const t=e.child("add");return(0,a.default)({type:"add",hash:t.hasContent()?t.contentBytes():null,jid:null},r)}if(e.hasChild("remove")){const t=e.child("remove");return(0,a.default)({type:"remove",jid:(0,h.userJidToUserWid)(t.attrUserJid("jid"))},r)}if(e.hasChild("modify")){const t=e.child("modify");return(0,a.default)({type:"modify",jid:(0,h.userJidToUserWid)(t.attrUserJid("new")),oldJid:(0,h.userJidToUserWid)(t.attrUserJid("old"))},r)}if(e.hasChild("sync")){const t=e.child("sync");return(0,a.default)({type:"sync",after:t.attrTime("after"),jid:null},r)}return __LOG__(3)`Unexpected "contacts" notification`,(0,a.default)({type:"empty",jid:null},r)}));function C(e,t){const r=function(e,t){if("modify"!==t.type)throw new Error("Error: genContactChangeNotificationMsg invalid type");{const r=(0,p.getMeUser)(),n=(0,s.default)(t.oldJid,"notification.oldJid"),i=(0,s.default)(t.jid,"notification.jid");return{id:new _.default({remote:e,fromMe:!1,id:(0,E.newTag)()}),from:e,subtype:"change_number",t:t.ts,to:r,type:"notification_template",templateParams:[n,i]}}}(e,t);return(0,f.handleSingleMsgMD)(e,r)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){if(e.oldJid){const t=e.oldJid,r=e.jid,n=[];d.ChatCollection.get(t)&&n.push({id:t.toString(),changeNumberNewJid:r.toString(),changeNumberOldJid:void 0});d.ChatCollection.get(r)&&n.push({id:r.toString(),changeNumberNewJid:void 0,changeNumberOldJid:t.toString()}),(0,c.getTable)().bulkCreateOrMerge(n).then((()=>{n.forEach((e=>{const t=d.ChatCollection.get(e.id);t&&(t.changeNumberNewJid=e.changeNumberNewJid?(0,T.createWid)(e.changeNumberNewJid):void 0,t.changeNumberOldJid=e.changeNumberOldJid?(0,T.createWid)(e.changeNumberOldJid):void 0)}))})),yield Promise.all([C(t,e),C(r,e)])}else __LOG__(2)`notification.oldJid is null`;return Promise.resolve()}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){const t=A.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=r.jid;switch(r.type){case"update":{if(!n)return __LOG__(3)`handleContactsNotification: an update command does not include jid`,i(r);const e=m.PresenceCollection.get(n);e&&e.reset();let t=Promise.resolve();const a=v.StatusCollection.get(n);a&&(a.set({status:""}),t=(0,S.getStatus)(n).then((e=>{a.set({status:e.status})})));const s=(0,y.changeProfilePicThumb)(r.jid,g.PROFILE_PIC_COMMAND.REMOVE);return Promise.all([s,t]).then((()=>i(r)))}case"modify":return yield b(r),i(r);case"sync":return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`received contact sync notification`,yield(0,u.contactSync)(),i(r);default:return __LOG__(2)`handleContactsNotification: unhandled notification of type ${r.type}`,i(r)}function i(e,t){return(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(e.stanzaId),to:(0,o.CUSTOM_STRING)(e.from),class:"notification",type:"contacts"},t)}}))).apply(this,arguments)}},27514:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICE_NOTIFICATION_TYPES=void 0,t.handleDevicesNotification=function(){return S.apply(this,arguments)};var i=n(r(48926)),a=r(19797),s=r(31914),o=r(71914),l=r(10823),c=n(r(69153)),d=r(7293),u=r(54181),p=r(28237),h=r(85553),f=r(46308),_=r(84356),m=r(39410),g=r(58021);const y={add:"add",remove:"remove",update:"update"};t.DEVICE_NOTIFICATION_TYPES=y;const E=new o.WapParser("incomingDevicesNotification",(e=>{e.assertTag("notification"),e.assertTag("notification"),e.assertAttr("type","devices");let t,r,n,i=[];if(e.hasChild("remove"))r=y.remove,t=e.child("remove");else if(e.hasChild("add"))r=y.add,t=e.child("add");else{if(!e.hasChild("update"))throw __LOG__(3)`Unknown Devices Notification: Devices notification without "remove" and "add" nodes`,new Error("Failed to parse devices notification");r=y.update,t=e.child("update")}if(r===y.add||r===y.remove){const e=t.maybeChild("key-index-list");if(!e)throw new Error("key index node is required to handle device add or remove notification");const s=e.attrTime("ts");if(r===y.remove&&!s)throw new Error("timestamp is required to handle device remove notification");n={ts:s,signedKeyIndexBytes:r===y.add?e.contentBytes():null};const o=t.child("device");i=[{id:(0,a.extractDeviceId)(o.attrDeviceJid("jid")),keyIndex:o.hasAttr("key-index")?o.attrInt("key-index"):null}]}return{type:r,stanzaId:e.attrString("id"),hash:t.attrString(r===y.update?"hash":"device_hash"),user:(0,h.deviceJidToUserWid)(e.attrDeviceJid("from")),deviceList:i,keyIndex:n}}));function S(){return(S=(0,i.default)((function*(e){const t=E.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=r.user,i=(0,s.wap)("ack",{to:(0,m.USER_JID)(r.user),id:(0,s.CUSTOM_STRING)(r.stanzaId),class:"notification"});if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){if(!p.OfflineMessageHandler.isResumeFromRestartComplete())return c.default.addOfflinePendingDevice(n.toString(),i),"NO_ACK";if(p.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,f.addUserToPendingDeviceSync)([n.toString()]),i}const a={wid:n,devices:{deviceList:r.deviceList,keyIndex:r.keyIndex},type:r.type};if(r.type===y.add){try{yield(0,u.handleADVDeviceNotification)(a)}catch(e){__LOG__(3)`handleDevicesNotification - add error: ${e}`}return i}if(r.type===y.remove){try{var o;yield(0,u.handleADVDeviceNotification)(a);const e=(null===(o=r.deviceList)||void 0===o?void 0:o.map((e=>e.id)))||[];yield Promise.all(e.map((e=>{const t=(0,g.createDeviceWidFromUserAndDevice)(n.user,e);_.Voip.notifyDeviceIdentityChangedOrDeleted(t,!0)})))}catch(e){__LOG__(3)`handleDevicesNotification - remove error: ${e}`}return i}try{yield(0,l.syncDeviceListJob)([n],"notification",r.hash)}catch(e){__LOG__(3)`handleDevicesNotification - update error: ${e}`}return i}))).apply(this,arguments)}},81367:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";{const e=t.success,r=(0,n.wap)("ack",{to:n.S_WHATSAPP_NET,id:(0,n.CUSTOM_STRING)(e.stanzaId),class:"notification"});return(0,a.digestKey)().then((()=>r))}};var n=r(31914),i=r(71914),a=r(40376);const s=new i.WapParser("digestKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),e.child("digest").assertTag("digest"),{stanzaId:e.attrString("id")})))},58626:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(){return p.apply(this,arguments)}(t.success)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(91036),l=r(85553),c=r(10435),d=r(39410);const u=new s.WapParser("disappearingModeNotification",(e=>{e.assertTag("notification");const t=e.child("disappearing_mode");return{stanzaId:e.attrString("id"),from:(0,l.deviceJidToDeviceWid)(e.attrDeviceJid("from")),duration:t.attrInt("duration",0),ts:t.attrTime("t")}}));function p(){return(p=(0,i.default)((function*(e){let{duration:t,from:r,stanzaId:n,ts:i}=e;return __LOG__(2)`handleDisappearingModeNotification: received d=${t}:t=${i}
for ${r.toString()}`,(0,c.isDisappearingModeEnabled)()&&(yield(0,o.updateDisappearingMode)(r,t,i)),(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(n),to:(0,d.JID)(r),class:"notification",type:"disappearing_mode"})}))).apply(this,arguments)}},64054:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(71914),s=r(88102),o=r(24747),l=n(r(69618)),c=r(83973),d=r(29898),u=r(65044);const p=new a.WapParser("failureParser",(e=>(e.assertTag("failure"),{reason:e.attrInt("reason",400,599),location:e.attrString("location"),code:e.hasAttr("code")?e.attrInt("code"):null,expire:e.hasAttr("expire")?e.attrInt("expire"):null})));function h(){return(h=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);switch(t.success.reason){case 401:case 403:case 406:__LOG__(2)`received failure stanza, reason: ${t.success.reason}, logging out`,yield u.Socket.clearCredentialsAndStoredData(),s.Cmd.logout();break;case 405:case 409:__LOG__(2)`Client too old or bad user agent, attempting to update the app`;const e=l.default.VERSION_STR.replace(/\.[di]$/,"");"web"===c.PLATFORMS[l.default.WAM_PLATFORM]?d.Updater.update(e,!1,0):d.Updater.update(void 0,!1,0,!1),(0,o.stopComms)();break;case 402:const{code:r,expire:n}=t.success;if(null==r||null==n)throw __LOG__(4,void 0,new Error)`Incorrect temporary ban data ${r} ${n}`,new Error("handleFailure: wrong temp ban data");s.Cmd.onTemporaryBan({banned:!0,code:r,expire:n});break;case 400:case 500:case 501:__LOG__(3)`handleFailure: got failure code ${t.success.reason}`;break;default:return __LOG__(3)`failure reason ${t.success.reason} not implemented yet`,Promise.reject(new Error(`failure reason ${t.success.reason} not implemented yet`))}}))).apply(this,arguments)}},92419:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupNotification=function(e){const t=M.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);{const e=t.success,{chatId:r,author:n,ts:o,pushname:l,externalId:c,actions:d,offline:u}=e,p=!!u&&!E.OfflineMessageHandler.isResumeFromRestartComplete(),h=(0,a.default)({chatId:r,author:n,ts:o,externalId:c},l?{pushname:l}:null);return(0,v.handleMessage)(r.toString(),p,(0,i.default)((function*(){return yield Promise.all(d.map((e=>function(){return k.apply(this,arguments)}(h,e,p)))),(0,s.wap)("ack",{to:(0,b.GROUP_JID)(e.chatId),id:(0,s.CUSTOM_STRING)(e.externalId),class:"notification",participant:n?(0,b.JID)(n):s.DROP_ATTR})})))}};var i=n(r(48926)),a=n(r(81109)),s=r(31914),o=r(71914),l=r(86945),c=r(68638),d=r(69951),u=r(22683),p=r(46920),h=r(99234),f=r(7293),_=r(37654),m=r(64632),g=r(36098),y=r(34648),E=r(28237),S=r(85553),v=r(15746),T=r(76214),A=n(r(29783)),C=r(5819),b=r(39410);const P=Object.freeze({REMOVE:"remove",ADD:"add",DEMOTE:"demote",PROMOTE:"promote",MODIFY:"modify",CREATE:"create",SUBJECT:"subject",DESC:"description",LOCKED:"locked",UNLOCKED:"unlocked",ANNOUNCE:"announcement",NOT_ANNOUNCE:"not_announcement",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",FREQUENTLY_FORWARDED_OK:"frequently_forwarded_ok",INVITE:"invite",EPHEMERAL:"ephemeral",NOT_EPHEMERAL:"not_ephemeral",REVOKE_INVITE:"revoke",SUSPENDED:"suspended",UNSUSPENDED:"unsuspended",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked"});const M=new o.WapParser("groupNotificationParser",(e=>{e.assertTag("notification"),e.hasAttr("to")&&e.assertAttr("to",(0,h.assertGetMe)().toJid());const t=(0,S.groupJidToWid)(e.attrGroupJid("from")),r=e.hasAttr("participant")?(0,S.userJidToUserWid)(e.attrUserJid("participant")):null,n=e.attrTime("t");function i(e){return{participants:e.mapChildrenWithTag("participant",(e=>(0,S.userJidToUserWid)(e.attrUserJid("jid")))),prevVersion:e.hasAttr("prev_v_id")?e.attrInt("prev_v_id"):void 0,version:e.hasAttr("v_id")?e.attrInt("v_id"):void 0}}const s=e.mapChildren((e=>{const t=e.tag();switch(t){case P.CREATE:return function(e){const t=e.child("group"),r=t.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",p.GROUP_PARTICIPANT_TYPES,"participant");return{id:(0,S.userJidToUserWid)(e.attrUserJid("jid")),isSuperAdmin:t===p.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===p.GROUP_PARTICIPANT_TYPES.admin||t===p.GROUP_PARTICIPANT_TYPES.superadmin}})),n=function(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent())return{content:e.contentString(),id:t.attrString("id")}}}return null}(t),i=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(t),a={subject:t.attrString("subject"),restrict:t.hasChild("locked"),announce:t.hasChild("announcement"),noFrequentlyForwarded:t.hasChild("no_frequently_forwarded"),ephemeralDuration:i?i.ephemeralDuration:void 0,owner:t.hasAttr("creator")?(0,S.userJidToUserWid)(t.attrUserJid("creator")):void 0,creation:t.attrTime("creation"),participants:r,desc:n?n.content:void 0,descId:n?n.id:void 0,subjectOwner:t.hasAttr("s_o")?(0,S.userJidToUserWid)(t.attrUserJid("s_o")):void 0,subjectTime:t.hasAttr("s_t")?t.attrTime("s_t"):void 0,support:t.hasChild("support"),pvId:t.attrInt("p_v_id")};return{action:P.CREATE,isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason"),groupInfo:a}}(e);case P.ADD:return(0,a.default)((0,a.default)({action:g.GROUP_ACTIONS.ADD},i(e)),{},{isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason")});case P.REMOVE:return(0,a.default)({action:P.REMOVE},i(e));case P.PROMOTE:return(0,a.default)({action:P.PROMOTE},i(e));case P.DEMOTE:return(0,a.default)({action:P.DEMOTE},i(e));case P.MODIFY:return(0,a.default)({action:g.GROUP_ACTIONS.MODIFY},i(e));case P.SUBJECT:return{action:g.GROUP_ACTIONS.SUBJECT,subject:e.attrString("subject"),s_o:e.hasAttr("s_o")?(0,S.userJidToUserWid)(e.attrUserJid("s_o")):null,s_t:e.hasAttr("s_t")?e.attrTime("s_t"):null};case P.DESC:return e.hasChild("delete")?{action:g.GROUP_ACTIONS.DESC_REMOVE,descId:e.attrString("id")}:{action:g.GROUP_ACTIONS.DESC_ADD,descId:e.attrString("id"),desc:e.hasChild("body")?e.child("body").contentString():null,descTime:n};case P.SUSPENDED:return{action:g.GROUP_ACTIONS.SUSPEND,value:!0};case P.UNSUSPENDED:return{action:g.GROUP_ACTIONS.SUSPEND,value:!1};case P.LOCKED:return{action:g.GROUP_ACTIONS.RESTRICT,value:!0};case P.UNLOCKED:return{action:g.GROUP_ACTIONS.RESTRICT,value:!1};case P.ANNOUNCE:return{action:g.GROUP_ACTIONS.ANNOUNCE,value:!0};case P.NOT_ANNOUNCE:return{action:g.GROUP_ACTIONS.ANNOUNCE,value:!1};case P.NO_FREQUENTLY_FORWARDED:return{action:g.GROUP_ACTIONS.NO_FORWARD,value:!0};case P.FREQUENTLY_FORWARDED_OK:return{action:g.GROUP_ACTIONS.NO_FORWARD,value:!1};case P.INVITE:return{action:g.GROUP_ACTIONS.INVITE_CODE,code:e.attrString("code")};case P.EPHEMERAL:return{action:g.GROUP_ACTIONS.EPHEMERAL,duration:e.attrInt("expiration")};case P.NOT_EPHEMERAL:return{action:g.GROUP_ACTIONS.EPHEMERAL,duration:0};case P.REVOKE_INVITE:return{action:g.GROUP_ACTIONS.REVOKE_INVITE,participants:e.mapChildrenWithTag("participant",(e=>({id:(0,S.userJidToUserWid)(e.attrUserJid("jid")),expiration:e.attrInt("expiration")})))};case P.GROWTH_UNLOCKED:return{action:g.GROUP_ACTIONS.GROWTH_UNLOCKED};case P.GROWTH_LOCKED:return{action:g.GROUP_ACTIONS.GROWTH_LOCKED,expiration:e.attrInt("expiration"),type:e.attrString("type")};default:throw new Error(`Unrecognized group action ${t}`)}}));return{externalId:e.attrString("id"),chatId:t,author:r,ts:e.attrTime("t"),pushname:e.hasAttr("notify")?e.attrString("notify"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null,actions:s}}));function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const[t,r]=yield Promise.all([(0,m.getTable)().get(e.toString()),(0,c.getTable)().get(e.toString())]);return!!t||!!r&&!!r.t}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e,t){const r=yield(0,T.getParticipantTable)().get(e);return!!r&&r.admins.includes(t)}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e,t){var r;const n=yield(0,m.getTable)().get(e);return!!n&&n.growthLockType===t&&(null!==(r=n.growthLockExpiration)&&void 0!==r?r:0)>u.Clock.globalUnixTime()}))).apply(this,arguments)}function L(e,t){var r;const n=null===(r=d.ChatCollection.get(e))||void 0===r?void 0:r.groupMetadata;if(!n)return t;const i=n.participants;return t.filter((e=>!i.get(e)))}function k(){return(k=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return;__LOG__(2,void 0,void 0,void 0,["groups"])`handle action ${t.action}`;const n=[];try{if(t.action===P.CREATE){const i=(0,a.default)((0,a.default)({},t.groupInfo),{},{id:e.chatId}),s=yield O(i.id);__LOG__(2,void 0,void 0,void 0,["groups"])`group id ${i.id} exists in storage = ${s}`,yield(0,y.handleGroupCreation)(e,i,r);const o=(0,h.getMaybeMeUser)();if(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreation done for group id ${i.id}`,s||n.push((0,_.genGroupCreationMsg)(e,i)),!o.equals(e.author)){const a={action:g.GROUP_ACTIONS.ADD,version:i.pvId,participants:[o],isInvite:t.isInvite};yield(0,y.handleGroupActionMD)(e,a,r),n.push((0,_.genGroupNotificationMsg)(e,a))}const{ephemeralDuration:l}=i;e.author&&null!=e.ts&&null!=l&&l>0&&n.push((0,_.genGroupEphemeralSettingMsg)(e.chatId,e.ts,e.author,l))}else if(t.action===g.GROUP_ACTIONS.ADD){const i=L(e.chatId,t.participants);yield(0,y.handleGroupActionMD)(e,t,r),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i.length&&n.push((0,_.genGroupNotificationMsg)(e,(0,a.default)((0,a.default)({},t),{},{participants:i})))}else{const i=yield G(t,e.chatId);yield(0,y.handleGroupActionMD)(e,t,r),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i||n.push((0,_.genGroupNotificationMsg)(e,t))}r?A.default.addOfflineMessage(n.map((e=>({msg:e})))):yield Promise.all(n.map((e=>(0,C.handleSingleMsgMD)(e.from,e))))}catch(e){__LOG__(2)`handleGroupNotification: failed with ${e}`}}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e,t){if(e.action===g.GROUP_ACTIONS.REVOKE_INVITE||e.action===g.GROUP_ACTIONS.SUSPEND)return!0;if(e.action===g.GROUP_ACTIONS.GROWTH_LOCKED||e.action===g.GROUP_ACTIONS.GROWTH_UNLOCKED){if(!(f.GK.supportsFeature(f.GK.F.MD_BACKEND)&&(0,l.getABPropConfigValue)("growth_lock_v0_enabled")))return!0;if(e.action===g.GROUP_ACTIONS.GROWTH_LOCKED){if("invite"!==e.type)return!0;if(yield D(t.toString(),e.type))return!0}const r=(0,h.getMaybeMeUser)();return!(yield w(t.toString(),r.toString()))}return!1}))).apply(this,arguments)}},19655:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleHistorySyncChunk=re,t.handleHistorySyncNotification=function(){return te.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(8584),o=r(72651),l=r(8243),c=n(r(45095)),d=r(92844),u=r(84902),p=r(86945),h=n(r(70714)),f=r(97401),_=n(r(48277)),m=r(68638),g=r(63183),y=n(r(70257)),E=r(16116),S=r(88102),v=n(r(69618)),T=r(90257),A=r(19380),C=r(5087),b=r(96751),P=r(26384),M=r(24808),O=r(27856),I=r(99234),w=r(57701),R=r(41796),D=n(r(63928)),N=r(49714),L=r(41037),k=r(73027),G=r(49801),U=n(r(11339)),F=n(r(39436)),x=r(76214),B=r(50313),K=r(5819),Y=n(r(32219)),j=r(58052),W=n(r(57220)),H=r(13493),V=n(r(76128)),$=r(74727),z=n(r(61426)),q=r(64551),J=r(27286),Q=r(93832),X=n(r(56891)),Z=n(r(39546)),ee=r(58021);function te(){return(te=(0,a.default)((function*(e,t,r){if(!e)return;const{downloadOptions:n}=e;if(!n)return;const a=!!e.historySyncNotification.originalMessageId,s=a?e.historySyncNotification.originalMessageId:r,o={msgKey:new Y.default({remote:t,fromMe:!0,id:s}).toString(),processed:0,downloadOptions:n,isReupload:1,historySyncStepStartedTs:(0,d.unixTimeMs)(),reuploadPending:!1,historySyncPayloadSize:e.historySyncNotification.fileLength};a&&e.historySyncNotification.syncType!==k.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP||(o.syncType=e.historySyncNotification.syncType,o.chunkOrder=e.historySyncNotification.chunkOrder||0,o.isReupload=0);const l=o;switch(new U.default.MdBootstrapHistoryDataReceived({mdBootstrapPayloadType:l.syncType===k.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?U.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:U.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapHistoryPayloadType:de(l.syncType),mdTimestamp:(0,d.unixTimeMs)(),mdSessionId:yield G.MdSyncFieldStatsMeta.getMdSessionId()}).commit(),l.syncType){case k.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP:case k.HistorySyncHistorySyncType.INITIAL_STATUS_V3:__LOG__(2)`[History sync initial sync received] ${se(l)}`,re(l);break;case k.HistorySyncHistorySyncType.PUSH_NAME:return __LOG__(2)`[History sync initial pushname received] ${se(l)}`,yield(0,L.enqueueNotification)((0,i.default)((0,i.default)({},l),{},{downloadOptions:(0,i.default)({},l.downloadOptions)}),!0),void re(l);default:__LOG__(2)`[History sync recent or full chunk received] adding chunk info to db: ${se(l)}`,yield(0,L.enqueueNotification)(l)}_.default.continueProgressiveHistorySyncProcessing()}))).apply(this,arguments)}function re(){return ne.apply(this,arguments)}function ne(){return(ne=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(__LOG__(2,void 0,void 0,void 0,["History sync"])`handleHistorySyncChunk started for ${se(e)}`,e.syncType===k.HistorySyncHistorySyncType.INITIAL_STATUS_V3)try{const t=Y.default.fromString(e.msgKey);(0,$.sendAggregateReceipts)(t.remote,$.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,(new Map).set(t.remote,[t.id]))}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: sending Status v3 receipt failed`}const n=e.syncType===k.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?U.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:U.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,m=new U.default.MdBootstrapHistoryDataDownloaded({mdBootstrapPayloadType:n,mdBootstrapPayloadSize:e.historySyncPayloadSize}),E=e.syncType!==k.HistorySyncHistorySyncType.PUSH_NAME&&!n;m.mdSessionId=yield G.MdSyncFieldStatsMeta.getMdSessionId();const w=yield G.MdSyncFieldStatsMeta.getStorageEstimation();w.mdStorageQuotaBytes!==G.STORAGE_QUOTA_UNAVAILABLE&&(m.mdStorageQuotaUsedBytes=w.mdStorageQuotaUsedBytes,m.mdStorageQuotaBytes=w.mdStorageQuotaBytes);let R=null;try{R=yield P.downloadManager.downloadAndDecrypt((0,i.default)({signal:(new h.default).signal},e.downloadOptions))}catch(r){if(__LOG__(3)`history sync download failed`,r instanceof O.HttpNetworkError)return e.syncType===k.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP&&t>0?(yield W.default.waitIfOffline({signal:(new h.default).signal}),__LOG__(3,void 0,void 0,void 0,["History sync"])`Initial sync download failed due to network error retry download`,re(e,t-1)):void(0,L.removeLocalFailureFromInFlightChunk)(e.msgKey);const n=Y.default.fromString(e.msgKey);return oe(m,e.historySyncStepStartedTs,!1),(0,z.default)(n.remote,n.id,e.downloadOptions.mediaKey),void(yield(0,L.markChunkForReuploadPending)(e.msgKey))}e.downloadOptions.mediaKey="",E&&(yield new Promise((e=>setTimeout(e,1e3)))),m.mdBootstrapStepResult=U.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS;const H=new s.Binary(R),X=yield(0,o.inflate)(H.readByteArray());E&&(yield new Promise((e=>setTimeout(e,1e3))));const te=(0,u.decodeProtobuf)(k.HistorySyncSpec,X);__LOG__(2)`[History sync chunk downloaded], ${se(e)}`,E&&(yield new Promise((e=>setTimeout(e,1e3))));const ne=new U.default.MdBootstrapDataApplied({mdBootstrapPayloadType:n,mdBootstrapSource:U.default.MD_BOOTSTRAP_SOURCE.HISTORY});if(ne.mdSessionId=yield G.MdSyncFieldStatsMeta.getMdSessionId(),e.syncType===k.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&te.statusV3Messages&&te.statusV3Messages.length>0?(m.mdBootstrapMessagesCount=te.statusV3Messages.length,oe(m,e.historySyncStepStartedTs,!0),yield Promise.all(te.statusV3Messages.map(function(){var e=(0,a.default)((function*(e){const t={type:N.MESSAGE_TYPE.OTHER_STATUS,externalId:(0,c.default)(e.key.id,"msg.key.id"),ts:(0,d.castToUnixTime)(parseInt(e.messageTimestamp,10)),edit:-1,isHsm:!1,count:null,chat:(0,ee.createWid)(v.default.STATUS_WID),author:!0===e.key.fromMe?(0,I.getMeUser)():(0,ee.createWid)((0,c.default)(e.participant,"msg.participant")),pushname:null,isDirect:!1},r=yield(0,J.parseMessage)(t,"skmsg",(0,c.default)(e.message,"msg.message"),void 0),n=r.renderableMsgs&&r.renderableMsgs;if(!n||1!==n.length)return Promise.resolve();const i=n[0];return"0@s.whatsapp.net"!==e.participant||(0,p.getABPropConfigValue)("web_status_psa_history_sync")&&null!=i.staticUrl?(0,K.handleSingleMsgMD)(i.id.remote,i,!1):Promise.resolve()}));return function(){return e.apply(this,arguments)}}())),yield(0,L.updateCurrentlyProcessed)(e.msgKey),ne.mdTimestamp=(0,d.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync storing Status V3 complete], ${se(e,te.statusV3Messages.length)}`):e.syncType!==k.HistorySyncHistorySyncType.PUSH_NAME&&(te.conversations=te.conversations.reduce(((e,t)=>{let r=null;try{r=(0,ee.createWid)(t.id)}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: invalid wid`}return r?e.concat(t):e}),[])),e.syncType===k.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP){const t={},r=(0,I.assertGetMe)(),n=(0,ee.toUserWid)(r),i=r.getDeviceId(),a={},s={},o=[];let c=0;const u=[];te.conversations.forEach((r=>{var d,h,f;let _=[];c+=r.messages.length;let m=[];r.messages.forEach(((n,i)=>{i===r.messages.length-1&&(t[r.id]=n.msgOrderId);const a=le(e,n.message);m.push(a),_=_.concat(ce(a))})),m=m.filter(Boolean).reverse(),r.pHash&&(s[r.id]=r.pHash);const y=(0,ee.createWid)(r.id),E=r.contactPrimaryIdentityKey;if(E&&Z.default.isUser(y)){const e=(0,Q.createSignalAddress)((0,ee.toUserWid)(y)).toString(),t=(0,Q.bufferToStr)((0,C.toSignalCurvePubKey)(E));y.equals((0,I.getMeUser)())?ue(e,t):u.push({identifier:e,identityKey:t})}const S=(0,I.getGlobalSecurityNotifications)()&&!(0,p.getABPropConfigValue)("adv_v2_m6");if(!y.isStatusV3()&&S){const e=(0,T.genDeviceNotificationMsg)((0,ee.createWid)(r.id),n,[i],[]);m.push(e)}let v;if(null!=(null===(d=r.disappearingMode)||void 0===d?void 0:d.initiator))switch(r.disappearingMode.initiator){case M.DisappearingModeInitiator.CHANGED_IN_CHAT:v=b.DisappearingModeInitiator.ChangedInChat;break;case M.DisappearingModeInitiator.INITIATED_BY_ME:v=b.DisappearingModeInitiator.InitiatedByMe;break;case M.DisappearingModeInitiator.INITIATED_BY_OTHER:v=b.DisappearingModeInitiator.InitiatedByOther}const A=null!=r.tcToken&&null!=r.tcTokenTimestamp,P={t:(0,l.maybeNumberOrThrowIfTooLarge)(null!==(h=r.conversationTimestamp)&&void 0!==h?h:r.lastMsgTimestamp),id:(0,ee.createWid)(r.id),unreadCount:r.unreadCount,ephemeralDuration:r.ephemeralExpiration,ephemeralSettingTimestamp:r.ephemeralSettingTimestamp,disappearingModeInitiator:v,endOfHistoryTransferType:null!==(f=r.endOfHistoryTransferType)&&void 0!==f?f:g.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE,name:r.name,notSpam:r.notSpam,pendingInitialLoading:!1,unreadMentionCount:r.unreadMentionCount,tcToken:A?r.tcToken:null,tcTokenTimestamp:A?r.tcTokenTimestamp:null};r.suspended&&D.default.add({id:P.id,suspended:!0},{merge:!1}),o.push(P),a[r.id]={chatInfo:P,msgs:m,reactionMessages:_}})),m.mdBootstrapMessagesCount=c,m.mdBootstrapChatsCount=te.conversations.length,oe(m,e.historySyncStepStartedTs,!0),_.default.markInitialHistorySyncCountDebugStats(c,o.length);const h=te.conversations.some((e=>void 0!==e.unreadMentionCount));(0,I.setUnreadMentionCountEnabled)(h),yield V.default.bulkCreateIdentity(u),yield(0,y.default)([{cmd:"preempt",response:o,binarySize:10}])||Promise.resolve(),yield(0,K.handleInitialSyncMsgs)(a),yield(0,L.updateCurrentlyProcessed)(e.msgKey),ne.mdTimestamp=(0,d.unixTimeMs)(),ne.commit(!0),__LOG__(2)`[History sync storing initial sync complete] ${se(e,c,o.length)}`,yield he(te),(0,B.setHistoryInitialSyncBoundry)(t),(0,B.setInitialGroupPhash)(s)}else if(e.syncType===k.HistorySyncHistorySyncType.PUSH_NAME){oe(m,e.historySyncStepStartedTs,!0);const t=te.pushnames.map((e=>({id:e.id||"",pushname:e.pushname||""})));yield(0,x.getContactTable)().bulkCreateOrMerge(t),yield(0,L.updateCurrentlyProcessed)(e.msgKey);const r=te.pushnames.map((e=>{const t=(0,ee.createWid)(e.id||""),r=A.ContactCollection.get(t);return{id:t,pushname:e.pushname||"",type:(null==r?void 0:r.type)||"out",name:null==r?void 0:r.name}}));A.ContactCollection.add(r,{merge:!0}),ne.mdTimestamp=(0,d.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync storing initial pushname complete] with ${te.pushnames.length} records`}else if(e.syncType!==k.HistorySyncHistorySyncType.INITIAL_STATUS_V3){yield new Promise((e=>setTimeout(e,0)));const t=[];let n=[];const i=new Set,a=[],s=(0,B.getHistoryInitialSyncBoundry)();let o=0,c=0;for(let d=0;d<te.conversations.length;d++){const u=te.conversations[d],p=null==s?void 0:s[u.id];for(let s=0;s<u.messages.length;s++){const d=r(69951).ChatCollection.get((0,ee.createWid)(u.id)),h=(null==d?void 0:d.endOfHistoryTransferType)===g.ConversationEndOfHistoryTransferModelPropType.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY;if(!d&&null!=p||d&&null==d.endOfHistoryTransferType||h){__LOG__(2,void 0,void 0,void 0,["History sync"])`One chat in sync payload ${se(e)} is already marked as complete locally`;break}o++;const _=u.messages[s],m=(0,l.maybeNumberOrThrowIfTooLarge)(_.msgOrderId);if(null!=p&&null!=m&&m>=p)continue;i.add(u.id);const y=le(e,_.message);0===s&&y&&d&&0===d.msgs.length&&a.push(y),n=n.concat(ce(y)),y&&t.push(y),yield(0,f.asyncSleepAfterGivenLoopIteration)(c++,100)}}m.mdBootstrapMessagesCount=o,m.mdBootstrapChatsCount=te.conversations.length,oe(m,e.historySyncStepStartedTs,!0),0!==t.length&&(yield(0,K.handleProgressiveHistorySyncMsgs)(t,Array.from(i),n,a)),(0,j.setLastHistorySycnedChunk)(e.syncType,e.chunkOrder),yield(0,L.updateCurrentlyProcessed)(e.msgKey);const u=new Set;te.conversations.forEach((e=>{u.add((0,ee.createWid)(e.id).toString());const t=e.endOfHistoryTransferType;if(null!=t)return ie((0,ee.createWid)(e.id),t)})),S.Cmd.onHistorySyncChunkProcessed(u),ne.mdTimestamp=(0,d.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync chunk storing recent or full chunk complete,  ${se(e,o)}`}const ae=Y.default.fromString(e.msgKey),de=new Map;var pe;de.set(ae.remote,[ae.id]),e.syncType!==k.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&(0,$.sendAggregateReceipts)(ae.remote,$.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,de),yield(0,L.updateCurrentlyProcessed)(e.msgKey),q.ServerProps.webMdMmsSyncDeletionRequest&&null!=e.downloadOptions.encFilehash&&F.default.deleteMdHistorySyncBlob({directPath:e.downloadOptions.directPath,encFilehash:e.downloadOptions.encFilehash,signal:(new h.default).signal}).catch((()=>{__LOG__(3)`MMS client delete error`})),pe=te.progress,e.syncType===k.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?((0,j.setInitialHistorySyncComplete)(),(0,j.setHistorySyncStatus)({initialCompleted:!0}),S.Cmd.onInitialChatHistorySynced()):e.syncType===k.HistorySyncHistorySyncType.RECENT&&100===pe?(__LOG__(2,void 0,void 0,void 0,["History sync"])`Recent history sync complete`,(0,B.setHistoryInitialSyncBoundry)({}),(0,j.setHistorySyncStatus)({recentCompleted:!0}),S.Cmd.onRecentChatHistorySynced()):e.syncType===k.HistorySyncHistorySyncType.FULL&&100===pe&&(__LOG__(2,void 0,void 0,void 0,["History sync"])`Full history sync complete`,(0,B.setHistoryInitialSyncBoundry)({}),(0,j.setHistorySyncStatus)({fullCompleted:!0}),S.Cmd.onFullChatHistorySynced())}))).apply(this,arguments)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,a.default)((function*(e,t){const r=t,n=(0,R.getBridge)();yield n.sendAndReceive("chat_collection","add",{things:[{id:e,endOfHistoryTransferType:r}],options:{merge:!0}}),yield(0,m.getTable)().merge(e.toString(),{endOfHistoryTransferType:r})}))).apply(this,arguments)}function se(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(e.msgKey||"").split("_")[2];return` type_${e.syncType}_order_${null!=e.chunkOrder?e.chunkOrder:"none"}_isReupload_${e.isReupload||0}}, id: ${n} ## msgCount: ${t}, chatCount: ${r}`}function oe(e,t,r){e.mdTimestamp=(0,d.unixTimeMs)(),e.mdBootstrapStepDuration=(0,d.unixTimeMs)()-t,e.mdBootstrapStepResult=r?U.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:U.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,e.commit()}function le(e,t){let r=null;try{r=X.default.parseWebMessageInfo(t,"after")}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMessageInfo failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return r}function ce(e){const t=[];try{(0,w.parseWMIReaction)()&&null!=e&&e.reactions.forEach((r=>{const{key:n,senderTimestampMs:i,text:a,unread:s}=r,o=(0,H.convertToTextWithoutSpecialEmojis)(null!=a?a:""),l=!!n.fromMe,c=(0,H.decodeJid)(n.remoteJid);let d;n.fromMe?c.isUser()||(d=(0,I.getMeUser)()):d=(0,H.decodeJid)(n.participant);const u=new Y.default({id:n.id,fromMe:l,remote:c,participant:d}),p=(0,I.getMeUser)(),h=!0===l?p:d||c;null!=h&&h instanceof Z.default?null==o?__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction:convertToTextWithoutSpecialEmojis reaction text is null.`:t.push({id:u,reactionTimestamp:i,reactionText:o,reactionParentKey:e.id,sender:h,unread:Boolean(s)}):__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction: reaction sender should be a wid.`}))}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMsgInfoReaction failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return t}function de(e){switch(e){case 0:return U.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.INITIAL;case 1:return U.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.STATUS_V3;case 2:return U.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.FULL_HISTORY;case 3:return U.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.RECENT_HISTORY;default:return U.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.PUSHNAME}}function ue(){return pe.apply(this,arguments)}function pe(){return(pe=(0,a.default)((function*(e,t){const r=yield V.default.loadIdentityKey(e);r&&r!==t&&(__LOG__(4,void 0,new Error,!0,["history-sync"])`get changed self identity key from history sync,
exisiting length: ${r.length}, new length: ${t.length}`,SEND_LOGS("self-identity-change-from-history-sync"))}))).apply(this,arguments)}function he(e){let t=Promise.resolve(),r=Promise.resolve();return null!=e.threadIdUserSecret&&(t=(0,E.setThreadIdUserSecret)(e.threadIdUserSecret)),null!=e.threadDsTimeframeOffset&&(r=(0,E.setThreadDsTimeframeOffset)(e.threadDsTimeframeOffset)),Promise.all([t,r])}},46462:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleE2eIdentityChange=function(e){const t=S.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const{wid:r,stanzaId:n,delay:s,offline:u}=t.success,v=(0,a.wap)("ack",{to:(0,E.DEVICE_JID)(r),id:(0,a.CUSTOM_STRING)(n),class:"notification"});if(null!=r.device&&r.device!==o.default.DEVICE.PRIMARY_DEVICE)return __LOG__(2)`handleNewIdentity: ignore identity change from companion device`,Promise.resolve(v);if(r.equals((0,l.getMeUser)()))return(0,d.handleSelfPrimaryIdentityChange)(),Promise.resolve(v);const T=!!u&&!c.OfflineMessageHandler.isResumeFromRestartComplete();return(0,h.handleMessage)(String(r),T,(0,i.default)((function*(){yield(0,d.clearDeviceRecordForIdentityChange)(r,T);return(yield(0,f.getSignalProtocolStore)().loadIdentityKey((0,y.createSignalAddress)(r).toString()))&&(__LOG__(2)`handleE2eIdentityChange: ${r.toString()} has old identity, establishing new session`,yield g.Session.deleteRemoteInfo(r),(0,_.addSecurityCodeChangedNotifications)(r,T),(0,m.sendTcTokenWhenDeviceIdentityChange)(r),T||(null!=s?(0,p.ensureE2ESessionsWithDelay)([r],s):(0,p.ensureE2ESessions)([r]))),v})))};var i=n(r(48926)),a=r(31914),s=r(71914),o=n(r(69618)),l=r(99234),c=r(28237),d=r(1291),u=r(85553),p=r(97398),h=r(15746),f=r(52083),_=r(9701),m=r(41088),g=r(77605),y=r(93832),E=r(39410);const S=new s.WapParser("identityChange",(e=>{e.assertTag("notification"),e.assertAttr("type","encrypt"),e.child("identity");const t=parseInt(e.maybeAttrString("delay"),10);return{wid:(0,u.deviceJidToDeviceWid)(e.attrDeviceJid("from")),stanzaId:e.attrString("id"),delay:isFinite(t)&&t>0?t:null,offline:e.hasAttr("offline")?e.attrString("offline"):null}}))},65341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SUPPORTED_DIRTY_TYPE=t.SUPPORTED_DIRTY_PROTOCOLS=void 0,t.handleDirtyBits=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(41075),s=r(99609),o=r(88102),l=r(45606),c=n(r(69153)),d=r(99234),u=r(28237),p=n(r(11339)),h=r(46308),f=r(74028),_=r(38804);const m={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state"};t.SUPPORTED_DIRTY_TYPE=m;function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((e=>a.ACCOUNT_SYNC_TYPE.cast(e))).filter(Boolean);return 0===t.length&&(t=[...a.ACCOUNT_SYNC_TYPE.members()]),Promise.all(t.map((e=>e===a.ACCOUNT_SYNC_TYPE.DEVICES?S():e===a.ACCOUNT_SYNC_TYPE.PICTURE?(0,a.getAndUpdateProfilePicture)():void(e===a.ACCOUNT_SYNC_TYPE.PRIVACY?(0,a.updatePrivacySettings)():e===a.ACCOUNT_SYNC_TYPE.BLOCKLIST&&(0,a.updateBlocklist)()))))}function y(e){return null!=e.patches&&e.patches.length>0||null!=e.snapshot}function E(){return o.Cmd.once(o.APP_STATE_SYNC_COMPLETED,(e=>{const t=e.some(y);new p.default.MdAppStateDirtyBits({dirtyBitsFalsePositive:!t}).commit()})),(0,_.markCollectionsForSync)([...l.CollectionName.members()])}function S(){const e=String((0,d.getMeUser)());return u.OfflineMessageHandler.isResumeFromRestartComplete()?u.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress()?(0,h.addUserToPendingDeviceSync)([e]):(0,a.getDevices)("notification"):(c.default.addOfflinePendingDevice(e,null),Promise.resolve())}function v(){return(v=(0,i.default)((function*(e){const{supported:t,unsupported:r,protocols:n}=e;__LOG__(2)`handleDirtyBits: handle dirty bits, supported: ${t.map((e=>e.type)).join(",")}, unsupported: ${r.map((e=>e.type)).join(",")}`;const i=[...r,...t];return yield Promise.all(t.map((e=>{const t=e.type;return t===m.groups?(0,f.queryAndUpdateAllGroupMetadata)():t===m.account_sync?g(n):t===m.syncd_app_state?E():void 0}))),(0,s.clearDirtyBits)(i)}))).apply(this,arguments)}t.SUPPORTED_DIRTY_PROTOCOLS={devices:"devices",picture:"picture",privacy:"privacy",blocklist:"blocklist"}},89816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAINS=void 0,t.handleRoutingInfo=function(e){let t=e.domain;if(!t){const e=(0,i.getRoutingInfo)();t=e?e.domain:a.fb}const r=(0,n.bytesToBuffer)(e.edgeRouting);(0,i.setRoutingInfo)({domain:t,edgeRouting:r}),__LOG__(2)`handleInfoBulletin setting and domain: ${t} and edgeRouting:`};var n=r(87614),i=r(58052);const a={fb:"fb",sl:"sl"};t.DOMAINS=a},8898:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(71914),s=r(88102),o=r(65341),l=r(89816),c=r(25773),d=r(28237),u=r(70768),p=r(37222);const h=new a.WapParser("infoBulletinParser",(e=>{if(e.assertTag("ib"),e.assertFromServer(),e.hasChild(p.INFO_TYPE.DIRTY)){const t=[],r=[],n=[];return e.forEachChildWithTag(p.INFO_TYPE.DIRTY,(e=>{const i={type:e.attrString("type"),timestamp:e.attrInt("timestamp")};if("account_sync"===i.type){e.mapChildren((e=>e.tag())).forEach((e=>{o.SUPPORTED_DIRTY_PROTOCOLS.hasOwnProperty(e)&&n.push(e)})),r.push(i)}else o.SUPPORTED_DIRTY_TYPE.hasOwnProperty(i.type)?r.push(i):t.push(i)})),{type:p.INFO_TYPE.DIRTY,supported:r,unsupported:t,protocols:n}}if(e.hasChild(p.INFO_TYPE.ROUTING)){const t=e.child(p.INFO_TYPE.ROUTING);return{type:p.INFO_TYPE.ROUTING,edgeRouting:t.child("routing_info").contentBytes(),domain:t.hasChild("dns_domain")?t.child("dns_domain").contentEnum(l.DOMAINS):null}}if(e.hasChild(p.INFO_TYPE.DOWNGRADE))return{type:p.INFO_TYPE.DOWNGRADE};if(e.hasChild(p.INFO_TYPE.OFFLINE))return{count:e.child(p.INFO_TYPE.OFFLINE).attrInt("count"),type:p.INFO_TYPE.OFFLINE};if(e.hasChild(p.INFO_TYPE.OFFLINE_PREVIEW))return{count:{message:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("message"),receipt:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("receipt"),notification:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("notification")},type:p.INFO_TYPE.OFFLINE_PREVIEW};if(e.hasChild(p.INFO_TYPE.TOS)){const t=[];return e.child("tos").forEachChildWithTag("notice",(e=>{t.push(e.attrString("id"))})),{type:p.INFO_TYPE.TOS,noticeIds:t}}return null}));function f(){return(f=(0,i.default)((function*(e){const t=h.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const r=t.success;if(r)switch(r.type){case p.INFO_TYPE.DIRTY:return yield(0,o.handleDirtyBits)(r),"NO_ACK";case p.INFO_TYPE.ROUTING:return(0,l.handleRoutingInfo)(r),"NO_ACK";case p.INFO_TYPE.DOWNGRADE:return s.Cmd.downgradeWebclient(),"NO_ACK";case p.INFO_TYPE.OFFLINE:return d.OfflineMessageHandler.setOfflineSessionComplete(r.count),(0,c.reportOfflineNotifications)(),"NO_ACK";case p.INFO_TYPE.OFFLINE_PREVIEW:return yield d.OfflineMessageHandler.setOfflineMessagePreviewCounter(r.count),"NO_ACK";case p.INFO_TYPE.TOS:return u.TosManager.maybeUpdateServer(r.noticeIds),"NO_ACK"}else __LOG__(3)`handleInfoBulletin unrecognized info bulletin`}))).apply(this,arguments)}},37222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INFO_TYPE=void 0;const r=Object.freeze({DIRTY:"dirty",DOWNGRADE:"downgrade_webclient",ROUTING:"edge_routing",OFFLINE:"offline",OFFLINE_PREVIEW:"offline_preview",TOS:"tos"});t.INFO_TYPE=r},70605:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(15688),s=n(r(45095)),o=r(31914),l=r(71914),c=r(99234),d=r(98969),u=r(16258),p=r(3151),h=r(39410);const f=new l.WapParser("mediaRetryNotification",(e=>{e.assertTag("notification");const t=e.maybeChild("error");if(t)return{msgId:e.attrString("id"),ciphertext:null,iv:null,errorCode:u.MediaRetryNotificationResultType.cast(t.attrInt("code"))};const r=e.child("encrypt");return{msgId:e.attrString("id"),ciphertext:r.child("enc_p").contentBytes(),iv:r.child("enc_iv").contentBytes(d.ENC_IV_SIZE),errorCode:null}}));function _(){return(_=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{msgId:r,errorCode:n}=t.success,i=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(r),class:"notification",type:"mediaretry",to:(0,h.USER_JID)((0,c.getMeUser)())});if(null!=n)return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:r,result:n}),i;const{ciphertext:l,iv:u}=t.success,_=p.RequestMediaReuploadManager.getMediaKey(r);if(!_)return __LOG__(3)`handleMediaRetryNotification: mediaKey is not found for msgId ${r}`,i;const{stanzaId:m,directPath:g,result:y}=yield(0,d.decryptMediaRetryNotification)((0,a.decodeB64)(_),r,(0,s.default)(u,"iv"),(0,s.default)(l,"ciphertext"));if(m!==r)throw new Error("handleMediaRetryNotification: msg id does not match");return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:r,result:y,directPath:g}),i}))).apply(this,arguments)}},80278:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptE2EPayload=function(){return A.apply(this,arguments)};var a=i(r(48926)),s=r(50796),o=r(66751),l=r(45763),c=r(58853),d=i(r(69618)),u=r(6303),p=r(8001),h=r(49714),f=r(12037),_=r(45033),m=r(84886),g=i(r(11339)),y=r(53348),E=r(52083),S=n(r(77605)),v=r(27286);function T(e,t,r){const{e2eType:n,ciphertext:i}=e;switch(n){case _.CiphertextType.Skmsg:return t.isGroup()||t.isBroadcast()?r?S.Cipher.decryptGroupSignalProto(t,r,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`)):Promise.reject(new Error(`['messaging'] decryptEnc: Can not do skmsg for non group ${t.toString()}`));case _.CiphertextType.Pkmsg:case _.CiphertextType.Msg:const e=t.isUser()?t:r;return e?S.Cipher.decryptSignalProto(e,n,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`))}}function A(){return(A=(0,a.default)((function*(e){const{bizInfo:t,msgInfo:r,paymentInfo:n,deviceIdentity:i,encs:_}=e;if(null!=r.author.device&&0!==r.author.device){if(!(yield(0,l.validateADVwithEncs)(r.author,i,_,!!r.offline)))return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, validateADVIdentity failed`,{result:h.E2EProcessResult.RETRY,retryCount:_[0].retryCount}}const S=yield(0,o.promiseReduce)(e.encs,((e,i)=>{if(e.result!==h.E2EProcessResult.SUCCESS)return Promise.resolve(e);const o=(0,v.getFrom)(r),l=new g.default.E2eMessageRecv({e2eCiphertextType:(0,c.metricsCiphertextType)(i.e2eType),e2eCiphertextVersion:c.CIPHERTEXT_VERSION,e2eDestination:(0,c.metricsDestinationType)(o),e2eSuccessful:!1,messageMediaType:i.mediaType?(0,c.metricsMediaType)(i.mediaType):g.default.MEDIA_TYPE.NONE,retryCount:i.retryCount});return T(i,o,r.author).then(function(){var e=(0,a.default)((function*(e){l.e2eSuccessful=!0,l.weight=1e3,l.commit();const a={retryCount:i.retryCount,e2eType:i.e2eType,mediaType:i.mediaType,hideFail:i.hideFail};return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId} done`,yield(0,y.processDecryptedProto)(e,r,n,a,t),__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${r.externalId} done`,{result:h.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}()).catch((0,s.filteredCatch)([p.SignalDecryptionError,u.UnknownMessageError],function(){var e=(0,a.default)((function*(e){return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, ${e.toString()}`,l.weight=1,l.commit(),i.hideFail||(yield(0,y.processPlaceholderMsg)(r,h.PlaceholderType.E2E)),{result:h.E2EProcessResult.RETRY,retryCount:i.retryCount}}));return function(){return e.apply(this,arguments)}}())).catch((0,s.filteredCatch)(p.SignalMessageCounterError,function(){var e=(0,a.default)((function*(e){if(__LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, signal counter error: ${e}`,null!=r.offline&&"peer"!==r.category){const e=(0,v.messageInfoToKey)(r),t=yield(0,m.getMsgByMsgKey)(e);if(null==t&&(__LOG__(4,void 0,new Error,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, creating placeholder (upload logs for debugging)`,SEND_LOGS("handleMsg: decryption counter error creating placeholder"),i.hideFail||(yield(0,y.processPlaceholderMsg)(r,h.PlaceholderType.E2E))),null==t||t.type===d.default.MSG_TYPE.CIPHERTEXT)return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, missing message for repeated signal counter`,{result:h.E2EProcessResult.RETRY,retryCount:i.retryCount}}return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, ignore repeated signal counter`,{result:h.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}())).catch((0,s.filteredCatch)(f.HsmMismatchError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: hsm mismatch error"),l.weight=1,l.commit(),{result:h.E2EProcessResult.HSM_MISMATCH})))).catch((0,s.filteredCatch)(u.ReactionValidationError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: ReactionValidationError"),{result:h.E2EProcessResult.PARSE_VALIDATION_ERROR})))).catch((e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: parse decrypted message error"),l.weight=1,l.commit(),{result:h.E2EProcessResult.PARSE_ERROR})))}),{result:h.E2EProcessResult.SUCCESS});return yield(0,E.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),S}))).apply(this,arguments)}},6303:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageError=t.ReactionValidationError=t.DeviceSentMessageError=void 0;var i=r(40265),a=n(r(11339));class s extends((0,i.customError)("DeviceSentMessageError")){constructor(e,t){t===a.default.DSM_ERROR.MISSING_DSM?super("parseMessage: message should be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_SENDER?super("parseMessage: message should not be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_DSM?super("parseMessage: invalid deviceSentMessage"):super("parseMessage: unknown deviceSentMessage error"),new a.default.MdBadDeviceSentMessage({peerType:e,dsmError:t}).commit(),this.peerType=e,this.dsmError=t}}t.DeviceSentMessageError=s;class o extends((0,i.customError)("UnknownMessageError")){}t.UnknownMessageError=o;class l extends((0,i.customError)("ReactionValidationError")){}t.ReactionValidationError=l},49714:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaceholderType=t.MESSAGE_TYPE=t.HostStorageEnumType=t.E2EProcessResult=t.ActualActorsEnumType=void 0;const n=r(54302)({Self:1,Bsp:2});t.ActualActorsEnumType=n;const i=r(54302)({OnPremise:1,Facebook:2});t.HostStorageEnumType=i;const a=r(54302).Mirrored(["SUCCESS","RETRY","HSM_MISMATCH","BACKFILL","PARSE_ERROR","PARSE_VALIDATION_ERROR"]);t.E2EProcessResult=a;const s=r(54302).Mirrored(["E2E","FANOUT"]);t.PlaceholderType=s;const o=Object.freeze({CHAT:"chat",GROUP:"group",PEER_BROADCAST:"peer_broadcast",OTHER_BROADCAST:"other_broadcast",DIRECT_PEER_STATUS:"direct_peer_status",OTHER_STATUS:"other_status"});t.MESSAGE_TYPE=o},70569:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=u.incomingMsgParser.parse(e);if(t.error){const r=u.incomingMsgParserForAckOnly.parse(e);if(r.error)return Promise.reject(t.error);const{externalId:n,from:i,type:a}=r.success;return(0,h.sendAck)(n,i,a)}{const e=t.success,{msgMeta:r,msgInfo:n}=e;return null!=n.offline&&(l.OfflineMessageHandler.addOfflinePendingMessage(),l.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete()),l.OfflineMessageHandler.isResumeFromRestartComplete()&&delete e.msgInfo.offline,(0,c.handleMessage)(n.chat.toString(),!!e.msgInfo.offline,(0,i.default)((function*(){if(r.isUnavailable&&(__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${n.externalId}, get fanout placeholder`,yield(0,p.processPlaceholderMsg)(n,s.PlaceholderType.FANOUT),(0,h.sendReceipt)(n,r,{result:s.E2EProcessResult.BACKFILL})),null!=n.offline){const t=yield l.OfflineMessageHandler.decryptOfflineMessage(e);t.result!==s.E2EProcessResult.SUCCESS||n.category===o.CATEGORY_PEER?(0,h.sendReceipt)(n,r,t):d.default.addOfflineMessage([{receiptInfo:{externalId:n.externalId,from:(0,h.getFrom)(n),author:n.author}}])}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${n.externalId}, start processing inline message`;const t=yield(0,a.decryptE2EPayload)(e);(0,h.sendReceipt)(n,r,t)}})))}};var i=n(r(48926)),a=r(80278),s=r(49714),o=r(12037),l=r(28237),c=r(15746),d=n(r(29783)),u=r(20365),p=r(53348),h=r(27286)},12037:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERIFIED_LEVEL=t.PAY_NODE_TYPES=t.MSG_TYPES=t.HsmMismatchError=t.CATEGORY_PEER=void 0;var n=r(40265);t.MSG_TYPES={text:"text",media:"media",pay:"pay",reaction:"reaction"};t.VERIFIED_LEVEL={high:"high",low:"low",unknown:"unknown"};t.CATEGORY_PEER="peer";class i extends((0,n.customError)("HSMMismatchError")){}t.HsmMismatchError=i;t.PAY_NODE_TYPES={send:"send",request:"request",futureproof:"futureproof","request-decline":"request-decline","request-cancel":"request-cancel",invite:"invite"}},48616:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logReceivedMessagesInWAM=function(e,t,r,n){(function(e,t,r,n){const i=a.Clock.globalUnixTimeMilliseconds();e.forEach((e=>{const a=new u.Msg(e),h=new d.default.MessageReceive({messageType:a.getWamMessageType(),messageMediaType:a.getWamMediaType(),messageIsInternational:a.isInternational,messageIsOffline:t});if(a.from.isGroup()){var f;const e=null===(f=c.default.get(a.from))||void 0===f?void 0:f.cachedDeviceSizeBucket;null!=e&&(h.deviceSizeBucket=e)}else{const e=(0,l.getDisappearingModeSettingForUser)(a.from);null!=e&&(h.senderDefaultDisappearingDuration=e.duration);const t=(0,o.getMaybeMeUser)(),r=(0,l.getDisappearingModeSettingForUser)(t);null!=r&&(h.receiverDefaultDisappearingDuration=r.duration)}null!=n&&(h.messageReceiveT0=n-r,h.messageReceiveT1=i-n),null!=a.ephemeralDuration&&a.ephemeralDuration>0&&(h.ephemeralityDuration=a.ephemeralDuration);const _=a.getWamDisappearingModeInitiator();if(null!=_&&(h.disappearingChatInitiator=_),h.commit(),a.chat&&!a.isSentByMe)if((0,s.shouldBlockByCountry)(a.chat.contact)){new d.default.GatedMessageReceived({chatGatedReason:d.default.CHAT_GATED_REASON.COUNTRY}).commit()}else if((0,p.shouldBlockByTos)(a.chat.contact)){new d.default.GatedMessageReceived({chatGatedReason:d.default.CHAT_GATED_REASON.TOS3}).commit()}}))})(e,t,r,n),function(e){(0,i.handleMessagesForChatThreadLogging)(e.map((e=>({fromMe:e.id.fromMe,ts:e.t,chatId:e.id.remote.toString({legacy:!0})}))))}(e)};var i=r(16116),a=r(22683),s=r(47473),o=r(99234),l=r(242),c=n(r(63928)),d=n(r(11339)),u=r(17304),p=r(37894)},20365:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.incomingMsgParserForAckOnly=t.incomingMsgParser=void 0;var i=n(r(81109)),a=r(71914),s=r(2599),o=r(22683),l=r(99234),c=r(49714),d=r(12037),u=r(85553),p=r(45033),h=r(75295),f=r(52586),_=r(27286),m=r(21224),g=r(58021);const y=new a.WapParser("incomingMsgParser",(e=>{e.assertTag("message"),e.hasAttr("to")&&e.assertAttr("to",(0,l.assertGetMe)().toJid());const t=e.mapChildrenWithTag("enc",(e=>({e2eType:e.attrEnumValues("type",p.CiphertextType.members()),mediaType:p.MediaType.cast(e.maybeAttrString("mediatype")),ciphertext:e.contentBytes(),retryCount:e.hasAttr("count")?e.attrInt("count"):0,hideFail:"hide"===e.maybeAttrString("decrypt-fail")}))),r=e.maybeChild("device-identity"),n=r?r.contentBytes():null,a=function(e,t){const r={externalId:e.attrString("id"),ts:e.attrTime("t"),edit:e.hasAttr("edit")?e.attrInt("edit"):-1,isHsm:e.hasChild("hsm"),count:e.hasAttr("count")?e.attrInt("count"):null,pushname:e.hasAttr("notify")?e.attrString("notify"):null,category:e.hasAttr("category")?e.attrString("category"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null,clientReceivedTsMillis:o.Clock.globalUnixTimeMilliseconds()},n=(0,u.jidWithTypeToWid)(e.attrJidWithType("from")),a=e.hasAttr("participant")?(0,u.deviceJidToDeviceWid)(e.attrDeviceJid("participant")):null,s=e.hasAttr("recipient")?(0,u.userJidToUserWid)(e.attrUserJid("recipient")):null,l=t.every((e=>e.e2eType!==p.CiphertextType.Skmsg)),d=t.some((e=>e.retryCount>0));let h;const f={},m=e.maybeChild("participants");if(m){const e=[];m.forEachChildWithTag("to",(t=>{const r=(0,u.deviceJidToDeviceWid)(t.attrDeviceJid("jid")),n=t.maybeAttrString("eph_setting");e.push(r),null!=n&&(f[r.toString()]=n)})),h=e}if(n.isUser())return null!=s?(0,_.isPeer)(n)?(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.CHAT},r),{},{chat:(0,g.toUserWid)(s),author:n}):e.throw("recipient on non peer chat message"):(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.CHAT},r),{},{chat:(0,g.toUserWid)(n),author:n});if(n.isGroup())return null==a?e.throw("group message with no participant"):(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.GROUP},r),{},{chat:n,author:a,isDirect:l});if(n.isBroadcast()&&!n.isStatusV3()){if(null==a)return e.throw("broadcast message with no participant");if((0,_.isPeer)(a)){if(null==h){if(!d)return e.throw("peer broadcast message with no participants node");h=[]}return(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.PEER_BROADCAST},r),{},{chat:n,author:a,isDirect:l,bclParticipants:h,bclHashValidated:!1,bclEphSettings:f})}return(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.OTHER_BROADCAST},r),{},{chat:n,author:a,isDirect:l,ephSetting:e.maybeAttrString("eph_setting")})}return n.isBroadcast()&&n.isStatusV3()?null==a?e.throw("status message with no participant"):(0,_.isPeer)(a)&&l?null==h?(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.DIRECT_PEER_STATUS},r),{},{chat:n,author:a,isDirect:l}):(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.DIRECT_PEER_STATUS},r),{},{chat:n,author:a,bclParticipants:h,bclHashValidated:!1}):(0,i.default)((0,i.default)({type:c.MESSAGE_TYPE.OTHER_STATUS},r),{},{chat:n,author:a,isDirect:l}):e.throw("Unrecognized message type")}(e,t);return{encs:t,msgInfo:a,msgMeta:function(e,t){const r=e.hasChild("unavailable");r||0!==t.length||e.throw("incomingMsgParser: to have enc node children");return{isUnavailable:r,type:e.attrEnum("type",d.MSG_TYPES),rawTs:e.attrString("t"),urlNumber:e.hasChild("url_number"),urlText:e.hasChild("url_text")}}(e,t),bizInfo:function(e){const t=e.hasChild("verified_name")?e.child("verified_name").contentBytes():null,r=e.attrEnumOrDefault("verified_level",d.VERIFIED_LEVEL,null),n=e.hasAttr("verified_name")?e.attrInt("verified_name"):-1,i=e.maybeChild("biz");let a=null;if(null!=i){const e=c.ActualActorsEnumType.cast(i.maybeAttrInt("actual_actors")),t=c.HostStorageEnumType.cast(i.maybeAttrInt("host_storage")),r=i.maybeAttrInt("privacy_mode_ts");null!=e&&null!=t&&null!=r&&(a={actualActors:e,hostStorage:t,privacyModeTs:r})}const s=null==i?void 0:i.maybeAttrString("native_flow_name");return{verifiedNameCert:t,verifiedLevel:r,verifiedNameSerial:n,privacyMode:a,nativeFlowName:s}}(e),paymentInfo:function(e){let t=null;const r=e.hasChild("pay")?e.child("pay"):null,n=e.hasChild("transaction")?e.child("transaction"):null,i=(0,u.jidWithTypeToWid)(e.attrJidWithType("from")).isGroup(),a=e.hasAttr("participant")?(0,u.jidWithTypeToWid)(e.attrJidWithType("participant")):null;if((0,h.isNoviTransaction)(r)||(0,h.isNoviTransaction)(n))t={futureproofed:!0};else if(n){const e=(0,h.parseTransactionNode)(n);e&&(t=E(i,a,(0,g.createWid)(e.receiver.toString()))?{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts,txnStatus:(0,f.getPaymentTxnWebStatus)(e.status)}:{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts})}else if(r){switch(r.attrEnum("type",d.PAY_NODE_TYPES)){case d.PAY_NODE_TYPES.send:const{amount1000:n,currency:o}=(0,s.getAmount1000AndCurrency)(r),l=r.hasAttr("receiver")?r.attrString("receiver"):e.attrString("recipient");t=E(i,a,(0,g.createWid)(l))?{receiverJid:l,currency:o,amount1000:n,transactionTimestamp:e.attrInt("t"),txnStatus:m.PaymentInfoTxnStatus.INIT}:{receiverJid:l,currency:o,amount1000:n,transactionTimestamp:e.attrInt("t")};break;case d.PAY_NODE_TYPES.request:case d.PAY_NODE_TYPES.invite:}}return t}(e),deviceIdentity:n}}));function E(e,t,r){if(e&&null!=t&&null!=r){const e=(0,l.getMeUser)();if(!e.equals(t)&&!e.equals(r))return!1}return!0}t.incomingMsgParser=y;const S=new a.WapParser("incomingMsgParserForAckOnly",(e=>(e.assertTag("message"),{externalId:e.attrString("id"),from:(0,u.jidWithTypeToWid)(e.attrJidWithType("from")),type:e.attrEnum("type",d.MSG_TYPES)})));t.incomingMsgParserForAckOnly=S},53348:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createReactionsRow=Q,t.processDecryptedProto=function(){return H.apply(this,arguments)},t.processPlaceholderMsg=function(){return z.apply(this,arguments)},t.processReactionMsg=q,t.processRenderableMsg=V,t.storeReactionMsgBulk=function(e){const t=e.map((e=>(0,k.webMsgInfoReactionTypeToReactionsRow)(e)));return t.map((e=>`${e.msgKey.toString()} to ${e.parentMsgKey}`)).toString(),(0,L.addOrUpdateReactionsDBBulk)(t)};var a=i(r(81109)),s=i(r(48926)),o=r(84902),l=r(78027),c=r(10823),d=i(r(69618)),u=i(r(69153)),p=r(24808),h=r(6303),f=r(99234),_=r(9025),m=i(r(39505)),g=r(57701),y=r(19655),E=r(65582),S=r(82568),v=r(49714),T=r(12037),A=r(39354),C=r(65414),b=r(48616),P=r(84886),M=i(r(11339)),O=(r(17304),i(r(29783))),I=r(5819),w=r(60629),R=r(55552),D=r(30849),N=r(16150),L=r(76332),k=r(57793),G=r(64551),U=n(r(77605)),F=i(r(83147)),x=r(66167),B=r(93832),K=r(27286),Y=r(22695),j=i(r(39546)),W=r(58021);function H(){return(H=(0,s.default)((function*(e,t,r,n,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=a?(0,B.unpad)(e):new Uint8Array(e),l=(0,o.decodeProtobuf)(p.MessageSpec,s);if(null==t.offline&&__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${t.externalId}, message decrypted: `,!t.isHsm&&l.highlyStructuredMessage)throw new T.HsmMismatchError;const _=(0,K.getFrom)(t);if(!(yield(0,Y.isFromKnownDevice)(t.author))){const e=(0,W.toUserWid)(t.author);throw null==t.offline?(0,c.syncDeviceListJob)([e],null,null):u.default.addOfflinePendingDevice(String(e),null),new h.UnknownMessageError(`[messaging] msgId::${t.externalId}, processDecryptedProto: reject message from unknown device`)}if(t.type===v.MESSAGE_TYPE.PEER_BROADCAST&&n.retryCount>0){const e=yield(0,P.getMsgByMsgKey)((0,K.messageInfoToKey)(t));null!=(null==e?void 0:e.broadcastParticipants)&&(t.bclParticipants=e.broadcastParticipants,null!=e.broadcastEphSettings&&(t.bclEphSettings=e.broadcastEphSettings))}l.messageContextInfo&&(0,C.handleICDCData)(t.author,t.chat.isUser()?t.chat:null,l.messageContextInfo);const m=yield(0,K.parseMessage)(t,n.e2eType,l,r,i,e),A=[];if(m.history)(0,y.handleHistorySyncNotification)(m.history,_,t.externalId);else if(m.securityNotificationEnabled)(0,f.setGlobalSecurityNotifications)(m.securityNotificationEnabled.isEnabled);else if(m.appStateSyncKeyShare)(0,S.handleAppStateSyncKeyShare)(m.appStateSyncKeyShare,_);else if(m.appStateSyncKeyRequest)(0,E.handleAppStateSyncKeyRequest)(m.appStateSyncKeyRequest,_);else{var O;let e=!1;if(null==m.deviceSent?e=!0:m.deviceSent.phash?e=yield(0,Y.validateBclHash)(m.deviceSent.phash,m.deviceSent.info):m.deviceSent.destination&&(e=yield(0,Y.validateMsgDestination)(m.deviceSent.destination,t)),!e)throw new h.DeviceSentMessageError((0,K.getDeviceType)(t.author),M.default.DSM_ERROR.INVALID_DSM);if((0,g.receiveReactionsEnabled)()&&(null===(O=m.renderableMsgs[0])||void 0===O?void 0:O.type)===d.default.MSG_TYPE.REACTION)A.push(q(m.renderableMsgs[0],t));else{const e=n.retryCount>0&&(0,K.placeholderCheck)(t);A.push(V(m.renderableMsgs,t,r,i,e)),null!=m.storeMsg&&(0,P.storeMessages)([m.storeMsg],m.storeMsg.id.remote)}null!=m.senderKey&&A.push(U.Session.createGroupSignalSession(t.author,m.senderKey.groupId,m.senderKey.key)),t.pushname&&(0,N.updatePushname)(t.author,t.pushname),yield Promise.all(A),(0,b.logReceivedMessagesInWAM)(m.renderableMsgs,null!=t.offline,1e3*t.ts,t.clientReceivedTsMillis)}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,s.default)((function*(e,t,n,i,o){try{const n=(0,m.default)(t,i),c=null==n?e:e.map((e=>(0,a.default)((0,a.default)({},e),{},{privacyModeWhenSent:n})));if(t.offline)return void O.default.addOfflineMessage(c.map((e=>({msg:e}))));const u=t.chat,p=r(69951).ChatCollection,h=u.isUserNotPSA(),g=h&&null==p.get(u),y=(0,D.getLatestPrivacyMode)(i.privacyMode,(0,D.getContactPrivacyMode)(u));try{if(h){const t=yield(0,_.getExisting)(u);if(null==t){const t=e[0];yield(0,w.createChatOnNewMsg)(u,t,y)}else null!=y&&(yield(0,A.handlePrivacyModeTransition)(u,y,t))}}catch(e){const t="";__LOG__(4,void 0,new Error,!0,["messaging"])`createChatOnNewMsg or handlePrivacyModeTransition ${t} failed with error: ${e}`,SEND_LOGS("createChatOnNewMsg or handlePrivacyModeTransition failed")}if(yield Promise.all(c.map(function(){var e=(0,s.default)((function*(e){yield(0,I.handleSingleMsgMD)(e.id.remote,e,o),(0,l.processOrphanAck)(e.id).catch((e=>{__LOG__(2)`processOrphanAck: msgId::${t.externalId}, failed with error: ${e}`,__LOG__(3,void 0,void 0,void 0,["messaging"])`processOrphanAck: failed`})),e.type===d.default.MSG_TYPE.PAYMENT&&"send"===e.subtype&&(0,R.processOrphanPaymentNotifications)([e])}));return function(){return e.apply(this,arguments)}}())),g&&(0,x.queryAndUpdateContactPropertiesOnNewChat)(u),G.ServerProps.bspSystemMessageEnabled&&h&&!j.default.equals((0,f.getMaybeMeUser)(),t.author)&&null!=y){const e=r(59871).MsgCollection;Promise.all(c.map((t=>{const r=e.get(t.id);if(r)return(0,F.default)(r,y)})))}}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMsg: msgId::${t.externalId}, failed with error: ${e}`,SEND_LOGS("handle_msg: error storing/processing single message")}}))).apply(this,arguments)}function z(){return(z=(0,s.default)((function*(e,t){if(e.category!==T.CATEGORY_PEER)try{const r=yield(0,K.genPlaceholderMsg)(e,t);e.offline?O.default.addOfflineMessage(r.map((e=>({msg:e})))):yield Promise.all(r.map(function(){var e=(0,s.default)((function*(e){const t=e.id.remote;yield(0,I.handleSingleMsgMD)(t,e)}));return function(){return e.apply(this,arguments)}}()))}catch(t){__LOG__(4,void 0,new Error,!0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, failed with error: ${t}`,SEND_LOGS("handle_msg: error storing/processing single message")}else __LOG__(2,void 0,void 0,void 0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, skip placeholder for peer message ${e.externalId}`}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,s.default)((function*(e,t){if(t.offline){const r={msg:e,receiptInfo:{from:e.from,author:t.author}};return void O.default.addOfflineMessage([r])}const r=yield Q(e,t);if(r)return String(e.id),String(e.reactionParentKey),(0,L.addOrUpdateReactions)(r,!0)}))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,s.default)((function*(e,t){var r;const n=yield(0,P.getMsgByMsgKey)(e.reactionParentKey),i=n?0:1,a=t.author;if(n&&!(0,k.canHaveReactions)(n.type))return __LOG__(3)`createReactionsRow: reactions not allowed for this message type ${n.type}`,Promise.resolve();const s=(0,W.toUserWid)(a);return{msgKey:e.id.toString(),parentMsgKey:e.reactionParentKey.toString(),senderUserJid:s.toString(),reactionText:null!==(r=e.reactionText)&&void 0!==r?r:d.default.REVOKED_REACTION_TEXT,timestamp:e.reactionTimestamp,orphan:i,read:!1}}))).apply(this,arguments)}},27286:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPlaceholderMsg=function(){return G.apply(this,arguments)},t.generateBaseMsg=U,t.getDeviceType=Y,t.getFrom=j,t.isPeer=B,t.messageInfoToKey=K,t.parseMessage=function(){return b.apply(this,arguments)},t.placeholderCheck=k,t.sendAck=function(e,t,r){return Promise.resolve((0,o.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e),class:"message",from:(0,T.DEVICE_JID)((0,p.assertGetMe)()),to:t?(0,T.JID)(t):s.DROP_ATTR,type:r})))},t.sendReceipt=function(e,t,r){const{externalId:n}=e,{rawTs:i,type:a}=t,l=j(e),c=e.type===h.MESSAGE_TYPE.CHAT&&B(e.author)?e.chat:null,d=e.type===h.MESSAGE_TYPE.CHAT?null:e.author,u=e.category===f.CATEGORY_PEER;switch(r.result){case h.E2EProcessResult.SUCCESS:return(0,S.sendDeliveryReceiptsAfterDecryption)(n,l,c,d,u,a);case h.E2EProcessResult.HSM_MISMATCH:return Promise.resolve();case h.E2EProcessResult.RETRY:const e=null==r.retryCount?1:r.retryCount+1;return(0,v.sendRetryReceipt)(e,l,d,c,n,i,u);case h.E2EProcessResult.PARSE_VALIDATION_ERROR:return(0,S.sendDeliveryReceiptsAfterDecryption)(n,l,c,d,u,a),Promise.resolve((0,o.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"message",from:(0,T.DEVICE_JID)((0,p.assertGetMe)()),to:l?(0,T.JID)(l):s.DROP_ATTR,type:t.type,participant:d?(0,T.USER_JID)(d):s.DROP_ATTR})));default:return Promise.resolve((0,o.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"message",from:(0,T.DEVICE_JID)((0,p.assertGetMe)()),to:l?(0,T.JID)(l):s.DROP_ATTR,type:t.type,participant:d?(0,T.USER_JID)(d):s.DROP_ATTR})))}};var i=n(r(81109)),a=n(r(48926)),s=r(31914),o=r(24747),l=n(r(69618)),c=r(95738),d=r(6303),u=r(76059),p=r(99234),h=r(49714),f=r(12037),_=r(45033),m=r(84886),g=n(r(11339)),y=n(r(32219)),E=r(13493),S=r(16927),v=r(55253),T=r(39410),A=n(r(39546)),C=r(58021);function b(){return(b=(0,a.default)((function*(e,t,r,n,i){var a,s,o,l;let c,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(null!=(null===(a=r.protocolMessage)||void 0===a?void 0:a.historySyncNotification)){c={history:(0,E.parseMsgProto)(r,U(e),"relay",n,void 0,void 0,i).historySyncMetaData}}else if(null!=(null===(s=r.protocolMessage)||void 0===s?void 0:s.initialSecurityNotificationSettingSync)){var u;c={securityNotificationEnabled:{isEnabled:null===(u=r.protocolMessage.initialSecurityNotificationSettingSync.securityNotificationEnabled)||void 0===u||u}}}else if(null!=(null===(o=r.protocolMessage)||void 0===o?void 0:o.appStateSyncKeyShare))c={appStateSyncKeyShare:r.protocolMessage.appStateSyncKeyShare};else if(null!=(null===(l=r.protocolMessage)||void 0===l?void 0:l.appStateSyncKeyRequest))c={appStateSyncKeyRequest:r.protocolMessage.appStateSyncKeyRequest};else switch(e.type){case h.MESSAGE_TYPE.CHAT:c=B(e.author)?yield P(e,r,n,i,d):yield w(e,r,n,i,d);break;case h.MESSAGE_TYPE.GROUP:c=B(e.author)&&e.isDirect?yield P(e,r,n,i,d):yield w(e,r,n,i,d);break;case h.MESSAGE_TYPE.PEER_BROADCAST:if(t===_.CiphertextType.Skmsg){if(!e.bclHashValidated)throw new Error("parseMessage: participants for peer broadcast message is not validated");c=yield w(e,r,n,i,d)}else c=yield O(e,r,n,i,d);break;case h.MESSAGE_TYPE.OTHER_BROADCAST:c=yield w(e,r,n,i,d);break;case h.MESSAGE_TYPE.DIRECT_PEER_STATUS:c=e.isDirect?yield P(e,r,n,i,d):yield O(e,r,n,i,d);break;case h.MESSAGE_TYPE.OTHER_STATUS:c=yield w(e,r,n,i,d);break;default:throw new Error("Unrecognized MESSAGE_TYPE")}return c}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t,r,n,a){const{deviceSentMessage:s}=t;if(null==s)throw new d.DeviceSentMessageError(Y(e.author),g.default.DSM_ERROR.MISSING_DSM);if(null==s.destinationJid)throw new d.DeviceSentMessageError(Y(e.author),g.default.DSM_ERROR.INVALID_DSM);const{destinationJid:o}=s,l=yield D(e,s.message,r,n,a);return(0,i.default)({deviceSent:{destination:(0,C.createWid)(o)}},l)}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,r,n,a){const{deviceSentMessage:s}=t;if(null==s)throw new d.DeviceSentMessageError(Y(e.author),g.default.DSM_ERROR.MISSING_DSM);if(null==s.phash)throw new d.DeviceSentMessageError(Y(e.author),g.default.DSM_ERROR.INVALID_DSM);const{phash:o}=s,l=yield D(e,s.message,r,n,a);return(0,i.default)({deviceSent:{phash:o,info:e}},l)}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,r,n,a){if(null!=t.deviceSentMessage)throw new d.DeviceSentMessageError(Y(e.author),g.default.DSM_ERROR.INVALID_SENDER);const s=yield D(e,t,r,n,a);return(0,i.default)({deviceSent:null},s)}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t,r,n,a){var s;if(null==t)return{senderKey:null,storeMsg:null,renderableMsgs:[]};let o=(0,E.parseMsgProto)(t,U(e),"relay",r,void 0,void 0,n,e.edit);o=(0,i.default)((0,i.default)({},o),yield(0,u.genDirectConnectionMessageModifiers)(o.type,null===(s=o.list)||void 0===s?void 0:s.listType,o.businessOwnerJid));const d=null!=t.senderKeyDistributionMessage?L(e,t.senderKeyDistributionMessage):null,f=o.type===l.default.MSG_TYPE.UNKNOWN&&null==d,_=o.type===l.default.MSG_TYPE.UNKNOWN&&null!=d;let m=null;if(f&&(o.futureproofBuffer=a),e.type===h.MESSAGE_TYPE.OTHER_STATUS&&(o.campaignId=e.campaignId,o.campaignDuration=e.campaignDuration),e.type===h.MESSAGE_TYPE.PEER_BROADCAST&&(o.broadcastId=e.chat,o.broadcastParticipants=e.bclParticipants,o.broadcastEphSettings=e.bclEphSettings,m=o),e.type===h.MESSAGE_TYPE.OTHER_BROADCAST){o.broadcastId=e.chat;const t=e.ephSetting,r=o.ephemeralSharedSecret;if(null!=t&&null!=r){const{ephemeralDuration:n,ephemeralSettingTimestamp:i}=yield(0,c.decodeBroadcastEphemeralSetting)(e.chat,(0,p.getMeUser)(),e.author,t,r);o.ephemeralDuration=n,o.ephemeralSettingTimestamp=i}}let g=[];return _||(e.type===h.MESSAGE_TYPE.PEER_BROADCAST?g=yield F(o,e.bclParticipants,e.bclEphSettings):("payment_transaction_request_cancelled"!==o.subtype&&"payment_action_request_declined"!==o.subtype||null!=o.paymentRequestMessageKey)&&(g=[o])),{senderKey:d,storeMsg:m,renderableMsgs:g}}))).apply(this,arguments)}function L(e,t){if(!e.chat.isGroup()&&!e.chat.isBroadcast())throw new Error("should not have senderkey");const{groupId:r,axolotlSenderKeyDistributionMessage:n}=t;if(null==r||e.chat.toString({legacy:!0})!==r)throw new Error(`senderKeyDistributionMessage: from ${e.chat.toString()} mismatched to ${r||"null"}`);if(!n)throw new Error(`senderKeyDistributionMessage: from ${e.author.toString()} has no content`);return{groupId:r,key:n}}function k(e){return e.edit!==l.default.EDIT_ATTR.SENDER_REVOKE||e.type===h.MESSAGE_TYPE.PEER_BROADCAST}function G(){return(G=(0,a.default)((function*(e,t){if(!k(e))return[];const r=U(e);if(t===h.PlaceholderType.E2E?r.type=l.default.MSG_TYPE.CIPHERTEXT:(r.type=l.default.MSG_TYPE.CIPHERTEXT,r.subtype="fanout"),e.type===h.MESSAGE_TYPE.PEER_BROADCAST){if(r.broadcastParticipants=e.bclParticipants,r.broadcastEphSettings=e.bclEphSettings,(0,m.storeMessages)([r],r.id.remote),e.edit===l.default.EDIT_ATTR.SENDER_REVOKE)return[];return yield F(r,e.bclParticipants)}return[r]}))).apply(this,arguments)}function U(e){const t=K(e),r=(0,p.getMeUser)(),n={id:t,from:t.fromMe?r:t.remote,to:t.fromMe?t.remote:r,type:l.default.MSG_TYPE.UNKNOWN,t:e.ts||0,ack:l.default.ACK.SENT,author:!t.fromMe&&A.default.isGroup(t.remote)||A.default.isStatusV3(t.remote)?t.participant:void 0,broadcast:!1,notifyName:e.pushname||""};return null!=e.count&&(n.count=e.count),n}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(e,t,r){return(yield Promise.all(t.map(function(){var t=(0,a.default)((function*(t){let n,a,s;try{n=new y.default({remote:t,fromMe:!0,id:e.id.id})}catch(e){return __LOG__(3)`drop: cannot create MsgKey: ${e.stack}`,null}const o=r?r[t.toString()]:null,l=e.ephemeralSharedSecret,d=e.broadcastId;null!=d&&null!=o&&null!=l&&({ephemeralDuration:a,ephemeralSettingTimestamp:s}=yield(0,c.decodeBroadcastEphemeralSetting)(d,t,(0,p.getMeUser)(),o,l));const u=(0,i.default)((0,i.default)({},e),{},{id:n,from:(0,p.getMeUser)(),to:t,broadcast:!0,ephemeralDuration:a,ephemeralSettingTimestamp:s});return e.protocolMessageKey&&(u.protocolMessageKey=new y.default({remote:t,fromMe:!0,id:e.protocolMessageKey.id})),u}));return function(){return t.apply(this,arguments)}}()))).filter(Boolean)}))).apply(this,arguments)}function B(e){return(0,C.toUserWid)(e).equals((0,p.getMeUser)())}function K(e){return e.type===h.MESSAGE_TYPE.OTHER_BROADCAST?new y.default({remote:(0,C.toUserWid)(e.author),fromMe:!1,id:e.externalId}):e.type===h.MESSAGE_TYPE.CHAT?new y.default({remote:e.chat,fromMe:B(e.author),id:e.externalId}):new y.default({remote:e.chat,fromMe:B(e.author),participant:(0,C.toUserWid)(e.author),id:e.externalId})}function Y(e){return null==e.device||e.device===l.default.DEVICE.PRIMARY_DEVICE?g.default.DEVICE_TYPE.PRIMARY:g.default.DEVICE_TYPE.COMPANION}function j(e){return e.type===h.MESSAGE_TYPE.CHAT?e.author:e.chat}},39505:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!o.ServerProps.bspSystemMessageEnabled||e.type!==a.MESSAGE_TYPE.CHAT)return;if(!l.default.equals((0,i.getMaybeMeUser)(),e.author))return t.privacyMode;const r=t.privacyMode,n=(0,s.getContactPrivacyMode)(e.chat);return(0,s.getLatestPrivacyMode)(n,r)};var i=r(99234),a=r(49714),s=r(30849),o=r(64551),l=n(r(39546))},22695:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isFromKnownDevice=function(){return p.apply(this,arguments)},t.validateBclHash=function(){return u.apply(this,arguments)},t.validateMsgDestination=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=n(r(69618)),s=r(9108),o=r(99234),l=r(53686),c=r(58021);function d(){return(d=(0,i.default)((function*(e,t){const r=t.author,n=t.chat;if(!e.equals(n))return __LOG__(4,void 0,new Error,!0)`encDestination: ${String(e)}, destination: ${n.toString()}`,SEND_LOGS("validateMsgDestination: drop due to the deviceSentMessage meta mismatch."),Promise.resolve(!1);const i=(0,c.toUserWid)(r),a=r.device||0;if(!i.equals((0,o.getMeUser)()))return __LOG__(4,void 0,new Error,!0)`sender: ${r.toString()}`,SEND_LOGS("validateMsgDestination: drop due to msg is not sent from your own device."),Promise.resolve(!1);const l=yield(0,s.hasDevice)(i,a);return l||(__LOG__(4,void 0,new Error,!0)`no record found for sender: ${r.toString()}`,SEND_LOGS("validateMsgDestination:drop due to invalid device")),l}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){var r;const n=null!==(r=t.bclParticipants)&&void 0!==r?r:[],i=yield(0,l.phashV2)(n);return i!==e?(__LOG__(4,void 0,new Error,!0)`expected: ${e}, got: ${i}`,SEND_LOGS("validateBclHash: drop due to invalid hash."),!1):(t.bclHashValidated=!0,!0)}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=null==e.device?a.default.DEVICE.PRIMARY_DEVICE:e.device;if(t===a.default.DEVICE.PRIMARY_DEVICE)return!0;const[r]=yield(0,s.getDeviceIds)([e.user]);return null!=r&&r.devices.includes(t)}))).apply(this,arguments)}},48309:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleChatSimpleAck=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(86945),s=n(r(69618)),o=r(99234),l=r(29331),c=r(28237),d=r(47124),u=n(r(32219)),p=n(r(66545)),h=r(58021);const{ACK:f,ACK_STRING:_}=s.default;function m(){return(m=(0,i.default)((function*(e){const{from:t,externalIds:r,ts:n,recipient:i,ackString:s,offline:l,biz:m}=e;let{ack:y}=e;const E=s===_.SENDER,S=!E&&(0,h.toUserWid)(t).equals((0,o.getMeUser)());let v;if(S||E){if(!i)throw new Error("handleChatSimpleAck: invalid sender/peer receipt without recipient");v=i}else{v=(0,h.toUserWid)(t);"none"===(0,o.getUserPrivacySettings)().readReceipts&&(y===f.READ||y===f.PLAYED&&(0,a.getABPropConfigValue)("played_self_enabled"))&&(y=f.RECEIVED)}const T=r.map((e=>new u.default({id:e,remote:v,fromMe:!S}))),A=T.map((e=>e.toString()));if(null!=l&&c.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==l||c.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(g(S,E,T,v,y,n,m)),S||e.push((0,d.updateReceiptRecords)(y,n,t,A,m?{actualActors:m.actualActors,hostStorage:m.hostStorage,privacyModeTs:m.privacyModeTs}:null).catch((e=>{__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleChatSimpleAck: failed")}))),yield Promise.all(e)}else{if(!S)return p.default.addOfflineReceipt(y,n,t,A);if(null!=i&&(s===_.READ||s===_.READ_SELF||s===_.PLAYED||s===_.PLAYED_SELF)&&r.length>0)return p.default.addOfflinePeerReceipt(n,A,y)}}))).apply(this,arguments)}function g(e,t,r,n,i,a,s){return i<f.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleChatSimpleAck: sender receipt from peer device ${n.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleChatSimpleAck: peer receipt from peer device ${n.toString()}`,i===f.READ?(0,l.updateChatPeerRead)(n,r):i===f.PLAYED?(0,l.updateMsgAcks)(r,i,a):Promise.resolve()):(0,l.updateMsgAcks)(r,i,a,s)}},84947:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupSimpleAck=function(){return S.apply(this,arguments)};var i=n(r(48926)),a=r(78027),s=n(r(69618)),o=r(99234),l=r(29331),c=r(28237),d=r(47124),u=r(59871),p=r(52821),h=r(17972),f=n(r(32219)),_=r(29731),m=n(r(66545)),g=r(58021);const{ACK:y,ACK_STRING:E}=s.default;function S(){return(S=(0,i.default)((function*(e){const{ack:t,from:r,externalIds:n,ts:a,ackString:s,participant:l,recipient:u,offline:p}=e;if(!l)throw new Error("handleGroupSimpleAck: got group ack without participant.");const h=(0,o.getMeUser)(),y=(0,g.toUserWid)(l),S=s===E.SENDER,T=!S&&y.equals(h);let A;if(T){if(!u)throw new Error("handleGroupSimpleAck: invalid sender/peer receipt without recipient");A=u}else A=h;const C=n.map((e=>new f.default({id:e,remote:r,fromMe:!T,participant:A}))),b=C.map((e=>e.toString()));if(null!=p&&c.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==p||c.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(v(T,S,C,r,t,y,a)),T||e.push(new _.NonPersistJob("updateGroupReceiptRecords",(0,i.default)((function*(){try{yield(0,d.updateReceiptRecords)(t,a,l,b)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleGroupSimpleAck: failed")}}))).waitUntilCompleted()),yield Promise.all(e)}else{if(!T)return m.default.addOfflineReceipt(t,a,l,b);if(null!=u&&(s===E.READ||s===E.READ_SELF||s===E.PLAYED||s===E.PLAYED_SELF)&&n.length>0)return m.default.addOfflinePeerReceipt(a,b,t)}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,s,c,d){return s<y.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleGroupSimpleAck: sender receipt from peer device ${n.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleGroupSimpleAck: peer receipt from peer device ${n.toString()}`,s===y.READ&&(0,l.updateChatPeerRead)(n,r),s===y.PLAYED?(0,l.updateMsgAcks)(r,s,d):Promise.resolve()):void(yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){const t=u.MsgCollection.get(e);if(!t)return void __LOG__(2)`handleGroupSimpleAck: no message found for incoming ack, with msgKey:`;const r=yield h.MsgInfoCollection.find(e);return r||(__LOG__(3,void 0,void 0,!0)`Assertion failed! ${e.toString()}`,SEND_LOGS("handleGroupSimpleAck: no msgInfo found for msg:")),(0,p.updateMsgInfo)(r,s,c,d),s===y.RECEIVED&&0===r.deliveryRemaining||s===y.READ&&0===r.readRemaining||s===y.PLAYED&&0===r.playedRemaining?(0,a.updateMsgAck)(t,null,{from:(0,o.assertGetMe)(),to:n,ack:s,t:d}):void 0}));return function(){return e.apply(this,arguments)}}())))}))).apply(this,arguments)}},17234:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(31914),o=r(48309),l=n(r(69618)),c=r(99234),d=r(84947),u=r(78428),p=r(28237),h=n(r(32219)),f=n(r(66545)),_=r(90756),m=r(97563),g=r(39410),y=n(r(39546));const{ACK:E}=l.default;function S(){return(S=(0,a.default)((function*(e){const t=u.msgReceiptParser.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,new Error(t.error);{const e=t.success,{ack:r,ackString:n,from:i,stanzaId:a}=e;if(e.type===u.RECEIPT_TYPE.SIMPLE){if(r===E.CONTENT_GONE)return A(i,a,n,null);{let t=null;null==e.offline||p.OfflineMessageHandler.isResumeFromRestartComplete()?t=A(i,a,n,e.participant):f.default.addOfflineReceiptAck(i,a,n,e.participant);try{__LOG__(2)`handleSimpleAck: got receipt ${e.ack} for msg ${e.stanzaId}`,yield v(e)}catch(e){}return t}}if(e.type===u.RECEIPT_TYPE.AGGREGATE){const t=A(i,a,n,null);try{__LOG__(2)`handleAggregateAck: got ${e.receipts.length} receipts of ack type ${e.ack} for msg ${e.externalId}`,yield T(e)}catch(e){}return t}return __LOG__(4,void 0,new Error,!0)`type: ${e.type}`,SEND_LOGS("handleMsgReceipt: Invalid receipt type"),A(i,a,n,null)}}))).apply(this,arguments)}function v(e){const{from:t,ack:r,stanzaId:n,participant:a}=e;if(r===E.MD_DOWNGRADE){const e=new h.default({id:n,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,c.getMeUser)()});return(0,m.updateLocalAndModel)(e,{mdDowngrade:!(a&&y.default.isWid(a)&&a.isUser())||a.toString()})}if(r===E.PEER)return Promise.resolve();if(t.isStatusV3())return(0,_.handleStatusSimpleAck)(e);if(t.isUser())return(0,o.handleChatSimpleAck)(e);if(t.isGroup())return(0,d.handleGroupSimpleAck)(e);if(t.isBroadcast()){if(!e.participant)return Promise.reject(new Error(`handleSimpleAck: missing participant for broadcast receipt ${t.toString()}`));const r=(0,i.default)((0,i.default)({},e),{},{from:e.participant,participant:null});return(0,o.handleChatSimpleAck)(r)}return Promise.reject(new Error(`handleSimpleAck: unsupported type for ${t.toString()}`))}function T(e){const{ack:t,from:r}=e;if(t===E.CONTENT_GONE)return Promise.reject(new Error("handleAggregateAck: reupload receipts cannot be aggregated"));if(!r.isGroup())return Promise.reject(new Error("handleAggregateAck: aggregate receipts should come only from group JIDs"));const n=e.receipts.map((t=>v({type:u.RECEIPT_TYPE.SIMPLE,stanzaId:e.externalId,externalIds:[e.externalId],from:e.from,participant:t.participant,recipient:null,ts:t.ts,ack:e.ack,ackString:e.ackString,offline:e.offline,biz:null})));return Promise.all(n)}function A(e,t,r,n){return(0,s.wap)("ack",{to:(0,g.JID)(e),id:(0,s.CUSTOM_STRING)(t),class:"receipt",type:(0,s.MAYBE_CUSTOM_STRING)(r),participant:n&&n!==e?(0,g.DEVICE_JID)(n):s.DROP_ATTR})}},29331:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.processOrphanPeerReceipt=function(e){return E.enqueue((0,i.default)((function*(){const t=yield(0,f.getOrphanReceipt)(String(e));t?(null!=t[y.PLAYED]&&(__LOG__(2)`processOrphanPeerReceipt: orphan played ack found for incoming ${e}`,yield C([e],g.PLAYED,t[y.PLAYED])),null!=t[y.READ]&&(__LOG__(2)`processOrphanPeerReceipt: orphan read ack found for incoming ${e}`,T(e.remote,[e])),yield(0,f.removeOrphanReceipt)(String(e))):__LOG__(2)`processOrphanPeerReceipt: no orphan ack found for incoming ${e}`})))},t.updateChatPeerRead=T,t.updateMsgAcks=C;var i=n(r(48926)),a=r(27870),s=r(38342),o=r(87845),l=r(48285),c=n(r(69618)),d=r(57701),u=r(90981),p=r(59871),h=n(r(32219)),f=r(40221),_=r(76332),m=r(9609);const{ACK:g,ACK_STRING:y}=c.default,E=new a.PromiseQueue;function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const r=(yield(0,s.getActiveMessageRanges)(e)).filter((e=>"markChatAsRead"===e.action&&!1===e.actionValue.read&&null!=e.actionValue.messageRange));if(0===r.length)return!0;const n=r[0];return t.some((e=>!(0,o.rangeContainsMessage)(n.actionValue.messageRange,{id:h.default.fromString(e.id),t:e.t})))}))).apply(this,arguments)}function T(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t){const n=t.map(String),i=[];let a=null;const s=yield(0,u.getTable)().bulkGet(n,!1);s.forEach(((e,t)=>{e?null==e.pendingReadReceipt||null!=e.rowId&&(null==a||e.rowId>a)&&(a=e.rowId):i.push(n[t])})),E.enqueue((()=>(__LOG__(2)`updateChatPeerRead: storing ${i.length} orphan acks`,(0,f.createOrUpdateOrphanReceipt)(y.READ,0,i)))),yield(0,l.markMessageAndChatAsRead)(a,String(e),!(yield S(e.toString(),s.filter(Boolean)))),(0,d.receiveReactionsEnabled)()&&(yield(0,_.markReactionsAsReadByMessageKeys)(t));const o=r(69951).ChatCollection.get(e);o&&((0,m.updateUnreadCountMD)(o,0,!1),(0,m.clearUnreadMentions)(o))}))).apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,n,i){const a=[],s=[],o=r(78027).updateMsgAck;e.forEach((e=>{const r=p.MsgCollection.get(e);r?s.push(o(r,null,{from:r.from,to:r.to,ack:t,t:n,deliveryPrivacyMode:g.RECEIVED===t?i:null})):(__LOG__(2)`updateMsgAcks: no message found for incoming ack, with msgKey: ${e}`,e.fromMe||a.push(e))})),a.length>0&&E.enqueue((()=>{__LOG__(2)`updateMsgAcks: store ${a.length} orphan acks`;let e=null;if(t===g.PLAYED?e=y.PLAYED:t===g.READ&&(e=y.READ),e)return(0,f.createOrUpdateOrphanReceipt)(e,n,a.map(String))})),yield Promise.all(s)}))).apply(this,arguments)}},78428:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgReceiptParser=t.RECEIPT_TYPE=void 0;var i=n(r(81109)),a=r(71914),s=n(r(69618)),o=r(99234),l=r(49714),c=r(85553);const{ACK:d}=s.default,u={read:d.READ,played:d.PLAYED,inactive:d.INACTIVE,"server-error":d.CONTENT_GONE,"md-downgrade":d.MD_DOWNGRADE,sender:d.RECEIVED,"read-self":d.READ,"played-self":d.PLAYED,peer_msg:d.PEER},p={SIMPLE:"simple",AGGREGATE:"aggregate"};t.RECEIPT_TYPE=p;const h=new a.WapParser("incomingMsgReceiptParser",(e=>{e.assertTag("receipt"),e.hasAttr("to")&&e.assertAttr("to",(0,o.assertGetMe)().toJid());const t={ack:e.attrEnumOrDefault("type",u,d.RECEIVED),stanzaId:e.attrString("id"),from:(0,c.jidWithTypeToWid)(e.attrJidWithType("from")),ackString:e.hasAttr("type")?e.attrString("type"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},r=e.maybeChild("participants");return r?function(e,t){const r=t.mapChildrenWithTag("user",(e=>{try{const t=(0,c.deviceJidToDeviceWid)(e.attrDeviceJid("jid"));return{participant:t,ts:e.attrTime("t")}}catch(e){return null}})).filter((e=>null!=e));return(0,i.default)((0,i.default)({},e),{},{type:p.AGGREGATE,externalId:t.attrString("key"),receipts:r})}(t,r):function(e,t){const r=t.hasAttr("participant")?(0,c.deviceJidToDeviceWid)(t.attrDeviceJid("participant")):null,n=t.hasAttr("recipient")?(0,c.userJidToUserWid)(t.attrUserJid("recipient")):null;let a,s;a=t.hasChild("list")?t.child("list").mapChildrenWithTag("item",(e=>e.attrString("id"))):[];if(t.hasChild("biz")){const e=t.child("biz"),r=l.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),n=l.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),i=e.maybeAttrInt("privacy_mode_ts");null!=r&&null!=n&&null!=i&&(s={actualActors:r,hostStorage:n,privacyModeTs:i})}return a.push(e.stanzaId),(0,i.default)((0,i.default)({},e),{},{type:"simple",externalIds:a,participant:r,recipient:n,ts:t.attrTime("t"),biz:s})}(t,e)}));t.msgReceiptParser=h},90756:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleStatusSimpleAck=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=n(r(69618)),s=r(99234),o=r(29331),l=r(47124),c=r(52821),d=r(17972),u=n(r(32219)),p=r(59387),h=r(58021);const{ACK:f,ACK_STRING:_}=a.default;function m(){return(m=(0,i.default)((function*(e){const{externalIds:t,ts:r,ackString:n,ack:i,participant:o,recipient:c}=e;if("none"===(0,s.getUserPrivacySettings)().readReceipts||n!==_.READ)return;if(!o)return __LOG__(4,void 0,new Error,!0)`error: got status ack without participant`,void SEND_LOGS("handleStatusSimpleAck: failed");const d=(0,s.getMeUser)(),p=(0,h.toUserWid)(o),f=p.equals(d),m=new u.default({id:t[0],remote:(0,h.createWid)(a.default.STATUS_WID),fromMe:!f,participant:null!=c?c:d}),y=[m.toString()];if(!f)try{yield(0,l.updateReceiptRecords)(i,r,o,y)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleStatusSimpleAck: failed")}yield g(f,m,p,r)}))).apply(this,arguments)}function g(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r,n){if(e){const e=p.StatusV3Collection.get(t.participant);e&&e.handleReadStatus(t)}else{const e=yield d.MsgInfoCollection.find(t);(0,c.updateMsgInfo)(e,f.READ,r,n)}yield(0,o.updateMsgAcks)([t],f.READ,n)}))).apply(this,arguments)}},58464:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdaptiveOfflineEnabled=function(){return(0,n.getABPropConfigValue)("web_adaptive_offline_resume_enabled")};var n=r(86945)},98972:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDanglingReceipts=u,t.sendAndClearDanglingReceipts=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(92844),s=r(93771),o=r(74727),l=r(29100),c=r(58021);function d(){return(d=(0,i.default)((function*(){const e=yield(0,s.getTable)().all(),t=new Map;e.forEach((e=>{const{receipts:r}=e;r.forEach((e=>{const r=(0,c.createWid)(e.from),n=(0,c.createWid)(e.author);let i=t.get(r);i||(i=new Map,t.set(r,i));let a=i.get(n);a||(a=[],i.set(n,a)),a.push(e.externalId)}))}));const r=String((0,a.unixTime)());yield Promise.all(Array.from(t.keys()).map((e=>{const n=t.get(e);if(n)return(0,o.sendAggregateReceipts)(e,o.RECEIPT_TYPE.DELIVERY,r,n)}))),yield u()}))).apply(this,arguments)}function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){yield(0,l.blockSendPing)(),yield(0,s.getTable)().clear()}))).apply(this,arguments)}},69153:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(27870),s=r(57319),o=r(24747),l=r(46308);var c=new class{constructor(){this.pendingDeviceCache=new Set,this.pendingAcks=[],this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new a.PromiseQueue}addOfflinePendingDevice(e,t){this.pendingDeviceCache.add(e),t&&this.pendingAcks.push(t),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][device-cache]: creating snapshot: schedule in ${3e3} ms`,this.snapshotTimer.onOrAfter(3e3))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.pendingDeviceCache),t=this.pendingAcks;__LOG__(2)`[offline-resume][device-cache]: creating snapshot for pending devices ${e.join(",")}`,this.checkpointQueue.enqueue((0,i.default)((function*(){yield(0,l.addUserToPendingDeviceSync)(e),t.forEach(o.castStanza),(0,o.cancelDeadSocketTimer)()}))),this.pendingDeviceCache=new Set,this.pendingAcks=[]}};t.default=c},28237:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineMessageHandlerImpl=t.OfflineMessageHandler=void 0;var a=i(r(48926)),s=r(13959),o=r(4352),l=r(98972),c=r(88102),d=r(80278),u=r(36163),p=r(15746),h=i(r(29783)),f=r(52083),_=i(r(66545)),m=r(49714),g=r(65044),y=r(46308),E=i(r(69153)),S=r(57319),v=r(83578),T=r(58464),A=r(45607),C=n(r(22906)),b=r(64457),P=r(97480),M=r(60324),O=r(55552),I=r(16116);const w=20,R=50,D=200,N=r(54302)({INIT:"INIT",RESUME_ON_RESTART:"RESUME_ON_RESTART",RESUME_WITH_OPEN_TAB:"RESUME_WITH_OPEN_TAB",COMPLETE:"COMPLETE"});class L{constructor(){this._offlineCompleteTimer=null,this.initState(),c.Cmd.on("logout",(()=>{this.initState()})),c.Cmd.on("open_socket_stream",(()=>{P.OfflineResumeReporter.logSocketConnectT()}))}initState(){this._offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=N.INIT,this._pendingMessageCount=0,this._isPendingPrevBatch=!1}setStatus(e){e===N.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] begin RESUME_WITH_OPEN_TAB`:e===N.RESUME_ON_RESTART?__LOG__(2)`[offline-resume][handler] begin RESUME_ON_RESTART`:e===N.COMPLETE&&(this._status===N.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] finished RESUME_WITH_OPEN_TAB`:__LOG__(2)`[offline-resume][handler] finished RESUME_ON_RESTART`),this._status=e}setOfflineMessagePreviewCounter(e){var t=this;return(0,a.default)((function*(){if(P.OfflineResumeReporter.logOfflinePreviewT(),t.isResumeFromRestartComplete()){__LOG__(2)`[offline-resume][handler] Offline session is complete when receiving offline preview ib.`,t._exceedResumeWithOpenTabLimit(e.message,e.receipt)&&(__LOG__(2)`[offline-resume][handler] restart client due to exceed the LIMIT, message: ${e.message}, receipt: ${e.receipt}`,U()),b.jsHaltDetector.restartDetection(),t.setStatus(N.RESUME_WITH_OPEN_TAB);const n=r(69951).ChatCollection;n.disableSortListener(),setTimeout((()=>{n.enableSortListener(!0)}),7e3)}else if(t._status===N.INIT)P.OfflineResumeReporter.logOfflineCount(e),t._hasMessagesToDownload=e.message>0,t._finishedDownloading=0===e.message,t._offlineMessagePreviewCounter=e.message,t._decryptedMessageCount=0,t._firstPreviewReceivedT=Date.now(),c.Cmd.handleOfflineProgressUpdate(),b.jsHaltDetector.restartDetection(),t.setStatus(N.RESUME_ON_RESTART),yield(0,f.enableMemSignalStore)(),t._startOfflineCompleteTimer(e.message,e.receipt);else{const r=t._firstPreviewReceivedT;if(null!=r){const n=Date.now()-r;n<1e3?(__LOG__(2)`[offline-resume][handler] Accept multiple offline preview ibs during offline resume, delay ${n}.`,t._offlineMessagePreviewCounter+=e.message,t._hasMessagesToDownload=t._offlineMessagePreviewCounter>0,t._finishedDownloading=0===t._offlineMessagePreviewCounter,P.OfflineResumeReporter.logOfflineCount(e),c.Cmd.handleOfflineProgressUpdate()):__LOG__(2)`[offline-resume][handler] Reject multiple offline preview ib during offline resume, delay ${n}.`}t.refreshOfflineCompleteTimer()}}))()}getOfflineDeliveryProgress(){return this._finishedDownloading?100:-1===this._offlineMessagePreviewCounter?0:0===this._offlineMessagePreviewCounter?100:Math.min(Math.ceil(100*this._decryptedMessageCount/this._offlineMessagePreviewCounter),100)}isResumeOnSocketDisconnectInProgress(){return this._status===N.RESUME_WITH_OPEN_TAB}isResumeFromRestartComplete(){return this._status!==N.RESUME_ON_RESTART&&this._status!==N.INIT}getHasMessagesToDownload(){return this._hasMessagesToDownload}getFinishedDownloading(){return 100===this.getOfflineDeliveryProgress()}setOfflineSessionComplete(e){var t=this;return(0,a.default)((function*(){var n;return setTimeout((()=>{r(69951).ChatCollection.enableSortListener(!0)}),3e3),null===(n=t._offlineCompleteTimer)||void 0===n||n.cancel(),t._offlineCompleteTimer=null,t._status===N.COMPLETE?Promise.resolve():t._status===N.RESUME_WITH_OPEN_TAB?(yield(0,p.waitForOnlineMsgThread)(),yield(0,y.doPendingDeviceSync)(),t.setStatus(N.COMPLETE),Promise.resolve()):(t._hasMessagesToDownload=e>0,t._finishedDownloading=0===e,t.setStatus(N.COMPLETE),t._offlineStanzaCountAfterOfflineMarker=0,setTimeout((()=>{t._offlineStanzaCountAfterOfflineMarker>100&&(__LOG__(3)`[offline-resume][handler] ${t._offlineStanzaCountAfterOfflineMarker} received after offline completion marker. Refreshing window due to potential server issue.`,U())}),2e4),c.Cmd.handleOfflineProgressUpdate(),t._onOfflineComplete())}))()}shouldUseOfflineResumeScreen(){return this._offlineMessagePreviewCounter>this._decryptedMessageCount}decryptOfflineMessage(e){var t=this;return(0,a.default)((function*(){const r=yield(0,d.decryptE2EPayload)(e);return t._decryptedMessageCount=t._decryptedMessageCount+1,r.result===m.E2EProcessResult.RETRY&&(t._decryptionErrorCount=t._decryptionErrorCount+1),(0,T.isAdaptiveOfflineEnabled)()&&(t._pendingMessageCount-=1,t.maybeRequestMoreStanza()),r}))()}offlineStanzaReceivedAfterCompelete(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker=this._offlineStanzaCountAfterOfflineMarker+1)}addOfflinePendingMessage(){(0,T.isAdaptiveOfflineEnabled)()&&!this.isResumeFromRestartComplete()&&(this._pendingMessageCount+=1)}maybeRequestMoreStanza(){this.isResumeFromRestartComplete()||this._isPendingPrevBatch||this._pendingMessageCount<=200&&((0,A.sendBatchRequestIb)(200),this._isPendingPrevBatch=!0,__LOG__(2)`[offline-resume][adaptive] maybeRequestMoreStanza: request next batch, pending message ${this._pendingMessageCount}`)}newOfflineStanza(){(0,T.isAdaptiveOfflineEnabled)()&&(this._isPendingPrevBatch=!1,null==this._endBatchCheck&&(this._endBatchCheck=setTimeout((()=>{this.maybeRequestMoreStanza(),this._endBatchCheck=null,__LOG__(2)`[offline-resume][adaptive] _endBatchCheck: done`}),0))),this.refreshOfflineCompleteTimer()}refreshOfflineCompleteTimer(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(6e4)}_startOfflineCompleteTimer(e,t){var r;null===(r=this._offlineCompleteTimer)||void 0===r||r.cancel(),this._offlineCompleteTimer=new S.ShiftTimer((()=>{this._status!==N.COMPLETE&&(__LOG__(2)`[offline-resume][handler]: offline session completed by timeout`,this.setOfflineSessionComplete(e+t),this._offlineCompleteTimer=null,P.OfflineResumeReporter.logMissedOfflineComplete())})),this._offlineCompleteTimer.onOrAfter(6e4)}_onOfflineComplete(){var e=this;return(0,a.default)((function*(){yield(0,p.waitForOfflineMsgThread)(),e._finishedDownloading=!0,c.Cmd.handleOfflineProgressUpdate(),P.OfflineResumeReporter.logOfflineDecryptionErrorCount(e._decryptionErrorCount),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ${e._decryptionErrorCount}`,e._decryptionErrorCount=0,yield function(){return G.apply(this,arguments)}(),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: clearOfflineSnapShot done.`,(0,f.enablePersistSignalStore)(),(0,o.promiseLoop)(function(){var e=(0,a.default)((function*(e,t,r){const n=(0,s.delayMs)(C.expBackoff(r,12e4,1e3,.1));try{return yield(0,l.clearDanglingReceipts)(),__LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: done.`,e()}catch(t){return __LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: failed with error ${t}.`,r>3?(__LOG__(3)`[offline-resume][handler] runReceiptCleanUpLoop: Gave up clean up receipts ${r} tries`,e()):n}}));return function(){return e.apply(this,arguments)}}());try{const e=yield(0,M.pruneExpiredMessages)();__LOG__(2)`[offline-resume][handler] setOfflineSessionComplete: pruneExpiredMessages pruned ${e} msg(s)`}catch(e){throw __LOG__(4,void 0,new Error)`[offline-resume][handler] _onOfflineComplete: pruneExpiredMessages message failed with error: ${e}`,e}P.OfflineResumeReporter.logLastStanzaT();try{__LOG__(2)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages.`,yield Promise.all([(0,u.restoreChatsAndMessages)(),(0,u.restoreGroupsContactsAndProfilePics)()])}catch(e){__LOG__(4,!0,new Error,!0)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages failed with error ${e}.`,SEND_LOGS("offline-resume-fatal-error"),g.Socket.logout(!1,v.LogoutReason.ClientFatalError)}c.Cmd.readyForMainStreamMode(),P.OfflineResumeReporter.logMainScreenLoadT(),P.OfflineResumeReporter.commit(),(0,O.processAllOrphanPaymentNotifications)(),(0,I.uploadChatThreadLoggingEvents)(),setTimeout((()=>{(0,y.doPendingDeviceSync)()}),2e3)}))()}_exceedResumeWithOpenTabLimit(e,t){return e+t>D||e>w&&e+t>R}}t.OfflineMessageHandlerImpl=L;const k=new L;function G(){return(G=(0,a.default)((function*(){h.default.createSnapshot(),_.default.createSnapshot(),E.default.createSnapshot(),yield Promise.all([h.default.checkpointQueue.wait(),_.default.checkpointQueue.wait(),E.default.checkpointQueue.wait()])}))).apply(this,arguments)}function U(){var e;(null===(e=window.location)||void 0===e?void 0:e.reload)&&window.location.reload()}t.OfflineMessageHandler=k},29783:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(27870),s=r(57319),o=r(92844),l=r(58464),c=r(88102),d=r(24747),u=n(r(69618)),p=r(93771),h=r(57701),f=n(r(54624)),_=r(76332),m=r(57793),g=r(74727),y=r(11849),E=r(77246),S=r(71251);var v=new class{constructor(){this.cache=[],this.checkpointQueue=new a.PromiseQueue,this.lastCheckpointIndex=0,this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()}))}addOfflineMessage(e){this.cache.push(...e),(0,l.isAdaptiveOfflineEnabled)()&&this.cache.length-this.lastCheckpointIndex>=200?this.createSnapshot():this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][msg-cache]: snapshot schedule in ${1e3} ms`,this.snapshotTimer.onOrAfter(1e3))}_addToMessageTable(e,t){var r=this;return(0,i.default)((function*(){const n=[],i=[];for(let a=e;a<t;a++){const e=r.cache[a].msg;null!=e&&((0,h.receiveReactionsEnabled)()&&e.type===u.default.MSG_TYPE.REACTION?i.push(r.cache[a]):n.push(e))}if(yield(0,S.storeOfflineMsgs)(n),i.length>0){const e=yield(0,m.createReactionsRowFromOffline)(i);yield(0,_.addOrUpdateReactionsDBBulk)(e)}}))()}_sendAggregateReceipts(e,t){var r=this;return(0,i.default)((function*(){const n=new Map,i=[];for(let a=e;a<t;a++){const e=r.cache[a].msg,t=r.cache[a].receiptInfo;if(!t)continue;const s=t.externalId||(null==e?void 0:e.id.id);if(!s)continue;const{from:o,author:l}=t;let c=n.get(o);c||(c=new Map,n.set(o,c));let d=c.get(l);d||(d=[],c.set(l,d)),d.push(s),i.push({from:String(o),author:String(l),externalId:s})}const a=String((0,o.unixTime)());Promise.all(Array.from(n.keys()).map((e=>{const t=n.get(e);if(t)return(0,g.sendAggregateReceipts)(e,g.RECEIPT_TYPE.DELIVERY,a,t)}))),(0,d.cancelDeadSocketTimer)(),yield(0,p.getTable)().createOrReplace({receipts:i})}))()}createSnapshot(){var e=this;this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const t=this.lastCheckpointIndex,r=this.cache.length;if(this.lastCheckpointIndex=r,__LOG__(2)`[offline-resume][msg-cache]: creating snapshot for offline ${t} to ${r}`,t===r)return;const n=f.default.generateSnapshot();this.checkpointQueue.enqueue((0,i.default)((function*(){yield e._addToMessageTable(t,r),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: messages done for ${t} - ${r}`,yield(0,E.getStorage)().lock(["session-store","identity-store","prekey-store","senderkey-store"],(0,i.default)((function*(){yield Promise.all([y.waSignalStore.bulkPutSession(n.sessionUpdate),y.waSignalStore.bulkPutIdentityKeyWithRowId(n.identityUpdate),y.waSignalStore.bulkPutSenderKey(n.senderKeyUpdate),y.waSignalStore.bulkRemovePreKey(n.preKeyRemove),y.waSignalStore.bulkRemoveSession(n.sessionRemove),y.waSignalStore.bulkRemoveIdentity(n.identityRemove)])}))),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: signal done for ${t} - ${r}`,yield e._sendAggregateReceipts(t,r),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: sending receipt done for ${t} - ${r}`,c.Cmd.handleOfflineProgressUpdate()})))}};t.default=v},66545:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(27870),s=r(57319),o=r(31914),l=r(24747),c=n(r(69618)),d=r(78956),u=r(99069),p=r(39410),h=r(58021);const{ACK:f,ACK_STRING:_}=c.default,m=Object.freeze({[f.RECEIVED]:_.DELIVERY,[f.READ]:_.READ,[f.PLAYED]:_.PLAYED,[f.INACTIVE]:_.INACTIVE}),g=1e3;function y(e){return(0,d.getTable)().bulkCreate(e)}function E(e,t){if(null!=e&&null!=t)return Math.min(e,t);const r=null!=e?e:t;return null!=r?r:void 0}var S=new class{constructor(){this.peerReadCache=[],this.otherReceiptCache=new Map,this.receiptAckCache=[],this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new a.PromiseQueue}addOfflinePeerReceipt(e,t,r){this.peerReadCache.push({ts:e,msgKeys:t,ack:r}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceipt(e,t,r,n){var i;const a=(0,h.toUserWid)(r).toString(),s=null!==(i=r.device)&&void 0!==i?i:c.default.DEVICE.PRIMARY_DEVICE;n.forEach((r=>{const n=m[e];if(!n)return void __LOG__(3)`[offline-resume][receipt-cache]: not supported ack type ${e}`;const i=`${r},${a}`,o=this.otherReceiptCache.get(i);o?(n!==m[f.INACTIVE]&&(o[n]=E(o[n],t)),o.deviceDelivered.add(s)):this.otherReceiptCache.set(i,{[n]:t,deviceDelivered:new Set([s])})})),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceiptAck(e,t,r,n){this.receiptAckCache.push({from:e,stanzaId:t,ackString:r,participant:n}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.otherReceiptCache),t=this.peerReadCache,r=this.receiptAckCache;__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot for ${e.length} other, ${t.length} peer`,this.checkpointQueue.enqueue((0,i.default)((function*(){var n;yield Promise.all([(n=e,(0,u.getStorage)().lock(["message-info"],function(){var e=(0,i.default)((function*(e){let[t]=e;const r=yield t.bulkGet(n.map((e=>e[0].split(",")))),i=r.map(((e,t)=>{const[r,i]=n[t];if(!i)return null;if(e){const t=i.deviceDelivered;return e.deviceDelivered.forEach((e=>t.add(e))),{delivery:E(e.delivery,i.delivery),read:E(e.read,i.read),played:E(e.played,i.played),msgKey:e.msgKey,receiverUserJid:e.receiverUserJid,deviceDelivered:Array.from(t),deviceNotDelivered:e.deviceNotDelivered.filter((e=>!t.has(e)))}}{const[e,t]=r.split(",");return{delivery:i.delivery,read:i.read,played:i.played,msgKey:e,receiverUserJid:t,deviceDelivered:Array.from(i.deviceDelivered),deviceNotDelivered:[]}}}));return t.bulkCreateOrReplace(i)}));return function(){return e.apply(this,arguments)}}())),y(t)]),function(e){e.forEach((e=>{let{from:t,stanzaId:r,ackString:n,participant:i}=e;const a=(0,o.wap)("ack",{to:(0,p.JID)(t),id:(0,o.CUSTOM_STRING)(r),class:"receipt",type:(0,o.MAYBE_CUSTOM_STRING)(n),participant:i&&i!==t?(0,p.DEVICE_JID)(i):o.DROP_ATTR});(0,l.castStanza)(a),(0,l.cancelDeadSocketTimer)()})),__LOG__(2)`[offline-resume][receipt-cache] finish sending ${e.length} acks`}(r),__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot done`}))),this.otherReceiptCache=new Map,this.peerReadCache=[],this.receiptAckCache=[]}};t.default=S},45607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendBatchRequestIb=function(e){if(!(0,i.isAdaptiveOfflineEnabled)())return;const t=(0,n.wap)("ib",null,(0,n.wap)("offline_batch",{count:(0,n.CUSTOM_STRING)(String(e))}));(0,a.castStanza)(t)};var n=r(31914),i=r(58464),a=r(24747)},71251:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storeOfflineMsgs=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(68638),s=n(r(69618)),o=r(7293),l=r(57701),c=r(91525),d=r(10435),u=r(90981),p=r(63728),h=r(17304),f=r(54676),_=r(12600),m=r(49831),g=r(90641),y=r(76332),E=r(99069),S=r(12896);function v(){return(v=(0,i.default)((function*(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))try{const{newMsgs:t,replaceMsgs:r,revokeMsgs:n,paymentMessages:a,chatsWithNewOfflineMsg:s}=yield b(e);__LOG__(2)`[offline-resume][msg-cache] storeOfflineMsgs: newMsgs: ${t.length}, replaceMsgs: ${r.length}, revokeMsgs: ${n.length}, paymentMessages: ${a.length}`;const o=yield(0,m.applyOrphanRevoke)(t),[d,h]=yield Promise.all([T(o),(0,g.encryptMultipleMsgs)(o,!1)]);yield(0,u.getTable)().bulkCreateOrReplace(r),yield(0,E.getStorage)().lock(["chat","message","fts-indexing-queue"],function(){var e=(0,i.default)((function*(e){let[t,r,n]=e;yield t.bulkCreateOrMerge(d),yield(0,g.storeEncryptedMessage)(h,s,!1)}));return function(){return e.apply(this,arguments)}}()),yield C(n),yield(0,g.processPaymentMessages)(a),yield(0,c.handleOfflineForMessageRange)(e);const f=e.map((e=>e.id.toString()));yield(0,_.checkOrphanMutations)(f,s),(0,l.receiveReactionsEnabled)()&&(yield(0,y.checkUpdateForOrphanReactions)(f)),t.forEach((e=>{M(e)&&(0,p.addPlaceHolderAction)(e)}))}catch(e){__LOG__(4,void 0,new Error,!0)`[offline-resume] Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("storeOfflineMsgs-error")}}))).apply(this,arguments)}function T(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{const r=e.id,n=r.remote.toString();if(n!==s.default.STATUS_WID&&(0,S.isUnreadTypeMsg)(e)){const i=t.get(n)||{unread:0,t:0,unreadMentionsOfMe:[]};if(!r.fromMe&&(i.unread+=1,(0,d.isGroupCatchUpEnabled)()&&(0,f.isImportantMessage)(e))){const t={id:e.id.toString(),timestamp:e.t};i.unreadMentionsOfMe?i.unreadMentionsOfMe.push(t):i.unreadMentionsOfMe=[t]}e.t>i.t&&(i.t=Math.max(e.t,i.t)),t.set(n,i)}}));const r=Array.from(t.keys()),n=(yield(0,a.getTable)().bulkGet(r)).map(((e,n)=>{var i;const a=r[n],s=t.get(a),o=(null==s?void 0:s.unread)||0,l=Math.max(0,e?e.unreadCount:0);let c=(null==s?void 0:s.t)||void 0;e&&null!=e.t&&(null==c||e.t>c)&&(c=e.t);let u=[],p=null!==(i=null==e?void 0:e.archiveAtMentionViewedInDrawer)&&void 0!==i&&i;if((0,d.isGroupCatchUpEnabled)()){var h,f;const t=null!==(h=null==s?void 0:s.unreadMentionsOfMe)&&void 0!==h?h:[],r=null!==(f=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==f?f:[];t.length>0&&(p=!1),u=t.concat(r)}return{id:a,unreadCount:l+o,t:c,unreadMentionsOfMe:u,archiveAtMentionViewedInDrawer:p}}));return __LOG__(2)`[offline-resume][msg-cache]: storing chat updates: ${JSON.stringify(n)}`,n}))).apply(this,arguments)}function C(e){const t=[];return e.forEach((e=>{const r=new h.Msg(e);r.protocolMessageKey&&t.push({revokeMsgKey:r.protocolMessageKey,newMsgKey:r.id,timestamp:r.t,subtype:r.subtype,sender:r.sender})})),(0,g.processRevokeMsgs)(t)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=yield(0,u.getTable)().bulkGet(e.map((e=>String(e.id))),!1),r=[],n=[],i=[],a=[],o=new Set,l=new Map;return e.forEach(((e,c)=>{const d=String(e.id),u=t[c];if(u)if(M(u)){const t=(0,S.convertToMessageRowType)(e);t.t=u.t,t.internalId=u.internalId,t.rowId=u.rowId,n.push(t),(0,p.populatePlaceHolderAction)(u)}else r.push(e.id.id);else{const t=l.get(d);t&&!M(t)?r.push(e.id.id):["sender_revoke","admin_revoke"].includes(e.subtype)?i.push(e):e.type===s.default.MSG_TYPE.PAYMENT&&"send"===e.subtype||"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype?(a.push(e),l.set(d,e),o.add(String(e.id.remote))):(l.set(d,e),o.add(String(e.id.remote)))}})),r.length>0&&__LOG__(2)`[offline-resume] classifyOfflineMsgs: skip for ${r.length} duplicate messages, with id ${r}`,{newMsgs:Array.from(l.values()),chatsWithNewOfflineMsg:Array.from(o),replaceMsgs:n,revokeMsgs:i,paymentMessages:a}}))).apply(this,arguments)}function M(e){return e.type===s.default.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype||e.type===s.default.MSG_TYPE.CIPHERTEXT}},50404:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);{const e=t.success;if(e&&e.refs&&Array.isArray(e.refs)&&6===e.refs.length){const{refs:t,id:r}=e;(0,l.castStanza)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"result",id:(0,a.CUSTOM_STRING)(r)})),(0,o.generateADVSecretKey)(),f=t,_||(_=new i.ShiftTimer((()=>{if(!(0,u.isRegistered)()&&p.default.online&&d.GK.supportsFeature(d.GK.F.MD_BACKEND))if(f&&f.length){const e=6===f.length?6e4:2e4,t=f.shift();c.Conn.set({ref:t,refTTL:e}),h.Socket.state=h.STATE.UNPAIRED,_&&_.onOrAfter(e)}else _&&_.cancel(),_=null,h.Socket.state=h.STATE.UNPAIRED_IDLE;else _&&_.cancel(),_=null}))),_.forceRunNow()}else __LOG__(3)`handlePairDevice: wrong pair device result received from server`}};var i=r(57319),a=r(31914),s=r(71914),o=r(24863),l=r(24747),c=r(17239),d=r(7293),u=r(58052),p=n(r(57220)),h=r(65044);let f=[],_=null;const m=new s.WapParser("pairDeviceParser",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.child("pair-device").forEachChild((e=>{e.assertTag("ref"),t.push(e.contentString())})),{refs:t,id:e.attrString("id")}}))},58645:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return D.apply(this,arguments)};var a=i(r(48926)),s=r(15688),o=r(92844),l=r(31914),c=r(71914),d=r(84902),u=r(60980),p=i(r(41143)),h=r(61438),f=r(24863),_=r(24747),m=r(17186),g=r(17239),y=r(5087),E=n(r(91214)),S=r(99234),v=i(r(39827)),T=r(85553),A=r(83578),C=i(r(11339)),b=r(58052),P=r(11849),M=r(93832),O=r(58021),I=r(65044);let w=!1;const R=new c.WapParser("pairSuccessParser",(e=>{var t;e.assertTag("iq"),e.assertFromServer();const r=e.attrString("id"),n=e.child("pair-success"),i=null===(t=n.maybeChild("platform"))||void 0===t?void 0:t.maybeAttrString("name"),a=n.child("device"),s=n.child("device-identity").contentBytes(),o=n.maybeChild("biz"),l=o?o.attrString("name"):"";return{wid:(0,T.deviceJidToDeviceWid)(a.attrDeviceJid("jid")),id:r,deviceIdentityBytes:s,businessName:l,platform:i}}));function D(){return(D=(0,a.default)((function*(e){if(w||(0,b.isRegistered)())return;(0,S.getShowMdUpgradeCompleteMsg)()&&((0,S.setShowMdUpgradeCompleteMsg)(!1),(0,S.setForcedMdUpgradeComplete)(!1)),w=!0;const t=(0,o.unixTime)(),r=R.parse(e);if(r.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${r.error.toString()}`,w=!1,Promise.reject(r.error);try{(0,m.resetCompanionReg)(),(0,S.setHistorySyncEarliestDate)(t);const e=r.success,{id:n,wid:i,deviceIdentityBytes:a,platform:o}=e;g.Conn.blockStoreAdds=!1,o&&(g.Conn.platform=o);const c=(0,d.decodeProtobuf)(h.ADVSignedDeviceIdentityHMACSpec,a),T=c.details,A=c.hmac;(0,p.default)(null!=T&&null!=A,"ADVSignedDeviceIdentityHMAC should not have empty details or hmac");const I=(0,f.getADVSecretKey)(),R=yield new v.default(I).sign(T),D=(0,s.encodeB64)(R);if(D!==(0,s.encodeB64)(A))return(0,_.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),(0,m.logoutAfterValidationFail)(),void(w=!1);const N=(0,d.decodeProtobuf)(h.ADVSignedDeviceIdentitySpec,T),L=N.accountSignatureKey;(0,p.default)(null!=L,"accountSignatreKey should not be null");const k=N.accountSignature;(0,p.default)(null!=k,"accountSignature should not be null");const G=yield P.waSignalStore.getRegistrationInfo();(0,p.default)(null!=G,"Empty regInfo"),E.initDeviceLinkEvent(L,G.identityKeyPair.pubKey,t),E.setDeviceLinkPairStage(C.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_SUCCESS_RECEIVED);if(!(0,f.verifyDeviceIdentityAccountSignature)(N,G.identityKeyPair.pubKey))return(0,_.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),E.commitDeviceLinkEvent(401),(0,m.logoutAfterValidationFail)(),void(w=!1);N.deviceSignature=(0,f.generateDeviceSignature)(N,G.identityKeyPair,L),yield P.waSignalStore.putIdentity((0,M.createSignalAddress)((0,O.toUserWid)(i)).toString(),(0,M.bufferToStr)((0,y.toSignalCurvePubKey)(L))),yield(0,f.setADVSignedIdentity)(N);const U=(0,d.decodeProtobuf)(h.ADVDeviceIdentitySpec,N.details).keyIndex;(0,p.default)(null!=U,"keyIndex should not be null"),N.accountSignatureKey=void 0;const F=(0,u.encodeProtobuf)(h.ADVSignedDeviceIdentitySpec,N).readByteArray();(0,_.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"result",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("pair-device-sign",null,(0,l.wap)("device-identity",{"key-index":(0,l.INT)(U)},F)))),E.setDeviceLinkPairStage(C.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_DEVICE_SIGN_SENT),(0,S.setMdOptedIn)(!0),(0,S.setMe)(i),(0,b.getInitialHistorySyncComplete)()||(0,m.startInitialHistorySyncTimeout)(),w=!1}catch(e){__LOG__(4,!0,new Error,!0)`error in handlePairSuccess, ${e}`,SEND_LOGS("error in handlePairSuccess"),(0,E.commitDeviceLinkEvent)(-1),I.Socket.logout(!1,A.LogoutReason.UnknownCompanion)}}))).apply(this,arguments)}},2599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAmount1000AndCurrency=function(e){return function(e){if(e.hasChild("amount")){return function(e){e.assertTag("money");const t=parseFloat(e.attrString("value")),n=e.attrString("currency"),i=e.maybeAttrInt("offset");return{currency:n,amount1000:t*r/(null!=i&&0!==i?i:r)}}(e.child("amount").child("money"))}if(e.hasAttr("amount")){return{amount1000:parseFloat(e.attrString("amount"))*r,currency:e.attrString("currency")}}throw __LOG__(3)`Amount missing in pay or transaction node`,new Error("Amount missing in pay or transaction node")}(e)};const r=1e3},27258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(55552).handlePaymentNotification;t.default=n},55552:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePaymentNotification=function(){return y.apply(this,arguments)},t.parseNotificationPaymentInfo=T,t.processAllOrphanPaymentNotifications=function(){return C.apply(this,arguments)},t.processOrphanPaymentNotifications=function(){return A.apply(this,arguments)},t.updateReceivedPaymentInfo=S;var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(35588),l=r(84886),c=r(17304),d=r(59871),u=r(5819),p=n(r(32219)),h=r(45377),f=r(75295),_=r(39577),m=r(31019),g=r(52586);function y(){return(y=(0,a.default)((function*(e){if(e.content&&"invite"===e.content[0].tag)return E(e);{const t=f.paymentNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);{if(!t.success)return Promise.resolve();const e=t.success,r=(0,s.default)(e.msgKey,"info.msgKey"),n=d.MsgCollection.get(r),a=n?(0,m.unproxy)(n):yield(0,o.getMsgByMsgKey)(r);if(!a){__LOG__(3)`handlePaymentNotification: no msg found for id ${r.toString()}`;const t=(0,i.default)((0,i.default)({},e),{},{msgKey:r.toString()});return(0,h.getTable)().createOrReplace(t)}return S(a,e)}}}))).apply(this,arguments)}function E(e){const t=f.paymentInviteNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);{if(!t.success)return Promise.resolve();const e=t.success;if("account-set-up"===e.type){const t=(0,_.genPaymentInviteAccoutSetupMsg)(e.from,e.timestamp);return(0,u.handleSingleMsgMD)(t.from,t)}return Promise.resolve()}}function S(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){const r=[];T(e,t),r.push(e.id.toString());const n=[e instanceof c.Msg?e.toJSON():e];if(null!=e.paymentRequestMessageKey){const t=d.MsgCollection.get(e.paymentRequestMessageKey),r=t?(0,m.unproxy)(t):yield(0,o.getMsgByMsgKey)(e.paymentRequestMessageKey||"");r&&(r.paymentStatus=e.paymentStatus,r.paymentTxnStatus=(0,g.determinePaymentRequestFulfilledStatus)(e.paymentTxnStatus),n.push(r instanceof c.Msg?r.toJSON():r))}return(0,h.getTable)().bulkRemove(r).catch((()=>{__LOG__(4,void 0,new Error)`getOrphanPaymentNotificationTable bulkremove of ${r} failed. {e}`})),(0,l.updateExistingMessages)(n)}))).apply(this,arguments)}function T(e,t){t&&(null!=t.status&&(e.paymentStatus=(0,g.getPaymentWebStatus)(t.status,t.type),e.paymentTxnStatus=(0,g.getPaymentTxnWebStatus)(t.status)),e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,s.default)(t.amount1000,"mdPaymentInfo.amount1000"),e.paymentMessageReceiverJid=t.receiver,e.paymentTransactionTimestamp=(0,s.default)(t.ts,"mdPaymentInfo.ts"))}function A(){return(A=(0,a.default)((function*(e){const t=e.map((e=>e.id.toString())),r=yield(0,h.getTable)().bulkGet(t),n=new Map;e.forEach((e=>{n.set(e.id.toString(),e)})),r.forEach((e=>{if(e){const t=n.get(e.msgKey);if(!t)return;S(t,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:p.default.fromString(e.msgKey)})}}))}))).apply(this,arguments)}function C(){return(C=(0,a.default)((function*(){const e=yield(0,h.getTable)().all(),t=new Map,r=[];if(e.forEach((e=>{const n=d.MsgCollection.get(e.msgKey);n?S(n,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:p.default.fromString(e.msgKey)}):(t.set(e.msgKey,e),r.push(e.msgKey))})),r.length>0){const e=yield(0,o.getMsgsByMsgKey)(r);return e.forEach((e=>{const r=t.get(e.id.toString());r&&(e.paymentTxnStatus=(0,g.getPaymentTxnWebStatus)(r.status),e.paymentCurrency=r.currency||"",e.paymentAmount1000=(0,s.default)(r.amount1000,"notification.amount1000"),e.paymentMessageReceiverJid=r.receiver,e.paymentTransactionTimestamp=(0,s.default)(r.ts,"notification.ts"))})),(0,l.updateExistingMessages)(e)}}))).apply(this,arguments)}},75295:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isNoviTransaction=d,t.parseTransactionNode=h,t.paymentNotificationParser=t.paymentInviteNotificationParser=void 0;var i=r(71914),a=r(2599),s=r(99234),o=r(85553),l=n(r(32219)),c=r(52586);function d(e){return!(!e||!e.hasAttr("service")||"NOVI"!==e.attrString("service").toUpperCase())}const u=new i.WapParser("paymentNotificationParser",(e=>{if(e.hasChild("transaction")){return h(e.child("transaction"))}return __LOG__(2)`No transaction node in the payment notification`,null}));t.paymentNotificationParser=u;const p=new i.WapParser("paymentInviteNotificationParser",(e=>{if(e.hasChild("invite")){const t=e.child("invite");return{type:t.maybeAttrString("type"),service:t.maybeAttrString("service"),inviteUsed:t.hasAttr("invite-used")?"1"===t.attrString("invite-used"):null,from:(0,o.chatJidToChatWid)(e.attrChatJid("from")),timestamp:e.attrTime("t")}}return __LOG__(2)`No invite node in the payment invite notification`,null}));function h(e){if(d(e))return __LOG__(2)`Payment notification from Novi not supported`,null;let t,r;const n=(0,s.getMeUser)(),i=(0,o.jidWithTypeToWid)(e.attrJidWithType("sender")),u=(0,o.jidWithTypeToWid)(e.attrJidWithType("receiver")),p=n.equals(i);e.hasAttr("group")?(t=(0,o.jidWithTypeToWid)(e.attrJidWithType("group")),r=(0,o.jidWithTypeToWid)(e.attrJidWithType("sender"))):t=p?u:i;const h=new l.default({id:e.attrString("message-id"),fromMe:p,remote:t,participant:r}),f=(0,c.getPaymentTransactionType)(e.attrString("transaction-type"),h.fromMe),{amount1000:_,currency:m}=(0,a.getAmount1000AndCurrency)(e);return{receiver:u,currency:m,amount1000:_,status:(0,c.getNotificationTransactionStatus)(f,e.attrString("status")),ts:e.attrInt("ts"),type:f,msgKey:h}}t.paymentInviteNotificationParser=p},52586:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentTransactionTypeServerString=t.PaymentTransactionType=t.PaymentTransactionStatusServerString=t.NotificationTransactionStatus=void 0,t.determinePaymentRequestFulfilledStatus=function(e){if(function(e){return e===n.PaymentInfoTxnStatus.COMPLETED||e===n.PaymentInfoTxnStatus.SUCCESS}(e))return e;return n.PaymentInfoTxnStatus.COLLECT_INIT},t.getNotificationTransactionStatus=function(e,t){if(!t)return a.STATUS_UNSET;const r=t.toUpperCase();switch(e){case i.TYPE_P2P_SENT:case i.TYPE_P2M_SENT:case i.TYPE_DEPOSIT:switch(r){case o.PENDING_RECEIVER_SETUP:return a.SEND_PAY_PENDING_RECEIVER;case o.FAILED_DA:return a.SEND_PAY_PENDING;case o.REFUND_FAILED_DA:return a.SEND_PAY_REFUND_PENDING;case o.FAILED_RISK:return a.SEND_PAY_FAILURE_RISK;case o.INITIAL:return a.SEND_PAY_INIT;case o.SUCCESS:case o.COMPLETED:return a.SEND_PAY_SUCCESS;case o.FAILURE:case o.FAILED:return a.SEND_PAY_FAILURE;case o.REFUNDED:return a.SEND_PAY_REFUNDED;case o.REFUND_FAILED:return a.SEND_PAY_REFUND_FAILED;case o.FAILED_RECEIVER_PROCESSING:return a.SEND_PAY_FAILURE_RECEIVER;case o.REFUND_FAILED_PROCESSING:return a.SEND_PAY_REFUND_FAILED_PROCESSING;case o.FAILED_DA_FINAL:return a.SEND_PAY_PENDING_REFUND;case o.AUTH_CANCEL_FAILED_PROCESSING:return a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING;case o.AUTH_CANCEL_FAILED:return a.SEND_PAY_AUTH_CANCEL_FAILED;case o.AUTH_CANCELED:return a.SEND_PAY_AUTH_CANCELED;case o.EXPIRED:return a.SEND_PAY_EXPIRED;case o.IN_REVIEW:return a.SEND_PAY_IN_REVIEW;case o.PENDING:return a.SEND_PAY_PENDING_PROCESSING;case o.CANCELED:return a.SEND_PAY_USER_CANCELED}break;case i.TYPE_P2P_RCVD:case i.TYPE_P2M_RCVD:switch(r){case o.PENDING_SETUP:return a.RECV_PAY_PENDING_SETUP;case o.FAILED_DA:return a.RECV_PAY_PENDING;case o.FAILED_PROCESSING:return a.RECV_PAY_RETRY_ON_FAILURE;case o.SUCCESS:case o.COMPLETED:return a.RECV_PAY_SUCCESS;case o.FAILURE:case o.FAILED:return a.RECV_PAY_FAILURE;case o.EXPIRED:return a.RECV_PAY_EXPIRED;case o.FAILED_RISK:return a.RECV_PAY_FAILURE_RISK;case o.WITHDRAWAL_PROCESSING:return a.RECV_PAY_WITHDRAWAL_PROCESSING;case o.WITHDRAWAL_FAILURE:return a.RECV_PAY_WITHDRAWAL_FAILURE;case o.WITHDRAWAL_PERMANENT_FAILED:return a.RECV_PAY_WITHDRAWAL_PERMANENT_FAILED;case o.CANCELED:return a.RECV_PAY_SENDER_CANCELED}break;case i.TYPE_P2P_REQ_SENT:case i.TYPE_P2P_REQ_RCVD:switch(r){case o.COLLECT_SUCCESS:return a.REQUEST_PAY_SUCCESS;case o.COLLECT_FAILED:return a.REQUEST_PAY_FAILED;case o.COLLECT_FAILED_RISK:return a.REQUEST_PAY_FAILED_RISK;case o.COLLECT_REJECTED:return a.REQUEST_PAY_REJECTED;case o.COLLECT_EXPIRED:return a.REQUEST_PAY_EXPIRED;case o.COLLECT_CANCELED:return a.REQUEST_PAY_CANCELLED}break;case i.TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:switch(r){case o.COLLECT_SUCCESS:return a.REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS;case o.AUTH_SUCCESS:return a.SEND_PAY_AUTH_SUCCESS}break;case i.TYPE_REFUND:switch(r){case o.SUCCESS:case o.COMPLETED:return a.RECV_PAY_SUCCESS}break;case i.TYPE_WITHDRAWAL:switch(r){case o.PENDING:return a.WITHDRAWAL_PENDING;case o.IN_REVIEW:return a.WITHDRAWAL_IN_REVIEW;case o.SUCCESS:case o.COMPLETED:return a.WITHDRAWAL_SUCCESS;case o.FAILED:case o.DECLINED:return a.WITHDRAWAL_FAILED;case o.CANCELED:return a.WITHDRAWAL_USER_CANCELED;case o.EXPIRED:return a.WITHDRAWAL_EXPIRED;case o.WITHDRAWAL_ACTIVE:return a.WITHDRAWAL_ACTIVE}break;default:return a.STATUS_UNSET}return a.STATUS_UNSET},t.getPaymentTransactionType=function(e,t){if(e){const r=e.toLowerCase();switch(r){case s.TYPE_P2P:return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD;case s.TYPE_P2M:return t?i.TYPE_P2M_SENT:i.TYPE_P2M_RCVD;case s.TYPE_P2M_PAYOUT:return i.TYPE_P2M_PAYOUT;case s.TYPE_DEPOSIT:return i.TYPE_DEPOSIT;case s.TYPE_REFUND:return i.TYPE_REFUND;case s.TYPE_WITHDRAWAL:return i.TYPE_WITHDRAWAL;default:__LOG__(2)`parsePaymentTransactionType payment transaction string=${r}`}}return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD},t.getPaymentTxnWebStatus=function(e){if(null==e)return n.PaymentInfoTxnStatus.UNKNOWN;switch(e){case a.RECV_PAY_EXPIRED:case a.SEND_PAY_EXPIRED:return n.PaymentInfoTxnStatus.EXPIRED_TXN;case a.RECV_PAY_FAILURE:case a.SEND_PAY_FAILURE:return n.PaymentInfoTxnStatus.FAILED;case a.RECV_PAY_INIT:case a.SEND_PAY_INIT:return n.PaymentInfoTxnStatus.INIT;case a.RECV_PAY_PENDING_SETUP:return n.PaymentInfoTxnStatus.PENDING_SETUP;case a.RECV_PAY_PENDING:case a.SEND_PAY_PENDING:return n.PaymentInfoTxnStatus.FAILED_DA;case a.RECV_PAY_RETRY_ON_FAILURE:return n.PaymentInfoTxnStatus.FAILED_PROCESSING;case a.RECV_PAY_SUCCESS:case a.SEND_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return n.PaymentInfoTxnStatus.SUCCESS;case a.REQUEST_PAY_CANCELLED:return n.PaymentInfoTxnStatus.COLLECT_CANCELED;case a.REQUEST_PAY_CANCELLING:return n.PaymentInfoTxnStatus.COLLECT_CANCELLING;case a.REQUEST_PAY_EXPIRED:return n.PaymentInfoTxnStatus.COLLECT_EXPIRED;case a.REQUEST_PAY_FAILED_RISK:return n.PaymentInfoTxnStatus.COLLECT_FAILED_RISK;case a.REQUEST_PAY_FAILED:return n.PaymentInfoTxnStatus.COLLECT_FAILED;case a.REQUEST_PAY_INIT:return n.PaymentInfoTxnStatus.COLLECT_INIT;case a.REQUEST_PAY_REJECTED:return n.PaymentInfoTxnStatus.COLLECT_REJECTED;case a.REQUEST_PAY_SUCCESS:return n.PaymentInfoTxnStatus.COLLECT_SUCCESS;case a.SEND_PAY_AUTH_CANCELED:return n.PaymentInfoTxnStatus.AUTH_CANCELED;case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return n.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED_PROCESSING;case a.SEND_PAY_AUTH_CANCEL_FAILED:return n.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED;case a.SEND_PAY_FAILURE_RECEIVER:return n.PaymentInfoTxnStatus.FAILED_RECEIVER_PROCESSING;case a.SEND_PAY_FAILURE_RISK:case a.RECV_PAY_FAILURE_RISK:return n.PaymentInfoTxnStatus.FAILED_RISK;case a.SEND_PAY_PENDING_RECEIVER:return n.PaymentInfoTxnStatus.PENDING_RECEIVER_SETUP;case a.SEND_PAY_PENDING_REFUND:return n.PaymentInfoTxnStatus.FAILED_DA_FINAL;case a.SEND_PAY_REFUNDED:return n.PaymentInfoTxnStatus.REFUNDED_TXN;case a.SEND_PAY_REFUND_FAILED_PROCESSING:return n.PaymentInfoTxnStatus.REFUND_FAILED_PROCESSING;case a.SEND_PAY_REFUND_FAILED:return n.PaymentInfoTxnStatus.REFUND_FAILED;case a.SEND_PAY_REFUND_PENDING:return n.PaymentInfoTxnStatus.REFUND_FAILED_DA;case a.SEND_PAY_IN_REVIEW:return n.PaymentInfoTxnStatus.IN_REVIEW;case a.STATUS_UNSET:default:return n.PaymentInfoTxnStatus.UNKNOWN}},t.getPaymentWebStatus=function(e,t){if(null==e)return n.PaymentInfoStatus.UNKNOWN_STATUS;switch(e){case a.SEND_PAY_INIT:case a.SEND_PAY_PENDING:case a.RECV_PAY_INIT:case a.RECV_PAY_PENDING:case a.RECV_PAY_RETRY_ON_FAILURE:case a.REQUEST_PAY_INIT:return n.PaymentInfoStatus.PROCESSING;case a.SEND_PAY_PENDING_RECEIVER:case a.SEND_PAY_FAILURE_RECEIVER:return n.PaymentInfoStatus.SENT;case a.REQUEST_PAY_SUCCESS:return t===i.TYPE_P2P_REQ_SENT?n.PaymentInfoStatus.WAITING_FOR_PAYER:n.PaymentInfoStatus.WAITING;case a.RECV_PAY_PENDING_SETUP:return n.PaymentInfoStatus.NEED_TO_ACCEPT;case a.SEND_PAY_SUCCESS:case a.RECV_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return n.PaymentInfoStatus.COMPLETE;case a.SEND_PAY_FAILURE:case a.SEND_PAY_FAILURE_RISK:case a.SEND_PAY_PENDING_REFUND:case a.SEND_PAY_REFUND_PENDING:case a.SEND_PAY_REFUND_FAILED:case a.SEND_PAY_REFUND_FAILED_PROCESSING:case a.RECV_PAY_FAILURE:case a.REQUEST_PAY_FAILED:case a.REQUEST_PAY_FAILED_RISK:return n.PaymentInfoStatus.COULD_NOT_COMPLETE;case a.SEND_PAY_REFUNDED:return n.PaymentInfoStatus.REFUNDED;case a.RECV_PAY_EXPIRED:case a.REQUEST_PAY_EXPIRED:case a.SEND_PAY_AUTH_CANCELED:case a.SEND_PAY_AUTH_CANCEL_FAILED:case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return n.PaymentInfoStatus.EXPIRED;case a.REQUEST_PAY_REJECTED:return n.PaymentInfoStatus.REJECTED;case a.REQUEST_PAY_CANCELLED:return n.PaymentInfoStatus.CANCELLED;case a.STATUS_UNSET:case a.REQUEST_PAY_CANCELLING:default:return n.PaymentInfoStatus.UNKNOWN_STATUS}};var n=r(21224);const i=r(54302)({TYPE_UNSET:0,TYPE_P2P_SENT:1,TYPE_P2P_RCVD:2,TYPE_P2P_GRP:3,TYPE_P2P_NO_INFO:4,TYPE_FUTURE:5,TYPE_P2P_REQ_SENT:10,TYPE_P2P_REQ_RCVD:20,TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:21,TYPE_P2P_REQ_GRP:30,TYPE_P2M_SENT:100,TYPE_P2M_RCVD:200,TYPE_P2M_PAYOUT:300,TYPE_MISSING_DETAILS:400,TYPE_DEPOSIT:500,TYPE_REFUND:600,TYPE_WITHDRAWAL:700});t.PaymentTransactionType=i;const a=r(54302)({STATUS_UNSET:0,REQUEST_PAY_INIT:11,REQUEST_PAY_SUCCESS:12,REQUEST_PAY_FAILED:13,REQUEST_PAY_FAILED_RISK:14,REQUEST_PAY_REJECTED:15,REQUEST_PAY_EXPIRED:16,REQUEST_PAY_FULFILLED:17,REQUEST_PAY_CANCELLED:18,REQUEST_PAY_CANCELLING:19,REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS:20,RECV_PAY_INIT:101,RECV_PAY_PENDING_SETUP:102,RECV_PAY_PENDING:103,RECV_PAY_RETRY_ON_FAILURE:104,RECV_PAY_FAILURE:105,RECV_PAY_SUCCESS:106,RECV_PAY_EXPIRED:107,RECV_PAY_FAILURE_RISK:108,RECV_PAY_WITHDRAWAL_PROCESSING:109,RECV_PAY_WITHDRAWAL_FAILURE:110,RECV_PAY_WITHDRAWAL_PERMANENT_FAILED:111,RECV_PAY_SENDER_CANCELED:112,SEND_PAY_INIT:401,SEND_PAY_PENDING_RECEIVER:402,SEND_PAY_PENDING:403,SEND_PAY_REFUND_PENDING:404,SEND_PAY_SUCCESS:405,SEND_PAY_FAILURE:406,SEND_PAY_FAILURE_RISK:407,SEND_PAY_REFUNDED:408,SEND_PAY_REFUND_FAILED:409,SEND_PAY_FAILURE_RECEIVER:410,SEND_PAY_REFUND_FAILED_PROCESSING:411,SEND_PAY_PENDING_REFUND:412,SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:413,SEND_PAY_AUTH_CANCEL_FAILED:414,SEND_PAY_AUTH_CANCELED:415,SEND_PAY_EXPIRED:416,SEND_PAY_AUTH_SUCCESS:417,SEND_PAY_AUTH_SUCCESS_CANCELING:418,SEND_PAY_IN_REVIEW:419,SEND_PAY_PENDING_PROCESSING:420,SEND_PAY_USER_CANCELED:421,WITHDRAWAL_INIT:601,WITHDRAWAL_PENDING:602,WITHDRAWAL_IN_REVIEW:603,WITHDRAWAL_SUCCESS:604,WITHDRAWAL_FAILED:605,WITHDRAWAL_USER_CANCELED:606,WITHDRAWAL_EXPIRED:607,WITHDRAWAL_ACTIVE:608});t.NotificationTransactionStatus=a;const s={TYPE_P2P:"p2p",TYPE_P2M:"p2m",TYPE_P2M_PAYOUT:"payout",TYPE_WITHDRAWAL:"withdrawal",TYPE_DEPOSIT:"deposit",TYPE_REFUND:"refund"};t.PaymentTransactionTypeServerString=s;const o={PENDING_RECEIVER_SETUP:"PENDING_RECEIVER_SETUP",PENDING_SETUP:"PENDING_SETUP",PENDING:"PENDING",INITIAL:"INITIAL",SUCCESS:"SUCCESS",COMPLETED:"COMPLETED",IN_REVIEW:"IN_REVIEW",FAILED:"FAILED",DECLINED:"DECLINED",FAILURE:"FAILURE",FAILED_RISK:"FAILED_RISK",FAILED_PROCESSING:"FAILED_PROCESSING",FAILED_RECEIVER_PROCESSING:"FAILED_RECEIVER_PROCESSING",REFUND_FAILED_PROCESSING:"REFUND_FAILED_PROCESSING",REFUNDED:"REFUNDED",REFUND_FAILED:"REFUND_FAILED",EXPIRED:"EXPIRED",CANCELED:"CANCELLED",AUTH_SUCCESS:"AUTH_SUCCESS",AUTH_CANCELED:"AUTH_CANCELED",AUTH_CANCEL_FAILED_PROCESSING:"AUTH_CANCEL_FAILED_PROCESSING",AUTH_CANCEL_FAILED:"AUTH_CANCEL_FAILED",COLLECT_SUCCESS:"COLLECT_SUCCESS",COLLECT_FAILED:"COLLECT_FAILED",COLLECT_REJECTED:"COLLECT_REJECTED",COLLECT_EXPIRED:"COLLECT_EXPIRED",COLLECT_CANCELED:"COLLECT_CANCELED",FAILED_DA:"FAILED_DA",FAILED_DA_FINAL:"FAILED_DA_FINAL",REFUND_FAILED_DA:"REFUND_FAILED_DA",COLLECT_FAILED_RISK:"COLLECT_FAILED_RISK",WITHDRAWAL_PROCESSING:"WITHDRAWAL_PROCESSING",WITHDRAWAL_FAILURE:"WITHDRAWAL_FAILURE",WITHDRAWAL_PERMANENT_FAILED:"WITHDRAWAL_PERMANENT_FAILED",WITHDRAWAL_ACTIVE:"WITHDRAWAL_ACTIVE"};t.PaymentTransactionStatusServerString=o},65347:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=l.parse(e);if(r.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${r.error.toString()}`,Promise.reject(r.error);{const e=r.success,i=(0,n.wap)("ack",{to:n.S_WHATSAPP_NET,id:(0,n.CUSTOM_STRING)(e.stanzaId),class:"notification"});return o.has(t)?i:(o.add(t),a.waSignalStore.setServerHasPreKeys(!1),(0,s.uploadPreKeys)().then((()=>i)).finally((()=>{o.delete(t)})))}};var n=r(31914),i=r(71914),a=r(11849),s=r(46669);const o=new Set,l=new i.WapParser("lowKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),{stanzaId:e.attrString("id"),numRemaining:e.child("count").attrInt("value")})))},46007:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,a.default)(t.success)};var i=r(71914),a=n(r(54248)),s=r(85553);const o=new i.WapParser("incomingPresenceParser",(e=>{e.assertTag("presence");const t=e.attrEnumOrDefault("type",{available:"available",unavailable:"unavailable",unsubscribe:"unsubscribe"},"available"),r="deny"===e.maybeAttrString("last")||void 0;let n;return"unavailable"===t&&(e.hasAttr("last")?["deny","none","error"].includes(e.attrString("last"))||(n=e.attrTime("last")):n=Date.now()),{id:(0,s.chatJidToChatWid)(e.attrChatJid("from")),type:t,t:n,deny:r}}))},6571:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(86945),l=r(11365),c=r(85553),d=r(68315),u=r(59201);const p=new s.WapParser("incomingPrivacyTokensParser",(e=>{e.assertTag("notification");return{id:e.attrString("id"),from:e.attrUserJid("from"),privacyTokens:e.child("tokens").mapChildrenWithTag("token",(e=>({type:e.attrString("type"),content:(0,l.uint8ArrayToBuffer)(e.contentBytes()),ts:e.attrTime("t")})))}}));function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const{type:r,content:n,ts:i}=t;if("trusted_contact"!==r)return;const a=(0,c.userJidToUserWid)(e.from);yield(0,u.setTcToken)(a,i,n),yield d.PresenceCollection.reSubscribeWhenActive(a)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:r}=t,n=(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(r.id),class:"notification",to:(0,a.JID)(r.from),type:"privacy_token"});return(0,o.getABPropConfigValue)("trusted_contacts")?(yield Promise.all(r.privacyTokens.map((e=>h(r,e)))),n):n}))).apply(this,arguments)}},2276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);{const e=t.success;let r=Promise.resolve();if(e.jid){const t=e.jid;switch(e.type){case"delete":case"set":const n="delete"===e.type?c.PROFILE_PIC_COMMAND.REMOVE:c.PROFILE_PIC_COMMAND.SET;r=(0,d.changeProfilePicThumb)(t,n).then((()=>{if(!t.isGroup())return;const r=(0,s.genGroupPicChangeNotificationMsg)(e.jid,n,e.ts,e.author||(0,a.getMeUser)());return(0,l.handleSingleMsgMD)(e.jid,r)}));break;case"request":break;default:__LOG__(3)`Invalid type received`}}return r.then((()=>(0,n.wap)("ack",{id:(0,n.CUSTOM_STRING)(e.stanzaId),to:(0,u.JID)(e.from),class:"notification",type:"picture"})))}};var n=r(31914),i=r(71914),a=r(99234),s=r(37654),o=r(85553),l=r(5819),c=r(46328),d=r(37638),u=r(39410);const p=new i.WapParser("incomingProfilePicNotificationParser",(e=>{let t,r;if(e.assertTag("notification"),e.hasChild("delete"))t="delete",r=e.child("delete");else if(e.hasChild("set"))t="set",r=e.child("set");else{if(!e.hasChild("request"))return e.throw("Expected child type to be one of: set, delete, request");t="request",r=e.child("request"),r.assertAttr("jid",(0,a.assertGetMe)().toJid())}const n=e.attrString("id");return r.hasAttr("jid")?{type:t,from:(0,o.chatJidToChatWid)(e.attrChatJid("from")),jid:(0,o.chatJidToChatWid)(r.attrChatJid("jid")),author:r.hasAttr("author")?(0,o.userJidToUserWid)(r.attrUserJid("author")):null,ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:n,picId:"set"===t?r.attrInt("id",1):0}:{from:(0,o.userJidToUserWid)(e.attrUserJid("from")),jid:null,type:t,hash:r.attrString("hash"),stanzaId:n}}))},54341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(86945),l=r(11365),c=n(r(69618)),d=r(49714),u=r(85553),p=r(45033),h=r(53348),f=n(r(40256)),_=r(39410),m=r(58021);const g=r(54302)({Image:"image",Video:"video",Text:"text"}),y=new s.WapParser("incomingCampaignParser",(e=>{e.assertTag("notification"),e.assertAttr("from",c.default.STATUS_WID);const t=e.attrString("id"),r=(0,u.userJidToUserWid)(e.attrUserJid("participant")),n=e.attrTime("t"),i=e.child("campaign"),a=i.hasChild("revoke"),s=i.attrString("id"),o=i.maybeAttrInt("duration"),d=i.mapChildrenWithTag("message",(e=>{const t=e.child("media");t.attrEnumValues("mediatype",g.members());return{id:e.attrString("id"),ts:n,body:(0,l.uint8ArrayToBuffer)(t.contentBytes())}}));return{participant:r,stanzaId:t,campaignId:s,campaignDuration:o,revoke:a,ts:n,messages:d}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{participant:r,campaignId:n,campaignDuration:i}=e,{id:a,ts:s,body:o}=t,l={type:d.MESSAGE_TYPE.OTHER_STATUS,externalId:a,ts:s,edit:-1,isHsm:!1,count:null,chat:(0,m.createWid)(c.default.STATUS_WID),author:r,pushname:null,isDirect:!1,campaignId:n,campaignDuration:i},u={retryCount:0,e2eType:p.CiphertextType.Msg,mediaType:p.MediaType.Photo,hideFail:!1};yield(0,h.processDecryptedProto)(o,l,null,u,{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null},!1)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=y.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:r}=t,n=(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(r.stanzaId),participant:(0,_.USER_JID)(r.participant),class:"notification",type:"psa",to:(0,_.JID)((0,m.createWid)(c.default.STATUS_WID))});return(0,o.getABPropConfigValue)("web_status_psa")?(r.revoke?yield(0,f.default)(r.campaignId):yield Promise.all(r.messages.map((e=>E(r,e)))),n):n}))).apply(this,arguments)}},79711:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleMessageRetryRequest=function(e){const t=f.default.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(new Error(t.error));{const e=t.success,{from:r,participant:n,recipient:s,retryCount:o,stanzaId:l}=e;if(null==l)return __LOG__(3)`Received null stanzaID when handling message retry request`,Promise.reject(new Error("Received null stanzaID when handling message retry request"));const c=(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(l),to:(0,g.JID)(r),participant:n?(0,g.DEVICE_JID)(n):a.DROP_ATTR,class:"receipt",type:"retry"}),u=T(r,s);return u?(0,d.handleMessage)(String(u),!1,(0,i.default)((function*(){const t=yield S(e);if(null==t)return c;const{originalMsgId:i,chat:a,requester:l,identityRowId:d}=t;try{const e=yield(0,h.getMsgIfAuthorized)(i,a,l,o,d);if(!e)return __LOG__(3)`handleMessageRetryRequest msg retry not authorized`,c;yield(0,_.sendRetry)(r,n,s,e,o)}catch(e){__LOG__(3)`handleMessageRetryRequest error: ${e}`}return c}))):Promise.resolve(c)}},t.handleVoipRetryRequest=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=n(r(69618)),o=r(9108),l=r(99234),c=r(97398),d=r(15746),u=n(r(11339)),p=n(r(76128)),h=r(28870),f=n(r(87423)),_=r(95547),m=r(93832),g=r(39410),y=r(58021);function E(){return(E=(0,i.default)((function*(e){return null!=(yield S(e))}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{originalMsgId:t,from:r,participant:n,recipient:i,retryCount:a,offline:l}=e;if(a>=s.default.RETRY.MAX_RETRY)return void __LOG__(2)`handleRetryRequest refusing retry attempt #${a}`;const d=T(r,i);if(!d)return void __LOG__(3)`handleRetryRequest: no chat found for incoming retry request.`;const f=d.isUser()?r:n;if(!f)return void __LOG__(3)`handleRetryRequest: no requester found for incoming retry request.`;const _=f.device||0;try{if(!(yield(0,o.hasDevice)(f,_)))return __LOG__(3)`handleRetryRequest: no device ${_} found for ${f.user} for incoming retry request .`,void new u.default.MdRetryFromUnknownDevice({offline:l,senderType:_===s.default.DEVICE.PRIMARY_DEVICE?u.default.DEVICE_TYPE.PRIMARY:u.default.DEVICE_TYPE.COMPANION}).commit();yield(0,h.updateLocalSession)(d,e),yield(0,c.ensureE2ESessions)([f]);return{originalMsgId:t,chat:d,requester:f,identityRowId:yield p.default.getIdentityRowId((0,m.createSignalAddress)(f).toString())}}catch(e){__LOG__(3)`handleRetryRequest error: ${e}`}}))).apply(this,arguments)}function T(e,t){return e.isUser()?(0,y.toUserWid)(e).equals((0,l.getMeUser)())?t||(__LOG__(3)`getActualChatId: from is a peer device, but without recipient`,null):(0,y.toUserWid)(e):e}},28870:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgIfAuthorized=function(){return g.apply(this,arguments)},t.processKeyBundle=y,t.updateLocalSession=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=n(r(69618)),o=r(99234),l=r(90981),c=r(47124),d=n(r(11339)),u=r(17304),p=n(r(32219)),h=r(43201),f=r(77605),_=r(12896),m=r(58021);function g(){return(g=(0,a.default)((function*(e,t,r,n,i){const a=new p.default({id:e,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,o.getMeUser)()}),h=yield(0,l.getTable)().get(String(a));if(!h)return __LOG__(3)`getMsgIfAuthorized: can not find msg ${a.toString()}.`,null;const f=h.type===s.default.MSG_TYPE.REVOKED?h.protocolMessageRowId:h.rowId;if(null==f)return __LOG__(3)`getMsgIfAuthorized: msg missing rowId ${a.toString()}.`,null;const m=yield(0,c.isRetryEligible)(a,r,i,f);__LOG__(2,void 0,void 0,void 0,["messaging"])`getMsgIfAuthorized: ${e}, ${String(r)} retry eligibility ${m}`;const g=new u.Msg((0,_.hydrateMessage)(h));yield g.waitForPrep();let y=!1;switch(g.type===s.default.MSG_TYPE.REVOKED&&(y=!0,g.type="protocol",g.subtype="admin"===g.subtype?"admin_revoke":"sender_revoke"),m){case c.RetryEligibilityResult.ELIGIBLE:return g;case c.RetryEligibilityResult.INELIGIBLE_ALREADY_DELIVERED:new d.default.E2eRetryAfterDelivery({deviceType:r.isCompanion()?d.default.DEVICE_TYPE.COMPANION:d.default.DEVICE_TYPE.PRIMARY,messageType:g.getWamMessageType(),msgRetryCount:n,retryRevoke:y}).commit()}return null}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,r,n,a){return null!=r&&e&&e.key?a?null==n?(__LOG__(2)`processKeyBundle: missing session for retry`,yield f.Session.deleteRemoteInfo(t),!1):n!==r?(__LOG__(2)`processKeyBundle: delete session because reg does not match, saved: ${n}, received: ${r}`,yield f.Session.deleteRemoteInfo(t),!1):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield f.Session.createSignalSession((0,i.default)({wid:t,regId:r},e)),!0):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield f.Session.createSignalSession((0,i.default)({wid:t,regId:r},e)),!0):(__LOG__(2)`processKeyBundle: skip due to missing key bundle`,!1)}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t){const{from:n,keyBundle:i,offline:a,originalMsgId:l,participant:c,regId:d,retryCount:u}=t,p=c||n;if(__LOG__(2)`updateLocalSession: retryCount: ${u}, offline: ${a.toString()}, has keyBundle: ${(!!i).toString()}`,e.isGroup()){const t=r(69951).ChatCollection.get(e);t&&p&&(0,h.markForgetSenderKey)(t.id,[p])}const _=yield f.Session.getRemoteRegId(p);if((0,m.toUserWid)(p).equals((0,o.getMeUser)())&&_!==d)throw new Error(`updateLocalSession: detect registration Id change remote: ${d}, local: ${_} for peer device`);if((yield y(i,p,d,_,a))||null!=_&&_!==d&&(__LOG__(2)`updateLocalSession: delete session because reg does not match, saved: ${_}, received: ${_}`,yield f.Session.deleteRemoteInfo(p)),u===s.default.RETRY.VALIDATE_OLD_SESSION)return f.Session.saveSessionBaseKey(p,l);if(u>s.default.RETRY.VALIDATE_OLD_SESSION){if(yield f.Session.hasSameBaseKey(p,l))return __LOG__(2)`updateLocalSession: delete local session due to same base key`,f.Session.deleteRemoteInfo(p)}}))).apply(this,arguments)}},87423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(71914),i=r(99234),a=r(85553);var s=new n.WapParser("retryRequestParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","retry"),e.hasAttr("to")&&e.assertAttr("to",(0,i.assertGetMe)().toJid());const t=(0,a.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.hasAttr("participant")?(0,a.deviceJidToDeviceWid)(e.attrDeviceJid("participant")):null,n=e.hasAttr("recipient")?(0,a.deviceJidToUserWid)(e.attrDeviceJid("recipient")):null,s=e.child("retry"),o=e.maybeChild("keys");let l=null;if(null!=o){var c;const e=o.child("skey"),t=o.child("key");l={identity:o.child("identity").contentBytes(32),deviceIdentity:null===(c=o.maybeChild("device-identity"))||void 0===c?void 0:c.contentBytes(),skey:{id:e.child("id").contentUint(3),pubkey:e.child("value").contentBytes(32),signature:e.child("signature").contentBytes(64)},key:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32)}}}return{stanzaId:e.attrString("id"),originalMsgId:s.attrString("id"),ts:e.attrTime("t"),retryCount:s.hasAttr("count")?s.attrInt("count"):0,regId:e.child("registration").contentUint(4),offline:e.hasAttr("offline"),from:t,participant:r,recipient:n,keyBundle:l}}));t.default=s},56545:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleServerNotification=function(e){const t=d.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){const t=(0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server",to:(0,i.CUSTOM_STRING)(e.from)});switch(e.type){case c.LOG:return o.upload({reason:"Server request",immediate:!0,force:!0,skipSampling:!1}),Promise.resolve(t);case c.PROPS:return(0,l.queryServerProps)().then((()=>t));case c.ABPROPS:return(0,s.syncABProps)(!1).then((()=>t));default:return __LOG__(3)`Unsupported notification with type "server",
blindly ack-ing it and doing nothing`,Promise.resolve(t)}}(t.success)};var i=r(31914),a=r(71914),s=r(89981),o=n(r(85965)),l=r(47569);const c=Object.freeze({LOG:"log",PROPS:"props",ABPROPS:"abprops"});t.NOTIFICATION_TYPE=c;const d=new a.WapParser("incomingServerNotificationParser",(e=>{e.assertTag("notification");const t=e.attrString("id"),r=e.attrString("from");return e.hasChild(c.LOG)?{type:c.LOG,stanzaId:t,from:r}:e.hasChild(c.PROPS)?{type:c.PROPS,stanzaId:t,from:r}:e.hasChild(c.ABPROPS)?{type:c.ABPROPS,stanzaId:t,from:r}:{type:null,stanzaId:t,from:r}}))},25773:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleServerSyncNotification=function(e){const t=d.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){if(e.changedCollections){const t=new Map;for(const[r,n]of e.changedCollections){const e=s.CollectionName.cast(r);null!=e?t.set(e,n):__LOG__(3)`syncd: unknown collection name in notification: ${r}`}const r=[...t.keys()];e.offline&&r.forEach((e=>{const t=c.get(e);null!=t?c.set(e,t+1):c.set(e,1)})),__LOG__(2)`syncd: incoming sync notification for collections
${[...t.entries()].map((e=>{let[t,r]=e;return`${t} v${r}`})).join("\n")}`,(0,l.markCollectionsForSync)(r,t)}return Promise.resolve((0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server_sync",to:i.S_WHATSAPP_NET}))}(t.success)},t.reportOfflineNotifications=function(){if(c.size<1)return;let e=0;[...c.entries()].forEach((t=>{let[,r]=t;e+=r-1})),new o.default.MdAppStateOfflineNotifications({redundantCount:e}).commit(),c.clear()};var i=r(31914),a=r(71914),s=r(45606),o=n(r(11339)),l=r(38804);const c=new Map,d=new a.WapParser("serverSyncNotification",(e=>{if(e.assertTag("notification"),!e.hasChild("collection"))throw new Error("Server sync notifcation does not contain any collections");const t=e.attrString("id"),r=new Map(e.mapChildrenWithTag("collection",(e=>[e.attrString("name"),e.attrInt("version")]))),n=e.hasAttr("offline");return e.attrString("from")!==i.S_WHATSAPP_NET.toString()&&__LOG__(4,void 0,new Error)`handleServerSyncNotification: "from" is not domain jid "s.whatsapp.net"`,{changedCollections:r,stanzaId:t,offline:n}}))},87183:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(71914),s=r(88102),o=r(24747),l=r(17186),c=r(91214),d=r(65044);const u=new a.WapParser("streamErrorParser",(e=>{if(e.assertTag("stream:error"),!e.hasChild("conflict"))return e.hasAttr("code")?{type:"code",code:e.attrInt("code")}:e.hasChild("ack")?{type:"ack",id:e.child("ack").hasAttr("id")?e.child("ack").attrString("id"):null}:(__LOG__(3)`Unrecognized stream:error: ${e.toString()}`,{type:"other"});switch(e.child("conflict").attrString("type")){case"replaced":return{type:"replaced"};case"device_removed":default:return{type:"device_removed"}}}));function p(){return(p=(0,i.default)((function*(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);{const e=t.success;if("code"===e.type&&e.code>=500&&e.code<600){if(515===e.code)return(0,l.startLogin)(),Promise.resolve("NO_ACK");if(516===e.code)return(0,c.commitDeviceLinkEvent)(516),(0,l.startLogout)(),Promise.resolve("NO_ACK");(0,o.onStreamErrorReceived)()}else{if("device_removed"===e.type)return(0,o.stopComms)(!0),yield d.Socket.clearCredentialsAndStoredData(),__LOG__(2)`stream error due to device removed, logging out`,s.Cmd.logout(),Promise.resolve("NO_ACK");if("replaced"===e.type)return(0,o.stopComms)(),Promise.resolve("NO_ACK")}return Promise.resolve("CLOSE_SOCKET")}}))).apply(this,arguments)}},95681:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=f.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`handleSuccess: failed to parse ${t.error}`,Promise.reject(t.error);const r=t.success;(function(e){const t=Date.now()/1e3,r=Math.round(t-e),n=Math.round(r/3600);0!==n&&(0,s.getABPropConfigValue)("log_clock_skew")&&new u.default.ClockSkewDifferenceT({clockSkewHourly:-1*n}).commit();(0,i.setClockSkew)(r),o.Clock.setSkew(r)})(r.ts),l.Cmd.onTemporaryBan({banned:!1});const n=r.companionEncStatic;if(c.DbEncKeyStore.generateFinalDbEncryptionAndFtsKey(n),(0,d.generateFinalDbEncryptionAndFtsKeyForInvoker)(n),null==h.ServerProps.serverPropsVersion||h.ServerProps.serverPropsVersion<r.propsVersion)return(0,p.queryServerProps)()};var i=r(92844),a=r(71914),s=r(86945),o=r(22683),l=r(88102),c=r(15998),d=r(10786),u=n(r(11339)),p=r(47569),h=r(64551);const f=new a.WapParser("successParser",(e=>(e.assertTag("success"),{ts:e.attrTime("t"),propsVersion:e.attrInt("props"),companionEncStatic:e.maybeAttrString("companion_enc_static")||"NULL"})))},2634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=g.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{callCreator:r,from:n,message:a,payloadTag:s,stanzaId:o}=t.success,d=(0,_.wapNodeToVoipXml)(e),m={elapsed_msec:a.elapsed_msec,epoch_msec:a.epoch_msec,is_offline:a.is_offline,payload:d[2][0],peer_app_version:a.peer_app_version,peer_platform:a.peer_platform,peer_jid:a.peer_jid?a.peer_jid.toString({legacy:!0}):void 0},E=a.call_id;switch(a.type){case f.TYPE.OFFER:return y(n,o,E,r,a.type),(0,p.getDoNotDisturb)()&&!u.default.isFocused?__LOG__(2)`handleCall: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`:(0,c.handleIncomingCallOffer)(a,m),Promise.resolve("NO_ACK");case f.TYPE.ENC_REKEY:return(0,c.handleIncomingEncRekey)(a,m).then((e=>{let{shouldRetry:t,retryCount:i}=e;t?(0,h.default)(o,a,i):y(n,o,E,r,f.TYPE.ENC_REKEY)})),Promise.resolve("NO_ACK");case f.TYPE.ACCEPT:case f.TYPE.REJECT:return y(n,o,E,r,a.type),(0,c.handleIncomingSignalingMsg)(a,m),Promise.resolve("NO_ACK");case f.TYPE.OFFER_NOTICE:return(0,l.default)(e);default:return(0,c.handleIncomingSignalingMsg)(a,m),Promise.resolve(function(e,t,r){return(0,i.wap)("ack",{to:(0,_.JID)(e),id:(0,i.CUSTOM_STRING)(t),class:"call",type:(0,i.MAYBE_CUSTOM_STRING)(r)})}(n,o,s))}};var i=r(31914),a=r(71914),s=r(24747),o=(n(r(69618)),r(99234)),l=n(r(66337)),c=r(76046),d=r(85553),u=n(r(96489)),p=r(17506),h=n(r(64254)),f=r(45473),_=r(39410);function m(e){return f.TYPE[e.tag().toUpperCase()]||f.TYPE.NONE}const g=new a.WapParser("callParser",(e=>{e.assertTag("call");const t=(0,d.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.mapFirstChild((e=>e));if(r){const n=r.attrString("call-id"),i=(0,d.jidWithTypeToWid)(r.attrJidWithType("call-creator")),a={call_id:n,call_creator:i,peer_jid:t,peer_platform:e.hasAttr("platform")?e.attrString("platform"):void 0,peer_app_version:e.hasAttr("version")?e.attrString("version"):void 0,epoch_msec:e.hasAttr("t")?String(1e3*e.attrInt("t")):void 0,elapsed_msec:e.hasAttr("e")?String(1e3*e.attrInt("e")):void 0,type:m(r),common:{call_id:n,peer_jid:t.toString(),type:String(m(r))},isVideoCall:r.hasChild("video"),t:e.attrTime("t")};return{from:(0,d.jidWithTypeToWid)(e.attrJidWithType("from")),stanzaId:e.attrString("id"),payloadTag:r.tag(),message:a,callCreator:i}}throw new Error("Unrecognized call stanza")}));function y(e,t,r,n,a){let l;switch(a){case f.TYPE.OFFER:l=(0,i.wap)("offer",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,_.JID)(n)});break;case f.TYPE.ENC_REKEY:l=(0,i.wap)("enc_rekey",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,_.JID)(n)});break;case f.TYPE.ACCEPT:l=(0,i.wap)("accept",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,_.JID)(n)});break;case f.TYPE.REJECT:l=(0,i.wap)("reject",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,_.JID)(n)})}(0,s.castStanza)((0,i.wap)("receipt",{to:(0,_.JID)(e),id:(0,i.CUSTOM_STRING)(t),from:(0,_.JID)((0,o.getMaybeMeUser)())},l))}},71419:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=n(r(45095)),s=r(31914),o=r(71914),l=r(79711),c=r(85553),d=r(84356),u=r(39410);const p=new o.WapParser("rekeyRetryReceiptParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","enc_rekey_retry");const t=e.child("enc_rekey");return{from:(0,c.jidWithTypeToWid)(e.attrJidWithType("from")),originalMsgId:t.attrString("call-id"),stanzaId:e.attrString("id"),retryCount:t.hasAttr("count")?t.attrInt("count"):0,regId:e.child("registration").contentUint(4),ts:null,participant:null,recipient:null,keyBundle:null,offline:!1}}));function h(){return(h=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve();const r=t.success,n=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)((0,a.default)(r.stanzaId,"retryInfo.stanzaId")),to:(0,u.JID)(r.from),class:"receipt",type:"enc_rekey_retry"});try{return(yield(0,l.handleVoipRetryRequest)(r))?d.Voip.resendEncRekeyRetry(r.from.toString({legacy:!0,formatFull:!0}),r.retryCount):(__LOG__(3)`voip:handle_enc_rekey_retry_receipt: not sending enc_rekey retry`,d.Voip.endCall(r.originalMsgId)),n}catch(e){return __LOG__(3)`voip:handle_enc_rekey_retry_receipt: error while attempting to send enc_rekey retry`,n}}))).apply(this,arguments)}},66337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=c.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{stanzaId:r,fromWid:n,callCreator:a,callId:o,isGroup:d,isVideo:u,t:p}=t.success;return(0,s.default)(a,o,p,u,d),Promise.resolve((0,i.wap)("ack",{to:(0,l.JID)(n),id:(0,i.CUSTOM_STRING)(r),class:"call",type:(0,i.CUSTOM_STRING)("offer_notice")}))};var i=r(31914),a=r(71914),s=n(r(42285)),o=r(85553),l=r(39410);const c=new a.WapParser("callOfferNoticeParser",(e=>{e.assertTag("call");const t=e.attrString("id"),r=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),n=e.child("offer_notice");return{stanzaId:t,fromWid:r,callCreator:(0,o.deviceJidToDeviceWid)(n.attrDeviceJid("call-creator")),callId:n.attrString("call-id"),isGroup:"group"===n.attrString("type"),isVideo:"video"===n.attrString("media"),t:e.attrTime("t")}}))},89370:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"handleCall",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"handleEncRekeyRetryRequest",{enumerable:!0,get:function(){return a.default}});var i=n(r(2634)),a=n(r(71419))},51836:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractCertificateDetailsParams=function(e){return{serial:e.serial,name:e.verifiedName,isApi:"ent:wa"===e.issuer}},t.getParsedProtoObjects=function(e){if(!e)return null;const t=(0,n.decodeProtobuf)(i.VerifiedNameCertificateSpec,e);if(!t.details)throw new Error("verifyCertificate cert missing details");if(!t.signature)throw new Error("verifyCertificate cert missing signature");const r=(0,n.decodeProtobuf)(i.DetailsSpec,t.details);return{cert:t,details:r}};var n=r(84902),i=r(91344)},45033:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=t.CiphertextType=void 0;const n=r(54302)({Skmsg:"skmsg",Pkmsg:"pkmsg",Msg:"msg"});t.CiphertextType=n;const i=r(54302)({Photo:"photo",Video:"video",Audio:"audio",Ptt:"ptt",Location:"location",Contact:"contact",Document:"document",Url:"url",Call:"call",Gif:"gif",Future:"future",ContactArray:"contact_array",LiveLocation:"live_location",ProfilePic:"profile_pic",Sticker:"sticker",Hsm:"hsm",ProductImage:"product_image",Template:"template",MdAppState:"md_app_state",MdHistorySync:"md_history_sync",List:"list",ListResponse:"list_response",Button:"button",ButtonResponse:"button_response",Order:"order",Product:"product"});t.MediaType=i},68819:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getJobManager=function(){if(null==d)throw new Error("jobs manager has not been initialized");return d},t.maybeCreateJob=h,t.startWebPersistedJobManager=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(87614),s=r(47901),o=r(92844),l=r(16703),c=n(r(56816));let d=null;function u(){return(u=(0,i.default)((function*(){yield(0,l.initialize)();const e=(0,l.getJobsTable)();d=new s.PersistedJobManager({accessors:p(),unfinishedJobEntries:e.all(),isRestartAfterCrash:!1,listeners:{onJobStarted:()=>{},onJobFinished:()=>null},deprecatedJobs:[]}),(0,c.default)(d)}))).apply(this,arguments)}function p(){return{deletePersistedJob:e=>(0,l.getJobsTable)().remove(e),updatePersistedJob:e=>(0,l.getJobsTable)().createOrReplace(e),readPersistedJob:e=>(0,l.getJobsTable)().get(e),maybeCreateJob:h}}function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){var t,r;const n=(0,l.getJobsTable)(),i=JSON.stringify([e.type,null!==(t=e.uniqKey)&&void 0!==t?t:(0,a.randomHex)(32)]),c={type:e.type,uniqKey:i,startTime:(0,o.unixTime)(),version:null!==(r=e.version)&&void 0!==r?r:1,original:e.args,current:e.args,step:s.UNSTARTED_JOB,waitUntil:null,stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,backedOffCount:0};if(null==e.uniqKey)return n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const d=yield n.equals(["uniqKey"],[e.uniqKey]);if(0===d.length)return n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const u=[];let p=null;for(const e of d)e.step!==s.FINISHED_JOB?p=e:u.push(n.remove(e.jobId));return yield Promise.all(u),null!=p?{id:p.jobId,newlyCreated:!1}:n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})))}))).apply(this,arguments)}},97398:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ensureE2ESessions=m,t.ensureE2ESessionsWithDelay=function(e,t){const r=new s.ShiftTimer((()=>{m(e)}));e.forEach((e=>{f.set(String(e),r)})),r.onOrAfter(1e3*t)};var i=n(r(48926)),a=r(27870),s=r(57319),o=r(31914),l=r(71914),c=r(24747),d=n(r(69618)),u=r(85553),p=r(77605),h=r(39410);const f=new Map,_=new a.PromiseQueueMap;function m(e){const t=e.map((e=>e.toString())).join();e.forEach((e=>{const t=f.get(e.toString());t&&(t.cancel(),f.delete(e.toString()))})),__LOG__(2)`ensureE2ESession ${t}`;const r=_.waitIfPending(t);if(r)return __LOG__(2)`ensureE2ESession deduped ${t}`,r;const n=p.Session.hasSignalSessions(e).then(function(){var t=(0,i.default)((function*(t){const r=e.filter(((e,r)=>!t[r]));if(r.length>0){const{depletedPrekeyCount:e}=yield function(){return y.apply(this,arguments)}(r);return{missedPrekeyCount:r.length,depletedPrekeyCount:e}}return{missedPrekeyCount:0,depletedPrekeyCount:0}}));return function(){return t.apply(this,arguments)}}());return _.enqueueHandlers(t,n)}const g=new l.WapParser("e2eSessionParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");throw new Error(`establishE2ESessionParser bad response: ${r} ${n}`)}{const t=e.child("skey"),r=e.hasChild("key")?e.child("key"):null,n=e.hasChild("device-identity")?e.child("device-identity").contentBytes():null;return{wid:(0,u.deviceJidToDeviceWid)(e.attrDeviceJid("jid")),regId:e.child("registration").contentUint(4),identity:e.child("identity").contentBytes(32),deviceIdentity:n,skey:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32),signature:t.child("signature").contentBytes(64)},key:r&&{id:r.child("id").contentUint(3),pubkey:r.child("value").contentBytes(32)}}}}))));function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=e.map((e=>(0,o.wap)("user",{jid:(0,h.DEVICE_JID)(e),reason:t?"identity":o.DROP_ATTR}))),n=(0,o.wap)("iq",{id:(0,o.generateId)(),xmlns:"encrypt",type:"get",to:o.S_WHATSAPP_NET},(0,o.wap)("key",null,r)),i=yield(0,c.sendIq)(n,g);if(!i.success)throw new Error(`establishE2ESession bad response ${String(i)}`);const a=i.result;if(!a||a.length<=0)throw new Error("establishE2ESession: empty keyInfo");const s=[],l=[];let u=0;a.forEach((e=>{null!=e.wid.device&&e.wid.device!==d.default.DEVICE.PRIMARY_DEVICE?l.push(e):s.push(e),e.key||u++}));const f=e=>p.Session.createSignalSession(e).catch((t=>{__LOG__(4,void 0,new Error,!0)`createSignalSession: failed for device ${e.wid} with error ${t}`,SEND_LOGS("createSignalSession-fail")}));return yield Promise.all(s.map((e=>f(e)))),yield Promise.all(l.map((e=>f(e)))),__LOG__(2)`establishE2ESession: successfully established E2E sessions`,{depletedPrekeyCount:u}}))).apply(this,arguments)}},63442:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMerchantCompliance=function(){return h.apply(this,arguments)},t.setMerchantCompliance=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),s=r(31914),o=r(71914),l=r(24747),c=r(39410),d=r(77591);const u=e=>{var t,r,n;return{email:(null==e||null===(t=e.maybeChild("email"))||void 0===t?void 0:t.contentString())||"",landline_number:(null==e||null===(r=e.maybeChild("landline_number"))||void 0===r?void 0:r.contentString())||"",mobile_number:(null==e||null===(n=e.maybeChild("mobile_number"))||void 0===n?void 0:n.contentString())||""}},p=new o.WapParser("merchantComplianceResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.forEachChildWithTag("merchant_info",(e=>{var r,n,i,s;const o=(null===(r=e.maybeChild("entity_name"))||void 0===r?void 0:r.contentString())||"",l=(null===(n=e.maybeChild("entity_type"))||void 0===n?void 0:n.contentString())||"",c=null===(i=e.maybeChild("entity_type_custom"))||void 0===i?void 0:i.contentString(),d="true"===e.attrString("is_registered"),p=e.maybeChild("customer_care_details"),h=e.maybeChild("grievance_officer_details"),f=(0,a.default)({},u(p)),_=(0,a.default)({name:(null==h||null===(s=h.maybeChild("name"))||void 0===s?void 0:s.contentString())||""},u(h));t.push({entity_name:o,entity_type:l,is_registered:d,entity_type_custom:c,customer_care_details:f,grievance_officer_details:_})})),t}));function h(){return(h=(0,i.default)((function*(e){const t=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,s.generateId)(),type:"get",smax_id:"53"},e.map((e=>(0,s.wap)("merchant_info",{jid:(0,c.USER_JID)(e.wid)})))),r=yield(0,l.sendIq)(t,p);if(r.success)return r.result;throw new d.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){let{entityName:e,entityType:t,isRegistered:r,entityTypeCustom:n,customerCareDetails:i,grievanceOfficerDetails:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,s.generateId)(),type:"set",smax_id:"54"},(0,s.wap)("merchant_info",{is_registered:r?"true":"false"},void 0!==e?(0,s.wap)("entity_name",null,e):null,void 0!==t?(0,s.wap)("entity_type",null,t):null,void 0!==n?(0,s.wap)("entity_type_custom",null,n):null,i?(0,s.wap)("customer_care_details",null,void 0!==i.email?(0,s.wap)("email",null,i.email):null,void 0!==i.landlineNumber?(0,s.wap)("landline_number",null,i.landlineNumber):null,void 0!==i.mobileNumber?(0,s.wap)("mobile_number",null,i.mobileNumber):null):null,a?(0,s.wap)("grievance_officer_details",null,void 0!==a.name?(0,s.wap)("name",null,a.name):null,void 0!==a.email?(0,s.wap)("email",null,a.email):null,void 0!==a.landlineNumber?(0,s.wap)("landline_number",null,a.landlineNumber):null,void 0!==a.mobileNumber?(0,s.wap)("mobile_number",null,a.mobileNumber):null):null)),c=yield(0,l.sendIq)(o,p);if(c.success)return c.result;throw new d.ServerStatusCodeError(c.errorCode)}))).apply(this,arguments)}},63728:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addPlaceHolderAction=function(e){const t=new a.default.PlaceholderActivity({placeholderActionInd:a.default.PLACEHOLDER_ACTION.ADD,placeholderChatTypeInd:s.default.isGroup(e.from)||s.default.isGroup(e.to)?a.default.PLACEHOLDER_CHAT_TYPE.GROUP:a.default.PLACEHOLDER_CHAT_TYPE.INDIVIDUAL,placeholderTimePeriod:Math.max((0,i.unixTime)()-e.t,0),placeholderTypeInd:"fanout"===e.subtype?a.default.PLACEHOLDER_TYPE.FANOUT:a.default.PLACEHOLDER_TYPE.CIPHERTEXT});l(e,t),t.commit()},t.populatePlaceHolderAction=function(e){const t=new a.default.PlaceholderActivity({placeholderActionInd:a.default.PLACEHOLDER_ACTION.POPULATE,placeholderChatTypeInd:s.default.isGroup(e.from)||s.default.isGroup(e.to)?a.default.PLACEHOLDER_CHAT_TYPE.GROUP:a.default.PLACEHOLDER_CHAT_TYPE.INDIVIDUAL,placeholderTimePeriod:Math.max((0,i.unixTime)()-e.t,0),placeholderTypeInd:"fanout"===e.subtype?a.default.PLACEHOLDER_TYPE.FANOUT:a.default.PLACEHOLDER_TYPE.CIPHERTEXT});l(e,t),t.commit()},t.viewPlaceHolderAction=function(e){const t=new a.default.PlaceholderActivity({placeholderActionInd:a.default.PLACEHOLDER_ACTION.VIEW,placeholderChatTypeInd:s.default.isGroup(e.from)||s.default.isGroup(e.to)?a.default.PLACEHOLDER_CHAT_TYPE.GROUP:a.default.PLACEHOLDER_CHAT_TYPE.INDIVIDUAL,placeholderTimePeriod:Math.max((0,i.unixTime)()-e.t,0),placeholderTypeInd:"fanout"===e.subtype?a.default.PLACEHOLDER_TYPE.FANOUT:a.default.PLACEHOLDER_TYPE.CIPHERTEXT});l(e,t),t.commit()};var i=r(92844),a=n(r(11339)),s=n(r(39546)),o=r(58021);function l(e,t){let n;if(s.default.isGroup(e.from)?n=e.from instanceof s.default?e.from:(0,o.createWidFromWidLike)(e.from):s.default.isGroup(e.to)&&(n=e.to),null!=n&&n.isGroup()){var i;const e=null===(i=r(63928).default.get(n))||void 0===i?void 0:i.cachedDeviceSizeBucket;null!=e&&(t.deviceSizeBucket=e)}}},24872:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllContactsFromChatCollectionIntoChunks=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;const t=[],r=[],n=new Set;let i=new Set;for(const a of s.ChatCollection.toArray())i.size===e&&(t.push(i),i=new Set),a.isBroadcast||(a.isGroup?r.push(a.id):n.has(a.id)||(i.add(a.id),n.add(a.id)));for(const l of r){var a,o;const r=s.ChatCollection.get(l)||{},c=null!==(a=null===(o=r.groupMetadata)||void 0===o?void 0:o.participants.toArray())&&void 0!==a?a:[];for(const r of c)i.size===e&&(t.push(i),i=new Set),n.has(r.id)||(i.add(r.id),n.add(r.id))}0!==i.size&&t.push(i);return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${t.length} chunks of contacts from chat collection, chunk size: ${e}`,t},t.getAndUpdateNonAddressBookContacts=function(){return m.apply(this,arguments)},t.getNonAddressBookContactsAndMarkAllContactsDirty=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(19797),s=r(69951),o=r(76214),l=r(99069),c=n(r(39546)),d=r(58021);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){const e=new Set;return yield(0,o.getParticipantTable)().forEach((t=>{t.participants.forEach((t=>{e.add((0,a.toUserJid)((0,d.createWid)(t).user))}))})),yield(0,o.getChatTable)().forEach((t=>{c.default.isUser(t.id)&&e.add((0,a.toUserJid)((0,d.createWid)(t.id).user))})),__LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${e.size} contacts from chat and group participant tables`,Array.from(e)}))).apply(this,arguments)}function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const t=yield e.anyOf(["isAddressBookContact"],[1,0]),r=new Set(t.map((e=>e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${r.size} contacts with set isAddressBookContact value from contact table`,r}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){const e=yield u();return(0,l.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield h(r),i=Array.from(e).map((e=>n.has(e)?{id:e,isContactSyncCompleted:0}:{id:e,isAddressBookContact:0,isContactSyncCompleted:0}));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${i.length} contacts dirty during the regular sync`,r.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){const e=yield u();return(0,l.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield h(r),i=e.filter((e=>!n.has(e))).map((e=>({id:e,isAddressBookContact:0,isContactSyncCompleted:0})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${i.length} non-address book contacts, mark dirty, and update the contact table during the inital sync`,r.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}},10058:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactListInChunksJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactListInChunks",(e=>(0,n.syncContactListInChunks)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldDelayBetweenChunks:t})},t.syncContactListJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactList",(e=>(0,n.syncContactList)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldSyncDevice:t})};var n=r(33192),i=r(1973),a=r(29731)},57062:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirtyJob=function(e){return(0,a.NonPersistJob)("markGroupAsDirty",(e=>(0,s.markGroupAsDirty)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e})},t.modifyGroupParticipantJob=function(e,t,r,i,o){return(0,a.NonPersistJob)("modifyGroupParticipant",(e=>(0,s.modifyGroupParticipant)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,oldId:t,newId:r,prevVersion:i,newVersion:o})},t.replaceParticipantsJob=function(e,t,r,i,o){return(0,a.NonPersistJob)("replaceParticipants",(e=>(0,s.replaceParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,admins:r,deviceIds:i,version:o})},t.updateGroupMetadataTableJob=function(e){return(0,a.NonPersistJob)("updateGroupMetadataTable",(e=>(0,i.updateGroupMetadataTable)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})},t.updateGroupParticipantTableWithoutDeviceSyncJob=function(e){return(0,a.NonPersistJob)("updateGroupParticipantTableWithoutDeviceSync",(e=>(0,s.updateGroupParticipantTableWithoutDeviceSync)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})};var n=r(1973),i=r(86791),a=r(29731),s=r(51727)},80474:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipantsJob=function(e,t,r,s,o){return(0,i.NonPersistJob)("addParticipants",(e=>(0,a.addParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:s,isOffline:o})},t.demoteParticipantsJob=function(e,t,r,s){return(0,i.NonPersistJob)("demoteParticipants",(e=>(0,a.demoteParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:s})},t.promoteParticipantsJob=function(e,t,r,s){return(0,i.NonPersistJob)("promoteParticipants",(e=>(0,a.promoteParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:s})},t.removeParticipantsJob=function(e,t,r,s){return(0,i.NonPersistJob)("removeParticipants",(e=>(0,a.removeParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:s})},t.updateParticipantsJob=function(e,t,r,s){return(0,i.NonPersistJob)("updateParticipants",(e=>(0,a.updateParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,isOffline:s})};var n=r(1973),i=r(29731),a=r(18615)},61051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupJob=function(e,t,r){return(0,s.NonPersistJob)("queryGroup",function(){var e=(0,i.default)((function*(e){const t=yield(0,l.queryGroup)(e);return t.id&&(yield Promise.all([(0,a.updateGroupMetadataTable)({groupInfos:[t]}),(0,o.updateParticipants)({group:t.id,participants:t.participants,version:t.pvId,isOffline:null})])),t}));return function(){return e.apply(this,arguments)}}()).waitUntilCompleted({groupWid:e,request:t,phash:r})};var i=n(r(48926)),a=r(86791),s=r(29731),o=r(18615),l=r(2182)},10823:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncDeviceListJob=function(e,t,r){return(0,a.NonPersistJob)("syncDeviceList",(e=>(0,n.syncDeviceList)(e))).waitUntilCompleted({wids:e,context:t,phash:r})},t.syncMyDeviceListJob=function(){return(0,a.NonPersistJob)("syncMyDeviceList",(()=>(0,n.syncMyDeviceList)()),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted()};var n=r(64114),i=r(1973),a=r(29731)},66101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.reportSyncdStatsJob=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(86945),s=r(1973),o=n(r(11339)),l=r(29731),c=r(35047);function d(){return(d=(0,i.default)((function*(){if(yield(0,a.getABPropConfigValue)("md_app_state_report_md_sync_mutation_stats"))return new l.NonPersistJob("reportSyncdStats",(0,i.default)((function*(){const e=yield(0,c.generateActionStatCounts)();for(const t of e.values())new o.default.MdAppStateSyncMutationStats({syncdAction:t.action,applied:(0,c.convertToBucket)(t.applied),invalid:(0,c.convertToBucket)(t.invalid),orphan:(0,c.convertToBucket)(t.orphan),unsupported:(0,c.convertToBucket)(t.unsupported),failed:(0,c.convertToBucket)(t.failed)}).commit()})),{priority:s.JOB_PRIORITY.LOW}).waitUntilCompleted()}))).apply(this,arguments)}},4454:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.requestAllSyncdMissingKeysJob=function(){return new l.NonPersistJob("requestAllSyncdMissingKeys",(0,i.default)((function*(){yield(0,o.requestAllMissingKeys)(),setTimeout(o._setMissingKeyTimeout,a.MINUTE_MILLISECONDS)})),{priority:s.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=n(r(48926)),a=r(92844),s=r(1973),o=r(84051),l=r(29731)},1973:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JOB_PRIORITY=void 0;const n=r(54302)({SKIP:"SKIP_PRIORITIZATION",UI_ACTION:"UI_ACTION",LOW:"LOW",HIGH:"HIGH"});t.JOB_PRIORITY=n},26681:(e,t,r)=>{"use strict";var n=r(95318);t.eE=void 0;var i=n(r(48926)),a=n(r(81109)),s=r(40265),o=r(38284),l=r(1973),c=r(15860);const d=l.JOB_PRIORITY.LOW;class u{constructor(){this._isInitialized=!1,this._tasks=[],this._pendingTasks=[]}init(e,t){var r;if(this._isInitialized)throw new Error("ConcurrentPreemptiveQueue has already initialized");this._maxThreadsCount=e.maxConcurrency,this._availableThreadsCount=e.maxConcurrency,this._jobMaxConcurrency=null!==(r=e.maxConcurrencyPerJob)&&void 0!==r?r:{},this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){if(!this._isInitialized)throw new Error("ConcurrentPreemptiveQueue not initialized");this._tasks=[],this._pendingTasks=[]}enqueue(e,t,r){var n=this;if(!this._isInitialized)return Promise.reject(new Error("ConcurrentPreemptiveQueue not initialized"));let o,u;const p=new Promise(((e,t)=>{o=e,u=t})),h=(0,a.default)({priority:d},r),f=(0,c.newTag)().substr(0,64),_=this._addJobTask(e,h,f,(0,i.default)((function*(){try{n._jobLogger.logJobStarted(f);const e=yield n._promiseTimeoutWrapper(t(),null==r?void 0:r.maxTimeoutMs);n._jobLogger.logJobCompleted(f),o(e)}catch(e){e instanceof s.TimeoutError?n._jobLogger.logJobTimeout(f):n._jobLogger.logJobError(f),u(e)}})));return r&&r.priority===l.JOB_PRIORITY.UI_ACTION&&this._runJobTask(_),this._runJobTasks(),p}_runJobTasks(){for(;this._availableThreadsCount>0;){const e=this._getNextJobTask();if(null==e)break;this._runJobTask(e)}}_promiseTimeoutWrapper(e,t){return void 0!==t?(0,o.promiseTimeout)(e,t):e}_runJobTask(e){var t=this;return(0,i.default)((function*(){t._availableThreadsCount--,t._markJobTaskPending(e);const{run:r,jobId:n,jobName:i}=e;try{var a;yield t._promiseTimeoutWrapper(r(),void 0===(null===(a=e.jobInfo)||void 0===a?void 0:a.maxTimeoutMs)?1e4:void 0)}catch(e){if(!(e instanceof s.TimeoutError))throw e;t._jobLogger.logJobTimeout(n),__LOG__(2)`[job-orchestator]: ${i} exceeding the timeout, release the thread.`}finally{t._availableThreadsCount++,t._markJobTaskDone(n),setTimeout((()=>t._runJobTasks()),0)}}))()}_addJobTask(e,t,r,n){const i={jobId:r,jobInfo:t,jobName:e,run:n};return this._jobLogger.logJobCreated({jobId:r,jobName:e,jobPriority:t.priority,pendingJobsCount:this._tasks.length}),this._tasks.push(i),i}_markJobTaskPending(e){this._pendingTasks.includes((t=>t.jobId===e.jobId))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskPending found jobId: ${e.jobId} in pending tasks`,SEND_LOGS("JobOrchestrator::markJobTaskPending")),this._pendingTasks.push(e),this._tasks=this._tasks.filter((t=>t.jobId!==e.jobId))}_markJobTaskDone(e){this._pendingTasks=this._pendingTasks.filter((t=>t.jobId!==e)),this._tasks.includes((t=>t.jobId===e))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskDone found jobId: ${e} in scheduled tasks`,SEND_LOGS("JobOrchestrator::markJobTaskDone"))}_getNextJobTask(){if(0===this._tasks.length)return null;const e=this._pendingTasks.reduce(((e,t)=>{var r;const n=null!==(r=e.get(t.jobName))&&void 0!==r?r:0;return e.set(t.jobName,n+1),e}),new Map);return this._tasks.filter((t=>{var r,n;return(null!==(r=e.get(t.jobName))&&void 0!==r?r:0)<(null!==(n=this._jobMaxConcurrency[t.jobName])&&void 0!==n?n:1)}))[0]}}const p=new u;t.eE=p},5215:(e,t,r)=>{"use strict";var n=r(95318);t.e=void 0;var i=n(r(48926)),a=r(1973),s=r(15860);const o=new class{constructor(){this._isInitialized=!1}init(e,t){if(this._isInitialized)throw new Error("DefaultNoQueue has already initialized");this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){}enqueue(e,t,r){var n=this;return(0,i.default)((function*(){var i;let o;const l=(0,s.newTag)().substr(0,64);n._jobLogger.logJobCreated({jobId:l,jobName:e,jobPriority:null!==(i=null==r?void 0:r.priority)&&void 0!==i?i:a.JOB_PRIORITY.LOW,pendingJobsCount:0});try{n._jobLogger.logJobStarted(l),o=yield t(),n._jobLogger.logJobCompleted(l)}catch(e){throw n._jobLogger.logJobError(l),e}return o}))()}};t.e=o},26558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobInfoEvent=void 0;r(1973),n(r(11339));t.JobInfoEvent=class{constructor(e,t,r,n){this.jobName=e,this.scenario=n,this.pendingJobsCount=r,this.jobPriority=t}logJobAdded(){this.webcJobAddedT=Date.now()}logJobStarted(){this.webcJobStartedT=Date.now()}logJobCompleted(e){this.webcJobCompletedT=Date.now(),this.jobResultType=e}}},69221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInstance=function(e){let t;if(e)t=r(5215).e;else{switch(function(){let e=o;e=i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(0,n.getABPropConfigValue)("web_orchestrator_enabled_version"):o;return e}()){case"preemptive":t=r(26681).eE;break;case"v2":case"v1":default:t=r(5215).e}}if(!t.isInitialized()){const e=function(){l||(l=new a.JobStatsLogger);return l}();t.init(s,e)}return t};var n=r(86945),i=(r(1973),r(7293)),a=r(95236);const s={maxConcurrency:1},o="default";let l},95236:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobStatsLogger=void 0;n(r(81109)),n(r(52991)),r(26558);var i=n(r(11339));t.JobStatsLogger=class{constructor(){this._jobEventMap=new Map}logJobCreated(e){}logJobStarted(e){}logJobCompleted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.COMPLETED)}logJobError(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ERROR)}logJobTimeout(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.TIMEOUT)}logJobAborted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ABORTED)}_logJobFinished(e,t){}_maybeCommitJobEvent(e){}}},29731:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NonPersistJob=function(e,t,r){if("function"!=typeof t)throw new Error("NonPersistJob got invalid function param");const a=(0,i.getInstance)((null==r?void 0:r.priority)===n.JOB_PRIORITY.SKIP);return{fireAndForget(){a.enqueue(e,(()=>t.apply(null,arguments)),r)},waitUntilCompleted(){return a.enqueue(e,(()=>t.apply(null,arguments)),r)}}};var n=r(1973),i=r(69221)},47587:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendPassiveIb=function(e){const t=(0,a.wap)("ib",null,(0,a.wap)("passive",{value:(0,a.CUSTOM_STRING)(String(e))}));(0,o.castStanza)(t)},t.sendPassiveIq=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747);const l=new s.WapParser("passiveIqParser",(e=>{e.assertAttr("type","result")}));function c(){return(c=(0,i.default)((function*(e){const t=e?(0,a.wap)("passive",null):(0,a.wap)("active",null),r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"passive",type:"set",id:(0,a.generateId)()},t),n=yield(0,o.sendIq)(r,l);if(!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`sendPassiveIq: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}__LOG__(2)`sendPassiveIq: passive mode set to ${String(e)}`}))).apply(this,arguments)}},56816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){!function(e,t){Object.keys(t).forEach((r=>{t.hasOwnProperty(r)&&e.addPersistedJobImplementation(r,t[r])}))}(e,{rotateKey:()=>r.e(5179).then(r.bind(r,95179)).then((e=>e.default)),setAbout:()=>r.e(2776).then(r.bind(r,62776)).then((e=>e.default)),queryProductList:()=>r.e(1505).then(r.bind(r,71505)).then((e=>e.QueryProductListCatalog)),getPublicKey:()=>r.e(8578).then(r.bind(r,58578)).then((e=>e.QueryGetPublicKey)),getSignedUserInfo:()=>r.e(6801).then(r.bind(r,6801)).then((e=>e.QueryGetSignedUserInfo))})}},6684:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobSerializers=void 0;const r={rotateKey:()=>({type:"rotateKey",args:{},uniqKey:"rotateKey"}),setAbout:e=>({type:"setAbout",args:{content:e},uniqKey:"setAbout"}),queryProductList(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return{type:"queryProductList",args:{catalogWid:e.toString(),productIds:t,width:n,height:i,directConnectionEncryptedInfo:r},uniqKey:`queryProductList:${t.slice().sort().join(",")}:${n}:${i}`}},getPublicKey:e=>({type:"getPublicKey",args:{businessJid:e.toString()},uniqKey:`getPublicKey:${e.toString()}`}),getSignedUserInfo:e=>({type:"getSignedUserInfo",args:{businessJid:e.toString()},uniqKey:`getSignedUserInfo:${e.toString()}`})};t.jobSerializers=r},93306:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProductMD=function(){return p.apply(this,arguments)},t.addProductResponse=void 0;var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(65508),c=r(90667),d=r(77591);const u=new s.WapParser("addProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_add").child("product");return(0,c.parseProductNode)(t)}));function p(){return(p=(0,i.default)((function*(e,t,r){const n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_add",{v:"1"},(0,c.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,r.toString()))),i=yield(0,o.sendIq)(n,u,l.parseErrorFields);if(i.success)return i.result;throw null!=i.customError?new d.CatalogEditServerError(i.errorCode,i.customError):new d.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}t.addProductResponse=u},27534:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealProductMD=function(){return d.apply(this,arguments)},t.appealProductResponse=void 0;var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("appealProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("response").child("success").contentString()}));function d(){return(d=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"fb:thrift_iq"},(0,a.wap)("request",{type:"appeal_product"},(0,a.wap)("reason",null,t),(0,a.wap)("id",null,e))),n=yield(0,o.sendIq)(r,c);if(n.success)return n.result;throw new l.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}t.appealProductResponse=c},90880:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductCatalog=function(){return d.apply(this,arguments)},t.productCatalogCreateResponse=void 0;var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("productCatalogCreateResponse",(e=>{e.assertTag("iq"),e.assertFromServer(),e.child("product_catalog_create")}));function d(){return(d=(0,i.default)((function*(){const e=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_create",{version:"1"})),t=yield(0,o.sendIq)(e,c);if(t.success)return t.result;throw new l.ServerStatusCodeError(t.errorCode)}))).apply(this,arguments)}t.productCatalogCreateResponse=c},15814:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProductsMD=function(){return d.apply(this,arguments)},t.productDeleteResponse=void 0;var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("productDeleteResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return{deletedCount:e.child("product_catalog_delete").attrInt("deleted_count")}}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_delete",{v:"1"},e.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e)))))),r=yield(0,o.sendIq)(t,c);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}t.productDeleteResponse=c},21013:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(65508),c=r(90667),d=r(77591);const u=new s.WapParser("editProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_edit").child("product");return(0,c.parseProductNode)(t)}));function p(){return(p=(0,i.default)((function*(e,t,r){const n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_edit",{v:"1"},(0,c.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,r.toString()))),i=yield(0,o.sendIq)(n,u,l.parseErrorFields);if(i.success)return i.result;throw i.customError?new d.CatalogEditServerError(i.errorCode,i.customError):new d.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},90667:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseLegacyProductErrorReason=function(e){if(null!=e){const t=Object.keys(e)[0];return[{name:t,reason:e[t]||"",detail:e.detail}]}return[]},t.parseProductNode=void 0,t.productModelToNode=function(e){var t,r;const n=e.id?(0,a.wap)("id",null,e.id.toString()):void 0,c=e.description?(0,a.wap)("description",null,e.description):void 0,d=e.url?(0,a.wap)("url",null,e.url):void 0,u=e.retailerId?(0,a.wap)("retailer_id",null,e.retailerId):void 0,p=null!=e.priceAmount1000?(0,a.wap)("currency",null,e.currency):void 0,h=null!=e.priceAmount1000?(0,a.wap)("price",null,e.priceAmount1000.toString()):void 0,f=[(0,a.wap)("image",null,(0,a.wap)("url",null,e.imageCdnUrl))].concat(null===(t=e.additionalImageCdnUrl)||void 0===t?void 0:t.map((e=>(0,a.wap)("image",null,(0,a.wap)("url",null,e))))),_=function(e){var t,r,n,i,o,l;const{isExempt:c,hasCountryCodeOrigin:d,hasImporterName:u,hasImporterAddress:p}=(0,s.scanComplianceInfoForMissingData)(e);return!c&&(d||u||p)?(0,a.wap)("compliance_info",null,d?(0,a.wap)("country_code_origin",null,null==e?void 0:e.countryCodeOrigin):void 0,u?(0,a.wap)("importer_name",null,null==e?void 0:e.importerName):void 0,p?(0,a.wap)("importer_address",null,(null==e||null===(t=e.importerAddress)||void 0===t?void 0:t.street1)?(0,a.wap)("street1",null,e.importerAddress.street1):void 0,(null==e||null===(r=e.importerAddress)||void 0===r?void 0:r.street2)?(0,a.wap)("street2",null,e.importerAddress.street2):void 0,(null==e||null===(n=e.importerAddress)||void 0===n?void 0:n.city)?(0,a.wap)("city",null,e.importerAddress.city):void 0,(null==e||null===(i=e.importerAddress)||void 0===i?void 0:i.region)?(0,a.wap)("region",null,e.importerAddress.region):void 0,(null==e||null===(o=e.importerAddress)||void 0===o?void 0:o.postalCode)?(0,a.wap)("postal_code",null,e.importerAddress.postalCode):void 0,(null==e||null===(l=e.importerAddress)||void 0===l?void 0:l.countryCode)?(0,a.wap)("country_code",null,e.importerAddress.countryCode):void 0):void 0):void 0}(e.complianceInfo),m=(0,i.default)({is_hidden:e.isHidden?"true":"false"},(null===(r=e.complianceInfo)||void 0===r?void 0:r.countryCodeOrigin)===String(o.SyntheticCountryCode.NotApplicable)?{compliance_category:l.ProductComplianceCategory.CountryOriginExempt}:void 0);return(0,a.wap)("product",m,n,(0,a.wap)("name",null,e.name),c,d,u,(0,a.wap)("media",null,f),h,p,_)};var i=n(r(81109)),a=r(31914),s=r(95176),o=r(9978),l=r(6822);t.parseProductNode=e=>{var t,r,n;const a=e.child("id").contentString(),s=e.maybeChild("url");let c="";s&&s.hasContent()&&(c=s.contentString());const d=e.child("name").contentString(),u=null!==(t=e.maybeAttrString("availability"))&&void 0!==t?t:l.ProductAvailability.UNKNOWN,p=e.maybeChild("description"),h=p?p.contentString():"",f=e.maybeChild("belongs_to"),_="true"===(null==f?void 0:f.contentString())||!1,m=[],g=[],y=[],E=e.child("media");let S=!0;E.forEachChildWithTag("image",(e=>{if(S)S=!1,m.push({key:"requested",value:e.child("request_image_url").contentString()}),m.push({key:"full",value:e.child("original_image_url").contentString()}),y.push(e.child("id").contentString());else{const t=[];t.push({key:"requested",value:e.child("request_image_url").contentString()}),t.push({key:"full",value:e.child("original_image_url").contentString()}),g.push(t),y.push(e.child("id").contentString())}}));const v=e.maybeChild("status_info"),T=(null==v?void 0:v.child("status").contentString())||"APPROVED",A=null==v||null===(r=v.maybeChild("can_appeal"))||void 0===r?void 0:r.contentString(),C=e.maybeChild("currency"),b=C?C.contentString():void 0,P=e.maybeChild("price"),M=null==P?void 0:P.contentString(),O=e.maybeChild("retailer_id"),I=O?O.contentString():"",w=!!e.hasAttr("is_hidden")&&"true"===e.attrString("is_hidden"),R=e.hasAttr("compliance_category")?l.ProductComplianceCategory.cast(e.attrString("compliance_category")):l.ProductComplianceCategory.Default,D=e.maybeChild("sale_price"),N=D?(0,i.default)({sale_price:null===(n=D.maybeChild("price"))||void 0===n?void 0:n.contentString()},D.hasChild("start_date")&&D.hasChild("end_date")?{sale_start_date:D.child("start_date").contentString(),sale_end_date:D.child("end_date").contentString()}:null):null,L=(0,i.default)({id:a,is_hidden:w,url:c,name:d,description:h,availability:u,additional_image_cdn_urls:g,image_cdn_urls:m,capability_to_review_status:[{key:"WHATSAPP",value:T}],whatsapp_product_can_appeal:"true"===A,image_hashes_for_whatsapp:y,currency:b,price:M,retailer_id:I,checkmark:_},N),k=e.maybeChild("compliance_info");return R===l.ProductComplianceCategory.CountryOriginExempt?L.compliance_info={country_code_origin:String(o.SyntheticCountryCode.NotApplicable)}:k&&(L.compliance_info=function(e){var t;const r=e.child("country_code_origin").contentString(),n=null===(t=e.maybeChild("importer_name"))||void 0===t?void 0:t.contentString(),i=e.maybeChild("importer_address"),a={country_code_origin:r,importer_name:n};var s,o,l;i&&(a.importer_address={street1:i.child("street1").contentString(),street2:null===(s=i.maybeChild("street2"))||void 0===s?void 0:s.contentString(),postal_code:null===(o=i.maybeChild("postal_code"))||void 0===o?void 0:o.contentString(),city:i.child("city").contentString(),region:null===(l=i.maybeChild("region"))||void 0===l?void 0:l.contentString(),country_code:i.child("country_code").contentString()});return a}(k)),L}},53069:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseProductGraphQL=function(e){var t,r,n,u,p;let{status_info:h,sale_price:f,availability:_,compliance_info:m}=e,g=(0,a.default)(e,c);const[y,...E]=null!==(t=null===(r=g.media)||void 0===r?void 0:r.images)&&void 0!==t?t:[],S=(0,i.default)((0,i.default)({id:(0,s.default)(g.id,"product.id"),retailer_id:(0,s.default)(g.retailer_id,"product.retailer_id"),name:(0,s.default)(g.name,"product.name"),description:(0,s.default)(g.description,"product.description"),url:(0,s.default)(g.url,"product.url"),currency:(0,s.default)(g.currency,"product.currency"),price:(0,s.default)(g.price,"product.price"),is_hidden:"ISHIDDEN_TRUE"===g.is_hidden,availability:_&&_ in d?d[_]:l.ProductAvailability.UNKNOWN},null!=(null==f?void 0:f.price)?(0,i.default)({sale_price:f.price},null!=f.start_date&&null!=f.end_date?{sale_start_date:f.start_date,sale_end_date:f.end_date}:null):null),{},{checkmark:"true"===g.belongs_to,image_hashes_for_whatsapp:(null!==(n=null===(u=g.media)||void 0===u?void 0:u.images)&&void 0!==n?n:[]).map((e=>(0,s.default)(e.id,"img.id"))),image_cdn_urls:y?[{key:"requested",value:(0,s.default)(y.request_image_url,"firstImage.request_image_url")},{key:"full",value:(0,s.default)(y.original_image_url,"firstImage.original_image_url")}]:[],additional_image_cdn_urls:E.map((e=>[{key:"requested",value:(0,s.default)(e.request_image_url,"img.request_image_url")},{key:"full",value:(0,s.default)(e.original_image_url,"img.original_image_url")}])),whatsapp_product_can_appeal:"true"===(null==h?void 0:h.can_appeal),capability_to_review_status:[{key:"WHATSAPP",value:null!==(p=null==h?void 0:h.status)&&void 0!==p?p:"APPROVED"}]});if(null!=m){var v,T,A,C,b;const{importer_address:e}=m;S.compliance_info="COMPLIANCECATEGORY_COUNTRYORIGINEXEMPT"===g.compliance_category?{country_code_origin:o.SyntheticCountryCode.NotApplicable}:{country_code_origin:null!==(v=m.country_code_origin)&&void 0!==v?v:void 0,importer_name:null!==(T=m.importer_name)&&void 0!==T?T:void 0,importer_address:{street1:(0,s.default)(null==e?void 0:e.street1,"importerAddress?.street1"),street2:null!==(A=null==e?void 0:e.street2)&&void 0!==A?A:void 0,postal_code:null!==(C=null==e?void 0:e.postal_code)&&void 0!==C?C:void 0,city:(0,s.default)(null==e?void 0:e.city,"importerAddress?.city"),region:null!==(b=null==e?void 0:e.region)&&void 0!==b?b:void 0,country_code:(0,s.default)(null==e?void 0:e.country_code,"importerAddress?.country_code")}}}return S};var i=n(r(81109)),a=n(r(6479)),s=n(r(45095)),o=(r(1321),r(9978)),l=r(6822);const c=["status_info","sale_price","availability","compliance_info"];const d={AVAILABILITY_INSTOCK:l.ProductAvailability.IN_STOCK,AVAILABILITY_OUTOFSTOCK:l.ProductAvailability.OUT_OF_STOCK}},17728:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("visibilitySetResponse",(e=>{e.assertTag("iq"),e.assertFromServer()}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",smax_id:"23",id:(0,a.generateId)()},(0,a.wap)("product_visibility_update",{v:"1"},e.map((e=>(0,a.wap)("product",{is_hidden:e.isHidden?"true":"false"},(0,a.wap)("id",null,e.productId)))))),r=yield(0,o.sendIq)(t,c);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}},60323:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealCollection=function(){return C.apply(this,arguments)},t.createCollection=function(){return E.apply(this,arguments)},t.deleteCollection=function(){return v.apply(this,arguments)},t.editCollection=function(){return T.apply(this,arguments)},t.parseCollectionStatusInfoNode=void 0,t.queryCollections=function(){return f.apply(this,arguments)},t.querySingleCollection=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(90667),c=r(39410),d=r(77591);const u=e=>{var t,r,n;return{status:e.child("status").contentString(),canAppeal:"true"===(null===(t=e.maybeChild("can_appeal"))||void 0===t?void 0:t.contentString().toLowerCase()),rejectReason:null===(r=e.maybeChild("reject_reason"))||void 0===r?void 0:r.contentString(),commerceUrl:null===(n=e.maybeChild("commerce_url"))||void 0===n?void 0:n.contentString()}};t.parseCollectionStatusInfoNode=u;const p=e=>{var t;const r=e.maybeChild("status_info"),n=r?u(r):void 0,i=(null==n?void 0:n.status)||"APPROVED",a=!!n&&n.canAppeal,s={id:e.child("id").contentString(),name:e.child("name").contentString(),isHidden:"TRUE"===(null===(t=e.maybeChild("is_hidden"))||void 0===t?void 0:t.contentString()),rejectReason:null==n?void 0:n.rejectReason,commerceUrl:null==n?void 0:n.commerceUrl,totalItemsCount:0,products:[],reviewStatus:i,canAppeal:a};return e.forEachChildWithTag("product",(e=>{s.products.push((0,l.parseProductNode)(e))})),s},h=new s.WapParser("collectionsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collections"),r=[];t.forEachChildWithTag("collection",(e=>{r.push(p(e))}));const n=t.child("paging").child("after"),i=n.hasContent()?n.contentString():"";return{collections:r,afterCursor:i}}));function f(){return(f=(0,i.default)((function*(e,t,r,n,i,s){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const u=t?(0,a.wap)("after",null,t):void 0,p=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"35"},(0,a.wap)("collections",{biz_jid:(0,c.DEVICE_JID)(e)},(0,a.wap)("collection_limit",null,r.toString()),(0,a.wap)("item_limit",null,n.toString()),(0,a.wap)("width",null,i.toString()),(0,a.wap)("height",null,s.toString()),u,l?(0,a.wap)("direct_connection_encrypted_info",null,l):null)),f=yield(0,o.sendIq)(p,h);if(f.success)return f.result;if(404===f.errorCode)return{collections:[],afterCursor:""};throw new d.ServerStatusCodeError(f.errorCode)}))).apply(this,arguments)}const _=new s.WapParser("singleCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),r=p(t),n=t.child("paging").child("after");return{collections:[r],afterCursor:n.hasContent()?n.contentString():""}}));function m(){return(m=(0,i.default)((function*(e,t,r,n,i,s){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const u=r?(0,a.wap)("after",null,r):void 0,p=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"30"},(0,a.wap)("collection",{biz_jid:(0,c.DEVICE_JID)(e),id:(0,a.CUSTOM_STRING)(t)},(0,a.wap)("limit",null,n.toString()),(0,a.wap)("width",null,i.toString()),(0,a.wap)("height",null,s.toString()),u,l?(0,a.wap)("direct_connection_encrypted_info",null,l):null)),h=yield(0,o.sendIq)(p,_);if(h.success)return h.result;throw new d.ServerStatusCodeError(h.errorCode)}))).apply(this,arguments)}const g=new s.WapParser("createOrEditCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),r=t.child("id").contentString(),n=t.maybeChild("status_info");return{id:r,reviewStatus:n?u(n).status:"APPROVED"}})),y=new s.WapParser("createOrEditCollectionResponseErrorParser",(e=>{const t=e.attrString("code"),r=e.attrString("text"),n=e.maybeChild("field");return{code:t,text:r,fieldName:null==n?void 0:n.attrString("name"),fieldReason:null==n?void 0:n.attrString("reason")}}));function E(){return(E=(0,i.default)((function*(e,t,r){const n=[];n.push((0,a.wap)("name",null,e)),n.push(...t.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e))))),n.push((0,a.wap)("catalog_session_id",null,r));const i=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"36"},(0,a.wap)("collection",{op:"create"},n)),s=yield(0,o.sendIq)(i,g,y);if(s.success)return s.result;throw s.customError}))).apply(this,arguments)}const S=new s.WapParser("deleteCollectionResponse",(e=>{e.assertTag("iq");const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function v(){return(v=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"43"},(0,a.wap)("collections",{op:"delete"},(0,a.wap)("id",null,e),(0,a.wap)("catalog_session_id",null,t))),n=yield(0,o.sendIq)(r,S);if(!n.success)throw new d.ServerStatusCodeError(n.errorCode);if(!n.result)throw new d.ServerStatusCodeError(500)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,i,s){const l=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"40"},(0,a.wap)("collection",{op:"update"},(0,a.wap)("id",null,e),t?(0,a.wap)("name",null,t):void 0,n.length>0?(0,a.wap)("add",null,n.map((e=>(0,a.wap)("id",null,e)))):void 0,i.length>0?(0,a.wap)("remove",null,i.map((e=>(0,a.wap)("id",null,e)))):void 0,(0,a.wap)("catalog_session_id",null,s))),c=yield(0,o.sendIq)(l,g,y);if(c.success)return c.result;throw c.customError}))).apply(this,arguments)}const A=new s.WapParser("appealCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function C(){return(C=(0,i.default)((function*(e,t){const r=t?(0,a.wap)("reason",null,t):void 0,n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,xmlns:"w:biz:catalog",type:"set",smax_id:"48"},(0,a.wap)("collection",{op:"appeal",id:(0,a.CUSTOM_STRING)(e)},r)),i=yield(0,o.sendIq)(n,A);if(i.success)return i.result;throw new d.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},92913:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAndUpdateBlocklist=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(4548),l=r(24747),c=r(37790),d=r(85553),u=r(58052),p=r(64551);const h=new s.WapParser("blocklistParser",(e=>{const t={wids:[]};if(e.hasChild("error"))return function(e){const t=e&&e.maybeAttrString("code"),r=e&&e.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getBlocklist error: code ${t} text ${r}`,SEND_LOGS("getBlocklist")}(e.child("error")),t;e.assertAttr("type","result");const r=e.maybeChild("list");if(r){const e=r.maybeAttrString("dhash");e&&(t.dhash=e),r.hasChild("item")&&(t.wids=r.mapChildrenWithTag("item",(e=>(0,d.deviceJidToUserWid)(e.attrDeviceJid("jid"))))||[])}return t}));function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){const e=(0,u.getBlocklistHash)(),t=(0,a.wap)("iq",{xmlns:"blocklist",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()},e?(0,a.wap)("item",{dhash:(0,a.CUSTOM_STRING)(e)}):null),r=yield(0,l.sendIq)(t,h);if(r.success)return r.result?r.result:Promise.reject(new Error("response does not have blocked list"));{const{errorCode:e,errorText:t}=r;return __LOG__(3)`fetchBlocklist: failed ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){const e=p.ServerProps.mdBlocklistV2?f:c.getBlocklist;__LOG__(2)`[blocklist] fetch blocklist using blocklist ${p.ServerProps.mdBlocklistV2?"v2":"v1"}`;const t=yield e();return null!=t.errorCode||(t.dhash?(__LOG__(2)`[blocklist] updating blocklist with ${t.wids.length||0} contact(s)`,(0,u.setBlocklistHash)(t.dhash),yield(0,o.updateBlocklist)(t.wids)):__LOG__(2)`[blocklist] no change in blocklist, skip update`),t}))).apply(this,arguments)}},87117:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("businessCategoriesResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("response"),r=[];let n="";try{const e=t.maybeChild("not_a_biz");null==e||e.forEachChildWithTag("category",(e=>{n=e.attrString("id")}));t.child("categories").forEachChildWithTag("category",(e=>{const t=e.attrString("id"),i=e.contentString();r.push({id:t,localized_display_name:i,not_a_biz:!!n.length&&t===n})}))}catch(e){}return{categories:r,notABizId:n}}));function d(){return(d=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=t?"profile_typeahead":"typeahead",n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"get"},(0,a.wap)("request",{op:(0,a.CUSTOM_STRING)(r),type:"catkit",v:"1"},(0,a.wap)("query",null,e))),i=yield(0,o.sendIq)(n,c);if(i.success)return i.result;throw new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},63638:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(85553),c=n(r(76199)),d=r(39410),u=r(77591);const p=new s.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("business_profile"),r=[];return t.forEachChildWithTag("profile",(e=>{const t=(0,l.jidWithTypeToWid)(e.attrJidWithType("jid")),n=e.attrString("tag"),i=(0,c.default)(e);Object.keys(i).length?r.push({wid:t,tag:n,profile:i}):r.push({wid:t,tag:n})})),r}));function h(){return(h=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"get"},(0,a.wap)("business_profile",{v:(0,a.INT)(t)},e.map((e=>(0,a.wap)("profile",{jid:(0,d.USER_JID)(e.wid),tag:null!=e.tag?(0,a.INT)(e.tag):a.DROP_ATTR}))))),n=yield(0,o.sendIq)(r,p);if(n.success)return n.result;throw new u.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}},43077:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(90667),c=r(39410),d=r(77591);const u=new s.WapParser("catalogResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog"),r=[];t.forEachChildWithTag("product",(e=>{e.maybeChild("id")&&r.push((0,l.parseProductNode)(e))}));const n=t.child("paging"),i=n.child("before"),a=i.hasContent()?i.contentString():"",s=n.child("after"),o=s.hasContent()?s.contentString():"";return{data:r,paging:{cursors:{after:o,before:a}}}}));function p(e){return e?"true":"false"}function h(){return(h=(0,i.default)((function*(e,t,r,n,i,s,l){let h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const f=t?(0,a.wap)("after",null,t):void 0,_=s?(0,a.wap)("belongs_to",null,(0,a.wap)("collection_id",null,s)):void 0,m=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)()},(0,a.wap)("product_catalog",{jid:(0,c.DEVICE_JID)(e),allow_shop_source:p(l)},(0,a.wap)("limit",null,r.toString()),(0,a.wap)("width",null,n.toString()),(0,a.wap)("height",null,i.toString()),f,_,h?(0,a.wap)("direct_connection_encrypted_info",null,h):null)),g=yield(0,o.sendIq)(m,u);if(g.success)return g.result;throw new d.ServerStatusCodeError(g.errorCode)}))).apply(this,arguments)}},27678:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=n(r(48926)),s=n(r(45095)),o=r(31914),l=r(71914),c=r(1321),d=(n(r(99805)),r(24747)),u=r(57701),p=r(90667),h=r(53069),f=r(39410),_=r(77591);const m=new l.WapParser("productResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog").child("product");return(0,p.parseProductNode)(t)})),g=function(){var e=(0,a.default)((function*(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const s=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,o.generateId)()},(0,o.wap)("product",{jid:(0,f.DEVICE_JID)(e)},(0,o.wap)("product_id",null,t),(0,o.wap)("width",null,r.toString()),(0,o.wap)("height",null,n.toString()),i?(0,o.wap)("fetch_compliance_info",null,i.toString()):void 0,a?(0,o.wap)("direct_connection_encrypted_info",null,a):null)),l=yield(0,d.sendIq)(s,m);if(l.success)return{data:l.result};if(404===l.errorCode)return{error:"NOT_FOUND"};throw new _.ServerStatusCodeError(l.errorCode)}));return function(){return e.apply(this,arguments)}}(),y=function(){var e=(0,a.default)((function*(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[a,o,l,d,u=!1,p=null]=t;try{var f,m;const e=yield(0,c.fetchQuery)(void 0!==i?i:i=r(79341),{catalogWid:a.toString(),productId:o,width:String(l),height:String(d),fetchComplianceInfo:String(u),directConnectionEncryptedInfo:p}),t=(0,s.default)(null==e||null===(f=e.xwa_product_catalog_get_product)||void 0===f||null===(m=f.product_catalog)||void 0===m?void 0:m.product,"data?.xwa_product_catalog_get_product?.product_catalog?.product");return{data:(0,h.parseProductGraphQL)(t)}}catch(e){var y,E;const[r]=null!==(y=null===(E=e.source)||void 0===E?void 0:E.errors)&&void 0!==y?y:[];switch(null==r?void 0:r.code){case 2498036:return{error:"NOT_FOUND"};case 2498035:case 2498034:case 2498037:case 2498025:throw new _.ServerStatusCodeError(400,e.message);case 2498040:throw new _.ServerStatusCodeError(421);default:return __LOG__(3)`GraphQL: Failed fetching query xwa_product_catalog_get_product. Falling back to IQ.`,g(...t)}}}));return function(){return e.apply(this,arguments)}}();var E=function(){return((0,u.graphQLForCatalogM1Enabled)()?y:g)(...arguments)};t.default=E},99192:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryDisappearingMode=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("dmParser",(e=>{const t=e.child("disappearing_mode");return{duration:t.attrInt("duration"),t:t.attrInt("t")}}));function d(){return(d=(0,i.default)((function*(){const e=(0,a.wap)("iq",{xmlns:"disappearing_mode",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()}),t=yield(0,o.sendIq)(e,c);if(!t.success)throw new l.ServerStatusCodeError(t.errorCode);return t.result}))).apply(this,arguments)}},71820:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExist=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(10435),s=r(79942),o=r(52284),l=r(77591);function c(){return(c=(0,i.default)((function*(e){const t=(new o.USyncQuery).withContactProtocol();t.withUser((new s.USyncUser).withPhone(e)),t.withBusinessProtocol(),(0,a.isDisappearingModeEnabled)()&&t.withDisappearingModeProtocol();const r=yield t.execute(),n=r.error.all||r.error.contact;if(n)return Promise.reject(new l.ServerStatusCodeError(n.errorCode,n.errorText));const{list:i}=r;if(1===i.length){const{id:e,contact:t,business:r,disappearing_mode:n}=i[0];if(t&&"in"===t.type){const t={wid:e,biz:!!r,bizInfo:r};return n&&(t.disappearingMode={duration:n.duration,settingTimestamp:n.t}),t}}return null}))).apply(this,arguments)}},78518:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mapParsedMediaConn=h,t.queryMediaConn=function(e){const t=new Date,r=(0,s.unixTime)(),n=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:(0,o.generateId)()},(0,o.wap)("media_conn",null)),u=(0,l.sendIq)(n,a.mediaConnParser).then((e=>{if(e.success){__LOG__(2)`backend:queryMediaConn: got ${e.result.hosts.length} hosts`;const{auth:n,authTTL:a,ttl:s,hosts:o,maxBuckets:l}=h(e.result);if(!n||null==s||!o||0===o.length)throw __LOG__(2)`backend:queryMediaConnections: auth exists ${String(!!n)}`,__LOG__(2)`backend:queryMediaConnections: ttl exists ${String(!!s)}`,__LOG__(2)`backend:queryMediaConnections: hosts exists ${String(!!o)}`,o&&__LOG__(2)`backend:queryMediaConnections: hosts.length ${o.length}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("backend:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");return(0,i.default)({queryStartTime:t,auth:n,hosts:o,ttl:s-r,maxBuckets:l},null!=a?{authTTL:a-r}:null)}if(__LOG__(4,void 0,new Error,!0)`response: ${e.errorCode} ${e.errorText}`,SEND_LOGS("backend:queryMediaConn: fail"),507===e.errorCode)throw new d.E507(e.errorText,e.errorBackoff);throw new d.ServerStatusCodeError(e.errorCode,e.errorText)}));return(0,c.default)(u,e)};var i=n(r(81109)),a=r(48095),s=r(92844),o=r(31914),l=r(24747),c=n(r(84644)),d=r(77591);function u(e){switch(e){case"kyc-id":case"novi-image":case"novi-video":case"thumbnail-gif":case"ppic":return null;default:return e}}function p(e){return{hostname:e.domain,class:e.class,ips:[{ip4:e.ip4,ip6:e.ip6}]}}function h(e){var t,r;const n=e=>{const t=[],r=e.downloadable.map(u).filter(Boolean);r.length>0&&t.push({download:r});const n=e.uploadable.map(u).filter(Boolean);n.length>0&&t.push({upload:n});const i=e.downloadBuckets.map((e=>e.toString()));return null!=i&&i.length>0&&t.push({downloadBuckets:i}),t};return{hosts:e.hosts.map((e=>(0,i.default)((0,i.default)({},p(e)),{},{fallback:null!=e.fallback?p(e.fallback):void 0,type:e.isFallback?"fallback":"primary",rules:n(e)}))),auth:e.authToken,authTTL:null!==(t=e.authTTL)&&void 0!==t?t:void 0,ttl:e.authExpires,maxBuckets:null!==(r=e.maxBuckets)&&void 0!==r?r:void 0}}},25338:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryPrivacyDisallowedList=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(85553);r(61319);const c=new s.WapParser("getPrivacyDisallowedListParser",(e=>{const t=e.child("privacy").maybeChild("list");if(null==t)return{status:"match"};return{status:"mismatch",users:t.mapChildren((e=>(0,l.deviceJidToUserWid)(e.attrDeviceJid("jid")))),dhash:t.attrString("dhash")}}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)(),xmlns:"privacy"},(0,a.wap)("privacy",null,(0,a.wap)("list",{name:(0,a.CUSTOM_STRING)(e),value:(0,a.CUSTOM_STRING)("contact_blacklist")}))),r=yield(0,o.sendIq)(t,c);if(r.success)return r.result;throw new Error("invalid response")}))).apply(this,arguments)}},4831:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VISIBILITY=t.ALL_NONE=void 0,t.getPrivacy=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),s=r(31914),o=r(71914),l=r(24747);const c={all:"all",contacts:"contacts",contact_blacklist:"contact_blacklist",none:"none"};t.VISIBILITY=c;const d=(0,a.default)((0,a.default)({},c),{},{error:"error"}),u={all:"all",none:"none"};t.ALL_NONE=u;const p=(0,a.default)((0,a.default)({},u),{},{error:"error"});function h(e,t){const r=t.maybeChild("error"),n=r&&r.maybeAttrString("code"),i=r&&r.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getPrivacy error: ${e} code ${n} text ${i}`,SEND_LOGS("getPrivacy")}const f=new o.WapParser("privacyParser",(e=>{e.assertAttr("type","result");const t={};return e.child("privacy").forEachChildWithTag("category",(e=>{switch(e.attrString("name")){case"readreceipts":{const r=e.attrEnum("value",p);"error"!==r?t.readReceipts=r:h("readreceipts",e);break}case"last":{const r=e.attrEnum("value",d);"error"!==r?t.lastSeen=r:h("last",e);break}case"profile":{const r=e.attrEnum("value",d);"error"!==r?t.profilePicture=r:h("profile",e);break}case"status":{const r=e.attrEnum("value",d);"error"!==r?t.about=r:h("status",e);break}case"groupadd":{const r=e.attrEnum("value",d);"error"!==r?t.groupAdd=r:h("groupadd",e);break}default:h("unknown type",e)}})),t}));function _(){return(_=(0,i.default)((function*(){const e=(0,s.wap)("iq",{xmlns:"privacy",to:s.S_WHATSAPP_NET,type:"get",id:(0,s.generateId)()},(0,s.wap)("privacy",null)),t=yield(0,l.sendIq)(e,f);if(t.success)return t.result;throw new Error("invalid response")}))).apply(this,arguments)}},66501:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,n.wap)("iq",{xmlns:"w",id:(0,n.generateId)(),type:"get",to:n.S_WHATSAPP_NET},(0,n.wap)("props",null));return(0,a.sendIq)(e,s)};var n=r(31914),i=r(71914),a=r(24747);const s=new i.WapParser("serverProps",(e=>{e.assertTag("iq"),e.assertAttr("from","s.whatsapp.net");const t=e.child("props"),r={serverPropsVersion:t.attrInt("version")};return t.forEachChildWithTag("prop",(e=>{switch(e.attrString("name")){case"bsp_system_message_enabled":r.bspSystemMessageEnabled=1===e.attrInt("value");break;case"web_ctwa_context_compose_enabled":r.ctwaContextCompose=1===e.attrInt("value");break;case"ctwa_context_enabled":r.ctwaContextRender=1===e.attrInt("value")?1:0;break;case"ephemeral_messages_allowed_values":r.ephemeralMessagesAllowedValues=e.attrString("value");break;case"frequently_forwarded_max":r.frequentlyForwardedMax=e.attrInt("value");break;case"frequently_forwarded_threshold":r.frequentlyForwardedThreshold=e.attrInt("value");break;case"web_gif_search":r.gifSearch=e.attrString("value");break;case"group_call_max_participants":r.groupCallMaxParticipants=e.attrInt("value",0);break;case"group_description_length":r.groupDescLength=e.attrInt("value");break;case"hfm_string_changes":r.hfmStringChanges=e.attrInt("value");break;case"image_max_edge":r.imageMaxEdge=e.attrInt("value");break;case"image_max_kbytes":r.imageMaxKBytes=e.attrInt("value");break;case"image_quality":r.imageQuality=e.attrInt("value")/100;break;case"max_participants":r.maxParticipants=e.attrInt("value");break;case"max_subject":r.maxSubject=e.attrInt("value");break;case"max_keys":r.maxKeys=e.attrInt("value");break;case"media":r.media=e.attrInt("value");break;case"multicast_limit_global":r.multicastLimitGlobal=e.attrInt("value");break;case"mute_always":r.muteAlways=e.attrInt("value");break;case"mms_media_key_ttl":r.mmsMediaKeyTTL=e.attrInt("value");break;case"wallpapers_v2":r.wallpapersV2=e.attrInt("value");break;case"web_shops_chat_header_button_enabled":r.webShopsChatHeaderButtonEnabled=1===e.attrInt("value",0);break;case"shops_hide_catalog_attachment_entrypoint":r.shopsHideCatalogAttachmentEntrypoint=1===e.attrInt("value",0);break;case"shops_header_dropdown_menu_item":r.shopsHeaderDropdownMenuItem=1===e.attrInt("value",0);break;case"shops_product_grid":r.shopsProductGrid=e.attrInt("value",0);break;case"mms_hot_content_timespan_in_seconds":r.mmsHotContentTimespan=e.attrInt("value");break;case"mms_vcache_aggregation_enabled":r.mmsVCacheAggregationEnabled=1===e.attrInt("value");break;case"mms_vcard_autodownload_size_kb":r.mmsVcardAutodownloadSizeKb=e.attrInt("value");break;case"product_media_attachments":r.productMediaAttachments=e.attrInt("value");break;case"status_video_max_duration":r.statusVideoMaxDuration=e.attrInt("value");break;case"syncd_inline_mutations_max_count":r.syncdInlineMutationsMaxCount=e.attrInt("value");break;case"syncd_patch_protobuf_max_size":r.syncdPatchProtobufMaxSize=e.attrInt("value");break;case"syncd_key_max_use_days":r.syncdKeyMaxUseDays=e.attrInt("value");break;case"syncd_wait_for_key_timeout_days":r.syncdWaitForKeyTimeoutDays=e.attrInt("value");break;case"syncd_additional_mutations":r.syncdAdditionalMutations=e.attrInt("value");break;case"syncd_sentinel_timeout_seconds":r.syncdSentinelTimeoutSeconds=e.attrInt("value");break;case"syncd_patch_device_index_included":r.syncdPatchDeviceIndexIncluded=1===e.attrInt("value");break;case"syncd_clear_chat_delete_chat_enabled":r.syncdClearChatDeleteChatEnabled=1===e.attrInt("value");break;case"md_pin_chat_enabled":r.syncdPinChatEnabled=1===e.attrInt("value");break;case"template_doc_mime_types":r.templateDocMimeTypes=e.attrInt("value");break;case"web_biz_profile_options":r.webBizProfileOptions=e.attrInt("value");break;case"web_biz_profile_v3":r.webBizProfileV3=1===e.attrInt("value");break;case"view_once_read":r.viewOnceRead=e.attrInt("value");break;case"view_once_write":r.viewOnceWrite=e.attrInt("value");break;case"vcard_as_document_size_kb":r.vcardAsDocumentSizeKb=e.attrInt("value");break;case"vcard_max_size_kb":r.vcardMaxSizeKb=e.attrInt("value");break;case"md_blocklist_v2":r.mdBlocklistV2=1===e.attrInt("value");break;case"web_download_document_thumb_mms_enabled":r.webDownloadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_download_status_thumb_mms_enabled":r.webDownloadStatusThumbMmsEnabled=1===e.attrInt("value");break;case"web_send_document_thumb_in_message_disabled":r.webSendDocumentThumbInMessageDisabled=1===e.attrInt("value");break;case"web_upload_document_thumb_mms_enabled":r.webUploadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_list_message":r.webListMessage=1===e.attrInt("value");break;case"web_voip_mac_os_min_version":r.webVoipMacOsMinVersion=e.attrString("value");break;case"web_voip_windows_os_min_version":r.webVoipWindowsOsMinVersion=e.attrString("value");break;case"web_cart_enabled":r.webCart=1===e.attrInt("value");break;case"web_cart_v1_1_order_message_changes_enabled":r.webCartV11OrderMessageChanges=1===e.attrInt("value");break;case"mms_cat_v1_forward_hot_override_enabled":r.mmsCatV1ForwardHotOverrideEnabled=1===e.attrInt("value");break;case"web_buttons_message_enabled":r.webButtonsMessage=1===e.attrInt("value");break;case"web_product_list_message_fallback":r.webProductListMessageFallback=1===e.attrInt("value");break;case"web_product_list_message_render_kill_switch":r.webProductListMessageRenderKillSwitch=1===e.attrInt("value");break;case"web_smb_upsell_in_biz_profile_enabled":r.webSMBUpsellInBizProfile=1===e.attrInt("value");break;case"ptt_conversation_waveform":r.pttConversationWaveform=1===e.attrInt("value");break;case"ptt_oot_playback":r.pttOotPlayback=1===e.attrInt("value");break;case"ptt_forwarded_features_enabled":r.pttForwardedFeaturesEnabled=1===e.attrInt("value");break;case"ptt_pausable_enabled":r.pttPausableEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_enabled":r.pttPlaybackSpeedEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_hide_delay":r.pttPlaybackSpeedHideDelay=e.attrInt("value");break;case"web_product_list_message_page_size":r.webProductListMessagePageSize=e.attrInt("value");break;case"ptt_remember_play_position":r.pttRememberPlayPosition=1===e.attrInt("value");break;case"ptt_waveform_send":r.pttWaveformSend=1===e.attrInt("value");break;case"web_youtube_player_enhancements":r.webYouTubePlayerEnhancements=1===e.attrInt("value");break;case"web_server_sticker_panel":r.webServerStickerPanel=e.attrInt("value");break;case"web_collections_display_enabled":r.webCollectionsDisplay=1===e.attrInt("value");break;case"web_cart_on_off":r.webCartOnOffToggle=1===e.attrInt("value");break;case"web_product_list_message_enabled":r.webProductListMessage=1===e.attrInt("value");break;case"web_media_auto_download_enabled":r.webMediaAutoDownloadEnabled=1===e.attrInt("value");break;case"download_host_switching_enabled":r.downloadHostSwitchingEnabled=1===e.attrInt("value");break;case"upload_host_switching_enabled":r.uploadHostSwitchingEnabled=1===e.attrInt("value");break;case"web_is_direct_connection_for_plm_transparent":r.isDirectConnectionForPLMTransparent=1===e.attrInt("value");break;case"web_pip_redesign":r.webPipRedesign=1===e.attrInt("value");break;case"max_electron_file_size":r.maxElectronFileSize=e.attrInt("value");break;case"max_file_size":r.maxFileSize=e.attrInt("value");break;case"web_sticker_maker":r.stickerMaker=1===e.attrInt("value");break;case"web_md_migration_experience":r.webMdMigrationExperience=1===e.attrInt("value");break;case"web_log_upload_download_crashes":r.webLogUploadDownloadCrashes=1===e.attrInt("value");break;case"web_large_files_ui":r.webLargeFilesUi=1===e.attrInt("value");break;case"web_graphql_for_catalog_m1":r.webGraphQLForCatalogM1=1===e.attrInt("value");break;case"web_md_mms_sync_deletion_request":r.webMdMmsSyncDeletionRequest=1===e.attrInt("value")}})),r}))},74727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RECEIPT_TYPE=t.RECEIPT_MSG_TYPE=void 0,t.sendAggregateReceipts=function(){return _.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(31914),o=r(71914),l=r(24747),c=r(99234),d=r(4831),u=r(39410);const p=Object.freeze({INACTIVE:"inactive",SENDER:"sender",DELIVERY:"delivery",READ:"read",READ_SELF:"read-self",PLAYED:"played",PLAYED_SELF:"played-self",HISTORY_SYNC_COMPLETION:"hist_sync",SERVER_ERROR:"server-error",PEER_MSG:"peer_msg"});t.RECEIPT_TYPE=p;const h=Object.freeze({PEER:"peer"});t.RECEIPT_MSG_TYPE=h;const f=new o.WapParser("readReceiptAckParser",(e=>(e.assertTag("ack"),{readReceipts:e.hasAttr("readreceipts")?e.attrEnum("readreceipts",d.ALL_NONE):null})));function _(){return(_=(0,a.default)((function*(e,t,r,n,o,d){const h=t===p.READ||t===p.PLAYED||t===p.READ_SELF||t===p.PLAYED_SELF||t===p.HISTORY_SYNC_COMPLETION;yield Promise.all(Array.from(n.keys()).map((_=>{const m=n.get(_);if(!m||0===m.length)return;const g=e.isUser()?null:_,y=[];for(;m.length>0;){const n=m.splice(0,256);let _=null;n.length>1&&(_=(0,s.wap)("list",null,n.slice(1).map((e=>(0,s.wap)("item",{id:(0,s.CUSTOM_STRING)(e)})))));const E=(0,s.wap)("receipt",{to:(0,u.JID)(e),type:t===p.DELIVERY?s.DROP_ATTR:(0,s.CUSTOM_STRING)(t),msgtype:d?(0,s.CUSTOM_STRING)(d):s.DROP_ATTR,id:(0,s.CUSTOM_STRING)(n[0]),t:null!=r?(0,s.CUSTOM_STRING)(r):s.DROP_ATTR,participant:g?(0,u.DEVICE_JID)(g):s.DROP_ATTR,recipient:o?(0,u.USER_JID)(o):s.DROP_ATTR},_);if(h){const r=function(){var r=(0,a.default)((function*(){const r={id:n[0],from:e,class:"receipt",type:t,participant:g};if(t!==p.READ&&t!==p.READ_SELF)return(0,l.sendStanzaAndWaitForAck)(E,r);{const e=yield(0,l.sendStanzaAndReturnAck)(E,r),t=f.parse(e);if(t.error)__LOG__(4,void 0,new Error,!0)`[messaging] sendAggregateReceipts: Invalid ack from server`,SEND_LOGS("Invalid-Receipt-Ack");else{const{readReceipts:e}=t.success;null!=e&&(0,c.setUserPrivacySettings)((0,i.default)((0,i.default)({},(0,c.getUserPrivacySettings)()),{},{readReceipts:e}))}}}));return function(){return r.apply(this,arguments)}}();y.push(r())}else y.push((0,l.castStanza)(E))}return Promise.all(y)})))}))).apply(this,arguments)}},16927:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterDecryption=function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const s=(0,h.default)(),o=(0,l.assertGetMe)(),c=!o.getDeviceId(),p=t.isUser()&&(0,_.toUserWid)(o).equals((0,_.toUserWid)(t))||null!=n&&(0,_.toUserWid)(o).equals((0,_.toUserWid)(n)),f=!(a===d.MSG_TYPES.reaction)&&(p||s||c);let m=Promise.resolve();if(!f){const r={msgId:e,chatId:t.toString(),participantId:n?n.toString():null};m=(0,u.getInactiveReceiptTable)().createOrReplace(r)}return m.then((()=>{if(g(e,t,r,n,f,p,i),f)return(0,u.getInactiveReceiptTable)().remove(e)}))}return Promise.resolve()},t.sendDeliveryReceiptsAfterPresence=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,u.getInactiveReceiptTable)().all().then(function(){var e=(0,i.default)((function*(e){const t=new Map,r=Date.now().toString();return e.forEach((e=>{const{msgId:r,chatId:n,participantId:i}=e,a=(0,_.createWid)(n),s=(i?(0,_.createWid)(i):null)||a;let o=t.get(a);o||(o=new Map,t.set(a,o));let l=o.get(s);l||(l=[],o.set(s,l)),l.push(r)})),yield Promise.all(Array.from(t.keys()).map((e=>{const n=t.get(e);if(n)return(0,p.sendAggregateReceipts)(e,p.RECEIPT_TYPE.DELIVERY,r,n)}))),(0,u.getInactiveReceiptTable)().bulkRemove(e.map((e=>e.msgId)))}));return function(){return e.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(48926)),a=r(19797),s=r(31914),o=r(24747),l=r(99234),c=r(7293),d=r(12037),u=r(76214),p=r(74727),h=n(r(84435)),f=r(39410),_=r(58021),m=r(53967);function g(e,t,r,n,i,l,c){let d=s.DROP_ATTR;c?d=(0,s.CUSTOM_STRING)(p.RECEIPT_TYPE.PEER_MSG):l?d=(0,s.CUSTOM_STRING)(p.RECEIPT_TYPE.SENDER):i||(d=(0,s.CUSTOM_STRING)(p.RECEIPT_TYPE.INACTIVE));const u=(0,a.extractJidFromJidWithType)((0,m.widToJidWithType)(t)),h=(0,s.wap)("receipt",{id:(0,s.CUSTOM_STRING)(e),to:(0,s.JID)(u),participant:(t.isGroup()||t.isBroadcast())&&n?(0,f.DEVICE_JID)(n):s.DROP_ATTR,recipient:!c&&l&&r?(0,f.USER_JID)(r):s.DROP_ATTR,type:d});(0,o.castStanza)(h)}},61426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(15688),s=r(31914),o=r(24747),l=r(98969),c=r(39410);function d(){return(d=(0,i.default)((function*(e,t,r){const n=(0,a.decodeB64)(r),{ciphertext:i,iv:d}=yield(0,l.encryptServerErrorReceipt)(n,t),u=(0,s.wap)("receipt",{type:"server-error",to:(0,c.USER_JID)(e),id:(0,s.CUSTOM_STRING)(t),category:"peer"},(0,s.wap)("encrypt",null,(0,s.wap)("enc_p",null,i),(0,s.wap)("enc_iv",null,d)));return(0,o.sendStanzaAndWaitForAck)(u,{id:t,class:"receipt",type:"server-error",from:e,participant:null})}))).apply(this,arguments)}},35099:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markChatRead=function(){return S.apply(this,arguments)},t.markStatusRead=function(){return v.apply(this,arguments)},t.sendReactionReadReceipts=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=r(52230),s=n(r(45095)),o=r(92844),l=r(48285),c=n(r(69618)),d=r(99234),u=r(90981),p=r(63728),h=n(r(32219)),f=r(4831),_=r(57793),m=r(74727),g=r(58021);const y=(0,g.createWid)(a.STATUS_JID);function E(e){return e.isGroup()?m.RECEIPT_TYPE.READ:(0,d.getUserPrivacySettings)().readReceipts===f.ALL_NONE.none?m.RECEIPT_TYPE.READ_SELF:m.RECEIPT_TYPE.READ}function S(){return(S=(0,i.default)((function*(e,t){const r=Date.now().toString(),n=String(e.id),i=yield(0,u.getTable)().equals(["from","pendingReadReceipt"],[n,1],{shouldDecrypt:!1});i.sort(((e,t)=>(e.rowId||0)-(t.rowId||0)));const a=t?String(t):null;let s=i.length-1;if(a){for(;s>=0&&i[s].id!==a;s--);s<0&&(s=i.length-1)}let o=null;const d=[];for(;s>=0;s--){const e=i[s];null!=e.rowId&&(null==o||e.rowId>o)&&(o=e.rowId);const t=h.default.fromString(e.id);if(e.type===c.default.MSG_TYPE.CIPHERTEXT){(0,p.viewPlaceHolderAction)(e);continue}e.type===c.default.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype&&(0,p.viewPlaceHolderAction)(e);const r=e.broadcastId||e.from,n=e.author||e.from;d.push({id:t.id,sender:(0,g.createWidFromWidLike)(n),chat:(0,g.createWidFromWidLike)(r)})}const f=A(d);return yield Promise.all(Array.from(f.keys()).map((t=>{const n=f.get(t);if(!n)return;const i=E(e.id);return(0,m.sendAggregateReceipts)(t,i,r,n)}))),(0,l.markMessageAndChatAsRead)(o,n,!1)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){if("status"!==e.remote.user)return void __LOG__(3)`markStatusRead: message is not a status.`;if(e.fromMe)return;yield(0,m.sendAggregateReceipts)(y,E(y),String(t),new Map([[(0,s.default)(e.participant,"msgKey.participant"),[e.id]]]));const r={ack:c.default.ACK.READ};e.participant&&e.participant.isPSA()&&(r.statusPSAReadTimestamp=t),yield(0,u.getTable)().merge(e.toString(),r)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=String((0,o.unixTime)()),r=A(e.filter((e=>!(0,_.isReactionByMe)(e.senderUserJid))).map((e=>({chat:e.msgKey.remote,sender:(0,g.createWidFromWidLike)(e.senderUserJid),id:e.msgKey.id}))));yield Promise.all(Array.from(r.keys()).map((e=>{const n=r.get(e);if(n)return(0,m.sendAggregateReceipts)(e,m.RECEIPT_TYPE.READ_SELF,t,n)})))}))).apply(this,arguments)}function A(e){const t=new Map;return e.forEach((e=>{var r,n;let{chat:i,sender:a,id:s}=e;const o=null!==(r=t.get(i))&&void 0!==r?r:new Map,l=null!==(n=o.get(a))&&void 0!==n?n:[];l.push(s),o.set(a,l),t.set(i,o)})),t}},55253:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareKeysForRetry=E,t.sendRetryReceipt=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(24863),o=r(24747),l=n(r(69618)),c=r(5087),d=r(99234),u=r(7293),p=r(58425),h=r(52083),f=r(11849),_=r(91335),m=r(39410),g=r(58021);function y(){return(y=(0,i.default)((function*(e,t,r,n,i,s){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];try{const u=(0,h.getSignalProtocolStore)(),[p,f]=yield Promise.all([u.getLocalRegistrationId(),u.getIdentityKeyPair()]);if(null==p||null==f)throw new Error("No registration info found");const _=yield E(e,(0,c.toCurveKeyPair)(f));let y,S,v=a.DROP_ATTR,T=a.DROP_ATTR;if(t.isUser()){if(S=a.DROP_ATTR,y=(0,m.DEVICE_JID)(t),(0,d.getMeUser)().equals((0,g.toUserWid)(t)))if(l)v=(0,a.CUSTOM_STRING)("peer"),T=a.DROP_ATTR;else{if(!n)return Promise.reject(new Error("sendRetryReceipt: send retry to peer device without receipient"));T=(0,m.USER_JID)(n)}}else y=(0,m.CHAT_JID)(t),S=r?(0,m.DEVICE_JID)(r):a.DROP_ATTR;const A=(0,a.wap)("receipt",{id:(0,a.CUSTOM_STRING)(i),to:y,participant:S,recipient:T,type:"retry",category:v},(0,a.wap)("retry",{v:"1",count:(0,a.INT)(e),id:(0,a.CUSTOM_STRING)(i),t:(0,a.CUSTOM_STRING)(s)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(p)),_);return(0,o.sendStanzaAndWaitForAck)(A,{id:i,class:"receipt",from:t,participant:r,type:"retry"})}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("sendRetryReceipt: error while creating or sending the retry message")}}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const[r,n]=yield v(e,t);return n&&(yield f.waSignalStore.markKeyAsUploaded(n.keyId),yield f.waSignalStore.markPreKeyAsDirectDistribution(n.keyId)),r}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(e<2)return Promise.resolve([null,null]);let r=Promise.resolve(null);u.GK.supportsFeature(u.GK.F.MD_ADV)&&(r=(0,s.getADVEncodedIdentity)().then((e=>(0,a.wap)("device-identity",null,e))));try{const[e,n,i]=yield Promise.all([f.waSignalStore.getSignedPreKey(),f.waSignalStore.getOrGenSinglePreKey(p.generatePreKeyPair),r]);if(!e)throw new Error("Signed pre key is not available");return[(0,a.wap)("keys",null,(0,a.wap)("type",null,l.default.KEY_BUNDLE_TYPE),(0,a.wap)("identity",null,t.pubKey),(0,_.xmppPreKey)(n),(0,_.xmppSignedPreKey)(e),i),n]}catch(e){throw Error("Could not create keys section for retry")}}))).apply(this,arguments)}},27184:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(15688),s=r(31914),o=r(24747),l=r(99234),c=r(98969),d=r(39410);function u(){return(u=(0,i.default)((function*(e){const t=e.id.id,r=(0,a.decodeB64)(e.mediaKey),{ciphertext:n,iv:i}=yield(0,c.encryptServerErrorReceipt)(r,t),{chat:u}=e,p=(0,s.CUSTOM_STRING)(u.id.toString({legacy:!0})),h=u.isGroup||u.isBroadcast?(0,s.CUSTOM_STRING)(e.sender.toString({legacy:!0})):s.DROP_ATTR,f=(0,l.getMeUser)(),_=(0,s.wap)("receipt",{type:"server-error",to:(0,d.USER_JID)(f),id:(0,s.CUSTOM_STRING)(t)},(0,s.wap)("encrypt",null,(0,s.wap)("enc_p",null,n),(0,s.wap)("enc_iv",null,i)),(0,s.wap)("rmr",{jid:p,from_me:(0,s.CUSTOM_STRING)(String(e.isSentByMe)),participant:h}));return(0,o.sendStanzaAndWaitForAck)(_,{id:t,class:"receipt",type:"server-error",from:f,participant:null})}))).apply(this,arguments)}},93374:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(39410),c=r(77591);const d=new s.WapParser("reportProductResponse",(e=>{e.assertTag("iq"),e.assertAttr("type","result")}));function u(){return(u=(0,i.default)((function*(e,t,r){const n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",type:"set",id:(0,a.generateId)()},(0,a.wap)("request",{type:"report_product",biz_jid:(0,l.USER_JID)(e)},r?(0,a.wap)("reason",null,r):void 0,(0,a.wap)("id",null,t))),i=yield(0,o.sendIq)(n,d);if(!i.success)throw new c.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},18701:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getSpamMessageProtobuf=v,t.reportSpam=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=n(r(67154)),s=n(r(81109)),o=r(31914),l=r(71914),c=r(60980),d=r(58853),u=r(24747),p=n(r(69618)),h=r(24808),f=r(99234),_=r(6565),m=r(93650),g=r(84728),y=r(39410);const{MSG_TYPE:E}=p.default,S=new Set([E.CHAT,E.AUDIO,E.IMAGE,E.PTT,E.VIDEO,E.VCARD,E.UNKNOWN,E.CIPHERTEXT,E.LIST,E.LIST_RESPONSE,E.BUTTONS_RESPONSE,E.NATIVE_FLOW]);function v(e){return null==e.buttonsMessage||null!=e.buttonsMessage.buttons&&(e.buttonsMessage=(0,s.default)((0,s.default)({},e.buttonsMessage),{},{buttons:e.buttonsMessage.buttons.map((e=>{if(e.nativeFlowInfo){var t;const r=JSON.parse(null!==(t=e.nativeFlowInfo.paramsJson)&&void 0!==t?t:"{}");return delete r.reference_id,delete r.total_amount,(0,s.default)((0,s.default)({},e),{},{nativeFlowInfo:(0,s.default)((0,s.default)({},e.nativeFlowInfo),{},{paramsJson:JSON.stringify(r)})})}return e}))})),e}function T(e){const t=[],r=e.isGroup?null:e.id;return function(e,t,r){const n=[],i=e.msgs.toArray().reverse();for(let a=0;a<i.length&&!(n.length>=t);a++){const t=i[a];if(S.has(t.type)&&!t.from.equals((0,f.getMaybeMeUser)())){if(r){if(e.isGroup&&!r.equals(t.author))continue;if(e.isUser&&!r.equals(t.from))continue}n.push(t)}}return n}(e,5,r).forEach((r=>{let n,i,s,l;const u=r.t.toString(),p=r.isViewOnce&&!(0,g.isUnviewed)(r.safe());switch(r.type){case E.UNKNOWN:l=null,n=o.DROP_ATTR,s=o.DROP_ATTR,i=(0,o.CUSTOM_STRING)(d.CIPHERTEXT_VERSION.toString());break;case E.CIPHERTEXT:l=null,n=o.DROP_ATTR,s=o.DROP_ATTR,i=o.DROP_ATTR;break;default:let e={};if(r.asMms){e=r.isUnsentPhoneMsg()||p||!r.mediaObject?{type:r.type}:r.avParams()}const t=v((0,_.createMsgProtobuf)(r,e)),a=(0,d.mediaTypeFromProtobuf)(t);l=p?null:(0,c.encodeProtobuf)(h.MessageSpec,t).readByteArray(),n=(0,m.typeAttributeFromProtobuf)(t),s=a?(0,o.CUSTOM_STRING)(a):o.DROP_ATTR,i=(0,o.CUSTOM_STRING)(d.CIPHERTEXT_VERSION.toString())}let f;const S={};if(p&&(S.deleted_reason=(0,g.isViewed)(r.safe())?"view_once_opened":"view_once_expired"),e.isGroup){let t=o.DROP_ATTR;r.author?t=(0,y.USER_JID)(r.author):r.from.isUser()&&(t=(0,y.USER_JID)(r.from)),f=(0,o.wap)("message",(0,a.default)({},S,{t:(0,o.CUSTOM_STRING)(u),from:(0,y.CHAT_JID)(e.id),participant:t,id:(0,o.CUSTOM_STRING)(r.id.id),type:n}),(0,o.wap)("raw",{v:i,mediatype:s},l))}else f=(0,o.wap)("message",(0,a.default)({},S,{t:(0,o.CUSTOM_STRING)(u),from:(0,y.USER_JID)(r.from),to:(0,y.USER_JID)(r.to),type:n,id:(0,o.CUSTOM_STRING)(r.id.id)}),r.multicast?(0,o.wap)("multicast",null):null,r.urlNumber?(0,o.wap)("url_number",null):null,r.urlText?(0,o.wap)("url_text",null):null,(0,o.wap)("raw",{v:i,mediatype:s},l));t.push(f)})),t}const A=new l.WapParser("reportUserSpam",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`reportSpam: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`reportSpam: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function C(){return(C=(0,i.default)((function*(e,t){const r=T(e);let n;if(e.isGroup){var i;const a=(null===(i=e.groupMetadata)||void 0===i?void 0:i.owner)&&(0,y.USER_JID)(e.groupMetadata.owner);n=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,o.generateId)()},(0,o.wap)("spam_list",{creator:a||o.DROP_ATTR,subject:(0,o.CUSTOM_STRING)(e.name),jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,o.CUSTOM_STRING)(String(t))},r))}else n=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,o.generateId)()},(0,o.wap)("spam_list",{jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,o.CUSTOM_STRING)(String(t))},r));const a=yield(0,u.sendIq)(n,A);if(a.success)return a.result;{const{errorCode:e,errorText:t}=a;return __LOG__(3)`reportSpam: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},88795:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r;switch(t){case"paused":r=(0,n.wap)("paused",null);break;case"composing":r=(0,n.wap)("composing",null);break;case"recording":r=(0,n.wap)("composing",{media:"audio"});break;default:throw new Error(`Impossible value, the default statement should never be reached for value: ${t}`)}return(0,i.castStanza)((0,n.wap)("chatstate",{to:(0,s.CHAT_JID)(e),from:(0,s.JID)((0,a.assertGetMe)())},r))};var n=r(31914),i=r(24747),a=r(99234),s=r(39410)},52407:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendKeyMsg=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(24747),s=r(99094),o=r(6565);function l(){return(l=(0,i.default)((function*(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendKeyMsg: sending ${e.id.toString()}`;const t=e.to,r=(0,o.createMsgProtobuf)(e),n=yield(0,s.createUserDeviceMsgStanza)(t,null,e,r,{type:s.MsgType.AppStateSync});return(0,a.sendStanzaAndWaitForAck)(n,{id:e.id.id,class:"message",from:t,participant:null})}))).apply(this,arguments)}},99094:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgType=void 0,t.createGroupDeviceMsgStanza=function(){return T.apply(this,arguments)},t.createUserDeviceMsgStanza=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=n(r(41143)),o=r(24863),l=r(58853),c=r(40316),d=r(99234),u=r(6565),p=r(7293),h=r(45033),f=r(97398),_=r(76802),m=r(52083),g=r(93650),y=r(39410),E=r(58021);const S=r(54302).Mirrored(["Retry","AppStateSync"]);function v(){return(v=(0,i.default)((function*(e,t,r,n,i){let a=n;return yield(0,f.ensureE2ESessions)([e]),(0,E.toUserWid)(e).equals((0,d.getMeUser)())&&i.type!==S.AppStateSync?((0,s.default)(null!=t,"[messaging] createDeviceMsgStanza: no recipient for peer device message"),a=(0,u.createDeviceSentMessage)(n,t),yield(0,_.populateICDCMeta)((0,E.toUserWid)(t),a)):yield(0,_.populateICDCMeta)((0,E.toUserWid)(e),a),A(e,null,t,r,a,i)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,i){if(yield(0,f.ensureE2ESessions)([t]),i.type===S.AppStateSync)return Promise.reject(new Error("[messaging] createGroupDeviceMsgStanza: not expect for App State Sync message"));const a=(0,E.toUserWid)(t).equals((0,d.getMeUser)())?(0,u.createDeviceSentMessage)(n,e):n;return yield(0,_.populateICDCMeta)((0,E.toUserWid)(t),a),A(e,t,null,r,a,i)}))).apply(this,arguments)}function A(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,r,n,i,s){var d;const u=t||e,f=null!==(d=s.retryCount)&&void 0!==d?d:0,E=(0,l.mediaTypeFromProtobuf)(i),v=n.id,{type:T,ciphertext:A}=yield(0,c.encryptMsgProtobuf)(u,f,i);let C=null;if(p.GK.supportsFeature(p.GK.F.MD_ADV)&&T===h.CiphertextType.Pkmsg){const e=yield(0,o.getADVEncodedIdentity)();C=(0,a.wap)("device-identity",null,e)}return s.type!==S.Retry&&(yield(0,_.updateIdentityRange)(v,[u])),yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(v.id),to:(0,y.JID)(e),participant:t?(0,y.DEVICE_JID)(t):a.DROP_ATTR,recipient:r?(0,y.USER_JID)(r):a.DROP_ATTR,type:(0,g.typeAttributeFromProtobuf)(i),edit:(0,_.editAttribute)(i,n.subtype),category:s.type===S.AppStateSync?(0,a.CUSTOM_STRING)("peer"):a.DROP_ATTR,push_priority:s.type===S.AppStateSync?(0,a.CUSTOM_STRING)("high"):a.DROP_ATTR},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(T),count:0===f?a.DROP_ATTR:(0,a.INT)(f),mediatype:(0,l.encodeMaybeMediaType)(E),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(i.reactionMessage)},A),C)}))).apply(this,arguments)}t.MsgType=S},40316:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMsgProtobuf=function(){return u.apply(this,arguments)},t.encryptMsgSenderKey=function(){return p.apply(this,arguments)};var a=i(r(48926)),s=r(58853),o=r(45033),l=i(r(11339)),c=r(76802),d=n(r(77605));function u(){return(u=(0,a.default)((function*(e,t,r){const n=(0,s.mediaTypeFromProtobuf)(r),i=new l.default.E2eMessageSend({e2eCiphertextVersion:s.CIPHERTEXT_VERSION,e2eDestination:(0,s.metricsDestinationType)(e),messageMediaType:n?(0,s.metricsMediaType)(n):l.default.MEDIA_TYPE.NONE,retryCount:t});try{const{type:t,ciphertext:n}=yield d.Cipher.encryptSignalProto(e,(0,c.encodeAndPad)(r));return i.e2eCiphertextType=(0,s.metricsCiphertextType)(t),i.e2eSuccessful=!0,i.commit(),{type:t,ciphertext:n}}catch(t){return i.e2eSuccessful=!1,i.weight=1,i.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e,t){const r=new l.default.E2eMessageSend({e2eCiphertextType:(0,s.metricsCiphertextType)(o.CiphertextType.Skmsg),e2eCiphertextVersion:s.CIPHERTEXT_VERSION,e2eDestination:l.default.E2E_DESTINATION.GROUP,messageMediaType:l.default.MEDIA_TYPE.NONE,retryCount:0});try{const n=yield d.Cipher.encryptSenderKeyMsgSignalProto(e,t);return r.e2eSuccessful=!0,r.commit(),n}catch(t){return r.e2eSuccessful=!1,r.weight=1,r.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}},45325:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FANOUT_TYPE=void 0,t.createFanoutMsgStanza=function(){return M.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(24863),o=r(58853),l=r(19380),c=r(40316),d=r(99234),u=r(6565),p=r(7293),h=r(45033),f=r(97398),_=r(47124),m=n(r(11339)),g=r(76802),y=r(16860),E=r(52083),S=r(64551),v=r(93650),T=r(39410),A=r(58021);const C=Object.freeze({CHAT:"chat",GROUP_DIRECT:"groupDirect"});function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,r,n,s){const l=(0,o.mediaTypeFromProtobuf)(r),p=(0,d.getMeUser)();if(n.fanoutType===C.CHAT&&1===t.length&&(0,g.isPrimaryDevice)(t[0])){null==s||s.startClientEncryptStage();const{type:e,ciphertext:n}=yield(0,c.encryptMsgProtobuf)(t[0],0,r);return null==s||s.postClientEncryptStage(),{shouldHaveIdentity:e===h.CiphertextType.Pkmsg,body:(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(o.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,o.encodeMaybeMediaType)(l),"decrypt-fail":(0,o.encodeMaybeDecryptFail)(r.reactionMessage)},n)}}{let d=!1;null==s||s.startClientEncryptStage();const f=t.map(function(){var t=(0,i.default)((function*(t){const i=(0,A.toUserWid)(t).equals(p)?(0,u.createDeviceSentMessage)(r,e):r,s=n.fanoutType===C.GROUP_DIRECT?(0,A.toUserWid)(t):(0,A.toUserWid)(e);yield(0,g.populateICDCMeta)(s,i);try{const{type:e,ciphertext:n}=yield(0,c.encryptMsgProtobuf)(t,0,i);return e===h.CiphertextType.Pkmsg&&(d=!0),(0,a.wap)("to",{jid:(0,T.DEVICE_JID)(t)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(o.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,o.encodeMaybeMediaType)(l),"decrypt-fail":(0,o.encodeMaybeDecryptFail)(r.reactionMessage)},n))}catch(e){return(0,g.isPrimaryDevice)(t)&&(__LOG__(4,void 0,new Error,!0,["messaging"])`encryptAndSendUserMsg: encryption fail for primary device ${String(t)}`,SEND_LOGS("encryption-fail-for-primary-device")),null}}));return function(){return t.apply(this,arguments)}}()),_=yield Promise.all(f);null==s||s.postClientEncryptStage();const m=_.filter((e=>null!=e));return m.length>0?{body:(0,a.wap)("participants",null,m),shouldHaveIdentity:d}:Promise.reject(new Error("[messaging] encryptAndSendUserMsg: encryption fail for all devices"))}}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t,r,n){const i=e.to;try{const e=yield(0,f.ensureE2ESessions)(r);(0,y.postPrekeysDepletionMetric)({count:null==e?void 0:e.depletedPrekeyCount,prekeysFetchReason:m.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:n.fanoutType===C.CHAT?m.default.MESSAGE_TYPE.INDIVIDUAL:m.default.MESSAGE_TYPE.GROUP,chatId:i})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const c=e.id;let d=r;n.isResendingMsg&&(d=yield(0,g.filterDeviceWithChangedIdentity)(c,r));const u=d.map((e=>({msgKey:c,receiverId:e})));yield(0,_.createOrMergeReceiptRecords)(u);const A=yield b(i,d,t,n,e.wamMessageSendPerfReporter),P=n.fanoutType===C.GROUP_DIRECT?(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(o.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(h.CiphertextType.Skmsg)}):null;let M=null;if(p.GK.supportsFeature(p.GK.F.MD_ADV)&&A.shouldHaveIdentity){const e=yield(0,s.getADVEncodedIdentity)();M=(0,a.wap)("device-identity",null,e)}const O=(0,v.getBizNativeFlowName)(t);let I;if(S.ServerProps.bspSystemMessageEnabled){const e=l.ContactCollection.get(i),t=null==e?void 0:e.privacyMode;null!=t&&(I=(0,a.wap)("biz",{host_storage:(0,a.INT)(t.hostStorage),actual_actors:(0,a.INT)(t.actualActors),privacy_mode_ts:(0,a.INT)(t.privacyModeTs),native_flow_name:(0,a.MAYBE_CUSTOM_STRING)(O)}))}null==I&&null!=O&&(I=(0,a.wap)("biz",{native_flow_name:(0,a.CUSTOM_STRING)(O)})),n.isResendingMsg||(yield(0,g.updateIdentityRange)(c,d)),yield(0,E.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const{id:w}=c;return(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(w),to:(0,T.CHAT_JID)(i),type:(0,v.typeAttributeFromProtobuf)(t),edit:(0,g.editAttribute)(t,e.subtype),device_fanout:n.isResendingMsg?(0,a.CUSTOM_STRING)("false"):a.DROP_ATTR},A.body,P,M,I)}))).apply(this,arguments)}t.FANOUT_TYPE=C},43341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupDirectMsg=function(){return m.apply(this,arguments)},t.resendGroupMsg=g;var i=n(r(48926)),a=n(r(70735)),s=r(10823),o=r(22683),l=r(24747),c=r(45325),d=r(16104),u=n(r(11339)),p=r(76802),h=r(52083),f=r(90298),_=r(58021);function m(){return(m=(0,i.default)((function*(e,t,r){const n=e.to;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: sending ${e.id} with group ${n.toString()}`;const i=yield E(e,t,r,{fanoutType:c.FANOUT_TYPE.GROUP_DIRECT}),{phash:a}=i;if(a){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: phash mismatch, got server phash ${a}`;const n=o.Clock.globalUnixTime();new u.default.MdDeviceSyncAck({chatType:u.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,p.isRevokeMsg)(t)}).commit(),(0,s.syncDeviceListJob)(r,"message",a).then((()=>g(e,t,r,n)))}return i}))).apply(this,arguments)}function g(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r,n){__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: to ${e.to.toString()}`;const i=(0,p.createResendAbortMetric)((0,p.isRevokeMsg)(t));if(o.Clock.globalUnixTime()-n>p.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip group resending due to 5 min timeout`,i.messageSendResult=u.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void i.commit();try{const n=Array.from(new Set(r.map((e=>e.user)))).map((e=>(0,_.createUserWid)(e))),s=yield(0,d.getFanOutList)({wids:n}),o=(0,a.default)(s,r,String);if(0===o.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: skip sending to the empty list`,i.messageSendResult=u.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void i.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resending to devices ${o.join(",")}`,yield E(e,t,o,{fanoutType:c.FANOUT_TYPE.GROUP_DIRECT,isResendingMsg:!0})}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resend got error ${e} `,i.messageSendResult=u.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,i.commit(),e}(0,f.logSuccessfulMessageSend)(i,e.id)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r,n){var i;const{id:a,to:s}=e,o=yield(0,c.createFanoutMsgStanza)(e,t,r,n);yield(0,h.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const d=yield(0,l.sendStanzaAndReturnAck)(o,{id:a.id,class:"message",from:s,participant:null}),u=p.sendMsgAckSyncParser.parse(d);return u.error?Promise.reject(new Error("[messaging] encryptAndSendGroupDirectMsg: Invalid ack from server")):u.success}))).apply(this,arguments)}},23712:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDistributionMsg=function(){return h.apply(this,arguments)};var a=i(r(48926)),s=r(40316),o=(r(45033),r(97398)),l=i(r(11339)),c=r(76802),d=r(16860),u=n(r(77605)),p=r(58021);function h(){return(h=(0,a.default)((function*(e,t,r){var n,i,h,f;if(null==e||null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.startPrekeysFetchStage(),null==e||null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.setFetchedPrekeyCount(0),null==e||null===(h=e.wamMessageSendPerfReporter)||void 0===h||h.setSenderKeyDistributionCount(r.length),0===r.length)return null==e||null===(f=e.wamMessageSendPerfReporter)||void 0===f||f.postPrekeysFetchStage(),null;try{var _;const n=yield(0,o.ensureE2ESessions)(r),i=null==n?void 0:n.missedPrekeyCount;var m;if(null!=i)null==e||null===(m=e.wamMessageSendPerfReporter)||void 0===m||m.setFetchedPrekeyCount(i);null==e||null===(_=e.wamMessageSendPerfReporter)||void 0===_||_.postPrekeysFetchStage(),(0,d.postPrekeysDepletionMetric)({count:null==n?void 0:n.depletedPrekeyCount,prekeysFetchReason:l.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:l.default.MESSAGE_TYPE.GROUP,chatId:t})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const g=yield u.Session.getGroupSenderKeyInfo(t),y={senderKeyDistributionMessage:{groupId:t.toString({legacy:!0}),axolotlSenderKeyDistributionMessage:g}},E=r.map(function(){var e=(0,a.default)((function*(e){try{yield(0,c.populateICDCMeta)((0,p.toUserWid)(e),y);const t=yield(0,s.encryptMsgProtobuf)(e,0,y);return{type:t.type,ciphertext:t.ciphertext,participant:e}}catch(t){if(__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: encryption fail for ${e.toString()}, ${t}`,(0,c.isPrimaryDevice)(e))return Promise.reject(new Error(`[messaging] encryptAndSendUserMsg: encryption fail for primary device ${String(e)}`))}}));return function(){return e.apply(this,arguments)}}());return(yield Promise.all(E)).filter(Boolean)}))).apply(this,arguments)}},51974:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupMsg=function(e,t){const{id:r,to:n}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupMsg: sending ${r}`;const{protocolMessage:l}=t;let c=null;if((null==l?void 0:l.type)===o.ProtocolMessageType.REVOKE&&(null==l?void 0:l.key)){const{remoteJid:e,id:t,participant:r}=l.key;e&&t&&r&&(c=new u.default({remote:(0,_.createWid)(e),fromMe:!0,id:t,participant:(0,_.createWid)(r)}))}return h.senderKeyQueueMap.enqueue(n.toString(),(0,a.default)((function*(){const r=yield function(){return g.apply(this,arguments)}(n,c);if(r.type===m.DIRECT){const{deviceList:n}=r,a=yield(0,s.encryptAndSendGroupDirectMsg)(e,t,n);return(0,i.default)((0,i.default)({},a),{},{deviceCount:n.length})}{const{senderKeyList:n}=r,a=yield(0,f.encryptAndSendSenderKeyMsg)(e,t,n);return(0,i.default)((0,i.default)({},a),{},{deviceCount:n.skList.length+n.skDistribList.length})}})))};var i=n(r(81109)),a=n(r(48926)),s=r(43341),o=r(24808),l=r(16104),c=r(7293),d=r(76214),u=n(r(32219)),p=r(43201),h=r(92657),f=r(3922),_=r(58021);const m=Object.freeze({SKMSG:"skmsg",DIRECT:"direct"});function g(){return(g=(0,a.default)((function*(e,t){const r=yield(0,p.getGroupSenderKeyList)(e),n={senderKeyList:r,type:m.SKMSG};if(t&&c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const e=yield(0,d.getMsgInfoTable)().equals(["msgKey"],String(t));if(0===e.length)return n;const{skDistribList:i,skList:a}=r,s=new Set(i.concat(a).map((e=>String((0,_.toUserWid)(e))))),o=e.filter((e=>!s.has(e.receiverUserJid))).map((e=>(0,_.createWid)(e.receiverUserJid)));if(0===o.length)return n;const c=[...yield(0,l.getFanOutList)({wids:o}),...a,...i];return{type:m.DIRECT,deviceList:c}}return n}))).apply(this,arguments)}},95216:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupKeyDistributionMsg=function(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupKeyDistributionMsg: sending ${e}`;const t=e.remote;return E.senderKeyQueueMap.enqueue(t.toString(),(()=>function(){return T.apply(this,arguments)}(e)))};var a=i(r(48926)),s=r(31914),o=r(24863),l=r(58853),c=r(24747),d=r(99234),u=r(23712),p=r(7293),h=r(45033),f=r(47124),_=r(76802),m=r(43201),g=r(53686),y=r(52083),E=r(92657),S=n(r(77605)),v=r(39410);function T(){return(T=(0,a.default)((function*(e){const{id:t}=e,r=e.remote,{skDistribList:n,skList:i,rotateKey:a}=yield(0,m.getGroupSenderKeyList)(r),[o,u]=yield A(r,n,a),p=i.concat(n);yield(0,_.updateIdentityRange)(e,p),yield(0,f.createOrMergeReceiptRecords)(p.map((t=>({msgKey:e,receiverId:t})))),yield(0,y.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const E=yield(0,g.phashV2)([...p,(0,d.assertGetMe)()]),S=(0,s.wap)("message",{id:(0,s.CUSTOM_STRING)(t),to:(0,v.CHAT_JID)(r),phash:(0,s.CUSTOM_STRING)(E),type:"text",device_fanout:(0,s.CUSTOM_STRING)("false")},(0,s.wap)("enc",{v:(0,s.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,s.CUSTOM_STRING)(h.CiphertextType.Skmsg),"decrypt-fail":(0,s.CUSTOM_STRING)("hide")}),o,u),T=yield(0,c.sendStanzaAndReturnAck)(S,{id:t,class:"message",from:r,participant:null}),C=_.sendMsgAckSyncParser.parse(T);return C.error?(__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"))):(yield(0,m.markHasSenderKey)(r,n),C.success)}))).apply(this,arguments)}function A(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e,t,r){r&&(yield S.Session.deleteGroupSenderKeyInfo(e));const n=yield(0,u.getKeyDistributionMsg)(null,e,t);let i=null,a=!1;n&&n.length>0&&(i=(0,s.wap)("participants",null,n.map((e=>{let{type:t,ciphertext:r,participant:n}=e;return t===h.CiphertextType.Pkmsg&&(a=!0),(0,s.wap)("to",{jid:(0,v.DEVICE_JID)(n)},(0,s.wap)("enc",{v:(0,s.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),"decrypt-fail":(0,s.CUSTOM_STRING)("hide"),type:(0,s.CUSTOM_STRING)(t)},r))}))));let c=null;if(p.GK.supportsFeature(p.GK.F.MD_ADV)&&a){const e=yield(0,o.getADVEncodedIdentity)();c=(0,s.wap)("device-identity",null,e)}return[i,c]}))).apply(this,arguments)}},92657:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.senderKeyQueueMap=void 0;const n=new(r(27870).PromiseQueueMap);t.senderKeyQueueMap=n},3922:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendSenderKeyMsg=function(){return w.apply(this,arguments)};var a=i(r(48926)),s=r(31914),o=r(24863),l=r(22683),c=r(58853),d=r(24747),u=r(43341),p=r(40316),h=r(99234),f=r(23712),_=r(7293),m=r(45033),g=r(90981),y=r(47124),E=i(r(11339)),S=r(76802),v=r(43201),T=r(53686),A=r(52083),C=r(10790),b=n(r(77605)),P=r(93650),M=r(39410);function O(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,r,n){var i,a;const l=(0,S.encodeAndPad)(n),d=(0,c.mediaTypeFromProtobuf)(n),u=yield(0,f.getKeyDistributionMsg)(e,t,r);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startClientEncryptStage();const h=yield(0,p.encryptMsgSenderKey)(t,l);null===(a=e.wamMessageSendPerfReporter)||void 0===a||a.postClientEncryptStage();let g=null,y=!1;u&&u.length>0&&(g=(0,s.wap)("participants",null,u.map((e=>{let{type:t,ciphertext:r,participant:i}=e;return t===m.CiphertextType.Pkmsg&&(y=!0),(0,s.wap)("to",{jid:(0,M.DEVICE_JID)(i)},(0,s.wap)("enc",{v:(0,s.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,s.CUSTOM_STRING)(t),"decrypt-fail":(0,c.encodeMaybeDecryptFail)(n.reactionMessage)},r))}))));const E=(0,s.wap)("enc",{v:(0,s.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,s.CUSTOM_STRING)(m.CiphertextType.Skmsg),mediatype:(0,c.encodeMaybeMediaType)(d),"decrypt-fail":(0,c.encodeMaybeDecryptFail)(n.reactionMessage)},h.ciphertext);let v=null;if(_.GK.supportsFeature(_.GK.F.MD_ADV)&&y){const e=yield(0,o.getADVEncodedIdentity)();v=(0,s.wap)("device-identity",null,e)}return[g,E,v]}))).apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e,t,r){var n;const{id:i,to:a}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: sending ${i}`;const{id:o}=i,{skDistribList:c,skList:p,rotateKey:f}=r;R(e);const _=p.concat(c),m=yield(0,T.phashV2)([..._,(0,h.assertGetMe)()]);yield(0,y.createOrMergeReceiptRecords)(_.map((e=>({msgKey:i,receiverId:e})))),f&&(yield b.Session.deleteGroupSenderKeyInfo(a));const[I,w,D]=yield O(e,a,c,t),N=(0,s.wap)("message",{id:(0,s.CUSTOM_STRING)(o),to:(0,M.CHAT_JID)(a),phash:(0,s.CUSTOM_STRING)(m),type:(0,P.typeAttributeFromProtobuf)(t),edit:(0,S.editAttribute)(t,e.subtype)},I,w,D);yield(0,S.updateIdentityRange)(i,_),yield(0,A.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.postReadyToSendStage();const L=yield(0,d.sendStanzaAndReturnAck)(N,{id:o,class:"message",from:a,participant:null}),k=S.sendMsgAckSyncParser.parse(L);if(k.error)return __LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"));yield(0,v.markHasSenderKey)(a,c);const{phash:G,count:U}=k.success;if(G&&G!==m){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: phash mismatch, got server phash ${G}`;const r=l.Clock.globalUnixTime();new E.default.MdDeviceSyncAck({chatType:E.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,S.isRevokeMsg)(t)}).commit(),(0,C.sendQueryGroup)(a).then((()=>{(0,u.resendGroupMsg)(e,t,_,r)}))}return null!=U&&(0,g.getTable)().merge(String(i),{count:U}),k.success}))).apply(this,arguments)}function R(e){var t;(0,h.markUserSentMessageToChat)(e.chat.id)&&(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.setMessageIsFirstUserMessage(!0))}},24659:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendRetry=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(41143)),s=r(24747),o=r(99094),l=r(6565);function c(){return(c=(0,i.default)((function*(e,t,r,n,i){const c=n.id.id;let d;__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: id ${c} to ${e.toString()}, requester: ${(t||e).toString()}, count: ${i}`,n.asMms&&(d=n.isUnsentPhoneMsg()?{type:n.type}:n.avParams());const u=(0,l.createMsgProtobuf)(n,d||{}),p={type:o.MsgType.Retry,retryCount:i};let h;return e.isUser()?h=yield(0,o.createUserDeviceMsgStanza)(e,r,n,u,p):((0,a.default)(null!=t,"[messaging] sendRetry: no participant for group retry message"),h=yield(0,o.createGroupDeviceMsgStanza)(e,t,n,u,p)),__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: sending ${c} to ${e.toString()}`,(0,s.sendStanzaAndWaitForAck)(h,{id:c,class:"message",from:e,participant:t})}))).apply(this,arguments)}},95547:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"encodeAndPad",{enumerable:!0,get:function(){return _.encodeAndPad}}),t.encryptAndSendKeyDistributionMsg=function(e){if(!e.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!e.remote)return Promise.reject(new Error("[messaging] sending message without an remote id"));if(e.remote.isGroup()){const t=new o.MessageSendPerfReporter(e.remote,l.default.MEDIA_TYPE.NONE,l.default.MESSAGE_TYPE.GROUP);return(0,u.encryptAndSendGroupKeyDistributionMsg)(e).then((()=>{t.setMessageIsInvisible(!0),t.postWrittenWireStage()}))}return Promise.reject(new Error("[messaging] unsupported remote jid type"))},t.encryptAndSendMsg=function(e){var t,r;const n=e.id,o=e.to;if(!n||!n.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!o)return Promise.reject(new Error("[messaging] sending message without an remote id"));s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e.type===c.TYPE.STICKER&&null==e.deprecatedMms3Url&&(e.deprecatedMms3Url=m);let l;if(e.asMms){const t=e.isUnsentPhoneMsg();l=t?{type:e.type}:e.avParams(),s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e.type===c.TYPE.STICKER&&!t&&null==l.url&&(l.url=m)}const u=(0,a.createMsgProtobuf)(e,l||{});if(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.startWrittenWireStage(),null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.startReadyToSendStage(),o.isUser()){const t=(0,h.encryptAndSendUserMsg)(e,u);return s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&(0,i.getABPropConfigValue)("trusted_contacts_sender")&&(0,p.sendTcToken)(o),t}if(o.isGroup())return(0,d.encryptAndSendGroupMsg)(e,u);return Promise.reject(new Error("[messaging] unsupported remote jid type"))},Object.defineProperty(t,"sendRetry",{enumerable:!0,get:function(){return f.sendRetry}});var i=r(86945),a=r(6565),s=r(7293),o=r(30097),l=n(r(11339)),c=r(17304),d=r(51974),u=r(95216),p=r(41088),h=r(68264),f=r(24659),_=r(76802);const m="https://whatsapp.net"},68264:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendUserMsg=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=n(r(70735)),s=r(10823),o=r(22683),l=r(24747),c=r(45325),d=r(16104),u=r(99234),p=n(r(11339)),h=r(76802),f=r(90298);function _(){return(_=(0,i.default)((function*(e,t){const{id:r,to:n}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: sending ${r}`;const i=(0,u.assertGetMe)(),a=yield(0,d.getFanOutList)({wids:[n,i]}),l=yield y(e,t,a,{fanoutType:c.FANOUT_TYPE.CHAT}),{phash:f}=l;if(f){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: phash mismatch, got server phash ${f}`;const r=o.Clock.globalUnixTime();new p.default.MdDeviceSyncAck({chatType:p.default.MESSAGE_CHAT_TYPE.INDIVIDUAL,revoke:(0,h.isRevokeMsg)(t)}).commit(),(0,s.syncDeviceListJob)([n,i],"message",f).then((()=>m(e,t,a,r)))}return l}))).apply(this,arguments)}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t,r,n){const{id:i,to:l}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending ${i.id}`;const _=(0,h.createResendAbortMetric)((0,h.isRevokeMsg)(t));if(o.Clock.globalUnixTime()-n>h.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending due to 5 min timeout`,_.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void _.commit();try{const n=(0,u.assertGetMe)(),i=yield(0,d.getFanOutList)({wids:[l,n]}),o=(0,a.default)(i,r,String);if(0===o.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending to the empty list`,_.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void _.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending to devices ${o.join(",")}`;const{phash:h}=yield y(e,t,o,{fanoutType:c.FANOUT_TYPE.CHAT,isResendingMsg:!0});h&&(0,s.syncDeviceListJob)([l,n],"message",h)}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resend got error ${e} `,_.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,_.commit(),e}(0,f.logSuccessfulMessageSend)(_,i)}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,r,n){var i;const{id:a,to:s}=e,o=yield(0,c.createFanoutMsgStanza)(e,t,r,n);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const d=yield(0,l.sendStanzaAndReturnAck)(o,{id:a.id,class:"message",from:s,participant:null}),u=h.sendMsgAckSyncParser.parse(d);if(u.error)throw new Error("[messaging] sendMsgToDeviceList: Invalid ack from server");return u.success}))).apply(this,arguments)}},93167:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,n.wap)("presence",{type:e,name:(0,n.MAYBE_CUSTOM_STRING)(a.Conn.pushname)}))};var n=r(31914),i=r(24747),a=r(17239)},34083:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=e.isUser()&&null!=t&&(0,i.getABPropConfigValue)("trusted_contacts");return(0,a.castStanza)((0,n.wap)("presence",{id:(0,n.generateId)(),to:(0,s.CHAT_JID)(e),type:"subscribe"},r?(0,n.wap)("tctoken",null,t):null))};var n=r(31914),i=r(86945),a=r(24747),s=r(39410)},66612:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(39410),c=r(77591),d=n(r(39546));const u=new s.WapParser("photoResponseParser",(e=>{if(e.assertAttr("type","result"),e.hasChild("picture")){return{id:e.child("picture").attrInt("id")}}return{id:null}}));function p(){return(p=(0,i.default)((function*(e,t){const r=yield(0,o.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,target:d.default.isGroup(e)?(0,l.CHAT_JID)(e):a.DROP_ATTR,type:"set",xmlns:"w:profile:picture",id:(0,a.generateId)()},t?(0,a.wap)("picture",{type:"image"},t):null),u);return r.success?{id:r.result.id}:Promise.reject(new c.ServerStatusCodeError(r.errorCode,r.errorText))}))).apply(this,arguments)}},80079:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TokenType=void 0,t.setPrivacyTokens=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(39410),c=r(77591);const d=new s.WapParser("setPrivacyTokensParser",(e=>({stanzaId:e.attrString("id")}))),u=r(54302)({TrustedContact:"trusted_contact"});function p(){return(p=(0,i.default)((function*(e,t,r){const n=t.map((t=>(0,a.wap)("token",{jid:(0,l.USER_JID)(e),t:(0,a.CUSTOM_STRING)(String(r)),type:(0,a.CUSTOM_STRING)(t)}))),i=yield(0,o.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"privacy",id:(0,a.generateId)()},(0,a.wap)("tokens",null,n)),d);if(!i.success)throw new c.ServerStatusCodeError(i.errorCode,i.errorText)}))).apply(this,arguments)}t.TokenType=u},45723:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,n.wap)("presence",{name:(0,n.MAYBE_CUSTOM_STRING)(e)}))};var n=r(31914),i=r(24747)},35065:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(97197),s=r(92844),o=r(97245),l=r(24747),c=n(r(11339));function d(e){const{result:t,overallStartTime:r,retryStartTime:n,retryAttemptsLeft:i}=e,a=function(e){switch(e){case"success":return c.default.SIGN_CREDENTIAL_RESULT.SUCCESS;case"bad-request":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_BAD_REQUEST;case"internal-server-error":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_SERVER;case"disconnected":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_CLIENT_NETWORK;default:return c.default.SIGN_CREDENTIAL_RESULT.ERROR_OTHER}}(t);new c.default.SignCredential({signCredentialResult:a,overallT:(0,s.monotonicTimeSince)(r),signCredentialT:(0,s.monotonicTimeSince)(n),retryCount:3-i,waConnectedToChatd:"disconnected"!==t,applicationState:"visible"===document.visibilityState?c.default.APPLICATION_STATE.FOREGROUND:c.default.APPLICATION_STATE.BACKGROUND}).commit()}const u=new a.Semaphore(1);function p(){return(p=(0,i.default)((function*(){const e=yield u.acquire();try{const{result:t,metric:r}=yield(0,o.getToken)(l.sendIqWithoutRetry);return null!=r&&d(r),t||__LOG__(3)`Couldn't get a private stats token`,t}finally{e.release()}}))).apply(this,arguments)}},13176:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747);const l=new s.WapParser("uploadStats",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`fieldStatsUpload: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`fieldStatsUpload: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function c(){return(c=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:stats",id:(0,a.generateId)()},(0,a.wap)("add",{t:(0,a.INT)(t)},e));__LOG__(2)`fieldStatsUpload:sendIq start`;const n=yield(0,o.sendIq)(r,l);if(__LOG__(2)`fieldStatsUpload:sendIq end`,!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`fieldStatsUpload: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},66837:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getContactSyncRefreshSeconds=function(){var e;const t=null!==(e=(0,a.default)(l.default,"localStorage").getItem(u.default.KEY_CONTACT_SYNC_REFRESH))&&void 0!==e?e:86400;return parseInt(t,10)},t.runSyncDirtyContactsJob=function(){(0,d.getShouldCheckContactSyncStatus)()&&setTimeout((function(){!function(){_.apply(this,arguments)}()}),6e4);(0,d.setShouldCheckContactSyncStatus)()},t.syncNewContact=function(e){f.push(e),h?h.debounce(1e3):(h=new s.ShiftTimer((()=>{if(!(0,d.isRegistered)())return;const e=f;f=[],h=null,__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start new contact sync for ${e.length} contacts`,(0,o.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0}).catch((e=>{__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}))})),h.onOrBefore(2e4))};var i=n(r(48926)),a=n(r(45095)),s=r(57319),o=r(33192),l=n(r(92417)),c=r(76214),d=r(58052),u=n(r(75509)),p=r(58021);let h=null,f=[];function _(){return(_=(0,i.default)((function*(){const e=(yield(0,c.getContactTable)().equals(["isContactSyncCompleted"],0)).map((e=>(0,p.createWid)(e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync dirty contacts, found ${e.length} contacts to sync`,(0,o.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0})}))).apply(this,arguments)}},99684:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryTosState=function(){return d.apply(this,arguments)},t.resetTosState=function(){return u.apply(this,arguments)},t.updateTosState=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(77591);const c=new s.WapParser("tosNotices",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("tos"),r={refresh:t.attrInt("refresh"),notice:[]};return t.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),n=e.attrString("id");r.notice.push({id:n,state:t})})),(r.refresh>259200||r.refresh<7200)&&(r.refresh=86400),r}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"get",to:a.S_WHATSAPP_NET},(0,a.wap)("request",null,e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)}))))),r=yield(0,o.sendIq)(t,c);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode,r.errorText)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=new s.WapParser("tosNoticesSet",(()=>{})),r=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"set",to:a.S_WHATSAPP_NET},(0,a.wap)("request",{type:"session_update"},e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)})))));yield(0,o.sendIq)(r,t)}))).apply(this,arguments)}},14892:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unpairDevice=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(24747),l=r(99234),c=r(39410);const d=new s.WapParser("unpairResponse",(e=>{e.assertTag("iq"),e.assertFromServer();let t=200;return"error"===e.attrString("type")&&(t=e.child("error").attrInt("code")),{status:t}}));function u(){return(u=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",id:(0,a.generateId)(),xmlns:"md"},(0,a.wap)("remove-companion-device",{jid:(0,c.DEVICE_JID)((0,l.assertGetMe)()),reason:(0,a.CUSTOM_STRING)(e)})),r=yield(0,o.sendIq)(t,d);return r.success?{status:r.result.status}:{status:r.errorCode}}))).apply(this,arguments)}},46669:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadPreKeys=function(){const e=new a.PromiseRetryLoop({name:"uploadPreKeys",timer:m,code:e=>(0,i.default)((function*(){__LOG__(2)`uploadPreKeys: running`;!0===(yield function(){return _.apply(this,arguments)}()).success?e():__LOG__(2)`uploadPreKeys: retrying (after delay)`}))()});return e.start(),e.promise()};var i=n(r(48926)),a=r(72287),s=r(31914),o=r(71914),l=r(24747),c=n(r(69618)),d=r(58425),u=r(11849),p=r(91335);const h={error:!1,result:!0},f=new o.WapParser("uploadPreKeyResParser",(e=>{e.assertTag("iq"),e.assertFromServer();if(e.attrEnum("type",h))return{success:!0};{const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.hasAttr("text")?t.attrString("text"):""}}}));function _(){return(_=(0,i.default)((function*(){const[e,t]=yield Promise.all([u.waSignalStore.getRegistrationInfo(),u.waSignalStore.getSignedPreKey()]);if(!e||!t)throw new Error("No signal info is available");const{registrationId:r,identityKeyPair:n}=e,[i,a]=yield u.waSignalStore.getOrGenPreKeys(30,d.generatePreKeyPair).then((e=>{if(0===e.length)throw new Error("No preKey is available");return[(0,s.wap)("iq",{id:(0,s.generateId)(),xmlns:"encrypt",type:"set",to:s.S_WHATSAPP_NET},(0,s.wap)("registration",null,(0,s.BIG_ENDIAN_CONTENT)(r)),(0,s.wap)("type",null,c.default.KEY_BUNDLE_TYPE),(0,s.wap)("identity",null,n.pubKey),(0,s.wap)("list",null,e.map(p.xmppPreKey)),(0,p.xmppSignedPreKey)(t)),e[e.length-1].keyId]}));try{const e=yield(0,l.waitForConnection)().then((()=>u.waSignalStore.markKeyAsUploaded(a))).then((()=>(0,l.sendIqWithoutRetry)(i,f)));if(e.success)return u.waSignalStore.setServerHasPreKeys(!0),{success:!0};const t=e.errorCode;return t>=500?__LOG__(3)`_uploadPreKeys: server requested backoff ${t}`:406===t?__LOG__(3)`_uploadPreKeys: uploaded invalid keys`:__LOG__(3)`_uploadPreKeys: unrecognized error ${t}`,{errorCode:e.errorCode,errorText:e.errorText}}catch(e){return void __LOG__(3)`_uploadPreKeys: disconnected, unclear if on server`}}))).apply(this,arguments)}const m={algo:{type:"fibonacci",first:1e3,second:2e3},max:61e4}},15746:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._waitForMainStream=t._online=void 0,t.handleMessage=function(){return h.apply(this,arguments)},t.waitForOfflineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return e?p.chatQueue.wait(e):p.allChatQueue.wait()},t.waitForOnlineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return e?u.chatQueue.wait(e):u.allChatQueue.wait()};var i=n(r(48926)),a=r(27870),s=r(38284),o=r(88102),l=r(28237);const c=2e4,d=new Promise((e=>{o.Cmd.on("main_stream_mode_ready",(()=>{e()}))}));t._waitForMainStream=d;const u={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};t._online=u;const p={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};function h(){return(h=(0,i.default)((function*(e,t,r){return t&&!l.OfflineMessageHandler.isResumeFromRestartComplete()?p.allChatQueue.enqueue((()=>p.chatQueue.enqueue(e,(()=>(0,s.promiseTimeout)(r(),c))))):(yield d,u.allChatQueue.enqueue((()=>u.chatQueue.enqueue(e,(()=>(0,s.promiseTimeout)(r(),c))))))}))).apply(this,arguments)}},26775:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);t.Z=function(){return A.apply(this,arguments)};var a=i(r(48926)),s=r(31914),o=r(24863),l=r(58853),c=r(24747),d=i(r(69618)),u=r(7293),p=r(45033),h=r(97398),f=r(52083),_=r(15860),m=r(95547),g=n(r(77605)),y=n(r(45473)),E=r(39410),S=i(r(39546)),v=r(58021);const{VOIP_LOG_COLOR:T}=d.default;function A(){return(A=(0,a.default)((function*(e,t){const r=e.common,n=(0,v.createWid)(r.peer_jid);if(S.default.isGroupCall(n))return C((0,s.CUSTOM_STRING)(r.peer_jid),n,e);try{return C(yield P(e,n,t),n,e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Failed to encrypt and send msg`}}))).apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e,t,r){const n=(0,E.voipXmlToWapNode)(r.payload),i=(0,_.newTag)(),a=(0,s.wap)("call",{to:e,id:(0,s.CUSTOM_STRING)(i)},n);yield(0,f.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const o=yield(0,c.sendStanzaAndReturnAck)(a,{id:i,class:"call",from:t,participant:null});return{payload:(0,E.wapNodeToVoipXml)(o),status:200}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t,r){const n=e.payload[2].findIndex((e=>"destination"===e[0])),i=e.payload[2][n];if(i){e.payload[0]!==y.TYPE_STR.OFFER&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("call offer check"));const r=i[2].map((e=>(0,v.createDeviceWidFromUserAndDevice)(e[1].jid.user,e[1].jid.device)));try{yield(0,h.ensureE2ESessions)(r)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Could not establish E2E session with all deviceWids`}let n=!1,s=!1;return yield Promise.all(i[2].map(function(){var t=(0,a.default)((function*(t,i){if(O(t[2])){const a=D(t[2]),o=r[i];try{const{encNode:r,shouldHaveIdentity:n}=yield N(a,o,R(e.payload[2]));s=s||n,w(t[2],r)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Signal encryption failed for ${o.toString()}, ${e}`,n=!0}}}));return function(){return t.apply(this,arguments)}}())),n?(__LOG__(3)`voip:encryptMsgCallKey: Removing all enc nodes due to encryption failure`,i[2].forEach((e=>I(e)))):s&&(yield k(e.payload[2])),(0,E.USER_JID)(t)}{if(!O(e.payload[2]))return(0,E.DEVICE_JID)(t);try{const e=[t];if(t.isCompanion()){const r=(0,v.createDeviceWidFromUserAndDevice)(t.user,d.default.DEVICE.PRIMARY_DEVICE);e.unshift(r)}yield(0,h.ensureE2ESessions)(e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Could not establish E2E session with deviceWid`}const n=D(e.payload[2]);let i,a;try{const r=yield N(n,t,R(e.payload[2]));i=r.encNode,a=r.shouldHaveIdentity}catch(e){if(r!==y.TYPE.OFFER)throw e;i=null,a=!1,__LOG__(3)`voip:encryptAndSendSignalingMsg: Sending offer without enc`}return w(e.payload[2],i),a&&(yield k(e.payload[2])),(0,E.DEVICE_JID)(t)}}))).apply(this,arguments)}function O(e){if(null==e)return!1;return e.findIndex((e=>"enc"===e[0]))>=0}function I(e){if(null==e)return;const t=e.findIndex((e=>"enc"===e[0]));e.splice(t,1)}function w(e,t){const r=e.findIndex((e=>"enc"===e[0]));r>=0&&(e[r]=t)}function R(e){var t;const r=e.find((e=>"enc"===e[0])),n=null==r||null===(t=r[1])||void 0===t?void 0:t.count;return null!=n?n:0}function D(e){const t=e.find((e=>"enc"===e[0])),r=null==t?void 0:t[2];return{call:{callKey:new Uint8Array(r)}}}function N(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e,t,r){const{type:n,ciphertext:i}=yield g.Cipher.encryptSignalProto(t,(0,m.encodeAndPad)(e));return{encNode:(0,s.wap)("enc",{v:(0,s.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,s.CUSTOM_STRING)(n),count:(0,s.INT)(r)},i),shouldHaveIdentity:n===p.CiphertextType.Pkmsg}}))).apply(this,arguments)}function k(){return G.apply(this,arguments)}function G(){return(G=(0,a.default)((function*(e){if(u.GK.supportsFeature(u.GK.F.MD_ADV)){const t=yield(0,o.getADVEncodedIdentity)();e.push((0,s.wap)("device-identity",null,t))}}))).apply(this,arguments)}},77723:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(55253),s=r(11849);function o(){return(o=(0,i.default)((function*(e){var t;const r=yield s.waSignalStore.getRegistrationInfo();if(!r)throw Error("No registration info found");const{identityKeyPair:n}=r,i=null!==(t=e[1]&&parseInt(e[1].count,10))&&void 0!==t?t:0,o=yield(0,a.prepareKeysForRetry)(i,n);return o&&e[2]&&Array.isArray(e[2])&&e[2].push(o),e}))).apply(this,arguments)}},25662:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(24747),o=r(97398),l=r(15860),c=r(39410),d=r(58021);function u(){return(u=(0,i.default)((function*(e){const t=e.common,r=(0,d.createWid)(t.peer_jid);let n,i;r.isGroupCall()?(n=(0,c.GROUP_CALL_JID)(r),i=Promise.resolve()):(n=(0,c.DEVICE_JID)(r),i=(0,o.ensureE2ESessions)([r])),yield i;const u=(0,c.voipXmlToWapNode)(e.payload),p=(0,l.newTag)(),h=(0,a.wap)("call",{to:n,id:(0,a.CUSTOM_STRING)(p)},u),f=yield(0,s.sendStanzaAndReturnAck)(h,{id:p,class:"call",from:r,participant:null});return{payload:(0,c.wapNodeToVoipXml)(f),status:200}}))).apply(this,arguments)}},64254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(24747),o=r(11849),l=r(45473),c=r(39410);function d(){return(d=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=yield o.waSignalStore.getRegistrationInfo();if(!n)throw Error("No registration info found");const i=(0,a.wap)("receipt",{to:(0,c.DEVICE_JID)(t.peer_jid),id:(0,a.CUSTOM_STRING)(e),type:(0,a.CUSTOM_STRING)(l.ENC_RETRY_RECEIPT_ATTRS.GROUP_CALL)},(0,a.wap)("enc_rekey",{"call-creator":(0,c.DEVICE_JID)(t.call_creator),"call-id":(0,a.CUSTOM_STRING)(t.call_id),count:(0,a.INT)(r+1)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(n.registrationId)));(0,s.castStanza)(i)}))).apply(this,arguments)}},84590:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return y.apply(this,arguments)};var a=i(r(48926)),s=r(50796),o=i(r(45095)),l=r(84902),c=i(r(41143)),d=r(45763),u=i(r(69618)),p=r(24808),h=r(8001),f=n(r(77605)),_=r(49714),m=r(45033),g=r(93832);function y(){return(y=(0,a.default)((function*(e,t){var r;const n=t.payload[2]&&t.payload[2].find((e=>"enc"===e[0])),i=e.peer_jid;if(!n||!i)return{result:_.E2EProcessResult.SUCCESS};let a=0;(null===(r=n[1])||void 0===r?void 0:r.count)&&(a=parseInt(n[1].count,10)||0);const s={e2eType:n[1].type,mediaType:null,ciphertext:new Uint8Array(n[2]),retryCount:a,hideFail:!1};try{const e=t.payload[2].find((e=>"device-identity"===e[0]));if(null!=i.device&&i.device!==u.default.DEVICE.PRIMARY_DEVICE&&s.e2eType===m.CiphertextType.Pkmsg&&!e)return __LOG__(2)`voip:validateAndDecryptEnc: expected device-identity with pkmsg enc`,{result:_.E2EProcessResult.PARSE_ERROR};if(e){const t=new Uint8Array(e[2]);if(!(yield(0,d.validateADVwithEncs)(i,t,[s])))return{result:_.E2EProcessResult.PARSE_ERROR};__LOG__(2)`voip:validateAndDecryptEnc: successfully validated ADV device-identity`}const{result:r,decrypted:l}=yield E(s,i);return r===_.E2EProcessResult.SUCCESS&&(n[2]=Array.prototype.slice.call(new Uint8Array((0,o.default)(l,"decrypted")))),{result:r,retryCount:a}}catch(e){return __LOG__(3)`voip:validateAndDecryptEnc error`,{result:_.E2EProcessResult.PARSE_ERROR}}}))).apply(this,arguments)}function E(e,t){return(0,c.default)(e.e2eType!==m.CiphertextType.Skmsg,"VoIP enc type should not be skmsg"),f.Cipher.decryptSignalProto(t,e.e2eType,e.ciphertext).then((e=>{var t;const r=(0,g.unpad)(e),n=(0,l.decodeProtobuf)(p.MessageSpec,r);return(null===(t=n.call)||void 0===t?void 0:t.callKey)?{result:_.E2EProcessResult.SUCCESS,decrypted:n.call.callKey}:{result:_.E2EProcessResult.PARSE_ERROR}})).catch((0,s.filteredCatch)(h.SignalDecryptionError,(e=>(__LOG__(3)`voip:decryptSignalProto failed with decryption error; ${e}`,{result:_.E2EProcessResult.RETRY})))).catch((e=>(__LOG__(3)`voip:decryptSignalProto failed with unexpected error; ${e}`,{result:_.E2EProcessResult.PARSE_ERROR})))}},4182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=t.CONTACT_SYNC_CHUNK_SIZE=void 0;t.CONTACT_SYNC_CHUNK_SIZE=500;t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=20},33192:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactList=b,t.syncContactListInChunks=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(19797),s=n(r(45095)),o=r(13959),l=r(92844),c=r(4182),d=r(91036),u=r(9108),p=r(53379),h=r(54181),f=r(10435),_=n(r(92417)),m=r(76214),g=n(r(75509)),y=r(53686),E=r(46133),S=r(79942),v=r(52284),T=r(92027),A=r(58021);function C(){return(C=(0,i.default)((function*(e){let{contactIds:t,shouldDelayBetweenChunks:r}=e;const n=c.CONTACT_SYNC_CHUNK_SIZE;__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${t.length} contacts in ${Math.ceil(t.length/n)} chunks, each chunk size: ${n}`;for(let e=0;e<t.length;e+=n){const i=t.slice(e,e+n);r&&(yield(0,o.delayMs)(1e3*c.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS)),yield b({contactIds:i,shouldSyncDevice:!0})}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){let{contactIds:t,shouldSyncDevice:r}=e;if(0===t.length)return;const n=yield G(t),i=(new v.USyncQuery).withContext("background").withMode("full").withBusinessProtocol().withStatusProtocol().withPictureProtocol();r&&i.withDeviceProtocol(),(0,f.isDisappearingModeEnabled)()&&i.withDisappearingModeProtocol(),n.forEach((e=>{i.withUser((new S.USyncUser).withId(e.id).withDeviceHash(String(e.hash)))}));let a=null,s=3,l=10*Math.random();for(;s-- >0;)try{a=yield i.execute();const e=a.error.all;var c;if(e)throw l=null!==(c=e.errorBackoff)&&void 0!==c?c:10*Math.random(),new Error(`syncContactList: error ${e.errorCode}: ${e.errorText}`);s=0}catch(e){0===s&&(__LOG__(4,!0,new Error,!0)`failed to execute usync query`,SEND_LOGS("failed to execute usync query: "+e)),yield(0,o.delayMs)(1e3*l)}if(null==a||a.error.all)return;const d=a.refresh,u=[];for(const e of Object.keys(d))u.push(d[e]);if(u.length>0){F(Math.min(...u))}yield Promise.all([r?L(a):Promise.resolve(),(0,f.isDisappearingModeEnabled)()?O(a):Promise.resolve(),M(a),w(a),D(a)]),yield N(t)}))).apply(this,arguments)}function M(e){const t=e.error.status;t?__LOG__(3)`handleSyncStatus: failed ${t.errorCode} : ${t.errorText}`:e.list.map((e=>{const t=E.StatusCollection.get(e.id);t&&e.status&&t.set({status:e.status})}))}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const t=e.error.status;t?__LOG__(3)`handleDisappearingMode: failed ${t.errorCode} : ${t.errorText}`:yield Promise.all(e.list.map(function(){var e=(0,i.default)((function*(e){e.disappearing_mode&&(yield(0,d.updateDisappearingMode)(e.id,e.disappearing_mode.duration,e.disappearing_mode.t))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=e.list.filter((e=>{let{business:t}=e;return Boolean(t)}));yield(0,T.handleVerifiedNameSync)(t.map((e=>{let{id:t,business:{verifiedName:r}}=e;return{id:t,verifiedName:r}})))}))).apply(this,arguments)}function D(e){const t=e.error.pictures;t&&__LOG__(3)`handleSyncProfilePictures: failed ${t.errorCode} : ${t.errorText}`}function N(e){const t=e.map((e=>({id:(0,a.toUserJid)(e.user),isContactSyncCompleted:1})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${t.length} contacts completed for contact sync`,(0,m.getContactTable)().bulkCreateOrMerge(t)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e){const t=e.error.devices;t&&__LOG__(3)`handleSyncDevice: error ${t.errorCode}: ${t.errorText}`;const r=e.list.filter((e=>e.devices&&null!=e.devices.deviceList&&null!=e.devices.keyIndex&&!("errorCode"in e.devices))).map((e=>({wid:e.id,devices:e.devices})));return __LOG__(2)`handleSyncDevice: skipping ${e.list.length-r.length} out of ${e.list.length} records`,yield(0,p.getAndStoreIdentityKeys)(r.map((e=>e.wid))),(0,h.handleADVDeviceSyncResult)(r)}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e){const t=e.map((e=>e.user)),r=(yield(0,u.getDeviceIds)(t)).map((e=>e?e.devices.map((t=>(0,A.createDeviceWidFromUserAndDevice)(e.id,t))):[])),n=yield Promise.all(r.map((e=>0===e.length?"":(0,y.phashV2)(e))));return e.map(((e,t)=>({id:e,hash:n[t]})))}))).apply(this,arguments)}function F(e){Number.isNaN(e)||e<=l.HOUR_SECONDS?__LOG__(3,void 0,void 0,void 0,["contact-sync"])`invalid contact sync refresh period: ${e}`:(__LOG__(2,void 0,void 0,void 0,["contact-sync"])`set contact sync refresh period: ${e}`,(0,s.default)(_.default,"localStorage").setItem(g.default.KEY_CONTACT_SYNC_REFRESH,String(e)))}},60764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_ALERT_TYPE=void 0;const n=r(54302)({LOW_QUOTA_EXCEEDED:"low_quota_exceed",HIGH_QUOTA_EXCEEDED:"high_quota_exceed",NO_ALERT:"no_alert"});t.STORAGE_ALERT_TYPE=n},46920:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_PARTICIPANT_TYPES=void 0;t.GROUP_PARTICIPANT_TYPES={superadmin:"superadmin",admin:"admin",participant:"participant"}},18615:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipants=function(){return u.apply(this,arguments)},t.demoteParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(o.PARTICIPANT_OPERATION.DEMOTE,t,r,n,i)},t.participantsAction=p,t.promoteParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(o.PARTICIPANT_OPERATION.PROMOTE,t,r,n,i)},t.removeParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(o.PARTICIPANT_OPERATION.REMOVE,t,r,n,i)},t.updateParticipants=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(64114),s=r(51727),o=r(70405),l=r(46308),c=r(58021);function d(){return(d=(0,i.default)((function*(e){let{group:t,participants:r,version:n,isOffline:i}=e;const a=[],o=[];r.forEach((e=>{e.isAdmin&&o.push(e.id),a.push(e.id)}));const l=yield h(a,i);return(0,s.replaceParticipants)({group:t,participants:a,admins:o,deviceIds:l,version:n})}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){let{group:t,participants:r,version:n,prevVersion:i,isOffline:a}=e;if(null==n)throw new Error("addParticipants: incoming change missing version id");const l=yield h(r,a);return(0,s.updateParticipants)(t,{action:o.PARTICIPANT_OPERATION.ADD,participants:r,deviceIds:l,version:n,prevVersion:i})}))).apply(this,arguments)}function p(e,t,r,n,i){return null==n?Promise.reject(new Error(`participantsAction with action = ${e}: incoming change missing version id`)):(0,s.updateParticipants)(t,{action:e,participants:r,version:n,prevVersion:i})}function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){let r=[];if(t)return yield(0,l.addUserToPendingDeviceSync)(e.map((e=>String(e)))),e;r=yield(0,a.syncAndGetDeviceList)(e);let n=[];return r.forEach(((t,r)=>{if(t){const{devices:e,id:r}=t;n=n.concat(e.map((e=>(0,c.createDeviceWidFromUserAndDevice)(r,e))))}else n.push(e[r])})),n}))).apply(this,arguments)}},2182:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDescription=f,t.parseGroupNode=_,t.queryGroup=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),s=r(31914),o=r(71914),l=r(24747),c=r(46920),d=r(85553),u=r(39410),p=r(77591),h=r(58021);function f(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent()){const r={desc:e.contentString(),descId:t.attrString("id")};return t.hasAttr("participant")&&(r.descOwner=(0,d.userJidToUserWid)(t.attrUserJid("participant"))),t.hasAttr("t")&&(r.descTime=t.attrTime("t")),r}}}return null}function _(e){var t,r;const n=f(e),i=function(e){const t={subject:e.attrString("subject")};return e.hasAttr("s_o")&&(t.subjectOwner=(0,d.userJidToUserWid)(e.attrUserJid("s_o"))),e.hasAttr("s_t")&&(t.subjectTime=e.attrTime("s_t")),t}(e),s=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(e),o=function(e){const t=e.maybeChild("growth_locked"),r=null==t?void 0:t.maybeAttrInt("expiration"),n=null==t?void 0:t.maybeAttrString("type");return null==r||null==n?null:{growthLockExpiration:r,growthLockType:n}}(e),l=function(e){const t=e.maybeChild("linked_parent"),r=null==t?void 0:t.maybeAttrGroupJid("jid");return null==r?null:{parentGroup:(0,d.groupJidToWid)(r)}}(e);let u;try{u=(0,h.createWid)(`${e.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=u)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");const p=e.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",c.GROUP_PARTICIPANT_TYPES,c.GROUP_PARTICIPANT_TYPES.participant);return{id:(0,d.userJidToUserWid)(e.attrUserJid("jid")),isSuperAdmin:t===c.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===c.GROUP_PARTICIPANT_TYPES.admin||t===c.GROUP_PARTICIPANT_TYPES.superadmin}})),_={id:u,owner:e.hasAttr("creator")?(0,d.userJidToUserWid)(e.attrUserJid("creator")):void 0,creation:e.attrTime("creation"),restrict:e.hasChild("locked"),announce:e.hasChild("announcement"),noFrequentlyForwarded:e.hasChild("no_frequently_forwarded"),participants:p,pvId:e.hasAttr("p_v_id")?e.attrInt("p_v_id"):void 0,support:e.hasChild("support"),size:e.hasAttr("size")?e.attrInt("size"):void 0,suspended:e.hasChild("suspended"),parent:null!==(r=e.hasChild("parent"))&&void 0!==r?r:void 0};return(0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)({},_),n),s),o),i),l)}const m=new o.WapParser("queryGroupParser",(e=>e.hasChild("group")?_(e.child("group")):{phashMatch:!0}));function g(){return(g=(0,i.default)((function*(e){const{groupWid:t,request:r,phash:n}=e,i=(0,s.wap)("iq",{to:(0,u.GROUP_JID)(t),type:"get",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("query",{request:r||s.DROP_ATTR,phash:(0,s.MAYBE_CUSTOM_STRING)(n)})),a=yield(0,l.sendIq)(i,m);if(a.success){const{result:e}=a;return e.phashMatch?Promise.reject(new Error("queryGroup: phash match case is not implemented!")):e}return __LOG__(2)`queryGroup failed: ${a.errorCode}:${a.errorType}`,Promise.reject(new p.ServerStatusCodeError(a.errorCode,a.errorText))}))).apply(this,arguments)}},45763:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.validateADVwithEncs=function(){return T.apply(this,arguments)},t.validateADVwithIdentityKey=S;var i=n(r(48926)),a=r(84902),s=n(r(41143)),o=r(24863),l=r(61438),c=r(11365),d=r(5087),u=r(7293),p=r(57701),h=r(54181),f=r(45033),_=n(r(76128)),m=r(52083),g=r(91335),y=r(93832),E=r(58021);function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!u.GK.supportsFeature(u.GK.F.MD_ADV))return!0;try{const i=(0,c.uint8ArrayToBuffer)(r),u=yield(0,m.getSignalProtocolStore)().loadIdentityKey((0,y.createSignalAddress)(e).toString());if(u){const e=(0,d.toCurveKeyPubKey)((0,y.strToBuffer)(u));if((0,y.bufferEqual)(e,i))return!0}const p=(0,a.decodeProtobuf)(l.ADVSignedDeviceIdentitySpec,t);(0,s.default)(null!=p,"advSignedDeviceIdentity should not be null");const f=yield _.default.loadIdentityKey((0,y.createSignalAddress)((0,E.toUserWid)(e)).toString()),g=f?(0,d.toCurveKeyPubKey)((0,y.strToBuffer)(f)):null;if(!(0,o.verifyDeviceIdentityAccountSignature)(p,i,g))return __LOG__(3)`validateADVIdentity: invalid account signature`,!1;if(!(0,o.verifyDeviceSignature)(p,i,g))return __LOG__(3)`validateADVIdentity: invalid device signature`,!1;const S=(0,a.decodeProtobuf)(l.ADVDeviceIdentitySpec,p.details);(0,s.default)(null!=S,"advDeviceIdentity should not be null");try{yield(0,h.handleADVDeviceUpdateForMessage)(e,S,g,p.accountSignatureKey,i,n)}catch(e){return __LOG__(3)`validateADVIdentity: process adv device identity failed`,!1}return __LOG__(2)`validateADVIdentity: successfully verified accountSignature and deviceSignature`,!0}catch(e){return __LOG__(3)`validateADVIdentity: failed`,!1}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!u.GK.supportsFeature(u.GK.F.MD_ADV))return!0;const i=r.find((e=>e.e2eType===f.CiphertextType.Pkmsg));if(!i)return!0;__LOG__(2)`validateADVwithEncs: start validate prekey msg `;try{(0,s.default)(null!=e,"author should not be null");const r=(0,g.extractIdentityKey)(i.ciphertext);(0,s.default)(null!=r,"identityKey should not be null");const a=yield S(e,t,new Uint8Array(r),n);return(0,p.identityStoreCacheEnabled)()&&(yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode()),a}catch(e){return __LOG__(3)`validateADVwithEncs: failed ${e}`,!1}}))).apply(this,arguments)}},18634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeIdentityHash=y,t.getICDCMeta=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=n(r(45095)),s=r(27764),o=r(92844),l=r(86945),c=n(r(69618)),d=r(5087),u=r(9108),p=r(99234),h=n(r(76128)),f=n(r(42810)),_=r(56592),m=r(58021);function g(){return(g=(0,i.default)((function*(e){if(!1===(0,l.getABPropConfigValue)("md_icdc_enabled"))return null;const t=yield(0,u.getDeviceRecord)(e.user);if(!t||t.deleted)return null;const r={keyHash:void 0,timestamp:void 0},{timestamp:n,devices:i}=t,s=i.some((e=>e.id!==c.default.DEVICE.PRIMARY_DEVICE));if(s){const n=i.map((e=>[e.keyIndex,(0,m.createDeviceWidFromUserAndDevice)(t.id,e.id)])),s=[],o=(0,p.assertGetMe)();let l=null;n.forEach((e=>{let[t,r]=e;r.equals(o)?l=t:s.push([t,r])}));const c=yield(0,_.getAllIdentityKeysBytes)(s.map((e=>{let[,t]=e;return t}))),u=[],f=[];if(c.forEach(((e,t)=>{null!=e&&(u.push(e),f.push(s[t][0]))})),o.user===e.user){const e=yield h.default.getIdentityKeyPair();if(!e)return null;u.push(new Uint8Array(e.pubKey)),f.push((0,a.default)(l,"myKeyIndex"))}const g=S();r.keyHash=yield y(u.map((e=>new Uint8Array((0,d.toCurveKeyPubKey)(e.buffer)))),g),f.length!==i.length&&(r.keyIndexes=f)}return(s||v(n))&&(r.timestamp=n),r}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){const r=(0,_.identityKeysToBinary)(e),n=yield f.default.digest({name:"SHA-256"},r),i=new Uint8Array(n);return(0,s.sliceBytes)(i,0,t)}))).apply(this,arguments)}function S(){const e=(0,l.getABPropConfigValue)("md_icdc_hash_length");return Math.max(e,8)}function v(e){return(0,o.unixTime)()-e<2592e3}},56592:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllIdentityKeysBytes=d,t.getAllIdentityKeysBytesOrThrow=function(){return c.apply(this,arguments)},t.identityKeysToBinary=function(e){const t=new a.Binary;return e.sort(l).forEach((e=>{t.writeByteArray(e)})),t.readByteArray()};var i=n(r(48926)),a=r(8584),s=n(r(76128)),o=r(93832);function l(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return e[r]-t[r];return e.length-t.length}function c(){return(c=(0,i.default)((function*(e){return(yield d(e)).map(((t,r)=>{if(null==t)throw new Error(`getAllIdentityKeys: missing identity key for device ${String(e[r])}`);return t}))}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){return(yield s.default.bulkLoadIdentityKey(e.map((e=>(0,o.createSignalAddress)(e).toString())))).map((e=>null==e?null:new Uint8Array((0,o.strToBuffer)(e))))}))).apply(this,arguments)}},76802:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RESEND_TIMEOUT_IN_SECONDS=void 0,t.createResendAbortMetric=function(e){return new f.default.MessageSend({e2eBackfill:!0,messageIsRevoke:e,messageSendResultIsTerminal:!1})},t.editAttribute=function(e,t){if(y(e)){const e="admin_revoke"===t?l.default.EDIT_ATTR.ADMIN_REVOKE:l.default.EDIT_ATTR.SENDER_REVOKE;return(0,a.CUSTOM_STRING)(String(e))}return a.DROP_ATTR},t.encodeAndPad=function(e){const t=(0,o.encodeProtobuf)(c.MessageSpec,e);return(0,m.writeRandomPadMax16)(t),t.readByteArray()},t.filterDeviceWithChangedIdentity=function(){return T.apply(this,arguments)},t.isPrimaryDevice=function(e){return null==e.device||e.device===l.default.DEVICE.PRIMARY_DEVICE},t.isRevokeMsg=y,t.populateICDCMeta=function(){return S.apply(this,arguments)},t.sendMsgAckSyncParser=void 0,t.updateIdentityRange=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(31914),s=r(71914),o=r(60980),l=n(r(69618)),c=r(24808),d=r(99234),u=r(6565),p=r(18634),h=r(90981),f=n(r(11339)),_=n(r(76128)),m=r(93832),g=r(58021);function y(e){return null!=e.protocolMessage&&e.protocolMessage.type===c.ProtocolMessageType.REVOKE}t.RESEND_TIMEOUT_IN_SECONDS=300;const E=new s.WapParser("sendMsgAckSyncParser",(e=>(e.assertTag("ack"),{t:e.attrTime("t"),sync:e.hasAttr("sync")?e.attrString("sync"):null,phash:e.hasAttr("phash")?e.attrString("phash"):null,count:e.hasAttr("count")?e.attrInt("count"):null})));function S(){return(S=(0,i.default)((function*(e,t){const r=(0,d.getMeUser)();let n,i;try{n=yield(0,p.getICDCMeta)(r)}catch(e){throw new f.default.AdvMetadataCreationFailure({advMetadataIsMe:!0}).commit(),e}try{i=e.equals(r)?null:yield(0,p.getICDCMeta)(e)}catch(e){throw new f.default.AdvMetadataCreationFailure({advMetadataIsMe:!1}).commit(),e}(0,u.populateMessageContextInfo)(t,n,i)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const r=yield(0,h.getTable)().get(String(e),!1);null!=(null==r?void 0:r.rowId)&&(yield _.default.updateIdentityRangeAfterEncryption(r.rowId,t.map((e=>(0,m.createSignalAddress)(e).toString()))))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const r=yield(0,h.getTable)().get(String(e),!1),n=null==r?void 0:r.rowId;if(null==n)return __LOG__(2)`filterDeviceWithChangedIdentity: get message with empty rowId`,[];const i=new Set;t.forEach((e=>{i.add(e.user)}));const a=Array.from(i).map((e=>(0,g.createDeviceWidFromUserAndDevice)(e,l.default.DEVICE.PRIMARY_DEVICE))),s=yield _.default.bulkGetIdentityRowId(a.map((e=>(0,m.createSignalAddress)(e).toString()))),o=new Set;return s.forEach(((e,t)=>{const r=a[t];(null==e||e>n)&&o.add(r.user)})),t.filter((e=>!o.has(e.user)))}))).apply(this,arguments)}t.sendMsgAckSyncParser=E},64114:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncAndGetDeviceList=function(){return S.apply(this,arguments)},t.syncDeviceList=_,t.syncMyDeviceList=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=n(r(94654)),s=r(9108),o=r(99234),l=r(53379),c=r(54181),d=r(53686),u=r(79942),p=r(52284),h=r(58021);const f=new Map;function _(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){let{wids:t,context:r,phash:n}=e;if(null!=n){const e=t.map((e=>e.user)),r=(yield(0,s.getDeviceIds)(e)).map((e=>e?e.devices.map((t=>(0,h.createDeviceWidFromUserAndDevice)(e.id,t))):[])),i=(0,a.default)(r,(e=>e));if(n===(yield(0,d.phashV2)(i)))return}const i=new Set,o=[];if(t.forEach((e=>{const t=f.get(e.user);t?i.add(t):o.push(e)})),0===o.length)return void(yield Promise.all([...i]));const l=g(o.map((e=>e.user)),o,r);o.map((e=>{f.set(e.user,l)})),yield Promise.all([l,...i])}))).apply(this,arguments)}function g(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r){try{const n=yield(0,s.getDeviceInfoForSync)(e),i=n.map((e=>e?e.devices.map((t=>(0,h.createDeviceWidFromUserAndDevice)(e.id,t))):[])),a=yield Promise.all(i.map((e=>0===e.length?"":(0,d.phashV2)(e))));return v(t.map(((e,t)=>{var r,i;return{id:e,hash:a[t],ts:null===(r=n[t])||void 0===r?void 0:r.timestamp,expectedTs:null===(i=n[t])||void 0===i?void 0:i.expectedTs}})),r)}catch(e){__LOG__(4,void 0,new Error)`Failed to sync device list with error: ${e}`}finally{t.map((e=>{f.delete(e.user)}))}}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){yield _({wids:[(0,o.getMeUser)()],context:null,phash:null})}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=e.map((e=>e.user));return yield _({wids:e,context:null,phash:null}),(0,s.getDeviceIds)(t)}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(0===e.length)return;const r=(new p.USyncQuery).withContext(t||"interactive").withDeviceProtocol();e.forEach((e=>{0!==e.id.user&&r.withUser((new u.USyncUser).withId(e.id).withDeviceHash(String(e.hash)).withTs(e.ts).withExpectedTs(e.expectedTs))}));const n=yield r.execute();if(n.error.all)throw new Error(`syncDeviceList: error ${n.error.all.errorCode}: ${n.error.all.errorText}`);n.error.devices&&__LOG__(3)`syncDeviceList: error ${n.error.devices.errorCode}: ${n.error.devices.errorText}`;let i=n.list.filter((e=>!("errorCode"in e.devices)));i=i.map((e=>({wid:e.id,devices:e.devices})));const a=i.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})).map((e=>e.wid));return __LOG__(2)`syncDeviceList: skipping ${n.list.length-a.length} out of ${n.list.length} records`,yield(0,l.getAndStoreIdentityKeys)(a),(0,c.handleADVDeviceSyncResult)(i)}))).apply(this,arguments)}},37039:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBuildHash=m,t.getClientPayloadForLogin=function(e){const t=(0,u.assertGetMe)(),r=(0,i.default)((0,i.default)({},_(e)),{},{username:parseInt(t.user,10),device:null!=t.device?t.device:0});return(0,s.encodeProtobuf)(f.ClientPayloadSpec,r).readByteArray()},t.getClientPayloadForRegistration=function(e,t,r){const n=m(),a=g(),o=(0,i.default)((0,i.default)({},_(r)),{},{regData:{buildHash:n,companionProps:a,eRegid:(0,l.intToBytes)(4,e.registrationId),eKeytype:(0,l.intToBytes)(1,5),eIdent:e.identityKeyPair.pubKey,eSkeyId:(0,l.intToBytes)(3,t.keyId),eSkeyVal:t.keyPair.pubKey,eSkeySig:t.signature}});return(0,s.encodeProtobuf)(f.ClientPayloadSpec,o).readByteArray()},t.getCompanionProps=g,t.getPlatformTypeFromName=E,t.getUserAgent=y,t.getWebSubPlatform=S;var i=n(r(81109)),a=r(15688),s=r(60980),o=n(r(87045)),l=r(11365),c=r(98263),d=n(r(69618)),u=r(99234),p=r(14111),h=n(r(64084)),f=r(84331);function _(e){return{passive:!!e&&e.passive,connectType:f.ClientPayloadConnectType.WIFI_UNKNOWN,connectReason:f.ClientPayloadConnectReason.USER_ACTIVATED,userAgent:y(),webInfo:{webSubPlatform:S()}}}function m(){const e=(0,a.decodeB64)((0,h.default)(d.default.VERSION_BASE));return new Uint8Array(e)}function g(){const e=o.default.info();let t;if(e.version&&""!==e.version){const r=e.version.split(".");r.length>0&&e.version&&/^[0-9\.]+$/.test(e.version)&&(t={primary:parseInt(r[0],10),secondary:r.length>1?parseInt(r[1],10):void 0,tertiary:r.length>2?parseInt(r[2],10):void 0})}const r={os:e.os,version:t,platformType:E(e.name),requireFullSync:!1};return(0,s.encodeProtobuf)(c.CompanionPropsSpec,r).readByteArray()}function y(){const e=p.deviceInfo.get(),t=f.UserAgentReleaseChannel.RELEASE;return{appVersion:{primary:d.default.VERSION.p,secondary:d.default.VERSION.s,tertiary:d.default.VERSION.t},platform:f.UserAgentPlatform.WEB,releaseChannel:t,mcc:e.mcc,mnc:e.mnc,osVersion:e.osVersion,manufacturer:e.manufacturer,device:e.device,osBuildNumber:e.osBuild,localeLanguageIso6391:e.lg,localeCountryIso31661Alpha2:e.lc}}function E(e){switch(e){case"Chrome":return c.CompanionPropsPlatformType.CHROME;case"Firefox":return c.CompanionPropsPlatformType.FIREFOX;case"IE":return c.CompanionPropsPlatformType.IE;case"Opera":return c.CompanionPropsPlatformType.OPERA;case"Safari":return c.CompanionPropsPlatformType.SAFARI;case"Edge":return c.CompanionPropsPlatformType.EDGE;case"electron":case"Desktop":return c.CompanionPropsPlatformType.DESKTOP;case"ipad":case"iPad":return c.CompanionPropsPlatformType.IPAD;case"tablet":case"Android tablet":return c.CompanionPropsPlatformType.ANDROID_TABLET;case"Ohana":return c.CompanionPropsPlatformType.OHANA;case"Aloha":return c.CompanionPropsPlatformType.ALOHA;case"Catalina":return c.CompanionPropsPlatformType.CATALINA;default:return c.CompanionPropsPlatformType.UNKNOWN}}function S(){switch(d.default.WAM_PLATFORM){case"WEB":return f.WebInfoWebSubPlatform.WEB_BROWSER;case"DARWIN":case"DARWIN_BETA":return f.WebInfoWebSubPlatform.DARWIN;case"WIN32":case"WIN32_BETA":return f.WebInfoWebSubPlatform.WIN32;case"MACSTORE":return f.WebInfoWebSubPlatform.APP_STORE;case"WINSTORE":return f.WebInfoWebSubPlatform.WIN_STORE;default:return}}},85726:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!(0,y.isRegistered)())return function(){return R.apply(this,arguments)}(e);return function(){return w.apply(this,arguments)}(e)};var a=i(r(48926)),s=r(15688),o=r(8584),l=r(17525),c=(r(87614),r(10095)),d=i(r(45095)),u=r(27498),p=r(84902),h=r(60980),f=r(37039),_=r(88102),m=n(r(5087)),g=r(14111),y=r(58052),E=r(11849),S=i(r(74976)),v=r(24774),T=r(78155),A=i(r(17072));const C=new Uint8Array([87,65,6,u.DICT_VERSION]),b="Noise_XX_25519_AESGCM_SHA256\0\0\0\0";let P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)((function*(){const e=(0,y.getRoutingInfo)(),t=e?e.edgeRouting:null;let r=t?(0,s.encodeB64UrlSafe)(t):null;const n=new S.default({routingToken:r}),i=m.keyPair(),[a,d,u]=yield(0,A.default)(n,"change:socket").cancellable().then((()=>n.socket)).finally((()=>{n.deactivate()})).then((e=>{let r;if(t){const e=new o.Binary;e.write("ED",0,1),e.writeUint8(t.byteLength>>16),e.writeUint16(65535&t.byteLength),e.writeBuffer(t),r=e.readByteArray()}const n=r?o.Binary.build(r,C).readByteArray():C,a=new l.FrameSocket(e,n);P=new c.NoiseHandshake(a),P.start(b,C),__LOG__(2)`openChatSocket send hello`,P.authenticate(i.pubKey);const s={clientHello:{ephemeral:i.pubKey}};return P.sendAndReceive((0,h.encodeProtobuf)(T.HandshakeMessageSpec,s).readByteArray())})).then((e=>I(P,e,i)));return __LOG__(2)`verifying certificate`,(0,v.verifyChainCertificateWA6)(d,a),u}))).apply(this,arguments)}function I(e,t,r){__LOG__(2)`openChatSocket rcv hello`;const{serverHello:n}=(0,p.decodeProtobuf)(T.HandshakeMessageSpec,t);if(!n)throw new Error("ServerHello payload error");const{ephemeral:i,static:a,payload:s}=n;if(null==i||null==a||null==s)throw new Error("Missing server Ephemeral");e.authenticate(i),e.mixIntoKey(m.sharedSecret(i,r.privKey));const o=e.decrypt(a),l=o.then((e=>m.sharedSecret(e,r.privKey)));return e.mixIntoKey(l),Promise.all([o,e.decrypt(s),i])}function w(){return(w=(0,a.default)((function*(e){try{const t=yield M().then(function(){var t=(0,a.default)((function*(t){_.Cmd.incrementProgress();const r=(0,d.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair,n=(0,f.getClientPayloadForLogin)(e);return Promise.all([D(r,P,t),P.encrypt(Promise.resolve(n))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,r]=e;return _.Cmd.incrementProgress(),P.send((0,h.encodeProtobuf)(T.HandshakeMessageSpec,{clientFinish:{static:t,payload:r}}).readByteArray()),P.finish()}));return _.Cmd.incrementProgress(),__LOG__(2)`openChatSocketForLogin success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForLogin error ${e}`}}))).apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e){try{const t=yield M().then((e=>Promise.all([E.waSignalStore.getRegistrationInfo(),E.waSignalStore.getSignedPreKey(),e]))).then(function(){var t=(0,a.default)((function*(t){let[r,n,i]=t;if(!n||!r)throw new Error("Invalid signal credentials");const a=(0,f.getClientPayloadForRegistration)(r,n,e),s=(0,d.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair;return Promise.all([D(s,P,i),P.encrypt(Promise.resolve(a))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,r]=e;return P.send((0,h.encodeProtobuf)(T.HandshakeMessageSpec,{clientFinish:{static:t,payload:r}}).readByteArray()),P.finish()}));return __LOG__(2)`openChatSocketForRegistration success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForRegistration error ${e}`}}))).apply(this,arguments)}function D(e,t,r){const n=Promise.resolve(e.pubKey),i=t.encrypt(n);if(!r)return Promise.reject(new Error("staticAgreement called before serverKeys"));const a=m.sharedSecret(r,e.privKey);return t.mixIntoKey(a),i}},24774:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.parseCertificateWA6=d,t.verifyCertificateWA6=u,t.verifyChainCertificateWA6=function(e,t){const r=(0,s.decodeProtobuf)(l.CertChainSpec,e);if(!r)throw new Error("verifyCertificateWA6 - Missing Certificate");const n=r.intermediate,a=r.leaf;if(null==n||null==a)throw new Error("verifyCertificateWA6 - Missing Leaf and/or Intermediate Certificate");__LOG__(2)`verifying intermediate certificate`;const o=d(n);if(u(o,c.PUBLIC_KEY),o.issuerSerial!==c.SERIAL)throw new Error("verifyChainCertificateWA6 intermediateCert was not issued by RootCA");__LOG__(2)`verifying leaf certificate`;const p=d(a);if(u(p,o.key),p.issuerSerial!==o.serial)throw new Error("verifyChainCertificateWA6 leafCert was not issued by IntermediateCert");if(!(0,i.areBuffersEqual)(p.key,t))throw new Error("verifyChainCertificateWA6 leafCert.key does not match handshake server.hello.static")};var i=r(7589),a=r(87614),s=r(84902),o=n(r(5087)),l=r(78155);const c={SERIAL:0,ISSUER:"WhatsAppLongTerm1",PUBLIC_KEY:(0,a.parseHex)("142375574d0a587166aae71ebe516437c4a28b73e3695c6ce1f7f9545da8ee6b")};function d(e){const t=e.details,r=e.signature;if(!t)throw new Error('parseCertificateWA6 certificate is missing "details"');if(!r)throw new Error('parseCertificateWA6 certificate is missing "signature"');const n=(0,s.decodeProtobuf)(l.DetailsSpec,t),{issuerSerial:i,serial:a,key:o,notAfter:c,notBefore:d}=n;if(null==i)throw new Error('parseCertificateWA6 certificate is missing "issuer_serial"');if(null==a)throw new Error('parseCertificateWA6 certificate is missing "serial"');if(null==o)throw new Error('parseCertificateWA6 certificate is missing "key"');return{serial:a,issuerSerial:i,key:o,notBefore:d,notAfter:c,details:t,signature:r}}function u(e,t){if(!o.verifySignature(new Uint8Array(t),new Uint8Array(e.details),new Uint8Array(e.signature)))throw new Error("verifyCertificateWA6 certificate is poorly signed!")}},6565:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceSentMessage=function(e,t){return{deviceSentMessage:{destinationJid:t.toString({legacy:!0}),message:e}}},t.createDisappearingMode=E,t.createMessageKey=function(e){return{remoteJid:P(e.to),fromMe:!0,id:e.id.id}},t.createMsgProtobuf=function(e,t){const r=function(e){const t=e.id,r=e.toJSON();delete r.status,delete r.mimetype,delete r.height,delete r.width,delete r.recipients,delete r.chat,delete r.broadcast,delete r.ack,delete r.invis,delete r.filehash,delete r.recvFresh,delete r.mediaData,_.URL.isHttp(e.clientUrl)||delete r.clientUrl;_.URL.isHttp(e.deprecatedMms3Url)||delete r.deprecatedMms3Url;for(const e in r)null==r[e]&&delete r[e];const n=o.default.get(t.remote);n&&(r.conversionTuple=n.serialize());return r}(e),n={};if(r.quotedMsg){const e=r.quotedMsg.mentionedJidList,t=Array.isArray(e)&&e.length>0?{mentionedJid:e.map(P)}:void 0;n.stanzaId=r.quotedStanzaID,n.remoteJid=P(r.quotedRemoteJid),n.participant=P(r.quotedParticipant),n.quotedMessage=C(r.quotedMsg,{duration:r.quotedMsg.duration,directPath:r.quotedMsg.directPath,encFilehash:r.quotedMsg.encFilehash,filehash:r.quotedMsg.filehash,height:r.quotedMsg.height,mediaKey:r.quotedMsg.mediaKey,mediaKeyTimestamp:(0,f.isNumber)(r.quotedMsg.mediaKeyTimestamp)?r.quotedMsg.mediaKeyTimestamp:void 0,mimetype:r.quotedMsg.mimetype,url:r.quotedMsg.clientUrl||r.quotedMsg.deprecatedMms3Url,width:r.quotedMsg.width},t)}else r.quotedRemoteJid&&r.quotedGroupSubject&&r.quotedParentGroupJid?(n.remoteJid=P(r.quotedRemoteJid),n.groupSubject=r.quotedGroupSubject,n.parentGroupJid=P(r.quotedParentGroupJid)):r.quotedRemoteJid&&(n.remoteJid=P(r.quotedRemoteJid));if(r.mentionedJidList&&r.mentionedJidList.length>0){const e=r.mentionedJidList;n.mentionedJid=e.map(P)}r.conversionTuple&&Object.assign(n,r.conversionTuple);r.isForwarded&&(n.isForwarded=r.isForwarded);r.forwardingScore&&(n.forwardingScore=r.forwardingScore);r.ephemeralDuration&&(n.expiration=r.ephemeralDuration);r.ephemeralSettingTimestamp&&(n.ephemeralSettingTimestamp=r.ephemeralSettingTimestamp);r.disappearingModeInitiator&&(n.disappearingMode=E(r.disappearingModeInitiator));r.ctwaContext&&(n.externalAdReply={sourceUrl:r.ctwaContext.sourceUrl,sourceId:r.ctwaContext.sourceId,sourceType:r.ctwaContext.sourceType,body:r.ctwaContext.description,title:r.ctwaContext.title,thumbnailUrl:r.ctwaContext.thumbnailUrl,thumbnail:r.ctwaContext.thumbnail?M(r.ctwaContext.thumbnail):void 0,mediaType:r.ctwaContext.mediaType,mediaUrl:r.ctwaContext.mediaUrl});return C(r,t,Object.keys(n).length>0?n:void 0)},t.createViewOnceFutureProofMessage=y,t.populateMessageContextInfo=function(e,t,r){if(!t&&!r)return;e.messageContextInfo={deviceListMetadata:{senderKeyHash:null==t?void 0:t.keyHash,senderTimestamp:null==t?void 0:t.timestamp,senderKeyIndexes:null==t?void 0:t.keyIndexes,recipientKeyHash:null==r?void 0:r.keyHash,recipientTimestamp:null==r?void 0:r.timestamp,recipientKeyIndexes:null==r?void 0:r.keyIndexes},deviceListMetadataVersion:2}};var i=n(r(81109)),a=r(15688),s=n(r(69618)),o=n(r(35667)),l=r(96751),c=r(24808),d=r(7293),u=r(34535),p=n(r(5165)),h=r(64551),f=r(31515),_=r(2541),m=r(93650),g=n(r(39546));function y(e){return{viewOnceMessage:{message:e}}}function E(e){let t;switch(e){case l.DisappearingModeInitiator.ChangedInChat:t=c.DisappearingModeInitiator.CHANGED_IN_CHAT;break;case l.DisappearingModeInitiator.InitiatedByMe:t=c.DisappearingModeInitiator.INITIATED_BY_ME;break;case l.DisappearingModeInitiator.InitiatedByOther:t=c.DisappearingModeInitiator.INITIATED_BY_OTHER}return{initiator:t}}function S(e,t,r){const{documentMessage:n,imageMessage:i,locationMessage:a,videoMessage:s}=e;if(t.isForwarded&&(n||i||a||s))return e;const o={buttons:!0===t.isForwarded?void 0:t.dynamicReplyButtons,footerText:t.footer,contextInfo:r};return n?(o.documentMessage=n,o.headerType=c.ButtonsMessageHeaderType.DOCUMENT,o.contentText=t.caption):i?(o.imageMessage=i,o.headerType=c.ButtonsMessageHeaderType.IMAGE,o.contentText=t.caption):a?(o.locationMessage=a,o.headerType=c.ButtonsMessageHeaderType.LOCATION,o.contentText=t.caption):s?(o.videoMessage=s,o.headerType=c.ButtonsMessageHeaderType.VIDEO,o.contentText=t.caption):t.title?(o.text=t.title,o.headerType=c.ButtonsMessageHeaderType.TEXT,o.contentText=t.body):(o.contentText=t.body,o.headerType=c.ButtonsMessageHeaderType.EMPTY),{buttonsMessage:o}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const i={url:t.url,mimetype:n,caption:e.caption,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,fileLength:(0,f.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,f.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:M(e.body),contextInfo:r,viewOnce:e.isViewOnce};return O(e.type,i),i}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=t.duration;i=(0,f.isString)(i)?parseInt(i,10):i;const a=e.type===s.default.MSG_TYPE.INTERACTIVE?void 0:e.caption,o={url:t.url,mimetype:n,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,seconds:i,caption:a,fileLength:(0,f.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,f.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:M(e.body),gifPlayback:e.isGif,gifAttribution:e.gifAttribution,contextInfo:r,streamingSidecar:e.streamingSidecar,viewOnce:e.isViewOnce};return O(e.type,o),o}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const i=e.type===s.default.MSG_TYPE.INTERACTIVE?void 0:e.caption,a={url:t.url,mimetype:n,title:i,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),fileName:t.filename,fileLength:(0,f.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,f.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:M(e.body),contextInfo:r,contactVcard:e.isVcardOverMmsDocument,thumbnailDirectPath:t.thumbnailDirectPath,thumbnailSha256:M(t.thumbnailSha256),thumbnailEncSha256:M(t.thumbnailEncSha256),thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth};return Number.isFinite(e.pageCount)&&!Number.isNaN(e.pageCount)&&(a.pageCount=e.pageCount),O(e.type,a),a}function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=n||{};const o=e.mimetype||t.mimetype||void 0;let l=t.duration;switch(e.type){case s.default.MSG_TYPE.CHAT:"url"===e.subtype||e.quotedMsg||e.quotedRemoteJid||Array.isArray(e.mentionedJidList)&&e.mentionedJidList.length>0||e.conversionTuple||e.isForwarded||e.forwardingScore||e._isPaymentNoteMsg||e.ephemeralDuration||e.ephemeralSettingTimestamp||e.ctwaContext?a.extendedTextMessage={text:e.body,matchedText:e.matchedText,canonicalUrl:e.canonicalUrl,description:e.description,title:e.title,jpegThumbnail:M(e.thumbnail),previewType:e.richPreviewType,contextInfo:r,mediaKey:M(e.mediaKey),mediaKeyTimestamp:(0,f.isNumber)(e.mediaKeyTimestamp)?e.mediaKeyTimestamp:void 0,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:M(e.thumbnailSha256),thumbnailEncSha256:M(e.thumbnailEncSha256),thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth}:a.conversation=e.body;break;case s.default.MSG_TYPE.GROUPS_V4_INVITE:a.groupInviteMessage={inviteCode:e.inviteCode,inviteExpiration:parseInt(e.inviteCodeExp,10),groupJid:e.inviteGrp,groupName:e.inviteGrpName,caption:e.comment,jpegThumbnail:M(e.inviteGrpJpegThum)};break;case s.default.MSG_TYPE.STICKER:if("image/webp"!==t.mimetype)throw __LOG__(3)`invalid sticker mimetype: ${t.mimetype}`,new Error("invalid sticker mimetype");a.stickerMessage={url:t.url,mimetype:t.mimetype,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,f.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,fileLength:(0,f.isNumber)(e.size)?e.size:void 0,height:e.height,width:e.width,firstFrameLength:t.firstFrameLength||void 0,firstFrameSidecar:e.firstFrameSidecar||void 0,isAnimated:t.isAnimated,contextInfo:r},O(e.type,a.stickerMessage);break;case s.default.MSG_TYPE.LOCATION:const n={degreesLatitude:parseFloat(e.lat)||void 0,degreesLongitude:parseFloat(e.lng)||void 0,jpegThumbnail:M(e.body),contextInfo:r};if(e.loc&&(0,f.isString)(e.loc)){const t=e.loc.split("\n");n.name=t[0],n.address=t[1],n.url=e.clientUrl}a.locationMessage=n;break;case s.default.MSG_TYPE.VCARD:a.contactMessage={displayName:e.vcardFormattedName,vcard:e.body,contextInfo:r};break;case s.default.MSG_TYPE.MULTI_VCARD:a.contactsArrayMessage={displayName:e.subtype,contacts:e.vcardList.map((e=>e)),contextInfo:r};break;case s.default.MSG_TYPE.IMAGE:a.imageMessage=v(e,t,r,o);break;case s.default.MSG_TYPE.PRODUCT:a.productMessage={product:{productImage:{url:t.url,mimetype:o,caption:e.caption,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,fileLength:(0,f.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,f.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:M(e.body)},productId:e.productId,title:e.title,description:e.description,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000||void 0,salePriceAmount1000:e.salePriceAmount1000||void 0,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount},businessOwnerJid:e.businessOwnerJid,contextInfo:r,body:e.caption,footer:e.footer};break;case s.default.MSG_TYPE.DOCUMENT:a.documentMessage=A(e,t,r,o);break;case s.default.MSG_TYPE.PTT:case s.default.MSG_TYPE.AUDIO:l=(0,f.isString)(l)?parseInt(l,10):l;const d={url:t.url,mimetype:o,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),seconds:l,ptt:"ptt"===e.type,fileLength:(0,f.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,f.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,contextInfo:r,streamingSidecar:e.streamingSidecar};h.ServerProps.pttWaveformSend&&e.waveform&&((0,m.validateWaveform)(e.waveform)?d.waveform=e.waveform.buffer:(__LOG__(4,void 0,new Error,!0)`Outgoing waveform with invalid size: ${e.waveform.byteLength}`,SEND_LOGS("outgoing-waveform-invalid-size"))),a.audioMessage=d,O(e.type?"ptt":"audio",a.audioMessage);break;case s.default.MSG_TYPE.VIDEO:a.videoMessage=T(e,t,r,o);break;case s.default.MSG_TYPE.PROTOCOL:let _;switch(e.subtype){case"admin_revoke":case"sender_revoke":_={key:b(e.protocolMessageKey),type:c.ProtocolMessageType.REVOKE};break;case"ephemeral_setting":_={type:c.ProtocolMessageType.EPHEMERAL_SETTING,ephemeralExpiration:e.ephemeralDuration};break;case"ephemeral_sync_response":_={type:c.ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE,ephemeralExpiration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingMode:E(e.disappearingModeInitiator)};break;case"app_state_sync_key_share":_={type:c.ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE,appStateSyncKeyShare:e.appStateSyncKeyShare};break;case"app_state_sync_key_request":_={type:c.ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST,appStateSyncKeyRequest:e.appStateSyncKeyRequest};break;case"app_state_fatal_exception_notification":_={type:c.ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION,appStateFatalExceptionNotification:e.appStateFatalExceptionNotification}}_&&(a.protocolMessage=_);break;case s.default.MSG_TYPE.INTERACTIVE:let g={};if((e.caption||e.nativeFlowName===p.default.ORDER_STATUS)&&(g={body:{text:e.caption}}),e.interactiveHeader){const n={title:e.interactiveHeader.title,subtitle:e.interactiveHeader.subtitle,hasMediaAttachment:e.interactiveHeader.hasMediaAttachment};if(e.interactiveHeader.thumbnail)n.jpegThumbnail=M(e.interactiveHeader.thumbnail);else if(e.interactiveHeader.mediaType)switch(e.interactiveHeader.mediaType){case u.InteractiveMessageHeaderMediaType.VIDEO:n.videoMessage=T(e,t,r,o);break;case u.InteractiveMessageHeaderMediaType.DOCUMENT:n.documentMessage=A(e,t,r,o);break;case u.InteractiveMessageHeaderMediaType.IMAGE:n.imageMessage=v(e,t,r,o)}g.header=n}e.footer&&(g.footer={text:e.footer});const y=(0,m.getInteractiveMessageFieldNameForType)(e.interactiveType);y&&(g[y]=e.interactivePayload),r&&(g.contextInfo=r),a.interactiveMessage=g;break;case s.default.MSG_TYPE.PAYMENT:const I={};I.stanzaId=e.quotedStanzaID,I.mentionedJid=e.mentionedJidList&&e.mentionedJidList.map(P),I.isForwarded=e.isForwarded,I.forwardingScore=e.forwardingScore,I.participant=P(e.quotedParticipant),e.quotedMsg&&(I.quotedMessage=C(e.quotedMsg));const w=e.paymentNoteMsg?C(Object.assign(e.paymentNoteMsg,{_isPaymentNoteMsg:!0}),I):void 0;switch(e.subtype){case"send":const t=e.paymentRequestMessageKey?{fromMe:e.paymentRequestMessageKey.fromMe,remoteJid:P(e.paymentRequestMessageKey.remote),id:e.paymentRequestMessageKey.id,participant:P(e.paymentRequestMessageKey.participant)}:void 0;a.sendPaymentMessage={requestMessageKey:t,noteMessage:w};break;case"request":a.requestPaymentMessage={amount1000:e.amount1000,expiryTimestamp:e._paymentExpiryTimestamp,requestFrom:e._paymentRequestFrom,currencyCodeIso4217:e._currencyCodeIso4217,noteMessage:w}}break;case s.default.MSG_TYPE.TEMPLATE_BUTTON_REPLY:a.templateButtonReplyMessage={selectedId:e.selectedId,selectedIndex:e.selectedIndex,selectedDisplayText:e.body,contextInfo:r};break;case"template":return"text"===e.subtype?(e.type="chat",e.title&&(e.body="*"+e.title+"*\n"+e.body)):e.type=e.subtype,C(e,t,r,a);case s.default.MSG_TYPE.LIST:a.listMessage=e.list,a.listMessage.contextInfo=r;break;case s.default.MSG_TYPE.LIST_RESPONSE:a.listResponseMessage=e.listResponse,a.listResponseMessage.contextInfo=r;break;case s.default.MSG_TYPE.BUTTONS_RESPONSE:a.buttonsResponseMessage=e.buttonsResponse,a.buttonsResponseMessage.contextInfo=r;break;case s.default.MSG_TYPE.ORDER:e.itemCount||e.message||e.orderId||e.orderTitle||e.sellerJid||e.status||e.surface||e.thumbnail||e.token||e.totalAmount1000||e.totalCurrencyCode?a.orderMessage={itemCount:e.itemCount,message:e.message,orderId:e.orderId,orderTitle:e.orderTitle,sellerJid:e.sellerJid,status:e.status,surface:e.surface,thumbnail:M(e.thumbnail),token:e.token,totalAmount1000:e.totalAmount1000,totalCurrencyCode:e.totalCurrencyCode}:a.conversation=e.body;break;case s.default.MSG_TYPE.NATIVE_FLOW:e.headerType===c.ButtonsMessageHeaderType.IMAGE&&(a.imageMessage=v(e,t,void 0,o)),a=S(a,e,r),a.buttonsMessage=(0,i.default)((0,i.default)({},a.buttonsMessage),{},{buttons:e.nativeFlowButtons});break;case s.default.MSG_TYPE.REACTION:a.reactionMessage={key:b(e.reactionParentKey),text:e.reactionText,senderTimestampMs:e.reactionTimestamp}}return!0===e.isDynamicReplyButtonsMsg&&(a=S(a,e,r)),e.isViewOnce&&(a=y(a)),a}function b(e){return{remoteJid:P(e.remote),fromMe:e.fromMe,id:e.id,participant:P(e.participant)}}function P(e){return e instanceof g.default?e.toString({legacy:!0}):(0,f.isString)(e)?e.replace(/@c.us$/,"@s.whatsapp.net"):void 0}function M(e){return e?(0,a.decodeB64)(e):void 0}function O(e,t){d.GK.supportsFeature(d.GK.F.LOG_OUTGOING_MSG_MISSING_REQUIRED_PROPERTIES)&&(t.viewOnce||(null==t.directPath&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-direct-path`)),null==t.fileSha256&&(__LOG__(2,void 0,void 0,!0)`fileSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-sha`)),null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-enc-sha`)),null==t.url&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-mms3-url`))))}},13493:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToTextWithoutSpecialEmojis=Ae,t.decodeBytes=Z,t.decodeJid=Q,t.decodeUrl=X,t.isValidReactionMessage=ve,t.parseAudioMessageProto=H,t.parseButtons=re,t.parseButtonsMessageProto=ye,t.parseButtonsResponseMessageProto=_e,t.parseCancelPaymentRequestMessageProto=ce,t.parseContactMessageProto=B,t.parseContactsArrayMessageProto=K,t.parseContextInfoProto=$,t.parseConversationProto=U,t.parseCtwaContextProto=z,t.parseDeclinePaymentRequestMessageProto=le,t.parseDeviceSentMessage=ee,t.parseDisappearingModeProto=Ee,t.parseDocumentMessageProto=W,t.parseEphemeralFutureProofMessageProto=ge,t.parseExtendedTextMessageProto=j,t.parseGroupInviteMessageProto=ue,t.parseImageMessageProto=F,t.parseInteractiveMessageProto=Se,t.parseListMessageProto=he,t.parseListResponseMessageProto=fe,t.parseLiveLocationMessageProto=ae,t.parseLocationMessageProto=Y,t.parseMsgProto=G,t.parseOrderMessageProto=pe,t.parsePaymentInviteMessageProto=de,t.parseProductMessageProto=ie,t.parseProtocolMessageProto=J,t.parseReactionMessageProto=Te,t.parseRequestPaymentMessageProto=oe,t.parseSendPaymentMessageProto=se,t.parseStickerMessageProto=x,t.parseTemplateButtonReplyMessage=ne,t.parseTemplateMessage=te,t.parseVideoMessageProto=V,t.parseViewOnceFutureProofMessageProto=me,t.validateRequiredMediaProperties=Ce;var a=i(r(81109)),s=i(r(88306)),o=r(15688),l=i(r(45095)),c=r(99140),d=r(22683),u=r(17239),p=i(r(69618)),h=r(96751),f=r(24808),_=r(70449),m=r(6303),g=r(99234),y=r(7293),E=r(57701),S=r(41796),v=r(34535),T=i(r(84064)),A=n(r(86688)),C=i(r(32219)),b=r(26287),P=i(r(5165)),M=i(r(75642)),O=r(64551),I=r(31515),w=r(2541),R=r(93650),D=r(21224),N=i(r(39546)),L=r(58021);const k=(0,s.default)((function(e){if((0,S.isConnectedToPage)())return w.URL.hostname(e);{if(!e)return"";const t=w.URL.isHttp(e)?e:"http://"+e;return new self.URL(t).hostname}}));function G(e,t,r,n,i,a,s,o){if(!e)return __LOG__(4,void 0,new Error,!0)`drop: not Message`,SEND_LOGS("null-message"),t;const{conversation:c,imageMessage:d,contactMessage:u,locationMessage:h,liveLocationMessage:f,extendedTextMessage:_,documentMessage:m,audioMessage:g,videoMessage:E,stickerMessage:S,contactsArrayMessage:v,sendPaymentMessage:T,requestPaymentMessage:A,productMessage:C,groupInviteMessage:b,viewOnceMessage:P,ephemeralMessage:M,orderMessage:w,listMessage:R,listResponseMessage:D,protocolMessage:N,declinePaymentRequestMessage:L,cancelPaymentRequestMessage:k,paymentInviteMessage:G,templateMessage:q,templateButtonReplyMessage:Q,buttonsResponseMessage:X,buttonsMessage:Z,interactiveMessage:re,reactionMessage:Ee}=e;let ve;var Ce,be,Pe,Me;((0,I.isString)(c)&&U(t,c),b&&ue(t,b),d&&(F(t,d),ve=d.contextInfo),S&&(x(t,S),ve=S.contextInfo),u&&(B(t,u),ve=u.contextInfo),v&&(K(t,v),ve=v.contextInfo),h&&(Y(t,h),ve=h.contextInfo),f&&(ae(t,f,i),ve=f.contextInfo),T)&&(ve=null===(Ce=T.noteMessage)||void 0===Ce||null===(be=Ce.extendedTextMessage)||void 0===be?void 0:be.contextInfo,se(t,T,n));A&&(ve=null===(Pe=A.noteMessage)||void 0===Pe||null===(Me=Pe.extendedTextMessage)||void 0===Me?void 0:Me.contextInfo,oe(t,A,n));if(L&&le(t,L),k&&ce(t,k),G&&de(t,G),_&&(j(t,_),ve=_.contextInfo),m&&(W(t,m),ve=m.contextInfo),g&&(H(t,g),ve=g.contextInfo),E&&(V(t,E),ve=E.contextInfo),N&&J(t,N,r,o),C&&(ie(t,C),ve=C.contextInfo),w&&(pe(t,w),ve=w.contextInfo),R&&(he(t,R),ve=R.contextInfo),D&&(fe(t,D),ve=D.contextInfo),P&&me(t,P),M&&ge(t,M),Z&&ye(t,Z,s),X&&(_e(t,X),ve=X.contextInfo),re&&(Se(t,re,s),ve=re.contextInfo),Ee&&Te(t,Ee),y.GK.supportsFeature(y.GK.F.MD_BACKEND)){const{deviceSentMessage:n,highlyStructuredMessage:i}=e;var Oe;if(n&&ee(t,n,r),i)t.type=p.default.MSG_TYPE.HSM,(null===(Oe=i.hydratedHsm)||void 0===Oe?void 0:Oe.hydratedTemplate)&&(t.body=Ae(i.hydratedHsm.hydratedTemplate.hydratedContentText))}return q&&(y.GK.supportsFeature(y.GK.F.MD_BACKEND)&&q.hydratedTemplate?te(t,q.hydratedTemplate):te(t,(0,l.default)(q.hydratedFourRowTemplate,"templateMessage.hydratedFourRowTemplate"))),Q&&(ne(t,Q),ve=Q.contextInfo,t.type=p.default.MSG_TYPE.TEMPLATE_BUTTON_REPLY),ve&&($(t,ve,a),ve.externalAdReply&&O.ServerProps.ctwaContextRender&&z(t,ve.externalAdReply)),t}function U(e,t){e.type=p.default.MSG_TYPE.CHAT,e.body=Ae(t)}function F(e,t){e.type=p.default.MSG_TYPE.IMAGE,e.deprecatedMms3Url=X(t.url),e.directPath=t.directPath||"",e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype||"",e.caption=Ae(t.caption),e.filehash=Z(t.fileSha256),e.encFilehash=Z(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height||0,e.width=t.width||0,e.mediaKey=Z(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:d.Clock.globalUnixTime(),e.body=Z(t.jpegThumbnail)||"",e.interactiveAnnotations=t.interactiveAnnotations,e.scanLengths=t.scanLengths,e.scansSidecar=t.scansSidecar,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=Z(t.thumbnailSha256),e.thumbnailEncSha256=Z(t.thumbnailEncSha256),Ce(e,t)}function x(e,t){e.type=p.default.MSG_TYPE.STICKER,e.deprecatedMms3Url=X(t.url),e.directPath=t.directPath||"",e.mimetype=t.mimetype||"",e.filehash=Z(t.fileSha256),e.encFilehash=Z(t.fileEncSha256),e.mediaKey=(0,M.default)(Z(t.mediaKey)),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:d.Clock.globalUnixTime(),e.height=t.height||0,e.width=t.width||0,e.firstFrameLength=t.firstFrameLength,e.firstFrameSidecar=t.firstFrameSidecar,e.isAnimated=t.isAnimated,Ce(e,t)}function B(e,t){e.type=p.default.MSG_TYPE.VCARD,e.vcardFormattedName=t.displayName,e.body=t.vcard}function K(e,t){const r=t.contacts;e.type=p.default.MSG_TYPE.MULTI_VCARD,e.vcardFormattedName=t.displayName,e.vcardList=Array.isArray(r)?r.map((e=>({displayName:e.displayName,vcard:e.vcard}))):[]}function Y(e,t){const r=t.name&&t.address?`${t.name}\n${t.address}`:t.name||t.address||"";e.type=p.default.MSG_TYPE.LOCATION,e.lat=void 0!==t.degreesLatitude?t.degreesLatitude:void 0,e.lng=void 0!==t.degreesLongitude?t.degreesLongitude:void 0,e.loc=r,e.body=Z(t.jpegThumbnail)||"",e.clientUrl=t.url}function j(e,t){const r=t.matchedText||t.canonicalUrl||t.description||t.title;if(r){const r=k(t.canonicalUrl||""),n=k(t.matchedText||"");e.canonicalUrl=r===n||""===r?t.canonicalUrl:n}e.type=p.default.MSG_TYPE.CHAT,e.subtype=r?"url":void 0,e.body=Ae(t.text||""),e.matchedText=t.matchedText,e.description=t.description,e.title=t.title,e.thumbnail=Z(t.jpegThumbnail)||"",e.richPreviewType=t.previewType,e.doNotPlayInline=t.doNotPlayInline,e.textColor=t.textArgb,e.backgroundColor=t.backgroundArgb,e.mediaKey=Z(t.mediaKey),e.mediaKeyTimestamp=t.mediaKeyTimestamp,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=Z(t.thumbnailSha256),e.thumbnailEncSha256=Z(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth;const n=f.ExtendedTextMessageFontType;if(null!=t.font)switch(t.font){case n.SANS_SERIF:case n.SERIF:case n.NORICAN_REGULAR:case n.BRYNDAN_WRITE:case n.BEBASNEUE_REGULAR:case n.OSWALD_HEAVY:e.font=t.font}}function W(e,t){e.type=p.default.MSG_TYPE.DOCUMENT,e.deprecatedMms3Url=X(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=Z(t.fileSha256),e.encFilehash=Z(t.fileEncSha256),e.size=t.fileLength||0,e.pageCount=t.pageCount||0,e.mediaKey=Z(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:d.Clock.globalUnixTime(),e.filename=(0,c.cleanIncomingFilename)(t.fileName||t.title),e.caption=e.filename,e.body=Z(t.jpegThumbnail)||"",e.isVcardOverMmsDocument=Boolean(t.contactVcard)&&e.size<=1024*O.ServerProps.vcardMaxSizeKb,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=Z(t.thumbnailSha256),e.thumbnailEncSha256=Z(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth,Ce(e,t)}function H(e,t){e.type=t.ptt?p.default.MSG_TYPE.PTT:p.default.MSG_TYPE.AUDIO,e.deprecatedMms3Url=X(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=Z(t.fileSha256),e.encFilehash=Z(t.fileEncSha256),e.size=t.fileLength||0,e.duration=`${t.seconds||0}`,e.mediaKey=Z(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:d.Clock.globalUnixTime(),e.streamingSidecar=t.streamingSidecar,e.waveform=t.waveform&&(0,R.validateWaveform)(t.waveform)?new Uint8Array(t.waveform):void 0,Ce(e,t)}function V(e,t){e.type=p.default.MSG_TYPE.VIDEO,e.deprecatedMms3Url=X(t.url),e.directPath=t.directPath,e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype,e.filehash=Z(t.fileSha256),e.encFilehash=Z(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height,e.width=t.width,e.duration=`${t.seconds||0}`,e.mediaKey=Z(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:d.Clock.globalUnixTime(),e.caption=Ae(t.caption),e.body=Z(t.jpegThumbnail)||"",e.isGif=t.gifPlayback,e.gifAttribution=t.gifAttribution,e.streamingSidecar=t.streamingSidecar,e.interactiveAnnotations=t.interactiveAnnotations,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=Z(t.thumbnailSha256),e.thumbnailEncSha256=Z(t.thumbnailEncSha256),Ce(e,t)}function $(e,t,r){const n=t.quotedMessage,i=t.mentionedJid;e.quotedMsg=n&&G(n,{type:p.default.MSG_TYPE.UNKNOWN}),e.quotedMsg&&"payment"===e.quotedMsg.type&&r&&__LOG__(2)`parseContextInfoProto: payment not supported`,e.quotedStanzaID=t.stanzaId,e.quotedParticipant=Q(t.participant),e.quotedRemoteJid=Q(t.remoteJid),e.quotedGroupSubject=Q(t.groupSubject),e.quotedParentGroupJid=Q(t.parentGroupJid),e.mentionedJidList=Array.isArray(i)?i.map(Q):i,e.isForwarded=t.isForwarded,e.forwardingScore=t.forwardingScore,null!=t.expiration&&(e.ephemeralDuration=t.expiration),null!=t.ephemeralSettingTimestamp&&(e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp),null!=t.ephemeralSharedSecret&&(e.ephemeralSharedSecret=t.ephemeralSharedSecret),null!=t.disappearingMode&&Ee(e,t.disappearingMode),null!=t.actionLink&&(e.actionLink=t.actionLink)}function z(e,t){const r=A.findLink(t.sourceUrl||"",!1,e.from);e.ctwaContext={sourceUrl:t.sourceUrl,description:t.body,title:t.title,thumbnail:t.thumbnail?Z(t.thumbnail):null,thumbnailUrl:t.thumbnailUrl,mediaType:t.mediaType,mediaUrl:t.mediaUrl,isSuspiciousLink:(null==r?void 0:r.suspiciousCharacters)&&r.suspiciousCharacters.size>0}}function q(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for protocol message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for protocol message");let n=null;return n=y.GK.supportsFeature(y.GK.F.MD_BACKEND)?function(e,t,r){var n;let i,a,s;if(null==r||null===(n=r.id)||void 0===n?void 0:n.fromMe)i=!!t.fromMe,s=Q(t.remoteJid),t.fromMe?s.isUser()||(a=(0,g.getMeUser)()):a=Q(t.participant);else if(s=r.id.remote,t.fromMe)i=!1,a=r.author;else{const e=Q(t.participant);e?e.equals((0,g.getMeUser)())?(i=!0,s.isUser()||(a=(0,g.getMeUser)())):(i=!1,s.isUser()||(a=e)):i=!0}return new C.default({id:e,fromMe:i,remote:s,participant:a})}(r,e,t):new C.default({id:r,fromMe:!!e.fromMe,remote:Q(e.remoteJid),participant:Q(e.participant)}),n}function J(e,t,r,n){if("relay"!==r&&t.type!==f.ProtocolMessageType.EPHEMERAL_SETTING)return;const{key:i,type:a}=t;let s=null;if(e.type=p.default.MSG_TYPE.PROTOCOL,null!=a)switch(a){case f.ProtocolMessageType.REVOKE:s=q(i,e),e.protocolMessageKey=s,e.subtype=n===p.default.EDIT_ATTR.ADMIN_REVOKE?"admin_revoke":"sender_revoke";break;case f.ProtocolMessageType.EPHEMERAL_SETTING:e.subtype="ephemeral_setting",e.ephemeralDuration=t.ephemeralExpiration;break;case f.ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE:e.subtype="ephemeral_sync_response",e.ephemeralDuration=t.ephemeralExpiration,e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp,null!=t.disappearingMode&&Ee(e,t.disappearingMode);break;case f.ProtocolMessageType.HISTORY_SYNC_NOTIFICATION:e.subtype="history_sync_notification";const{historySyncNotification:r}=t;if(r){const n={directPath:r.directPath,encFilehash:Z(r.fileEncSha256),filehash:Z(r.fileSha256),mediaKey:Z(r.mediaKey),type:"md-msg-hist"};e.historySyncMetaData={historySyncNotification:t.historySyncNotification,downloadOptions:n}}break;case f.ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST:case f.ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE:case f.ProtocolMessageType.MSG_FANOUT_BACKFILL_REQUEST:case f.ProtocolMessageType.INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:case f.ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION:e.subtype="unknown"}}function Q(e){return e&&N.default.isWid(e)?(0,L.createWid)(e):e}function X(e){return e&&!e.includes("/u/")?e:void 0}function Z(e){return e?(0,o.encodeB64)(e):void 0}function ee(e,t,r){const n=Q(t.destinationJid);e.id.remote=n,e.to=n,G(t.message,e,r)}function te(e,t){const{documentMessage:r,imageMessage:n,locationMessage:i,videoMessage:a}=t;e.isFromTemplate=!0,r?W(e,r):n?F(e,n):i?Y(e,i):a?V(e,a):(e.type=p.default.MSG_TYPE.CHAT,t.hydratedContentText&&(e.body=Ae(t.hydratedContentText))),t.hydratedButtons&&re(e,t),t.hydratedContentText&&(e.caption=Ae(t.hydratedContentText)),t.hydratedFooterText&&(e.footer=Ae(t.hydratedFooterText)),t.hydratedTitleText&&(e.title=Ae(t.hydratedTitleText))}function re(e,t){const{hydratedButtons:r}=t;r.length&&(e.hydratedButtons=r)}function ne(e,t){e.body=Ae(t.selectedDisplayText),e.selectedIndex=t.selectedIndex,e.selectedId=t.selectedId}function ie(e,t){const{product:r,body:n,footer:i}=t;r&&(r.productImage&&F(e,r.productImage),e.type=p.default.MSG_TYPE.PRODUCT,e.businessOwnerJid=t.businessOwnerJid,e.productId=r.productId,e.currencyCode=r.currencyCode,e.priceAmount1000=r.priceAmount1000,e.salePriceAmount1000=r.salePriceAmount1000,e.retailerId=r.retailerId,e.url=r.url,e.productImageCount=r.productImageCount,e.title=r.title,e.description=r.description,e.caption=n,e.footer=i)}function ae(e,t,r){e.type="location",e.isLive=!0,e.lat=t.degreesLatitude,e.lng=t.degreesLongitude,e.body=Z(t.jpegThumbnail)||"",e.accuracy=t.accuracyInMeters,e.speed=t.speedInMps,e.degrees=t.degreesClockwiseFromMagneticNorth,e.comment=Ae(t.caption),e.sequence=t.sequenceNumber,r&&(e.finalLat=r.degreesLatitude,e.finalLng=r.degreesLongitude,e.finalThumbnail=Z(r.jpegThumbnail)||"",e.finalAccuracy=r.accuracyInMeters,e.finalSpeed=r.speedInMps,e.finalDegrees=r.degreesClockwiseFromMagneticNorth,e.finalTimeOffset=r.timeOffset)}function se(e,t,r){if((null==r?void 0:r.futureproofed)||(0,R.hasUnsupportedCurrency)(r))e.type="unknown",e.subtype="phone_only_feature",__LOG__(2)`parseSendPaymentMessageProto: does not support novi transactions`;else{var n,i,a;e.type=p.default.MSG_TYPE.PAYMENT,e.subtype="send",t.background&&(e.paymentBackground=t.background),(null===(n=t.noteMessage)||void 0===n?void 0:n.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=G(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",(0,R.parseMsgPaymentInfo)(e,r);const s=t.requestMessageKey;s&&(e.paymentRequestMessageKey=function(e,t){if(!e)throw new Error("_getPaymentRequestMessageKey: no message key is defined");const{id:r}=e;if(!r)throw new Error("_getPaymentRequestMessageKey: no key id is defined");if(!t.id)return __LOG__(3)`_getPaymentRequestMessageKey: no message id is defined`,null;let n;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=Q(e.participant))||void 0===i?void 0:i.equals((0,g.getMeUser)()))&&"send"!==t.subtype)return null;n=Q(e.participant)}return new C.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:r,participant:n})}(s,e))}}function oe(e,t,r){if((null==r?void 0:r.futureproofed)||(0,R.hasUnsupportedCurrency)(r))e.subtype="phone_only_feature",__LOG__(2)`parseRequestPaymentMessageProto: does not support novi transactions`;else{var n,i,a;if(e.type=p.default.MSG_TYPE.PAYMENT,(0,R.parseMsgPaymentInfo)(e,r),e.subtype="request",t.background&&(e.paymentBackground=t.background),(null===(n=t.noteMessage)||void 0===n?void 0:n.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=G(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",null!=t.amount){if(t.amount.currencyCode&&!e.paymentCurrency&&(e.paymentCurrency=t.amount.currencyCode),null!=t.amount.value&&!e.paymentAmount1000){const r=t.amount,n=null==r.offset||0===r.offset?1e3:r.offset;e.paymentAmount1000=1e3*parseFloat(r.value)/n}}else t.currencyCodeIso4217&&!e.paymentCurrency&&(e.paymentCurrency=t.currencyCodeIso4217),null==t.amount1000||e.paymentAmount1000||(e.paymentAmount1000=t.amount1000);t.requestFrom&&!e.paymentMessageReceiverJid&&(e.paymentMessageReceiverJid=Q(t.requestFrom)),e.paymentStatus&&e.paymentTxnStatus||(0,R.isEitherSenderOrReceiverOfPaymentMessage)(e)&&(e.paymentStatus=D.PaymentInfoStatus.WAITING,e.paymentTxnStatus=D.PaymentInfoTxnStatus.COLLECT_INIT),null==t.expiryTimestamp||e.paymentExpiryTimestamp||(e.paymentExpiryTimestamp=t.expiryTimestamp)}}function le(e,t){const r=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for decline payment request message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for decline payment request message");let n;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=Q(e.participant))||void 0===i?void 0:i.equals((0,g.getMeUser)()))&&"send"!==t.subtype)return null;n=Q(e.participant)}return new C.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:r,participant:n})}(t.key,e);e.paymentRequestMessageKey=r,e.subtype="payment_action_request_declined"}function ce(e,t){const r=t.key;if(r){const t=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for cancel payment request message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for cancel payment request message");let n;var i;if(t.id.remote.isGroup())if(n=t.id.participant,t.id.fromMe)n=Q(t.author);else if(!(null===(i=Q(e.participant))||void 0===i?void 0:i.equals((0,g.getMeUser)())))return null;return new C.default({id:r,fromMe:t.id.fromMe,remote:t.id.remote,participant:n})}(r,e);e.paymentRequestMessageKey=t,e.subtype="payment_transaction_request_cancelled"}}function de(e,t){t.serviceType===f.PaymentInviteMessageServiceType.NOVI?(e.subtype="phone_only_feature",__LOG__(2)`[payment-invite] parsePaymentInviteMessageProto: does not support novi transactions`):(e.type=p.default.MSG_TYPE.PAYMENT,e.subtype="invite",e.paymentExpiryTimestamp=t.expiryTimestamp,e.paymentInviteServiceType=t.serviceType,__LOG__(2)`[payment-invite] render payment invite of type ${t.serviceType}`)}function ue(e,t){e.comment=t.caption,e.inviteCode=t.inviteCode,e.inviteCodeExp=t.inviteExpiration,e.inviteGrp=t.groupJid,e.inviteGrpName=t.groupName,e.type=p.default.MSG_TYPE.GROUPS_V4_INVITE}function pe(e,t){e.type=p.default.MSG_TYPE.ORDER,e.thumbnail=Z(t.thumbnail),e.message=t.message||"",e.orderId=t.orderId,e.itemCount=t.itemCount||0,e.status=t.status,e.surface=t.surface,e.sellerJid=t.sellerJid,e.orderTitle=t.orderTitle||"",e.token=t.token||"",e.totalAmount1000=t.totalAmount1000,e.totalCurrencyCode=t.totalCurrencyCode,e.body=""}function he(e,t){var r,n;O.ServerProps.webListMessage&&t.listType===f.ListMessageListType.SINGLE_SELECT||(0,E.productListMessagesEnabled)()&&t.listType===f.ListMessageListType.PRODUCT_LIST?(e.type=p.default.MSG_TYPE.LIST,e.list=t,e.footer=t.footerText,t.listType===f.ListMessageListType.PRODUCT_LIST&&(e.businessOwnerJid=null===(r=t.productListInfo)||void 0===r?void 0:r.businessOwnerJid,e.productListItemCount=null===(n=t.productListInfo)||void 0===n?void 0:n.productSections.reduce(((e,t)=>e+t.products.length),0))):(t.listType===f.ListMessageListType.PRODUCT_LIST&&(0,E.productListMessageFallbackEnabled)()&&(e.subtype="phone_only_feature"),e.type=p.default.MSG_TYPE.UNKNOWN)}function fe(e,t){if(O.ServerProps.webListMessage&&t.listType===f.ListResponseMessageListType.SINGLE_SELECT){e.type=p.default.MSG_TYPE.LIST_RESPONSE,e.listResponse=(0,a.default)((0,a.default)({},t),{},{contextInfo:void 0});let r=t.title||"";t.description&&(r+="\n"+t.description),e.body=Ae(r)}}function _e(e,t){let{selectedDisplayText:r,selectedButtonId:n,type:i}=t;(0,E.buttonsMessagesEnabled)()&&i===f.ButtonsResponseMessageType.DISPLAY_TEXT?(e.type=p.default.MSG_TYPE.BUTTONS_RESPONSE,e.selectedButtonId=n,e.body=Ae(r)):e.type=p.default.MSG_TYPE.UNKNOWN}function me(e,t){O.ServerProps.viewOnceRead?G(t.message,e):(e.type=p.default.MSG_TYPE.UNKNOWN,e.subtype="phone")}function ge(e,t){G(t.message,e)}function ye(e,t,r){if(!(0,E.buttonsMessagesEnabled)())return void(e.type=p.default.MSG_TYPE.UNKNOWN);const{documentMessage:n,imageMessage:i,locationMessage:s,videoMessage:o,contentText:l,footerText:c,text:d,buttons:u=[],headerType:h}=t,_=P.default.cast((0,R.getBizNativeFlowName)({buttonsMessage:t}));if(!(0,R.shouldParseNFM)(_,r)||(0,R.hasUnsupportedButtons)(u))return e.type=p.default.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(h!==f.ButtonsMessageHeaderType.UNKNOWN&&new Set(f.ButtonsMessageHeaderType.members()).has(h)){if(e.type=p.default.MSG_TYPE.CHAT,e.headerType=h,i?F(e,i):n?W(e,n):s?Y(e,(0,a.default)((0,a.default)({},s),{},{name:void 0,address:void 0})):o?V(e,o):(d&&(e.title=Ae(d)),l&&(e.body=Ae(l))),null==_)u.length&&(e.isDynamicReplyButtonsMsg=!0,e.dynamicReplyButtons=u);else if(e.type=p.default.MSG_TYPE.NATIVE_FLOW,e.nativeFlowName=P.default.cast(_),e.nativeFlowButtons=u,!e.nativeFlowName||!(0,b.isValidNativeFlowMessage)(e))return e.type=p.default.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");l&&(e.caption=Ae(l)),c&&(e.footer=Ae(c))}else e.type=p.default.MSG_TYPE.UNKNOWN}function Ee(e,t){if(null==e.from)return;const r=e.from.equals((0,g.getMeUser)());if(null!=t.initiator)switch(t.initiator){case f.DisappearingModeInitiator.CHANGED_IN_CHAT:e.disappearingModeInitiator=h.DisappearingModeInitiator.ChangedInChat;break;case f.DisappearingModeInitiator.INITIATED_BY_ME:e.disappearingModeInitiator=r?h.DisappearingModeInitiator.InitiatedByMe:h.DisappearingModeInitiator.InitiatedByOther;break;case f.DisappearingModeInitiator.INITIATED_BY_OTHER:e.disappearingModeInitiator=r?h.DisappearingModeInitiator.InitiatedByOther:h.DisappearingModeInitiator.InitiatedByMe}}function Se(e,t,r){var n;const i=(0,R.getInteractiveMessageTypeForProto)(t);if(!i||!(0,R.isInteractiveMessageTypeEnabled)(i))return e.type=p.default.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");const{body:a,footer:s}=t,o=(0,R.getInteractiveMessageFieldNameForType)(i),l={type:p.default.MSG_TYPE.INTERACTIVE,caption:null!==(n=Ae(null==a?void 0:a.text))&&void 0!==n?n:"",interactiveType:i,interactivePayload:t[o]};return(0,R.isSupportedInteractiveMessageVersion)(l)&&(i!==T.default.NATIVE_FLOW||(l.nativeFlowName=P.default.cast((0,R.getBizNativeFlowName)({interactiveMessage:t})),(0,R.isValidNativeFlowName)(l.nativeFlowName,r)&&(0,b.isValidNativeFlowMessage)(l)))?(s&&(l.footer=Ae(s.text)),function(e,t){let{header:r}=t;if(!r)return;const n={title:Ae(r.title),subtitle:Ae(r.subtitle),thumbnail:Z(r.jpegThumbnail),mediaType:void 0,hasMediaAttachment:Boolean(r.hasMediaAttachment)};n.hasMediaAttachment&&(r.documentMessage?(W(e,r.documentMessage),n.mediaType=v.InteractiveMessageHeaderMediaType.DOCUMENT):r.videoMessage?(V(e,r.videoMessage),n.mediaType=v.InteractiveMessageHeaderMediaType.VIDEO):r.imageMessage&&(F(e,r.imageMessage),n.mediaType=v.InteractiveMessageHeaderMediaType.IMAGE)),e.interactiveHeader=n}(e,t),void Object.assign(e,l)):(e.type=p.default.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature"))}function ve(e){const t=e.text;return null==t||t.length<=p.default.REACTION_CONTENT_MAX_LENGTH}function Te(e,t){if(!(0,E.receiveReactionsEnabled)())return e.type=p.default.MSG_TYPE.UNKNOWN,void(e.subtype="reaction");if(!ve(t))throw new m.ReactionValidationError("[messaging] Reaction failed validation");const r=Ae(t.text);e.type=p.default.MSG_TYPE.REACTION,e.reactionParentKey=q(t.key,e),e.reactionText=r,e.reactionTimestamp=t.senderTimestampMs}function Ae(e){return e?u.Conn.platform===u.PLATFORMS.ANDROID?e:_.EmojiUtil.convertToTextWithoutSpecialEmojis(e):e}function Ce(e,t){var r;if(!y.GK.supportsFeature(y.GK.F.LOG_INCOMING_MSG_MISSING_REQUIRED_PROPERTIES))return;if(Math.random()>.001)return;if(!e.id)return;if("status"===(null===(r=e.id.remote)||void 0===r?void 0:r.user)&&N.default.isPSA(e.author)&&!t.staticUrl)return;if(e.id.fromMe)return;const n=e.type;null==t.directPath&&null==t.fileEncSha256?(__LOG__(2,void 0,void 0,!0)`directPath and fileEncSha256 missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-direct-path-and-file-enc`)):null==t.directPath?(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-direct-path`)):null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-file-enc`)),null==t.url&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) is missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-mms3-url`)),null==t.mediaKey&&(__LOG__(2,void 0,void 0,!0)`mediaKey is missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-media-key`))}},93650:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBizNativeFlowName=function(e){var t,r,n,i,a,s;if(1===(null===(t=e.interactiveMessage)||void 0===t||null===(r=t.nativeFlowMessage)||void 0===r||null===(n=r.buttons)||void 0===n?void 0:n.length))return(0,p.getNativeFlowNameByButtonName)(e.interactiveMessage.nativeFlowMessage.buttons[0].name);if(1===(null===(i=e.buttonsMessage)||void 0===i||null===(a=i.buttons)||void 0===a?void 0:a.length))return(0,p.getNativeFlowNameByButtonName)(null===(s=e.buttonsMessage.buttons[0].nativeFlowInfo)||void 0===s?void 0:s.name)},t.getInteractiveMessageFieldNameForType=g,t.getInteractiveMessageTypeForProto=function(e){for(const t of d.default.members())if(g(t)in e)return t;return null},t.hasUnsupportedButtons=function(e){return e.some((e=>e.nativeFlowInfo&&m.includes(e.nativeFlowInfo.name)||m.includes(e.buttonId)))},t.hasUnsupportedCurrency=function(e){var t;const r=(null==e||null===(t=e.primaryAmount)||void 0===t?void 0:t.currencyCode)||(null==e?void 0:e.currency);if(["XUS","XDX","USDP"].includes(null==r?void 0:r.toUpperCase()))return!0;return!1},t.isEitherSenderOrReceiverOfPaymentMessage=function(e){var t,r;if((null===(t=e.id)||void 0===t?void 0:t.remote.isGroup())&&!(null===(r=e.id)||void 0===r?void 0:r.participant.equals((0,o.getMeUser)()))&&!e.paymentMessageReceiverJid.equals((0,o.getMeUser)()))return!1;return!0},t.isInteractiveMessageTypeEnabled=function(e){switch(e){case d.default.NATIVE_FLOW:return(0,l.interactiveNativeFlowMessagesEnabled)();case d.default.SHOPS_STOREFRONT:return(0,l.shopsInteractiveMessageEnabled)()}},t.isSupportedInteractiveMessageVersion=function(e){let{interactivePayload:t,interactiveType:r}=e;const n=null==t?void 0:t.messageVersion;if(null==n||null==r)return!1;switch(r){case d.default.NATIVE_FLOW:case d.default.SHOPS_STOREFRONT:return n<=1}},t.isValidNativeFlowName=_,t.msgKeyToProtobuf=function(e){var t;return{fromMe:e.fromMe,id:e.id,participant:e.fromMe||null===(t=e.participant)||void 0===t?void 0:t.toString({legacy:!0}),remoteJid:e.remote.toString({legacy:!0})}},t.parseMsgPaymentInfo=function(e,t){t&&(e.paymentStatus=t.status,e.paymentTxnStatus=t.txnStatus,e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.amount1000),"maybeNumberOrThrowIfTooLarge(paymentInfo.amount1000)"),e.paymentMessageReceiverJid=(0,f.createWid)((0,a.default)(t.receiverJid,"paymentInfo.receiverJid")),e.paymentExpiryTimestamp=(0,i.maybeNumberOrThrowIfTooLarge)(t.expiryTimestamp),e.paymentTransactionTimestamp=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.transactionTimestamp),"maybeNumberOrThrowIfTooLarge(paymentInfo.transactionTimestamp)"))},t.protobufToMsgKey=function(e){const{fromMe:t,id:r,participant:n,remoteJid:i}=e;(0,s.default)(null!=t&&null!=i&&null!=r,"fromMe, remoteJid, and id should be set");let a=null!=n&&(0,f.isWidlike)(n)?(0,f.createWid)(n):void 0;const l=(0,f.createWid)(i);(l.isGroup()||l.isBroadcast())&&t&&(a=(0,o.getMaybeMeUser)());return new u.default({fromMe:t,id:r,participant:a,remote:(0,f.createWid)(i)})},t.shouldParseNFM=function(e,t){if(null!=e||null!=(null==t?void 0:t.nativeFlowName))return!!(0,l.nativeFlowMessagesEnabled)()&&_(e,t);return!0},t.typeAttributeFromProtobuf=function e(t){if(t.ephemeralMessage){const{message:r}=t.ephemeralMessage;return r?e(r):c.MSG_TYPES.text}if(t.deviceSentMessage){const{message:r}=t.deviceSentMessage;return r?e(r):c.MSG_TYPES.text}if(t.reactionMessage)return c.MSG_TYPES.reaction;return t.conversation||t.extendedTextMessage||t.templateButtonReplyMessage||t.protocolMessage||t.interactiveMessage?c.MSG_TYPES.text:c.MSG_TYPES.media},t.validateWaveform=function(e){return e.byteLength>=64&&e.byteLength<=192};var i=r(8243),a=n(r(45095)),s=n(r(41143)),o=r(99234),l=r(57701),c=r(12037),d=n(r(84064)),u=n(r(32219)),p=r(26287),h=n(r(5165)),f=r(58021);function _(e,t){return null==e&&null==(null==t?void 0:t.nativeFlowName)||null==(null==t?void 0:t.nativeFlowName)||null!=e&&h.default.cast(t.nativeFlowName)===e}const m=["novi_login","novi_report_transaction","novi_hub","novi_view_code","novi_view_transaction","novi_view_bank_detail","novi_view_card_detail"];function g(e){switch(e){case d.default.NATIVE_FLOW:return"nativeFlowMessage";case d.default.SHOPS_STOREFRONT:return"shopStorefrontMessage"}}},55878:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptGroupSignalProto=function(){return p.apply(this,arguments)},t.decryptSignalProto=function(){return d.apply(this,arguments)},t.encryptSenderKeyMsgSignalProto=function(){return h.apply(this,arguments)},t.encryptSignalProto=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(8001),s=r(99234),o=r(45033),l=r(52083),c=r(93832);function d(){return(d=(0,i.default)((function*(e,t,r){const n=new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e));try{const e=yield Promise.resolve(n);let i;switch(t){case o.CiphertextType.Pkmsg:i=yield e.decryptPreKeyWhisperMessage(r);break;case o.CiphertextType.Msg:i=yield e.decryptWhisperMessage(r);break;default:return Promise.reject(new Error(`decryptSignalProto: Received unsupported msg type ${t}`))}return i}catch(e){if(e&&"call_failure"===e.reason&&e.value&&"number"==typeof e.value.result)__LOG__(3)`decryptSignalProto error code ${e.value.result}`;else{if(e&&"MessageCounterError"===e.name)return Promise.reject(new a.SignalMessageCounterError(e));__LOG__(3)`decryptSignalProto js error ${e}`}return Promise.reject(new a.SignalDecryptionError(e))}}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){const r=yield new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e)),{type:n,body:i}=yield r.encrypt(t);return __LOG__(2)`encryptSignalProto complete, type=${n}`,{type:3===n?o.CiphertextType.Pkmsg:o.CiphertextType.Msg,ciphertext:(0,c.strToBuffer)(i)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,r){try{const n=yield new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)(t));return yield n.decryptSenderKeyMessage(r)}catch(e){if(e&&"MessageCounterError"===e.name)throw new a.SignalMessageCounterError(e);throw new a.SignalDecryptionError(e)}}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){const r=new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)((0,s.assertGetMe)())),n=yield Promise.resolve(r).then((e=>e.encrypt(t)));return{ciphertext:(0,c.strToBuffer)(n)}}))).apply(this,arguments)}},8001:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalMessageCounterError=t.SignalDecryptionError=void 0;var n=r(40265);class i extends((0,n.customError)("SignalDecryptionError")){}t.SignalDecryptionError=i;class a extends((0,n.customError)("SignalMessageCounterError")){}t.SignalMessageCounterError=a},11849:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waSignalStore=void 0;var n=r(88102),i=r(318),a=r(77246);const s="signal_reg_id",o="signal_static_pubkey",l="signal_static_privkey",c="signal_next_pk_id",d="signal_last_spk_id",u="signal_first_unupload_pk_id",p="signal_sever_has_pre_keys",h="adv_signed_identity",f={name:"AES-CTR",length:128,counter:new Uint8Array(16)};function _(e){return self.crypto.subtle.generateKey({name:f.name,length:f.length},!1,["encrypt","decrypt"]).then((t=>self.crypto.subtle.encrypt(f,t,e).then((e=>({encKey:t,value:e})))))}function m(e){return self.crypto.subtle.decrypt(f,e.encKey,e.value)}const g=new class{constructor(){this.idToSignedPreKey=new Map,n.Cmd.on("logout",(()=>{this.registrationInfo=void 0,this.idToSignedPreKey.clear()}))}getMeta(e){return(0,i.getMetaTable)().get(e).then((e=>e?e.value:null))}putMeta(e){const t=(0,i.getMetaTable)(),r=e.map((e=>t.createOrReplace(e)));return Promise.all(r).then()}setServerHasPreKeys(e){this.putMeta([{key:p,value:e}])}getServerHasPreKeys(){return this.getMeta(p)}putADVSignedIdentity(e){return this.putMeta([{key:h,value:e}])}getADVSignedIdentity(){return this.getMeta(h)}getPreKeysByRange(e,t){return(0,i.getPreKeyTable)().greaterThan(["keyId"],e-1,{limit:t})}getPreKeyById(e){return(0,i.getPreKeyTable)().get(e)}removePreKeyById(e){return(0,i.getPreKeyTable)().remove(e)}bulkRemovePreKey(e){return(0,i.getPreKeyTable)().bulkRemove(e)}putPreKeys(e){const t=(0,i.getPreKeyTable)(),r=e.map((e=>{const{keyId:r,keyPair:n,isDirectDistribution:i}=e;return t.get(r).then((e=>{if(e)throw Error(`preKey id ${r} already exists`);return t.create({keyId:r,keyPair:n,isDirectDistribution:i})}))}));return Promise.all(r).then()}markPreKeyAsDirectDistribution(e){return(0,i.getPreKeyTable)().merge(e,{isDirectDistribution:1})}getSignedPreKey(){return this.getMeta(d).then((e=>this.getSignedPreKeyById(e)))}getSignedPreKeyById(e){if(this.idToSignedPreKey.has(e))return Promise.resolve(this.idToSignedPreKey.get(e));return(0,i.getSignedPreKeyTable)().get(e).then((t=>(this.idToSignedPreKey.set(e,t),t)))}putSignedPreKeys(e){const t=(0,i.getSignedPreKeyTable)(),r=e.map((e=>{const{keyId:r,keyPair:n,signature:i}=e;return t.get(r).then((e=>{if(e)throw Error(`signed preKey id ${r} already exists`);return t.create({keyId:r,keyPair:n,signature:i})}))}));return Promise.all(r).then()}putSession(e,t){return(0,i.getSessionTable)().createOrReplace({address:e,session:t})}bulkPutSession(e){return(0,i.getSessionTable)().bulkCreateOrReplace(e)}removeSession(e){return(0,i.getSessionTable)().remove(e)}bulkRemoveSession(e){return(0,i.getSessionTable)().bulkRemove(e)}getSession(e){return(0,i.getSessionTable)().get(e).then((e=>e?e.session:null))}bulkGetSession(e){return(0,i.getSessionTable)().bulkGet(e).then((e=>e.map((e=>e?e.session:null))))}putIdentity(e,t){return(0,i.getIdentityTable)().createOrReplace({identifier:e,identityKey:t})}bulkPutIdentity(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}bulkGetIdentity(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?e.identityKey:null))))}getIdentity(e){return(0,i.getIdentityTable)().get(e).then((e=>e?e.identityKey:null))}removeIdentity(e){return(0,i.getIdentityTable)().remove(e)}bulkRemoveIdentity(e){return(0,i.getIdentityTable)().bulkRemove(e)}getIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().get(e).then((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))}bulkGetIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))))}bulkPutIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}saveBaseKey(e,t,r){return(0,i.getBaseKeyTable)().createOrReplace({address:e,originalMsgId:t,baseKey:r})}loadBaseKey(e,t){return(0,i.getBaseKeyTable)().equals(["address","originalMsgId"],[e,t]).then((e=>e&&0!==e.length?e[0].baseKey:null))}deleteBaseKey(e,t){const r=(0,i.getBaseKeyTable)();return r.equals(["address","originalMsgId"],[e,t]).then((e=>{if(e&&0!==e.length)return r.remove(e[0].id)}))}putSenderKey(e,t,r){return(0,i.getSenderKeyTable)().createOrReplace({senderKeyName:e,senderId:t,senderKey:r})}bulkPutSenderKey(e){return(0,i.getSenderKeyTable)().bulkCreateOrReplace(e)}removeSenderKey(e){return(0,i.getSenderKeyTable)().remove(e)}getSenderKey(e){return(0,i.getSenderKeyTable)().get(e).then((e=>e?e.senderKey:null))}removeSenderKeyBySenderId(e){const t=(0,i.getSenderKeyTable)();return t.equals(["senderId"],e).then((e=>t.bulkRemove(e.map((e=>e.senderKeyName)))))}clearCredential(){const e=[(0,i.getIdentityTable)(),(0,i.getMetaTable)(),(0,i.getPreKeyTable)(),(0,i.getSessionTable)(),(0,i.getSignedPreKeyTable)()];return Promise.all(e.map((e=>e.clear()))).then((()=>{}))}getRegistrationInfo(){return null!=this.registrationInfo?Promise.resolve(this.registrationInfo):Promise.all([this.getMeta(s),this.getMeta(o),this.getMeta(l)]).then((e=>{let[t,r,n]=e;if(t&&r&&n)return Promise.all([m(r),m(n)]).then((e=>{let[r,n]=e;return this.registrationInfo={registrationId:t,identityKeyPair:{pubKey:r,privKey:n}},this.registrationInfo}))}))}setRegistrationInfo(e){return Promise.all([_(e.identityKeyPair.pubKey),_(e.identityKeyPair.privKey)]).then((t=>{let[r,n]=t;return Promise.all([this.putMeta([{key:s,value:e.registrationId},{key:o,value:r},{key:l,value:n}])]).then()}))}getOrGenPreKeys(e,t){return(0,a.getStorage)().lock(["signal-meta-store","prekey-store"],(()=>Promise.all([this.getMeta(u),this.getMeta(c)]).then((r=>{let[n,i]=r;const a=n||1,s=i||1,o=s-a,l=e-o;if(l<=0)return __LOG__(2)`getPreKeys: no prekey needs to be generated, avaliable: ${o}, need: ${e}`,this.getPreKeysByRange(a,e);{const r=function(e,t){const r=[];for(let n=e;n<t;n++)r.push(n);return r}(s,s+l).map((e=>t(e)));return Promise.all(r).then((e=>this.savePreKeys(e))).then((()=>this.getPreKeysByRange(a,e)))}}))))}getOrGenSinglePreKey(e){return this.getOrGenPreKeys(1,e).then((e=>{if(1!==e.length)throw Error("Expected to get exactly one key but got ${keys.length}");return e[0]}))}savePreKeys(e){if(0===e.length)return Promise.resolve();const t=e[e.length-1];return Promise.all([this.putMeta([{key:c,value:t.keyId+1}]),this.putPreKeys(e)]).then()}markKeyAsUploaded(e){return Promise.all([this.getMeta(u),this.getMeta(c)]).then((t=>{let[r,n]=t;if(e<0||!n||e>=n)throw Error(`markKeyAsUploaded: key ${e} is out of boundary.`);const i=r?Math.max(r,e+1):e+1;return this.putMeta([{key:u,value:i}])}))}rotateSignedPreKey(e,t){return(0,a.getStorage)().lock(["signal-meta-store","signed-prekey-store"],(()=>this.getMeta(d).then((r=>{const n=null==r?1:r+1;return t(e,n).then((e=>(this.putSignedPreKeys([e]),this.putMeta([{key:d,value:n}]),e)))}))))}};t.waSignalStore=g},93832:(e,t)=>{"use strict";function r(e,t){for(let r=0;r<t;r++)e.writeUint8(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.bufferEqual=function(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(let e=0;e<r.byteLength;e++)if(r.getUint8(e)!==n.getUint8(e))return!1;return!0},t.bufferToStr=function(e){return new window.dcodeIO.ByteBuffer.wrap(e).toString("binary")},t.createSignalAddress=function(e){if(!(e.isUser()||e.isServer()||e.isPSA()))throw new Error(`Jid ${e.toString({legacy:!0})} is not fully qualified, jid.server should be "s.whatsapp.net"`);return new window.libsignal.SignalProtocolAddress(e.getSignalAddress(),0)},t.strToBuffer=function(e){return new window.dcodeIO.ByteBuffer.wrap(e,"binary").toArrayBuffer()},t.unpad=function(e){const t=new Uint8Array(e);if(0===t.length)throw new Error("unpadPkcs7 given empty bytes");const r=t[t.length-1];if(r>t.length)throw new Error(`unpad given ${t.length} bytes, but pad is ${r}`);return new Uint8Array(t.buffer,t.byteOffset,t.length-r)},t.writePad=r,t.writeRandomPadMax16=function(e){const t=new Uint8Array(1);self.crypto.getRandomValues(t),r(e,1+(15&t[0]))}},77605:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.Session=t.KeyGenerator=t.Cipher=void 0;var i=n(r(58425)),a=n(r(55878)),s=n(r(54084));const o=i;t.KeyGenerator=o;const l=a;t.Cipher=l;const c=s;t.Session=c},58425:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateIdentityKeyPair=function(){return l.apply(this,arguments)},t.generatePreKeyPair=function(){return s.apply(this,arguments)},t.generateSignedKeyPair=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(5087);function s(){return(s=(0,i.default)((function*(e){const t=yield window.libsignal.KeyHelper.generatePreKey(e),{keyId:r,keyPair:n}=t;return{keyId:r,keyPair:(0,a.toCurveKeyPair)(n),isDirectDistribution:0}}))).apply(this,arguments)}function o(){return(o=(0,i.default)((function*(e,t){const r=yield window.libsignal.KeyHelper.generateSignedPreKey(e,t),{keyId:n,keyPair:i,signature:s}=r;return{keyId:n,keyPair:(0,a.toCurveKeyPair)(i),signature:s}}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){const e=yield window.libsignal.KeyHelper.generateIdentityKeyPair();return(0,a.toCurveKeyPair)(e)}))).apply(this,arguments)}},46361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyIdentityKey=function(e){return e instanceof ArrayBuffer?(0,n.bufferToStr)(e):e};var n=r(93832)},52083:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enableMemSignalStore=function(){s=i.default},t.enablePersistSignalStore=function(){s=a.default},t.getSignalProtocolStore=function(){return s};var i=n(r(54624)),a=n(r(76128));let s=a.default},54624:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(50361)),s=r(88102),o=r(46361),l=r(5087),c=r(99234),d=r(1291),u=r(11849),p=r(93832);var h=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfo=null,this.SignedPreKeyStore=new Map,this.SessionStore=new Map,this.IdentityStore=new Map,this.PrekeyStore=new Map,this.SenderKeyStore=new Map,s.Cmd.on("logout",(()=>{this.cleanStorage()}))}getIdentityKeyPair(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfo.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}loadIdentityKey(e){var t=this;return(0,i.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityStore.has(e)){const r=yield u.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityStore.set(e,r)}return(null===(r=t.IdentityStore.get(e))||void 0===r?void 0:r.identityKey)||void 0}))()}saveIdentity(e,t){var r=this;return(0,i.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to put identity key for undefined/null key"));const n=(0,o.stringifyIdentityKey)(t),i=yield r.loadIdentityKey(e);i&&i===n||(i&&e===(0,p.createSignalAddress)((0,c.getMeUser)()).toString()?(0,d.handleSelfPrimaryIdentityChange)():r.putIdentity(e,n))}))()}putIdentity(e,t){this.IdentityStore.set(e,{identityKey:t})}removeIdentity(e){return null==e?Promise.reject(new Error("Tried to remove identity key for undefined/null key")):(this.IdentityStore.set(e,{deleted:!0}),Promise.resolve())}loadPreKey(e){var t=this;return(0,i.default)((function*(){if(null==e)return;if(!t.PrekeyStore.has(e)){var r;const n=null===(r=yield u.waSignalStore.getPreKeyById(e))||void 0===r?void 0:r.keyPair;t.PrekeyStore.set(e,{keyPair:n})}const n=t.PrekeyStore.get(e);return(null==n?void 0:n.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):(this.PrekeyStore.set(e,{deleted:!0}),Promise.resolve())}loadSignedPreKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SignedPreKeyStore.has(e)){var r;const n=null===(r=yield u.waSignalStore.getSignedPreKeyById(e))||void 0===r?void 0:r.keyPair;t.SignedPreKeyStore.set(e,n)}return t.SignedPreKeyStore.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,i.default)((function*(){var r;if(null!=e){if(!t.SessionStore.has(e)){const r=yield u.waSignalStore.getSession(e);t.SessionStore.set(e,r?{session:r}:void 0)}return(null===(r=t.SessionStore.get(e))||void 0===r?void 0:r.session)||void 0}}))()}storeSession(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SessionStore.set(e,{session:t}),Promise.resolve())}removeSession(e){return null==e?Promise.reject(new Error("Tried to remove session without identifier")):(this.SessionStore.set(e,{deleted:!0}),Promise.resolve())}storeSenderKey(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SenderKeyStore.set(e,t),Promise.resolve())}loadSenderKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SenderKeyStore.has(e)){const r=yield u.waSignalStore.getSenderKey(e);t.SenderKeyStore.set(e,r)}return t.SenderKeyStore.get(e)||void 0}}))()}cleanStorage(){this.RegistrationInfo=null,this.SessionStore.clear(),this.IdentityStore.clear(),this.PrekeyStore.clear(),this.SignedPreKeyStore.clear(),this.SenderKeyStore.clear()}_generateSessionUpdate(){const e=[],t=[];return Array.from(this.SessionStore.keys()).forEach((r=>{const n=this.SessionStore.get(r);n&&(n.deleted?t.push(r):e.push({address:r,session:(0,a.default)(n.session)}))})),{update:e,remove:t}}_generateSenderKeyUpdate(){const e=[];return Array.from(this.SenderKeyStore.keys()).forEach((t=>{const r=this.SenderKeyStore.get(t);if(r){const n=t.split("::");2===n.length&&e.push({senderKeyName:t,senderId:n[1],senderKey:(0,a.default)(r)})}})),e}_generateIdentityUpdate(){const e=[],t=[];return Array.from(this.IdentityStore.keys()).forEach((r=>{const n=this.IdentityStore.get(r);n&&(n.deleted?t.push(r):e.push({identifier:r,identityKey:n.identityKey,rowId:n.rowId}))})),{update:e,remove:t}}_generatePreKeyUpdate(){const e=[];return Array.from(this.PrekeyStore.keys()).forEach((t=>{const r=this.PrekeyStore.get(t);(null==r?void 0:r.deleted)&&e.push(parseInt(t,10))})),e}generateSnapshot(){const e=this._generateIdentityUpdate(),t=this._generateSessionUpdate();return{sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this._generateSenderKeyUpdate(),preKeyRemove:this._generatePreKeyUpdate()}}flushBufferToDiskIfNotMemOnlyMode(){return Promise.resolve()}};t.default=h},76128:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(97197),o=r(46361),l=r(5087),c=r(99234),d=r(57701),u=r(1291),p=r(11849),h=r(77246),f=r(93832);var _=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache=new Map,this.SessionCache=new Map,this.SessionCacheDirtySet=new Set,this._sessionMutex=new s.Semaphore(1),this.IdentityCache=new Map,this.IdentityCacheDirtySet=new Set,this._identityMutex=new s.Semaphore(1)}getIdentityKeyPair(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfoReadThruCache.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}saveIdentity(e,t){var r=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to put identity key for undefined/null key");const n=(0,o.stringifyIdentityKey)(t),i=yield r.loadIdentityKey(e);if(!i||i!==n){if(i){if(e===(0,f.createSignalAddress)((0,c.getMeUser)()).toString())return void(0,u.handleSelfPrimaryIdentityChange)();yield(0,u.handleNewIdentity)(e)}yield r.putIdentity(e,n)}}))()}_putIdentityImpl(e,t){const r=this.IdentityCache.get(e);this.IdentityCache.set(e,(0,i.default)((0,i.default)({},r),{},{identityKey:t})),this.IdentityCacheDirtySet.add(e)}putIdentity(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._identityMutex.acquire();try{(0,d.identityStoreCacheEnabled)()?r._putIdentityImpl(e,t):(yield p.waSignalStore.putIdentity(e,t),r.IdentityCache.set(e,{identityKey:t}))}finally{n.release()}}))()}_loadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityCache.has(e)){const r=yield p.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityCache.set(e,r)}return(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.identityKey)||void 0}))()}loadIdentityKey(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{return yield t._loadIdentityKeyImpl(e)}finally{r.release()}}))()}getIdentityRowId(e){var t=this;return(0,a.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");return yield t.loadIdentityKey(e),(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.rowId)||void 0}))()}bulkGetIdentityRowId(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");return 0===e.length?[]:(yield t.bulkLoadIdentityKey(e),e.map((e=>{var r;return(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.rowId)||void 0})))}))()}_bulkLoadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(0===e.length)return[];const r=new Array(e.length),n=[];if(e.forEach(((e,i)=>{var a;t.IdentityCache.has(e)?r[i]=null===(a=t.IdentityCache.get(e))||void 0===a?void 0:a.identityKey:n.push({id:e,pos:i})})),n.length>0){(yield p.waSignalStore.bulkGetIdentityKeyWithRowId(n.map((e=>e.id)))).forEach(((e,i)=>{const a=n[i];t.IdentityCache.set(a.id,e),r[a.pos]=null==e?void 0:e.identityKey}))}return r}))()}bulkLoadIdentityKey(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{return yield t._bulkLoadIdentityKeyImpl(e)}finally{r.release()}}))()}_bulkCreateIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to bulk put identity key with undefined/null");__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s): start`,yield(0,h.getStorage)().lock(["identity-store"],(0,a.default)((function*(){const r=e.map((e=>e.identifier)),n=yield t._bulkLoadIdentityKeyImpl(r),i=e.filter(((e,t)=>!n[t]));i.length>0&&(yield p.waSignalStore.bulkPutIdentity(i),i.forEach((e=>{let{identifier:r,identityKey:n}=e;t.IdentityCache.set(r,{identityKey:n})}))),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s) (new: ${i.length}): end`})))}))()}bulkCreateIdentity(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{yield t._bulkCreateIdentityImpl(e)}finally{r.release()}}))()}_removeIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove identity key for undefined/null key"));yield p.waSignalStore.removeIdentity(e),t.IdentityCache.delete(e),t.IdentityCacheDirtySet.delete(e)}))()}removeIdentity(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{yield t._removeIdentityImpl(e)}finally{r.release()}}))()}loadPreKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);const t=yield p.waSignalStore.getPreKeyById(e);return(null==t?void 0:t.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):p.waSignalStore.removePreKeyById(e)}loadSignedPreKey(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SignedPreKeyStoreReadThruCache.has(e)){var r;const n=null===(r=yield p.waSignalStore.getSignedPreKeyById(e))||void 0===r?void 0:r.keyPair;t.SignedPreKeyStoreReadThruCache.set(e,n)}return t.SignedPreKeyStoreReadThruCache.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SessionCache.has(e)){const r=yield p.waSignalStore.getSession(e);t.SessionCache.set(e,r)}return t.SessionCache.get(e)||void 0}}))()}_storeSessionImpl(e,t){if(null==e)throw new Error("Tried to put session without identifier");this.SessionCache.set(e,t),this.SessionCacheDirtySet.add(e)}storeSession(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._sessionMutex.acquire();return r._storeSessionImpl(e,t),n.release(),Promise.resolve()}))()}removeSession(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove session without identifier"));yield p.waSignalStore.removeSession(e),t.SessionCache.delete(e),t.SessionCacheDirtySet.delete(e)}))()}containSessions(e){var t=this;return(0,a.default)((function*(){const r=[];for(const n of e)t.SessionCache.has(n)||r.push(n);if(r.length>0){(yield p.waSignalStore.bulkGetSession(r)).forEach(((e,n)=>{const i=r[n];t.SessionCache.set(i,e)}))}return e.map((e=>!!t.SessionCache.get(e)))}))()}storeSenderKey(e,t){if(null==e)return Promise.reject(new Error("Tried to put senderKey without senderKeyName"));const r=e.split("::");if(r.length<2)return Promise.reject(new Error("Tried to put senderKey with invalid senderKeyName"));const n=r[1];return p.waSignalStore.putSenderKey(e,n,t)}loadSenderKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);return(yield p.waSignalStore.getSenderKey(e))||void 0}))()}deleteAllCache(){__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`deleteAllCache`,this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache.clear(),this.SessionCache.clear(),this.IdentityCache.clear(),this.SessionCacheDirtySet.clear(),this.IdentityCacheDirtySet.clear()}_flushSessions(){var e=this;return(0,a.default)((function*(){__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: start`,__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: get dirty updates for ${Array.from(e.SessionCacheDirtySet).join(",")}`;const t=[];e.SessionCacheDirtySet.forEach((r=>{const n=e.SessionCache.get(r);n&&t.push({address:r,session:n})})),t.length>0&&(yield p.waSignalStore.bulkPutSession(t)),e.SessionCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: ${t.length} flushed`}))()}_flushIdentities(){var e=this;return(0,a.default)((function*(){if(!(0,d.identityStoreCacheEnabled)())return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: disabled`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: start`,__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: get dirty updates for ${Array.from(e.IdentityCacheDirtySet).join(",")}`;const t=[];e.IdentityCacheDirtySet.forEach((r=>{const n=e.IdentityCache.get(r);n&&t.push((0,i.default)((0,i.default)({},n),{},{identifier:r}))})),t.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(t)),e.IdentityCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: ${t.length} flushed`}))()}flushBufferToDiskIfNotMemOnlyMode(){var e=this;return(0,a.default)((function*(){const t=yield e._sessionMutex.acquire(),r=yield e._identityMutex.acquire();try{yield(0,h.getStorage)().lock(["identity-store","session-store"],(()=>Promise.all([e._flushSessions(),e._flushIdentities()])))}finally{r.release(),t.release()}}))()}_updateIdentityRangeAfterEncryptionImpl(e,t){var r=this;return(0,a.default)((function*(){if(__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: start`,yield r._bulkLoadIdentityKeyImpl(t),(0,d.identityStoreCacheEnabled)()){const n=[];t.forEach((t=>{const i=r.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(r.IdentityCache.set(t,{identityKey:i.identityKey,rowId:e}),r.IdentityCacheDirtySet.add(t),n.push(t))})),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${n.length} updated`}else{const n=[];t.forEach((t=>{const i=r.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(i.rowId=e,n.push({identifier:t,identityKey:i.identityKey,rowId:e}))})),n.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(n),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${n.length} flushed`)}}))()}updateIdentityRangeAfterEncryption(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._identityMutex.acquire();try{yield r._updateIdentityRangeAfterEncryptionImpl(e,t)}finally{n.release()}}))()}};t.default=_},54084:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroupSignalSession=function(){return E.apply(this,arguments)},t.createSignalSession=function(){return f.apply(this,arguments)},t.deleteDeviceSenderKey=function(e){const t=String((0,h.createSignalAddress)(e));return p.waSignalStore.removeSenderKeyBySenderId(t)},t.deleteGroupSenderKeyInfo=function(e){const t=(0,h.createSignalAddress)((0,c.assertGetMe)()),r=`${e.toString({legacy:!0})}::${t.toString()}`;return p.waSignalStore.removeSenderKey(r)},t.deleteRemoteInfo=function(){return m.apply(this,arguments)},t.getGroupSenderKeyInfo=function(){return S.apply(this,arguments)},t.getRemoteRegId=function(){return _.apply(this,arguments)},t.hasSameBaseKey=function(){return y.apply(this,arguments)},t.hasSignalSessions=function(e){return d.default.containSessions(e.map((e=>(0,h.createSignalAddress)(e).toString())))},t.saveSessionBaseKey=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=r(8584),s=r(45763),o=n(r(69618)),l=r(5087),c=r(99234),d=n(r(76128)),u=r(52083),p=r(11849),h=r(93832);function f(){return(f=(0,i.default)((function*(e){const{wid:t,identity:r,deviceIdentity:n}=e;if(__LOG__(2)`Signal::createSignalSession with `,null!=t.device&&t.device!==o.default.DEVICE.PRIMARY_DEVICE){if(!n)throw new Error("Signal::createSignalSession: expected device-identity in keyBundle for companion device");if(!(yield(0,s.validateADVwithIdentityKey)(t,n,r)))throw new Error("Signal::createSignalSession: invalid identityKey fetched")}let i,c,u;try{i=(0,l.toSignalCurvePubKey)(new a.Binary(e.identity).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid identityKey fetched"),e}try{c=(0,l.toSignalCurvePubKey)(new a.Binary(e.skey.pubkey).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid signedPreKey fetched"),e}if(e.key)try{u=(0,l.toSignalCurvePubKey)(new a.Binary(e.key.pubkey).readBuffer())}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid preKey fetched")}const p={registrationId:e.regId,identityKey:i,signedPreKey:{keyId:e.skey.id,publicKey:c,signature:new a.Binary(e.skey.signature).readBuffer()}};return e.key&&u&&(p.preKey={keyId:e.key.id,publicKey:u}),new window.libsignal.SessionBuilder(d.default,(0,h.createSignalAddress)(t)).processPreKey(p)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=new window.libsignal.SessionCipher(d.default,(0,h.createSignalAddress)(e));return(yield Promise.resolve(t)).getRemoteRegistrationId()}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const t=(0,h.createSignalAddress)(e).toString();yield Promise.all([(0,u.getSignalProtocolStore)().removeIdentity(t),(0,u.getSignalProtocolStore)().removeSession(t)])}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const r=(0,h.createSignalAddress)(e),n=new window.libsignal.SessionInfo(d.default,r),i=yield n.getSessionBaseKey();i?yield p.waSignalStore.saveBaseKey(r.toString(),t,i):__LOG__(2)`saveSessionBaseKey: for ${t}, no basekey provided`}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const r=(0,h.createSignalAddress)(e),n=new window.libsignal.SessionInfo(d.default,(0,h.createSignalAddress)(e)),[i,a]=yield Promise.all([n.getSessionBaseKey(),p.waSignalStore.loadBaseKey(r.toString(),t)]);return a?i?(0,h.bufferEqual)(a,i)?(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is same`,!0):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is different `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no session has been saved locally `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no base key has been saved locally `,!1)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,r){const n=new window.libsignal.GroupCipher((0,u.getSignalProtocolStore)(),t,(0,h.createSignalAddress)(e));return(yield Promise.resolve(n)).decryptSenderKeyDistributionMessage(r)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=new window.libsignal.GroupCipher(d.default,e.toString({legacy:!0}),(0,h.createSignalAddress)((0,c.assertGetMe)())),r=yield t.createSenderKeyDistributionMsg();return(0,h.strToBuffer)(r)}))).apply(this,arguments)}},91335:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractIdentityKey=function(e){const t=window.dcodeIO.ByteBuffer.wrap(e);t.readUint8();try{const e=window.libsignal.Protobuf.PreKeyWhisperMessage.decode(t);return(0,i.toCurveKeyPubKey)(e.identityKey.toArrayBuffer())}catch(e){return __LOG__(3)`extractIdentityKey: parse proto failed`,null}},t.xmppPreKey=function(e){return(0,n.wap)("key",null,(0,n.wap)("id",null,(0,n.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,n.wap)("value",null,e.keyPair.pubKey))},t.xmppSignedPreKey=function(e){return(0,n.wap)("skey",null,(0,n.wap)("id",null,(0,n.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,n.wap)("value",null,e.keyPair.pubKey),(0,n.wap)("signature",null,e.signature))};var n=r(31914),i=r(5087)},92613:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.startBackend=H;var i=n(r(48926)),a=r(38284),s=r(18018),o=r(86945),l=r(64971),c=r(89981),d=r(68268),u=n(r(48277)),p=r(16116),h=r(98972),f=n(r(69048)),_=r(88102),m=r(24747),g=(n(r(69618)),r(79502)),y=r(93771),E=r(15998),S=r(91214),v=r(99234),T=r(7293),A=n(r(18438)),C=r(36163),b=r(37726),P=r(68819),M=(r(83578),r(46582)),O=n(r(11339)),I=r(76214),w=r(85417),R=r(47587),D=r(34771),N=r(47569),L=r(29100),k=r(64551),G=r(11849),U=r(66837),F=r(38804),x=r(42862),B=r(70768),K=r(31452),Y=r(46669),j=(n(r(47221)),r(77959)),W=r(65044);function H(){return V.apply(this,arguments)}function V(){return(V=(0,i.default)((function*(){if(!G.waSignalStore.getRegistrationInfo())return void __LOG__(2)`startBackendRegistered: chatd user not registered`;__LOG__(2)`[startBackend]: connected as ${(0,v.assertGetMe)()}`;try{yield(0,a.promiseTimeout)(Promise.all([(0,I.initialize)()]),2e4),yield(0,a.promiseTimeout)((0,w.initialize)(),2e4)}catch(e){_.Cmd.storageInitializationError()}const e=yield(0,y.getTable)().count(),t=yield G.waSignalStore.getServerHasPreKeys();yield Q(),yield(0,m.startComms)(A.default,L.sendPing,{passive:e>0||!t}),yield(0,m.waitForConnection)();{const r=[];e>0&&r.push((0,h.sendAndClearDanglingReceipts)()),t||((0,S.setDeviceLinkPairStage)(O.default.MD_LINK_DEVICE_COMPANION_STAGE.UPLOAD_PREKEYS),r.push((0,Y.uploadPreKeys)().catch((e=>{__LOG__(4,!0,new Error,!0)`error while uploading prekeys, ${e}`,SEND_LOGS("error while uploading prekeys"),(0,S.commitDeviceLinkEvent)(-1)})))),yield Promise.all(r),(0,S.setDeviceLinkPairStage)(O.default.MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE),(0,S.commitDeviceLinkEvent)(),yield(0,R.sendPassiveIq)(!1)}D.PrimaryFeatures.initializeFromLocalStorage(),(0,l.isABPropsAfterFirstSync)()?yield(0,o.updateABPropsFromStorage)():yield(0,c.syncABPropsTask)(),yield z(),$(),yield(0,F.initialize)(),yield(0,p.initChatThreadLogging)(),yield(0,m.startHandlingRequests)(),yield u.default.syncCriticalDataIfNeeded(),yield(0,P.startWebPersistedJobManager)(),yield E.DbEncKeyStore.waitForFinalDbMsgEncKey(),null==k.ServerProps.serverPropsVersion&&(yield(0,N.queryServerProps)()),(0,s.compareServerPropsAndABProps)(),J(),B.TosManager.run(),(0,b.startQPL)()}))).apply(this,arguments)}function $(){var e;const t=null===(e=(0,v.getMaybeMeUser)())||void 0===e?void 0:e.user;t&&j.Wam.set(O.default.METRICS.getGlobal("psCountryCode"),(0,g.getCountryShortcodeByPhone)(t))}function z(){return q.apply(this,arguments)}function q(){return(q=(0,i.default)((function*(){(0,o.getABPropConfigValue)("web_wam_v5_enabled")&&(yield j.Wam.upgradeWamRuntime())}))).apply(this,arguments)}function J(){(0,K.applyContactBusinessProps)(),(0,C.restoreLabels)(),(0,C.restoreQuickReplies)(),(0,C.restoreLabelAssociations)(),(0,C.restoreCarts)(),(0,C.restoreArchiveV2Settings)()}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,i.default)((function*(){const e=r(99234),t=r(56891).default,{loadProtoVersions:n}=r(77113),i=e.getVersion(),a=(null==i?void 0:i.protoVersion)||[0,17];yield n(),T.GK.setVersion(a),t.setVersion(a,10,"EAEYASACKAEwAjgBQAFIAVgBYAFoAXgBmAEBoAEBqAEBsAECuAEBwAEByAEB0AEA2AEB4AEC8AED+AEDgAIDkAIDmAIAqAIDsAIAuAIDwAIB"),k.ServerProps.updateSelectiveProps({groupDescLength:512,multicastLimitGlobal:5,frequentlyForwardedMax:5,stickers:1,mdBlocklistV2:1})}))).apply(this,arguments)}_.Cmd.on("main_stream_mode_ready",(()=>{try{u.default.continueProgressiveHistorySyncProcessing(),f.default.startIndexer(),(0,M.requireStatusV3Collection)().then((e=>{e.sync()})),(0,x.registerTasks)(),(0,U.runSyncDirtyContactsJob)(),(0,C.restoreRecentStickers)(),(0,C.restoreFavoriteStickers)(),(0,d.scheduleAdvDeviceInfoCheck)()}catch(e){__LOG__(2)`debug setup failed:`}})),_.Cmd.on("md_restart_backend",(()=>{(0,m.stopComms)(),H()})),_.Cmd.on("storage_initialization_error",(0,i.default)((function*(){__LOG__(2)`storage initialization error, logging out`,yield W.Socket.clearCredentialsAndStoredData(),_.Cmd.logout()}))),T.GK.on(T.FEATURE_CHANGE_EVENT,(()=>{(0,C.updateGKFeatures)()}))},21084:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(92844),i=r(60980),a=r(45606),s=r(58052),o=r(12492),l=r(89835),c=r(22701);class d extends l.SyncActionBase{constructor(){super(...arguments),this.version=4}applyMutations(e){return Promise.all(e.map((e=>{try{if("set"===e.operation){const{value:t}=e,r=t.androidUnsupportedActions;if(!r)return __LOG__(3)`android unsupported actions: malformed mutation`,{actionState:a.SyncActionState.Malformed};return r.allowed&&this.updatePrimaryAllowsAllMutationsFlag("allow_unsupported_mutation"),{actionState:a.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}})))}getAndroidUnsupportedActionsMutation(){const e=(0,n.unixTimeMs)();return{collection:a.CollectionName.RegularLow,index:JSON.stringify([a.Actions.AndroidUnsupportedActions]),operation:o.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,i.encodeProtobuf)(c.SyncActionValueSpec,{timestamp:e,androidUnsupportedActions:{allowed:!0}}).readBuffer(),timestamp:e,action:a.Actions.AndroidUnsupportedActions}}updatePrimaryAllowsAllMutationsFlag(e){(0,s.getPrimaryAllowsAllMutations)()||(__LOG__(2)`[syncd] primary allows all mutations flag set: ${e}`,(0,s.setPrimaryAllowsAllMutations)())}}const u=new d;Object.freeze(u);var p=u;t.default=p},74362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(84902),l=r(60980),c=r(38342),d=r(69951),u=r(45606),p=r(57701),h=r(19937),f=n(r(11339)),_=r(76214),m=r(12492),g=n(r(68132)),y=r(89835),E=r(22701),S=r(22954),v=r(93824),T=n(r(39546)),A=r(58021);function C(e,t){switch(t){case h.MessageRangeEncloseType.RangesAreEqual:case h.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:u.SyncActionState.Success};case h.MessageRangeEncloseType.RangeBEnclosesRangeA:case h.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:e.toString()}}}}class b extends y.SyncActionBase{constructor(){super(...arguments),this.version=3}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,S.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}setArchive(e){return(0,a.default)((function*(){yield(0,_.getChatTable)().bulkCreateOrMerge(e),e.forEach((e=>{const t=(0,A.createWid)(e.id),r=d.ChatCollection.get(t);r&&(r.archive=e.archive)}))}))()}validateSyncActionValue(e){const t=e.archiveChatAction;return null!=(null==t?void 0:t.archived)&&(0,h.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return(0,a.default)((function*(){const r=new Map;yield(0,_.getChatTable)().bulkGet(e.map((e=>{const{indexParts:t}=e,[,r]=t;return r&&T.default.isWid(r)?(0,A.createWid)(r).toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.set(e.id,e)}))));const n=[],i=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){const{indexParts:i,value:a}=e,[,o]=i;if(o||(0,S.throwInvalidActionIndex)(),!T.default.isWid(o))return(0,v.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:u.SyncActionState.Malformed};const l=a.archiveChatAction;if(!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][archive-chat]: malformed mutation`,{actionState:u.SyncActionState.Malformed};const c=(0,s.default)(null==l?void 0:l.archived,"archiveChatAction?.archived"),d=(0,s.default)(null==l?void 0:l.messageRange,"archiveChatAction?.messageRange"),p=(0,A.createWid)(o);if(!r.has(p.toString()))return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:p.toString()}};const h=yield t._applyMutation(p,c,d,a);return h.updates&&n.push(h.updates),h.syncApplyActionResult}return __LOG__(3)`[syncd][archive-chat]: REMOVE operation not supported`,{actionState:u.SyncActionState.Unsupported}}catch(e){return{actionState:u.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return n.length>0&&(yield t.setArchive(n)),i}))()}_applyMutation(e,t,r,n){return(0,a.default)((function*(){if(yield(0,c.removeActiveMessageRange)(e.toString(),(0,c.getActiveRangeAction)("archive")),!t)return{updates:{id:e.toString(),archive:t},syncApplyActionResult:{actionState:u.SyncActionState.Success}};const i=yield(0,h.constructMessageRange)(e,!1),a=(0,h.compareMessageRanges)(i,r),s=(0,l.encodeProtobuf)(E.SyncActionValueSpec,n).readBuffer(),o=()=>(0,c.addActiveMessageRange)(e.toString(),(0,c.getActiveRangeAction)("archive"),s),d=(0,p.archiveV2Supported)()&&g.default.showArchiveV2;switch(a){case h.MessageRangeEncloseType.RangesAreEqual:case h.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield o(),{updates:{id:e.toString(),archive:t},syncApplyActionResult:C(e,a)};case h.MessageRangeEncloseType.RangeAEnclosesRangeB:case h.MessageRangeEncloseType.RangesNotEnclosing:return d?{updates:{id:e.toString(),archive:t},syncApplyActionResult:C(e,a)}:(yield o(),{updates:void 0,syncApplyActionResult:C(e,a)})}}))()}_constructArchiveChatIndex(e){return JSON.stringify([u.Actions.Archive,e.toString({legacy:!0})])}getArchiveChatMutation(e,t,r){var n=this;return(0,a.default)((function*(){const i={timestamp:e,archiveChatAction:{archived:t,messageRange:yield(0,h.constructMessageRange)(r,!0)}};return{collection:u.CollectionName.RegularLow,index:n._constructArchiveChatIndex(r),binarySyncAction:(0,l.encodeProtobuf)(E.SyncActionValueSpec,i).readBuffer(),version:n.version,operation:m.SyncdMutationSyncdOperation.SET,timestamp:e,action:u.Actions.Archive}}))()}getMutationsForArchive(e,t,n){var i=this;return(0,a.default)((function*(){const a=[yield i.getArchiveChatMutation(e,t,n)];if(t&&(0,p.pinChatSyncEnabled)()){const t=r(36014).default;a.push(t.getPinMutation(e,!1,n))}return a}))()}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){var n,d;const p=e=>(0,o.decodeProtobuf)(E.SyncActionValueSpec,e),f=p(e.binarySyncAction),_=p(t.binarySyncAction),m=e.timestamp,g=t.timestamp,y=(0,s.default)(f.archiveChatAction,"pendingMutationValue.archiveChatAction"),S=(0,s.default)(_.archiveChatAction,"incomingMutationValue.archiveChatAction");switch((0,h.compareMessageRanges)((0,s.default)(S.messageRange,"incomingArchiveChatAction.messageRange"),(0,s.default)(y.messageRange,"pendingArchiveChatAction.messageRange"))){case h.MessageRangeEncloseType.RangeAEnclosesRangeB:return u.ConflictResolutionState.ApplyRemoteAndDropLocal;case h.MessageRangeEncloseType.RangeBEnclosesRangeA:return u.ConflictResolutionState.SkipRemote;case h.MessageRangeEncloseType.RangesAreEqual:return m<=g?u.ConflictResolutionState.ApplyRemoteAndDropLocal:u.ConflictResolutionState.SkipRemote;case h.MessageRangeEncloseType.RangesNotEnclosing:const t=m<=g?null!==(n=S.archived)&&void 0!==n&&n:null!==(d=y.archived)&&void 0!==d&&d,o=(0,h.mergeMessageRanges)((0,s.default)(S.messageRange,"incomingArchiveChatAction.messageRange"),(0,s.default)(y.messageRange,"pendingArchiveChatAction.messageRange")),p=(0,l.encodeProtobuf)(E.SyncActionValueSpec,(0,i.default)((0,i.default)({},_),{},{archiveChatAction:{archived:t,messageRange:o}})).readBuffer(),f=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:p});return delete f.id,yield(0,h.lockForMessageRangeSync)(["chat"],[f],(0,a.default)((function*(){const n=JSON.parse(e.index),i=(0,A.createWid)(n[1]);return yield(0,c.addActiveMessageRange)(i.toString(),(0,c.getActiveRangeAction)("archive"),p),r.setArchive([{id:i.toString(),archive:t}])}))),u.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const P=new b;Object.freeze(P);var M=P;t.default=M},28464:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(84902),o=r(38342),l=r(69702),c=n(r(21084)),d=r(69951),u=r(45606),p=n(r(73407)),h=r(57701),f=r(19937),_=r(76214),m=r(58052),g=n(r(68132)),y=r(99069),E=r(89835),S=r(22701),v=r(58021);class T extends E.SyncActionBase{constructor(){super(...arguments),this.version=4}decodeValue(e){if(!e.binarySyncData){if(!e.binarySyncAction)throw __LOG__(4,void 0,new Error,!0,["syncd"])`binarySyncAction should not be null`,SEND_LOGS("syncd binarySyncAction should not be null"),new Error("binarySyncAction should not be null");return(0,s.decodeProtobuf)(S.SyncActionValueSpec,e.binarySyncAction)}{const t=(0,s.decodeProtobuf)(S.SyncActionDataSpec,e.binarySyncData);if(t.value)return t.value}}applyMutations(e,t){var r=this;return(0,a.default)((function*(){c.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{setMutationsPendingToPersist:n}=t;if(e.length>0){const t=e[e.length-1];try{let e=[];if(!(0,h.archiveV2Supported)())return __LOG__(3)`archive setting sync: ArchiveV2 not supported yet`,[{actionState:u.SyncActionState.Unsupported}];if("set"===t.operation){const{value:s}=t,o=s.unarchiveChatsSetting;if(null==(null==o?void 0:o.unarchiveChats))return __LOG__(3)`archive setting sync: malformed mutation`,[{actionState:u.SyncActionState.Malformed}];const l=o.unarchiveChats;return(0,m.getArchiveV2EnabledSetting)()||((0,m.setArchiveV2EnabledSetting)(!0),g.default.archive=(0,i.default)((0,i.default)({},g.default.archive),{},{enabled:!0})),(0,m.setUnarchiveChatsSetting)(l),g.default.archive=(0,i.default)((0,i.default)({},g.default.archive),{},{classic:l}),yield(0,y.getStorage)().lock(["message","chat","sync-actions","active-message-ranges"],(0,a.default)((function*(){e=yield r.updateSideEffectOnChats(l,n),yield(0,_.getChatTable)().bulkCreateOrMerge(e)}))),e.forEach((e=>{const t=(0,v.createWid)(e.id),r=d.ChatCollection.get(t);r&&(r.archive=e.archive)})),[{actionState:u.SyncActionState.Success}]}return __LOG__(3)`archive setting sync: operation not supported`,[{actionState:u.SyncActionState.Unsupported}]}catch(e){return[{actionState:u.SyncActionState.Failed}]}}return __LOG__(3)`archive setting sync: no mutations`,[{actionState:u.SyncActionState.Failed}]}))()}handleSettingOn(e){var t=this;return(0,a.default)((function*(){const r=[];performance.now();const n=(yield(0,_.getChatTable)().all()).filter((e=>e.archive)).map((e=>e.id)),i=(yield Promise.all(n.map((e=>(0,o.getActiveMessageRanges)(e))))).flat().filter((e=>e.action===l.ActiveRangeAction.Archive)).map((e=>e.chatId)),a=n.filter((e=>!i.includes(e))),s=(yield Promise.all(a.map((t=>{const r=(0,v.createWid)(t),n=JSON.stringify([u.Actions.Archive,r.toString({legacy:!0})]),i=e.find((e=>e.index===n));return i?Promise.resolve(i):p.default.getSyncAction(n)})))).filter((e=>{if(!e)return!1;const r=t.decodeValue(e).archiveChatAction;return[u.SyncActionState.Success,u.SyncActionState.Orphan].includes(e.actionState)&&(null==r?void 0:r.archived)&&r.messageRange})).map((e=>{const r=e&&t.decodeValue(e).archiveChatAction;return[e?JSON.parse(e.index)[1]:"",null==r?void 0:r.messageRange]})),c=new Map(s),d=Array.from(c.keys()),h=yield Promise.all(d.map((e=>(0,f.constructMessageRange)((0,v.createWid)(e),!1))));return d.forEach(((e,t)=>{const n=h[t],i=c.get(e);if(i){const t=(0,f.compareMessageRanges)(n,i);if(t===f.MessageRangeEncloseType.RangeAEnclosesRangeB||t===f.MessageRangeEncloseType.RangesNotEnclosing){const t=(0,v.createWid)(e);r.push({id:t.toString({legacy:!1}),archive:!1})}else __LOG__(4,void 0,new Error,!0)`Archive_Setting_Sync: Unsupported rangeEnclosedType ${t}`,SEND_LOGS("ArchiveSettingSync setting true rangeEnclosedType unsupported")}})),performance.now(),r.length,r}))()}handleSettingOff(e){var t=this;return(0,a.default)((function*(){const r=[],n=yield p.default.getSyncActionsRows(["action"],[u.Actions.Archive]),i=e.filter((e=>e.action===u.Actions.Archive)),a=i.map((e=>e.index));return[...n.filter((e=>!a.includes(e.index))),...i].filter((e=>{if(e.actionState===u.SyncActionState.Success){var r;return null===(r=t.decodeValue(e).archiveChatAction)||void 0===r?void 0:r.archived}return!1})).forEach((e=>{const t=JSON.parse(e.index)[1],n=(0,v.createWid)(t);r.push({id:n.toString({legacy:!1}),archive:!0})})),r.length,r}))()}updateSideEffectOnChats(e,t){return e?this.handleSettingOn(t):this.handleSettingOff(t)}}const A=new T;Object.freeze(A);var C=A;t.default=C},29867:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(84902),l=r(60980),c=r(38342),d=n(r(21084)),u=r(69951),p=r(45606),h=n(r(73407)),f=r(57701),_=r(19937),m=n(r(11339)),g=r(76214),y=r(12492),E=r(89835),S=r(22701),v=r(22954),T=r(93824),A=n(r(39546)),C=r(58021);class b extends E.SyncActionBase{constructor(){super(...arguments),this.version=6}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,v.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}_getMessageIdsThatWereUnstarredInCurrentPatch(e,t){const r=new Set;return e.forEach((e=>{if(e.actionName===p.Actions.Star&&e.timestamp>t){const t=(0,T.getMsgKeyFromStarActionIndex)(e.index);r.add(t.toString())}})),r}validateSyncActionValue(e){const t=e.clearChatAction;return(0,_.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e,t){var r=this;d.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{allSupportedSetMutations:n}=t;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,f.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][clear-chat]: not enabled`,Promise.resolve({actionState:p.SyncActionState.Unsupported});if("set"===e.operation){var t;const{indexParts:i,value:a}=e,[,o,l,c]=i;if(o&&l&&c||(0,v.throwInvalidActionIndex)(),!A.default.isWid(o))return(0,T.uploadCriticalEventMetric)(m.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:p.SyncActionState.Malformed};if(!r.validateSyncActionValue(a))return __LOG__(3)`[syncd][clear-chat]: malformed mutation`,{actionState:p.SyncActionState.Malformed};const d=(0,s.default)(null===(t=a.clearChatAction)||void 0===t?void 0:t.messageRange,"value.clearChatAction?.messageRange"),u=(0,C.createWid)(o),h=u.toString();if(!(yield(0,g.getChatTable)().get(h)))return{actionState:p.SyncActionState.Orphan,orphanModel:{modelType:p.SyncModelType.Chat,modelId:h}};const f=r._getMessageIdsThatWereUnstarredInCurrentPatch(n,e.timestamp);return r._applyMutation(u,d,"1"===l,"0"===c,f,a)}return __LOG__(3)`[syncd][clear-chat]: REMOVE operation not supported`,{actionState:p.SyncActionState.Unsupported}}catch(e){return{actionState:p.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}clearChat(e,t,n,i){return(0,a.default)((function*(){const{queryAndRemoveMessagesInMessageRange:a}=r(13946),s=yield a(e,t,{skipStarred:!n,skipMessages:i}),o=u.ChatCollection.get(e);o&&o.deleteMessages(s)}))()}_applyMutation(e,t,r,n,i,s){var o=this;return(0,a.default)((function*(){const a=(0,l.encodeProtobuf)(S.SyncActionValueSpec,s).readBuffer();return yield(0,c.addActiveMessageRange)(e.toString(),(0,c.getActiveRangeAction)("clearChat",{deleteMedia:n,deleteStarred:r}),a),yield o.clearChat(e,t,r,i),{actionState:p.SyncActionState.Success}}))()}getClearChatMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){let a=yield(0,_.constructForwardMovingMessageRange)(t);const s=i._constructClearChatIndex(t,r,n||!1),c=yield h.default.getPendingMutationsRowsByIndex(["index"],s);if(c.length){var d;const e=c.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(d=(0,o.decodeProtobuf)(S.SyncActionValueSpec,e.binarySyncAction).clearChatAction)||void 0===d?void 0:d.messageRange;t&&(a=(0,_.mergeMessageRanges)(a,t))}const u={timestamp:e,clearChatAction:{messageRange:a}};return{collection:p.CollectionName.RegularHigh,index:s,binarySyncAction:(0,l.encodeProtobuf)(S.SyncActionValueSpec,u).readBuffer(),version:i.version,operation:y.SyncdMutationSyncdOperation.SET,timestamp:e,action:p.Actions.ClearChat}}))()}_constructClearChatIndex(e,t,r){return JSON.stringify([p.Actions.ClearChat,e.toString({legacy:!0}),t?"1":"0",r?"1":"0"])}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){const n=e=>(0,o.decodeProtobuf)(S.SyncActionValueSpec,e),d=n(e.binarySyncAction),u=n(t.binarySyncAction),h=e.timestamp,f=t.timestamp,m=(0,s.default)(d.clearChatAction,"pendingMutationValue.clearChatAction"),g=(0,s.default)(u.clearChatAction,"incomingMutationValue.clearChatAction");switch((0,_.compareMessageRanges)((0,s.default)(g.messageRange,"incomingClearChatAction.messageRange"),(0,s.default)(m.messageRange,"pendingClearChatAction.messageRange"))){case _.MessageRangeEncloseType.RangeAEnclosesRangeB:return p.ConflictResolutionState.ApplyRemoteAndDropLocal;case _.MessageRangeEncloseType.RangeBEnclosesRangeA:return p.ConflictResolutionState.SkipRemote;case _.MessageRangeEncloseType.RangesAreEqual:return h<=f?p.ConflictResolutionState.ApplyRemoteAndDropLocal:p.ConflictResolutionState.SkipRemote;case _.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,_.mergeMessageRanges)((0,s.default)(g.messageRange,"incomingClearChatAction.messageRange"),(0,s.default)(m.messageRange,"pendingClearChatAction.messageRange")),n=(0,l.encodeProtobuf)(S.SyncActionValueSpec,(0,i.default)((0,i.default)({},u),{},{clearChatAction:{messageRange:t}})).readBuffer(),o=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:n});return delete o.id,yield(0,_.lockForMessageRangeSync)([],[o],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,C.createWid)(i[1]),s="1"===i[2],o="1"===i[3];return yield(0,c.addActiveMessageRange)(a.toString(),(0,c.getActiveRangeAction)("clearChat",{deleteStarred:s,deleteMedia:o}),n),r.clearChat(a,t,s)}))),p.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const P=new b;Object.freeze(P);var M=P;t.default=M},24900:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(19797),o=r(45606),l=n(r(121)),c=r(35673),d=r(19380),u=r(76214),p=r(959),h=r(89835),f=r(66837),_=r(22954),m=r(58021);class g extends h.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return(0,a.default)((function*(){const t=[],r=[],n=yield Promise.all(e.map((e=>{try{const a=e.indexParts,[,s]=a;s||(0,_.throwInvalidActionIndex)();const c=(0,m.createUserWid)(s);if("set"===e.operation){var n;const r=e.value.contactAction;if(!r)return __LOG__(3)`contact sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const a={id:s,name:r.fullName||"",shortName:r.firstName||(null!==(n=(0,p.getShortName)(r.fullName))&&void 0!==n?n:""),type:"in",isAddressBookContact:1,isContactSyncCompleted:0};return t.push(a),d.ContactCollection.add((0,i.default)((0,i.default)({},a),{},{id:c}),{merge:!0}),(0,f.syncNewContact)(c),{actionState:o.SyncActionState.Success}}if("remove"===e.operation){const e=d.ContactCollection.get(c);null!=e&&e.setNotMyContact();const t=new l.default({id:c,type:"in"});return r.push(c),d.ContactCollection.remove(t),{actionState:o.SyncActionState.Success}}return __LOG__(3)`contact sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}})));if(yield(0,u.getContactTable)().bulkCreateOrMerge(t),r.length>0){const e=r.map((e=>(0,s.toUserJid)(e.user)));yield(0,c.setNotAddressBookContacts)(e)}return n}))()}}const y=new g;Object.freeze(y);var E=y;t.default=E},56928:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(84902),l=r(60980),c=r(38342),d=n(r(21084)),u=r(69951),p=r(45606),h=n(r(73407)),f=r(77772),_=r(57701),m=r(19937),g=n(r(11339)),y=r(76214),E=r(13946),S=r(12492),v=r(89835),T=r(22701),A=r(22954),C=r(93824),b=n(r(39546)),P=r(58021);class M extends v.SyncActionBase{constructor(){super(...arguments),this.version=6}validateSyncActionValue(e){const t=e.deleteChatAction;return(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return d.default.updatePrimaryAllowsAllMutationsFlag("other mutation"),Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,_.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][delete-chat]: not enabled`,Promise.resolve({actionState:p.SyncActionState.Unsupported});if("set"===e.operation){var r;const{indexParts:n,value:i}=e,[,a,o]=n;if(a&&o||(0,A.throwInvalidActionIndex)(),!b.default.isWid(a))return(0,C.uploadCriticalEventMetric)(g.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:p.SyncActionState.Malformed};if(!t.validateSyncActionValue(i))return __LOG__(3)`[syncd][delete-chat]: malformed mutation`,{actionState:p.SyncActionState.Malformed};const l=(0,s.default)(null===(r=i.deleteChatAction)||void 0===r?void 0:r.messageRange,"value.deleteChatAction?.messageRange"),c=(0,P.createWid)(a),d=c.toString();return(yield(0,y.getChatTable)().get(d))?t._applyMutation(c,l,"0"===o,i):{actionState:p.SyncActionState.Orphan,orphanModel:{modelType:p.SyncModelType.Chat,modelId:d}}}return __LOG__(3)`[syncd][delete-chat]: REMOVE operation not supported`,{actionState:p.SyncActionState.Unsupported}}catch(e){return{actionState:p.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}deleteChat(e,t){return(0,a.default)((function*(){const r=u.ChatCollection.get(e);if(t){const n=yield(0,E.queryAndRemoveMessagesInMessageRange)(e,t);r&&r.deleteMessages(n)}else yield(0,f.deleteFromStorage)(e),r&&r.delete()}))()}_applyMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){const a=(0,l.encodeProtobuf)(T.SyncActionValueSpec,n).readBuffer();yield(0,c.addActiveMessageRange)(e.toString(),(0,c.getActiveRangeAction)("deleteChat",{deleteMedia:r}),a);const s=yield(0,m.constructMessageRange)(e,!1);switch((0,m.compareMessageRanges)(s,t)){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:case m.MessageRangeEncloseType.RangesNotEnclosing:yield i.deleteChat(e,t);break;default:yield i.deleteChat(e)}return{actionState:p.SyncActionState.Success}}))()}getDeleteChatMutation(e,t,r){var n=this;return(0,a.default)((function*(){let i=yield(0,m.constructForwardMovingMessageRange)(t);const a=n._constructDeleteChatIndex(t,r||!1),s=yield h.default.getPendingMutationsRowsByIndex(["index"],a);if(s.length){var c;const e=s.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(c=(0,o.decodeProtobuf)(T.SyncActionValueSpec,e.binarySyncAction).deleteChatAction)||void 0===c?void 0:c.messageRange;t&&(i=(0,m.mergeMessageRanges)(i,t))}const d={timestamp:e,deleteChatAction:{messageRange:i}};return{collection:p.CollectionName.RegularHigh,index:a,binarySyncAction:(0,l.encodeProtobuf)(T.SyncActionValueSpec,d).readBuffer(),version:n.version,operation:S.SyncdMutationSyncdOperation.SET,timestamp:e,action:p.Actions.DeleteChat}}))()}_constructDeleteChatIndex(e,t){return JSON.stringify([p.Actions.DeleteChat,e.toString({legacy:!0}),t?"1":"0"])}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){const n=e=>(0,o.decodeProtobuf)(T.SyncActionValueSpec,e),d=n(e.binarySyncAction),u=n(t.binarySyncAction),h=e.timestamp,f=t.timestamp,_=(0,s.default)(d.deleteChatAction,"pendingMutationValue.deleteChatAction"),g=(0,s.default)(u.deleteChatAction,"incomingMutationValue.deleteChatAction");switch((0,m.compareMessageRanges)((0,s.default)(g.messageRange,"incomingDeleteChatAction.messageRange"),(0,s.default)(_.messageRange,"pendingDeleteChatAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return p.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return p.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return h<=f?p.ConflictResolutionState.ApplyRemoteAndDropLocal:p.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,m.mergeMessageRanges)((0,s.default)(g.messageRange,"incomingDeleteChatAction.messageRange"),(0,s.default)(_.messageRange,"pendingDeleteChatAction.messageRange")),n=(0,l.encodeProtobuf)(T.SyncActionValueSpec,(0,i.default)((0,i.default)({},u),{},{deleteChatAction:{messageRange:t}})).readBuffer(),o=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:n});return delete o.id,yield(0,m.lockForMessageRangeSync)([],[o],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,P.createWid)(i[1]);return yield(0,c.addActiveMessageRange)(a.toString(),(0,c.getActiveRangeAction)("deleteChat",{deleteMedia:"1"===i[2]}),n),r.deleteChat(a,t)}))),p.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const O=new M;Object.freeze(O);var I=O;t.default=I},41058:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(92844),o=r(84902),l=r(60980),c=r(45606),d=r(84886),u=n(r(11339)),p=r(76214),h=r(59871),f=r(12492),_=r(89835),m=r(22701),g=r(22954),y=r(93824),E=n(r(39546));class S extends _.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return(0,i.default)((function*(){const t=[],r=new Map;yield(0,p.getMessageTable)().bulkGet(e.map((e=>{const[,t,r,n,i]=e.indexParts;return t&&r&&n&&i&&E.default.isWid(t)?(0,g.syncKeyToMsgKey)(t,r,n,i).toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.set(e.id,e)}))));const n=yield Promise.all(e.map((e=>{try{if("set"===e.operation){const[,n,i,a,s]=e.indexParts;if(n&&i&&a&&s||(0,g.throwInvalidActionIndex)(),!E.default.isWid(n))return(0,y.uploadCriticalEventMetric)(u.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:c.SyncActionState.Malformed};const o=(0,g.syncKeyToMsgKey)(n,i,a,s),l=r.get(o.toString());if(!l)return{actionState:c.SyncActionState.Orphan,orphanModel:{modelId:o.toString(),modelType:c.SyncModelType.Msg}};t.push(l.id);const d=h.MsgCollection.get(o);return d?d.delete():__LOG__(3)`delete_message_for_me_sync: msg ${o} found in storage but not in collection`,{actionState:c.SyncActionState.Success}}return __LOG__(3)`delete_message_for_me_sync: operation not supported`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}})));return t.length>0&&(yield(0,d.removeMessagesFromHistory)(t)),n}))()}resolveConflicts(e,t){var r,n;const i=e=>(0,o.decodeProtobuf)(m.SyncActionValueSpec,e),s=(0,a.default)(null===(r=i(e.binarySyncAction).deleteMessageForMeAction)||void 0===r?void 0:r.deleteMedia,"decodeValue(localMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia");return!(0,a.default)(null===(n=i(t.binarySyncAction).deleteMessageForMeAction)||void 0===n?void 0:n.deleteMedia,"decodeValue(remoteMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia")&&s?Promise.resolve(c.ConflictResolutionState.SkipRemote):Promise.resolve(c.ConflictResolutionState.SkipRemoteAndDropLocal)}getDeleteForMeMutations(e,t){const r=(0,s.unixTimeMs)();return e.map((e=>{const n={deleteMessageForMeAction:{deleteMedia:t,messageTimestamp:e.t},timestamp:r};return{collection:c.CollectionName.RegularHigh,index:JSON.stringify([c.Actions.DeleteMessageForMe,e.id.remote.toString({legacy:!0}),e.id.id,e.id.fromMe?"1":"0",e.isGroupMsg&&!e.id.fromMe?e.sender.toString({legacy:!0}):"0"]),binarySyncAction:(0,l.encodeProtobuf)(m.SyncActionValueSpec,n).readBuffer(),version:this.version,operation:f.SyncdMutationSyncdOperation.SET,timestamp:r,action:c.Actions.DeleteMessageForMe}}))}}const v=new S;Object.freeze(v);var T=v;t.default=T},12123:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(68638),o=r(45606),l=r(82663),c=r(31912),d=r(905),u=n(r(11339)),p=r(99069),h=r(89835),f=r(22954),_=r(93824),m=n(r(39546)),g=r(58021);class y extends h.SyncActionBase{constructor(){super(...arguments),this.version=o.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:n,value:a}=e,[,h,y]=n;h&&y||(0,f.throwInvalidActionIndex)();const E=null===(t=a.labelAssociationAction)||void 0===t?void 0:t.labeled;if(null==E)return __LOG__(3)`label jid sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};if(!m.default.isWid(y))return(0,_.uploadCriticalEventMetric)(u.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:o.SyncActionState.Malformed};const S=(0,g.createWid)(y),v=S.toString(),T={labelId:h,associationId:v,type:l.LabelAssociationType.Jid};if(E){const e=yield(0,s.getTable)().get(v),t=r(63183).Chat,n=e?null:new t({id:S});yield(0,p.getStorage)().lock(["chat","label-association"],(()=>Promise.all([(0,l.getTable)().createOrReplace(T),n?(0,s.getTable)().create((0,i.default)((0,i.default)({},n.toJSON()),{},{id:v})):null]))),n&&r(69951).ChatCollection.add(n),(0,d.addToLabelCollection)(v,[h],c.LabelItemParentType.Chat)}else yield(0,l.getTable)().remove([h,v,l.LabelAssociationType.Jid]),(0,d.removeLabelFromCollection)(v,h,c.LabelItemParentType.Chat);return{actionState:o.SyncActionState.Success}}return __LOG__(3)`label jid sync: unsupported operation`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const E=new y;Object.freeze(E);var S=E;t.default=S},35096:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(45606),s=r(82663),o=r(31912),l=r(905),c=r(84886),d=n(r(11339)),u=r(89835),p=r(22954),h=r(93824),f=n(r(39546));class _ extends u.SyncActionBase{constructor(){super(...arguments),this.version=a.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:n}=e,[,i,u,_,m,g]=r;i&&u&&_&&m&&g||(0,p.throwInvalidActionIndex)();const y=null===(t=n.labelAssociationAction)||void 0===t?void 0:t.labeled;if(null==y)return __LOG__(3)`label message sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};if(!f.default.isWid(u))return(0,h.uploadCriticalEventMetric)(d.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:a.SyncActionState.Malformed};const E=(0,p.syncKeyToMsgKey)(u,_,m,g).toString();if(!(yield(0,c.getMsgByMsgKey)(E)))return{actionState:a.SyncActionState.Orphan,orphanModel:{modelId:E,modelType:a.SyncModelType.Msg}};const S={labelId:i,associationId:E,type:s.LabelAssociationType.Message};return y?(yield(0,s.getTable)().createOrReplace(S),(0,l.addToLabelCollection)(E,[i],o.LabelItemParentType.Msg)):(yield(0,s.getTable)().remove([i,E,s.LabelAssociationType.Message]),(0,l.removeLabelFromCollection)(E,i,o.LabelItemParentType.Msg)),{actionState:a.SyncActionState.Success}}return __LOG__(3)`label message sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const m=new _;Object.freeze(m);var g=m;t.default=g},80056:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(45606),o=r(94337),l=r(16770),c=r(89835),d=r(22954);class u extends c.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:n}=e,[,a]=r;a||(0,d.throwInvalidActionIndex)();const c=n.labelEditAction;if(!c)return __LOG__(3)`label sync: malformed mutation`,{actionState:s.SyncActionState.Malformed};if(c.deleted)return yield(0,o.getTable)().remove(a),l.LabelCollection.remove(a),{actionState:s.SyncActionState.Success};const{color:u,predefinedId:p}=c,h=null!==(t=c.name)&&void 0!==t?t:"";""===h&&__LOG__(3)`labelEditAction.name is empty`,null==u&&__LOG__(3)`labelEditAction.color is empty`;const f={id:a,name:h,colorIndex:u,predefinedId:p};return yield(0,o.getTable)().createOrReplace(f),l.LabelCollection.add((0,i.default)({},f),{merge:!0}),{actionState:s.SyncActionState.Success}}return __LOG__(3)`label sync: operation not supported`,{actionState:s.SyncActionState.Unsupported}}catch(e){return{actionState:s.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const p=new u;Object.freeze(p);var h=p;t.default=h},79171:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(45606),s=n(r(69618)),o=n(r(43725)),l=r(89835);class c extends l.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{value:t}=e,r=t.localeSetting;if(!r)return __LOG__(3)`locale setting sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const n=r.locale;return yield o.default.setLocale(n,s.default.L10N_PRIORITY.PHONE),{actionState:a.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const d=new c;Object.freeze(d);var u=d;t.default=u},64294:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(84902),l=r(60980),c=r(38342),d=r(69951),u=r(45606),p=n(r(69618)),h=r(19937),f=n(r(11339)),_=r(76214),m=r(12492),g=r(89835),y=r(22701),E=r(22954),S=r(93824),v=n(r(39546)),T=r(58021);function A(e,t){switch(t){case h.MessageRangeEncloseType.RangesAreEqual:case h.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:u.SyncActionState.Success};case h.MessageRangeEncloseType.RangeBEnclosesRangeA:case h.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:e.toString()}}}}class C extends g.SyncActionBase{constructor(){super(...arguments),this.version=3}_setRead(e,t){const n=d.ChatCollection.get(e);if(n){const e=r(9609);t?e.markSeen(n):e.markUnseen(n)}}_isChatMarkedUnreadByUser(e){return(0,a.default)((function*(){const t=yield(0,_.getChatTable)().get(e.toString());return(null==t?void 0:t.unreadCount)===p.default.MARKED_AS_UNREAD}))()}validateSyncActionValue(e){const t=e.markChatAsReadAction;return null!=(null==t?void 0:t.read)&&(0,h.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var r,n;const{indexParts:i,value:a}=e,[,o]=i;if(o||(0,E.throwInvalidActionIndex)(),!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][mark-chat-as-read]: malformed mutation`,{actionState:u.SyncActionState.Malformed};if(!v.default.isWid(o))return(0,S.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:u.SyncActionState.Malformed};const l=(0,s.default)(null===(r=a.markChatAsReadAction)||void 0===r?void 0:r.read,"value.markChatAsReadAction?.read"),c=(0,s.default)(null===(n=a.markChatAsReadAction)||void 0===n?void 0:n.messageRange,"value.markChatAsReadAction?.messageRange"),d=(0,T.createWid)(o),p=d.toString();return(yield(0,_.getChatTable)().get(p))?t._applyMutation(d,l,c,a):{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:p}}}return __LOG__(3)`[syncd][mark-chat-as-read]: operation not supported`,{actionState:u.SyncActionState.Unsupported}}catch(e){return{actionState:u.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}_applyMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){yield(0,c.removeActiveMessageRange)(e.toString(),(0,c.getActiveRangeAction)("markChatAsRead"));const a=yield(0,h.constructMessageRange)(e,!1),s=(0,h.compareMessageRanges)(a,r),o=(0,l.encodeProtobuf)(y.SyncActionValueSpec,n).readBuffer();switch(s){case h.MessageRangeEncloseType.RangesAreEqual:case h.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield(0,c.addActiveMessageRange)(e.toString(),(0,c.getActiveRangeAction)("markChatAsRead"),o),i._setRead(e,t),Promise.resolve(A(e,s));case h.MessageRangeEncloseType.RangesNotEnclosing:case h.MessageRangeEncloseType.RangeAEnclosesRangeB:return t&&(yield i._isChatMarkedUnreadByUser(e))&&i._setRead(e,t),Promise.resolve(A(e,s))}}))()}_constructMarkChatAsReadIndex(e){return JSON.stringify([u.Actions.MarkChatAsRead,e.toString({legacy:!0})])}getMarkChatAsReadMutation(e,t,r){var n=this;return(0,a.default)((function*(){const i={timestamp:e,markChatAsReadAction:{read:t,messageRange:yield(0,h.constructMessageRange)(r,!0)}};return{collection:u.CollectionName.RegularLow,index:n._constructMarkChatAsReadIndex(r),binarySyncAction:(0,l.encodeProtobuf)(y.SyncActionValueSpec,i).readBuffer(),version:n.version,operation:m.SyncdMutationSyncdOperation.SET,timestamp:e,action:u.Actions.MarkChatAsRead}}))()}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){var n,d;const p=e=>(0,o.decodeProtobuf)(y.SyncActionValueSpec,e),f=p(e.binarySyncAction),_=p(t.binarySyncAction),m=e.timestamp,g=t.timestamp,E=(0,s.default)(f.markChatAsReadAction,"pendingMutationValue.markChatAsReadAction"),S=(0,s.default)(_.markChatAsReadAction,"incomingMutationValue.markChatAsReadAction");switch((0,h.compareMessageRanges)((0,s.default)(S.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,s.default)(E.messageRange,"pendingMarkChatAsReadAction.messageRange"))){case h.MessageRangeEncloseType.RangeAEnclosesRangeB:return u.ConflictResolutionState.ApplyRemoteAndDropLocal;case h.MessageRangeEncloseType.RangeBEnclosesRangeA:return u.ConflictResolutionState.SkipRemote;case h.MessageRangeEncloseType.RangesAreEqual:return m<=g?u.ConflictResolutionState.ApplyRemoteAndDropLocal:u.ConflictResolutionState.SkipRemote;case h.MessageRangeEncloseType.RangesNotEnclosing:const t=m<=g?null!==(n=S.read)&&void 0!==n&&n:null!==(d=E.read)&&void 0!==d&&d,o=(0,h.mergeMessageRanges)((0,s.default)(S.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,s.default)(E.messageRange,"pendingMarkChatAsReadAction.messageRange")),p=(0,l.encodeProtobuf)(y.SyncActionValueSpec,(0,i.default)((0,i.default)({},_),{},{markChatAsReadAction:{read:t,messageRange:o}})).readBuffer(),f=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:p});return delete f.id,yield(0,h.lockForMessageRangeSync)(["chat"],[f],(0,a.default)((function*(){const n=JSON.parse(e.index),i=(0,T.createWid)(n[1]);return yield(0,c.addActiveMessageRange)(i.toString(),(0,c.getActiveRangeAction)("markChatAsRead"),p),r._setRead(i,t)}))),u.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const b=new C;Object.freeze(b);var P=b;t.default=P},19937:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageRangeEncloseType=void 0,t.compareMessageRanges=function(e,t){const r=E(e,t),n=E(t,e);return r&&n?y.RangesAreEqual:r?y.RangeAEnclosesRangeB:n?y.RangeBEnclosesRangeA:y.RangesNotEnclosing},t.constructForwardMovingMessageRange=function(){return P.apply(this,arguments)},t.constructMessageRange=S,t.lockForMessageRangeSync=void 0,t.mergeMessageRanges=A,t.validateMessageRange=function(e){if(null==e)return(0,_.uploadCriticalEventMetric)(p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_UNSET),!1;for(const[t,r]of C)if(r(e))return(0,_.uploadCriticalEventMetric)(t),!1;for(const t of e.messages)for(const[e,r]of b)if(r(t))return(0,_.uploadCriticalEventMetric)(e),!1;return!0};var i=n(r(48926)),a=r(8243),s=r(84902),o=r(38342),l=r(69702),c=r(45606),d=n(r(73407)),u=r(30986),p=n(r(11339)),h=r(22701),f=r(38804),_=r(93824),m=n(r(39546)),g=r(58021);const y=r(54302).Mirrored(["RangeAEnclosesRangeB","RangeBEnclosesRangeA","RangesAreEqual","RangesNotEnclosing"]);function E(e,t){const r=new Set(e.messages.map((e=>{var t;return null===(t=e.key)||void 0===t?void 0:t.id})));for(let e=0;e<t.messages.length;e++){var n;if(null==t.messages[e].timestamp)if(!r.has(null===(n=t.messages[e].key)||void 0===n?void 0:n.id))return!1}for(let n=0;n<t.messages.length;n++){var i,s,o;if(!r.has(null===(i=t.messages[n].key)||void 0===i?void 0:i.id)&&(0,a.numberOrThrowIfTooLarge)(null!==(s=e.lastMessageTimestamp)&&void 0!==s?s:0)<=(0,a.numberOrThrowIfTooLarge)(null!==(o=t.messages[n].timestamp)&&void 0!==o?o:0))return!1}return!0}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,r){let n=yield(0,u.getLastMessageTimestamp)(e);const i=yield(0,u.getLastSystemMessageTimestamp)(e),{messages:s,newLastMessageTimestamp:o}=yield(0,u.getAdditionalMessages)(e,n,r);if(null!=o&&(n=o),null==n){var l;n=null===(l=s.sort(u.timestampComparison)[s.length-1])||void 0===l?void 0:l.timestamp}const c={messages:s};if(null!=n&&(c.lastMessageTimestamp=n),null!=i&&(null==n||i>(0,a.numberOrThrowIfTooLarge)(n))&&(c.lastSystemMessageTimestamp=i),t&&null==c.lastMessageTimestamp){const t=yield(0,u.getFirstSystemMessageTimestamp)(e);null!=t&&(c.lastMessageTimestamp=t,t===i&&(c.lastSystemMessageTimestamp=void 0))}return c}))).apply(this,arguments)}function T(e,t,r){const n=new Map;return e.concat(t).forEach((e=>{var t,i,s;const o=null!==(t=null===(i=e.key)||void 0===i?void 0:i.id)&&void 0!==t?t:"";if((0,a.numberOrThrowIfTooLarge)(null!==(s=e.timestamp)&&void 0!==s?s:0)>=r){const t=n.get(o);var l,c;if(t)n.set(o,(0,a.numberOrThrowIfTooLarge)(null!==(l=t.timestamp)&&void 0!==l?l:0)<(0,a.numberOrThrowIfTooLarge)(null!==(c=e.timestamp)&&void 0!==c?c:0)?e:t);else n.set(o,e)}})),Array.from(n.values())}function A(e,t){var r,n;const i=(0,a.numberOrThrowIfTooLarge)(null!==(r=e.lastMessageTimestamp)&&void 0!==r?r:0),s=(0,a.numberOrThrowIfTooLarge)(null!==(n=t.lastMessageTimestamp)&&void 0!==n?n:0),o=Math.max(i,s),l={messages:T(e.messages,t.messages,o)};if(0!==o&&(l.lastMessageTimestamp=o),null!=e.lastSystemMessageTimestamp||null!=t.lastSystemMessageTimestamp){var c,d;const r=Math.max((0,a.numberOrThrowIfTooLarge)(null!==(c=e.lastSystemMessageTimestamp)&&void 0!==c?c:0),(0,a.numberOrThrowIfTooLarge)(null!==(d=t.lastSystemMessageTimestamp)&&void 0!==d?d:0));(null==o||r>o)&&(l.lastSystemMessageTimestamp=r)}return l}t.MessageRangeEncloseType=y;const C=[[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET,e=>{let{lastSystemMessageTimestamp:t,lastMessageTimestamp:r}=e;return null!=t&&null!=r&&(0,a.numberOrThrowIfTooLarge)(t)<(0,a.numberOrThrowIfTooLarge)(r)}],[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGES_CROSS_LIMIT,e=>e.messages.filter((e=>null!=e.timestamp)).length>1e3]],b=[[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_UNSET,e=>null==e.key],[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.fromMe)}],[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.id)}],[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID,e=>{var t;return!(0,g.isWidlike)(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[p.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET,e=>{var t,r,n;return m.default.isGroup(null===(t=e.key)||void 0===t?void 0:t.remoteJid)&&!(null===(r=e.key)||void 0===r?void 0:r.fromMe)&&null==(null===(n=e.key)||void 0===n?void 0:n.participant)}]];function P(){return(P=(0,i.default)((function*(e,t){var r;let n=yield S(e,!0,t);(yield(0,o.getActiveMessageRanges)(e.toString())).forEach((e=>{switch(e.action){case l.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case l.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:case l.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case l.ActiveRangeAction.ClearChatKeepStarredKeepMedia:case l.ActiveRangeAction.DeleteChatDeleteMedia:case l.ActiveRangeAction.DeleteChatKeepMedia:const t=e.actionValue.messageRange;t&&(n=A(n,t));break;case l.ActiveRangeAction.Archive:case l.ActiveRangeAction.MarkChatAsRead:}}));const i=yield M(e);return n.messages=T(n.messages,i,(0,a.numberOrThrowIfTooLarge)(null!==(r=n.lastMessageTimestamp)&&void 0!==r?r:0)),n=(0,u.fixMessageRange)(n),n}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=[];return(yield d.default.getSyncActionsRows(["action"],[c.Actions.DeleteMessageForMe])).forEach((r=>{const n=e.toString({legacy:!0}),i=JSON.parse(r.index);if(5!==i.length)__LOG__(2)`constructForwardMovingMessageRange: delete for me mutation index malformed ${r.index}`;else if(n===i[1]&&r.actionState===c.SyncActionState.Success){var a;const e=null===(a=(0,s.decodeProtobuf)(h.SyncActionValueSpec,r.binarySyncAction).deleteMessageForMeAction)||void 0===a?void 0:a.messageTimestamp;if(null==e)__LOG__(2)`constructForwardMovingMessageRange: deleteMessageForMeAction malformed`;else{const r={remoteJid:i[1],id:i[2],fromMe:"1"===i[3],participant:"0"!==i[4]?i[4]:void 0};t.push({key:r,timestamp:e})}}})),t}))).apply(this,arguments)}t.lockForMessageRangeSync=(e,t,r)=>(0,f.lockForSync)([...e,"message","active-message-ranges"],t,r)},70119:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(8243),s=r(92844),o=r(60980),l=r(45606),c=n(r(11339)),d=r(76214),u=r(72472),p=r(12492),h=r(89835),f=r(22701),_=r(22954),m=r(93824),g=n(r(39546)),y=r(58021);class E extends h.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:n}=e,[,i]=r;if(i||(0,_.throwInvalidActionIndex)(),!g.default.isWid(i))return(0,m.uploadCriticalEventMetric)(c.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:l.SyncActionState.Malformed};const o=n.muteAction,p=null===(t=n.muteAction)||void 0===t?void 0:t.muted,h=(0,a.maybeNumberOrThrowIfTooLarge)(null==o?void 0:o.muteEndTimestamp);if(null==p||p&&null==h)return __LOG__(3)`mute chat sync: malformed mutation`,{actionState:l.SyncActionState.Malformed};const f=(0,y.createWid)(i);if(!(yield(0,d.getChatTable)().get(f.toString())))return{actionState:l.SyncActionState.Orphan,orphanModel:{modelType:l.SyncModelType.Chat,modelId:f.toString()}};const E=null!=h?h:0,S=E>0&&E<(0,s.unixTimeMs)()?0:Math.floor(E/1e3);return yield(0,d.getChatTable)().merge(f.toString(),{muteExpiration:S}),u.MuteCollection.add({id:f,expiration:S},{merge:!0}),{actionState:l.SyncActionState.Success}}return __LOG__(3)`mute chat sync: operation not supported`,{actionState:l.SyncActionState.Unsupported}}catch(e){return{actionState:l.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}generateMuteMutation(e,t){const r=void 0!==t&&0!==t,n=(0,s.unixTimeMs)();let i=t;-1!==i&&(i*=1e3);const a={timestamp:n,muteAction:{muted:r,muteEndTimestamp:i}};return{collection:l.CollectionName.RegularHigh,index:JSON.stringify([l.Actions.Mute,e.toString({legacy:!0})]),operation:p.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,o.encodeProtobuf)(f.SyncActionValueSpec,a).readBuffer(),timestamp:n,action:l.Actions.Mute}}}const S=new E;Object.freeze(S);var v=S;t.default=v},36014:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(8243),s=n(r(45095)),o=r(92844),l=r(84902),c=r(60980),d=n(r(21084)),u=n(r(74362)),p=r(45606),h=n(r(73407)),f=r(9025),_=r(57701),m=n(r(11339)),g=r(76214),y=r(12492),E=r(89835),S=r(22701),v=r(38804),T=r(22954),A=r(93824),C=n(r(39546)),b=r(58021);class P extends E.SyncActionBase{constructor(){super(...arguments),this.version=5}applyMutations(e){var t=this;return(0,i.default)((function*(){d.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const r=[];for(let n=0;n<e.length;n++)r.push(yield t.applyMutation(e[n]));return r}))()}applyMutation(e){var t=this;return(0,i.default)((function*(){if("remove"===e.operation)return __LOG__(3)`syncd: pin_chat_sync: REMOVE not supported`,Promise.resolve({actionState:p.SyncActionState.Unsupported});if(!(0,_.pinChatSyncEnabled)())return __LOG__(3)`syncd: pin_chat_sync: not enabled`,Promise.resolve({actionState:p.SyncActionState.Unsupported});const{indexParts:r,value:n,timestamp:i}=e,[,a]=r;try{if(a||(__LOG__(3)`syncd: pin_chat_sync: missing chatId in index`,(0,T.throwInvalidActionIndex)()),!C.default.isWid(a))return(0,A.uploadCriticalEventMetric)(m.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:p.SyncActionState.Malformed};const e=(0,b.createWid)(a),{pinAction:r}=n;if(null==r)return __LOG__(3)`syncd: pin_chat_sync: missing pinAction`,Promise.resolve({actionState:p.SyncActionState.Malformed});const{pinned:s}=r;if(null==s)return __LOG__(3)`syncd: pin_chat_sync: missing pinned field`,Promise.resolve({actionState:p.SyncActionState.Malformed});if(null==(yield(0,g.getChatTable)().get(e.toString())))return{actionState:p.SyncActionState.Orphan,orphanModel:{modelType:p.SyncModelType.Chat,modelId:e.toString()}};if(!s)return yield t.applyUpdates([{wid:e,pinned:!1,timestamp:i}]),{actionState:p.SyncActionState.Success};const o=yield t.getLocalPins();if(o.some((t=>t.chatId.toString()===e.toString())))return yield t.applyUpdates([{wid:e,pinned:s,timestamp:i}]),{actionState:p.SyncActionState.Success};if(o.length<3)return yield t.applyUpdates([{wid:e,pinned:s,timestamp:i}]),{actionState:p.SyncActionState.Success};const l=o.reduce(((e,t)=>t.timestamp<e.timestamp?t:e)),c=[],d=l.timestamp<i?l.chatId:e;return d===l.chatId&&c.push({wid:l.chatId,pinned:!1,timestamp:i},{wid:e,pinned:!0,timestamp:i}),yield Promise.all([t.applyUpdates(c),t.createPendingUnpin(d,i)]),Promise.resolve({actionState:p.SyncActionState.Success})}catch(e){return{actionState:p.SyncActionState.Failed}}}))()}applyUpdates(e){return(0,i.default)((function*(){if(0===e.length)return;const t=e.map((e=>{let{wid:t,pinned:r,timestamp:n}=e;const i={id:t.toString(),pin:r?n:0};return r&&(i.archive=!1),i}));yield Promise.all(t.map((e=>(0,g.getChatTable)().merge(e.id,e)))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield(0,f.getExisting)(e.wid);null!=t&&(t.pin=e.pinned?e.timestamp:0,e.pinned&&(t.archive=!1))}));return function(){return e.apply(this,arguments)}}()))}))()}createPendingUnpin(e,t){var r=this;return(0,i.default)((function*(){yield h.default.appendPendingMutationsRows([r.getPinMutation(t,!1,e)])}))()}getLocalPins(){return(0,i.default)((function*(){const e=(0,g.getChatTable)().all().then((e=>e.filter((e=>null!=e.pin&&e.pin>0)).map((e=>[e.id,(0,s.default)(e.pin,"chatRow.pin")])))),t=h.default.getSyncActionsRows(["action"],[p.Actions.Pin]).then((e=>e.filter((e=>e.actionState===p.SyncActionState.Orphan)).map((e=>{var t;const r=JSON.parse(e.index);if(r.length<2)return null;const n=r[1],i=(0,l.decodeProtobuf)(S.SyncActionValueSpec,e.binarySyncAction);return null!=i.pinAction&&i.pinAction.pinned?[n,(0,a.numberOrThrowIfTooLarge)(null!==(t=i.timestamp)&&void 0!==t?t:0)]:null})).filter(Boolean))),[r,n]=yield Promise.all([e,t]);return[...r,...n].map((e=>{let[t,r]=e;return{chatId:(0,b.createWid)(t),timestamp:r}}))}))()}unpinAll(){var e=this;return(0,i.default)((function*(){const t=yield e.getLocalPins(),r=(0,o.unixTimeMs)(),n=t.map((t=>{let{chatId:n}=t;return e.getPinMutation(r,!1,n)}));return(0,v.lockForSync)(["chat"],n,(()=>Promise.resolve())).then((()=>e.applyUpdates(t.map((e=>{let{chatId:t}=e;return{wid:t,pinned:!1,timestamp:r}})))))}))()}getMutationsForPin(e,t,r){var n=this;return(0,i.default)((function*(){const i=[n.getPinMutation(e,t,r)];return t&&i.push(yield u.default.getArchiveChatMutation(e,!1,r)),i}))()}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}getPinMutation(e,t,r){return{collection:p.CollectionName.RegularLow,index:JSON.stringify([p.Actions.Pin,r.toString({legacy:!0})]),binarySyncAction:(0,c.encodeProtobuf)(S.SyncActionValueSpec,{timestamp:e,pinAction:{pinned:t}}).readBuffer(),version:this.version,operation:y.SyncdMutationSyncdOperation.SET,timestamp:e,action:p.Actions.Pin}}}const M=new P;Object.freeze(M);var O=M;t.default=O},44720:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(86945),o=r(45606),l=r(34771),c=r(89835);class d extends c.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,s.getABPropConfigValue)("primary_feature_sync"))return __LOG__(3)`primary feature sync: operation not supported`,e.map((()=>({actionState:o.SyncActionState.Unsupported})));let t;const r=e.map((e=>{var r;if("set"!==e.operation)return __LOG__(3)`primary feature sync: operation not supported`,{actionState:o.SyncActionState.Unsupported};return null==(null===(r=e.value.primaryFeature)||void 0===r?void 0:r.flags)?(__LOG__(3)`primary feature sync: malformed mutation`,{actionState:o.SyncActionState.Malformed}):((null==t||e.timestamp>t.timestamp)&&(t=e),{actionState:o.SyncActionState.Success})}));if(null!=t){var n;const e=(0,a.default)(null===(n=t.value.primaryFeature)||void 0===n?void 0:n.flags,"latestMutation.value.primaryFeature?.flags");l.PrimaryFeatures.setPrimaryFeatures(e)}return r}))()}}const u=new d;Object.freeze(u);var p=u;t.default=p},42339:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(60980),s=r(45606),o=r(58597),l=n(r(11339)),c=r(12492),d=n(r(45723)),u=r(53006),p=r(89835),h=r(22701);class f extends p.SyncActionBase{constructor(){super(...arguments),this.version=1}applyMutations(e){return(0,i.default)((function*(){return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{value:n}=e;let i=null===(t=n.pushNameSetting)||void 0===t?void 0:t.name;i||(__LOG__(3)`push name sync: empty pushname`,(0,o.logCriticalBootstrapStageIfNecessary)(l.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),i=""),(0,d.default)(i),(0,u.setPushnameLocally)(i),yield(0,o.logCriticalBootstrapStageIfNecessary)(l.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_APPLIED);const a=r(48277).default;return a.isSyncDCriticalDataSyncInProcess()&&(a.setSyncDCriticalSynced(),yield a.setSyncDCriticalDataSyncCompleted()),Promise.resolve({actionState:s.SyncActionState.Success})}return __LOG__(3)`push name sync: operation not supported`,Promise.resolve({actionState:s.SyncActionState.Unsupported})}catch(e){return(0,o.logCriticalBootstrapStageIfNecessary)(l.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),{actionState:s.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}))()}getPushnameMutation(e,t){return{collection:s.CollectionName.CriticalBlock,index:JSON.stringify([s.Actions.SettingPushName]),binarySyncAction:(0,a.encodeProtobuf)(h.SyncActionValueSpec,{timestamp:e,pushNameSetting:{name:t}}).readBuffer(),version:this.version,operation:c.SyncdMutationSyncdOperation.SET,timestamp:e,action:s.Actions.SettingPushName}}}const _=new f;Object.freeze(_);var m=_;t.default=m},60282:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(45606),s=r(76214),o=r(99662),l=r(89835),c=r(22954);class d extends l.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{indexParts:t,value:r}=e,[,n]=t;n||(0,c.throwInvalidActionIndex)();const i=r.quickReplyAction;if(!i)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};if(i.deleted)return yield(0,s.getQuickReplyTable)().remove(n),o.QuickReplyCollection.remove(n),{actionState:a.SyncActionState.Success};const{shortcut:l,message:d}=i;if(!l||!d)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const u=i.keywords||[],p=i.count||0;return yield(0,s.getQuickReplyTable)().createOrReplace({id:n,shortcut:l,count:p,message:d,keywords:u}),o.QuickReplyCollection.add({id:n,shortcut:l,message:d,keywords:u,count:p},{merge:!0}),{actionState:a.SyncActionState.Success}}return __LOG__(3)`quick replies sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const u=new d;Object.freeze(u);var p=u;t.default=p},40108:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(92844),s=r(60980),o=r(45606),l=n(r(73407)),c=r(837),d=r(12492),u=r(89835),p=r(22701);class h extends u.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const r=null===(t=e.value.keyExpiration)||void 0===t?void 0:t.expiredKeyEpoch;return null==r?(__LOG__(4,void 0,new Error)`sentinel mutation sync: malformed mutation`,{actionState:o.SyncActionState.Malformed}):(yield l.default.expireSyncKey(r),{actionState:o.SyncActionState.Success})}return __LOG__(3)`sentinel mutation sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}getSentinelMutations(){var e=this;return(0,i.default)((function*(){const t=(0,a.unixTimeMs)(),r=Array.from(o.CollectionName.members()),n={keyExpiration:{expiredKeyEpoch:(yield(0,c.getNewestKeyPair)()).keyEpoch},timestamp:t};return r.map((r=>({collection:r,index:JSON.stringify([o.Actions.Sentinel,r]),operation:d.SyncdMutationSyncdOperation.SET,version:e.version,binarySyncAction:(0,s.encodeProtobuf)(p.SyncActionValueSpec,n).readBuffer(),timestamp:t,action:o.Actions.Sentinel})))}))()}}const f=new h;Object.freeze(f);var _=f;t.default=_},21263:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(92844),s=r(60980),o=r(45606),l=r(84886),c=n(r(11339)),d=r(76214),u=r(59871),p=r(12492),h=r(19011),f=r(89835),_=r(22701),m=r(22954),g=r(93824),y=n(r(39546));class E extends f.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t,r,n,i]=e.indexArr;t&&r&&n&&i||(0,m.throwInvalidActionIndex)();return{chatJid:t,messageKey:(0,m.syncKeyToMsgKey)(t,r,n,i).toString()}}applyMutations(e){return(0,i.default)((function*(){const t=[],r=[],n=new Set;yield(0,d.getMessageTable)().bulkGet(e.map((e=>{const[,t,r,n,i]=e.indexParts;return t&&r&&n&&i&&y.default.isWid(t)?(0,m.syncKeyToMsgKey)(t,r,n,i).toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&n.add(e.id)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:s}=e,[,l,d,p,f]=a;if(l&&d&&p&&f||(0,m.throwInvalidActionIndex)(),!y.default.isWid(l))return(0,g.uploadCriticalEventMetric)(c.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:o.SyncActionState.Malformed};const _=null===(i=s.starAction)||void 0===i?void 0:i.starred;if(null==_)return __LOG__(3)`star message sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const E=(0,m.syncKeyToMsgKey)(l,d,p,f);if(!n.has(E.toString()))return{actionState:o.SyncActionState.Orphan,orphanModel:{modelId:E.toString(),modelType:o.SyncModelType.Msg}};_?t.push(E.toString()):r.push(E.toString());const S=u.MsgCollection.get(E);return S?(S.star=_,S.star?(0,h.addStarredMsgs)([S]):(0,h.removeStarredMsgs)([S])):__LOG__(3)`star_message_sync: msg ${E} found in storage but not in collection`,{actionState:o.SyncActionState.Success}}return __LOG__(3)`star message sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}})));return yield Promise.all([(0,l.starMessages)(t),(0,l.unstarMessages)(r)]),i}))()}getStarMessageMutations(e,t){const r=(0,a.unixTimeMs)();return e.map((e=>({collection:o.CollectionName.RegularHigh,index:(0,g.constructStarMsgKey)(e),operation:p.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,s.encodeProtobuf)(_.SyncActionValueSpec,{timestamp:r,starAction:{starred:t}}).readBuffer(),timestamp:r,action:o.Actions.Star})))}}const S=new E;Object.freeze(S);var v=S;t.default=v},89835:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionBase=void 0;var n=r(45606);t.SyncActionBase=class{getChatJidAndMessageKey(){}resolveConflicts(e,t){return t.timestamp>=e.timestamp?Promise.resolve(n.ConflictResolutionState.ApplyRemoteAndDropLocal):Promise.resolve(n.ConflictResolutionState.SkipRemote)}dropMutationDueToCrossIndexConflict(){return Promise.resolve(!1)}}},22954:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncKeyToMsgKey=function(e,t,r,n){let a;(0,l.createWid)(e).isUser()||(a="1"===r?(0,i.getMeUser)():(0,l.createWid)(n));return new s.default({fromMe:"1"===r,remote:(0,l.createWid)(e),id:t,participant:a})},t.throwInvalidActionIndex=function(){throw new a.default.MdFatalError({mdFatalErrorCode:a.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX}).commit(),new o.SyncdFatalError("invalid action index")};var i=r(99234),a=n(r(11339)),s=n(r(32219)),o=r(85156),l=r(58021)},11681:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(92844),s=r(45606),o=r(76214);class l{static loadStatesFromDb(){var e=this;return(0,i.default)((function*(){(yield(0,o.getCollectionVersionTable)().all()).forEach((t=>e.collectionStates.set(t.collection,{collection:t.collection,state:t.state,finiteFailureStartTime:t.finiteFailureStartTime})))}))()}static persistToDb(){const e=[];return this.collectionStates.forEach((t=>e.push(t))),(0,o.getCollectionVersionTable)().bulkCreateOrMerge(e)}static clean(){this.collectionStates=new Map}static getCollectionState(e){const t=this.collectionStates.get(e);return t?t.state:(this.moveCollectionsToUpToDate([e]),s.CollectionSyncState.UpToDate)}static getCollectionsInStateDirty(){const e=[];return this.collectionStates.forEach((t=>{t.state===s.CollectionSyncState.Dirty&&e.push(t.collection)})),e}static getCollectionsInStateRetry(){const e=[];return this.collectionStates.forEach((t=>{t.state===s.CollectionSyncState.FailingFiniteRetry&&e.push(t.collection)})),e}static getCollectionsInStateFatal(){const e=[];return this.collectionStates.forEach((t=>{t.state===s.CollectionSyncState.Fatal&&e.push(t.collection)})),e}static getCollectionsInStateBlocked(){const e=[];return this.collectionStates.forEach((t=>{t.state===s.CollectionSyncState.Blocked&&e.push(t.collection)})),e}static moveCollectionsToUpToDate(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:s.CollectionSyncState.UpToDate,finiteFailureStartTime:void 0})))}static moveCollectionsToDirty(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:s.CollectionSyncState.Dirty,finiteFailureStartTime:void 0})))}static moveCollectionsToFiniteRetry(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:s.CollectionSyncState.FailingFiniteRetry,finiteFailureStartTime:(0,a.unixTimeMs)()})))}static moveCollectionsToFatal(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:s.CollectionSyncState.Fatal,finiteFailureStartTime:void 0})))}static moveCollectionsToBlocked(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:s.CollectionSyncState.Blocked,finiteFailureStartTime:void 0})))}static getExpiredCollections(){const e=[];return this.collectionStates.forEach((t=>{if(t.state===s.CollectionSyncState.FailingFiniteRetry){let r;null==t.finiteFailureStartTime?(r=1/0,__LOG__(3)`Collection ${t.collection} is in finite retry state with no failure start time`):r=t.finiteFailureStartTime;r+6048e5<(0,a.unixTimeMs)()&&e.push(t.collection)}})),e}}t.default=l,l.collectionStates=new Map},45606:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncModelType=t.SyncDataType=t.SyncActionState=t.MIN_PATCH_SIZE=t.MIN_INLINE_MUTATIONS=t.MAX_PATCH_SIZE=t.MAX_INLINE_MUTATIONS=t.LABEL_ASSOCIATION_SYNC_VERSION=t.FINITE_FAILURE_EXPIRY_DURATION=t.DEFAULT_COLLECTION_VERSION=t.ConflictResolutionState=t.CollectionSyncState=t.CollectionState=t.CollectionName=t.BACKOFF_MIN_TIMEOUT=t.BACKOFF_MAX_TIMEOUT=t.BACKOFF_BASE=t.Actions=void 0;t.BACKOFF_MIN_TIMEOUT=1e3;t.BACKOFF_MAX_TIMEOUT=36e5;t.BACKOFF_BASE=2;t.FINITE_FAILURE_EXPIRY_DURATION=6048e5;t.MIN_INLINE_MUTATIONS=100;t.MAX_INLINE_MUTATIONS=2e3;t.MIN_PATCH_SIZE=10;t.MAX_PATCH_SIZE=100;t.DEFAULT_COLLECTION_VERSION=0;t.LABEL_ASSOCIATION_SYNC_VERSION=3;const n=r(54302)({Star:"star",Contact:"contact",Mute:"mute",PinDEPRECATED:"pin",Pin:"pin_v1",SettingPushName:"setting_pushName",LabelEdit:"label_edit",LabelMessage:"label_message",LabelJid:"label_jid",QuickReply:"quick_reply",LocaleSetting:"setting_locale",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChat:"clearChat",DeleteMessageForMe:"deleteMessageForMe",Sentinel:"sentinel",UnarchiveChatsSetting:"setting_unarchiveChats",DeleteChat:"deleteChat",AndroidUnsupportedActions:"android_unsupported_actions",PrimaryFeature:"primary_feature"});t.Actions=n;const i=r(54302)({Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"});t.CollectionName=i;const a=r(54302).Mirrored(["Success","SuccessHasMore","Conflict","ConflictHasMore","ErrorRetry","ErrorFatal","Blocked"]);t.CollectionState=a;const s=r(54302).Mirrored(["UpToDate","Dirty","FailingFiniteRetry","Fatal","Blocked"]);t.CollectionSyncState=s;const o=r(54302).Mirrored(["Success","Malformed","Orphan","Unsupported","Skipped","Failed"]);t.SyncActionState=o;const l=r(54302)({Msg:"Msg",Chat:"Chat"});t.SyncModelType=l;const c=r(54302).Mirrored(["ApplyRemoteAndDropLocal","SkipRemote","SkipRemoteAndDropLocal"]);t.ConflictResolutionState=c;const d=r(54302).Mirrored(["Patch","Snapshot"]);t.SyncDataType=d},58597:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logCriticalBootstrapStageIfNecessary=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(92844),s=r(86945),o=r(49801),l=n(r(11339));function c(){return(c=(0,i.default)((function*(e){(yield(0,s.getABPropConfigValue)("md_app_state_critical_data_processing_logging"))&&r(48277).default.isSyncDCriticalDataSyncInProcess()&&new l.default.MdBootstrapAppStateCriticalDataProcessing({bootstrapAppStateDataStage:e,mdSessionId:yield o.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,a.unixTimeMs)()}).commit()}))).apply(this,arguments)}},57228:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptCipherText=function(){return _.apply(this,arguments)},t.generateAssociatedData=function(e,t){let r;switch(e){case c.SyncdMutationSyncdOperation.SET:r=d.OPERATION_SET_HEX;break;case c.SyncdMutationSyncdOperation.REMOVE:r=d.OPERATION_REMOVE_HEX}if(r){r=new Uint8Array([parseInt(r,16)]).buffer;const e=r,n=new Uint8Array(r.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),n.buffer}throw new Error("invalid mutation operation value")},t.generateCipherText=function(){return f.apply(this,arguments)},t.generateEncryptionKeys=void 0,t.generateIndexMac=function(e,t){return new o.default(e).sign(t)},t.generateMac=function(e,t,r){const n=new Uint8Array(d.OCTET_LENGTH);n.set([e.byteLength],n.byteLength-1);const i=(0,p.combine)([e,t,n.buffer]);return new l.default(r).sign(i,d.MAC_LENGTH)},t.generatePadding=function(e,t){const r=Math.max(0,d.MAX_OF_MIN_DATA_LENGTH-e-t),n=new Uint8Array(r);return self.crypto.getRandomValues(n),n.buffer},t.generatePatchMac=function(e,t,r,n,i){return new o.default(e).sign((0,p.combine)([t,...r,n,i]))},t.generateSnapshotMac=function(e,t,r,n){return new o.default(e).sign((0,p.combine)([t,r,n]))},t.valueMacFromIndexAndValueCipherText=function(e){const t=e.byteLength;return new Uint8Array(e).slice(t-d.MAC_LENGTH).buffer};var i=n(r(48926)),a=n(r(88306)),s=r(15688),o=n(r(39827)),l=n(r(32318)),c=r(12492),d=r(18054),u=r(78936),p=r(86458);const h=(0,a.default)(u.generateEncryptionKeysUnmemoized,s.encodeB64);function f(){return(f=(0,i.default)((function*(e,t,r){const n=yield self.crypto.subtle.importKey("raw",new Uint8Array(t),"AES-CBC",!1,["encrypt"]);return yield self.crypto.subtle.encrypt({name:"AES-CBC",iv:e},n,r)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,r){const n=yield self.crypto.subtle.importKey("raw",new Uint8Array(t),"AES-CBC",!1,["decrypt"]);return yield self.crypto.subtle.decrypt({name:"AES-CBC",iv:e},n,r)}))).apply(this,arguments)}t.generateEncryptionKeys=h},18054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALUE_MAC_KEY_LENGTH=t.VALUE_MAC_KEY_END=t.VALUE_ENCRYPTION_KEY_LENGTH=t.VALUE_ENCRYPTION_KEY_END=t.SNAPSHOT_MAC_KEY_LENGTH=t.SNAPSHOT_MAC_KEY_END=t.PATCH_MAC_KEY_LENGTH=t.PATCH_MAC_KEY_END=t.OPERATION_SET_HEX=t.OPERATION_REMOVE_HEX=t.OCTET_LENGTH=t.MAX_OF_MIN_DATA_LENGTH=t.MAC_LENGTH=t.IV_LENGTH=t.INDEX_KEY_LENGTH=t.INDEX_KEY_END=t.HKDF_INFO=t.EMPTY_MUTATION_MAC=t.DERIVED_KEY_LENGTH=void 0;t.HKDF_INFO="WhatsApp Mutation Keys";t.DERIVED_KEY_LENGTH=160;t.INDEX_KEY_LENGTH=32;t.VALUE_ENCRYPTION_KEY_LENGTH=32;t.VALUE_MAC_KEY_LENGTH=32;t.SNAPSHOT_MAC_KEY_LENGTH=32;t.PATCH_MAC_KEY_LENGTH=32;t.INDEX_KEY_END=32;t.VALUE_ENCRYPTION_KEY_END=64;t.VALUE_MAC_KEY_END=96;t.SNAPSHOT_MAC_KEY_END=128;t.PATCH_MAC_KEY_END=160;t.OPERATION_SET_HEX="0x01";t.OPERATION_REMOVE_HEX="0x02";t.MAX_OF_MIN_DATA_LENGTH=0;t.MAC_LENGTH=32;t.OCTET_LENGTH=8;t.IV_LENGTH=16;const r=new ArrayBuffer(32);t.EMPTY_MUTATION_MAC=r},78936:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEncryptionKeysUnmemoized=function(){return l.apply(this,arguments)};var a=i(r(48926)),s=r(18054),o=n(r(12206));function l(){return(l=(0,a.default)((function*(e){const t=yield c(e);return{indexKey:t.slice(0,s.INDEX_KEY_END),valueEncryptionKey:t.slice(s.INDEX_KEY_END,s.VALUE_ENCRYPTION_KEY_END),valueMacKey:t.slice(s.VALUE_ENCRYPTION_KEY_END,s.VALUE_MAC_KEY_END),snapshotMacKey:t.slice(s.VALUE_MAC_KEY_END,s.SNAPSHOT_MAC_KEY_END),patchMacKey:t.slice(s.SNAPSHOT_MAC_KEY_END,s.PATCH_MAC_KEY_END)}}))).apply(this,arguments)}function c(e){return o.extractAndExpand(e,s.HKDF_INFO,s.DERIVED_KEY_LENGTH)}},86458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToHex=function(e){return[...new Uint8Array(e)].map((e=>e.toString(16))).toString().replace(/,/g," ")},t.arrayBufferToHexPadded=function(e){return[...new Uint8Array(e)].map((e=>e.toString(16).padStart(2,"0"))).join("")},t.combine=function(e){if(0===e.length)throw new Error("buffers length is zero");if(1===e.length)return e[0];const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),r=new Uint8Array(t);let n,i=0;for(n=0;n<e.length;n++)r.set(new Uint8Array(e[n]),i),i+=e[n].byteLength;return r.buffer},t.hexToUint8Array=function(e){return Uint8Array.from(e.split(" ").map((e=>parseInt(e,16))))},t.split=function(e,t,r){if(t<0||r<0)throw new Error("buffers length is zero");const n=new Array(3),i=new Uint8Array(e);return n[0]=i.slice(0,t).buffer,n[1]=i.slice(t,t+r).buffer,n[2]=i.slice(t+r).buffer,n},t.to64BitNetworkOrder=function(e){const t=new ArrayBuffer(8);return new DataView(t).setUint32(4,e,!1),t},t.toUtf8=function(e){return r.encode(e)};const r=new TextEncoder},73407:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(89016),s=r(76214),o=r(99069);r(22701),r(84902);const l=new ArrayBuffer(a.KEY_LENGTH_BYTES);t.default=class{static getAllPendingMutationsRows(){return(0,s.getPendingMutationsTable)().all()}static performTransaction(e){return(0,o.getStorage)().lock(["collection-version","pending-mutations","sync-actions"],e)}static getPendingMutationsRows(e,t){return(0,s.getPendingMutationsTable)().equals(e,t)}static getPendingMutationsRowsById(e){return(0,i.default)((function*(){return(yield(0,s.getPendingMutationsTable)().bulkGet(e)).filter(Boolean)}))()}static getPendingMutationsRowsByIndex(e,t){return(0,s.getPendingMutationsTable)().equals(e,t)}static appendPendingMutationsRows(e){return(0,s.getPendingMutationsTable)().bulkCreate(e)}static bulkUpdatePendingMutationsKeyId(e){return(0,s.getPendingMutationsTable)().bulkCreateOrMerge(e)}static bulkRemovePendingMutations(e){return(0,s.getPendingMutationsTable)().bulkRemove(e)}static hasPendingMutationForCollection(e){return(0,s.getPendingMutationsTable)().equals(["collection"],e).then((e=>e.length>0))}static getCollectionVersion(e){return(0,i.default)((function*(){const t=yield(0,s.getCollectionVersionTable)().get(e);return null==t?void 0:t.version}))()}static getCollectionVersions(e){return(0,i.default)((function*(){const t=yield(0,s.getCollectionVersionTable)().bulkGet(e);return new Map(e.map(((e,r)=>{var n;return[e,null===(n=t[r])||void 0===n?void 0:n.version]})))}))()}static setCollectionVersion(e,t,r){return(0,s.getCollectionVersionTable)().createOrMerge(e,{collection:e,version:t,ltHash:r})}static getLtHash(e){return(0,i.default)((function*(){const t=yield(0,s.getCollectionVersionTable)().get(e);return(null==t?void 0:t.ltHash)||l}))()}static getAllCollectionLtHashes(){return(0,i.default)((function*(){return(yield(0,s.getCollectionVersionTable)().all()).map((e=>({collection:e.collection,ltHash:e.ltHash})))}))()}static getSyncAction(e){return(0,s.getSyncActionsTable)().get(e)}static getSyncActionsRows(e,t){return(0,s.getSyncActionsTable)().anyOf(e,t)}static setSyncAction(e){return(0,s.getSyncActionsTable)().createOrReplace(e)}static setSyncActionRows(e){return(0,s.getSyncActionsTable)().bulkCreateOrReplace(e)}static updateSyncActionRows(e){return(0,s.getSyncActionsTable)().bulkCreateOrMerge(e)}static deleteSyncActionRows(e){return(0,s.getSyncActionsTable)().bulkRemove(e)}static getSyncKey(e){return(0,s.getSyncKeysTable)().get(e)}static getAllSyncKeys(){return(0,s.getSyncKeysTable)().all()}static createSyncKey(e){return(0,s.getSyncKeysTable)().create(e)}static getSyncKeyData(e){return(0,s.getSyncKeysTable)().get(e)}static expireSyncKey(e){return(0,i.default)((function*(){(yield(0,s.getSyncKeysTable)().equals(["keyEpoch"],e)).forEach((e=>(0,s.getSyncKeysTable)().merge(e.keyId,{keyId:e.keyId,timestamp:0})))}))()}static getMissingKey(e){return(0,s.getMissingKeysTable)().get(e)}static getMissingKeyCount(){return(0,s.getMissingKeysTable)().count()}static bulkGetMissingKeys(e){return(0,s.getMissingKeysTable)().bulkGet(e)}static getAllMissingKeys(){return(0,s.getMissingKeysTable)().all()}static bulkRemoveMissingKeys(e){return(0,s.getMissingKeysTable)().bulkRemove(e)}static createOrUpdateMissingKeys(e){return(0,s.getMissingKeysTable)().bulkCreateOrMerge(e)}}},1377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkLtHash=function(){return O.apply(this,arguments)},t.computeLtHash=P,t.computeLtHashAndValidatePatch=function(){return S.apply(this,arguments)},t.computeLtHashAndValidateSnapshot=function(){return E.apply(this,arguments)},t.computeOutgoingSnapshotAndPatchMacs=function(){return b.apply(this,arguments)},t.logMacsInSnapshot=function(){return D.apply(this,arguments)};var i=n(r(48926)),a=r(57228),s=n(r(73407)),o=r(85156),l=r(837),c=r(89016),d=r(12492),u=r(86458),p=r(7589),h=r(45606),f=n(r(11339)),_=r(68254),m=r(85156);function g(e,t){return`${e.slice(-16)}:${(0,u.arrayBufferToHexPadded)(t).slice(-16)}`}const y=new TextDecoder;function E(){return(E=(0,i.default)((function*(e,t){const{mac:r,version:n,keyId:i,records:s}=t,d=yield(0,l.getKeyData)(i.id);if(!d)throw new o.SyncdMissingKeyError;const p=new Map(s.map((e=>[(0,u.arrayBufferToHexPadded)(e.index.blob),(0,a.valueMacFromIndexAndValueCipherText)(e.value.blob)])));__LOG__(2)`syncd:
${e} snapshot macsToAdd:
    ${[...p.entries()].map((e=>{let[t,r]=e;return g(t,r)})).join("\n\t")}`;const h=yield c.LT_HASH_ANTI_TAMPERING.add(c.EMPTY_LT_HASH,[...p.values()]),{snapshotMacKey:f}=yield(0,a.generateEncryptionKeys)(d),_=(0,u.to64BitNetworkOrder)(n.version),m=(0,u.toUtf8)(e).buffer;return __LOG__(2)`syncd: validating snapshot mac for ${e} snapshot v${n.version}:
ltHash: ${(0,u.arrayBufferToHexPadded)(h)}
encoded version: ${(0,u.arrayBufferToHexPadded)(_)}
encoded collection: ${(0,u.arrayBufferToHexPadded)(m)}
expected snapshotMAC: ${(0,u.arrayBufferToHexPadded)(r)}`,yield v(e,r,f,h,_,m,!0),h}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r){const{version:n,mutations:i,snapshotMac:c,patchMac:d,keyId:p}=t,h=p.id,f=yield(0,l.getKeyData)(h);if(!f)throw new o.SyncdMissingKeyError;const{snapshotMacKey:_,patchMacKey:g}=yield(0,a.generateEncryptionKeys)(f),y=i.map((e=>({operation:e.operation,indexMac:e.record.index.blob,valueMac:(0,a.valueMacFromIndexAndValueCipherText)(e.record.value.blob)}))),E=yield P(e,y),S=(0,u.to64BitNetworkOrder)(n.version),T=(0,u.toUtf8)(e).buffer;__LOG__(2)`syncd: validating snapshot and patch mac for ${e} v${n.version}:
expected snapshotMAC: ${(0,u.arrayBufferToHexPadded)(c)}
expected patchMAC: ${(0,u.arrayBufferToHexPadded)(d)}
encoded version: ${(0,u.arrayBufferToHexPadded)(S)}
encoded collection: ${(0,u.arrayBufferToHexPadded)(T)}
key ID: ${(0,u.arrayBufferToHexPadded)(h)}`;try{yield A(e,d,g,c,y.map((e=>e.valueMac)),S,T),yield v(e,c,_,E,S,T,!1,r)}catch(t){if(t instanceof o.SyncdFatalError){var C;const t=null!==(C=yield s.default.getCollectionVersion(e))&&void 0!==C?C:0;if(t>=n.version)throw __LOG__(3,void 0,void 0,!0)`syncd: ${e} patch v${n.version} <= current ${e} version (v${t})`,SEND_LOGS("syncd-version-check-error"),new m.SyncdVersionCheckError}throw t}return E}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,i,s,l,c){const d=yield(0,a.generateSnapshotMac)(r,n,i,s);if(!(0,p.areBuffersEqual)(d,t)){let t=l?f.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:f.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_PATCH;throw l||!0!==c||(t=f.default.MD_SYNCD_FATAL_ERROR_CODE.SERVER_DID_NOT_SEND_ALL_PATCHES),(0,_.uploadFatalErrorMetric)(t,e),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate snapshot mac.`,SEND_LOGS("syncd: unable to validate snapshot mac."),new o.SyncdFatalError("unable to validate snapshot mac")}}))).apply(this,arguments)}function A(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,r,n,i,s,l){const c=yield(0,a.generatePatchMac)(r,n,i,s,l);if(!(0,p.areBuffersEqual)(c,t))throw(0,_.uploadFatalErrorMetric)(f.default.MD_SYNCD_FATAL_ERROR_CODE.MAC_MISMATCH_PATCH,e),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate patch mac.`,SEND_LOGS("syncd: unable to validate patch mac."),new o.SyncdFatalError("unable to validate patch mac")}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r,n){const i=((yield s.default.getCollectionVersion(e))||h.DEFAULT_COLLECTION_VERSION)+1,{patchMacKey:o,snapshotMacKey:l}=yield(0,a.generateEncryptionKeys)(n),c=(0,u.to64BitNetworkOrder)(i),d=(0,u.toUtf8)(e).buffer,p=yield(0,a.generateSnapshotMac)(l,t,c,d),f=yield(0,a.generatePatchMac)(o,p,r.map((e=>e.valueMac)),c,d);return __LOG__(2)`syncd: computing snapshot and patch macs for outgoing patch ${e} v${i}:
encoded version: ${(0,u.arrayBufferToHexPadded)(c)}
encoded collection: ${(0,u.arrayBufferToHexPadded)(d)}
snapshotMAC: ${(0,u.arrayBufferToHexPadded)(p)}
patchMAC: ${(0,u.arrayBufferToHexPadded)(f)}`,{snapshotMac:p,patchMac:f}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){const r=yield s.default.getLtHash(e),n=yield w(t.map((e=>e.indexMac))),i=new Map,a=new Map,o=new Map;t.forEach((e=>{const{indexMac:t,valueMac:r,operation:s}=e,l=y.decode(t),c=n.get(l);c?s===d.SyncdMutationSyncdOperation.REMOVE?a.set((0,u.arrayBufferToHexPadded)(t),c):o.set((0,u.arrayBufferToHexPadded)(t),c):s===d.SyncdMutationSyncdOperation.REMOVE&&(__LOG__(3,void 0,void 0,!0)`syncd: missing indexMAC in sync-actions table for REMOVE mutation:
${(0,u.arrayBufferToHexPadded)(t).slice(-16)}`,SEND_LOGS("syncd: missing indexMAC in sync-actions table for REMOVE mutation")),s===d.SyncdMutationSyncdOperation.SET&&i.set((0,u.arrayBufferToHexPadded)(t),r)}));const l=yield c.LT_HASH_ANTI_TAMPERING.subtractThenAdd(r,[...i.values()],[...a.values()].concat([...o.values()]));return __LOG__(2)`syncd: computing ltHash for ${e}:
currentLtHash: ${(0,u.arrayBufferToHexPadded)(r)}
macsToAdd:
    ${[...i.entries()].map((e=>{let[t,r]=e;return g(t,r)})).join("\n\t")}
macsToRemove:
    ${[...a.entries()].map((e=>{let[t,r]=e;return g(t,r)})).join("\n\t")}
macsToOverwrite (also remove):
    ${[...o.entries()].map((e=>{let[t,r]=e;return g(t,r)})).join("\n\t")}
newLtHash: ${(0,u.arrayBufferToHexPadded)(l)}`,l}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=[];yield s.default.performTransaction((0,i.default)((function*(){const t=yield s.default.getAllCollectionLtHashes();yield Promise.all(t.map(function(){var t=(0,i.default)((function*(t){let{collection:r,ltHash:n}=t;const i=yield s.default.getSyncActionsRows(["collection"],[r]);e.push({collection:r,ltHash:n,mutations:i})}));return function(){return t.apply(this,arguments)}}()))}))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){let{collection:t,ltHash:r,mutations:n}=e;const i=yield I(n);(0,p.areBuffersEqual)(r,i)||(__LOG__(4,!0,new Error,!0)`syncd failed LtHash check for ${t}`,SEND_LOGS("LtHash check failed"))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function I(e){const t=new Map(e.map((e=>[(0,u.arrayBufferToHexPadded)(e.indexMac),e.valueMac])));return c.LT_HASH_ANTI_TAMPERING.add(c.EMPTY_LT_HASH,[...t.values()])}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=yield s.default.getSyncActionsRows(["indexMac"],e);return new Map(t.map((e=>[y.decode(e.indexMac),e.valueMac])))}))).apply(this,arguments)}function D(){return(D=(0,i.default)((function*(e){const[t,r]=yield s.default.performTransaction((0,i.default)((function*(){return[yield s.default.getCollectionVersion(e),yield s.default.getSyncActionsRows(["collection"],[e])]})));if(__LOG__(2)`syncd: current snapshot ${e} v${t} with ${r.length} mutations:`,r.length>100)return;r.reduce(((e,t,r)=>(r%20==0&&e.push(""),e[e.length-1]+=g((0,u.arrayBufferToHexPadded)(t.indexMac),t.valueMac)+" | ",e)),[]).forEach((e=>__LOG__(2)`|${e}`))}))).apply(this,arguments)}},2161:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.maxSupportedVersion=t.ActionHandlers=void 0;var i=n(r(6162)),a=n(r(21084)),s=n(r(74362)),o=n(r(28464)),l=n(r(29867)),c=r(45606),d=n(r(24900)),u=n(r(56928)),p=n(r(41058)),h=n(r(12123)),f=n(r(35096)),_=n(r(80056)),m=n(r(79171)),g=n(r(64294)),y=n(r(70119)),E=n(r(36014)),S=n(r(44720)),v=n(r(42339)),T=n(r(60282)),A=n(r(40108)),C=n(r(21263));const b=new Map([[c.Actions.Star,C.default],[c.Actions.Contact,d.default],[c.Actions.Mute,y.default],[c.Actions.LabelEdit,_.default],[c.Actions.LabelMessage,f.default],[c.Actions.LabelJid,h.default],[c.Actions.QuickReply,T.default],[c.Actions.LocaleSetting,m.default],[c.Actions.SettingPushName,v.default],[c.Actions.Archive,s.default],[c.Actions.MarkChatAsRead,g.default],[c.Actions.ClearChat,l.default],[c.Actions.DeleteMessageForMe,p.default],[c.Actions.Sentinel,A.default],[c.Actions.UnarchiveChatsSetting,o.default],[c.Actions.Pin,E.default],[c.Actions.DeleteChat,u.default],[c.Actions.AndroidUnsupportedActions,a.default],[c.Actions.PrimaryFeature,S.default]]);t.ActionHandlers=b;t.maxSupportedVersion=()=>(0,i.default)(Array.from(b.values()).map((e=>e.version)))},29938:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAppStateSyncResponse=function(){return U.apply(this,arguments)},t.applyIndividualMutations=function(){return G.apply(this,arguments)};var i=n(r(6479)),a=n(r(48926)),s=n(r(89734)),o=r(8243),l=n(r(45095)),c=r(92844),d=r(84902),u=r(2161),p=n(r(21084)),h=r(1377),f=r(45606),_=r(58597),m=n(r(73407)),g=r(58743),y=r(68254),E=r(84051),S=r(49801),v=n(r(11339)),T=r(59037),A=r(11540),C=r(12492),b=r(22701),P=r(85156),M=r(93824),O=r(6954),I=r(72466),w=n(r(89453)),R=n(r(78375)),D=r(35377),N=r(62274);const L=["indexMac","valueMac"],k=new ArrayBuffer(128);function G(){return(G=(0,a.default)((function*(e){if(0===e.length)return Promise.resolve();__LOG__(2)`syncd: start applyIndividualMutations`;const t=(0,O.syncActionsToDecryptedMutation)(e).reduce(((e,t)=>{var r;const n=null!==(r=e.get(t.collection))&&void 0!==r?r:[];return n.push(t),e.set(t.collection,n),e}),new Map),r=Array.from(t.keys()).map(function(){var e=(0,a.default)((function*(e){__LOG__(2)`syncd: apply individual mutations for collection ${e}`;const r=t.get(e);if(void 0===r)return;const{setMutationsToPersist:n,pendingMutationsToDrop:s}=yield z(e,r),o=n.map((e=>{const{indexMac:t,valueMac:r}=e;return(0,i.default)(e,L)}));__LOG__(2)`syncd: end apply individual mutations for collection ${e}`,yield m.default.performTransaction((0,a.default)((function*(){yield m.default.updateSyncActionRows(o),yield m.default.bulkRemovePendingMutations(s)}))),__LOG__(2)`syncd: end update db after apply individual mutations for collection ${e}`}));return function(){return e.apply(this,arguments)}}());yield Promise.all(r),__LOG__(2)`syncd: end applyIndividualMutations`}))).apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e,t){const{name:r,version:n,patches:i,snapshot:a,syncedPendingMutationsId:s,syncedEncryptedMutations:o}=e;yield(0,h.logMacsInSnapshot)(e.name),__LOG__(2)`syncd: start applying collection ${r}`;const[l,d]=yield B(r,i,a,t),u=performance.now();try{if(null!=l)yield Y(r,l,d,t),__LOG__(2)`syncd: ${r} snapshot and patches applied successfully`;else if(null!=d){const e=Math.min.apply(Math,d.map((e=>e.version.version))),n=null!=t&&e>t+1&&d.length>0;n&&(__LOG__(3,void 0,void 0,!0)`syncd: has missing patches. collection: ${r}, localVersion: ${t},
minPatch: ${e}`,SEND_LOGS("syncd: has missing patches")),yield W(r,d,t,n),__LOG__(2)`syncd: ${r} patches applied successfully`}else null!=n?(yield F(r,n,s,o),__LOG__(2)`syncd: ${r} v${n} uploaded successfully`):((0,M.isBootstrap)(t)&&(yield m.default.setCollectionVersion(r,0,k)),__LOG__(2)`syncd: sync ${r} but there are no updates`);const i=Math.floor(performance.now()-u);return __LOG__(2)`syncd: applyAppStateSyncResponse: finished applying ${r} in ${i}ms`,(d||l)&&(0,M.isBootstrap)(t)&&!(0,M.isCriticalCollection)(r)&&new v.default.MdBootstrapDataApplied({mdBootstrapPayloadType:v.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapSource:v.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield S.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,c.unixTimeMs)(),mdBootstrapStepDuration:i,collection:(0,M.collectionNameToMetric)(r),usedSnapshot:null!=l}).commit(),yield(0,h.logMacsInSnapshot)(e.name),e}catch(e){const t=e.message;return e instanceof P.SyncdMissingKeyError?(__LOG__(3)`syncd key error: ${r} missing keys`,{name:r,state:f.CollectionState.Blocked}):e instanceof P.SyncdFatalError?(__LOG__(4,void 0,new Error,!0)`syncd fatal error: ${r} throws ${t}`,SEND_LOGS(`syncd fatal error: ${String(r)} throws ${t}`),{name:r,state:f.CollectionState.ErrorFatal}):(__LOG__(3,void 0,void 0,!0)`syncd retryable error: ${r} throws ${t}`,SEND_LOGS(`syncd retryable error: ${String(r)} throws ${t}`),{name:r,state:f.CollectionState.ErrorRetry})}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(e,t,r,n){const i=n.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),s=yield(0,h.computeLtHash)(e,i),o=(0,O.encryptedUploadMutationsToSyncActions)(n.filter((e=>e.operation===C.SyncdMutationSyncdOperation.SET)),f.SyncActionState.Success);yield m.default.performTransaction((0,a.default)((function*(){yield m.default.setSyncActionRows(o),yield m.default.bulkRemovePendingMutations(r),yield m.default.setCollectionVersion(e,t,s)})))}))).apply(this,arguments)}function B(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e,t,r,n){let i=Promise.resolve(),s=0;const l=(0,c.unixTimeMs)();if(null!=r){const t=w.default.validateExternalBlobReference(e,r);s+=(0,o.numberOrThrowIfTooLarge)(t.fileSizeBytes||0),i=(0,T.downloadSnapshot)(e,t)}let d,u,p=Promise.resolve();if(null!=t){const r=t.map((t=>w.default.validatePatchProtobuf(e,t)));p=Promise.all(r.map(function(){var t=(0,a.default)((function*(t){let r=t.mutations||[];const n=t.externalMutations;return n&&(r=yield(0,T.downloadExternalPatch)(e,n),__LOG__(2)`syncd: ${e}'s external patch downloaded`,s+=(0,o.numberOrThrowIfTooLarge)(n.fileSizeBytes||0)),{mutations:r,version:t.version,snapshotMac:t.snapshotMac,patchMac:t.patchMac,keyId:t.keyId,exitCode:t.exitCode,deviceIndex:t.deviceIndex}}));return function(){return t.apply(this,arguments)}}()))}try{[d,u]=yield Promise.all([i,p]),(0,M.isBootstrap)(n)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,s,!0)}catch(t){throw(0,M.isBootstrap)(n)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,s,!1),t}return[d,u]}))).apply(this,arguments)}function Y(){return j.apply(this,arguments)}function j(){return(j=(0,a.default)((function*(e,t,r,n){try{const r=yield(0,h.computeLtHashAndValidateSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot validated`;const n=yield(0,g.tryDecryptSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot decrypted`,R.default.addMutationCount(t.records.length),(0,D.logMetricsForMutations)(n),(0,I.validateNoSameIndexForMultipleMutations)(e,n,f.SyncDataType.Snapshot);const i=t.version.version,{setMutationsToPersist:s,pendingMutationsToDrop:o}=yield z(e,n);__LOG__(2)`syncd: processed ${n.length} mutations in snapshot of collection ${e}`,__LOG__(2)`syncd: collection ${e}'s snapshot v${i} applied`,yield m.default.performTransaction((0,a.default)((function*(){yield m.default.setSyncActionRows(s),yield m.default.bulkRemovePendingMutations(o),yield m.default.setCollectionVersion(e,i,r)})))}catch(r){throw r instanceof P.SyncdMissingKeyError&&(yield(0,E.handleMissingKeysInSnapshot)(e,t)),r}if(r)return W(e,r,n)}))).apply(this,arguments)}function W(){return H.apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t,r,n){if(0===t.length)return Promise.resolve();(0,I.validateNoDuplicatePatchVersionInCollection)(e,t);const i=(0,s.default)(t,(e=>e.version.version));try{for(let t=0;t<i.length;t++)yield V(e,i[t],r,n)}catch(t){throw t instanceof P.SyncdMissingKeyError&&(yield(0,E.handleMissingKeysInPatches)(e,i)),t}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,r,n){if(t.exitCode){var i;const r=t.exitCode.code;switch(r){case 100:(0,y.uploadFatalErrorMetric)(v.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_MISSING_DATA,e);break;case 101:(0,y.uploadFatalErrorMetric)(v.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_DESERIALIZATION_ERROR,e);break;default:(0,y.uploadFatalErrorMetric)(v.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_UNKNOWN,e)}throw new P.SyncdFatalError(`received terminal patch with exit code:  ${String(r)} text: ${String(null===(i=t.exitCode)||void 0===i?void 0:i.text)}  `)}0===t.deviceIndex&&p.default.updatePrimaryAllowsAllMutationsFlag("device index");const s=t.mutations.filter((e=>e.operation===C.SyncdMutationSyncdOperation.SET)).length,o=t.mutations.length-s;__LOG__(2)`syncd: applying patch ${e} v${t.version.version} from device ${t.deviceIndex}
SET count: ${s}
REMOVE count: ${o}`;const l=yield(0,h.computeLtHashAndValidatePatch)(e,t,n),c=yield(0,g.tryDecryptPatch)(e,t);(0,D.logMetricsForMutations)(c),R.default.addMutationCount(c.length),(0,I.validateNoSameIndexForMultipleMutations)(e,c,f.SyncDataType.Patch);const d=Z(c),u=d.filter((e=>e.operation===C.SyncdMutationSyncdOperation.REMOVE));yield J(e,u);const _=d.filter((e=>e.operation===C.SyncdMutationSyncdOperation.SET)),{setMutationsToPersist:E,pendingMutationsToDrop:S}=yield z(e,_);__LOG__(2)`syncd: processed ${c.length} mutations in patch version ${t.version.version} of collection ${e}`;const T=t.version.version;yield m.default.performTransaction((0,a.default)((function*(){yield m.default.deleteSyncActionRows(u.map((e=>e.index))),yield m.default.setSyncActionRows(E),yield m.default.bulkRemovePendingMutations(S),yield m.default.setCollectionVersion(e,T,l)})))}))).apply(this,arguments)}function z(){return q.apply(this,arguments)}function q(){return(q=(0,a.default)((function*(e,t){(0,_.logCriticalBootstrapStageIfNecessary)(v.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ABOUT_TO_APPLY_MUTATIONS);const r=[],n=(0,I.validateAndTypeSetMutations)(e,t),{supportedMutations:i,unsupportedMutations:a}=ee(e,n);a.forEach((e=>r.push((0,O.setMutationToSyncAction)(e,f.SyncActionState.Unsupported))));const{remoteMutationsToApply:s,pendingMutationsToDrop:o}=yield(0,A.resolveConflict)(e,i);i.filter((e=>!s.includes(e))).forEach((e=>r.push((0,O.setMutationToSyncAction)(e,f.SyncActionState.Skipped,e.actionName))));const c=te(s);for(let e=0;e<c.length;e++){const t=c[e][0].actionHandler,n=c[e].map((e=>{let t;return t=e.binarySyncData?(0,l.default)((0,d.decodeProtobuf)(b.SyncActionDataSpec,e.binarySyncData).value,"decodeProtobuf(SyncActionDataSpec, m.binarySyncData).value"):(0,d.decodeProtobuf)(b.SyncActionValueSpec,e.binarySyncAction),{operation:"set",indexParts:e.indexArr,value:t,timestamp:e.timestamp}})),i=yield t.applyMutations(n,{setMutationsPendingToPersist:r,allSupportedSetMutations:s});for(let t=0;t<c[e].length;t++){var u,p;r.push((0,O.setMutationToSyncAction)(c[e][t],i[t].actionState,c[e][t].actionName,null===(u=i[t].orphanModel)||void 0===u?void 0:u.modelId,null===(p=i[t].orphanModel)||void 0===p?void 0:p.modelType))}}return(0,_.logCriticalBootstrapStageIfNecessary)(v.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.APPLIED_MUTATIONS),{setMutationsToPersist:r,pendingMutationsToDrop:o}}))).apply(this,arguments)}function J(){return Q.apply(this,arguments)}function Q(){return(Q=(0,a.default)((function*(e,t){const{supportedMutations:r}=X(t),n=te(r);for(let t=0;t<n.length;t++){const r=n[t][0].actionHandler;yield r.applyMutations(n[t].map((t=>({operation:"remove",indexParts:re(e,t.index)}))),{setMutationsPendingToPersist:[],allSupportedSetMutations:[]})}}))).apply(this,arguments)}function X(e){const t=[],r=[];return e.forEach((e=>{if(e.version>(0,u.maxSupportedVersion)())return void r.push(e);const n=re(e.collection,e.index),i=f.Actions.cast(n[0]);if(!i)return __LOG__(3)`syncd: invalid action ${n[0]}`,void r.push(e);const a=u.ActionHandlers.get(i);if(!a)return __LOG__(3)`syncd: no handler for action ${i}`,void r.push(e);t.push({collection:e.collection,index:e.index,indexMac:e.indexMac,keyId:e.keyId,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version,indexArr:n,actionName:i,actionHandler:a})})),{supportedMutations:t,unsupportedMutations:r}}function Z(e){const t=e.filter((e=>e.operation===C.SyncdMutationSyncdOperation.SET)),r=new Set(t.map((e=>e.index)));return e.filter((e=>e.operation===C.SyncdMutationSyncdOperation.REMOVE)).forEach((e=>{r.has(e.index)||t.push(e)})),t}function ee(e,t){const r=[],n=[];return t.forEach((t=>{if(t.version>(0,u.maxSupportedVersion)())return void n.push(t);const i=re(e,t.index),a=f.Actions.cast(i[0]);if(!a)return __LOG__(3)`syncd: invalid action ${i[0]}`,void n.push(t);const s=u.ActionHandlers.get(a);if(!s)return __LOG__(3)`syncd: no handler for action ${a}`,void n.push(t);r.push({collection:t.collection,index:t.index,indexMac:t.indexMac,keyId:t.keyId,timestamp:t.timestamp,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,valueMac:t.valueMac,version:t.version,indexArr:i,actionName:a,actionHandler:s})})),{supportedMutations:r,unsupportedMutations:n}}function te(e){return e.reduce(((e,t)=>(0!==e.length&&t.actionName===e[e.length-1][0].actionName?e[e.length-1].push(t):e.push([t]),e)),[])}function re(e,t){try{const e=JSON.parse(t);if(e.length<1)throw new Error;return e}catch(t){throw(0,y.uploadFatalErrorMetric)(v.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX,e),new P.SyncdFatalError("invalid action index")}}},13815:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeExternalBlobReference=function(e,t){try{return(0,i.decodeProtobuf)(o.ExternalBlobReferenceSpec,t)}catch(t){throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("external blob reference protobuf deserialization failed")}},t.decodeSyncActionData=function(e,t){try{return(0,i.decodeProtobuf)(l.SyncActionDataSpec,t)}catch(t){throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("action data protobuf deserialization failed")}},t.decodeSyncdMutations=function(e,t){try{return(0,i.decodeProtobuf)(o.SyncdMutationsSpec,t)}catch(t){throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("mutations protobuf deserialization failed")}},t.decodeSyncdPatch=function(e,t){try{return(0,i.decodeProtobuf)(o.SyncdPatchSpec,t)}catch(t){throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("patch protobuf deserialization failed")}},t.decodeSyncdSnapshot=function(e,t){try{return(0,i.decodeProtobuf)(o.SyncdSnapshotSpec,t)}catch(t){throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("snapshot protobuf deserialization failed")}};var i=r(84902),a=r(68254),s=n(r(11339)),o=r(12492),l=r(22701),c=r(85156)},58743:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.tryDecryptPatch=function(){return S.apply(this,arguments)},t.tryDecryptSnapshot=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(7589),s=r(60980),o=r(13815),l=r(68254),c=r(837),d=n(r(11339)),u=r(12492),p=r(22701),h=r(57228),f=r(18054),_=r(86458),m=r(85156),g=n(r(16088));const y=new TextDecoder;function E(){return(E=(0,i.default)((function*(e,t){return yield Promise.all(t.records.map((t=>v(e,u.SyncdMutationSyncdOperation.SET,t))))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){return yield Promise.all(t.mutations.map((t=>v(e,t.operation,t.record))))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r){const n=r.keyId.id,i=yield(0,c.getKeyData)(n);if(!i){if(t===u.SyncdMutationSyncdOperation.REMOVE)throw new m.SyncdFatalError("no key data for remove mutations");throw new m.SyncdMissingKeyError}const{syncAction:a,indexMac:o,valueMac:l,indexValueBinary:d}=yield A(e,n,i,t,r),{index:h,value:f,version:_}=a,g=f?(0,s.encodeProtobuf)(p.SyncActionValueSpec,f).readBuffer():f;return{index:y.decode(h),action:null,binarySyncAction:g,version:_,keyId:n,operation:t,indexMac:o,valueMac:l,collection:e,binarySyncData:d}}))).apply(this,arguments)}function A(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,r,n,i){const s=i.index.blob,c=i.value.blob,u=(0,h.valueMacFromIndexAndValueCipherText)(c),p=(0,_.split)(c,f.IV_LENGTH,c.byteLength-f.MAC_LENGTH-f.IV_LENGTH),y=p[0],E=p[1],S=p[2],v=yield(0,h.generateEncryptionKeys)(r),{indexKey:T,valueEncryptionKey:A,valueMacKey:C}=v,b=(0,_.combine)([y,E]),P=(0,h.generateAssociatedData)(n,t),M=yield(0,h.generateMac)(P,b,C);if(!(0,a.areBuffersEqual)(S,M))throw(0,l.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new m.SyncdFatalError("decryption failure: valueMAC mismatch");const O=yield(0,h.decryptCipherText)(new Uint8Array(y),A,E),I=(0,o.decodeSyncActionData)(e,O),w=g.default.validateSyncActionDataProtobuf(e,I),R=yield(0,h.generateIndexMac)(T,w.index);if(!(0,a.areBuffersEqual)(s,R))throw(0,l.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new m.SyncdFatalError("decryption failure: indexMAC mismatch");return{syncAction:w,indexMac:s,valueMac:u,indexValueBinary:O}}))).apply(this,arguments)}},59037:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadExternalPatch=function(){return m.apply(this,arguments)},t.downloadSnapshot=function(){return _.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(15688),o=n(r(70714)),l=r(13815),c=r(26384),d=r(37115),u=r(68254),p=n(r(11339)),h=r(85156),f=n(r(89453));function _(){return(_=(0,a.default)((function*(e,t){try{const r=yield g(t),n=(0,l.decodeSyncdSnapshot)(e,r);return f.default.validateSnapshotProtobuf(e,n)}catch(t){if(t instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_EXPIRED,e),new h.SyncdFatalError("snapshot expired");throw t}}))).apply(this,arguments)}function m(){return(m=(0,a.default)((function*(e,t){try{const r=yield g(t);return(0,l.decodeSyncdMutations)(e,r).mutations.map((t=>f.default.validateMutationProtobuf(e,t)))}catch(t){if(t instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_PATCH_EXPIRED,e),new h.SyncdFatalError("external patch expired");throw t}}))).apply(this,arguments)}function g(e){const{mediaKey:t,directPath:r,fileSha256:n,fileEncSha256:a}=e,l={directPath:r,encFilehash:(0,s.encodeB64)(a),filehash:(0,s.encodeB64)(n),mediaKey:(0,s.encodeB64)(t),type:"md-app-state",userDownloadAttemptCount:0};return c.downloadManager.downloadAndDecrypt((0,i.default)({signal:(new o.default).signal},l))}},11540:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.resolveConflict=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(45606),s=n(r(73407)),o=r(43402);function l(){return c.apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e,t){const r=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const r=t.get(e.index);if(r){const t=e.actionHandler;return{remoteMutationIndex:e.index,conflictResolutionState:yield t.resolveConflicts(r,e)}}}));return function(){return e.apply(this,arguments)}}())),n=new Map;return r.forEach((e=>{e&&n.set(e.remoteMutationIndex,e.conflictResolutionState)})),n}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const r=[];let n=[];const i=yield s.default.getPendingMutationsRows(["collection"],e),c=new Map(i.map((e=>[e.index,e]))),d=yield l(t,c);t.forEach((e=>{const t=d.get(e.index);if(t)switch(t){case a.ConflictResolutionState.SkipRemote:break;case a.ConflictResolutionState.ApplyRemoteAndDropLocal:r.push(e),n=n.concat(i.filter((t=>t.index===e.index)));break;case a.ConflictResolutionState.SkipRemoteAndDropLocal:n=n.concat(i.filter((t=>t.index===e.index)))}else r.push(e)}));const u=(0,o.sort)(r),p=[];for(let e=0;e<u.length;e++){const t=u[e].actionHandler;(yield t.dropMutationDueToCrossIndexConflict(u[e],c))||p.push(u[e])}return{remoteMutationsToApply:p,pendingMutationsToDrop:n.map((e=>e.id)).filter(Boolean)}}))).apply(this,arguments)}},43402:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._setDependency=function(e,t){l.set(e,t)},t.sort=function(e){const t=[],r=[];try{return e.forEach((n=>{t.push(n);const i=l.get(n.actionName);null!=i&&e.forEach((e=>{e!==n&&i.includes(e.actionName)&&function(e,t){const r=e.actionHandler.getChatJidAndMessageKey(e),n=t.actionHandler.getChatJidAndMessageKey(t);if(r&&n)return r.chatJid===n.chatJid&&(null==r.messageKey||null==n.messageKey||r.messageKey===n.messageKey);return!1}(e,n)&&(e.timestamp<n.timestamp?r.push([e,n]):r.push([n,e]))}))})),i.default.array(t,r)}catch(e){throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH,null),new o.SyncdFatalError("cyclic mutation dependency in patch")}};var i=n(r(94633)),a=(r(45606),r(68254)),s=n(r(11339)),o=r(85156);const l=new Map},6954:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedUploadMutationsToSyncActions=function(e,t){return e.map((e=>({index:e.index,action:e.action,binarySyncAction:e.binarySyncAction,actionState:t,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp})))},t.setMutationToSyncAction=function(e,t,r,n,i){return{index:e.index,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp,action:r,actionState:t,modelId:n,modelType:null!=i?i:void 0}},t.syncActionsToDecryptedMutation=function(e){return e.map((e=>({collection:e.collection,index:e.index,action:e.action,indexMac:e.indexMac,keyId:e.keyId,operation:n.SyncdMutationSyncdOperation.SET,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version})))};var n=r(12492)},72466:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.validateAndTypeSetMutations=function(e,t){return t.map((t=>{let r;if(t.binarySyncData){const e=t.binarySyncData;r=(0,a.decodeProtobuf)(d.SyncActionDataSpec,e).value}else t.binarySyncAction&&(r=(0,a.decodeProtobuf)(d.SyncActionValueSpec,t.binarySyncAction));if(!r)throw(0,o.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VALUE,e),new u.SyncdFatalError("missing action value");const n=(0,i.maybeNumberOrThrowIfTooLarge)(r.timestamp);if(null==n)throw(0,o.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_TIMESTAMP,e),new u.SyncdFatalError("missing action timestamp");return{index:t.index,version:t.version,keyId:t.keyId,indexMac:t.indexMac,valueMac:t.valueMac,collection:t.collection,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,timestamp:n}}))},t.validateNoDuplicatePatchVersionInCollection=function(e,t){const r=new Set;t.forEach((t=>{const n=t.version.version;if(r.has(n))throw(0,o.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.DUPLICATE_PATCH_VERSION_IN_COLLECTION,e),new u.SyncdFatalError("duplicate patch version in collection");r.add(n)}))},t.validateNoSameIndexForMultipleMutations=function(e,t,r){const n=new Set,i=new Set;t.forEach((t=>{let a=!1;if(t.operation===c.SyncdMutationSyncdOperation.SET&&(n.has(t.index)?a=!0:n.add(t.index)),t.operation===c.SyncdMutationSyncdOperation.REMOVE&&(i.has(t.index)?a=!0:i.add(t.index)),a)switch(r){case s.SyncDataType.Patch:throw(0,o.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH,e),new u.SyncdFatalError("same index for multiple mutations in patch");case s.SyncDataType.Snapshot:throw(0,o.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT,e),new u.SyncdFatalError("same index for multiple mutations in snapshot")}}))};var i=r(8243),a=r(84902),s=r(45606),o=r(68254),l=n(r(11339)),c=r(12492),d=r(22701),u=r(85156)},89453:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(8243),a=r(68254),s=n(r(11339)),o=r(85156);class l{static validateSnapshotProtobuf(e,t){const{version:r,records:n,mac:c,keyId:d}=t,u=null==r?void 0:r.version;if(!r||null==u)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_VERSION,e),new o.SyncdFatalError("missing snapshot version");const p=n.map((t=>l.validateRecordProtobuf(e,t)));if(!c)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_MAC,e),new o.SyncdFatalError("missing snapshot mac");const h=l.validateKeyIdProtobuf(e,d,s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_KEY_ID);return{version:{version:(0,i.numberOrThrowIfTooLarge)(u)},records:p,mac:c,keyId:h}}static validatePatchProtobuf(e,t){const{version:r,mutations:n,externalMutations:c,snapshotMac:d,patchMac:u,keyId:p,exitCode:h,deviceIndex:f}=t,_=null==r?void 0:r.version;if(!r||null==_)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_VERSION,e),new o.SyncdFatalError("missing patch version");if(n&&n.length>0&&c)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS,e),new o.SyncdFatalError("patch with both inline and external mutations");if(!d)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_SNAPSHOT_MAC,e),new o.SyncdFatalError("missing patch snapshot mac");if(!u)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_MAC,e),new o.SyncdFatalError("missing patch mac");const m=l.validateKeyIdProtobuf(e,p,s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_KEY_ID);if(c){const t=l.validateExternalBlobReference(e,c);return{version:{version:(0,i.numberOrThrowIfTooLarge)(_)},mutations:void 0,externalMutations:t,snapshotMac:d,patchMac:u,keyId:m,deviceIndex:f}}const g=n.map((t=>l.validateMutationProtobuf(e,t)));return{version:{version:(0,i.numberOrThrowIfTooLarge)(_)},mutations:g,externalMutations:void 0,exitCode:h,snapshotMac:d,patchMac:u,keyId:m,deviceIndex:f}}static validateExternalBlobReference(e,t){const{mediaKey:r,directPath:n,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}=t;if(!r)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY,e),new o.SyncdFatalError("missing external blob reference media key");if(!n)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH,e),new o.SyncdFatalError("missing external blob reference direct path");if(!c)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256,e),new o.SyncdFatalError("missing external blob reference file SHA256");if(!d)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256,e),new o.SyncdFatalError("missing external blob reference file enc SHA256");return{mediaKey:r,directPath:n,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}}static validateMutationProtobuf(e,t){const{operation:r,record:n}=t;if(null==r)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_OPERATION,e),new o.SyncdFatalError("missing mutation operation");if(!n)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_RECORD,e),new o.SyncdFatalError("missing mutation record");return{operation:r,record:l.validateRecordProtobuf(e,n)}}static validateRecordProtobuf(e,t){const{index:r,value:n,keyId:i}=t,c=null==r?void 0:r.blob,d=null==n?void 0:n.blob;if(!r||!c)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_INDEX,e),new o.SyncdFatalError("missing mutation index");if(!n||!d)throw(0,a.uploadFatalErrorMetric)(s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_VALUE,e),new o.SyncdFatalError("missing mutation value");return{index:{blob:c},value:{blob:d},keyId:l.validateKeyIdProtobuf(e,i,s.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_KEY_ID)}}static validateKeyIdProtobuf(e,t,r){const n=null==t?void 0:t.id;if(!t||!n)throw(0,a.uploadFatalErrorMetric)(r,e),new o.SyncdFatalError("missing mutation key id");return{id:n}}}t.default=l},16088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(68254),a=n(r(11339)),s=r(85156);t.default=class{static validateSyncActionDataProtobuf(e,t){const{index:r,value:n,padding:o,version:l}=t;if(!r)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_INDEX,e),new s.SyncdFatalError("missing action index");if(null==l)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VERSION,e),new s.SyncdFatalError("missing action version");return{index:r,value:n,padding:o,version:l}}}},35377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMetricsForMutations=function(e){(0,a.logCriticalBootstrapStageIfNecessary)(s.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MUTATIONS_DECRYPTED),e.forEach(l)};var i=r(84902),a=r(58597),s=n(r(11339)),o=r(22701);function l(e){let t;const{binarySyncAction:r}=e;if(null==r)return;const n=(0,i.decodeProtobuf)(o.SyncActionValueSpec,r);n.archiveChatAction?t=n.archiveChatAction.messageRange:n.markChatAsReadAction?t=n.markChatAsReadAction.messageRange:n.clearChatAction?t=n.clearChatAction.messageRange:n.deleteChatAction&&(t=n.deleteChatAction.messageRange),null!=t&&new s.default.MdAppStateMessageRange({additionalMessagesCount:t.messages.length}).commit()}},62274:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitBootstrapAppStateDownloadMetric=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(8243),s=r(92844),o=r(45606),l=r(49801),c=n(r(11339));function d(){return(d=(0,i.default)((function*(e,t,r,n){const i=new c.default.MdBootstrapAppStateDataDownloaded({mdBootstrapPayloadType:[o.CollectionName.CriticalBlock,o.CollectionName.CriticalUnblockLow].includes(e)?c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdTimestamp:(0,s.unixTimeMs)(),mdBootstrapStepDuration:(0,s.unixTimeMs)()-t,mdBootstrapStepResult:n?c.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:c.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,mdSessionId:yield l.MdSyncFieldStatsMeta.getMdSessionId()}),d=yield l.MdSyncFieldStatsMeta.getStorageEstimation();d.mdStorageQuotaBytes!==l.STORAGE_QUOTA_UNAVAILABLE&&(i.mdStorageQuotaUsedBytes=d.mdStorageQuotaUsedBytes,i.mdStorageQuotaBytes=d.mdStorageQuotaBytes);try{const e=(0,a.maybeNumberOrThrowIfTooLarge)(r);null!=e&&(i.mdBootstrapPayloadSize=e)}catch(e){}i.commit()}))).apply(this,arguments)}},65582:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyRequest=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(73407)),s=r(26442),o=r(86458);function l(){return(l=(0,i.default)((function*(e,t){const r=e.keyIds;if(r){const e=r.map((e=>e.keyId)).filter(Boolean);if(__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}
\t for keyIds: [${e.map(o.arrayBufferToHex)}]`,e){const r=[],n=[];return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield a.default.getSyncKey(new Uint8Array(e));t?r.push(t):n.push(e)}));return function(){return e.apply(this,arguments)}}())),__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}: about to send key share
\t keys with keydata: [${r.map((e=>(0,o.arrayBufferToHex)(e.keyId.buffer)))}]
\t keys without keydata: [${n.map((e=>(0,o.arrayBufferToHex)(e)))}]`,(0,s.sendAppStateSyncKeyShare)({type:"missing_key",keys:r,orphanKeys:n,peerDeviceId:t})}}}))).apply(this,arguments)}},82568:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyShare=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(8243),s=r(58597),o=n(r(73407)),l=r(68254),c=r(84051),d=r(4573),u=n(r(11339)),p=r(38804),h=r(86458);function f(){return(f=(0,i.default)((function*(e,t){(0,s.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_RECEIVED);const r=t.getDeviceId();__LOG__(2)`syncd: handling key share from device ${r} with ${e.keys.length} keys`;const n=[],f=e.keys;if(!f)return Promise.resolve();yield Promise.all(f.map(function(){var e=(0,i.default)((function*(e){var t;const i=null===(t=e.keyId)||void 0===t?void 0:t.keyId,s=e.keyData,c=null==s?void 0:s.keyData;if(!i)return void __LOG__(2)`syncd: received key with missing keyID from device ${r}`;const p=(0,h.arrayBufferToHex)(i);if(__LOG__(2)`syncd: received key share key id ${p} from device ${r} ${null!=c?"with":"without"} keyData`,6!==i.byteLength)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_ID}).commit(),__LOG__(4,void 0,new Error,!0)`syncd fatal error: key share key id has invalid bytelength of ${i.byteLength}`,SEND_LOGS(`syncd fatal error: key share key id has invalid bytelength of ${i.byteLength}`),(0,l.handleFatalError)();if(n.push({keyId:i,keyData:c}),s){var f,_,m;const e=s.timestamp,t=null===(f=s.fingerprint)||void 0===f?void 0:f.currentIndex,n=null===(_=s.fingerprint)||void 0===_?void 0:_.rawId,h=null===(m=s.fingerprint)||void 0===m?void 0:m.deviceIndexes;if(!c||null==e||null==t||null==n||!h)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_DATA}).commit(),__LOG__(4,void 0,new Error,!0)`syncd fatal error: invalid key share key data`,SEND_LOGS("syncd fatal error: invalid key share key data"),(0,l.handleFatalError)();const g=new Uint8Array(i);(yield o.default.getSyncKey(g))||(yield o.default.createSyncKey({keyId:g,keyEpoch:(0,d.getKeyEpoch)(i),keyData:c,timestamp:(0,a.numberOrThrowIfTooLarge)(e),fingerprint:{rawId:n,currentIndex:t,deviceIndexes:h}}),__LOG__(2)`syncd: stored key share key id ${p} from device ${r}`)}}));return function(){return e.apply(this,arguments)}}())),n.some((e=>null!=e.keyData))||__LOG__(2)`syncd: key share from device ${r} has no keys with keydata.`,yield(0,c.updateMissingKeys)(n,t),(0,p.syncBlockedCollections)()}))).apply(this,arguments)}},84051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._setMissingKeyTimeout=O,t.handleMissingKeysInPatches=function(){return v.apply(this,arguments)},t.handleMissingKeysInSnapshot=function(){return S.apply(this,arguments)},t.requestAllMissingKeys=function(){return L.apply(this,arguments)},t.updateMissingKeyDevices=function(){return E.apply(this,arguments)},t.updateMissingKeys=function(e,t){const r=t.getDeviceId(),n=[],a=[];return e.forEach((e=>{const t=e.keyData,r=(0,h.arrayBufferToHex)(e.keyId);t?n.push(r):a.push(r)})),__LOG__(2)`syncd: updateMissingKeys from device ${r}
\tkeys with keyData: ${n}
\tkeys without keyData: ${a}`,(0,_.getStorage)().lock(["missing-keys"],function(){var e=(0,i.default)((function*(){if(n.length>0&&(yield o.default.bulkRemoveMissingKeys(n),yield O()),a.length>0){const e=(yield o.default.bulkGetMissingKeys(a)).filter(Boolean);e.forEach((e=>e.deviceResponses.set(r,!1))),__LOG__(2)`syncd: updateMissingKeys: begin updating missing keys from device ${r}
\tmissingKeys: [${a}]`,yield o.default.createOrUpdateMissingKeys(e),__LOG__(2)`syncd: updateMissingKeys: finish updating missing keys from device ${r}`,yield D()}}));return function(){return e.apply(this,arguments)}}())};var i=n(r(48926)),a=n(r(22762)),s=r(92844),o=n(r(73407)),l=n(r(11339)),c=r(65031),d=r(64551),u=r(68254),p=r(4573),h=(r(45606),r(86458)),f=r(7589),_=r(99069),m=r(85156);let g;const y=new ArrayBuffer(0);function E(){return(E=(0,i.default)((function*(){const e=(yield(0,p.getPeerDevices)()).map((e=>e.getDeviceId()));return(0,_.getStorage)().lock(["missing-keys"],function(){var t=(0,i.default)((function*(){const t=yield o.default.getAllMissingKeys();if(0===t.length)return Promise.resolve();t.forEach((t=>{t.deviceResponses.forEach(((r,n)=>{e.includes(n)||t.deviceResponses.delete(n)}))})),yield o.default.createOrUpdateMissingKeys(t),yield D()}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const r=new Set,n=(yield o.default.getAllSyncKeys()).map((e=>(0,h.arrayBufferToHex)(e.keyId.buffer)));t.records.forEach((e=>{const t=e.keyId.id;if((0,f.areBuffersEqual)(t,y))throw new m.SyncdFatalError("snapshot has empty key");const i=(0,h.arrayBufferToHex)(t);n.includes(i)||r.add(i)})),__LOG__(2)`syncd: collection ${e}'s snapshot has missing keys ${[...r]}`,yield T(r)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const r=new Set,n=(yield o.default.getAllSyncKeys()).map((e=>(0,h.arrayBufferToHex)(e.keyId.buffer)));t.forEach((e=>{const t=e.keyId.id;if((0,f.areBuffersEqual)(t,y))throw new m.SyncdFatalError("syncd: patch has empty key. patch device id: ${p.deviceIndex}");const i=(0,h.arrayBufferToHex)(t);n.includes(i)||(__LOG__(2)`syncd: handleMissingKeysInPatches: missing key: keyId: ${i}, patch version: ${e.version.version}, patch device id: ${e.deviceIndex}`,r.add(i))})),__LOG__(2)`syncd: collection ${e}'s patches has missing keys ${[...r]}`,yield T(r)}))).apply(this,arguments)}function T(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const t=[...e];__LOG__(2)`syncd: _handleMissingKeys: missing keys [${t}]`;const r=new Set((yield o.default.bulkGetMissingKeys(t)).filter(Boolean).map((e=>e.keyHex))),n=t.filter((e=>!r.has(e)));if(__LOG__(2)`syncd: _handleMissingKeys: missing keys after filter: [${n}]`,0===n.length)return Promise.resolve();const i=n.map((e=>(0,h.hexToUint8Array)(e).buffer)),a=yield C(i);yield P(i,a.map((e=>e.getDeviceId())))}))).apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=yield(0,p.getPeerDevices)();return yield(0,c.sendAppStateSyncKeyRequest)(e,t),t}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){const r=()=>{const e=new Map;return t.forEach((t=>e.set(t,null))),e},n=e.map((e=>({keyHex:(0,h.arrayBufferToHex)(e),keyId:e,timestamp:(0,s.unixTimeMs)(),deviceResponses:r()})));yield o.default.createOrUpdateMissingKeys(n),yield O()}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(){clearTimeout(g),g=null;const e=yield o.default.getAllMissingKeys();if(0===e.length)return;__LOG__(2)`syncd: _setMissingKeyTimeout: missing keys: ${e.map((e=>(0,h.arrayBufferToHex)(e.keyId)))}`;const t=(0,a.default)(e,(e=>e.timestamp)),r=d.ServerProps.syncdWaitForKeyTimeoutDays*s.DAY_MILLISECONDS-(-t.timestamp+(0,s.unixTimeMs)());__LOG__(2)`syncd: earliest missing key: ${(0,h.arrayBufferToHex)(t.keyId)}, timestamp=${t.timestamp}, timeoutMs=${r}`,g=setTimeout(w,r)}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(){0!==(yield o.default.getAllMissingKeys()).length&&(new l.default.MdFatalError({mdFatalErrorCode:l.default.MD_SYNCD_FATAL_ERROR_CODE.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY}).commit(),__LOG__(4,void 0,new Error,!0)`syncd fatal error: timeout while waiting for missing key`,SEND_LOGS("syncd fatal error: timeout while waiting for missing key"),(0,u.handleFatalError)())}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(){const e=yield o.default.getAllMissingKeys();for(const t of e){let e=!0;for(const r of t.deviceResponses.values())if(null==r){e=!1;break}if(e)return new l.default.MdFatalError({mdFatalErrorCode:l.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_KEY_ON_ALL_CLIENTS}).commit(),__LOG__(4,void 0,new Error,!0)`syncd fatal error: missing key on all clients`,SEND_LOGS("syncd fatal error: missing key on all clients"),void(0,u.handleFatalError)()}}))).apply(this,arguments)}function L(){return(L=(0,i.default)((function*(){const e=yield o.default.getAllMissingKeys();__LOG__(2)`syncd: requestAllMissingKeys: missing keys: [${e.map((e=>e.keyHex))}]`,0!==e.length&&(yield C(e.map((e=>e.keyId))))}))).apply(this,arguments)}},837:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearSyncKeysCache=function(){g=new Map},t.getActiveKey=E,t.getKeyData=function(){return C.apply(this,arguments)},t.getNewestKeyPair=T;var i=n(r(48926)),a=n(r(22762)),s=n(r(63105)),o=n(r(6162)),l=n(r(73407)),c=r(9108),d=r(13722),u=r(26442),p=r(4573),h=n(r(11339)),f=r(15688),_=r(86458),m=r(27870);let g=new Map;const y=new m.PromiseQueue;function E(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return y.enqueue((()=>S(e)))}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=yield T(),r=yield(0,c.getMyDeviceList)();const{currentIndex:n,devices:i,rawId:a}=r;if(null==n)throw new Error("syncd: missing current index for own device");r={currentIndex:n,deviceIndexes:i.map((e=>e.keyIndex)),rawId:a};const s=(0,d.hasKeyExpired)(t),o=(0,d.hasADeviceBeenRemoved)(t,r);return e&&(s||o)?(t=(0,d.rotateKey)(t,r),__LOG__(2)`syncd: stored key rotation key id ${(0,_.arrayBufferToHex)(t.keyId.buffer)}`,yield l.default.createSyncKey(t),yield(0,u.sendAppStateSyncKeyShare)({type:"key_rotation",keys:[t]}),s&&(__LOG__(2)`syncd key rotation due to key expiry`,new h.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:h.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.APP_STATE_SYNC_KEY_EXPIRY}).commit()),o&&(__LOG__(2)`syncd key rotation due to device removal`,new h.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:h.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.DEVICE_DEREGISTERATION}).commit()),E(e)):{keyId:t.keyId.buffer,keyData:t.keyData}}))).apply(this,arguments)}function T(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(){const e=yield l.default.getAllSyncKeys(),t=(0,o.default)(e.map((e=>(0,p.getKeyEpoch)(e.keyId.buffer)))),r=(0,s.default)(e,(e=>(0,p.getKeyEpoch)(e.keyId.buffer)===t));return(0,a.default)(r,(e=>(0,p.getKeyDeviceId)(e.keyId.buffer)))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){var t;let r=g.get((0,f.encodeB64)(e));return r?r.keyData:(r=yield l.default.getSyncKeyData(new Uint8Array(e)),r&&g.set((0,f.encodeB64)(e),r),null===(t=r)||void 0===t?void 0:t.keyData)}))).apply(this,arguments)}},4573:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDeviceId=function(e){return new DataView(e).getUint16(0)},t.getKeyEpoch=function(e){return new DataView(e).getUint32(2)},t.getPeerDevices=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(9108),s=r(99234),o=r(58021);function l(){return(l=(0,i.default)((function*(){const e=[],t=(0,s.assertGetMe)().getDeviceId(),r=yield(0,a.getMyDeviceList)();return r.devices.forEach((n=>{n.id!==t&&e.push((0,o.createDeviceWidFromUserAndDevice)(r.id,n.id))})),e}))).apply(this,arguments)}},65031:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyRequest=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(52407),s=r(99234),o=r(238),l=r(17304),c=n(r(32219)),d=r(15860),u=r(86458),p=r(58597),h=n(r(11339));function f(){return(f=(0,i.default)((function*(e,t){const r={keyIds:e.map((e=>({keyId:e})))},n=t.map((e=>{const t=new c.default({fromMe:!0,remote:(0,s.assertGetMeUser)(),id:(0,d.newTag)()});return new l.Msg({id:t,to:e,type:"protocol",subtype:"app_state_sync_key_request",appStateSyncKeyRequest:r})})),i=t.map((e=>e.getDeviceId())),f=e.map((e=>(0,u.arrayBufferToHex)(e)));__LOG__(2)`syncd: send key request key id ${f} to peer deviceIds ${i}`,yield(0,o.storePeerMessages)(n),yield Promise.all(n.map(a.encryptAndSendKeyMsg)),(0,p.logCriticalBootstrapStageIfNecessary)(h.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_REQUESTED)}))).apply(this,arguments)}},26442:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyShare=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(52407),s=r(99234),o=r(238),l=r(17304),c=n(r(32219)),d=r(15860),u=r(4573),p=r(86458);function h(){return(h=(0,i.default)((function*(e){let t,r;if("key_rotation"===e.type?(t=f(e.keys),r=yield(0,u.getPeerDevices)()):"missing_key"===e.type&&(t=f(e.keys,e.orphanKeys),r=[e.peerDeviceId]),null==r)return Promise.resolve();const n=r,i=n.map((e=>{const r=new c.default({fromMe:!0,remote:(0,s.assertGetMeUser)(),id:(0,d.newTag)()});return new l.Msg({id:r,to:e,type:"protocol",subtype:"app_state_sync_key_share",appStateSyncKeyShare:t})})),h=n.map((e=>e.getDeviceId())),_=e.keys.map((e=>(0,p.arrayBufferToHex)(e.keyId.buffer)));__LOG__(2)`syncd: send key share key id ${_} to peer deviceIds ${h} due to ${e.type}`,yield(0,o.storePeerMessages)(i),yield Promise.all(i.map(a.encryptAndSendKeyMsg))}))).apply(this,arguments)}function f(e,t){let r=e.map((e=>({keyId:{keyId:e.keyId.buffer},keyData:{keyData:e.keyData,fingerprint:{rawId:e.fingerprint.rawId,currentIndex:e.fingerprint.currentIndex,deviceIndexes:e.fingerprint.deviceIndexes},timestamp:e.timestamp}})));if(t){const e=t.map((e=>({keyId:{keyId:e},keyData:void 0})));r=r.concat(e)}return{keys:r}}},13722:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.hasADeviceBeenRemoved=function(e,t){const r=e.fingerprint,{rawId:n,currentIndex:a,deviceIndexes:s}=t,o=new Set(r.deviceIndexes);for(let e=r.currentIndex+1;e<=a;e++)o.add(e);return r.rawId!==n||!(0,i.default)(o,new Set(s))},t.hasKeyExpired=function(e){const t=e.timestamp,r=Math.min(90,Math.max(1,d.ServerProps.syncdKeyMaxUseDays));return(0,s.unixTimeMs)()-t>r*s.DAY_MILLISECONDS},t.rotateKey=function(e,t){const{keyId:r,keyEpoch:n}=function(e){const t=(0,c.getKeyEpoch)(e.keyId.buffer)+1,r=(0,l.assertGetMe)().getDeviceId();return{keyId:new Uint8Array((0,a.concatArrayBuffers)((0,o.intToBytes)(2,r).buffer,(0,o.intToBytes)(4,t).buffer)),keyEpoch:t}}(e),i=self.crypto.getRandomValues(new Uint8Array(32)).buffer,d=function(e){const{currentIndex:t,deviceIndexes:r,rawId:n}=e;return{rawId:n,currentIndex:t,deviceIndexes:r}}(t),u=(0,s.unixTimeMs)();return{keyId:r,keyEpoch:n,keyData:i,fingerprint:d,timestamp:u}};var i=n(r(18446)),a=r(32428),s=r(92844),o=r(11365),l=r(99234),c=r(4573),d=r(64551)},28900:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._generateMutationsToUpload=G,t.buildSyncIqNode=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=n(r(89734)),s=r(15688),o=r(7589),l=r(31914),c=r(1377),d=n(r(18309)),u=r(45606),p=n(r(73407)),h=r(81122),f=r(66622),_=r(99234),m=n(r(52991)),g=r(837),y=r(4573),E=r(84527),S=r(2622),v=r(64551),T=r(12492),A=n(r(78375));function C(){return(C=(0,i.default)((function*(e){const{collectionNodes:t,collectionWithEncryptedMutations:r,localCollectionVersions:n,collectionsToSkip:i}=yield b(e);return{syncIqNode:(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,xmlns:"w:sync:app:state",type:"set",id:(0,l.generateId)()},(0,l.wap)("sync",null,t)),collectionWithEncryptedMutations:r,localCollectionVersions:n,collectionsToSkip:i}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=[],r=function(){var e=(0,i.default)((function*(e,r){const n=yield p.default.getCollectionVersion(e);let i,a;if(null!=r&&r.length>0)if(null==n)__LOG__(2)`syncd: skipping ${e} in sync iq patch because initial full sync
is incomplete`,t.push(e);else{const{patchNode:t,encryptedMutations:n}=yield M(e,r);i=t,a=n}return{collection:e,version:n,patchNode:i,encryptedMutations:a}}));return function(){return e.apply(this,arguments)}}(),n=new Map,a=new Map,s=[];e.forEach(((e,t)=>s.push(r(t,e))));return{collectionNodes:(yield Promise.all(s)).map((e=>{const{collection:t,version:r,patchNode:i,encryptedMutations:s}=e;return s&&a.set(t,s),n.set(t,r),(0,l.wap)("collection",{name:(0,l.CUSTOM_STRING)(t),version:(0,l.INT)(null!=r?r:u.DEFAULT_COLLECTION_VERSION),return_snapshot:void 0===r?"true":"false"},i)})),collectionWithEncryptedMutations:a,localCollectionVersions:n,collectionsToSkip:t}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){const r=yield(0,g.getActiveKey)(!I(t)),n=(yield G(e,t,r)).map((e=>(0,f.encryptMutation)(e,r))),a=yield Promise.all(n),s=a.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),o=yield(0,c.computeLtHash)(e,s),{snapshotMac:d,patchMac:u}=yield(0,c.computeOutgoingSnapshotAndPatchMacs)(e,o,a,r.keyData),p=a.map((e=>k(e.keyId,e.operation,e.indexMac,e.indexAndValueCipherText))),h=L(p),_=function(){var e=(0,i.default)((function*(){const e=yield(0,E.uploadExternalPatch)(h);return D(yield w(e,h),r.keyId,d,u)}));return function(){return e.apply(this,arguments)}}();let m;(0,E.exceedInlineMutationCount)(p)?m=yield _():(m=N(p,r.keyId,d,u),(0,E.exceedPatchProtobufSize)(m)&&(m=yield _()));return{patchNode:(0,l.wap)("patch",null,m),encryptedMutations:a}}))).apply(this,arguments)}function I(e){return m.default.isLogoutInProgress&&e.some((e=>JSON.parse(e.index)[0]===u.Actions.Sentinel))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e,t){const{mediaKey:r,directPath:n,encFilehash:i,handle:a}=e;if(!a)throw new Error("Missing handle after uploading external patch to mms4");const o=yield(0,d.default)(t);return{mediaKey:(0,s.decodeB64)(r),directPath:n,handle:a,fileSizeBytes:t.byteLength,fileSha256:(0,s.decodeB64)(o),fileEncSha256:(0,s.decodeB64)(i)}}))).apply(this,arguments)}function D(e,t,r,n){const i=v.ServerProps.syncdPatchDeviceIndexIncluded?(0,_.assertGetMe)().getDeviceId():void 0;return(0,h.encodeSyncdPatch)({keyId:{id:t},externalMutations:e,snapshotMac:r,patchMac:n,deviceIndex:i})}function N(e,t,r,n){const i=v.ServerProps.syncdPatchDeviceIndexIncluded?(0,_.assertGetMe)().getDeviceId():void 0;return(0,h.encodeSyncdPatch)({keyId:{id:t},mutations:e,snapshotMac:r,patchMac:n,deviceIndex:i})}function L(e){return(0,h.encodeSyncdMutations)({mutations:e})}function k(e,t,r,n){return{operation:t,record:{keyId:{id:e},index:{blob:r},value:{blob:n}}}}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e,t,r){const n=yield p.default.getSyncActionsRows(["collection"],[e]);let i=t;const a=F(e,n,t,r.keyId);i=i.concat(a);const s=x(n,i,r.keyId);return A.default.addKeyRotationRemoveCount(s.length),i=i.concat(s),i}))).apply(this,arguments)}function F(e,t,r,n){let i=t.filter((e=>!r.map((e=>e.index)).includes(e.index)&&!(0,o.areBuffersEqual)(e.keyId,n)));i=(0,a.default)(i,(e=>(0,y.getKeyEpoch)(e.keyId)));const s=Math.min(5,Math.max(1,v.ServerProps.syncdAdditionalMutations));return i=i.slice(0,s),(0,S.syncActionsToPendingMutations)(i,T.SyncdMutationSyncdOperation.SET)}function x(e,t,r){const n=t.map((e=>e.index)),i=e.filter((e=>n.includes(e.index))).filter((e=>!(0,o.areBuffersEqual)(e.keyId,r)));return(0,S.syncActionsToPendingMutations)(i,T.SyncdMutationSyncdOperation.REMOVE)}},81122:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSyncActionData=function(e){try{return(0,i.encodeProtobuf)(o.SyncActionDataSpec,e).readBuffer()}catch(e){throw new a.default.MdFatalError({mdFatalErrorCode:a.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("action data protobuf serialization failed")}},t.encodeSyncdMutations=function(e){try{return(0,i.encodeProtobuf)(s.SyncdMutationsSpec,e).readBuffer()}catch(e){throw new a.default.MdFatalError({mdFatalErrorCode:a.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("mutations protobuf serialization failed")}},t.encodeSyncdPatch=function(e){try{return(0,i.encodeProtobuf)(s.SyncdPatchSpec,e).readBuffer()}catch(e){throw new a.default.MdFatalError({mdFatalErrorCode:a.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("patch protobuf serialization failed")}};var i=r(60980),a=n(r(11339)),s=r(12492),o=r(22701),l=r(85156)},66622:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMutation=function(){return y.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(76100),o=r(84902),l=n(r(73407)),c=r(81122),d=r(837),u=n(r(11339)),p=r(12492),h=r(22701),f=r(57228),_=r(18054),m=r(86458),g=r(85156);function y(){return(y=(0,a.default)((function*(e,t){const{index:r,operation:n}=e;let a=t.keyId,s=t.keyData;switch(n){case p.SyncdMutationSyncdOperation.SET:break;case p.SyncdMutationSyncdOperation.REMOVE:const e=yield l.default.getSyncAction(r);if(!e)throw new g.SyncdFatalError("no corresponding set mutation");const t=e.keyId;a=t,s=yield(0,d.getKeyData)(t)}const{indexMac:o,indexAndValueCipherText:c}=yield E(e,a,s),u=(0,f.valueMacFromIndexAndValueCipherText)(c);return(0,i.default)((0,i.default)({},e),{},{keyId:a,keyData:s,indexMac:o,indexAndValueCipherText:c,valueMac:u})}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,r){try{const{index:n,binarySyncAction:i,operation:a,version:o}=e,l=(0,s.stringToArrayBuffer)(n),c=yield(0,f.generateEncryptionKeys)(r),{indexKey:d,valueEncryptionKey:u,valueMacKey:p}=c,h=yield self.crypto.getRandomValues(new Uint8Array(_.IV_LENGTH)),g=v(l,i,(0,f.generatePadding)(l.byteLength,i.byteLength),o),y=yield(0,f.generateCipherText)(h,u,g),E=(0,m.combine)([h.buffer,y]),S=(0,f.generateAssociatedData)(a,t),T=yield(0,f.generateMac)(S,E,p),A=(0,m.combine)([E,T]);return{indexMac:yield(0,f.generateIndexMac)(d,l),indexAndValueCipherText:A}}catch(e){throw new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.ENCRYPTION_FAILED}).commit(),new g.SyncdFatalError("encryption failure")}}))).apply(this,arguments)}function v(e,t,r,n){return(0,c.encodeSyncActionData)({index:e,value:(0,o.decodeProtobuf)(h.SyncActionValueSpec,t),padding:r,version:n})}},84527:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exceedInlineMutationCount=function(e){const t=Math.min(2e3,Math.max(s.ServerProps.syncdInlineMutationsMaxCount,100));return e.length>t},t.exceedPatchProtobufSize=function(e){const t=1e3*Math.min(100,Math.max(s.ServerProps.syncdPatchProtobufMaxSize,10));return e.byteLength>t},t.uploadExternalPatch=function(e){return o.default.encryptAndUpload({blob:e,signal:(new i.default).signal,type:"md-app-state",uploadOrigin:a.default.UPLOAD_ORIGIN_TYPE.UNKNOWN,userUploadAttemptCount:0,forwardedFromWeb:!1})};var i=n(r(70714)),a=n(r(11339)),s=r(64551),o=n(r(54824))},34089:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(28900),s=n(r(73407)),o=r(83853);function l(){return(l=(0,i.default)((function*(e){const t=new Map,r=new Map;yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const n=yield s.default.getPendingMutationsRows(["collection"],e),i=n.map((e=>e.id)).filter(Boolean);r.set(e,i);const a=(0,o.compactPatch)(n);t.set(e,a)}));return function(){return e.apply(this,arguments)}}()));const n=yield(0,a.buildSyncIqNode)(t);return{syncIqNode:n.syncIqNode,collectionWithPendingMutationsIds:r,collectionWithEncryptedMutations:n.collectionWithEncryptedMutations,localCollectionVersions:n.localCollectionVersions,collectionsToSkip:n.collectionsToSkip}}))).apply(this,arguments)}},2622:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncActionsToPendingMutations=function(e,t){return e.map((e=>{let r=e.binarySyncAction;if(!r){const t=(0,n.decodeProtobuf)(a.SyncActionDataSpec,e.binarySyncData).value;r=(0,i.encodeProtobuf)(a.SyncActionValueSpec,t).readBuffer()}return{collection:e.collection,index:e.index,binarySyncAction:r,operation:t,version:e.version,timestamp:e.timestamp,action:e.action}}))};var n=r(84902),i=r(60980),a=r(22701)},83853:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.compactPatch=function(e){return(0,i.default)(e.reverse(),(e=>e.index)).reverse()};var i=n(r(45578))},61107:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncResponseParser=void 0;var i=r(71914),a=r(45606),s=r(13815),o=n(r(11339)),l=r(85156);const c=new i.WapParser("syncResponseParser",(e=>{__LOG__(2)`syncd: start parsing syncd collections`;const t=[];return e.child("sync").mapChildrenWithTag("collection",(e=>{const r={},n=a.CollectionName.cast(e.attrString("name"));if(!n)throw new l.SyncdFatalError("invalid collection name");r.name=n,r.state=function(e,t){if(!e.hasAttr("type")||"error"!==e.attrString("type"))return e.hasAttr("has_more_patches")?a.CollectionState.SuccessHasMore:a.CollectionState.Success;{const r=e.child("error"),n=r.attrString("code"),i=r.attrString("text");switch(n){case"409":return e.hasAttr("has_more_patches")?a.CollectionState.ConflictHasMore:a.CollectionState.Conflict;case"400":return new o.default.MdFatalError({mdFatalErrorCode:o.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_FOR_COLLECTION}).commit(),__LOG__(4,void 0,new Error,!0)`syncd fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;case"404":return new o.default.MdFatalError({mdFatalErrorCode:o.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_FOR_COLLECTION}).commit(),__LOG__(4,void 0,new Error,!0)`syncd fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;default:return __LOG__(3,void 0,void 0,!0)`syncd retryable error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd retryable error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorRetry}}}(e,r.name),e.hasAttr("version")&&(r.version=parseInt(e.attrString("version"),10)),e.hasChild("patches")&&(r.patches=e.child("patches").mapChildrenWithTag("patch",(e=>(0,s.decodeSyncdPatch)(n,e.contentBytes())))),e.hasChild("snapshot")&&(r.snapshot=(0,s.decodeExternalBlobReference)(n,e.child("snapshot").contentBytes())),t.push(r),__LOG__(2)`syncd: successfully parsed collection ${n}`})),t}));t.syncResponseParser=c},23026:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.serverSync=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(29938),s=r(24747),o=r(45606),l=r(85156),c=n(r(11339)),d=n(r(34089)),u=r(61107),p=n(r(78375)),h=n(r(73407)),f=r(58597);function _(){return(_=(0,i.default)((function*(e){let t=[],r=[...e],n=0;for(;(n<5||r.length>0&&n<500)&&0!==r.length;){const{doneCollections:e,refetchCollections:i}=yield m(r);r=i,t=t.concat(e),n++}return r.length>0&&(__LOG__(4,void 0,new Error,!0,["syncd"])`syncd: reached max iterations for collections: ${r}`,SEND_LOGS("syncd max iteration"),t=t.concat(r.map((e=>({state:o.CollectionState.ErrorRetry,name:e}))))),t}))).apply(this,arguments)}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if(0===e.length)return{doneCollections:[],refetchCollections:[]};try{const{collectionDetails:t,localCollectionVersions:r,collectionsToUpload:n}=yield y(e);__LOG__(2)`syncd: deferred local mutation upload for ${n}`,__LOG__(2)`syncd: local collection versions:`,r.forEach(((e,t)=>{__LOG__(2)`\n\t${t} v${null!=e?e:"(undefined)}"}`}));const s=[],l=[];t.forEach((e=>{switch(e.state){case o.CollectionState.ErrorRetry:case o.CollectionState.ErrorFatal:case o.CollectionState.Blocked:return void l.push(e);default:s.push(e)}e.state!==o.CollectionState.Conflict&&e.state!==o.CollectionState.ConflictHasMore||p.default.incConflict()}));const c=yield Promise.all(s.map((e=>(0,a.applyAppStateSyncResponse)(e,r.get(e.name))))),d=[];return yield Promise.all(c.map(function(){var e=(0,i.default)((function*(e){if(e.state===o.CollectionState.Conflict){(yield h.default.hasPendingMutationForCollection(e.name))?d.push(e.name):(e.state=o.CollectionState.Success,l.push(e))}else e.state===o.CollectionState.ConflictHasMore||e.state===o.CollectionState.SuccessHasMore||e.state===o.CollectionState.Success&&n.some((t=>t===e.name))?d.push(e.name):l.push(e)}));return function(){return e.apply(this,arguments)}}())),{doneCollections:l,refetchCollections:d}}catch(t){if(t instanceof l.SyncdFatalError){__LOG__(4,void 0,new Error,!0)`syncd fatal error: syncd global throws ${t.message}`,SEND_LOGS(`syncd fatal error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:o.CollectionState.ErrorFatal,name:e}))),refetchCollections:[]}}__LOG__(3,void 0,void 0,!0)`syncd retryable error: syncd global throws ${t.message}`,SEND_LOGS(`syncd retryable error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:o.CollectionState.ErrorRetry,name:e,serverBackoff:t.errorBackoff}))),refetchCollections:[]}}}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){const{syncIqNode:t,collectionWithPendingMutationsIds:r,collectionWithEncryptedMutations:n,localCollectionVersions:i,collectionsToSkip:a}=yield(0,d.default)(e);(0,f.logCriticalBootstrapStageIfNecessary)(c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.REQUEST_BUILT),__LOG__(2)`syncd: sending sync request for collections: ${e.map((e=>{var t,n,a;return`\n\t${e} v${null!==(t=i.get(e))&&void 0!==t?t:"(undefined)"} ${(null!==(n=null===(a=r.get(e))||void 0===a?void 0:a.length)&&void 0!==n?n:0)>0&&null!=i.get(e)?" with local changes":""}`}))}`;const o=yield(0,s.sendIq)(t,u.syncResponseParser);if((0,f.logCriticalBootstrapStageIfNecessary)(c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_RECEIVED),o.success){(0,f.logCriticalBootstrapStageIfNecessary)(c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_PARSED_VALID);const e=o.result;return __LOG__(2)`syncd: received sync response for collections: ${e.map((e=>{let t=`\n${e.name}`;return null!=e.version&&(t+=`\n\tupdated to version ${e.version}`),null!=e.snapshot&&(t+="\n\tcontains snapshot"),null!=e.patches&&(t+=`\n\tcontains ${e.patches.length} patches`),t}))}`,e.forEach((e=>{const t=r.get(e.name);t&&(e.syncedPendingMutationsId=t);const i=n.get(e.name);i&&(e.syncedEncryptedMutations=i)})),{collectionDetails:e,localCollectionVersions:i,collectionsToUpload:a}}const{errorCode:l,errorText:p,errorBackoff:h}=o;throw S(l,p,h)}))).apply(this,arguments)}function S(e,t,r){switch(e){case 400:return new c.default.MdFatalError({mdFatalErrorCode:c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_GLOBAL_ERROR}).commit(),new l.SyncdFatalError(t);case 404:return new c.default.MdFatalError({mdFatalErrorCode:c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_GLOBAL_ERROR}).commit(),new l.SyncdFatalError(t);case 405:return new c.default.MdFatalError({mdFatalErrorCode:c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_METHOD_GLOBAL_ERROR}).commit(),new l.SyncdFatalError(t);case 406:return new c.default.MdFatalError({mdFatalErrorCode:c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR}).commit(),new l.SyncdFatalError(t);default:return new l.SyncdRetryableError(t,r)}}},68254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleFatalError=function(){return f.apply(this,arguments)},t.uploadFatalErrorMetric=function(e,t){const n=r(48277).default;new l.default.MdFatalError({mdFatalErrorCode:e,collection:t?(0,d.collectionNameToMetric)(t):void 0,isBootstrap:n.isSyncDCriticalDataSyncInProcess()}).commit(!0)};var i=n(r(48926)),a=(r(45606),r(88102)),s=r(86945),o=r(65044),l=n(r(11339)),c=r(83578),d=r(93824),u=r(13983),p=r(89751),h=r(97401);function f(){return(f=(0,i.default)((function*(e){__LOG__(2)`syncd: starting fatal flow`;const t=(0,s.getABPropConfigValue)("should_deregister_on_syncd_fatal"),n=r(48277).default;let i=[];null!=e&&(i=e.map((e=>String(e)))),yield(0,h.asyncSleep)(5e3),__LOG__(2)`syncd: notifying primary on fatal error`,yield(0,u.sendAppStateFatalExceptionNotification)(i),!1!==t?(__LOG__(4,!0,new Error)`[syncd] Received fatal error and logged out`,o.Socket.logout(!1,c.LogoutReason.SyncdFailure)):n.isSyncDCriticalDataSyncInProcess()?(__LOG__(4,!0,new Error,!0)`critical sync failed during bootstrap`,SEND_LOGS("critical sync failed during bootstrap"),o.Socket.logout(!1,c.LogoutReason.SyncdErrorDuringBootstrap)):(__LOG__(4,!0,new Error)`[syncd] Received fatal error and showed fatal flag`,(0,p.updateSyncdDisabledDueToFatalFlag)(!0),a.Cmd.handleFatalError())}))).apply(this,arguments)}},13983:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateFatalExceptionNotification=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(92844),s=r(52407),o=r(99234),l=r(17304),c=n(r(32219)),d=r(238),u=r(15860),p=r(58021);function h(){return(h=(0,i.default)((function*(e){const t={collectionNames:e,timestamp:(0,a.unixTimeMs)()},r=new c.default({fromMe:!0,remote:(0,o.getMeUser)(),id:(0,u.newTag)()}),n=new l.Msg({id:r,to:(0,p.createDeviceWidFromUserAndDevice)((0,o.assertGetMe)().user,0),type:"protocol",subtype:"app_state_fatal_exception_notification",appStateFatalExceptionNotification:t});return yield(0,d.storePeerMessages)([n]),(0,s.encryptAndSendKeyMsg)(n)}))).apply(this,arguments)}},12600:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAllOrphansAndUnsupported=function(){return m.apply(this,arguments)},t.checkOrphanChats=p,t.checkOrphanMessages=d,t.checkOrphanMutations=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(29938),s=r(89751),o=r(45606),l=n(r(73407));function c(){return(c=(0,i.default)((function*(e,t){if((0,s.isSyncdDisabled)())return Promise.resolve();yield Promise.all([d(e),p(t)])}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){yield f(e,o.SyncModelType.Msg)}))).apply(this,arguments)}function p(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){yield f(e,o.SyncModelType.Chat)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){if((0,s.isSyncdDisabled)())return Promise.resolve();const r=yield l.default.getSyncActionsRows(["modelId","modelType","actionState"],e.map((e=>[e,t,o.SyncActionState.Orphan])));yield(0,a.applyIndividualMutations)(r)}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){if((0,s.isSyncdDisabled)())return Promise.resolve();__LOG__(2)`syncd: start applyAllOrphansAndUnsupported`;const e=yield l.default.getSyncActionsRows(["actionState"],[o.SyncActionState.Orphan,o.SyncActionState.Unsupported]);yield(0,a.applyIndividualMutations)(e),__LOG__(2)`syncd: end applyAllOrphansAndUnsupported`}))).apply(this,arguments)}},37933:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(45606),s=n(r(73407)),o=n(r(40108)),l=r(38804);function c(){return(c=(0,i.default)((function*(){const e=yield o.default.getSentinelMutations();return yield s.default.appendPendingMutationsRows(e),(0,l.markCollectionsForSync)([...a.CollectionName.members()])}))).apply(this,arguments)}},38804:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SYNCD_INTERNAL_TABLES_TO_LOCK=void 0,t.initialize=function(){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return(0,y.isSyncdDisabled)()?Promise.resolve():(function(){const e=6e4,t=(0,s.default)((0,a.default)((function*(){const e=yield(0,S.getSyncActionsTable)().count();v.default.setStoredMutationCount(e);const t=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Malformed);v.default.setInvalidActionCount(t.length);const r=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Unsupported);v.default.setUnsupportedActionCount(r.length);const n=yield d.default.getMissingKeyCount();v.default.setMissingKeyCount(n)})),e,{maxWait:3*e});E.Cmd.on(E.APP_STATE_SYNC_COMPLETED,t)}(),G(),l.default.loadStatesFromDb().then((()=>K())));return Promise.reject(new Error("This call is only supported in MD mode"))},t.lockForSync=function(e,t,r){const n=(0,h.getStorage)().lock([...e,...C],(e=>Promise.all([d.default.appendPendingMutationsRows(t),r(e)]))).then((()=>{D(t.map((e=>e.collection)))}));return Promise.resolve(n)},t.markCollectionsForSync=D,t.sanitizeActionInSyncActionsRow=G,t.syncBlockedCollections=function(){const e=l.default.getCollectionsInStateBlocked();return l.default.moveCollectionsToDirty(e),O=new Set([...O,...M]),__LOG__(2)`syncd: syncBlockedCollections:
\tmoving blocked collections to dirty: [${e}]
\tadding inflight collections to pending: [${[...M]}]`,F()};var i=n(r(81109)),a=n(r(48926)),s=n(r(23279)),o=r(7293),l=n(r(11681)),c=r(45606),d=n(r(73407)),u=n(r(11339)),p=r(23026),h=r(99069),f=n(r(17072)),_=r(41796),m=r(12600),g=r(68254),y=r(89751),E=r(88102),S=r(76214),v=n(r(78375)),T=r(58052),A=r(58597);const C=["pending-mutations"];t.SYNCD_INTERNAL_TABLES_TO_LOCK=C;const b=36e5;let P,M=new Set,O=new Set,I=!1,w=0,R=0;if((0,_.isConnectedToPage)()){const e=r(8080).Stream,t=r(8080).StreamMode;(0,f.default)(e,"change:mode",(()=>e.mode===t.MAIN)).then((()=>{o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&!(0,y.isSyncdDisabled)()&&((0,m.applyAllOrphansAndUnsupported)(),function(){j.apply(this,arguments)}())}))}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const r=null!=t?yield L(e,t):e;return __LOG__(2)`syncd: marking for sync: ${r}`,r.forEach((e=>{const t=l.default.getCollectionState(e);t===c.CollectionSyncState.UpToDate?l.default.moveCollectionsToDirty([e]):t===c.CollectionSyncState.Dirty&&(O=new Set([...O,e]))})),yield l.default.persistToDb(),F()}return Promise.reject(new Error("This call is only supported in MD mode"))}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t){const r=yield d.default.getCollectionVersions(e);return e.filter((e=>{const n=r.get(e);if(null==n)return __LOG__(2)`syncd: local version for ${e} missing; will mark for sync.`,!0;const i=t.get(e);return null==i?(__LOG__(2)`syncd: server version for ${e} missing; will mark for sync.`,!0):n<i?(__LOG__(2)`syncd: local version (${n}) for ${e} less than server version (${i}); will mark for sync.`,!0):(__LOG__(2)`syncd: local version (${n})for ${e} >= server version (${i}); will not mark for sync.`,!1)}))}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,a.default)((function*(){if(!(0,T.getMdSyncActionsActionSanitized)()){__LOG__(2)`syncd: sanitizing null 'action' property in sync-actions table`;const e=(yield(0,S.getSyncActionsTable)().all()).filter((e=>null==e.action)).map((e=>{const t=JSON.parse(e.index)[0];return c.Actions.cast(t)?(0,i.default)((0,i.default)({},e),{},{action:t}):(__LOG__(2)`syncd: invalid action ${t}`,(0,i.default)({},e))}));yield d.default.updateSyncActionRows(e),(0,T.setMdSyncActionsActionSanitized)(!0)}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(){if((0,y.isSyncdDisabled)())return Promise.resolve();const e=l.default.getCollectionsInStateDirty(),t=new Set(e.filter((e=>!M.has(e))));if(0===t.size)return Promise.resolve();let r=[];try{M=new Set([...M,...t]),__LOG__(2)`syncd: initiate server sync`,r=yield(0,p.serverSync)([...t]),__LOG__(2)`syncd: server sync successful`;const e=r.filter((e=>e.state===c.CollectionState.ErrorRetry));e.length>0&&(R=e[0].serverBackoff||0,w=0),Y(r)}catch(e){l.default.moveCollectionsToFiniteRetry([...t])}finally{l.default.persistToDb(),M=new Set([...M].filter((e=>!t.has(e)))),K(),E.Cmd.trigger(E.APP_STATE_SYNC_COMPLETED,r)}}))).apply(this,arguments)}function B(){if((0,y.isSyncdDisabled)())return;const e=new Set(l.default.getCollectionsInStateRetry());var t,r;0!==e.size&&(P=setTimeout((0,a.default)((function*(){try{I=!0,w+=1,__LOG__(2)`syncd: initiate server sync retry`;const t=yield(0,p.serverSync)([...e]);__LOG__(2)`syncd: server sync retry successful`,Y(t)}catch(t){l.default.moveCollectionsToFiniteRetry([...e])}finally{!function(){const e=l.default.getExpiredCollections();e.length>0&&(l.default.moveCollectionsToFatal(e),__LOG__(4,void 0,new Error,!0)`syncd fatal error: expired collections`,SEND_LOGS("syncd fatal error: expired collections"),new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D}).commit())}(),l.default.persistToDb(),I=!1,K()}})),(t=w,r=R,Math.min(Math.max(2**t*1e3,r),b))))}function K(){if(l.default.getCollectionsInStateDirty().length>0&&(O=new Set([...O].filter((e=>M.has(e)))),F()),l.default.getCollectionsInStateRetry().length>0){if(I)return;null!=P&&clearTimeout(P),B()}l.default.getCollectionsInStateFatal().length>0&&(0,g.handleFatalError)(l.default.getCollectionsInStateFatal())}function Y(e){return e.forEach((e=>e.state!==c.CollectionState.Success||O.has(e.name)?e.state===c.CollectionState.ErrorRetry?((0,A.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ENTERED_RETRY_MODE),l.default.moveCollectionsToFiniteRetry([e.name])):e.state===c.CollectionState.ErrorFatal?l.default.moveCollectionsToFatal([e.name]):e.state!==c.CollectionState.Blocked||O.has(e.name)?void 0:l.default.moveCollectionsToBlocked([e.name]):l.default.moveCollectionsToUpToDate([e.name])))}function j(){return(j=(0,a.default)((function*(){const e=yield d.default.getAllPendingMutationsRows(),t=l.default.getCollectionsInStateBlocked();l.default.moveCollectionsToDirty(t);const r=e.map((e=>e.collection)).concat(t);r.length>0&&(__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections: [${r}]`,D(r))}))).apply(this,arguments)}},89751:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isSyncdDisabled=function(){return"true"===(0,i.default)(s.default,"localStorage").getItem(a.default.KEY_SYNCD_DISABLED_DUE_TO_FATAL)},t.updateSyncdDisabledDueToFatalFlag=function(e){(0,i.default)(s.default,"localStorage").setItem(a.default.KEY_SYNCD_DISABLED_DUE_TO_FATAL,e.toString())};var i=n(r(45095)),a=n(r(69618)),s=n(r(92417))},85156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionCheckError=t.SyncdRetryableError=t.SyncdMissingKeyError=t.SyncdFatalError=void 0;class r extends Error{constructor(){super(...arguments),this.name="SyncdMissingKeyError"}}t.SyncdMissingKeyError=r;class n extends Error{constructor(e,t){super(e),this.name="SyncdRetryableError",this.backoff=t,this.message=e}}t.SyncdRetryableError=n;class i extends Error{constructor(e){super(e),this.name="SyncdFatalError",this.message=e}}t.SyncdFatalError=i;class a extends Error{constructor(){super(...arguments),this.name="SyncdVersionCheckError"}}t.SyncdVersionCheckError=a},93824:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.collectionNameToMetric=function(e){switch(e){case a.CollectionName.CriticalBlock:return s.default.COLLECTION.CRITICAL_BLOCK;case a.CollectionName.CriticalUnblockLow:return s.default.COLLECTION.CRITICAL_UNBLOCK_LOW;case a.CollectionName.Regular:return s.default.COLLECTION.REGULAR;case a.CollectionName.RegularHigh:return s.default.COLLECTION.REGULAR_HIGH;case a.CollectionName.RegularLow:return s.default.COLLECTION.REGULAR_LOW}},t.constructMsgKeySegments=d,t.constructMuteChatKey=function(e){return JSON.stringify([a.Actions.Mute,e.id.remote.toString({legacy:!0})])},t.constructPinChatKey=function(e){return JSON.stringify([a.Actions.Pin,e.id.remote.toString({legacy:!0})])},t.constructStarMsgKey=function(e){return JSON.stringify([a.Actions.Star,...d(e)])},t.constructStarMsgKeyFromMsgKey=function(e){return JSON.stringify([a.Actions.Star,...u(e)])},t.extractParticipantForSync=p,t.getMsgKeyFromStarActionIndex=function(e){const t=JSON.parse(e);if(t.length<5)throw new Error("[sync-action] Star action index malformed, cannot create MsgKey");return new l.default({remote:(0,c.createWid)(t[1]),id:t[2],fromMe:"1"===t[3],participant:"0"===t[4]?void 0:(0,c.createWid)(t[4])})},t.isBootstrap=function(e){return null==e},t.isCriticalCollection=function(e){switch(e){case a.CollectionName.CriticalBlock:case a.CollectionName.CriticalUnblockLow:return!0;case a.CollectionName.Regular:case a.CollectionName.RegularHigh:case a.CollectionName.RegularLow:return!1}},t.logKeysInfoInIntern=function(){return h.apply(this,arguments)},t.uploadCriticalEventMetric=function(e){new s.default.MdCriticalEvent({mdCriticalEventCode:e}).commit()};var i=n(r(48926)),a=r(45606),s=n(r(11339)),o=r(76214),l=n(r(32219)),c=(r(86458),r(58021));function d(e){return u(e.id)}function u(e){const t=p(e);return[e.remote.toString({legacy:!0}),e.id,e.fromMe?"1":"0",t]}function p(e){let t="0";return!e.participant||e.remote.isUser()||e.fromMe||(t=e.participant.toString({legacy:!0})),t}function h(){return(h=(0,i.default)((function*(){(yield(0,o.getSyncKeysTable)().all()).forEach((()=>{}))}))).apply(this,arguments)}},35047:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToBucket=function(e){if(e<0)throw new Error("cannot convert negative number to a bucket");return 0===e?s.default.MUTATION_COUNT_BUCKET.ZERO:1===e?s.default.MUTATION_COUNT_BUCKET.ONE:e<10?s.default.MUTATION_COUNT_BUCKET.LT10:e<100?s.default.MUTATION_COUNT_BUCKET.LT100:e<500?s.default.MUTATION_COUNT_BUCKET.LT500:e<1e3?s.default.MUTATION_COUNT_BUCKET.LT1K:e<5e3?s.default.MUTATION_COUNT_BUCKET.LT5K:s.default.MUTATION_COUNT_BUCKET.GTE5K},t.generateActionStatCounts=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45606),s=n(r(11339)),o=r(34296);function l(){return(l=(0,i.default)((function*(){const e=new Map;return(yield(0,o.getTable)().all()).map((t=>{var r;const n=JSON.parse(t.index)[0],i=null!==(r=e.get(n))&&void 0!==r?r:{action:n,applied:0,invalid:0,orphan:0,unsupported:0,failed:0};switch(t.actionState){case a.SyncActionState.Success:case a.SyncActionState.Skipped:i.applied++;break;case a.SyncActionState.Malformed:i.invalid++;break;case a.SyncActionState.Orphan:i.orphan++;break;case a.SyncActionState.Unsupported:i.unsupported++;break;case a.SyncActionState.Failed:i.failed++}e.set(n,i)})),e}))).apply(this,arguments)}},78375:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(57319),a=r(88102),s=n(r(11339));let o=new s.default.MdAppStateSyncDaily;const l=new i.ShiftTimer((function(){const e=function(e){const t=new s.default.MdAppStateSyncDaily;e.mutationCount>0&&(t.mutationCount=e.mutationCount);e.invalidActionCount>0&&(t.invalidActionCount=e.invalidActionCount);e.unsupportedActionCount>0&&(t.unsupportedActionCount=e.unsupportedActionCount);e.keyRotationRemoveCount>0&&(t.keyRotationRemoveCount=e.keyRotationRemoveCount);e.storedMutationCount>0&&(t.storedMutationCount=e.storedMutationCount);e.uploadConflictCount>0&&(t.uploadConflictCount=e.uploadConflictCount);e.unsetActionCount>0&&(t.unsetActionCount=e.unsetActionCount);e.missingKeyCount>0&&(t.missingKeyCount=e.missingKeyCount);return t}(o);c(),e.commit()}));function c(){o=new s.default.MdAppStateSyncDaily}function d(){l.onOrBefore(3e5)}a.Cmd.on("logout",(()=>{l.isScheduled()&&l.forceRunNow()}));var u={clear:c,addMutationCount:function(e){0!==e&&(void 0===o.mutationCount&&(o.mutationCount=0),o.mutationCount+=e,d())},setInvalidActionCount:function(e){o.invalidActionCount=e,d()},setUnsupportedActionCount:function(e){o.unsupportedActionCount=e,d()},incConflict:function(){void 0===o.uploadConflictCount&&(o.uploadConflictCount=0),o.uploadConflictCount++,d()},addKeyRotationRemoveCount:function(e){0!==e&&(void 0===o.keyRotationRemoveCount&&(o.keyRotationRemoveCount=0),o.keyRotationRemoveCount+=e,d())},setStoredMutationCount:function(e){o.storedMutationCount=e,d()},addUnsetActionCount:function(e){0!==e&&(void 0===o.unsetActionCount&&(o.unsetActionCount=0),o.unsetActionCount+=e,d())},setMissingKeyCount:function(e){o.missingKeyCount=e,d()}};t.default=u},49332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyStats=function(){return E.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=n(r(69618)),o=r(66423),l=n(r(96222)),c=r(99234),d=r(242),u=r(57701),p=r(55975),h=r(14111),f=r(10435),_=n(r(11339)),m=r(76214),g=r(72472),y=r(75861);function E(){return(E=(0,a.default)((function*(){const e=S(),t=yield v(),r=yield b(),n=M(),a=(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e),t),r),n),s=new _.default.Daily;s.set(a),s.commit();const l=o.DailyAggregatedStatsCollection.toArray().filter((e=>e.shouldBeSubmitted()));o.DailyAggregatedStatsCollection.remove(l),l.forEach((e=>{new _.default.PttDaily({eventTime:e.getEndTime(),pttCancelBroadcast:e.pttCancelBroadcast,pttCancelGroup:e.pttCancelGroup,pttCancelIndividual:e.pttCancelIndividual,pttDraftReviewBroadcast:e.pttDraftReviewBroadcast,pttDraftReviewGroup:e.pttDraftReviewGroup,pttDraftReviewIndividual:e.pttDraftReviewIndividual,pttFastplaybackBroadcast:e.pttFastplaybackBroadcast,pttFastplaybackGroup:e.pttFastplaybackGroup,pttFastplaybackIndividual:e.pttFastplaybackIndividual,pttLockBroadcast:e.pttLockBroadcast,pttLockGroup:e.pttLockGroup,pttLockIndividual:e.pttLockIndividual,pttOutOfChatBroadcast:e.pttOutOfChatBroadcast,pttOutOfChatGroup:e.pttOutOfChatGroup,pttOutOfChatIndividual:e.pttOutOfChatIndividual,pttPlaybackBroadcast:e.pttPlaybackBroadcast,pttPlaybackGroup:e.pttPlaybackGroup,pttPlaybackIndividual:e.pttPlaybackIndividual,pttRecordBroadcast:e.pttRecordBroadcast,pttRecordGroup:e.pttRecordGroup,pttRecordIndividual:e.pttRecordIndividual,pttSendBroadcast:e.pttSendBroadcast,pttSendGroup:e.pttSendGroup,pttSendIndividual:e.pttSendIndividual,pttPausedRecordBroadcast:e.pttPausedRecordBroadcast,pttPausedRecordGroup:e.pttPausedRecordGroup,pttPausedRecordIndividual:e.pttPausedRecordIndividual,pttStopTapBroadcast:e.pttStopTapBroadcast,pttStopTapGroup:e.pttStopTapGroup,pttStopTapIndividual:e.pttStopTapIndividual}).commit()}))}))).apply(this,arguments)}function S(){const e=h.deviceInfo.get();return{languageCode:e.lg,locationCode:e.lc,osBuildNumber:e.osBuild,simMcc:parseInt(e.mcc,10),simMnc:parseInt(e.mnc,10)}}function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(){const e=(0,c.getUserPrivacySettings)(),t={receiptsEnabled:"none"!==e.readReceipts};if((0,u.privacySettingsEnabled)()){var r,n,i,a;const s=yield(0,y.queryDisallowedLists)();t.privacySettingsAbout=A(e.about),t.privacySettingsAboutExceptNum="contact_blacklist"===e.about?C(null===(r=s.status)||void 0===r?void 0:r.disallowedList.length):null,t.privacySettingsGroups=A(e.groupAdd),t.privacySettingsGroupsExceptNum="contact_blacklist"===e.groupAdd?C(null===(n=s.groupadd)||void 0===n?void 0:n.disallowedList.length):null,t.privacySettingsLastSeen=A(e.lastSeen),t.privacySettingsLastSeenExceptNum="contact_blacklist"===e.lastSeen?C(null===(i=s.last)||void 0===i?void 0:i.disallowedList.length):null,t.privacySettingsProfilePhoto=A(e.profilePicture),t.privacySettingsProfilePhotoExceptNum="contact_blacklist"===e.profilePicture?C(null===(a=s.profile)||void 0===a?void 0:a.disallowedList.length):null}if((0,f.isDisappearingModeEnabled)()){var s;const e=(0,c.getMaybeMeUser)(),r=(0,d.getDisappearingModeSettingForUser)(e);t.defaultDisappearingDuration=null!==(s=null==r?void 0:r.duration)&&void 0!==s?s:0}return t}))).apply(this,arguments)}function A(e){if(null==e)return null;switch(e){case"all":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.EVERYONE;case"contacts":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS;case"contact_blacklist":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS_EXCEPT;case"none":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.NOBODY}}function C(e){return null==e?null:0===e?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B0:e<5?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B1:e<10?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B5:e<15?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B10:e<20?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B15:e<30?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B20:e<40?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B30:e<50?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B40:e<60?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B50:e<70?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B60:e<80?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B70:e<90?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B80:e<100?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B90:_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B100}function b(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(){const e=yield(0,m.getContactTable)().equals(["isAddressBookContact"],1).then((e=>e.length)),t=yield(0,l.default)(),r=yield p.LruMediaStore.count(),n=yield Promise.all([t,e,r]);let i=0,a=0;const s=n[0];return null!=s&&(i=s.available,a=s.quota),{addressbookWhatsappSize:O(n[1],10),storageAvailSize:O(i,100),storageTotalSize:O(a,100),mediaFolderFileCount:n[2]}}))).apply(this,arguments)}function M(){let e=_.default.NOTIFICATION_SETTING_TYPE.UNKNOWN;return null!=window.Notification&&(e=window.Notification.permission===s.default.PERMISSION_ALLOWED&&g.MuteCollection.getGlobalNotifications()?_.default.NOTIFICATION_SETTING_TYPE.ALLOWED:_.default.NOTIFICATION_SETTING_TYPE.BLOCKED),{osNotificationSetting:e}}function O(e,t){return Math.round(e/t)*t}},42862:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.registerTasks=function(){h.GK.supportsFeature(h.GK.F.MD_BACKEND)&&((0,a.startScheduler)({scheduledTimeResolver:{get:e=>(0,E.getTaskScheduledTime)(String(e)),set:(e,t)=>(0,E.updateTaskScheduledTime)(String(e),t)}}),v.filter((e=>e!==S.LOG_DB_ROW_COUNTS||!1)).forEach((e=>{const t=function(e){switch(e){case S.MONITOR_DB_STORAGE:return function(){var e=(0,i.default)((function*(){return a.DO_NOT_RESCHEDULE}));return function(){return e.apply(this,arguments)}}();case S.CLEAN_TC_TOKENS:return function(){var e=(0,i.default)((function*(e){if(e)__LOG__(2)`CleanTcToken skip first run`;else try{yield(0,d.pruneExpiredTcTokens)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired TcTokens with error: ${e}`}return s.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case S.LOG_DAILY_STATS:return()=>(0,p.logDailyStats)().catch((e=>{__LOG__(4,!0,new Error)`Failed to log daily stats: ${e}`})).then((()=>s.DAY_SECONDS));case S.LOG_DB_ROW_COUNTS:break;case S.ROTATE_KEY:return function(){var e=(0,i.default)((function*(e){return e?__LOG__(2)`RotateKeyTask skip first run`:yield(0,f.getJobManager)().waitUntilCompleted(m.jobSerializers.rotateKey()),27*s.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case S.SYNC_AB_PROPS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,c.syncABPropsTask)()),(0,l.getRefresh)()}));return function(){return e.apply(this,arguments)}}();case S.SYNC_CONTACTS:return function(){var e=(0,i.default)((function*(e){if(!e){try{yield(0,_.getNonAddressBookContactsAndMarkAllContactsDirty)()}catch(e){__LOG__(4,!0,new Error)`Failed to sync non-address book contacts with error: ${e}`}try{yield(0,u.contactSync)()}catch(e){__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}}return(0,y.getContactSyncRefreshSeconds)()}));return function(){return e.apply(this,arguments)}}();case S.REPORT_SYNCD_ACTION_STAT:return function(){var e=(0,i.default)((function*(e){return a.DO_NOT_RESCHEDULE}));return function(){return e.apply(this,arguments)}}();case S.LT_HASH_CHECK:return function(){var e=(0,i.default)((function*(e){(0,o.getABPropConfigValue)("lthash_check_hours");return a.DO_NOT_RESCHEDULE}));return function(){return e.apply(this,arguments)}}();case S.REQUEST_ALL_SYNCD_MISSING_KEYS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,g.requestAllSyncdMissingKeysJob)()),6*s.HOUR_SECONDS}));return function(){return e.apply(this,arguments)}}()}}(e);null!=t&&(0,a.registerTask)(e,t)})))};var i=n(r(48926)),a=r(2821),s=r(92844),o=r(86945),l=r(64971),c=r(89981),d=(r(1377),r(48285)),u=r(9995),p=r(49332),h=r(7293),f=r(68819),_=r(24872),m=r(6684),g=(r(66101),r(4454)),y=r(66837),E=r(60998);const S=r(54302)({CLEAN_TC_TOKENS:"cleanTcTokens",LOG_DAILY_STATS:"logDailyStats",LOG_DB_ROW_COUNTS:"logDbRowCounts",ROTATE_KEY:"rotateKey",SYNC_AB_PROPS:"syncAbProps",SYNC_CONTACTS:"syncContacts",MONITOR_DB_STORAGE:"monitorDbStorage",REPORT_SYNCD_ACTION_STAT:"reportSyncdActionStat",LT_HASH_CHECK:"ltHashCheck",REQUEST_ALL_SYNCD_MISSING_KEYS:"requestAllSyncdMissingKeys"}),v=[S.CLEAN_TC_TOKENS,S.LOG_DAILY_STATS,S.LOG_DB_ROW_COUNTS,S.ROTATE_KEY,S.SYNC_AB_PROPS,S.SYNC_CONTACTS,S.MONITOR_DB_STORAGE,S.REPORT_SYNCD_ACTION_STAT,S.LT_HASH_CHECK,S.REQUEST_ALL_SYNCD_MISSING_KEYS]},47473:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByCountry=function(e){var t;return!!(0,i.countryGatingEnabled)()&&((null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===a.HostStorageEnumType.Facebook&&!(0,n.getFbBrandedNumber)(e.id.user))};var n=r(32990),i=r(57701),a=r(49714)},70768:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TosManager=t.TOS_3_ID=void 0;var a=i(r(48926)),s=r(13959),o=i(r(70714)),l=i(r(69618)),c=i(r(34342)),d=r(91903),u=r(99234),p=r(57701),h=n(r(53055)),f=r(99684),_=r(77591);const m="20210210";t.TOS_3_ID=m;const g={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:(new o.default).signal};class y extends c.default{constructor(){super(...arguments),this._noticeIds=[m],this._refreshInterval=864e5}getState(e){const t=this._getStoreKey(e);return h._getUser(t)||"UNKNOWN"}setState(e,t){if((0,p.tosFetchEnabled)()){new Set(this._noticeIds).has(e)?(h._setUser(this._getStoreKey(e),t),this.trigger("change")):__LOG__(3)`ToS state manager unrecognized user notice id: ${e}`}}run(){var e=this;return(0,a.default)((function*(){if((0,p.tosFetchEnabled)()){try{yield(0,d.exponentialBackoff)(g,((t,r)=>e._query().catch((e=>{if(e instanceof _.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`ToS state manager query failed, retriable error: ${e.errorMessage}, failCount ${r}`,t(e)}throw e}))))}catch(e){if(__LOG__(4,!0,new Error,!0)`ToS state manager state pull failed, error: ${e}`,SEND_LOGS("ToS state manager run failed"),!(e instanceof _.ServerStatusCodeError&&500===e.statusCode))return}if(e._getNoticeIdsToRun().length>0){const t=(0,u.getMaybeMeUser)();yield(0,s.delayMs)(e._refreshInterval),(0,u.getMaybeMeUser)()===t&&e.run()}}}))()}_query(){var e=this;return(0,a.default)((function*(){if(!(0,u.getMaybeMeUser)())return;const t=e._getNoticeIdsToRun();if(t.length>0){const r=yield(0,f.queryTosState)(t);e._refreshInterval=1e3*r.refresh;const n=new Set(e._noticeIds);let i=!1;r.notice.filter((e=>n.has(e.id))).forEach((t=>{const r=t.state?"ACCEPTED":"NOT_ACCEPTED",n=e._getStoreKey(t.id);h._getUser(n)!==r&&(h._setUser(n,r),i=!0)})),h._setUser(l.default.KEY_TOS_STATE_FETCH_ITERATION,(0,p.tosFetchIteration)()),i&&e.trigger("change")}}))()}_getNoticeIdsToRun(){const e=parseInt(h._getUser(l.default.KEY_TOS_STATE_FETCH_ITERATION),10)||0;if((0,p.tosFetchIteration)()>e)return this._noticeIds;const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((e,r)=>"ACCEPTED"!==t[r]))}_getStoreKey(e){switch(e){case m:return l.default.KEY_TOS_3}throw new Error("Unknown user notice id: "+e)}maybeUpdateServer(e){var t=this;return(0,a.default)((function*(){if((0,p.tosFetchEnabled)())try{const r=new Set(e);yield(0,d.exponentialBackoff)(g,((e,n)=>{const i=t._getAcceptedNoticeIds(r);return i.length>0?(0,f.updateTosState)(i).catch((t=>{if(t instanceof _.ServerStatusCodeError&&500===t.statusCode)return __LOG__(3)`ToS state manager server session state update failed, retriable error: ${t.errorMessage}, failCount ${n}`,e(t);throw t})):Promise.resolve()}))}catch(e){__LOG__(4,!0,new Error,!0)`ToS state manager server session state update failed, error: ${e}`,SEND_LOGS("ToS state manager server session state update failed")}}))()}_getAcceptedNoticeIds(e){if((0,u.getMaybeMeUser)()){const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((r,n)=>"ACCEPTED"===t[n]&&e.has(r)))}return[]}resetTosState(){}}const E=new y;t.TosManager=E},37894:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByTos=c,t.shouldBlockByTosB2C=function(e,t){return!(!c(e)||!t)&&(t.type!==i.default.MSG_TYPE.DEBUG&&t.type!==i.default.MSG_TYPE.E2E_NOTIFICATION&&t.type!==i.default.MSG_TYPE.NOTIFICATION_TEMPLATE&&!t.isSentByMe)};var i=n(r(69618)),a=r(32990),s=r(57701),o=r(49714),l=r(70768);function c(e){var t;if((0,s.tos3GatingEnabled)()&&("NOT_ACCEPTED"===l.TosManager.getState(l.TOS_3_ID)&&(null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===o.HostStorageEnumType.Facebook&&!(0,a.getFbBrandedNumber)(e.id.user)))return!0;return!1}},66577:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncBusinessProtocol=void 0,t.businessParser=function(e){e.assertTag("business");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.maybeChild("verified_name");return{verifiedName:r?(0,a.default)(r):null}};var i=r(31914),a=n(r(27874));t.USyncBusinessProtocol=class{getQueryElement(){return(0,i.wap)("business",null,(0,i.wap)("verified_name",null))}getUserElement(){return null}}},93967:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncContactProtocol=void 0,t.contactParser=function(e){e.assertTag("contact");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{type:e.attrString("type")}};var n=r(31914);t.USyncContactProtocol=class{getQueryElement(){return(0,n.wap)("contact",null)}getUserElement(e){const t=e.getPhone();return t?(0,n.wap)("contact",null,t):null}}},81051:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDeviceProtocol=void 0,t.deviceParser=function(e){e.assertTag("devices");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.maybeChild("key-index-list"),n=e.maybeChild("device-list"),i=null==r?null:{ts:r.attrTime("ts"),signedKeyIndexBytes:r.hasContent()?r.contentBytes():null,expectedTs:r.hasAttr("expected_ts")?r.attrTime("expected_ts"):void 0};return{deviceList:null==n?void 0:n.mapChildrenWithTag("device",(e=>({id:e.attrInt("id"),keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null}))),keyIndex:i}};var n=r(31914),i=r(86945);t.USyncDeviceProtocol=class{getQueryElement(){return(0,n.wap)("devices",{version:(0,n.CUSTOM_STRING)(String(2))})}getUserElement(e){const t=e.getDeviceHash(),r=e.getTs(),a=e.getExpectedTs();return t||null!=r||null!=a?(0,n.wap)("devices",{device_hash:t?(0,n.CUSTOM_STRING)(t):n.DROP_ATTR,ts:null!=r?(0,n.INT)(r):n.DROP_ATTR,expected_ts:(0,i.getABPropConfigValue)("adv_v2_m4_m5")&&null!=a?(0,n.INT)(a):n.DROP_ATTR}):null}}},3776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDisappearingModeProtocol=void 0,t.disappearingModeParser=function(e){e.assertTag("disappearing_mode");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.attrInt("duration",0),n=e.attrInt("t");return{duration:r,t:n}};var n=r(31914);t.USyncDisappearingModeProtocol=class{getQueryElement(){return(0,n.wap)("disappearing_mode",null)}getUserElement(){return null}}},35564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncFeaturesProtocol=void 0,t.featureParser=function(e){e.assertTag("feature");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r={};return Object.keys(i).forEach((t=>{const n=e.maybeChild(t);n&&(r[t]=n.attrString("value"))})),r};var n=r(31914);const i={document:(0,n.wap)("document",null),encrypt:(0,n.wap)("encrypt",null),encrypt_blist:(0,n.wap)("encrypt_blist",null),encrypt_contact:(0,n.wap)("encrypt_contact",null),encrypt_group_gen2:(0,n.wap)("encrypt_group_gen2",null),encrypt_image:(0,n.wap)("encrypt_image",null),encrypt_location:(0,n.wap)("encrypt_location",null),encrypt_url:(0,n.wap)("encrypt_url",null),encrypt_v2:(0,n.wap)("encrypt_v2",null),voip:(0,n.wap)("voip",null),multi_agent:(0,n.wap)("multi_agent",null)};t.USyncFeaturesProtocol=class{constructor(e){if(this.queries=e,0===e.length)throw new Error("must specify at least one query")}getQueryElement(){return(0,n.wap)("feature",null,this.queries&&this.queries.map((e=>i[e])))}getUserElement(){return null}}},52284:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncQuery=t.USYNC_SUPPORT_TYPE=void 0;var i=n(r(48926)),a=r(31914),s=r(71914),o=r(66577),l=r(24747),c=r(93967),d=r(81051),u=r(3776),p=r(35564),h=r(85553),f=r(60226),_=r(85880),m=r(39410),g=n(r(39546));const y={FEATURE:"feature",DEVICE:"devices",CONTACT:"contact",PICTURE:"picture",STATUS:"status",BUSINESS:"business",DISAPPEARING_MODE:"disappearing_mode"};t.USYNC_SUPPORT_TYPE=y;const E={feature:p.featureParser,devices:d.deviceParser,contact:c.contactParser,picture:f.pictureParser,status:_.statusParser,business:o.businessParser,disappearing_mode:u.disappearingModeParser};function S(e){const t=[];return e.forEachChildWithTag("user",(e=>{const r={};e.hasAttr("jid")&&(Object.keys(y).forEach((t=>{const n=y[t],i=e.maybeChild(n);i&&E[n]&&(r[n]=E[n](i))})),r.id=(0,h.deviceJidToUserWid)(e.attrDeviceJid("jid")),t.push(r))})),t}const v=new s.WapParser("usyncParser",(e=>{e.assertAttr("type","result");const t={error:{},refresh:{},list:[],sideList:[]},r=e.child("usync"),n=r.child("result"),i=r.child("list"),a=r.maybeChild("side_list");return Object.keys(y).forEach((e=>{const r=y[e],i=n.maybeChild(r);if(i){const e=i.maybeChild("error");e?t.error[r]={errorCode:e.attrInt("code"),errorText:e.attrString("text"),errorBackoff:e.attrInt("backoff")}:i.hasAttr("refresh")&&(t.refresh[r]=i.attrInt("refresh",0))}})),t.list=S(i),a&&(t.sideList=S(a)),__LOG__(2)`usync query success!`,t}));t.USyncQuery=class{constructor(){this.context="interactive",this.mode="query",this.protocols=[],this.users=[]}withMode(e){return this.mode=e,this}withContext(e){return this.context=e,this}withContactProtocol(){return this.protocols.push(new c.USyncContactProtocol),this}withBusinessProtocol(){return this.protocols.push(new o.USyncBusinessProtocol),this}withDeviceProtocol(){return this.protocols.push(new d.USyncDeviceProtocol),this}withDisappearingModeProtocol(){return this.protocols.push(new u.USyncDisappearingModeProtocol),this}withPictureProtocol(){return this.protocols.push(new f.USyncPictureProtocol),this}withStatusProtocol(){return this.protocols.push(new _.USyncStatusProtocol),this}withFeaturesProtocol(e){return this.protocols.push(new p.USyncFeaturesProtocol(e)),this}withUser(e){return this.users.push(e),this}_buildStanza(){if(0===this.protocols.length)throw new Error("a usync query must have at least one protocol");0===this.users.length&&__LOG__(3)`Usync warning: a usync query must have at least one user`,this.users.map((e=>e.validate()));const e=(0,a.wap)("query",null,this.protocols.map((e=>e.getQueryElement()))),t=this.users.filter((e=>{const t=e.getId();return!t||!g.default.isServer(t)})).map((e=>{const t=e.getId();return(0,a.wap)("user",{jid:t?(0,m.USER_JID)(t):a.DROP_ATTR},this.protocols.map((t=>t.getUserElement(e))))})),r=(0,a.wap)("list",null,t);return(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"usync",type:"get",id:(0,a.generateId)()},(0,a.wap)("usync",{sid:(0,a.generateId)(),index:"0",last:"true",mode:(0,a.CUSTOM_STRING)(this.mode),context:(0,a.CUSTOM_STRING)(this.context)},e,r))}execute(){var e=this;return(0,i.default)((function*(){const t=e._buildStanza(),r=yield(0,l.sendIq)(t,v);return r.success?r.result:{error:{all:{errorCode:r.errorCode,errorText:r.errorText,errorType:r.errorType}},refresh:{},list:[]}}))()}}},60226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncPictureProtocol=void 0,t.pictureParser=function(e){e.assertTag("picture");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{id:e.attrInt("id")}};var n=r(31914);t.USyncPictureProtocol=class{getQueryElement(){return(0,n.wap)("picture",null)}getUserElement(){return null}}},85880:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncStatusProtocol=void 0,t.statusParser=function(e){e.assertTag("status");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};if(!e.hasContent())return e.hasAttr("code")&&401===e.attrInt("code")?null:a.default._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString();return 0!==e.contentString().length?e.contentString():a.default._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString()};var i=r(31914),a=n(r(48360));t.USyncStatusProtocol=class{getQueryElement(){return(0,i.wap)("status",null)}getUserElement(){return null}}},79942:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncUser=void 0;t.USyncUser=class{withId(e){return this._id=e,this}withDeviceHash(e){return this._deviceHash=e,this}withTs(e){return this._ts=e,this}withExpectedTs(e){return this._expectedTs=e,this}withPhone(e){return this._phone=e,this}getDeviceHash(){return this._deviceHash}getPhone(){return this._phone}getId(){return this._id}getTs(){return this._ts}getExpectedTs(){return this._expectedTs}validate(){if(null==this._id&&null==this._phone)throw new Error("user must have an id or a phone")}}},36129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(8584);class i{static tag(e){return null==e?void 0:e[0]}static attr(e,t){return(null==t?void 0:t[1])?t[1][e]:void 0}static attrs(e){return e[1]}static child(e,t){const r=t[2];if(Array.isArray(r)){const t=r.length;for(let n=0;n<t;n++){const t=r[n];if(Array.isArray(t)&&t[0]===e)return t}}}static firstChild(e){const t=e[2];if(Array.isArray(t))return t[0]}static children(e,t){if(!t)return null==e?void 0:e[2];{const r=e[2];if(Array.isArray(r))return r.filter((e=>e[0]===t))}}static dataStr(e){if(!e)return"";const t=e[2];return"string"==typeof t?t:t instanceof ArrayBuffer?new n.Binary(t).readString(t.byteLength):""}static toString(e,t){if(!e)return"undefined";const r=function(e,t){if(e){let r="";for(const n in e){r+=" "+n+"="+("string"==typeof e[n]?t?"...":'"'+e[n]+'"':e[n])}return r}return""}(e[1],t),n=function(e,t){if(e instanceof ArrayBuffer)return"<<bin:"+e.byteLength+">>";if("string"==typeof e)return t?"<<string:"+e.length+">>":e;if(Array.isArray(e))return e.map((e=>i.toString(e,t))).join("\n");return""}(e[2],t);return"<"+e[0]+r+(n?">\n"+n+"\n</"+e[0]+">":"/>")}}t.default=i},41090:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(21224),i={voipIndividualOutgoing:n.WebFeaturesFlag.FORCE_UPGRADE,groupsV3:n.WebFeaturesFlag.FORCE_UPGRADE,groupsV3Create:n.WebFeaturesFlag.DEVELOPMENT,changeNumberV2:n.WebFeaturesFlag.FORCE_UPGRADE,queryStatusV3Thumbnail:n.WebFeaturesFlag.DEVELOPMENT,liveLocations:n.WebFeaturesFlag.FORCE_UPGRADE,queryVname:n.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualIncoming:n.WebFeaturesFlag.FORCE_UPGRADE,quickRepliesQuery:n.WebFeaturesFlag.FORCE_UPGRADE,payments:n.WebFeaturesFlag.FORCE_UPGRADE,labelsDisplay:n.WebFeaturesFlag.FORCE_UPGRADE,labelsEdit:n.WebFeaturesFlag.FORCE_UPGRADE,stickerPackQuery:n.WebFeaturesFlag.FORCE_UPGRADE,liveLocationsFinal:n.WebFeaturesFlag.FORCE_UPGRADE,mediaUpload:n.WebFeaturesFlag.FORCE_UPGRADE,vnameV2:n.WebFeaturesFlag.FORCE_UPGRADE,videoPlaybackUrl:n.WebFeaturesFlag.FORCE_UPGRADE,statusRanking:n.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualVideo:n.WebFeaturesFlag.DEVELOPMENT,thirdPartyStickers:n.WebFeaturesFlag.FORCE_UPGRADE,frequentlyForwardedSetting:n.WebFeaturesFlag.FORCE_UPGRADE,recentStickers:n.WebFeaturesFlag.FORCE_UPGRADE,recentStickersV2:n.WebFeaturesFlag.PRODUCTION,recentStickersV3:n.WebFeaturesFlag.PRODUCTION,groupsV4JoinPermission:n.WebFeaturesFlag.FORCE_UPGRADE,catalog:n.WebFeaturesFlag.FORCE_UPGRADE,starredStickers:n.WebFeaturesFlag.PRODUCTION,templateMessage:n.WebFeaturesFlag.PRODUCTION,templateMessageInteractivity:n.WebFeaturesFlag.DEVELOPMENT,ephemeralMessages:n.WebFeaturesFlag.PRODUCTION,e2ENotificationSync:n.WebFeaturesFlag.FORCE_UPGRADE,syncdRelease1:n.WebFeaturesFlag.PRODUCTION,userNotice:n.WebFeaturesFlag.PRODUCTION,syncdRelease11:n.WebFeaturesFlag.PRODUCTION,support:n.WebFeaturesFlag.PRODUCTION,groupUiiCleanup:n.WebFeaturesFlag.FORCE_UPGRADE,groupDogfoodingInternalOnly:n.WebFeaturesFlag.DEVELOPMENT,settingsSync:n.WebFeaturesFlag.PRODUCTION,ephemeral24HDuration:n.WebFeaturesFlag.DEVELOPMENT,archiveV2:n.WebFeaturesFlag.PRODUCTION,mdForceUpgrade:n.WebFeaturesFlag.FORCE_UPGRADE,disappearingMode:n.WebFeaturesFlag.PRODUCTION,externalMdOptInAvailable:n.WebFeaturesFlag.PRODUCTION,noDeleteMessageTimeLimit:n.WebFeaturesFlag.DEVELOPMENT};t.default=i},80208:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.settingsSync=t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=t.DISAPPEARING_MODE_SETTINGS_KEY=t.ARCHIVE_SETTINGS_KEY=void 0;var i=n(r(41609));const a="archive";t.ARCHIVE_SETTINGS_KEY=a;const s="disappearing_mode";t.DISAPPEARING_MODE_SETTINGS_KEY=s;const o="md_opt_in_deadline";t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=o;const l={querySettings:function(e){return new Promise(((t,r)=>{const n=this.queryNode({type:"settings"},void 0),a=e?"query,settings,resume":"query,settings";this.binSend("sendEphemeral",n,r,{onSend:this.binWrap((e=>{this.BinaryProtocol.read(e).then((e=>{const r={settings:[],status:parseInt(this.N.attr("code",e),10)||200};if(__LOG__(2)`bin-recv: response,settings`,"response"===this.N.tag(e)&&"settings"===this.N.attr("type",e)){const t=this.N.children(e);if(Array.isArray(t))for(let e=0;e<t.length;e++){const n=this.parseSetting(t[e]);(0,i.default)(n)||r.settings.push(n)}}t(r)})).catch(r)}),t),onDrop:this.wrap(r),serverCacheable:Boolean(e)},{debugString:a,metricName:"QUERY_SETTINGS"})}))},setArchiveSetting:function(e){return new Promise(((t,r)=>{const n=this.actionNode("set",[["archive_v2",{classic:e.toString()},void 0]]);this.binSend("send",n,r,{clientCacheable:!0,onSend:this.wrap(t),onDrop:this.wrap(r)},{debugString:"action,settings,archive",metrics:"SET_ARCHIVE_SETTING",ackRequest:!0})}))},parseSetting:function(e){switch(this.N.tag(e)){case"archive_v2":return{type:a,value:{classic:"true"===this.N.attr("classic",e),enabled:this.N.attr("enabled",e)&&"true"===this.N.attr("enabled",e)}};case"disappearing_mode":return{type:s,value:{duration:parseInt(this.N.attr("duration",e),10),settingTimestamp:parseInt(this.N.attr("t",e),10)}};case"md_opt_in_deadline":return{type:o,value:{timestamp:parseInt(this.N.attr("t",e),10)}};default:return}}};t.settingsSync=l},56891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.instance}});var i=r(86875);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},78144:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.default.isWid,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.createWid,s=t;switch(e){case"author":case"broadcast":case"chat":case"descOwner":case"from":case"gid":case"id":case"jid":case"owner":case"participant":case"quotedRemoteJid":case"quotedParticipant":case"remote":case"subjectOwner":case"s_o":case"to":case"wid":case"changeNumberNewJid":case"changeNumberOldJid":case"recipient":case"paymentMessageReceiverJid":case"revokeSender":r(t)&&(s=n(t));break;default:const i=parseInt(e,10);!isNaN(i)&&r(t)&&(s=n(t))}return s};var i=n(r(39546)),a=r(58021)},77113:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.loadProtoVersions=function(){return o.apply(this,arguments)},t.protoMap=void 0;var i=n(r(48926)),a=r(46582);const s={};function o(){return(o=(0,i.default)((function*(){const e=yield(0,a.requireLoadProtoVersions)();Object.assign(s,e)}))).apply(this,arguments)}t.protoMap=s},7353:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11865)),a=r(8584);const s={NEW:"REQUEST_STATE_NEW",SENT:"REQUEST_STATE_SENT",WEBDACKED:"REQUEST_STATE_WEBDACKED",WILL_RETRY:"REQUEST_STATE_WILL_RETRY"};class o{constructor(e){this.state=s.NEW,this.age=0,this.resends=0;const t=e.data;this.data=t,this.isToPhone=t instanceof ArrayBuffer,this.tag=e.tag,this.clientCacheable=!!e.clientCacheable,this.serverCacheable=!!e.serverCacheable,this.retryOn5xx=!!e.retryOn5xx,this.onSend=e.onSend,this.logOnSend=e.logOnSend,this.onDrop=e.onDrop,this.binaryOpts=e.binaryOpts,this.on5xx=e.on5xx,this.resendGuard=e.resendGuard,this.onTag=e.onTag,this.tagToCancel=e.tagToCancel,this.ephemeral=!!e.ephemeral,this.ignore=!!e.ignore,this.isCallOffer=!!e.isCallOffer,this.isWap4Bridge=!!e.isWap4Bridge}getTag(){return this.tag||(this.onSend?this.onSend.tag:void 0)}getName(){var e;return(null===(e=this.binaryOpts)||void 0===e?void 0:e.metricName)?this.binaryOpts.metricName.toLowerCase():`${this.data[0]}_${(0,i.default)(this.data[1])}`}toString(){const e=this.data;return this.binaryOpts?this.binaryOpts.debugString:Array.isArray(e)?0===e.length?"[]":1===e.length?`[${e[0]}]`:"query"===e[0]||"action"===e[0]?`[${e[0]}, ${e[1]}${e.length>2?", ...":""}]`:`Invalid request: ${e[0]}`:e instanceof Object?"{...}":`${String(e)}`}serialize(){const e=this.tag;if(this.binaryOpts){const t=this.binaryOpts,r=null!=t.metric?t.metric:0,n=(this.ignore?0:1)<<7|(!this.ignore&&t.ackRequest?1:0)<<6|(!0===t.available?1:0)<<5|(!1===t.available?1:0)<<4|(null!=t.expires&&0!==t.expires?1:0)<<3|(t.skipOffline?1:0)<<2;return a.Binary.build(e,",",r,n,this.data).readBuffer()}{const t="string"==typeof this.data?this.data:JSON.stringify(this.data);return`${String(e)},,${String(t)}`}}}t.default=o,o.STATE=s},66934:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VoipSignaling=void 0,t.base64DecodeRecursively=function e(t){const r=t[2];Array.isArray(r)&&r.forEach((t=>{t&&(t[2]instanceof ArrayBuffer||"string"==typeof t[2]?t[2]=(0,a.decodeB64ToJsArray)(t[2]):t[2]&&e(t))}))};var i=n(r(78718)),a=r(15688),s=r(84902),o=r(60980),l=r(19380),c=r(24808),d=r(99234),u=n(r(36129)),p=r(45473),h=r(43067);const f={formatCallOffer:function(e,t,r){const n=r.payload,i={to:r.common.peer_jid,id:t,from:(0,d.getMaybeMeUser)().toString({legacy:!0})};let a,s;const l=n[2];l.forEach(((e,t)=>{switch(e[0]){case"enc":const i={call:{callKey:new Uint8Array(e[2])}},l={},d=n[1].retry_count;d&&(l.count=d);const u=["call",l,(0,h.cdataArrayBuffer)((0,o.encodeProtobuf)(c.MessageSpec,i))];a=u,s=t;break;default:(0,h.arrayToB64Recursively)(r.payload,!0)}})),l.splice(s,1),l.push(a),n[2]=l;return e.actionNode("relay",[["call",i,[n]]])},parseCallSignalingMsg:function(e){try{const t=l.ContactCollection.get(e.from),r={peer_jid:e.from.toString({legacy:!0}),isContact:null==t?void 0:t.isMyContact},n=["wrapper",{},e.data];switch(e.type){case"offer":{const t=_("offer",n);r.peer_platform=e.platform,e.version&&e.version.length&&(r.peer_version=e.version.join(".")),this.parseCallOffer(t,r,!1);break}case"accept":{const t=_("accept",n);r.type=p.TYPE.ACCEPT,r.call_id=u.default.attr("call-id",t)||"",r.peer_platform=e.platform,e.version&&e.version.length&&(r.peer_version=e.version.join("."));break}case"receipt":const t=e.data;switch(r.call_id=u.default.attr("call-id",t)||"",u.default.tag(t)){case"offer":r.type=p.TYPE.OFFER_RECEIPT;break;case"accept":r.type=p.TYPE.ACCEPT_RECEIPT;break;case"reject":default:return}break;case"terminate":const i=_("terminate",n);r.call_id=u.default.attr("call-id",i)||"",r.type=p.TYPE.TERMINATE;break;default:const a=function(e){const t=u.default.firstChild(e);if(!t)throw new Error("voip_signaling:Failed to get first child node");return t}(n);r.call_id=u.default.attr("call-id",a)}return(null==r?void 0:r.call_id)&&this.createCommonHeader(r),r}catch(e){return void __LOG__(3)`Error parsing voip signaling message`}},parseCallOffer:function(e,t,r){if(t.type=p.TYPE.OFFER,t.call_id=u.default.attr("call-id",e)||"",r){const r=_("call",e),i=u.default.children(r);if(i instanceof ArrayBuffer){var n;const e=(0,s.decodeProtobuf)(c.MessageSpec,i);(null===(n=e.call)||void 0===n?void 0:n.callKey)?this.receiveCallOfferKey(e.call.callKey,t):__LOG__(3)`voip_signaling:invalid messageProto.call`}else __LOG__(3)`voip_signaling:invalid serializedMessage`}else t.enc=this.parseRawE2EMaterial(e);const i=u.default.children(e,"video");t.video_count=Array.isArray(i)?i.length:void 0,t.isVideoCall=!!t.video_count,t.isGroupCall_DEPRECATED=!!t.group_info;const a=u.default.attr("t",e);a&&(t.t=a)},parseRawE2EMaterial:function(e){const t=u.default.child("enc",e);if(t)return(0,a.decodeB64ToJsArray)(u.default.dataStr(t));__LOG__(3)`voip_signaling:enc node not present`},receiveCallOfferKey:function(e,t){t&&(t[2]=Array.prototype.slice.call(new Uint8Array(e)))},createCommonHeader(e){e.common=(0,i.default)(e,["type","call_id","peer_jid"])}};function _(e,t){const r=u.default.child(e,t);if(!r)throw new Error(`voip_signaling:Failed to get child node ${e}`);return r}t.VoipSignaling=f},43067:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayToB64Recursively=s,t.cdataArrayBuffer=o,t.cdataB64=l,t.formatCallSignalingMsg=function(e,t){var r;const n=t.common.peer_jid;s(t.payload,!1);const i=t.payload;return["call",{from:null===(r=(0,a.getMaybeMeUser)())||void 0===r?void 0:r.toString({legacy:!0}),to:n,id:e},[i]]};var n=r(15688),i=r(8584),a=r(99234);function s(e,t){const r=e[2];Array.isArray(r)&&r.forEach((e=>{e&&(e[2]instanceof Array&&!(e[2][0]instanceof Array)?e[2]=t?o(new Uint8Array(e[2])):l(new Uint8Array(e[2])):e[2]&&s(e,t))}))}function o(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:e instanceof i.Binary?e.readBuffer():void 0}function l(e){return e instanceof Uint8Array||e instanceof ArrayBuffer?(0,n.encodeB64)(e):e instanceof i.Binary?(0,n.encodeB64)(e.readBuffer()):void 0}},86875:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.instance=void 0;var a=i(r(81109)),s=i(r(48926)),o=r(15688),l=r(8584),c=i(r(45095)),d=r(20461),u=r(31914),p=r(84902),h=r(89626),f=r(95176),_=r(9978),m=n(r(5087)),g=r(24808),y=n(r(64103)),E=i(r(41090)),S=r(7293),v=n(r(12206)),T=i(r(39827)),A=r(90667),C=r(6822),b=r(77113),P=i(r(84644)),M=r(15860),O=n(r(17117)),I=r(31515),w=r(43067),R=r(21224),D=r(77591),N=i(r(39546)),L=r(58021),k=r(65044);let G,U;function F(e){return function(){if(!G)return Promise.reject(new y.ProtoVersionUndefined(`wap:${e}:not connected to phone yet`));const t=G[e];return t?t.apply(G,arguments):Promise.reject(new Error(`wap:${e}:unsupported`))}}const x=F("sendPresenceUpdate"),B=F("sendChatstateUpdate");const K=new class{constructor(){this.setSharedSecret=(0,d.promiseWrapSync)(function(){var e=(0,s.default)((function*(e){__LOG__(2)`Wap:saveSharedSecret start`;const t=(0,c.default)((0,o.decodeB64ToJsArray)(e),"decodeB64ToJsArray(payload)"),r=t.slice(0,32),n=t.slice(64),i=O.get().keyPair,a=(0,c.default)(i,"keyPair").privKey,s=yield m.sharedSecret(r,a).then((e=>v.extractAndExpand(e,"",80))),d=new Uint8Array(s,0,32),u=new Uint8Array(s,32,32),p=new Uint8Array(s,64,16),f=new Uint8Array(r.concat(n)),_=yield new T.default(u).sign(f),g=(0,o.encodeB64)(_),y=(0,o.encodeB64)(t.slice(32,64));if(y!==g)return void __LOG__(3)`Wap:saveSharedSecret hmac mismatch ${y} ${g}`;const E=l.Binary.build(p,new Uint8Array(n)).readByteArray(),S=yield(0,h.aesCbcDecrypt)(d,E),A=new Uint8Array(S,0,32),C=new Uint8Array(S,32,32);O.setSecretKeys("0.1",A,C),__LOG__(2)`Wap:saveSharedSecret done`}));return function(){return e.apply(this,arguments)}}()),this.findGroupPendingInvitesFromPhone=F("findGroupPendingInvitesFromPhone"),this.acceptGroupV4Invite=F("acceptGroupV4Invite"),this.revokeGroupV4Invite=F("revokeGroupV4Invite"),this.addContact=F("addContact"),this.groupMetadataFindFromPhone=F("groupMetadataFindFromPhone"),this.resyncMessages=F("resyncMessages"),this.resyncReceipts=F("resyncReceipts"),this.queryReceivedActions=F("queryReceivedActions"),this.addParticipants=F("addParticipants"),this.changeSubject=F("changeSubject"),this.createGroup=F("createGroup"),this.leaveGroup=F("leaveGroup"),this.removeParticipants=F("removeParticipants"),this.promoteParticipants=F("promoteParticipants"),this.demoteParticipants=F("demoteParticipants"),this.setGroupDescription=F("setGroupDescription"),this.setGroupProperty=F("setGroupProperty"),this.setGroupEphemeralDuration=F("setGroupEphemeralDuration"),this.requestMediaReupload=F("requestMediaReupload"),this.sendMedia=F("sendMedia"),this.mediaUpload=F("mediaUpload"),this.sendConversationSeen=F("sendConversationSeen"),this.sendConversationUnseen=F("sendConversationUnseen"),this.sendConversationClear=F("sendConversationClear"),this.sendConversationDelete=F("sendConversationDelete"),this.sendConversationArchive=F("sendConversationArchive"),this.sendConversationMute=F("sendConversationMute"),this.sendConversationNotSpam=F("sendConversationNotSpam"),this.sendConversationPin=F("sendConversationPin"),this.sendConversationDismissChangeNumber=F("sendConversationDismissChangeNumber"),this.sendMessagePlayed=F("sendMessagePlayed"),this.sendMessageDelete=F("sendMessageDelete"),this.sendMessageStarred=F("sendMessageStarred"),this.sendUnstarAll=F("sendUnstarAll"),this.sendSetPicture=F("sendSetPicture"),this.deletePicture=F("deletePicture"),this.sendSetStatus=F("sendSetStatus"),this.setPushname=F("setPushname"),this.statusQuery=F("statusQuery"),this.sendStatusSeen=F("sendStatusSeen"),this.statusQueryThumbnail=F("statusQueryThumbnail"),this.sendSetBlock=F("sendSetBlock"),this.sendSpamReport=F("sendSpamReport"),this.chatFindQuery=F("chatFindQuery"),this.contactFindQuery=F("contactFindQuery"),this.queryIdentity=F("queryIdentity"),this.queryVname=F("queryVname"),this.msgCreateRecord=F("msgCreateRecord"),this.msgFindQuery=F("msgFindQuery"),this.queryLinkPreview=F("queryLinkPreview"),this.queryVcard=F("queryVcard"),this.queryMsgInfo=F("queryMsgInfo"),this.recentEmojiQuery=F("recentEmojiQuery"),this.clearBPQueue=F("clearBPQueue"),this.parseWebMessageInfo=F("parseWebMessageInfo"),this.subscribeLiveLocation=F("subscribeLiveLocation"),this.unsubscribeLiveLocation=F("unsubscribeLiveLocation"),this.queryActiveLiveLocation=F("queryActiveLiveLocation"),this.disableLiveLocation=F("disableLiveLocation"),this.findGroupPendingInvitesFromPhone=F("findGroupPendingInvitesFromPhone"),this.acceptGroupV4Invite=F("acceptGroupV4Invite"),this.revokeGroupV4Invite=F("revokeGroupV4Invite"),this.sendCallOffer=F("sendCallOffer"),this.queryCall=F("queryCall"),this.sendCallEnd=F("sendCallEnd"),this.queryLabels=F("queryLabels"),this.queryNextLabelColor=F("queryNextLabelColor"),this.queryLabelPalette=F("queryLabelPalette"),this.addOrRemoveLabels=F("addOrRemoveLabels"),this.deleteLabel=F("deleteLabel"),this.createLabel=F("createLabel"),this.editLabel=F("editLabel"),this.queryQuickReplies=F("queryQuickReplies"),this.flushQuickReplyCounts=F("flushQuickReplyCounts"),this.queryStickerPacks=F("queryStickerPacks"),this.queryStickersInStickerPack=F("queryStickersInStickerPack"),this.queryRecentStickers=F("queryRecentStickers"),this.queryStarredStickers=F("queryStarredStickers"),this.queryVideoPlaybackUrl=F("queryVideoPlaybackUrl"),this.queryNoticeState=F("queryNoticeState"),this.querySettings=F("querySettings"),this.setArchiveSetting=F("setArchiveSetting"),this.queryDisappearingMode=F("queryDisappearingMode"),this.sendMdOptIn=F("sendMdOptIn")}isInitialized(){return!!U}setVersion(e,t,r){const n=e[0],i=e[1],s=[n,i,t,r].join("."),o=U!==s;if(__LOG__(2)`wap:setVersion ${s} set: ${String(o)}`,!o)return;const l=G;switch(n){case 0:switch(i){case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 11:case 12:case 13:case 14:case 15:case 16:throw __LOG__(3)`wap:setVersion deprecated version: ${s}`,new y.DeprecatedProtocolVersion("wap_deprecated_version");case 17:G=(0,a.default)({},b.protoMap[i]),G.setSubProtocol(t);break;default:G=void 0}}if(!G)throw __LOG__(3)`wap:setVersion unknown version. attempting to update`,new y.UpdateImmediately("wap_unknown_version");U=s,G.supportsFeatureFlags&&this.processFeatureFlags(r),l&&G&&G.upgradeProtoVersion(l)}processFeatureFlags(e){if(!e)return;const t=(0,c.default)(G,"protoVersion"),r=t.implementedFeatures||{},n=(0,p.decodeProtobufWithUnknowns)(R.WebFeaturesSpec,(0,o.decodeB64)(e)),i=(0,p.getUnknownFields)(n);delete n.unsafeUnknownFields;for(const e in r)S.GK.setFeatureFromFlags(e,R.WebFeaturesFlag.FORCE_UPGRADE,R.WebFeaturesFlag.FORCE_UPGRADE);const a=Object.keys(R.WebFeaturesSpec.internalSpec),s=Object.keys(n);a.forEach((e=>{const t=(0,S.getProtobufFeatureName)(e);!s.includes(e)&&S.GK.supportsFeature(t)&&S.GK.setFeature(t,!1)}));for(const e in n){if(r[e])continue;const i=n[e],a=E.default[e];if(i===R.WebFeaturesFlag.FORCE_UPGRADE&&a!==R.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:${e} phone value is ${i} and web value is ${a}. updating...`,new y.UpdateImmediately("wap_feature_force_upgrade");if(S.GK.setFeatureFromFlags(e,a,i),S.GK.supportsFeatureFromFlags(e)){const r=b.protoMap.features[e];r&&Object.assign(t,r)}}for(const e in i){const t=i[e];if("number"==typeof t&&R.WebFeaturesFlag.cast(t)===R.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:unknown: ${e}: ${t}`,new y.UpdateImmediately("wap_feature_implemented_unknown")}}delete(){const e=G?G.delete.apply(G,arguments):void 0;return G=void 0,U=void 0,__LOG__(2)`wap:unsetVersion, which should only happen when logout`,e}cannotReachPhone(){G&&G.cannotReachPhone.apply(G,arguments)}handle(e,t,r,n){return(0,c.default)(G,"protoVersion").handle.apply(G,[e,t,r,n])}queryServerProps(){return k.Socket.sendEphemeral2({data:["query","props"],retryOn5xx:!1})}resyncPictures(e){const t=e.filter((e=>N.default.isWid(e.id)));return 0===t.length?Promise.resolve([]):k.Socket.sendEphemeral2({data:["query","resumePic",t],retryOn5xx:!0})}setRememberMe(e){return k.Socket.sendBasic({data:["admin","remember",!!e]})}queryMediaConnections(e){const t=new Date,r=k.Socket.send2({data:["query","mediaConn"]}).then((e=>{if(__LOG__(2,!0)`queryMediaConnections result: ${JSON.stringify(e)}`,200!==e.status){if(e.status>=400)throw new D.ServerStatusCodeError(e.status,"queryMediaConnections");throw new D.ServerStatusCodeError(e.status,"Invalid return status")}const{media_conn:r}=e;if(!(r&&r.auth&&r.ttl&&r.hosts&&Array.isArray(r.hosts)&&0!==r.hosts.length))throw __LOG__(2)`wap:queryMediaConnections mediaConn exists ${String(!!r)}`,r&&(__LOG__(2)`wap:queryMediaConnections mediaConn.auth exists ${String(!!r.auth)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.ttl exists ${String(!!r.ttl)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts exists ${String(!!r.hosts)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts isArray ${String(Array.isArray(r.hosts))}`,r.hosts&&__LOG__(2)`wap:queryMediaConnections mediaConn.hosts.length ${r.hosts.length}`),__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("wap:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");const{auth:n,auth_ttl:i,ttl:s,max_buckets:o}=r;return{auth:n,authTTL:i,hosts:r.hosts.map((e=>{var t;const r=null===(t=e.rules)||void 0===t?void 0:t.map((e=>e.download_buckets?{downloadBuckets:e.download_buckets}:e));return(0,a.default)((0,a.default)({},e),{},{rules:r})})),queryStartTime:t,ttl:s,maxBuckets:o}}));return(0,P.default)(r,e)}acceptGroupInvite(e){return k.Socket.send2({data:["action","invite",e],retryOn5xx:!0})}revokeGroupInvite(e){return k.Socket.send2({data:["action","inviteReset",e],retryOn5xx:!0})}contactFindBroadcast(e){return k.Socket.send2({data:["query","contact",e],retryOn5xx:!0})}commonGroupsFind(e){return N.default.isServer(e)?Promise.resolve({status:200,groups:[]}):k.Socket.send2({data:["query","group","common",e]})}getCapabilities(e){return k.Socket.send2({data:["query","caps",e.filter(N.default.isUser)],retryOn5xx:!0})}queryExist(e){return N.default.isUser(e)?k.Socket.send2({data:["query","exist",e],retryOn5xx:!0}):Promise.resolve({status:400})}queryCtwaContext(e,t,r){return(0,s.default)((function*(){var n,i,a,s;const o={accountNumber:(0,L.createWid)(e).toString({legacy:!0}),code:t,expectedSourceUrl:r,id:(0,u.generateId)()},l=yield k.Socket.send2({data:["query","ctwa",o],retryOn5xx:!0});if(200!==l.status)throw new D.ServerStatusCodeError(l.status,`queryCtwaContext:fail ${l.status}`);const c={sourceId:l.data.source.id,sourceType:l.data.source.type,sourceUrl:l.data.source.url,description:l.data.body,title:l.data.headline,mediaType:(null===(n=l.data.video)||void 0===n?void 0:n.url)?g.ExternalAdReplyInfoMediaType.VIDEO:g.ExternalAdReplyInfoMediaType.IMAGE,isSuspiciousLink:l.data.source.url!==r,thumbnailUrl:null===(i=l.data.thumbnail)||void 0===i?void 0:i.url,mediaUrl:null===(a=l.data.video)||void 0===a?void 0:a.url};return(null===(s=l.data.thumbnail)||void 0===s?void 0:s.bytes)&&(c.thumbnail=l.data.thumbnail.bytes),c}))()}queryBusinessProfile(e,t){return(0,s.default)((function*(){const r=yield k.Socket.send2({data:["query","businessProfile",e.filter((e=>N.default.isUser(e.wid))),t],retryOn5xx:!0});switch(r.status){case 200:return r.profiles;default:throw new Error(`queryBusinessProfile:fail ${r} ${r.status}`)}}))()}queryMerchantCompliance(e){return(0,s.default)((function*(){const t=yield k.Socket.send2({data:["query","merchantCompliance",e.filter((e=>N.default.isUser(e.wid)))],retryOn5xx:!0});switch(t.status){case 200:return t.compliance_infos;default:throw new Error(`queryMerchantCompliance:fail ${t} ${t.status}`)}}))()}queryBusinessCategories(e){return(0,s.default)((function*(){const t={id:(0,u.generateId)(),query:e},r=yield k.Socket.send2({data:["query","businessCategories",t],retryOn5xx:!0});switch(r.status){case 200:const e=r.data.not_a_biz[0],t=e.id,n=r.data.categories.reduce(((t,r)=>(r.id!==e.id&&t.push({id:r.id,localized_display_name:r.name}),t)),[]);return n.unshift({id:t,localized_display_name:e.name,not_a_biz:!0}),{categories:n,notABizId:t};default:throw new Error(`queryBusinessCategories:fail ${r} ${r.status}`)}}))()}queryOrder(e,t,r,n){return(0,s.default)((function*(){const i={id:(0,u.generateId)(),orderId:e,imageWidth:t.toString(),imageHeight:r.toString(),token:n},a=yield k.Socket.send2({data:["query","order",i],retryOn5xx:!0});switch(a.status){case 200:const{data:e}=a;try{const{currency:t,subtotal:r,total:n,tax:i}=e.price,a=parseInt(e.creationTS,10);return{currency:t,createdAt:a,products:e.products.map((e=>{var t,r;return{id:e.id,price:e.price,thumbnailId:null===(t=e.image)||void 0===t?void 0:t.id,thumbnailUrl:null===(r=e.image)||void 0===r?void 0:r.url,currency:e.currency,name:e.name,quantity:parseInt(e.quantity||0,10)}})),subtotal:r,total:n,tax:i}}catch(e){throw new D.ServerStatusCodeError(a.status,`queryOrder:response malformed ${a.status}`)}case 404:throw new D.E404;default:throw new D.ServerStatusCodeError(a.status,`queryOrder:fail ${a.status}`)}}))()}createOrder(e,t){return(0,s.default)((function*(){const r={product:t.map((e=>({id:e.id,name:e.name,quantity:(0,I.isNumber)(e.quantity)?e.quantity.toString():void 0,price:(0,I.isNumber)(e.priceAmount1000)?e.priceAmount1000.toString():void 0,currency:e.currency}))),bizJID:e,id:(0,u.generateId)()},n=yield k.Socket.send2({data:["action","createOrder",r],retryOn5xx:!0});if(200===n.status)return n.data;throw new D.ServerStatusCodeError(n.status,`createOrder:fail wap action return status: ${n.status}`)}))()}refreshCart(e,t,r,n){return(0,s.default)((function*(){const i=t.map((e=>({id:e}))),a={id:(0,u.generateId)(),products:i,bizJID:N.default.user(e),imageDimensions:{width:r.toString(),height:n.toString()}},s=yield k.Socket.send2({data:["action","refreshOrder",a],retryOn5xx:!0});if(200===s.status)return s.data;throw new D.ServerStatusCodeError(s.status,`refreshCart:fail wap action return status: ${s.status}`)}))()}queryProductCatalog(e,t,r,n,i,a){return(0,s.default)((function*(){const s={catalogWid:e,afterCursor:t,limit:r,width:n,height:i,allowShopSource:a,type:"get_product_catalog_reh",stanza_id:(0,u.generateId)()},o=yield k.Socket.send2({data:["query","bizCatalog",s],retryOn5xx:!0});switch(o.status){case 200:return"string"==typeof o.data||o.data instanceof String?JSON.parse(o.data):o.data;default:throw new D.ServerStatusCodeError(o.status,`queryProductCatalog:fail ${o.status}`)}}))()}queryProductList(e,t,r,n){return(0,s.default)((function*(){const i={catalogWid:e,product_ids:t,width:""+r,height:""+n,stanza_id:(0,u.generateId)()},a=yield k.Socket.send2({data:["action","getProductList",i],retryOn5xx:!0});switch(a.status){case 200:return a.data.data;default:throw new D.ServerStatusCodeError(a.status,`queryProductList:fail ${a.status}`)}}))()}queryProduct(e,t,r,n,i){return(0,s.default)((function*(){const a={catalogWid:e,productID:t,width:r,height:n,fetchComplianceInfo:i,type:"get_product_reh",stanza_id:(0,u.generateId)()},s=yield k.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(s.status){case 200:const e="string"==typeof s.data||s.data instanceof String?JSON.parse(s.data):s.data.product;return e.compliance_category===C.ProductComplianceCategory.CountryOriginExempt&&(e.compliance_info={country_code_origin:String(_.SyntheticCountryCode.NotApplicable)}),{data:e};case 404:case"not_found":return{error:"NOT_FOUND"};default:throw new D.ServerStatusCodeError(s.status,`queryProduct:fail ${s.status}`)}}))()}reportBusinessCatalogProduct(e,t,r){return(0,s.default)((function*(){const n={id:t,jid:e.toString(),reason:r,stanza_id:(0,u.generateId)()},i=yield k.Socket.send2({data:["action","reportProduct_reh",n],retryOn5xx:!0});if(200!==i.status)throw new D.ServerStatusCodeError(i.status,`reportBusinessCatalogProduct:fail ${i.status}`)}))()}deleteBusinessCatalogProduct(e){return(0,s.default)((function*(){const t=["action","deleteProduct_reh",{product_ids:e,stanza_id:(0,u.generateId)()}],r=yield k.Socket.send2({data:t,retryOn5xx:!0});if(200!==r.status)throw new D.ServerStatusCodeError(r.status,`deleteBusinessCatalogProduct:fail ${r.status}`);return{deletedCount:r.deletedCount}}))()}createBusinessCatalog(){return(0,s.default)((function*(){const e=["action","createCatalog_reh",{stanza_id:(0,u.generateId)()}],t=yield k.Socket.send2({data:e,retryOn5xx:!0});if(200!==t.status)throw new D.ServerStatusCodeError(t.status,`createBusinessCatalog:fail ${t.status}`)}))()}getComplianceInfoRequestParams(e){const{complianceInfo:t}=e,{isExempt:r,hasCountryCodeOrigin:n,hasImporterName:i,hasImporterAddress:a}=(0,f.scanComplianceInfoForMissingData)(t);if(r||!t||!(n||i||a))return;const s={compliance_info:{}};if(t.countryCodeOrigin&&(s.compliance_info.country_code_origin=t.countryCodeOrigin),t.importerName&&(s.compliance_info.importer_name=t.importerName),t.importerAddress){const e={};t.importerAddress.street1&&(e.street1=t.importerAddress.street1),t.importerAddress.street2&&(e.street2=t.importerAddress.street2),t.importerAddress.postalCode&&(e.postal_code=t.importerAddress.postalCode),t.importerAddress.city&&(e.city=t.importerAddress.city),t.importerAddress.region&&(e.region=t.importerAddress.region),t.importerAddress.countryCode&&(e.country_code=t.importerAddress.countryCode),Object.keys(e).length>0&&(s.compliance_info.importer_address=e)}return s}editBusinessCatalogProduct(e,t,r){var n=this;return(0,s.default)((function*(){var i;const s=(0,a.default)({product_id:e.id,name:e.name,image_url:e.imageCdnUrl,url:e.url,additional_image_urls:e.additionalImageCdnUrl,width:t.toString(),height:r.toString(),stanza_id:(0,u.generateId)(),is_hidden:e.isHidden},n.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),e.description&&(s.description=e.description),e.retailerId&&(s.retailer_id=e.retailerId),(null===(i=e.complianceInfo)||void 0===i?void 0:i.countryCodeOrigin)===String(_.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=C.ProductComplianceCategory.CountryOriginExempt);const o=yield k.Socket.send2({data:["action","editProduct_reh",s],retryOn5xx:!0});if(200===o.status)return o.data.product;var l;throw new D.CatalogEditServerError(o.status,(0,A.parseLegacyProductErrorReason)(null==o||null===(l=o.data)||void 0===l?void 0:l.reason))}))()}editBusinessComplianceWebd(e){return(0,s.default)((function*(){var t,r,n,i,a,s,o;const l={customer_care_details:{email:null===(t=e.customerCareDetails)||void 0===t?void 0:t.email,landline_number:null===(r=e.customerCareDetails)||void 0===r?void 0:r.landlineNumber,mobile_number:null===(n=e.customerCareDetails)||void 0===n?void 0:n.mobileNumber},grievance_officer_details:{email:null===(i=e.grievanceOfficerDetails)||void 0===i?void 0:i.email,landline_number:null===(a=e.grievanceOfficerDetails)||void 0===a?void 0:a.landlineNumber,mobile_number:null===(s=e.grievanceOfficerDetails)||void 0===s?void 0:s.mobileNumber,name:null===(o=e.grievanceOfficerDetails)||void 0===o?void 0:o.name},entity_name:e.entityName,entity_type:e.entityType,entity_type_custom:e.entityTypeCustom,is_registered:e.isRegistered},c=yield k.Socket.send2({data:["action","editBusinessCompliance",l],retryOn5xx:!0});switch(c.status){case 200:return c.compliance_infos;default:throw new Error(`editBusinessCompliance:fail ${c} ${c.status}`)}}))()}addBusinessCatalogProduct(e,t,r){var n=this;return(0,s.default)((function*(){var i;const s=(0,a.default)({name:e.name,description:e.description||"",image_url:e.imageCdnUrl,url:e.url||"",additional_image_urls:e.additionalImageCdnUrl,retailer_id:e.retailerId||"",width:t.toString(),height:r.toString(),stanza_id:(0,u.generateId)(),is_hidden:e.isHidden},n.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),(null===(i=e.complianceInfo)||void 0===i?void 0:i.countryCodeOrigin)===String(_.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=C.ProductComplianceCategory.CountryOriginExempt);const o=yield k.Socket.send2({data:["action","addProduct_reh",s],retryOn5xx:!0});if(200===o.status)return o.data.product;var l;throw new D.CatalogEditServerError(o.status,(0,A.parseLegacyProductErrorReason)(null==o||null===(l=o.data)||void 0===l?void 0:l.reason))}))()}productVisibilitySet(e){return(0,s.default)((function*(){const t={product_visibility:e.map((e=>[e.productId,e.isHidden])),stanza_id:(0,u.generateId)()},r=yield k.Socket.send2({data:["action","productVisibilitySet",t],retryOn5xx:!0});if(200!==r.status)throw new D.ServerStatusCodeError(r.status,`productVisibilitySet:fail ${r.status}`)}))()}appealCatalogProduct(e,t){return(0,s.default)((function*(){const r={id:e,reason:t,stanza_id:(0,u.generateId)()},n=yield k.Socket.send2({data:["action","appealProduct_reh",r],retryOn5xx:!0});if(200===n.status)return!0;throw new D.ServerStatusCodeError(n.status,`appealCatalogProduct:fail ${n.status}`)}))()}groupV4InviteRequestMetadataFind(e,t,r,n,i){return k.Socket.send2({data:["query","InvitedGroupMetadata",{from:e,admin:t,code:r,expiration:n,gid:i}],retryOn5xx:!1})}groupV4InviteGrpPicThumb(e,t,r,n){return k.Socket.send2({data:["query","AddRequestGrpProfilePicThumb",{admin:e,code:t,expiration:r,gid:n}],retryOn5xx:!0})}groupMetadataFind(e){return(0,s.default)((function*(){const t=yield k.Socket.send2({data:["query","GroupMetadata",e],retryOn5xx:!0});return t.status&&t.status>=400?Promise.reject(new D.ServerStatusCodeError(t.status)):t}))()}groupInviteInfo(e){return k.Socket.send2({data:["query","invite",e],retryOn5xx:!0})}groupInviteCode(e){return k.Socket.send2({data:["query","inviteCode",e],retryOn5xx:!0})}profilePicFind(e){return N.default.isServer(e)?Promise.resolve({status:400}):k.Socket.sendEphemeral2({data:["query","ProfilePicThumb",e],retryOn5xx:!0})}profilePicFindThumbFromPhone(){return G?G.profilePicFindThumbFromPhone.apply(G,arguments):Promise.reject(new y.ProtoVersionUndefined("wap:profilePicFindThumbFromPhone:not connected to phone"))}statusFind(e){return N.default.isServer(e)?Promise.resolve({status:""}):k.Socket.sendEphemeral2({data:["query","Status",e],retryOn5xx:!0})}sendPing(){return k.Socket.send2({data:["admin","test"],retryOn5xx:!0})}sendPresenceAvailable(){return x("available")}sendPresenceUnavailable(){return x("unavailable")}sendChatstateComposing(e){return B("composing",e)}sendChatstatePaused(e){return B("paused",e)}sendChatstateRecording(e){return B("recording",e)}subscribePresence(e){return k.Socket.send2({data:["action","presence","subscribe",e],retryOn5xx:!0})}downloadImage(){return Promise.reject(new Error("Image download is not yet implemented"))}logoutToken(){return(0,s.default)((function*(){const{encKey:e,macKey:t}=O.get(),r=yield new T.default((0,c.default)(t,"macKey")).sign(new Uint8Array((0,c.default)(e,"encKey")));return(0,o.encodeB64)(r)}))()}sendGroupCallOffer(e){return this.sendCallSignalingMsg(e)}sendCallSignalingMsg(e,t){return(0,s.default)((function*(){const r=t||(0,M.newTag)(),n=(0,w.formatCallSignalingMsg)(r,e);if(!n)return Promise.reject(new Error("unknown call signaling msg type"));return yield k.Socket.send2({tag:r,data:["action","call",n],retryOn5xx:!0})}))()}};t.instance=K},97951:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.attemptWithDirectConnectionRetry=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(15131)),s=r(884),o=r(77591);function l(){return(l=(0,i.default)((function*(e,t){if(!(yield(0,s.isCypherNeeded)(e)))return t();const r=function(){var r=(0,i.default)((function*(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=(yield a.default.getCypher(e,{forceRenew:r})).cypher;return t(n)}));return function(){return r.apply(this,arguments)}}();try{return yield r()}catch(e){return e instanceof o.ServerStatusCodeError&&421===e.statusCode?(__LOG__(2)`Received 421 from Direct Connection request. Renewing certificate and retrying.`,r(!0)):Promise.reject(e)}}))).apply(this,arguments)}},79235:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessProfile=function(e,t){const r=(0,s.getBusinessProfileQueryVersion)();let n;o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(n=t?Promise.all([(0,d.default)(e,r),(0,l.getMerchantCompliance)(e)]).then(h):(0,d.default)(e,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=t?Promise.all([u.default.queryBusinessProfile(e,r),u.default.queryMerchantCompliance(e)]).then(h):u.default.queryBusinessProfile(e,r);return(0,p.attachErrorLogger)(n,"Query business profile failed")},t.queryBusinessPublicKey=function(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){return(0,r(68819).getJobManager)().waitUntilCompleted(c.jobSerializers.getPublicKey(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.querySignedUserInfo=function(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){return(0,r(68819).getJobManager)().waitUntilCompleted(c.jobSerializers.getSignedUserInfo(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.updateCartEnabled=function(e){let t;o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(t=(0,a.updateCartEnabled)(e),t||(t=Promise.reject(new Error("Should not reach here")))):t=Promise.reject(new Error("This feature is only available for MD."));return t};var i=n(r(81109)),a=r(8021),s=r(56149),o=r(7293),l=r(63442),c=r(6684),d=n(r(63638)),u=n(r(56891)),p=r(77591);function h(e){let[t,r]=e;return t.map(((e,t)=>(0,i.default)((0,i.default)({},e),{},{profile:(0,i.default)((0,i.default)({},e.profile),{},{legal_entity_details:r[t]})})))}},40346:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){let t;const r=(0,a.phaseOutNotABusiness)();(0,s.qplPointProfileCatsView)("datasource_start"),i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(t=(0,o.queryBusinessCategories)(e,r),t||(t=Promise.reject(new Error("BusinessCategory MD query not yet implemented")))):t=l.default.queryBusinessCategories(e);return t.then((e=>((0,s.qplPointProfileCatsView)("datasource_end"),e))),t};var i=r(7293),a=r(57701),s=r(90549),o=r(87117),l=n(r(56891))},56149:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DIRECT_CONNECTION_FLAG=void 0,t.getBusinessProfileQueryVersion=function(){return 247&n.ServerProps.webBizProfileOptions};var n=r(64551);t.DIRECT_CONNECTION_FLAG=128},45741:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createLabelAssociationMutations=T,t.editLabelAssociation=function(e,t){let r;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){t.some((e=>e instanceof l.default))&&(__LOG__(4,void 0,new Error,!0)`contact model is invalid for editLabelAssociation`,SEND_LOGS("contact model is invalid for editLabelAssociation")),r=E(e,t.map((e=>e instanceof p.Msg?{labelAssociationType:u.LabelAssociationType.Message,modelId:e.id.toString(),mutationIndexSegments:(0,m.constructMsgKeySegments)(e)}:{labelAssociationType:u.LabelAssociationType.Jid,modelId:e.id.toString(),mutationIndexSegments:[e.id.toString({legacy:!0})]}))),r||(r=Promise.reject(new Error("Should not reach here")))}else r=g.default.addOrRemoveLabels(e,t).then((e=>{if(200!==e.status)throw new y.ServerStatusCodeError(e.status)}));return r},t.editLabelAssociationMD=E,t.editLocalLabelAssociationMD=S;var i=n(r(48926)),a=r(92844),s=r(60980),o=r(45606),l=n(r(121)),c=r(7293),d=r(57701),u=r(82663),p=r(17304),h=r(12492),f=r(22701),_=r(38804),m=r(93824),g=n(r(56891)),y=r(77591);function E(e,t){return(0,d.canEditLabelAssociation)()?(0,_.lockForSync)(["label-association"],T(e,t),(()=>S(e,t))):Promise.reject(new Error("editLabelAssociation is not supported"))}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const r=[],n=[];e.forEach((e=>{let{id:i,type:a}=e;t.map((e=>{let{modelId:t,labelAssociationType:s}=e;"add"===a?r.push({labelId:i,associationId:t,type:s}):n.push([i,t,s])}))}));const i=(0,u.getTable)();yield Promise.all([i.bulkCreateOrReplace(r).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into label association table failed`,SEND_LOGS("bulkCreateOrReplace into label association table failed when saving label associations"),new Error("bulkCreateOrReplace into label association table failed")})),i.bulkRemove(n).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from label association table failed`,SEND_LOGS("bulkRemove from label association table failed while saving label associations"),new Error("bulkRemove form label association table failed")}))])}))).apply(this,arguments)}function T(e,t){const r=(0,a.unixTimeMs)(),n=[];return e.forEach((e=>{let{id:i,type:a}=e;t.forEach((e=>{let{labelAssociationType:t,mutationIndexSegments:l}=e;const c=t===u.LabelAssociationType.Message?o.Actions.LabelMessage:o.Actions.LabelJid;n.push({timestamp:r,collection:o.CollectionName.Regular,operation:h.SyncdMutationSyncdOperation.SET,index:JSON.stringify([c,i,...l]),version:o.LABEL_ASSOCIATION_SYNC_VERSION,binarySyncAction:(0,s.encodeProtobuf)(f.SyncActionValueSpec,{timestamp:r,labelAssociationAction:{labeled:"add"===a}}).readBuffer(),action:c})}))})),n}},21374:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e,t,r){let n;E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(n=(0,s.addProductMD)(e,t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=T.default.addBusinessCatalogProduct(e,t,r);return n.then((()=>E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),n=n.then(M),n.catch((e=>{if(e instanceof A.ServerStatusCodeError&&406===e.statusCode||e instanceof A.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Add product failed, error: ${e}`,SEND_LOGS("Add product failed"),e}))},t.appealProduct=function(e,t){let r;E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(r=(0,o.appealProductMD)(e,t),r||(r=Promise.reject(new Error("Should not reach here")))):r=T.default.appealCatalogProduct(e,t);return r.then((()=>E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_end"))),(0,A.attachErrorLogger)(r,"Appeal product failed")},t.createCatalog=function(){let e;E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(e=(0,c.createProductCatalog)(),e||(e=Promise.reject(new Error("Should not reach here")))):e=T.default.createBusinessCatalog();return e.then((()=>{E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_end")})),(0,A.attachErrorLogger)(e,"Create catalog failed")},t.deleteProducts=function(e){let t;E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(t=(0,d.deleteProductsMD)(e),t||(t=Promise.reject(new Error("Should not reach here")))):t=T.default.deleteBusinessCatalogProduct(e);return t=t.then((()=>E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_end"))),(0,A.attachErrorLogger)(t,"Delete product failed")},t.editProduct=function(e,t,r){let n;E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(n=(0,u.default)(e,t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=T.default.editBusinessCatalogProduct(e,t,r);return n.then((()=>E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),n=n.then(M),n.catch((e=>{if(e instanceof A.ServerStatusCodeError&&406===e.statusCode||e instanceof A.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Edit product failed, error: ${e}`,SEND_LOGS("Edit product failed"),e}))},t.mapMsgToProductModel=function(e){let t;e.businessOwnerJid&&(t=(0,C.createWid)(e.businessOwnerJid));return{catalogWid:t,id:e.productId||"",url:e.url,name:e.title,description:e.description,imageCdnUrl:e.mediaData.renderableUrl,reviewStatus:"",currency:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,productMsgMediaData:e.mediaData,imageCount:null!=e.productImageCount&&0!==e.productImageCount?e.productImageCount:1,fetchedFromServer:!1,t:e.t,isHidden:!1}},t.mapProductResponseToModel=M,t.parseDateValue=P,t.productVisibilitySet=function(e){let t;E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(t=(0,m.default)(e),t||(t=Promise.reject(new Error("Should not reach here")))):t=T.default.productVisibilitySet(e);return t.then((()=>E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_end"))),(0,A.attachErrorLogger)(t,"Product visibility change failed")},t.queryCatalog=function(e,t,r,n,i,a,s){let o;if(p.GK.supportsFeature(p.GK.F.MD_BACKEND))o=(0,l.attemptWithDirectConnectionRetry)(e,(o=>(0,g.default)(e,t,r,n,i,a,s,o))),o||(o=Promise.reject(new Error("Should not reach here")));else{const a=e.toString({legacy:!0});o=T.default.queryProductCatalog(a,t,r,n,i,s)}return o.catch((e=>{if(e instanceof A.ServerStatusCodeError&&404===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Query catalog failed, error: ${e}`,SEND_LOGS("Query catalog failed"),e}))},t.queryProduct=function(e,t,r,n,i,a){let s;!0===a&&(0,h.qplPointProductView)("datasource_start"),s=p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(0,l.attemptWithDirectConnectionRetry)(e,(a=>(0,y.default)(e,t,r,n,i,a))):T.default.queryProduct(e.toString({legacy:!0}),t,r,n,i);return s.then((()=>!0===a&&(0,h.qplPointProductView)("datasource_end"))),(0,A.attachErrorLogger)(s,"Query product failed")},t.queryProductList=function(e,t,n,i,a){let s;if(a&&(0,h.qplPointPLMDetailsView)("datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)){const a=r(68819).getJobManager;s=(0,l.attemptWithDirectConnectionRetry)(e,(r=>a().waitUntilCompleted(f.jobSerializers.queryProductList(e,t,r,n,i))))}else{const r=e.toString({legacy:!0});s=T.default.queryProductList(r,t,n,i)}return s.then((()=>a&&(0,h.qplPointPLMDetailsView)("datasource_end"))),s},t.reportProduct=function(e,t,r){let n;E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_start"),p.GK.supportsFeature(p.GK.F.MD_BACKEND)?(n=(0,v.default)(e,t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=T.default.reportBusinessCatalogProduct(e,t,r);return n.then((()=>E.QPL.markerPoint(S.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_end"))),(0,A.attachErrorLogger)(n,"Report product failed")};var i=n(r(81109)),a=n(r(30381)),s=r(93306),o=r(27534),l=r(97951),c=r(90880),d=r(15814),u=n(r(21013)),p=r(7293),h=r(90549),f=r(6684),_=r(6822),m=n(r(17728)),g=n(r(43077)),y=n(r(27678)),E=r(48870),S=r(27798),v=n(r(93374)),T=n(r(56891)),A=r(77591),C=r(58021);function b(e){return null==e?null:p.GK.supportsFeature(p.GK.F.MD_BACKEND)?parseInt(e,10):10*parseInt(e,10)}function P(e){return e?a.default.utc(e,a.default.ISO_8601).valueOf():null}function M(e,t){var r,n;const a=(null===(r=e.capability_to_review_status[0])||void 0===r?void 0:r.value)||"APPROVED",s={catalogWid:t,id:e.id,isHidden:e.is_hidden||!1,url:e.url||"",name:e.name,description:e.description||"",availability:null!==(n=_.ProductAvailability.cast(e.availability))&&void 0!==n?n:_.ProductAvailability.UNKNOWN,additionalImageCdnUrl:e.additional_image_cdn_urls.map((e=>e[1].value)),additionalImageHashes:e.image_hashes_for_whatsapp.slice(1),imageCdnUrl:e.image_cdn_urls[1].value,imageHash:e.image_hashes_for_whatsapp[0],reviewStatus:a,currency:e.currency,priceAmount1000:b(e.price),salePriceAmount1000:b(e.sale_price),salePriceStartDate:P(e.sale_start_date),salePriceEndDate:P(e.sale_end_date),retailerId:e.retailer_id||"",productMsgMediaData:null,imageCount:e.additional_image_cdn_urls.length+1,fetchedFromServer:!0,t:Date.now()/1e3,old:!1,canAppeal:e.whatsapp_product_can_appeal,checkmark:e.checkmark};return e.compliance_info&&(s.complianceInfo=function(e){const t={countryCodeOrigin:e.country_code_origin};e.importer_name&&(t.importerName=e.importer_name);e.importer_address&&(t.importerAddress=function(e){const t={street1:e.street1,city:e.city,countryCode:e.country_code};e.street2&&(t.street2=e.street2);e.postal_code&&(t.postalCode=e.postal_code);e.region&&(t.region=e.region);e.country_code&&(t.countryCode=e.country_code);return t}(e.importer_address));return t}(e.compliance_info)),(0,i.default)({},s)}},72639:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(t){const r=a.ContactCollection.gadd(e);(0,o.updateVerifiedInfo)(r,t.verifiedName)}}else l.default.queryVname(e).catch((0,i.filteredCatch)(c.WebdDrop,(()=>{})))};var i=r(50796),a=r(19380),s=r(7293),o=r(66167),l=n(r(56891)),c=r(77591)},76931:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendChatStateComposing=function(e){return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?((0,a.default)(e,"composing"),Promise.resolve()):s.default.sendChatstateComposing(e).then((e=>{if(200!==e.status)throw new o.ServerStatusCodeError(e.status)}))},t.sendChatStatePaused=function(e){return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?((0,a.default)(e,"paused"),Promise.resolve()):s.default.sendChatstatePaused(e).then((e=>{if(200!==e.status)throw new o.ServerStatusCodeError(e.status)}))},t.sendChatStateRecording=function(e){return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?((0,a.default)(e,"recording"),Promise.resolve()):s.default.sendChatstateRecording(e).then((e=>{if(200!==e.status)throw new o.ServerStatusCodeError(e.status)}))};var i=r(7293),a=n(r(88795)),s=n(r(56891)),o=r(77591)},91177:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearStorage=g,t.sendClear=function(e,t,r){let n;u.GK.supportsFeature(u.GK.F.MD_BACKEND)?(n=(0,p.clearOrDeleteChatSyncEnabled)()?function(){return E.apply(this,arguments)}(e,t,r):function(){return S.apply(this,arguments)}(e,r),n||(n=Promise.reject(new Error("md:sendClear: should not reach here")))):n=_.default.sendConversationClear(e.id,t,!r).then((e=>{if(200!==e.status)throw new m.ServerStatusCodeError(e.status);return e}));return n};var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(92844),l=r(84902),c=r(38342),d=n(r(69048)),u=r(7293),p=r(57701),h=r(13946),f=r(22701),_=n(r(56891)),m=r(77591);function g(){return y.apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r)return(0,h.queryAndRemoveMessagesInMessageRange)(e.id,r,{skipStarred:t,skipRecentSystemMessages:!1});{const t=yield(0,h.getBoundsForChat)(e.id);yield(0,h.queryAndRemoveMessageHistory)(e.id),null==t&&__LOG__(3)`_sendClearMD: Expected to receive boundaries for chat while clearing`,d.default.purgeRange((0,i.default)({chatId:e.id.toString()},(0,s.default)(t,"rowIdBounds")))}}))).apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,n){const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(r.bind(r,19937))]),s=r(29867).default,d=(0,o.unixTimeMs)(),u=yield s.getClearChatMutation(d,e.id,!n);let p;return yield i(["message"],[u],(0,a.default)((function*(){var t;yield(0,c.addActiveMessageRange)(e.id.toString(),(0,c.getActiveRangeAction)("clearChat",{deleteStarred:!n}),u.binarySyncAction);const r=null===(t=(0,l.decodeProtobuf)(f.SyncActionValueSpec,u.binarySyncAction).clearChatAction)||void 0===t?void 0:t.messageRange;p=yield g(e,n,r)}))),{_duplicate:null,result:p}}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t){return yield g(e,t),{_duplicate:null}}))).apply(this,arguments)}},91829:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return g.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(48285),o=r(69951),l=r(90257),c=r(96751),d=r(242),u=n(r(25868)),p=n(r(75888)),h=r(7293),f=r(10435),_=r(5819),m=r(30849);function g(){return(g=(0,a.default)((function*(e,t,n){const{forceUsync:i=!1,firstIncomingMsg:a,nextPrivacyMode:g}=null!=n?n:{},S=e.isUser()&&i?yield(0,p.default)(e):null,v=null==S?e:S.wid;if(!e.equals(v)){const e=o.ChatCollection.get(v);if(null!=e)return e}let T=null;v.isUser()&&(0,f.isDisappearingModeEnabled)()&&(T=null==a||a.id.fromMe?(0,d.getDisappearingModeSettingForChat)(v):(0,d.getDisappearingModeSettingFromMsg)(a));const A=o.ChatCollection.gadd(y(v,null!=t?t:{},T)),C=S?(0,m.getPrivacyModeFromQueryExistResponse)(S):null,b=(0,m.comparePrivacyMode)(g,C)>0?g:C,P=(0,u.default)(v,b),M=null!=T?(0,l.genDisappearingModeSystemMsg)(v,T.duration,T.initiator===c.DisappearingModeInitiator.InitiatedByMe):null;if(h.GK.supportsFeature(h.GK.F.MD_BACKEND)){yield(0,s.createChat)(v,E(A));const e=!1,t=!1;return yield(0,_.handleSingleMsgMD)(P.from,P,e,t),null!=M&&(yield(0,_.handleSingleMsgMD)(M.from,M,e,t)),A}{const e=r(26453).default;return e([{meta:{add:"relay"},chat:v,msg:P}]),null!=M&&e([{meta:{add:"relay"},chat:v,msg:M}]),A}}))).apply(this,arguments)}function y(e,t,r){let n=(0,i.default)({id:e},t);return null!=r&&(n=(0,i.default)((0,i.default)({},n),{},{ephemeralDuration:r.duration,ephemeralSettingTimestamp:r.settingTimestamp,disappearingModeInitiator:r.initiator})),n}function E(e){return{id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:null!=e.changeNumberOldJid?e.changeNumberOldJid.toString():void 0,changeNumberNewJid:null!=e.changeNumberNewJid?e.changeNumberNewJid.toString():void 0,muteExpiration:e.muteExpiration,endOfHistoryTransferType:(e.endOfHistoryTransferType,e.endOfHistoryTransferType),ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingModeInitiator:(e.disappearingModeInitiator,e.disappearingModeInitiator)}}},77772:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteFromStorage=function(e){return(0,g.getStorage)().lock(["chat","label-association","message"],(0,a.default)((function*(){const t=yield(0,m.getBoundsForChat)(e);return yield Promise.all([(0,f.getChatTable)().remove(e.toString()),(0,m.queryAndRemoveMessageHistory)(e),S(e)]),t}))).then((t=>{t?c.default.purgeRange((0,i.default)({chatId:e.toString()},t)):__LOG__(3)`sendConversationDelete: chat boundaries was null`}))},t.sendConversationDelete=function(e,t,r){let n=Promise.resolve({status:400,_duplicate:!1});if(u.GK.supportsFeature(u.GK.F.MD_BACKEND))if((0,p.clearOrDeleteChatSyncEnabled)())n=C(e,!0);else{const i=r();(t&&t.equals(i)||t===i)&&(n=C(e,!1))}else n=E.default.sendConversationDelete(e,t);return n};var i=n(r(81109)),a=n(r(48926)),s=r(92844),o=r(84902),l=r(38342),c=n(r(69048)),d=r(45741),u=r(7293),p=r(57701),h=r(82663),f=r(76214),_=r(54598),m=r(13946),g=r(99069),y=r(22701),E=n(r(56891));function S(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e){if(!(0,p.canEditLabelAssociation)())return;const{labelsToUpdate:t,modelRecords:r}=yield T(e);yield(0,d.editLocalLabelAssociationMD)(t,r)}))).apply(this,arguments)}function T(){return A.apply(this,arguments)}function A(){return(A=(0,a.default)((function*(e){return{labelsToUpdate:(yield(0,_.queryLocalLabelAssociation)([{associationId:e.toString(),type:h.LabelAssociationType.Jid}])).map((e=>{let{labelId:t}=e;return{id:t,type:"remove"}})),modelRecords:[{labelAssociationType:h.LabelAssociationType.Jid,modelId:e.toString(),mutationIndexSegments:[e.toString({legacy:!0})]}]}}))).apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[{lockForMessageRangeSync:i},{default:c}]=yield Promise.all([Promise.resolve().then(r.bind(r,19937)),Promise.resolve().then(r.bind(r,36014))]),d=r(56928).default,u=(0,s.unixTimeMs)(),[h,_,g]=yield Promise.all([d.getDeleteChatMutation(u,e,!n),c.getPinMutation(u,!1,e),P(e)]),E=[...g];let v;return(0,p.pinChatSyncEnabled)()&&E.push(_),t&&E.push(h),yield i(["message","chat","label-association"],E,(0,a.default)((function*(){var r;t&&(yield(0,l.addActiveMessageRange)(e.toString(),(0,l.getActiveRangeAction)("deleteChat",{deleteMedia:!n}),h.binarySyncAction));const i=null===(r=(0,o.decodeProtobuf)(y.SyncActionValueSpec,h.binarySyncAction).deleteChatAction)||void 0===r?void 0:r.messageRange;i&&(v=yield(0,m.queryAndRemoveMessagesInMessageRange)(e,i),yield Promise.all([(0,f.getChatTable)().remove(e.toString()),S(e)]))}))),{status:200,_duplicate:!1,result:v}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e){if(!(0,p.canEditLabelAssociation)())return[];const{labelsToUpdate:t,modelRecords:r}=yield T(e);return(0,d.createLabelAssociationMutations)(t,r)}))).apply(this,arguments)}},11082:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(){return c.apply(this,arguments)},t.findLocal=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(68638),s=r(7293),o=r(64448),l=n(r(56891));function c(){return(c=(0,i.default)((function*(e,t){const r=performance.now(),n=yield l.default.chatFindQuery(e,(e=>{t.binarySize=e.binarySize}));return"preempted"!==n&&(t.timing=Math.ceil(performance.now()-r),t.size=n.length),n}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const t=yield(0,a.getTable)().get(e);if(t)return(0,o.hydrateWids)(t)}return null}))).apply(this,arguments)}},9025:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getExisting=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(69951),s=r(11082),o=r(7293);function l(){return(l=(0,i.default)((function*(e){const t=a.ChatCollection.get(e);if(t&&!t.stale)return t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const t=yield(0,s.findLocal)(e.toString());if(t)return a.ChatCollection.gadd(t)}return null}))).apply(this,arguments)}},11902:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLastReceivedKey=function(){return Promise.resolve()}},45197:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendConversationMute=function(e,t,r){let n;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){{const r=l.default.generateMuteMutation(e,t);n=(0,o.lockForSync)(["chat"],[r],(r=>{let[n]=r;return n.merge(e.toString(),{muteExpiration:t})})).then((()=>({status:200,_duplicate:null})))}n||(n=Promise.reject(new Error("Should not reach here")))}else n=a.default.sendConversationMute(e,t,r).then((e=>{if(200!==e.status)throw new s.ServerStatusCodeError(e.status);return e}));return n};var i=r(7293),a=n(r(56891)),s=r(77591),o=r(38804),l=n(r(70119))},3060:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.resyncMessages=function(){return c.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(7293),o=r(99069),l=n(r(56891));function c(){return(c=(0,a.default)((function*(e){const t=yield l.default.resyncMessages(e);if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&(!t.status||t.status<400)){const{data:e}=t,n=[],s=[];return e.forEach((e=>{r(69951).ChatCollection.get(e.id)?"clear"===e.type?n.push({id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid,muteExpiration:e.muteExpiration,ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp}):"delete"===e.type?s.push(e.id.toString()):n.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()})):n.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()}))})),(0,o.getStorage)().lock(["chat"],function(){var e=(0,a.default)((function*(e){let[t]=e;return yield t.bulkCreateOrMerge(n),t.bulkRemove(s)}));return function(){return e.apply(this,arguments)}}()).then((()=>t)).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get storage or bulk update chats failed`,SEND_LOGS("get storage or bulk update chats failedwhen re-sync messages"),new Error("get storage or bulk update chats failed")}))}return t}))).apply(this,arguments)}},97848:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markConversationSeen=function(e,t){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,d.getChatTable)().merge(e.toString(),{unreadCount:t}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark convestation seen"),new Error("update chat table failed")}));return Promise.resolve()},t.markConversationUnseen=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,d.getChatTable)().merge(e.toString(),{unreadCount:-1}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark conversation as unseen"),new Error("update chat table failed")}));return Promise.resolve()},t.sendConversationSeen=function(){return f.apply(this,arguments)},t.sendConversationUnseen=function(e,t){let n;c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(n=Promise.all([Promise.resolve().then(r.bind(r,19937))]).then((t=>{let[{lockForMessageRangeSync:i}]=t;const o=r(64294).default,l=(0,a.unixTimeMs)();n=o.getMarkChatAsReadMutation(l,!1,e).then((t=>i([],[t],(()=>(0,s.addActiveMessageRange)(e.toString(),"markChatAsRead",t.binarySyncAction)))))})),n||(n=Promise.reject(new Error("Should not reach here")))):n=p.default.sendConversationUnseen(e,t).then((e=>{const{status:t}=e;if(200!==t)throw new h.ServerStatusCodeError(t)}));return n};var i=n(r(48926)),a=r(92844),s=r(38342),o=r(48285),l=r(64103),c=r(7293),d=r(76214),u=r(35099),p=n(r(56891)),h=r(77591);function f(){return(f=(0,i.default)((function*(e,t,n){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(r.bind(r,19937))]),l=r(64294).default,c=(0,a.unixTimeMs)();if(-1===n){const t=yield l.getMarkChatAsReadMutation(c,!0,e.id),r=e.id.toString();i([],[t],(()=>(0,s.addActiveMessageRange)(e.id.toString(),"markChatAsRead",t.binarySyncAction))),yield(0,o.updateChatForMarkAsReadSync)(r)}else yield(0,u.markChatRead)(e,t);return{_duplicate:!1}}{const r=yield p.default.sendConversationSeen(e.id,t,n),{status:i,_duplicate:a}=r;if(200!==i)throw new h.ServerStatusCodeError(i);return{_duplicate:a}}}))).apply(this,arguments)}},86657:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeleteMsgs=function(e,t,r){let n;const d=[],u=[];if(e.forEach((e=>{d.push(e.id),u.push(String(e.rowId))})),a.GK.supportsFeature(a.GK.F.MD_BACKEND)){const r=i.default.getDeleteForMeMutations(e,t),a=d.map((e=>e.toString()));if(n=(0,o.lockForSync)(["message","label-association"],r,(()=>(0,s.removeMessagesFromHistory)(a))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove messages from history failed`,SEND_LOGS("remove messages from history failed when send delete messages"),new Error("remove messages from history failed")})),!n)return Promise.reject(new Error("Not Supported for Non-MD"))}else n=l.default.sendMessageDelete(r,d,t).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status)}));return n};var i=n(r(41058)),a=r(7293),s=r(84886),o=r(38804),l=n(r(56891)),c=r(77591)},69694:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendStarMsgs=function(e,t,r){let n;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(n=d(t,r),n||(n=Promise.reject(new Error("Should not reach here")))):n=l.default.sendMessageStarred(e,t.map((e=>e.id)),r).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status)}));return n},t.sendUnstarAll=function(e,t){let r;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(r=d(e,!1),r||(r=Promise.reject(new Error("Should not reach here")))):r=l.default.sendUnstarAll(t).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status)}));return r};var i=r(7293),a=r(84886),s=r(38804),o=n(r(78375)),l=n(r(56891)),c=r(77591);function d(e,t){t||o.default.addUnsetActionCount(e.length);const n=r(21263).default.getStarMessageMutations(e,t);return(0,s.lockForSync)(["message"],n,(()=>t?(0,a.starMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`star messages failed`,SEND_LOGS("star messages failed"),new Error("star messages failed")})):(0,a.unstarMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`unstar messages failed`,SEND_LOGS("unstar messages failed"),new Error("unstar messages failed")}))))}},58871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,n.getTable)().merge(e.toString(),t).catch((e=>{if(e instanceof i.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when update local"),new Error("update chat table failed")}));return Promise.resolve()};var n=r(68638),i=r(64103),a=r(7293)},30312:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendSetBlock=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(56375),s=r(7293),o=r(76214),l=n(r(56891)),c=r(77591);function d(){return(d=(0,i.default)((function*(e,t){let r;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){r=(e?(0,a.blockUser)(t):(0,a.unblockUser)(t)).then((e=>{if(e&&null!=e.errorCode)throw new c.ServerStatusCodeError(e.errorCode,e.errorText);return!0})),r||(r=Promise.reject(new Error("Should not reach here")))}else r=l.default.sendSetBlock(e,[{jid:t}]).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status);return!(e._duplicate||200!==e.status)}));const n=yield r;if(n&&s.GK.supportsFeature(s.GK.F.MD_BACKEND))try{const r=t.toString();return e?yield(0,o.getBlocklistTable)().createOrReplace({id:r}):yield(0,o.getBlocklistTable)().remove(t.toString()),n}catch(e){throw __LOG__(4,!0,new Error,!0)`send set block failed`,SEND_LOGS("Failed to send set block"),new Error("send set block failed")}return n}))).apply(this,arguments)}},45873:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setChecksum=function(e){n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(0,i.setContactChecksum)(e);return Promise.resolve()};var n=r(7293),i=r(50313)},8071:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setFrequent=function(e){const t={};Object.keys(e).forEach((r=>{t[r]=e[r].map((e=>e.toString()))})),n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(0,i.setFrequentContacts)(t);return Promise.resolve()};var n=r(7293),i=r(50313)},88129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContactsToRemove=function(e){const t=[],i={};return e.forEach((e=>{e&&(i[e.id]=!0)})),n.ContactCollection.forEach((e=>{const{id:n}=e;!(e.isUser||e.isGroup&&!r(69951).ChatCollection.get(n))||i[n.toString()]||e.isPSA||t.push(e)})),t};var n=r(19380)},26707:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotSpam=function(){return u.apply(this,arguments)},t.sendSpamReport=function(e,t){let r;a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(r=(0,l.reportSpam)(e,t).then((e=>{if(null==e?void 0:e.errorCode)throw new d.ServerStatusCodeError(e.errorCode,e.errorText)})),r||(r=Promise.reject(new Error("Should not reach here")))):r=c.default.sendSpamReport(e.id).then((e=>{if(200!==e.status)throw new d.ServerStatusCodeError(e.status)}));return r};var i=n(r(48926)),a=r(7293),s=r(90101),o=r(76214),l=r(18701),c=n(r(56891)),d=r(77591);function u(){return(u=(0,i.default)((function*(e){let t;return t=a.GK.supportsFeature(a.GK.F.MD_BACKEND)?Promise.resolve():c.default.sendConversationNotSpam(e.id).then((e=>{if(200!==e.status)throw new d.ServerStatusCodeError(e.status)})),yield t,a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(e.isGroup&&e.groupMetadata&&(yield(0,s.persistGroupMetadata)(e.groupMetadata.id,{notAddedByContact:!1})),(0,o.getChatTable)().merge(e.id.toString(),{notSpam:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get chat table merge failed`,SEND_LOGS("get chat table merge failed when sending spam report"),new Error("get chat table merge failed")}))):Promise.resolve()}))).apply(this,arguments)}},27211:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,i.getTable)().merge((0,n.toUserJid)(e.user),t);return Promise.resolve()};var n=r(19797),i=r(4233),a=r(7293)},9995:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactSync=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(10058),s=r(7293),o=r(76214),l=r(58021);function c(){return(c=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const t=yield(0,o.getContactTable)().all();if(t.length>0){const r=t.map((e=>(0,l.createWid)(e.id)));return(0,a.syncContactListInChunksJob)(r,e)}}}))).apply(this,arguments)}},79583:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendCreateGroup=function(e,t,r,n,l,c,d){let u;if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)){if(u=(0,i.createGroup)(e,t,d).then((e=>({gid:e.wid,participants:e.participants.map((e=>({[e.wid.toString()]:{code:null!=e.error?e.error.toString():"200",invite_code:e.invite_code,invite_code_exp:e.invite_code_exp}})))}))),!u)return Promise.reject(new Error("queryGroupInvite: not supported when not build with MD_BACKEND"))}else u=s.default.createGroup(e,t,r,n,l,c,d).then((e=>{if(200===e.status)return e;throw new o.ServerStatusCodeError(e.status)}));return u};var i=r(26539),a=r(7293),s=n(r(56891)),o=r(77591)},90447:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markExited=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,i.getTable)().merge(e.toString(),{isReadOnly:!0});return Promise.resolve()},t.sendExitGroup=function(e){let t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(t=(0,a.leaveGroups)([e]).then((()=>({_duplicate:null}))),!t)return Promise.reject(new Error("sendExitGroup: not supported when not build with MD_BACKEND"))}else t=o.default.leaveGroup(e).then((e=>{if(200!==e.status)throw new l.ServerStatusCodeError(e.status);return{_duplicate:e._duplicate}}));return t};var i=r(68638),a=r(12594),s=r(7293),o=n(r(56891)),l=r(77591)},64808:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendJoinGroupViaInviteV4=function(e,t,r,n){return(0,s.joinGroupViaInviteV4)(e,t,r,n)},t.sendQueryGroupInviteV4=function(){return o.apply(this,arguments)},t.sendRevokeGroupInviteV4=function(e,t){return(0,s.revokeGroupInviteV4)(e,t)};var i=n(r(81109)),a=n(r(48926)),s=r(82394);function o(){return(o=(0,a.default)((function*(e,t,r,n,a){const o=yield(0,s.queryGroupInviteV4)(e,t,r,n,a);return null!=o.groupMetadata?(0,i.default)({},o.groupMetadata):{status:o.status}}))).apply(this,arguments)}},10790:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.groupMetadataFindFromPhone=function(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return Promise.reject(new Error("groupMetadataFindFromPhone: not supported in MD_BACKEND mode"));return u.default.groupMetadataFindFromPhone(e)},t.sendQueryGroup=function(){return h.apply(this,arguments)},t.sendQueryGroupInvite=function(e){let t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(t=(0,l.queryGroupInvite)(e).then((e=>(0,i.default)({status:200},e))),!t)return Promise.reject(new Error("queryGroup: not supported when not build with MD_BACKEND"))}else t=u.default.groupInviteInfo(e).then((e=>{if(200!==e.status)throw new p.ServerStatusCodeError(e.status);return e}));return t},t.updateSubject=f;var i=n(r(81109)),a=n(r(48926)),s=r(19380),o=r(7293),l=r(85057),c=r(61051),d=r(31515),u=n(r(56891)),p=r(77591);function h(){return(h=(0,a.default)((function*(e){let t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(__LOG__(2,void 0,void 0,void 0,["groups"])`querying server for groupMetadata of group id ${e.toString()}`,t=(0,c.queryGroupJob)(e,"interactive"),!t)return Promise.reject(new Error("queryGroup: not supported when not build with MD_BACKEND"))}else t=u.default.groupMetadataFind(e);try{const r=yield t;if(r.id)return f(e,r.subject),{id:r.id,owner:r.owner,creation:r.creation,desc:r.desc,descId:r.descId,descOwner:r.descOwner,descTime:r.descTime,restrict:r.restrict||!1,announce:r.announce||!1,noFrequentlyForwarded:r.noFrequentlyForwarded||!1,ephemeralDuration:r.ephemeralDuration||0,participants:r.participants,support:!0===r.support};__LOG__(3)`Store:GroupMetadata Unexpected server response`}catch(t){if(t instanceof p.ServerStatusCodeError&&t.status>=400)return{id:e,stale:!1};throw t}}))).apply(this,arguments)}function f(e,t){(0,d.isString)(t)&&s.ContactCollection.find(e).then((function(e){e.name||e.set({name:t})}))}},13194:(e,t,r)=>{"use strict";t.Z=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){let e=!1;return e=(0,a.isRegistered)(),e}return!!(0,n.getLoginTokens)().server};var n=r(99234),i=r(7293),a=r(58052)},90549:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCartView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_CART_VIEW,e)},t.qplPointOrderCreate=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_ORDER_CREATE,e)},t.qplPointOrderView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_ORDER_VIEW,e)},t.qplPointPLMDetailsView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PLM_DETAILS_VIEW,e)},t.qplPointProductView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PRODUCT_VIEW,e)},t.qplPointProfileCatsView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PROFILE_CATS_VIEW,e)},t.qplPointProfileSave=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PROFILE_SAVE,e)};var n=r(48870),i=r(27798)},97563:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=o,t.updateLocalAndModel=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(7293),s=r(90981);function o(e,t){return a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(0,s.getTable)().merge(e.toString(),t).catch((e=>{throw __LOG__(4,!0,new Error,!0)`updateLocal: failed to update in storage`,SEND_LOGS("message updateLocal failed"),e})):Promise.resolve()}function l(){return(l=(0,i.default)((function*(e,t){try{yield o(e,t);const n=r(59871).MsgCollection.get(e);n&&n.set(t)}catch(e){return Promise.reject(new Error(`[messaging] updateLocalAndModel: failed with error ${e}`))}}))).apply(this,arguments)}},25680:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getHighestAck=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(69618)),s=r(7293),o=r(17972);const{ACK:l}=a.default;function c(){return(c=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const t=yield o.MsgInfoCollection.find(e.id);if(!t)return __LOG__(2)`getHighestAck: no orphan ack found for ${e.id}`,null;let r=null,n=null;return 0===t.playedRemaining&&0!==t.played.length?(n=l.PLAYED,r=t.played):0===t.readRemaining&&0!==t.read.length?(n=l.READ,r=t.read):0===t.deliveryRemaining&&0!==t.delivery.length&&(n=l.RECEIVED,r=t.delivery),null==n||null==r?(__LOG__(2)`getHighestAck: orphan ack has 0 receipt for ${e.id}`,null):(__LOG__(2)`getHighestAck: orphan ack ${n} for ${e.id}`,{ack:n,t:Math.max(...r.map((e=>e.t))),to:e.to,from:e.from,deliveryPrivacyMode:t.deliveryPrivacyMode})}return Promise.reject(new Error("getHighestAck: not supported for non MD"))}))).apply(this,arguments)}},76581:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgFindByIds=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.getMsgsByMsgKey)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`msgFindByIds: failed to find msg in storage`,SEND_LOGS("msgFindByIdsMD failed"),e}));return Promise.resolve([])},t.msgFindQuery=function(e,t,r,n){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.msgFindQuery)(e,t).catch((e=>{throw __LOG__(4,!0,new Error,!0)`msgFindQuery: failed to find msg in storage`,SEND_LOGS("msgFindQueryMD failed"),e}));return s.default.msgFindQuery(e,t,r,n)},t.queryVcard=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,a.queryVcard)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`queryVcard: failed to find vCard in storage`,SEND_LOGS("queryVcardMD failed"),e}));return s.default.queryVcard(e)};var i=r(7293),a=r(84886),s=n(r(56891))},28259:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMsgInfo=function(){return u.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=n(r(69618)),o=r(7293),l=r(47124),c=n(r(56891)),d=r(77591);function u(){return(u=(0,a.default)((function*(e){let t;const{id:r}=e;o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(t=(0,l.queryMsgInfo)(e.id).catch((e=>{throw __LOG__(4,!0,new Error,!0)`sendQueryMsgInfo: failed to find msg info in storage`,SEND_LOGS("queryMsgInfo failed"),e})),t||(t=Promise.reject(new Error("Should not reach here")))):t=c.default.queryMsgInfo(r).then((e=>{if(e.status>=400)throw __LOG__(2)`model:MsgInfo:findQuery error ${e.status}`,new d.ServerStatusCodeError(e.status);return e}));const n=yield t;return(0,i.default)((0,i.default)({},n),{},{id:r,usePlayReceipt:e.type===s.default.MSG_TYPE.PTT||e.isViewOnce})}))).apply(this,arguments)}},7992:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterPresence=function(){n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(0,i.sendDeliveryReceiptsAfterPresence)()};var n=r(7293),i=r(16927)},90298:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageSendMetric=h,t.logSuccessfulMessageSend=f,t.sendMsgRecord=function(e){let t=Promise.resolve();if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const n=h(e);let i;e.isForwarded&&(i=function(e){const t={messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:Boolean(e.caption),fastForwardEnabled:!0,messageIsFanout:!0,isFrequentlyForwarded:Boolean(e.isFrequentlyForwarded)};null!=e.ephemeralDuration&&(t.ephemeralityDuration=e.ephemeralDuration);if(!e.isGroupMsg){const n=(0,s.getMaybeMeUser)(),i=r(242).getDisappearingModeSettingForUser,a=i(n);null!=a&&(t.senderDefaultDisappearingDuration=a.duration);const o=i(e.to);null!=o&&(t.receiverDefaultDisappearingDuration=o.duration)}const n=e.getWamDisappearingModeInitiator();null!=n&&(t.disappearingChatInitiator=n);return new l.default.ForwardSend(t)}(e));const{encryptAndSendMsg:a}=r(95547);t=a(e).catch((t=>{throw __LOG__(3,void 0,void 0,void 0,["messaging"])`sendMsgRecord: MD send failure, msg: ${e.id.toString()}`,(0,d.updateLocalAndModel)(e.id,{isSendFailure:!0}),t})).then((t=>(null!=t.deviceCount&&(n.deviceSizeBucket=(0,c.default)(t.deviceCount)),f(n,e.id),i&&_(i),{t:parseInt(t.t,10),data:null})))}else t=u.default.msgCreateRecord(e).then((e=>{if(200!==e.status)throw new p.ServerStatusCodeError(e.status);return e}));return t};var i=r(92844),a=r(16116),s=r(99234),o=r(7293),l=n(r(11339)),c=n(r(16786)),d=r(97563),u=n(r(56891)),p=r(77591);function h(e){const t={messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:Boolean(e.caption),fastForwardEnabled:!0,messageIsFanout:!0,messageIsForward:Boolean(e.isForwarded)};if(null!=e.ephemeralDuration&&(t.ephemeralityDuration=e.ephemeralDuration),!e.isGroupMsg){const n=(0,s.getMaybeMeUser)(),i=r(242).getDisappearingModeSettingForUser,a=i(n);null!=a&&(t.senderDefaultDisappearingDuration=a.duration);const o=i(e.to);null!=o&&(t.receiverDefaultDisappearingDuration=o.duration)}const n=e.getWamDisappearingModeInitiator();return null!=n&&(t.disappearingChatInitiator=n),new l.default.MessageSend(t)}function f(e,t){e.messageSendResult=l.default.MESSAGE_SEND_RESULT_TYPE.OK,e.messageSendResultIsTerminal=!1,_(e),(0,a.handleMessagesForChatThreadLogging)([{chatId:t.remote.toString({legacy:!0}),fromMe:!0,ts:(0,i.unixTime)()}])}function _(e){e.markMessageSendT(),e.commit()}},1985:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.setPresenceAvailable=function(){o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(0,l.default)("available"):d.default.sendPresenceAvailable().catch((0,a.filteredCatch)([u.WebdDrop,s.ProtoVersionUndefined],(()=>{})))},t.setPresenceUnavailable=function(){o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(0,l.default)("unavailable"):d.default.sendPresenceUnavailable().catch((0,a.filteredCatch)([u.WebdDrop,s.ProtoVersionUndefined],(()=>{})))},t.subscribePresence=function(e,t){let r;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){let n;n=e instanceof p.default?e:(0,h.createWid)(e),r=Promise.resolve((0,c.default)(n,t)),r||(r=Promise.reject(new Error("md:subscribePresence: not supported when not build with MD_BACKEND")))}else r=d.default.subscribePresence(e);return r};var a=r(50796),s=i(r(64103)),o=r(7293),l=n(r(93167)),c=n(r(34083)),d=n(r(56891)),u=r(77591),p=n(r(39546)),h=r(58021)},5018:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.profilePicFind=v,t.profilePicFindThumbFromPhone=function(){return S.apply(this,arguments)},t.profilePicResync=function(){return A.apply(this,arguments)},t.requestDeletePicture=function(){return y.apply(this,arguments)},t.sendSetPicture=function(){return E.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(15688),o=n(r(45095)),l=r(94943),c=r(7293),d=r(76214),u=r(46328),p=r(17117),h=n(r(66612)),f=r(99069),_=r(2541),m=n(r(56891)),g=r(77591);function y(){return(y=(0,a.default)((function*(e){let t;c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(t=(0,h.default)(e,null).then((()=>({_duplicate:!1,status:200}))),t||(t=Promise.reject(new Error("Should not reach here")))):t=m.default.deletePicture(e).then((e=>{if(e.status&&200!==e.status)throw new g.ServerStatusCodeError(e.status);return e}));const n=yield t;return n._duplicate?n:c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(0,d.getProfilePicThumbTable)().remove(e.toString()).then((()=>{(0,r(37638).changeProfilePicThumb)(e,u.PROFILE_PIC_COMMAND.REMOVE)})).then((()=>n)):n}))).apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,n){let i;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=_.URL.parseDataURL(n).data,r=(0,s.decodeB64)(t);i=(0,h.default)(e,r).then((0,a.default)((function*(){const t=yield(0,l.getProfilePicFull)(e);return{_duplicate:!1,tag:t.tag,eurl:t.eurl,token:"",status:200}}))),i||(i=Promise.reject(new Error("Should not reach here")))}else i=m.default.sendSetPicture(e,t,n).then((e=>{if(200!==e.status)throw new g.ServerStatusCodeError(e.status);return e}));const o=yield i,p=yield C(e);if(o.token=p,o._duplicate)return o;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const t=e.toString();return(0,d.getProfilePicThumbTable)().createOrMerge(t,{id:t,tag:o.tag,eurl:o.eurl}).then((()=>{(0,r(37638).changeProfilePicThumb)(e,u.PROFILE_PIC_COMMAND.SET)})).then((()=>o))}return o}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t){const r=yield m.default.profilePicFindThumbFromPhone(e,t),n=yield C(e);if(r.token=n,c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const e=r.id.toString();return(0,d.getProfilePicThumbTable)().createOrMerge(e,{id:e,tag:r.tag,raw:r.raw}).then((()=>r))}return r}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e){let t;c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(t=Promise.all([(0,l.getProfilePicFull)(e),(0,l.getProfilePicPreview)(e)]).then((e=>{const t=e[0],r=e[1];return{tag:t.tag,eurl:t.eurl,previewEurl:r.eurl,token:""}})),t||(t=Promise.reject(new Error("Should not reach here")))):t=m.default.profilePicFind(e).then((e=>{if(null!=e.status&&200!==e.status)throw new g.ServerStatusCodeError(e.status);return e}));const r=t=>(0,f.getStorage)().lock(["profile-pic-thumb"],function(){var r=(0,a.default)((function*(r){let[n]=r;return(yield n.get(e.toString()))?n.merge(e.toString(),t):n.create(t)}));return function(){return r.apply(this,arguments)}}()),n={id:e.toString(),tag:void 0,eurl:void 0,raw:void 0,previewEurl:void 0};try{const i=yield(0,o.default)(t,"serverPromise");return C(e).then((e=>(i.token=e,c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(n.tag=i.tag,n.eurl=i.eurl,n.raw=null,n.previewEurl=i.previewEurl,r(n).then((()=>i))):i)))}catch(e){if(!(e instanceof g.ServerStatusCodeError))throw e;if(!c.GK.supportsFeature(c.GK.F.MD_BACKEND))throw e;return c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&404===e.status||!c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&401===e.status?(n.tag="",n.raw=null):(n.tag=null,n.eurl=null,n.previewEurl=null),r(n).then((()=>{throw e}))}}))).apply(this,arguments)}function A(){return(A=(0,a.default)((function*(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{const t=yield v(e.id);return{id:e.id,eurl:t.eurl,tag:t.tag,token:t.token,previewEurl:t.previewEurl}}catch(t){if(t instanceof g.ServerStatusCodeError)switch(t.status){case 401:case 404:return{id:e.id,tag:"",token:""};default:return __LOG__(3)`ProfilePicThumb:resyncPictures error - ${t.status}, ${t.message}`,{id:e.id,token:""}}throw t}}));return function(){return e.apply(this,arguments)}}()));const t=yield m.default.resyncPictures(e);return Array.isArray(t)?Promise.all(t.map(function(){var e=(0,a.default)((function*(e){const t=yield C(e.id);return(0,i.default)((0,i.default)({},e),{},{token:t})}));return function(){return e.apply(this,arguments)}}())):"number"==typeof t.status&&t.status>=400?(423!==t.status&&429!==t.status&&__LOG__(3)`ProfilePicThumbStore:resyncPictures error ${t.status}`,Promise.reject(new g.ServerStatusCodeError(t.status))):(__LOG__(3)`ProfilePicThumbStore:resyncPictures unknown reply`,Promise.reject(new Error("ProfilePicThumbStore:resyncPictures unknown reply")))}))).apply(this,arguments)}function C(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return Promise.resolve("");{const t=String(e),r=new ArrayBuffer(2*t.length),n=new Uint16Array(r);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return Promise.resolve().then((()=>(0,p.getSecurityToken)(r)))}}},69722:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=`+${e.toString()}`;let r;if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))return Promise.all([l.default.queryExist(t),(0,s.isDisappearingModeEnabled)()?l.default.queryDisappearingMode(e):Promise.resolve()]).then((e=>{let[t,r]=e,n=null;if(200===t.status&&(n={wid:t.jid,biz:t.biz||!1}),null!=n&&null!=r&&200===r.status){const e=r.duration,t=r.settingTimestamp;n=(0,i.default)({disappearingMode:{duration:e,settingTimestamp:t}},n)}return n}));r=(0,o.queryExist)(t),r||(r=Promise.reject(new Error("Should not reach queryExists MD")));return r};var i=n(r(81109)),a=r(7293),s=r(10435),o=r(71820),l=n(r(56891))},80469:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMediaConn=function(e){return(0,o.backoff)({delay:e=>{let{taskDuration:t}=e;const r=1e3*p();return Math.max(r-t,0)},signal:e},function(){var t=(0,a.default)((function*(t){let r;if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){if(r=(0,c.queryMediaConn)(e),!r)return Promise.reject(new Error("sendQueryMediaConn: not supported when not build with MD_BACKEND"))}else r=d.default.queryMediaConnections(e);try{const e=yield r;let{ttl:t,authTTL:n}=e;return null==n?(n=1e3*t,t=3e5):(n*=1e3,t*=1e3),(0,i.default)((0,i.default)({},e),{},{authTTL:n,ttl:t})}catch(e){if(e instanceof u.E507)throw e;if(e instanceof u.ServerStatusCodeError&&e.status>=500)return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())};var i=n(r(81109)),a=n(r(48926)),s=r(37178),o=r(77712),l=r(7293),c=r(78518),d=n(r(56891)),u=r(77591);const p=(0,s.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:9e5,jitter:.25})},8369:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){let e;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(e=(0,a.default)().then((e=>{if(e.success)return e.result;throw new o.ServerStatusCodeError(e.errorCode,e.errorText)})),e||(e=Promise.reject(new Error("Should not reach here")))):e=s.default.queryServerProps();return e};var i=r(7293),a=n(r(66501)),s=n(r(56891)),o=r(77591)},2223:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateQuickReply=function(e){let t=Promise.resolve();if(n.GK.supportsFeature(n.GK.F.MD_BACKEND)){const{id:r,shortcut:n,count:a,message:s,keywords:o}=e;t=(0,i.getQuickReplyTable)().createOrReplace({id:r,shortcut:n,count:a,message:s,keywords:o})}return t};var n=r(7293),i=r(76214)},75250:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryReactions=function(){return u.apply(this,arguments)},t.updateHasReactionInParent=d;var i=n(r(81109)),a=n(r(48926)),s=r(7293),o=n(r(32219)),l=r(63374),c=r(97563);function d(e,t){const n=r(59871).MsgCollection.get(e);return n&&n.hasReaction!==t?(0,c.updateLocalAndModel)(n.id,{hasReaction:t}):Promise.resolve()}function u(){return(u=(0,a.default)((function*(e){let t;s.GK.supportsFeature(s.GK.F.MD_BACKEND)?(t=(0,l.getReactions)(e.id.toString()).catch((e=>{throw __LOG__(4,!0,new Error,!0)`getReactions: failed to find msg info in storage`,SEND_LOGS("getReactions failed"),e})),t||(t=Promise.reject(new Error("Should not reach here")))):t=Promise.reject(new Error("Not supported in non MD"));const r=yield t,n=r.reactions.map((e=>{const t=e.senders.map((e=>(0,i.default)((0,i.default)({},e),{},{id:o.default.fromString(e.msgKey)})));return(0,i.default)((0,i.default)({},e),{},{hasReactionByMe:e.hasReactionByMe,id:e.aggregateEmoji,senders:t})})),a=n.length>0;return yield d(e.id.toString(),a),(0,i.default)((0,i.default)({},r),{},{id:e.id,reactions:n})}))).apply(this,arguments)}},25224:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(7293),s=r(16258),o=r(3151),l=n(r(56891));function c(e){if(null!=e)switch(e){case s.MediaRetryNotificationResultType.SUCCESS:return 200;case s.MediaRetryNotificationResultType.NOT_FOUND:case s.MediaRetryNotificationResultType.DECRYPTION_ERROR:return 404;case s.MediaRetryNotificationResultType.GENERAL_ERROR:return 500}return 500}function d(){return(d=(0,i.default)((function*(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return o.RequestMediaReuploadManager.requestMediaReupload(e).then((e=>{let{result:t,directPath:r}=e;return{status:c(t),directPath:r,isMD:!0}}));const{status:t,url:r,mediaKey:n,mediaKeyTimestamp:i,encFilehash:s,directPath:d}=yield l.default.requestMediaReupload(e);return{isMD:!1,status:t,url:r,mediaKey:n,mediaKeyTimestamp:i,encFilehash:s,directPath:d}}))).apply(this,arguments)}},85195:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);t.Z=function(e,t){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))return function(e,t){const r=new Uint8Array((0,s.decodeB64)(e)),n=(0,c.unixTime)();return E(t,function(){var e=(0,a.default)((function*(e){const i=yield(0,g.default)(r,n);if(null==i?void 0:i.errorCode){if(i.errorCode>=500)throw new y.ServerStatusCodeError(i.errorCode,i.errorText);e(t)}e(void 0)}));return function(){return e.apply(this,arguments)}}())}(e,t);return function(e,t){const r=new FormData;r.append("t",String((0,c.unixTime)())),r.append("v",u.default.VERSION_BASE);const n=(0,h.getLoginTokens)().server;n&&r.append("tok",n);return r.append("buffer",e),E(t,function(){var e=(0,a.default)((function*(e){const n=yield(0,p.default)(u.default.WAM_URL,{method:"POST",body:r});if(200===n.status)e(void 0);else{if(n.status>=500)throw new y.ServerStatusCodeError(n.status);e(t)}}));return function(){return e.apply(this,arguments)}}())}(e,t)};var a=i(r(48926)),s=r(15688),o=r(13959),l=r(4352),c=r(92844),d=i(r(70714)),u=i(r(69618)),p=i(r(18561)),h=r(99234),f=r(7293),_=i(r(57220)),m=n(r(22906)),g=i(r(13176)),y=r(77591);function E(e,t){return(0,l.promiseLoop)(function(){var r=(0,a.default)((function*(r,n,i){const a=(0,o.delayMs)(m.expBackoff(i,12e4,1e3,.1));try{return yield _.default.waitIfOffline({signal:(new d.default).signal}),yield t(r)}catch(t){return i>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,r(e)):a}}));return function(){return r.apply(this,arguments)}}())}},24569:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);t.Z=function(e,t){if(!(0,d.getABPropConfigValue)("web_ps_v3_enabled"))return Promise.resolve(t);const r=new Uint8Array((0,s.decodeB64)(e));return n=t,i=function(){var e=(0,a.default)((function*(e){const{uploadedBufferKeys:n,metrics:i}=yield(0,c.upload_UNSAFE_INTERNAL_DO_NOT_USE)([{key:t,content:r}],p.getToken);i.map(m),0===n.length&&e(t),e(void 0)}));return function(){return e.apply(this,arguments)}}(),(0,l.promiseLoop)(function(){var e=(0,a.default)((function*(e,t,r){const a=(0,o.delayMs)(_.expBackoff(r,12e4,1e3,.1));try{return yield f.default.waitIfOffline({signal:(new u.default).signal}),yield i(e)}catch(t){return r>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,e(n)):a}}));return function(){return e.apply(this,arguments)}}());var n,i};var a=i(r(48926)),s=r(15688),o=r(13959),l=r(4352),c=r(14604),d=r(86945),u=i(r(70714)),p=r(35065),h=i(r(11339)),f=i(r(57220)),_=n(r(22906));function m(e){const{result:t,uploadTime:r,httpResponseCode:n}=e,i=function(e){switch(e){case"success":return h.default.PS_BUFFER_UPLOAD_RESULT.SUCCESS;case"error-server-other":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_SERVER_OTHER;case"error-parsing":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_PARSING;case"error-decoding":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_DECODING;case"error-credential":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_CREDENTIAL;case"error-other":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_OTHER;default:return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_ACCESS_TOKEN}}(t);new h.default.PsBufferUpload({psBufferUploadResult:i,psBufferUploadT:r,psBufferUploadHttpResponseCode:n,applicationState:"visible"===document.visibilityState?h.default.APPLICATION_STATE.FOREGROUND:h.default.APPLICATION_STATE.BACKGROUND}).commit()}},51316:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(e){let t;o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(t=(0,s.default)(e).then((e=>e.error?(__LOG__(3)`getStatus: failed ${e.error.errorCode} : ${e.error.errorText}`,{id:e.id,stale:!0,status:""}):{id:e.id,status:null!=e.status?e.status:""})),t||(t=Promise.reject(new Error("getAbout: invalid when build with MD_BACKEND")))):t=u.default.statusFind(e).then((t=>({id:e,status:null!=t.status?t.status:""}))).catch((0,a.filteredCatch)(p.WebdDrop,(()=>({id:e,stale:!0,status:""}))));return t},t.queryStatusAll=function(){let e=Promise.resolve();e=o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(0,d.queryStatusAllMD)():u.default.statusQuery();return e},t.queryStatusUpdate=function(e,t,r){let n=Promise.resolve();if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return Promise.resolve([]);n=u.default.statusQuery(e,t,r,"after");return n},t.sendReadStatus=function(){return h.apply(this,arguments)},t.setMyStatus=function(e){let t;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const n=r(68819).getJobManager;t=n().waitUntilCompleted(l.jobSerializers.setAbout(e)),t||(t=Promise.reject(new Error("setStatus: invalid when build with MD_BACKEND")))}else t=u.default.sendSetStatus(e);return t};var i=n(r(48926)),a=r(50796),s=n(r(66457)),o=r(7293),l=r(6684),c=r(35099),d=r(6331),u=n(r(56891)),p=r(77591);function h(){return(h=(0,i.default)((function*(e,t,r){let n;if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){if(yield(0,c.markStatusRead)(e,r),n=!0,null==n)throw new Error("sendReadStatus: shouldn't reach here (md_backend was disabled)!")}else{n=200===(yield u.default.sendStatusSeen(e,t)).status}return n}))).apply(this,arguments)}},92486:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceiptBridge=function(e){let t;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const n=r(77723).Z;t=n(e),t||(t=Promise.reject(new Error("Should not reach here")))}else t=Promise.resolve(e);return t},t.sendCallEndBridge=function(e,t){let r;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(r=Promise.resolve({}),r||(r=Promise.reject(new Error("Should not reach here")))):r=s.default.sendCallEnd(e,t);return r},t.sendCallOfferBridge=function(e){let t;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const n=r(26775).Z;t=n(e,a.TYPE.OFFER),t||(t=Promise.reject(new Error("Should not reach here")))}else t=e.payload[2].find((e=>"enc"===e[0]))?s.default.sendCallOffer(e):s.default.sendGroupCallOffer(e);return t},t.sendCallSignalingMsgBridge=function(e,t){let n;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const t=r(25662).Z;n=t(e),n||(n=Promise.reject(new Error("Should not reach here")))}else n=s.default.sendCallSignalingMsg(e,t);return n},t.sendEncRekeyBridge=function(e){let t;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const n=r(26775).Z;t=n(e,a.TYPE.ENC_REKEY),t||(t=Promise.reject(new Error("Should not reach here")))}else t=s.default.sendCallSignalingMsg(e);return t},t.sendQueryCallBridge=function(e,t){let r;i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(r=Promise.resolve({status:200}),r||(r=Promise.reject(new Error("Should not reach here")))):r=s.default.queryCall(e,t);return r};var i=r(7293),a=r(45473),s=n(r(56891))},15183:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),a=t.blocklist.map((e=>({id:e}))),s=r(32826).BlocklistCollection;n.GK.supportsFeature(n.GK.F.MD_BACKEND)?(0,i.getBlocklistTable)().clear().then((()=>Promise.all(a.map((e=>{let{id:t}=e;return(0,i.getBlocklistTable)().create({id:t.toString()})}))))).then((()=>s.set(a))):s.set(a)};var n=r(7293),i=r(76214)},70257:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),n=r(69951).ChatCollection,I=r(59871).MsgCollection;if(Array.isArray(t)){const e=[],o=[],l=[],d=[];t.forEach((function(t){if("c.us"===t.id)o.push(t);else{const r=!!n.get(t.id),i=["delete","clear","ephemeral","archive","unarchive","star","unstar","spam","modify_tag","pin","modify"].includes(t.type);i?r&&i?o.push(t):__LOG__(2)`Model:chat:handle received junk chat record: ${JSON.stringify(t)}`:e.push(t)}}));const u=e.find((e=>P.default.isPSA(e.id)));null!=u&&(u.name=T.default.t(1922));const p=r(19011).AllStarredMsgsCollection;let h;return o.forEach((function(e){const t=e.type;if("c.us"===e.id.toString()){switch(n.disableSortListener(),t){case"clear":__LOG__(2)`Model:chat:handle:clear:all before:${String(e.before)} kind:${String(e.kind)}`,n.forEach((function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)}));break;case"delete":__LOG__(2)`Model:chat:handle:delete:all`,n.toArray().forEach((function(e){e.isGroup?e.deleteMsgs(!0):l.push(e)}));break;case"archive":__LOG__(2)`Model:chat:handle:archive:all`,n.forEach((function(e){d.push({id:e.id,archive:!0,pin:void 0})}));break;case"unarchive":__LOG__(2)`Model:chat:handle:unarchive:all`,n.forEach((function(e){d.push({id:e.id,archive:!1})}));break;case"unstar":__LOG__(2)`Model:chat:handle:unstar:all`,p.delete(),n.forEach((function(e){e.unstarAll()}));break;default:__LOG__(3)`Model:chat:handle unknown ${JSON.stringify(e)}`}n.enableSortListener()}else{const r=n.get(e.id);if(!r)return;switch(t){case"ephemeral":if(null!=e.t){const t=r.getLastReceivedNonExpiredMsg(e.t);t&&(0,A.setLastReceivedKey)(r.id,t.id).then((()=>{r.lastReceivedKey=t.id}))}break;case"clear":case"star":case"unstar":if(e.keys){const r=e.keys.length,n="star"===t,i=[],a=[],s=[];let o=!1;for(let l=0;l<r;l++){let r,d,u,p,h;const f=e.keys[l];Array.isArray(f)?([r,d,u]=f,p=new C.default({fromMe:d,remote:e.id,id:r,participant:u}),h=I.get(p),h?"clear"===t?h.delete():(h.star=n,s.push(h)):n&&(o=!0)):!(0,c.default)(f)||"star"!==t&&"unstar"!==t||(p=f.id,h=I.get(f.id),h?(h.star=n,s.push(h)):a.push(f)),i.push(p&&p.toString())}"star"!==t&&"unstar"!==t||p.process(n,a,s,o),__LOG__(2)`model:Chat:handle:messages:${[t,e.id,i.join(),e.modifyTag].join()}`}else"clear"===t?("number"==typeof e.before?r.deleteMsgsOlderThan(e.before,e.star,e.kind):r.deleteMsgs(e.star,e.kind),__LOG__(2)`model:Chat:handle cleared chat:${[e.id,e.before,e.modifyTag,e.kind].join()}`):"unstar"===t&&(r.unstarAll(),__LOG__(2)`model:Chat:handle unstarred chat: ${e.id}`);isNaN(e.modifyTag)||d.push({id:e.id,modifyTag:e.modifyTag});break;case"delete":l.push(r),__LOG__(2)`model:Chat:handle deleted chat for ${String(e.id)}`;break;case"archive":d.push({id:e.id,archive:!0,pin:void 0});break;case"unarchive":d.push({id:e.id,archive:!1});break;case"spam":d.push({id:e.id,notSpam:e.notSpam});break;case"modify_tag":d.push({id:e.id,modifyTag:e.modifyTag});break;case"pin":d.push({id:e.id,pin:e.pin});break;case"modify":d.push({id:e.id,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid})}}})),h=g.GK.supportsFeature(g.GK.F.MD_BACKEND)?(0,b.getStorage)().lock(["chat"],function(){var t=(0,s.default)((function*(t){let[r]=t;try{return yield r.bulkCreateOrMerge(e.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString()})))),yield Promise.all(d.map((e=>{const{id:t}=e,n=(0,i.default)(e,M);r.merge(t.toString(),n)}))),r.bulkRemove(l.map((e=>e.id.toString())))}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ChatHandler: bulk handle error")}}));return function(){return t.apply(this,arguments)}}()):Promise.resolve(),h.then((()=>{n.add(e,{merge:!0}),d.forEach((e=>{const{id:t}=e,r=(0,i.default)(e,O),a=n.get(t);a&&a.set(r)})),l.forEach((e=>e.delete()))}))}if("leave"===t.cmd)t.gids.forEach((function(e){const t=n.get(e);t&&(0,_.localExitGroup)(t)}));else{if("preempt"===t.cmd){let e=Promise.resolve();g.GK.supportsFeature(g.GK.F.MD_BACKEND)&&(e=(0,d.getTable)().bulkCreateOrMerge(t.response.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString(),muteExpiration:0})))));const r=(0,y.getBridge)();return e.then((()=>r.sendAndReceive("chat_collection","add",{things:t.response,options:{merge:!0}}))).then((()=>{p.Conn.platform!==p.PLATFORMS.IPHONE&&p.Conn.platform!==p.PLATFORMS.SMBI||((0,l.default)(t.response)?r.fireAndForget("msg_collection","trigger",{name:h.default.COLLECTION_HAS_SYNCED}):setTimeout((()=>{r.fireAndForget("msg_collection","trigger",{name:h.default.COLLECTION_HAS_SYNCED})}),2500)),r.fireAndForget("chat_collection","trigger",{name:h.default.COLLECTION_HAS_SYNCED,args:{count:t.response.length,binarySize:t.binarySize}})}))}if("action"===t.cmd){const e=t.id,r=t.data;if("create"!==r[0]&&"introduce"!==r[0]){if(r.length<3)return void __LOG__(3)`model:chat: incorrect length of payload data for action ${JSON.stringify(t)}`;const e=t.data[0],n="unknown"===t.data[1]?null:t.data[1];let i;return i=e===E.GROUP_ACTIONS.RESTRICT||e===E.GROUP_ACTIONS.ANNOUNCE||e===E.GROUP_ACTIONS.NO_FORWARD?{action:e,value:t.data[2]}:e===E.GROUP_ACTIONS.EPHEMERAL?{action:e,duration:t.data[2]}:(0,a.default)({action:e},t.data[2]),(0,v.handleGroupActionWap)({chatId:t.id,author:n},i)}{const t=r[1],i=r[2],a=[...(0,o.default)(i.admins,(e=>({id:e,isAdmin:!0}))),...(0,o.default)(i.superadmins||[],(e=>({id:e,isAdmin:!0,isSuperAdmin:!0}))),...(0,o.default)(i.regulars,(e=>({id:e,isAdmin:!1})))];S.default.add({id:e,creation:i.creation,owner:t,participants:a,stale:!1,desc:i.desc,descId:i.descId,descTime:i.descTime,descOwner:i.descOwner,restrict:!!i.restrict,announce:!!i.announce},{merge:!0}),f.ContactCollection.add({id:e,name:i.subject},{merge:!0});const s=n.get(e);if(!s)return;const l=s.msgs.last();if(!l)return;if("gp2"===l.type&&"add"===l.subtype){const t=(0,m.getMaybeMeUser)();S.default.trigger(`group_participant_change_${t.toString()}`,e),P.default.equals(l.recipients[0],t)&&u.Cmd.alertNewMsg(l)}}}else __LOG__(3)`model:chat: unknown payload: ${JSON.stringify(t)}`}};var i=n(r(6479)),a=n(r(81109)),s=n(r(48926)),o=n(r(35161)),l=n(r(41609)),c=n(r(13218)),d=r(68638),u=r(88102),p=r(17239),h=n(r(69618)),f=r(19380),_=r(5501),m=r(99234),g=r(7293),y=r(41796),E=r(36098),S=n(r(63928)),v=r(34648),T=n(r(43725)),A=r(11902),C=n(r(32219)),b=r(99069),P=n(r(39546));const M=["id"],O=["id"]},32720:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();switch(t.type){case"picture":(0,i.changeProfilePicThumb)(t.jid,t.tag);break;default:(0,n.handle)([t])}return Promise.resolve()};var n=r(98423),i=r(37638)},66405:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t;const n=e.shift();n.id="1";const i=r(56891).default,{protoVersion:p,binVersion:h,features:f}=n;if(p){c.GK.setVersion(p);const e=c.GK.setFeatures(f);t=!!e.KEY_PARTICIPANT,i.setVersion(p,h,null==f?void 0:f.FLAGS)}if(n.initial){c.GK.setPlatform(n.platform),(0,l.setLogoutToken)(n.browserToken),n.hasOwnProperty("is24h")&&s.Clock.setIs24Hour(n.is24h);const e=n.ref,t=n.serverToken,r=n.clientToken,a=n.connected;e&&a&&t&&(0,l.setRefTok)(e,t),(0,l.setLoginTokens)({client:r,server:t});const p=n.secret?i.setSharedSecret(n.secret):Promise.resolve();return Promise.all([(0,d.requireContactCollection)(),p]).then((e=>{let[t]=e;if("true"!==n.isResponse&&u.save(),n.wid){const e=n.wid;(0,l.setMe)(e),o.Conn.trigger("me_ready"),n.pushname&&(o.Conn.pushname=n.pushname,(0,l.setPushname)(n.pushname)),t.gadd(e)}o.Conn.set(n)}))}return o.Conn.connected&&t&&(__LOG__(2)`models:Conn:participantChange:to:${String(c.GK.supportsFeature(c.GK.F.KEY_PARTICIPANT))}`,a.default.hardRefresh()),o.Conn.set(n),Promise.resolve()};var a=i(r(87045)),s=r(22683),o=r(17239),l=r(99234),c=r(7293),d=r(46582),u=n(r(17117))},78496:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();if(Array.isArray(t)){const r=e.shift();!function(e,t){const r=t&&"remove"===t.missing?(0,l.getContactsToRemove)(e):[];(0,c.mungePSAContact)(e),a.ContactCollection.add(e,{merge:!0}),r.forEach((e=>{e.unset("name"),e.unset("shortName")})),(null==t?void 0:t.checksum)&&(a.ContactCollection.setChecksum(t.checksum),__LOG__(2)`handle:Contact update checksum ${t.checksum}`);__LOG__(2)`handle:Contact updated ${e.map((e=>e.id)).join()}`}(t,r)}else"preempt"===t.cmd?function(e){(0,c.mungePSAContact)(e.response),a.ContactCollection.add(e.response,{merge:!0}),e.checksum&&(a.ContactCollection.setChecksum(e.checksum),__LOG__(2)`Store:Contact:handle update checksum ${e.checksum}`);a.ContactCollection.trigger(i.default.COLLECTION_HAS_SYNCED,{count:e.response.length,binarySize:e.binarySize})}(t):"frequent"===t.type?function(e){let t;delete e.type,t=o.GK.supportsFeature(o.GK.F.MD_BACKEND)?(0,s.setFrequent)(e):Promise.resolve();t.then((()=>{a.ContactCollection.updateFrequentContacts(e)}))}(t):"sidelist"===t.type?function(e){const{notification:t,action:r,hash:n}=e,i=a.ContactCollection.resolveWidsFromHash(n);if(!i)return;"business"===t&&"profile"===r&&i.forEach((e=>{const t=a.ContactCollection.get(e);if(t)t.businessProfile&&t.businessProfile.markStale();else{const e=a.ContactCollection.getUserCount(),t=a.ContactCollection.contactHashLength();__LOG__(4,void 0,new Error,!0)`Hash: ${n} Users: ${e}, Hashes: ${t}`,SEND_LOGS("Stale wid in contact hash index")}}))}(t):__LOG__(3)`handle:Contact unknown: ${JSON.stringify(t)}`};var i=n(r(69618)),a=r(19380),s=r(8071),o=r(7293),l=r(88129),c=r(76285)},67938:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!Array.isArray(e))return __LOG__(4,void 0,new Error,!0)`ws2: Invalid message, not an array`,void SEND_LOGS("ws2:invalid-msg");const t=e.shift();switch(t){case"Blocklist":return void(0,i.default)(e);case"Contact":return void(0,l.default)(e);case"Props":case"ServerProps":return void r(64551).ServerProps.handle(e);case"Location":case"LiveLocation":return void r(85865).LiveLocationCollection.handle(e);case"Chat":return void(0,a.default)(e);case"Msg":return void(0,c.default)(e);case"Stream":return void(0,p.default)(e);case"Conn":return void(0,o.default)(e);case"Cmd":return void(0,s.default)(e);case"Presence":return void(0,u.default)(e);case"MsgInfo":return void(0,d.default)(e);case"BusinessProfile":return void r(93581).BusinessProfileCollection.handle(e);case"GroupMetadata":return void r(63928).default.handle(e);case"Label":return void r(16770).LabelCollection.handle(e);case"QuickReply":return void r(99662).QuickReplyCollection.handle(e);case"Call":return void r(31218).CallCollection.handle(e);case"Mute":return void r(72472).MuteCollection.handle(e);case"Status":return void r(46133).StatusCollection.handle(e);case"StatusV3":return void r(59387).StatusV3Collection.handle(e);default:__LOG__(4,void 0,new Error,!0)`ws2: Invalid type received: ${t}`,SEND_LOGS("ws2: Invalid type received")}};var i=n(r(15183)),a=n(r(70257)),s=n(r(32720)),o=n(r(66405)),l=n(r(78496)),c=n(r(26453)),d=n(r(74609)),u=n(r(82805)),p=n(r(80169))},26453:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let[t]=e;const n=r(59871).MsgCollection;function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,r){let i;i=f.default.isStatusV3(t.broadcast)?new p.default({from:t.from,to:t.broadcast,id:r,selfDir:t.self||"out"}):new p.default({from:t.from,to:e,id:r,participant:t.participant,selfDir:t.self||"out"});const a=n.get(i);a?yield(0,o.updateMsgAck)(a,t.broadcast,{from:t.from,to:e,ack:t.ack,t:t.t}):(__LOG__(2)`Msg:out of order ack`,n.preAck[i]=t)}))).apply(this,arguments)}if("ack"===t.cmd){const e=[t.to];if(f.default.isBroadcast(t.to)&&t.ack===d.default.ACK.SENT){const r=u.default.get(t.to);r&&Array.prototype.push.apply(e,(0,a.default)(r.participants.toArray(),"id"))}const r=e.map((e=>m(e,t.id)));return Promise.all(r)}if("acks"===t.cmd){const e=t.id.map((e=>m(t.to,e)));return Promise.all(e)}if(t.msg){if(!(t.chat instanceof f.default))return Promise.resolve();const e="update"===t.meta.add;return f.default.isStatusV3(t.chat)&&!r(59387).StatusV3Collection.handleUpdate(t.msg,t.meta.checksum,e)?Promise.resolve():(t.msg.recvFresh=!0,t.msg.isNewMsg=!0,n.processMultipleMessages(t.chat,[t.msg],{add:"after",update:e,isHistory:!1}).catch((0,s.filteredCatch)(h.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Msg: ${String(t.msg.id)} chat: ${String(t.chat)} Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler: error storing/processing single message")})))}if(t.msgs){const e=t.msgs.length;if(!e)return Promise.resolve();let r=null;if(!(t.chat instanceof f.default))return Promise.resolve();const i=t.meta;i.isHistory=!0,"unread"===i.add&&(i.firstUnreadKey=new p.default({fromMe:i.unreadFromMe,remote:t.chat,id:i.unreadId,participant:i.unreadParticipant}),r=new l.ChatMsgsCollection);for(let r=0;r<e;r++){t.msgs[r].invis=!0}return c.Conn.platform!==c.PLATFORMS.IPHONE&&c.Conn.platform!==c.PLATFORMS.SMBI||n.trigger(d.default.COLLECTION_HAS_SYNCED),n.trigger("handle:msg_history",{count:t.msgs.length,binarySize:t.binarySize}),n.processMultipleMessages(t.chat,t.msgs,i,r).catch((0,s.filteredCatch)(h.LogoutDrop,(()=>{}))).catch((r=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${e} Chat: ${String(t.chat)} Error: ${r.name}, message: ${r.message}, stack: ${r.stack}`,SEND_LOGS("msg_handler: error storing/processing multiple messages")}))}if(t.recent){const e=t.meta,r=t.binarySize;return delete t.recent,delete t.meta,delete t.binarySize,n.trigger(d.default.COLLECTION_HAS_SYNCED,{count:Object.keys(t).length,binarySize:r}),e.isHistory=!0,Promise.all(Object.keys(t).map((r=>{let i;try{i=(0,_.createWid)(r)}catch(e){return Promise.resolve()}const a=t[r];a.invis=!0;const o="last"===e.add&&e.resume?new l.ChatMsgsCollection:null;n.processMultipleMessages(i,[a],e,o).catch((0,s.filteredCatch)(h.LogoutDrop,(()=>{}))).catch((()=>{__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("msg_handler: error storing recent messages")}))})))}return __LOG__(2)`************** Msg else clause. something strange is going on`,Promise.resolve()};var i=n(r(48926)),a=n(r(35161)),s=r(50796),o=r(78027),l=r(51612),c=r(17239),d=n(r(69618)),u=n(r(63928)),p=n(r(32219)),h=r(77591),f=n(r(39546)),_=r(58021)},74609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),{from:r,to:i,ack:a,participant:s,t:o}=t;switch(t.cmd){case"ack":n.MsgInfoCollection.updateInfo(t.id,r,i,a,s,o);break;case"acks":t.id.forEach((e=>{n.MsgInfoCollection.updateInfo(e,r,i,a,s,o)}))}};var n=r(17972)},82805:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();return(0,i.default)(t)};var i=n(r(54248))},80169:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e[0]){case"asleep":break;case"killsw":n.Updater.killServiceWorker();break;case"update":case"update_desktop":break;default:__LOG__(3)`Stream:handle unknown cmd ${e[0]}`}};var n=r(29898)},41796:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBridge=function(){return(0,i.default)(a,"_bridge")},t.isConnectedToPage=function(){return true},t.setBridge=function(e){a=e};var i=n(r(45095));let a=null},79736:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeBridge=function(){return new n.DynamicRouter};var n=r(2486)},22854:(e,t,r)=>{"use strict";var n=r(95318);t.Z=void 0;var i=r(99234),a=n(r(52991)),s=n(r(43610)),o=r(70818);var l={whoAmI(){const e=(0,i.getMaybeMeUser)().toString();return Promise.resolve(e)},logImpl:(e,t,r,n,i)=>(o.Logger.logImpl(e,t,r,n,i),Promise.resolve()),initFromStorage:()=>s.default.invoke("initFromStorage",[]),setLogoutState:e=>(a.default.isLogoutInProgress=e,s.default.invoke("setLogoutState",[e])),sendLogs:e=>r(85965).sendLogs(e),deleteDbEncKeyCache:()=>s.default.invoke("deleteDbEncKeyCache",[]),initDatabaseEncnKey:e=>s.default.invoke("initDatabaseEncnKey",[e]),generateFinalDbEncryptionAndFtsKey:e=>s.default.invoke("generateFinalDbEncryptionAndFtsKey",[e]),startBackendWorker:e=>s.default.invoke("startBackendWorker",[e])};t.Z=l},41208:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=new MessageChannel,r=t.port1,n=t.port2;o.default.respondTo(r),i.default.init(),s.default.setConnectionManager(i.default),i.default.connectVia(r),e.postMessage((0,a.buildHandshakePayload)(n),[n])};var i=n(r(82090)),a=r(3620),s=n(r(43610)),o=n(r(72601))},79038:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41208));const a=new(n(r(35474)).default);(0,i.default)(a);var s=a;t.default=s},82090:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(45095)),a=r(38284),s=r(88156),o=n(r(41143));var l=new class{init(){return this._port=null,this._deferred=new s.Resolvable,(0,a.promiseTimeout)(this._deferred.promise,5e3)}isConnected(){return null!=this._port}getPort(){return this._port}waitForConnection(){var e;return(0,i.default)(null===(e=this._deferred)||void 0===e?void 0:e.promise,"ConnectionManager Initialization Promise")}connectVia(e){if(this.isConnected())throw new Error("Connection already established");(0,o.default)(this._deferred,"ConnectionManager not initialized"),this._port=e,this._deferred.resolve()}};t.default=l},52991:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11339));const a={[i.default.WEBC_SCENARIO_TYPE.IDLE]:0,[i.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING]:3e5,[i.default.WEBC_SCENARIO_TYPE.OFFLINE_RESUME]:12e4};let s,o;const l={isLogoutInProgress:!1,getCurrentScenario(){var e;return null!==(e=o)&&void 0!==e?e:i.default.WEBC_SCENARIO_TYPE.IDLE},initOrUpdateTracking(e){s&&clearTimeout(s),o=e,o!==i.default.WEBC_SCENARIO_TYPE.IDLE&&(s=setTimeout((()=>{o=i.default.WEBC_SCENARIO_TYPE.IDLE,s=null}),a[e]))}};t.default=l},43610:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=n(r(41143)),o=r(12758),l=r(22068),c=r(23097);var d=new class{constructor(){this._pending=new Map,this._onResponseReceipt=e=>{const t=(0,c.unwrapResponsePayload)(e.data);if(null!=t){const{invocationId:e,result:r}=t;if(this._pending.has(e)){const{resolve:t}=(0,a.default)(this._pending.get(e),"this._pending.get(invocationId)");t(r),this._pending.delete(e)}}}}setConnectionManager(e){this._conn=e,e.waitForConnection().then((()=>{const t=(0,a.default)(e.getPort(),"Port obtained from ConnectionManager after connection");t.addEventListener("message",this._onResponseReceipt),t.start()}))}invoke(e,t){var r=this;return(0,i.default)((function*(){(0,s.default)(r._conn,"Connection has not been inited"),yield r._conn.waitForConnection(),(0,s.default)(r._conn,"Connection has not been inited");const n=(0,a.default)(r._conn.getPort(),"Port obtained from ConnectionManager after connection"),i=(0,l.genInvocationId)();return n.postMessage((0,o.buildInvocationPayload)({invocationId:i,method:e,args:t})),new Promise(((e,t)=>{r._pending.set(i,{resolve:e,reject:t})}))}))()}};t.default=d},72601:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(12758),a=n(r(77303)),s=r(23097);var o=new class{constructor(){this._onMessage=(e,t)=>{const r=t.data,n=(0,i.unwrapInvocationPayload)(r);if(null!=n){const{method:t,args:r,invocationId:i}=n;a.get()[t](...r).then((t=>{e.postMessage((0,s.buildResponsePayload)(i,t))}))}}}respondTo(e){e.addEventListener("message",(t=>this._onMessage(e,t))),e.start()}};t.default=o},22068:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractInvocationId=function(e){if(null!=e&&"number"==typeof e)return e},t.genInvocationId=function(){return r++};let r=1},77303:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.get=o,t.log=void 0,t.sendLogs=function(e){return o().sendLogs(e)},t.set=function(e){s=e};var i=n(r(45095)),a=n(r(76589));let s;function o(){return(0,i.default)(s,"InvocationInterface was not inited")}const l=(0,n(r(98387)).default)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return function(s){for(var l=arguments.length,c=new Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];const u=(0,a.default)(s,c,!t);let p;return r&&(p={name:r.name,stack:r.stack}),o().logImpl(e,u,p,n,i),u}}),((e,t,r,n,i)=>r||i?null:String(e)+String(Boolean(t))+String(Boolean(n))));t.log=l},3620:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildHandshakePayload=function(e){return{__command:a.HANDSHAKE_COMMAND,__port:e}},t.extractPortFromHandshakePayload=function(e){if(null!=e&&null!=e.__command&&e.__command===a.HANDSHAKE_COMMAND&&null!=e.__port){(0,i.default)(e.__port instanceof MessagePort,"Malformed connection payload");return e.__port}};var i=n(r(41143)),a=r(37557)},12758:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildInvocationPayload=function(e){let{invocationId:t,method:r,args:n}=e;return{__id:t,__command:s.INVOCATION_COMMAND,__method:r,__args:n}},t.unwrapInvocationPayload=function(e){if(null!=e&&e.__command===s.INVOCATION_COMMAND){(0,i.default)(e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,i.default)(null!=t&&e.__method&&"string"==typeof e.__method&&e.__id&&e.__args&&Array.isArray(e.__args),"Malformed invocation message");const r=e,n=r.__method,s=r.__args;return{method:n,args:s,invocationId:t}}};var i=n(r(41143)),a=r(22068),s=r(37557)},23097:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildResponsePayload=function(e,t){return{__id:e,__command:s.RESPONSE_COMMAND,__result:t}},t.unwrapResponsePayload=function(e){if(null!=e&&e.__command===s.RESPONSE_COMMAND){(0,i.default)(null!=e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,i.default)(null!=t&&e.hasOwnProperty("__result"),"Malformed response message");return{result:e.__result,invocationId:t}}};var i=n(r(41143)),a=r(22068),s=r(37557)},37557:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_COMMAND=t.INVOCATION_COMMAND=t.HANDSHAKE_COMMAND=void 0;t.HANDSHAKE_COMMAND="@@handshake";t.INVOCATION_COMMAND="@@invoke";t.RESPONSE_COMMAND="@@response"},88102:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Revoke=t.CmdImpl=t.Cmd=t.APP_STATE_SYNC_COMPLETED=void 0;var i=n(r(48926)),a=n(r(81109)),s=n(r(23279)),o=r(89385),l=n(r(41143)),c=n(r(70714)),d=n(r(69618)),u=r(92200),p=n(r(34342)),h=r(7293),f=(n(r(11339)),r(31019));const _=r(54302).Mirrored(["Sender","Admin"]);t.Revoke=_;t.APP_STATE_SYNC_COMPLETED="app_state_sync_completed";class m extends p.default{constructor(){super(...arguments),this.isMainLoaded=!1,this.uiBusy=0,this.isMainStreamReadyMd=!1,this._clearUiBusy=(0,s.default)((()=>{this.uiBusy&&(__LOG__(2)`cmd:clearUIBusy uibusy timeout`,this.uiBusy=0,this._triggerIdleEvent())}),1e3,{maxWait:5e3}),this._triggerIdleEvent=function(e){let t;const r=()=>{if(t)return;t=new c.default;const{signal:r}=t;(0,u.documentFlushed)({signal:r}).then((()=>{r.aborted||(t=null,e())}),(e=>{if(e.name!==o.ABORT_ERROR)throw e}))};return r.cancel=()=>{t&&(t.abort(),t=null)},r}((()=>{(0,l.default)(0===this.uiBusy,`ui_idle triggered when uiBusy is ${this.uiBusy}`),0===this.uiBusy&&(this._clearUiBusy.cancel(),this.trigger("ui_idle"))}))}mainLoaded(){this.isMainLoaded=!0,this.trigger("main_loaded")}incrementProgress(){__LOG__(2)`Cmd: incrementProgress`,this.trigger("increment_progress")}initialLoadReady(){__LOG__(2)`Cmd: initialLoadReady`,this.trigger("initial_load_ready")}logSocketSummary(){this.trigger("log_socket_summary")}muteAll(e,t,r){this.trigger("mute_all",e,t,r)}muteAllCall(e,t){this.trigger("mute_all_call",e,t)}muteChat(e,t){this.trigger("mute_chat",(0,f.unproxy)(e),t)}muteChats(e,t,r){const n=e.map((e=>(0,f.unproxy)(e)));this.trigger("mute_chats",n,t,r)}deleteOrExitChat(e,t){this.trigger("delete_or_exit_chat",(0,f.unproxy)(e),t)}clearChat(e,t){this.trigger("clear_chat",(0,f.unproxy)(e),t)}archiveChat(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trigger("archive_chat",(0,f.unproxy)(e),t,r)}pinChat(e,t){this.trigger("pin_chat",(0,f.unproxy)(e),t)}pinChats(e,t){const r=e.map((e=>(0,f.unproxy)(e)));this.trigger("pin_chats",r,t)}markChatUnread(e,t){this.trigger("mark_chat_unread",(0,f.unproxy)(e),t)}msgInfoDrawer(e){this.trigger("msg_info_drawer",(0,f.unproxy)(e))}chatSearch(e){this.trigger("chat_search",(0,f.unproxy)(e))}chatInfoDrawer(e,t,r){this.trigger("chat_info_drawer",(0,f.unproxy)(e),t,r)}attachMediaDrawer(e){const t=(0,a.default)((0,a.default)({},e),{},{chat:(0,f.unproxy)(e.chat)});this.trigger("attach_media_drawer",t)}attachProduct(e){this.trigger("attach_product",e)}verificationDrawer(e){this.trigger("verification_drawer",e)}liveLocationDrawer(e,t){this.trigger("live_location_drawer",e,t)}expiredLocationDrawer(e){this.trigger("expired_location_drawer",e)}mediaViewerModal(e){const{msg:t,getZoomNode:r,currentTime:n,highlightedMsgIds:i}=e;this.trigger("media_viewer_modal",{msg:t,getZoomNode:r,currentTime:n,highlightedMsgIds:i})}openMediaViewerForAlbumMedia(e){this.trigger("open_media_viewer_for_album_media",e)}productImageViewerModal(e,t){this.trigger("product_image_viewer_modal",e,t)}ephemeralDrawer(e,t,r){this.trigger("ephemeral_drawer",e,t,r)}sendStarMsgs(e,t,r,n){this.trigger("send_star_msgs",(0,f.unproxy)(e),t,r,n)}sendUnstarMsgs(e,t,r,n){this.trigger("send_unstar_msgs",(0,f.unproxy)(e),t,r,n)}sendDeleteMsgs(e,t,r,n,i){this.trigger("send_delete_msgs",(0,f.unproxy)(e),t,r,n,i)}sendRevokeMsgs(e,t,r){this.trigger("send_revoke_msgs",(0,f.unproxy)(e),t,r)}addFavoriteSticker(e){this.trigger("add_favorite_sticker",e)}removeFavoriteSticker(e){this.trigger("remove_favorite_sticker",e)}_openChat(e,t){const r=(0,f.unproxy)(e);return new Promise((e=>{this.trigger("open_chat",r,t,e)})).catch((e=>{throw __LOG__(2)`Unexpected openChat error: ${String(e)}`,e}))}openChatAt(e,t){var r=this;const n=(0,f.unproxy)(e);if(!t)return this.openChatBottom(n);this.setUiBusy(!0,"open_chat_at");const a=this._openChat(n,t).then(function(){var e=(0,i.default)((function*(e){let n,i;const a=null==t.enableAnimation||t.enableAnimation;if(e)if(e.wasVisible)n=()=>r._scrollToFocusedMsg({pos:"offset",offset:e.offset}),i=()=>r._scrollToFocusedMsg({pos:"center",animate:a,duration:d.default.MSG_FOCUS_SCROLL_ANIMATION_DURATION,easing:[.7,0,.3,1]});else switch(n=()=>r._scrollToFocusedMsg({pos:e.alignAt}),e.alignAt){case"top":case"bottom":i=()=>r._scrollToFocusedMsg({pos:"center",animate:a,duration:d.default.MSG_FOCUS_SCROLL_ANIMATION_DURATION,easing:[.88,.64,.13,.99]});break;case"center":default:i=()=>Promise.resolve()}else n=()=>r._scrollToFocusedMsg({pos:"center"}),i=()=>Promise.resolve();return yield n(),i()}));return function(){return e.apply(this,arguments)}}()).then((()=>{this.flashFocusedMsg(t.highlightMentionMsg)})).then((()=>!0)).catch((0,o.catchAbort)((()=>!1)));return a.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),a}openChatFromUnread(e){const t=(0,f.unproxy)(e);let r;if(t.unreadMsgAnchor&&(r={collection:t.unreadMsgAnchor.msgChunk,promise:Promise.resolve(),msg:t.unreadMsgAnchor,isUnreadDivider:t.shouldShowUnreadDivider}),r||t.unreadCount>0){this.setUiBusy(!0,"open_from_unread");const e=this._openChat(t,r).then((()=>this._scrollToFocusedMsg({pos:"top",offset:-120}))).then((()=>!0)).catch((0,o.catchAbort)((()=>!1)));return e.finally((()=>{this.setUiBusy(!1,"open_from_unread")})),e}return this.openChatBottom(t)}openChatBottom(e){const t=(0,f.unproxy)(e);let r;this.setUiBusy(!0,"open_bottom"),t.msgs.length>0&&(r={collection:t.msgs,msg:t.msgs.last(),isUnreadDivider:!1});const n=this._openChat(t,r).then((()=>this._scrollChatToBottom())).then((()=>!0)).catch((0,o.catchAbort)((()=>!1)));return n.finally((()=>{this.setUiBusy(!1,"open_bottom")})),n}scrollToPtt(e){const t=(0,f.unproxy)(e.chat),r={collection:e.chat.msgs,msg:e,key:e.id,highlightMsg:!1};this.setUiBusy(!0,"open_chat_at");const n=this._openChat(t,r).then((()=>this._scrollToFocusedMsg({pos:"center",animate:!0,duration:d.default.MSG_FOCUS_SCROLL_ANIMATION_DURATION,easing:[.7,0,.3,1]}))).then((()=>!0)).catch((0,o.catchAbort)((()=>!1)));return n.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),n}_scrollToFocusedMsg(e){return new Promise((t=>{this.trigger("scroll_to_focused_msg",t,e)})).catch((e=>{__LOG__(3)`Unexpected scrollToFocusedMsg error: ${String(e)}`}))}_scrollChatToBottom(){return new Promise((e=>{this.trigger("scroll_chat_to_bottom",e)})).catch((e=>{__LOG__(3)`Unexpected scrollChatToBottom error: ${String(e)}`}))}flashFocusedMsg(e){setTimeout((()=>{this.trigger("flash_focused_msg"),e&&this.trigger("flash_mention_msg")}),0)}updateChatlistSelection(e){const t=(0,f.unproxy)(e);this.trigger("update_chatlist_selection",t)}closeChat(e){const t=(0,f.unproxy)(e);this.trigger("close_chat",t)}focusChatTextInput(e){const t=(0,f.unproxy)(e);t?this.trigger("focus_chat_text_input_"+t.id.toString()):this.trigger("focus_chat_text_input")}toggleQuickReplies(){this.trigger("quick_replies_toggle")}setChatCtwaContextLinkData(e,t){this.trigger("chat_set_ctwa_context_link_data_"+e.id.toString(),t)}setChatMsgSentLogAttributes(e,t){this.trigger("chat_set_sending_log_attributes_"+e.id.toString(),t)}focusShowMsg(e){this.trigger("focus_show_msg",e)}enterChatTextInput(e){const t=(0,f.unproxy)(e);this.trigger("enter_chat_text_input_"+t.id.toString())}focusNextChat(e){this.trigger("focus_next_chat",e)}focusPrevChat(e){this.trigger("focus_prev_chat",e)}focusChatList(){this.trigger("focus_chat_list")}focusChatSearch(){this.trigger("focus_chat_search")}pasteChatTextInput(e,t){const r=(0,f.unproxy)(e);this.trigger("paste_chat_text_input_"+r.id.toString(),t)}startGroupCall(e,t){const r=(0,f.unproxy)(e);this.trigger("voip_start_group_call",r,t)}closeStatusViewer(){this.trigger("close_status_viewer")}sendPasteToCompose(e,t){const r=(0,f.unproxy)(e);this.trigger("send_paste_to_compose_"+r.id.toString(),t)}openComposeBoxPanel(e){this.trigger("open_compose_box_panel",e)}login(e){this.trigger("login",e)}logout(){const e=h.GK.supportsFeature(h.GK.F.MD_BACKEND);h.GK.resetFeatures(),h.GK.setFeature(h.GK.F.MD_BACKEND,e),h.GK.setFeature(h.GK.F.MD_ADV,e),h.GK.setFeature(h.GK.F.MD_VOIP_GROUP,e&&!1),this.trigger("logout")}openContextMenu(e,t){this.trigger("open_context_menu",e,t)}closeContextMenu(e){this.trigger("close_context_menu",e)}openTooltip(e,t){this.trigger("open_tooltip",e,t)}closeTooltip(e){this.trigger("close_tooltip",e)}openToast(e){this.trigger("open_toast",e)}closeToast(e){this.trigger("close_toast",e)}alertNewMsg(e){this.trigger("alert_new_msg",e)}alertNewReactionMsg(e){this.trigger("alert_new_reaction_msg",e)}newMediaMsg(e){this.trigger("new_media_msg",e)}alertCall(e,t,r,n,i){this.trigger("alert_call",e,t,r,n,i)}cancelCall(e){this.trigger("cancel_call",e)}windowError(){}cannotReachPhone(){}sentPing(){}openModal(e,t){this.trigger("open_modal",e,t)}closeModal(e){this.trigger("close_modal",e)}openModalMedia(e,t){this.trigger("open_media",e,t)}closeModalMedia(){this.trigger("close_media")}setDrawerContext(e,t){this.trigger(`update_context_${e}`,t)}openDrawerRight(e,t,r,n,i){this.trigger("open_drawer_right",e,t,r,void 0,n,i)}openDrawerMid(e,t,r,n,i,a){this.trigger("open_drawer_mid",e,t,r,n,i,a)}openDrawerLeft(e,t,r,n,i){this.trigger("open_drawer_left",e,t,r,void 0,n,i)}existsDrawerRight(e){this.trigger("exists_drawer_right",e)}existsDrawerMid(e){this.trigger("exists_drawer_mid",e)}existsDrawerLeft(e){this.trigger("exists_drawer_left",e)}closeDrawerRight(){this.trigger("close_drawer_right")}closeDrawerMid(){this.trigger("close_drawer_mid")}closeDrawerLeft(){this.trigger("close_drawer_left")}onPanesWillChange(e){this.trigger("panes_will_change",e)}onPanesDidChange(e){this.trigger("panes_did_change",e)}openGroupInviteModal(e){this.trigger("open_group_invite_modal",e)}reactionChangeLastMessage(){this.trigger("reaction_changed_last_msg")}openGroupV4InviteRequestFlow(e,t,r,n){this.trigger("open_group_v4_invite_request_flow",e,t,r,n)}uiResize(){this.trigger("resize")}setUiBusy(e){let t=this.uiBusy||0;e?(++t,this._clearUiBusy(),this._triggerIdleEvent.cancel()):t&&--t,this.uiBusy=t,0===t&&(this._clearUiBusy.cancel(),this._triggerIdleEvent())}windowMouseDown(e){this.trigger("window_mousedown",e)}windowClick(e){this.trigger("window_click",e)}midnight(){this.trigger("midnight")}textsizeChange(e){this.trigger("textsize_change",e)}scrollMessages(){this.trigger("scroll_messages")}getConversationHeaderOffset(e){this.trigger("get_conversation_header_offset",e)}floaterEscapeOverlap(e,t){this.trigger("floater_escape_overlap",e,t)}autoplayPTT(e){this.trigger("sequential_playback_ptt",e)}refreshMessages(){this.trigger("refresh_messages")}readyForMainStreamModeLegacy(){this.trigger("main_stream_mode_ready_legacy")}storageInitializationError(){this.trigger("storage_initialization_error")}restartBackend(){this.trigger("md_restart_backend")}downgradeWebclient(){this.trigger("md_downgrade_webclient")}upgradeToMDInternal(){this.trigger("upgrade_to_md")}upgradeToMDProd(){this.trigger("upgrade_to_md_prod")}refreshQR(){this.trigger("md_refresh_qr")}setSocketState(e){this.trigger("set_socket_state",e)}socketStreamDisconnected(){this.trigger("socket_stream_disconnected")}openSocketStream(){this.trigger("open_socket_stream")}readyForMainStreamMode(){this.isMainStreamReadyMd=!0,this.trigger("main_stream_mode_ready")}onInitialChatHistorySynced(){this.trigger("on_initial_chat_synced")}onRecentChatHistorySynced(){this.trigger("on_recent_chat_history_synced")}onFullChatHistorySynced(){this.trigger("on_full_chat_history_synced")}onHistorySyncChunkProcessed(e){this.trigger("new_history_sync_chunk_processed",e)}handleOfflineProgressUpdate(){this.trigger("offline_progress_update")}criticalSyncDone(){this.trigger("on_critical_sync_done")}onTemporaryBan(e){this.trigger("account_temporarily_banned",e)}onStartingLogout(){this.trigger("starting_logout")}handleFatalError(){this.trigger("handle_fatal_error")}merchantDetailsDrawer(e){this.trigger("merchant_details_drawer",e)}showMerchantDetailsEntityTypePopup(e,t){this.trigger("show_merchant_details_entity_type_popup",e,t)}showCountrySelector(e,t,r,n){this.trigger("show_country_selector_popup",e,t,r,n)}toggleStickerMaker(){this.trigger("toggle_sticker_maker")}onAccountSyncForPrivacy(e){this.trigger("account_sync_for_privacy",e)}openStickerPack(e){this.trigger("open_sticker_pack",e)}onStatusViewerOpen(){this.trigger("status_viewer_open")}triggerStorageAlert(){}}t.CmdImpl=m;const g=new m;t.Cmd=g},95176:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.scanComplianceInfoForMissingData=t.isBusinessCompliant=t.getGrievanceOfficerDetailsError=t.getEntityTypeText=t.getCustomerCareDetailsError=t.existsGrievanceOfficerDetailsContact=t.existsFieldIgnoreHardEnforcement=t.existsField=t.existsCustomerCareDetailsContact=void 0;var i=n(r(48360)),a=r(93170),s=r(9978),o=r(57701);t.getEntityTypeText=e=>{const{entityType:t,entityTypeCustom:r,isRegistered:n}=e||{},s={[a.businessTypeOptions.limitedLiabilityPartnership]:i.default._("Limited liability partnership",null,{hk:"2dwmwU"}),[a.businessTypeOptions.soleProprietorship]:i.default._("Sole proprietorship",null,{hk:"2N7jks"}),[a.businessTypeOptions.partnership]:i.default._("Partnership",null,{hk:"ZeckL"}),[a.businessTypeOptions.publicCompany]:i.default._("Public Company",null,{hk:"1YuMvC"}),[a.businessTypeOptions.privateCompany]:i.default._("Private Company",null,{hk:"WL0uU"}),[a.businessTypeOptions.other]:i.default._("Other",null,{hk:"3zua5D"})},o=r||s[t]||"";if(!o)return"";let l="";return[a.businessTypeOptions.partnership,a.businessTypeOptions.other].includes(t)&&(l=n?i.default._("Registered Business",null,{hk:"3N1x9I"}):i.default._("Not Registered Business",null,{hk:"2zDsuK"})),`${o.toString()}${l?` (${l.toString()})`:""}`};const l=(e,t)=>!(!e&&!t),c=e=>!!(null==e?void 0:e.trim());t.existsFieldIgnoreHardEnforcement=c;const d=(e,t)=>!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||c(e);t.existsField=d;const u=(e,t,r,n,i)=>!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||r.some((t=>c(t===n?i:null==e?void 0:e[t]))),p=(e,t,r,n)=>u(e,t,["mobileNumber","landlineNumber"],r,n);t.existsCustomerCareDetailsContact=p;const h=(e,t,r,n)=>u(e,t,["mobileNumber","landlineNumber","email"],r,n);t.existsGrievanceOfficerDetailsContact=h;t.isBusinessCompliant=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(r.user))return!0;if(!t)return!1;const{entityName:n,entityType:i,entityTypeCustom:a,customerCareDetails:s,grievanceOfficerDetails:c}=t;return[e,n,null==s?void 0:s.email,null==c?void 0:c.name].every((e=>d(e,r)))&&l(i,a)&&p(s,r)&&h(c,r)};t.getCustomerCareDetailsError=(e,t,r,n,i)=>p(e,i,t,r)?n:"";t.getGrievanceOfficerDetailsError=(e,t,r,n,i)=>h(e,i,t,r)?n:"";t.scanComplianceInfoForMissingData=e=>{const t=(null==e?void 0:e.countryCodeOrigin)===String(s.SyntheticCountryCode.NotApplicable),r=!t&&void 0!==(null==e?void 0:e.countryCodeOrigin),n=!t&&void 0!==(null==e?void 0:e.importerName);return{isExempt:t,hasImporterAddress:!t&&void 0!==(null==e?void 0:e.importerAddress)&&[e.importerAddress.street1,e.importerAddress.street2,e.importerAddress.city,e.importerAddress.region,e.importerAddress.postalCode,e.importerAddress.countryCode].some((e=>e)),hasImporterName:n,hasCountryCodeOrigin:r}}},53781:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(81109)),s=n(r(45095)),o=n(r(9006));t.default=class{constructor(e,t){this._concurrency=e,this._groupLimits=t,this._runningTasksByGroup=new Map,this._enqueuedTasksByGroup=new Map}clearQueue(){this._enqueuedTasksByGroup.clear(),this._runningTasksByGroup.clear()}enqueue(e,t){let r,n;const s=new Promise(((e,t)=>{r=e,n=t}));var o;return this._doEnqueue((0,a.default)((0,a.default)({},t),{},{run:(o=(0,i.default)((function*(){try{const t=yield e();r(t)}catch(e){n(e)}})),function(){return o.apply(this,arguments)})})),this._runTasks(),s}_doEnqueue(e){this._getOrCreatePriorityQueueForGroup(e.group).push(e)}_doDequeue(){return this._getHighestPriorityAmongGroups()}_runTasks(){for(;this._getRunningTasksCount()<this._concurrency;){const e=this._doDequeue();if(null==e)break;this._runTask(e)}}_runTask(e){var t=this;return(0,i.default)((function*(){const{run:r,signal:n,group:i}=e,a=t._getRunningTasksForGroup(i);if(null==n?void 0:n.aborted)setTimeout((()=>t._runTasks()),0);else{a.add(e);try{yield r()}finally{a.delete(e),setTimeout((()=>t._runTasks()),0)}}}))()}_getHighestPriorityAmongGroups(){var e;let t;for(const e of this._enqueuedTasksByGroup.values()){const r=e.peek();r&&(this._isFullOfGroup(r.group)||(!t||t.priority<r.priority)&&(t=e))}return null===(e=t)||void 0===e?void 0:e.pull()}_getRunningTasksCount(){let e=0;for(const t of this._runningTasksByGroup.values())e+=t.size;return e}getEnqueuedTasksCount(){let e=0;for(const t of this._enqueuedTasksByGroup.values())e+=t.size();return e}_getRunningTasksForGroup(e){if(!this._runningTasksByGroup.has(e)){const t=new Set;return this._runningTasksByGroup.set(e,t),t}return(0,s.default)(this._runningTasksByGroup.get(e),"this._runningTasksByGroup.get(group)")}_isFullOfGroup(e){const t=this._runningTasksByGroup.get(e);return null!=t&&t.size>=this._getLimitForGroup(e)}_getOrCreatePriorityQueueForGroup(e){if(!this._enqueuedTasksByGroup.has(e)){const t=new o.default((e=>e.priority));this._enqueuedTasksByGroup.set(e,t)}return(0,s.default)(this._enqueuedTasksByGroup.get(e),"this._enqueuedTasksByGroup.get(group)")}_getLimitForGroup(e){const t=this._groupLimits[e];return null==t?1/0:t}}},69335:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(92417)),s=n(r(53962));let o=r(69564).Z;self.URL=self.URL||self.webkitURL,self.AudioContext=self.AudioContext||self.webkitAudioContext,self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;var l=(0,i.default)({REQUIRED_BROWSER_APIS:(0,i.default)({},{getRandomValues:!!self.crypto.getRandomValues,subtleCrypto:!(!self.crypto||!self.crypto.subtle&&!self.crypto.webkitSubtle),localstorage:!!a.default,sessionstorage:!!s.default,url:!!self.URL,websocket:!!self.WebSocket,worker:!!self.Worker}),BROWSER_TYPE:{CHROME:"chrome",CHROMIUM:"chromium",FIREFOX:"firefox",SAFARI:"safari",IE:"ie",OPERA:"opera",EDGE:"edge"},BROWSER_LINK:{CHROME:'<a href="https://www.google.com/chrome">Google Chrome</a>',FIREFOX:'<a href="http://www.firefox.com">Mozilla Firefox</a>',OPERA:'<a href="http://www.opera.com">Opera</a>'},OS_TYPE:{WINDOWS:"windows",MAC:"mac os",CHROMEOS:"chromium os"},LATEST_HASH:"9a96f476d1072fbf0bdf37392f3f35baf0d89f83",VERSION:{p:Number("2"),s:Number("2204"),t:Number("13")},VERSION_BASE:"2.2204.13",VERSION_STR:"2.2204.13",DYN_ORIGIN:"https://web.whatsapp.com/",PP_URL:"https://web.whatsapp.com/pp",LOGOUT_URL:"https://web.whatsapp.com/logout",WAM_URL:"https://web.whatsapp.com/wam",VIDEO_STREAM_URL:"/stream/video",LARGE_EMOJI_BASE_PATH:"/img",LARGE_EMOJI_ELECTRON_BASE_PATH:"img",EMOJI_SPRITES_BASE_PATH:"/img",EMOJI_SPRITES_ELECTRON_BASE_PATH:"img",get VOIP_INCOMING_CALL_TONE(){return""},get VOIP_END_CALL_TONE(){return""},get GROUP_DEFAULT_ICON(){return r(37849)},get USER_DEFAULT_ICON(){return r(52026)},get NOTIFICATION_TONE_PATH(){return r(57895)},get OUTGOING_MESSAGE_TONE_PATH(){return r(32657)},get PTT_MIDDLE_TONE_PATH(){return r(16663)},get PTT_END_TONE_PATH(){return r(63320)},DRAG_TYPE_FILE:"Files",KEY_LOCAL_TAKEOVER_OK:"local-takeover-ok",SCROLL_FUDGE:100,PERMISSION_ALLOWED:"granted",PERMISSION_DEFAULT:"default",PERMISSION_DENIED:"denied",QR_EDGE:264,NUX:{SAFARI_LIMITED_SUPPORT:"safari_limited_support",REVOKE_LEGAL_DISCLAIMER_NUX:"revoke_legal_disclaimer_nux",EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",COMMUNITY:"community"},TEXTSIZE_CLASS_MAP:[{scale:-1,classname:"textsize-small"},{scale:-2,classname:"textsize-xsmall"},{scale:-3,classname:"textsize-xxsmall"},{scale:1,classname:"textsize-large"},{scale:2,classname:"textsize-xlarge"},{scale:3,classname:"textsize-xxlarge"}],LIST_HEIGHT_TEXTSIZE_MAP:[{scale:-1,height:64},{scale:-2,height:58},{scale:-3,height:52},{scale:1,height:72},{scale:2,height:72},{scale:3,height:72}],MSG_FOCUS_SCROLL_ANIMATION_DURATION:400,WAM_PLATFORM:"WEB",FLB_PLATFORM:"web",APP_ID:"",BUILD_ID:"350555858",DESKTOP_BUNDLE_ID:"WhatsApp"},o);t.default=l},69564:(e,t,r)=>{"use strict";var n=r(95318);t.Z=void 0,(0,n(r(41143)).default)(!0,"prod only");var i={CAPABILITY_URL:"https://web.whatsapp.com/browsers.html",STATUS_URL:"https://web.whatsapp.com/status.json",CHECK_UPDATE_URL:"https://web.whatsapp.com/check-update",NOTICE_CONTENT_ENDPOINT_URL:"https://www.whatsapp.com/user-notice/v1/",COOKIE_DOMAIN:".web.whatsapp.com",TICKET_URL:"https://web.whatsapp.com/web-contact-us",GROUP_INVITE_URL:"https://web.whatsapp.com/invite/icon/",GROUP_V4_INVITE_ICON_URL:"https://web.whatsapp.com/invite/v4/icon/",LARGE_EMOJI_URL:"https://web.whatsapp.com/img/",PP_TOK:"/pp",PP_REF:"/pp",UPLOAD_TO_CLB:1,FLAVOR_TAGS:!1,WEB_SOCKET_URL:"wss://web.whatsapp.com/ws",CHATD_WEB_SOCKET_URL:"wss://web.whatsapp.com/ws/chat",LOG_SIZE_ELECTRON:14999,LOG_SIZE_WEB:4999,MEMORY_METRIC_INTERVAL:9e5,MARK_TRANSLATIONS:!1,WAM_ENV:"PROD",WRITE_TO_CONSOLE:!1};t.Z=i},69618:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(69335)),s=n(r(75509));var o=(0,i.default)((0,i.default)({},s.default),a.default);t.default=o},54392:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={KEYBOARD_EVENT_KEY_VALUE:{UNIDENTIFIED:"Unidentified",ALT:"Alt",ALT_GRAPH:"AltGraph",CAPS_LOCK:"CapsLock",CONTROL:"Control",FN:"Fn",FN_LOCK:"FnLock",HYPER:"Hyper",META:"Meta",NUM_LOCK:"NumLock",SCROLL_LOCK:"ScrollLock",SHIFT:"Shift",SUPER:"Super",SYMBOL:"Symbol",SYMBOL_LOCK:"SymbolLock",OS:"OS",ENTER:"Enter",TAB:"Tab",SPACE:" ",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",LEFT:"Left",RIGHT:"Right",UP:"Up",DOWN:"Down",END:"End",HOME:"Home",PAGE_DOWN:"PageDown",PAGE_UP:"PageUp",BACKSPACE:"Backspace",CLEAR:"Clear",COPY:"Copy",CR_SEL:"CrSel",CRSEL:"Crsel",CUT:"Cut",DELETE:"Delete",ERASE_EOF:"EraseEof",EX_SEL:"ExSel",EXSEL:"Exsel",INSERT:"Insert",PASTE:"Paste",REDO:"Redo",UNDO:"Undo"}};t.default=r},83578:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogoutReason=void 0;const n=r(54302)({UserInitiated:"user_initiated",SyncdFailure:"syncd_failure",InvalidAdvStatus:"invalid_adv_status",CriticalSyncTimeout:"critical_sync_timeout",AccountSyncTimeout:"account_sync_timeout",MDOptOut:"md_opt_out",UnknownCompanion:"unknown_companion",ClientVersionOutdated:"client_version_outdated",SyncdErrorDuringBootstrap:"syncd_error_during_bootstrap",AccountSyncError:"account_sync_error",ClientFatalError:"client_fatal_error",StorageQuotaExceeded:"storage_quota_exceeded",PrimaryIdentityKeyChange:"primary_identity_key_change"});t.LogoutReason=n},75509:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={ARCHIVE_NUX_MAX_VIEWS:3,IMG_THUMB_MAX_EDGE:100,DOC_THUMB_MAX_EDGE:480,VIDEO_THUMB_MAX_EDGE:480,MAX_PORTRAIT_MEDIA_CAPTION_LENGTH:500,MAX_FILES:30,STICKER_DIMENSION:512,STICKER_BORDER_WIDTH:8,STICKER_PADDING:36,STICKER_LIST_ITEM_HEIGHT:156,STICKER_MAKER_IMAGE_PADDING:20,STICKER_PACK_FETCH_TIMEOUT:86400,MEDIA_EDITOR_OUTLINE_TENSION:.4,MMS_THUMBNAIL_UPLOAD_TIMEOUT:3e3,FREQUENTLY_FORWARDED_SENTINEL:127,MAX_SMB_LABEL_COUNT:20,DEFAULT_SMB__NEW_LABEL_COLOR:"#d6d7d7",FB_CLB_TOKEN:"1063127757113399|745146ffa34413f9dbb5469f5370b7af",FB_CLB_CHECK_URL:"https://crashlogs.whatsapp.net/wa_fls_upload_check",FB_CLB_URL:"https://crashlogs.whatsapp.net/wa_clb_data",FAKE_USER_AGENT:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",G_MAPS_DIR_URL:"https://maps.google.com/maps/dir",G_MAPS_IMG_URL:"https://maps.googleapis.com/maps/api/staticmap",G_MAPS_SEARCH_URL:"https://maps.google.com/maps/search",G_MAPS_URL:"https://maps.google.com/maps",G_MAPS_DARK_MODE_STYLE:"style=element:geometry%7Ccolor:0x212121&style=element:labels.icon%7Cvisibility:off&style=element:labels.text.fill%7Ccolor:0x757575&style=element:labels.text.stroke%7Ccolor:0x212121&style=feature:administrative%7Celement:geometry%7Ccolor:0x757575&style=feature:administrative.country%7Celement:labels.text.fill%7Ccolor:0x9e9e9e&style=feature:administrative.land_parcel%7Cvisibility:off&style=feature:administrative.locality%7Celement:labels.text.fill%7Ccolor:0xbdbdbd&style=feature:poi%7Celement:labels.text.fill%7Ccolor:0x757575&style=feature:poi.park%7Celement:geometry%7Ccolor:0x181818&style=feature:poi.park%7Celement:labels.text.fill%7Ccolor:0x616161&style=feature:poi.park%7Celement:labels.text.stroke%7Ccolor:0x1b1b1b&style=feature:road%7Celement:geometry.fill%7Ccolor:0x2c2c2c&style=feature:road%7Celement:labels.text.fill%7Ccolor:0x8a8a8a&style=feature:road.arterial%7Celement:geometry%7Ccolor:0x373737&style=feature:road.highway%7Celement:geometry%7Ccolor:0x3c3c3c&style=feature:road.highway.controlled_access%7Celement:geometry%7Ccolor:0x4e4e4e&style=feature:road.local%7Celement:labels.text.fill%7Ccolor:0x616161&style=feature:transit%7Celement:labels.text.fill%7Ccolor:0x757575&style=feature:water%7Celement:geometry%7Ccolor:0x000000&style=feature:water%7Celement:labels.text.fill%7Ccolor:0x3d3d3d",FB_LEGAL_TERMS_URL:"https://www.facebook.com/legal/terms",FB_COMMERCE_POLICY_URL:"https://www.facebook.com/policies/commerce",WA_COMMERCE_POLICY_URL:"https://www.whatsapp.com/policies/commerce-policy",NOTIFICATION_PROMPT_DELAY:1e4,PTT_PLAYBACK_DELAY:400,IDLE_TIMEOUT:6e4,IDLE_TIMEOUT_WAIT:78e4,SEARCH_ZOOM:17,SEND_UNAVAILABLE_WAIT:15e3,SEND_PAUSED_WAIT:2500,CLEAR_CHAT_DIRTY_WAIT:2500,LOG_UPLOAD_INTERVAL:36e5,REVOKE_WINDOW:4096,REVOKE_WINDOW_V2:216e3,REVOKE_WINDOW_V2_RECEIVER_MARGIN:43200,ALBUM_DIFF_INTERVAL:600,MAX_TXT_MSG_SIZE:65536,INITIAL_PAGE_SIZE:768,FREQUENTLY_FORWARDED_INITIAL_PAGE_SIZE:308,SUBSEQUENT_PAGE_SIZE:3072,OVERFLOWING_PAGE_THRESHOLD:.1,GROUP_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:100,BUSINESS_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:200,GROUP_DESCRIPTION_LENGTH:0,INFO_DRAWER_MAX_ROWS:10,INFO_DRAWER_MAX_ROWS_IN_COLLAPSED_LIST:11,NUM_COLORS:17,FTS_MIN_CHARS:2,FTS_TTL:6e4,FTS_TYPING_DELAY:300,FTS_NUM_RESULTS:30,HSM_ASPECT_RATIO:1.91,TEMPLATE_DOC_MIME_TYPES:1,TEMPLATE_URL_START:64,TEMPLATE_URL_END:32,SQUELCH_RESET_VALUE:-1,KEY_STORAGE_TEST:"storage_test",KEY_CLIENT_TOKEN:"WAToken1",KEY_SERVER_TOKEN:"WAToken2",KEY_SECRET:"WASecretKey",KEY_SECRET_BUNDLE:"WASecretBundle",KEY_SECURITY_NOTIFICATIONS:"WASecurityNotifications",KEY_BROWSER_ID:"WABrowserId",KEY_GEOCODER_LOCATION:"WAGeocoderLocation",KEY_GROUP_ASSIGNED_COLOR:"WAGroupAssignedColor-17",KEY_GMAPS_OVER_LIMIT:"WAGmapsOverLimit",KEY_GLOBAL_MUTE_SOUNDS:"WAGlobalSounds",KEY_GLOBAL_MUTE_CALL_RINGTONE:"WAGlobalCallRingtone",KEY_OUTGOING_MESSAGE_SOUND:"WAOutgoingMessageSound",KEY_GLOBAL_MUTE_NOTIFICATIONS:"WAGlobalNotifications",KEY_GLOBAL_MUTE_IN_APP_NOTIFICATIONS:"WAGlobalInAppNotifications",KEY_GLOBAL_MUTE_PREVIEWS:"WAGlobalPreviews",KEY_GLOBAL_COLLAPSE_MUTED:"WAGlobalCollapseMuted",KEY_NOTIFICATION_SOUND:"WANotificationSound",KEY_AUTO_DOWNLOAD_PHOTOS:"WAAutoDownloadPhotos",KEY_AUTO_DOWNLOAD_AUDIO:"WAAutoDownloadAudio",KEY_AUTO_DOWNLOAD_VIDEOS:"WAAutoDownloadVideos",KEY_AUTO_DOWNLOAD_DOCUMENTS:"WAAutoDownloadDocuments",KEY_LANG:"WALangPref",KEY_LAST_ACTIVE_EMOJI_TAB:"WALastActiveEmojiTab",KEY_LAST_SELECTED_COMPOSE_BOX_PANEL:"WALastActiveComposeBoxPanel",KEY_LAST_CHAT_MUTE_DURATION:"WALastChatMuteDuration",KEY_UNKNOWN_ID:"WAUnknownID",KEY_VERSION:"WAVersion",KEY_LOAD_RETRY_GENERATION:"WALoadRetryGeneration",KEY_WHATSAPP_MUTEX:"whatsapp-mutex",KEY_LAST_WID:"last-wid",KEY_LAST_WID_MD:"last-wid-md",KEY_SAVE_TO_CAMERA_ROLL:"save_to_camera_roll",KEY_SMB_LABEL_COLOR_PALETTE:"smb_label_color_palette",KEY_LAST_PUSHNAME:"last-pushname",KEY_PROTO_VERSION:"WAProtoVersion",KEY_PTT_PLAYBACK_RATE:"WAPttPlaybackRate",KEY_LOGOUT_DIRTY_BIT:"post-logout",KEY_UNREAD_MENTION_COUNT_ENABLED:"WAUnreadMentionCountEnabled",KEY_NEW_CHAT_INFO:"WANewChatInfo",KEY_DAILY_STATS_START_TIME:"WADailyStatsStartTime",KEY_PRIMARY_FEATURES:"WAPrimaryFeatures",KEY_TOS_STATE_FETCH_ITERATION:"ToSStateFetchIteration",KEY_LOG_PREEMPT_CLEAN_UP:"WALogPreemptiveCleanUp",KEY_PRESERVED_USER_KEYS:"preserved_user_keys",KEY_EMOJI_VARIANT_COLLECTION:"emoji_variant_collection",KEY_RECENT_EMOJI_COLLECTION:"recent_emoji_collection",KEY_CHAT_PREFERENCE_COLLECTION:"chat_preference",LAST_STATUS_USAGE:"last-status-usage",KEY_MD_OPTED_IN:"md-opted-in",KEY_SHOW_MD_UPGRADE_COMPLETE_MSG:"show-md-upgrade-complete-msg",KEY_FORCED_MD_UPGRADE_COMPLETE:"forced-md-upgrade-complete",KEY_MOBILE_PLATFORM:"mobile-platform",KEY_REMEMBER_ME:"remember-me",KEY_LOGOUT_TOKEN:"logout-token",KEY_OLD_LOGOUT_CREDS:"old-logout-cred",KEY_NO_TAKEOVER:"no-takeover",KEY_WHATSAPP_LS_VERSION:"ver",KEY_WAM_BUFFER:"wam-buffer",KEY_WAM_INFO:"wam-info",KEY_TIME_SPENT_EVENT:"WaTimeSpentEvent",KEY_VIDEO_VOLUME:"video-volume",KEY_VIDEO_MUTE:"video-mute",KEY_CONTACT_CHECKSUM:"contact-checksum",KEY_USER_PRIVACY_SETTINGS:"user-privacy-settings",KEY_IS_SMB:"is-smb",KEY_COMPOSE_CONTENTS_PREFIX:"compose-contents_",KEY_THEME:"theme",KEY_SYSTEM_THEME_MODE:"system-theme-mode",KEY_ABPROPS:"abprops",KEY_HISTORY_SYNC_EARLIEST_DATE:"history-sync-earliest-date",KEY_CHATS_USER_SENT_MESSAGE_TO:"chats-user-sent-message-to",KEY_SYNCD_DISABLED_DUE_TO_FATAL:"syncd_disabled_due_to_fatal",KEY_SYNCD_FIRST_CLEAR_OR_DELETE:"syncd-first-clear-or-delete",KEY_CONTACT_SYNC_REFRESH:"contact-sync-refresh-seconds",KEY_TOS_3:"TOS_STATE_20210210",COOKIE_REF:"ref",COOKIE_TOK:"tok",PAGE_SIZE:50,MSG_PRELOAD_THRESHOLD:20,MEDIA_QUERY_LIMIT:50,MIN_PIC_SIDE:192,MAX_PIC_SIDE:640,PROF_PIC_THUMB_SIDE:96,MAX_CAPTION_LENGTH:1024,REACTION_CONTENT_MAX_LENGTH:30,REVOKED_REACTION_TEXT:"",MAX_CART_MESSAGE_LENGTH:1024,MAX_PRODUCT_SUBTITLE_LENGTH:70,MAX_REPLY_PRODUCT_TITLE_LENGTH:40,MAX_REPLY_PRODUCT_DESC_LENGTH:95,ALBUM_MIN_SIZE:4,ALBUM_MAX_SIZE:102,ALBUM_MAX_HEIGHT:168,ALBUM_PADDING:3,PRESENCE_COMPOSING_TIMEOUT:25e3,PRESENCE_RESEND_WAIT:1e4,MIMETYPE_OGG:"audio/ogg",IMAGE_MIMES:"image/*",WEBP_MIMES:"image/webp",VIDEO_MIMES:"video/mp4,video/3gpp,video/quicktime",KEY_LOG_CURSOR:"debugCursor",MAX_STATUS_LENGTH:139,MAX_PUSHNAME_LENGTH:25,STATUS_CAPTION_PREVIEW_LENGTH:120,DISP_TYPE:{CONVERSATION:"CONVERSATION",MSG_INFO:"MSG_INFO",STARRED_MSGS:"STARRED_MSGS",GALLERY:"GALLERY",REPLY_STAGE:"REPLY_STAGE",QUOTED_MSG:"QUOTED_MSG",CONTACT_CARD:"CONTACT_CARD",ORDER:"ORDER"},SEND_LOGS_MAX_EMAIL_LENGTH:320,SEND_LOGS_MAX_SUBJECT_LENGTH:50,SEND_LOGS_MIN_DESC_LENGTH:10,SEND_LOGS_MAX_DESC_LENGTH:500,SEND_LOGS_MAX_SCREENSHOTS:3,SEND_LOGS_MAX_SCREENSHOT_SIZE:10485760,CONTACT_US_MIN_DESC_LENGTH:10,CONTACT_US_MAX_DESC_LENGTH:5e3,ACK:{MD_DOWNGRADE:-7,INACTIVE:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4,PEER:5},ACK_STRING:{SENDER:"sender",DELIVERY:"delivery",READ:"read",PLAYED:"played",INACTIVE:"inactive",READ_SELF:"read-self",PLAYED_SELF:"played-self"},RETRY:{VALIDATE_OLD_SESSION:2,MAX_RETRY:5},KEY_BUNDLE_TYPE:"",EDIT_ATTR:{SENDER_REVOKE:7,ADMIN_REVOKE:8},DEVICE:{PRIMARY_DEVICE:0,PRIMARY_VERSION:0},BATTERY_LOW_THRESHOLD_1:15,BATTERY_LOW_THRESHOLD_2:5,BATTERY_DELAY:1e4,SOCKET_STATE:{OPENING:"OPENING",PAIRING:"PAIRING",UNPAIRED:"UNPAIRED",UNPAIRED_IDLE:"UNPAIRED_IDLE",CONNECTED:"CONNECTED",TIMEOUT:"TIMEOUT",CONFLICT:"CONFLICT",UNLAUNCHED:"UNLAUNCHED",PROXYBLOCK:"PROXYBLOCK",TOS_BLOCK:"TOS_BLOCK",SMB_TOS_BLOCK:"SMB_TOS_BLOCK",DEPRECATED_VERSION:"DEPRECATED_VERSION"},SOCKET_STREAM:{DISCONNECTED:"DISCONNECTED",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTED:"CONNECTED"},COLLECTION_HAS_SYNCED:"collection_has_synced",NEW_MSG_SENT:"new_msg_sent",DIAGNOSTIC_DELAY:18e3,ONE_BY_ONE_TRANS_GIF:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",DEFAULT_CHAT_WALLPAPER:"default_chat_wallpaper",L10N_PRIORITY:{SAVED:6,PHONE:5,PREVIOUS:4,URL:3,BROWSER:2,DEFAULT:1},RENDER_CURSOR:{RECENT_AT_TOP:"recent_at_top",RECENT_AT_BOTTOM:"recent_at_bottom",CONVERSATION:"conversation",GROUP_CONVERSATION:"group_conversation",STARRED_DRAWER:"starred_drawer"},SECURITY_LINK:"https://www.whatsapp.com/security/",SMB_TOS_LEARN_MORE_LINK:"https://www.whatsapp.com/legal/small-business-terms/",SERVER_WID:"server@c.us",PSA_WID:"0@c.us",STATUS_WID:"status@broadcast",OFFICIAL_BIZ_WID:"16505361212@c.us",VISIBILITY:{ABOVE:"above",VISIBLE:"visible",BELOW:"below"},SPELL_CHECK_SKIP_WORDS:{en_us:new Set(["ain","couldn","didn","doesn","hadn","hasn","mightn","mustn","needn","oughtn","shan","shouldn","wasn","weren","wouldn","Ain","Couldn","Didn","Doesn","Hadn","Hasn","Mightn","Mustn","Needn","Oughtn","Shan","Shouldn","Wasn","Weren","Wouldn"]),en_gb:new Set(["ain","couldn","didn","doesn","hadn","hasn","mightn","mustn","needn","oughtn","shan","shouldn","wasn","weren","wouldn","Ain","Couldn","Didn","Doesn","Hadn","Hasn","Mightn","Mustn","Needn","Oughtn","Shan","Shouldn","Wasn","Weren","Wouldn"]),en:new Set(["ain","couldn","didn","doesn","hadn","hasn","mightn","mustn","needn","oughtn","shan","shouldn","wasn","weren","wouldn","Ain","Couldn","Didn","Doesn","Hadn","Hasn","Mightn","Mustn","Needn","Oughtn","Shan","Shouldn","Wasn","Weren","Wouldn"])},GROUP_INVITE_LINK_URL:"https://chat.whatsapp.com/",GROUP_SETTING_TYPE:{ANNOUNCEMENT:"announcement",RESTRICT:"restrict",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",EPHEMERAL:"ephemeral"},GROUP_SETTING_TO_METADATA:{announcement:"announce",restrict:"restrict",no_frequently_forwarded:"noFrequentlyForwarded",ephemeral:"ephemeralDuration"},L10N:{DEFAULT:"en",MOMENT_DEFAULT:"en-US"},EMOJI:{BUCKET_SIZE:25,CATEGORIES:{SMILEYS_PEOPLE:"SMILEYS_PEOPLE",ANIMALS_NATURE:"ANIMALS_NATURE",FOOD_DRINK:"FOOD_DRINK",ACTIVITY:"ACTIVITY",TRAVEL_PLACES:"TRAVEL_PLACES",OBJECTS:"OBJECTS",SYMBOLS:"SYMBOLS",FLAGS:"FLAGS"},CATEGORY_MAPPING:{"Smileys & People":"SMILEYS_PEOPLE","Animals & Nature":"ANIMALS_NATURE","Food & Drink":"FOOD_DRINK",Activity:"ACTIVITY","Travel & Places":"TRAVEL_PLACES",Objects:"OBJECTS",Symbols:"SYMBOLS",Flags:"FLAGS"},ORDERED_CATEGORY_IDS:["SMILEYS_PEOPLE","ANIMALS_NATURE","FOOD_DRINK","ACTIVITY","TRAVEL_PLACES","OBJECTS","SYMBOLS","FLAGS"],EMOJI_TYPE:{APPLE:"APPLE",WHATSAPP:"WHATSAPP"}},SYSTEM_MESSAGE_TYPES:["notification","notification_template","group_notification","gp2","broadcast_notification","e2e_notification","call_log","protocol"],MSG_TYPE:{NOTIFICATION:"notification",NOTIFICATION_TEMPLATE:"notification_template",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",E2E_NOTIFICATION:"e2e_notification",CALL_LOG:"call_log",PROTOCOL:"protocol",CHAT:"chat",LOCATION:"location",PAYMENT:"payment",VCARD:"vcard",CIPHERTEXT:"ciphertext",MULTI_VCARD:"multi_vcard",REVOKED:"revoked",OVERSIZED:"oversized",GROUPS_V4_INVITE:"groups_v4_invite",HSM:"hsm",TEMPLATE_BUTTON_REPLY:"template_button_reply",DEBUG:"debug",IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",ORDER:"order",LIST:"list",INTERACTIVE:"interactive",LIST_RESPONSE:"list_response",BUTTONS_RESPONSE:"buttons_response",REACTION:"reaction",NATIVE_FLOW:"native_flow",UNKNOWN:"unknown"},TEMPLATE_BUTTON_SUBTYPE:{QUICK_REPLY:"quick_reply",CALL:"call",URL:"url"},ELECTRON_PREF:{LAST_SAVED_LOCATION:"lastSavedLocation",CONTENT_SETTINGS:"contentSettings"},TOUCHBAR_MAX_EMOJIS:8,VERIFIED_LEVEL:{UNKNOWN:0,LOW:1,HIGH:2},HOSTNAME:{YOUTUBE:"youtube.com",YOUTUBE_MOBILE:"m.youtube.com",YOUTUBE_SHORTENED:"youtu.be",INSTAGRAM:"instagram.com",STREAMABLE:"streamable.com",FACEBOOK:"facebook.com",FBWATCH:"fbwat.ch",FBWATCH_ALT:"fb.watch",LASSOVIDEOS:"lassovideos.com",LASSO_SHORTENED:"las.so",SHARECHAT:"sharechat.com"},WHATSAPP_ORIGIN:"https://whatsapp.com",WHATSAPP_GRAPHQL_ENDPOINT:"https://graph.whatsapp.com/graphql",WHATSAPP_GRAPHQL_ACCESS_TOKEN:"WA|438455091201276|159a64e893c734301a4db315bba22e04",SMB_SEARCH_FILTERS:{UNREAD:"unread",GROUP:"group",BROADCAST:"broadcast",CONTACT:"contact",NON_CONTACT:"non_contact"},SMB_LABELS:{MAX_LABEL_LENGTH:100},PRODUCT_INQUIRY_TYPE:"product_inquiry",PRODUCT_LIST_ITEM_HEIGHT:96,LOADABLE_DELAY:200,TAB_ORDERS:{CHAT_STARRED_DRAWER:3,CHAT_LIST_SEARCH:3,ARCHIVED_ENTRY_POINT:4,CHAT_LIST:4,CHAT_CONTACT_LIST:4,CHAT_IMAGE_GALLERY:4,CHAT_SEARCH_MSG_LIST:4,PANEL_SEARCH_INPUT:5,CHAT_HEADER_BUTTON:6,MESSAGE_LIST_SCROLL_BUTTON:7,MESSAGE_LIST:8,PTT_OOC_BUTTON:9,COMPOSE_BOX_MENU_BUTTON:10,COMPOSE_BOX_INPUT:10,COMPOSE_BOX_ATTACH_BUTTON:10,PTT_BUTTON:11},SPEEDY_RESUME_MAX_CHATS:5e3,MEDIA_VIEWER:{ANIMATION_DURATION:500,CLOSE_ANIMATION_DURATION:200,ZOOM_IN_FACTOR:2},DEFAULT_THEME:"light",LAYOUT_2COLUMNS_MAX_WIDTH:1024,MUTE_ALWAYS_EXPIRATION_SENTINEL:-1,ANDROID_LABEL_COLOR_PALETTE:["#FF9485","#64C4FF","#FFD429","#DFAEF0","#99B6C1","#55CCB3","#FF9DFF","#D3A91D","#6D7CCE","#D7E752","#00D0E2","#FFC5C7","#93CEAC","#F74848","#00A0F2","#83E422","#FFAF04","#B5EBFF","#9BA6FF","#9368CF"],IPHONE_LABEL_COLOR_PALETTE:["#A62C71","#90A841","#C1A03F","#792138","#AE8774","#F0B330","#B6B327","#C69FCC","#8B6990","#FF8A8C","#54C265","#FF7B6B","#26C4DC","#57C9FF","#74676A","#7E90A3","#5696FF","#6E257E","#7ACBA5","#243640"],VOIP_LOG_COLOR:"#aa6627",VOIP_MAC_MINIMUM_OS_RELEASE_VERSION:"17.0.0",VOIP_WIN_MINIMUM_OS_RELEASE_VERSION:"10.0.18362",VOIP_MAX_GROUP_CALL_PARTICIPANTS:8,WAM_SYS_INFO_INIT_DELAY:5e3,KEY_NOTICE_BANNER_CLOSED_AT:"notice-banner-closed-at",KEY_NOTICE_ID:"notice-id",MARKED_AS_UNREAD:-1,MAS_APP_IDENTIFIER:"57T9237FN3.desktop.WhatsApp",RENDER_PROCESS_LOG_PATH:"render_process_problem_log.txt",WEB_IDB_DB_NAMES:{__dbnames:"__dbnames",fts_storage:"fts-storage",fts_loadgen_metadata:"loadgen-storage",_hsm_storage_DEPRECATED:"hsm-storage",jobs_storage:"jobs-storage",lru_media_storage_idb:"lru-media-storage-idb",model_storage:"model-storage",offd_storage:"offd-storage",signal_storage:"signal-storage",sw:"sw",wawc:"wawc",wawc_db_enc:"wawc_db_enc",qpl_storage:"qpl-storage"},COMPLIANCE_INFO_CODES:{INDIA:"IN"},COMPLIANCE_INFO_LENGTH:{ENTITY_NAME:1024,ENTITY_TYPE_CUSTOM:1024,EMAIL:256,GRIEVANCE_OFFICER_NAME:256,LANDLINE_NUMBER:20,MOBILE_NUMBER:20,IMPORTER_NAME:1024,STREET1:1024,STREET2:1024,CITY:1024,REGION:1024,POSTAL_CODE:12},BUSINESS_PROFILE_FIELDS_LENGTH:{WEBSITE:256,DESCRIPTION:512,EMAIL:128,ADDRESS:256},PS_KILLSWITCH_TOKEN:"ps-killswitch-token",STORAGE_DISMISS_STATE:"storage-dismiss-state",STORAGE_ALERT_FLAG:"storage-alert-flag",REQUEST_ACCOUNT_INFO_LINK:"https://faq.whatsapp.com/general/account-and-profile/how-to-request-your-account-information"};t.default=r},95770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM=t.IS_MMS_URL_SEARCH_PARAM=void 0;t.IS_MMS_URL_SEARCH_PARAM="__wa-mms";t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM="mms-type"},38839:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpamFlow=void 0;const n=r(54302)({Chat:"chat",Account:"account_info",Group:"group_info",Block:"block_dialog",Dropdown:"overflow_menu",MediaViewer:"media_viewer",MessageMenu:"message_menu"});t.SpamFlow=n},69048:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(81109)),s=n(r(45095)),o=n(r(51998)),l=n(r(6663)),c=n(r(79038));var d=new class{constructor(){this._pendingMap=new Map}_ensureWorkerInited(){this._worker||(c.default.onerror=e=>{this._onWorkerError(e)},c.default.onmessageerror=e=>{this._onMessageError(e)},c.default.onmessage=e=>{const t=e.data;this._onWorkerResponse(t)},this._worker=c.default)}_onMessageError(){}_onWorkerError(e){__LOG__(3)`FTS:client: worker error: ${e}`}_onWorkerResponse(e){const{reqId:t}=e,r=this._pendingMap.get(t);r&&(e.error?(__LOG__(3)`FTS:client: worker completed job ${r.command.operation} with error`,r.reject(new Error("FTS worker error"))):r.resolve(e.result),this._untrackInvocation(t))}startIndexer(){return this._runCommand({operation:"start-indexer"})}indexFull(){return this._runCommand({operation:"run"})}index(){return this._runCommand({operation:"consume"})}purge(e){return this._runCommand({operation:"purge",ids:e})}purgeRange(e){return this._runCommand((0,a.default)({operation:"purge-range"},e))}reInit(){return this._runCommand({operation:"re-init"})}clearInitializationPromises(){return this._runCommand({operation:"clear-init"})}search(e,t){var r=this;return(0,i.default)((function*(){const n=yield r._runCommand({operation:"find",query:e,queryOptions:t});return r._coerceToSearchResult(n)}))()}_coerceToSearchResult(e){var t=this;return(0,i.default)((function*(){if(Array.isArray(e)||"boolean"==typeof e)return{canceled:!1,eof:!0,status:404,messages:[]};{const{resolved:r,unresolved:n}=yield(0,l.default)(e.messages),{eof:i,status:a}=e;return n.length>0&&t.purge(n),{canceled:!1,eof:i,status:a,messages:r}}}))()}_runCommand(e){this._ensureWorkerInited();const t=(0,o.default)();return new Promise(((r,n)=>{this._pendingMap.set(t,{resolve:r,reject:n,command:e}),this._message({command:e,reqId:t})})).finally((()=>{this._untrackInvocation(t)}))}_untrackInvocation(e){this._pendingMap.delete(e)}_message(e){(0,s.default)(this._worker,"this._worker").postMessage(e)}};t.default=d},6663:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND)){const t=e.map((e=>+e.id)),r=new Map(e.map((e=>[+e.id,e])));return(0,i.getTable)().anyOf(["rowId"],t).then((e=>{const t=[];e.forEach((e=>{const n=(0,a.hydrateMessage)(e),i=r.get(n.rowId);null!=i&&i.id===String(n.rowId)&&i.timestamp===n.t&&i.chatId===n.id.remote.toString()&&(t.push(n),r.delete(n.rowId))}));const n=Array.from(r.keys(),(e=>String(e)));return t.sort(((e,t)=>t.t-e.t)),{resolved:t,unresolved:n}}))}return Promise.resolve({resolved:[],unresolved:[]})};var n=r(7293),i=r(90981),a=r(12896)},51998:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return r++};let r=0},7293:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.GK=t.FEATURE_CHANGE_EVENT=void 0,t.getProtobufFeatureName=S;var i=n(r(23279)),a=n(r(18446)),s=n(r(14176)),o=n(r(66678)),l=n(r(44908)),c=n(r(85564)),d=n(r(11865)),u=n(r(82492)),p=n(r(17204)),h=n(r(34342)),f=(n(r(23082)),r(21224));const _=(0,p.default)(Object.keys(f.WebFeaturesSpec.internalSpec).map((e=>[S(e),!1]))),m=!1,g={RESEND_ICON:!1,DELETE_MSG_CLEAR_MEDIA:!0,DEBUG_COMMANDS:false,MD_BACKEND:m,MD_ADV:m,MD_E2E:!1,MD_VOIP_GROUP:m,WEB_WORKER_COMPATIBLE:m,CATALOG_MANAGER:!1,WEB_VOIP_VOICE_CALL:!1,WEB_VOIP_VIDEO_CALL:!1,MEDIA_AUTO_DOWNLOAD:!1,DOWNLOAD_STATUS_THUMB_MMS:!1,MEDIA_EXISTENCE_CHECK:!1,LOG_INCOMING_MSG_MISSING_REQUIRED_PROPERTIES:!0,LOG_OUTGOING_MSG_MISSING_REQUIRED_PROPERTIES:!0,HIGH_QUALITY_VIDEO_THUMBNAILS:!0,YOUTUBE_VIDEO_PREVIEW_WITHOUT_BLUR:!1,DROP_LAST_NAME_MENTIONS:!1,PTT_WAVEFORM_SEND:!0,SEE_STATUS_VIEWERS:!0,FORMAT_BULLETED_MSG:!1,A11Y_BLOCK:!1,LARGE_STICKERS:!0,STICKER_MEDIA_VIEWER:!0,PIP_VIDEO_REDESIGN:false,NEW_CHAT_INFO:!0,DOWNLOAD_HOST_SWITCHING_ENABLED:!0,DOWNLOAD_MEDIA_CACHE:!0,SKIP_COMPLIANCE_PHONE_CHECK:!1,STATUS_MEDIA_CONTROLS:!0,UPLOAD_HOST_SWITCHING_ENABLED:!0,RICH_STATUS_REPLIES:!0,CACHE_MEDIA_ENCRYPTION_KEY:!0,FIX_MEDIA_GALLERY_MD:!1},y=[[(0,u.default)(g,_),{},{},{},{ARCHIVE_BROADCAST:!0},{RECENT_EMOJI_SYNC:!0},{},{},{},{},{},{STARRED_GIFS:!1,INDEX_RECEIVED_VCARD:!1},{STATUS_V3_UI_SENDING:!1},{MEDIAS_COUNT:!1},{},{VOIP_VOICE_CALL:!0},{DESKTOP_VOIP_VOICE_CALL:!0,DESKTOP_VOIP_VIDEO_CALL:!0,DESKTOP_VOIP_GROUP_VOICE_CALL:!1,DESKTOP_VOIP_GROUP_VIDEO_CALL:!1}]],E={KEY_PARTICIPANT:!1,RICH_TEXT:!0};function S(e){return(0,d.default)(e).toUpperCase()}const v="feature_change";t.FEATURE_CHANGE_EVENT=v;class T extends h.default{constructor(){super(),this.FEATURE_CHANGE_EVENT=v,this.silenceChangeEvents=!0,this.triggerFeaturesChangedDebounced=(0,i.default)((()=>{this.trigger(v)}),50),this.features={};const e=(0,c.default)((0,c.default)(y).map(Object.keys)).concat(Object.keys(E));this.F=(0,p.default)((0,l.default)(e).map((e=>[e,e]))),this.setVersion([0,0]),this.silenceChangeEvents=!1}setVersion(e){if(this.proto&&this.proto.length===e.length&&this.proto[0]===e[0]&&this.proto[1]===e[1])return;this.proto=e;const t=y.slice(0,e[0]+1),r=y.slice(e[0]+1,y.length),n=t[e[0]],i=n.slice(0,e[1]+1),l=n.slice(e[1]+1,n.length);t[e[0]]=i,r.unshift(l);const d=(0,o.default)(this.features);this.features=(0,u.default)((0,s.default)((0,u.default)({},...(0,c.default)(t)),(e=>!e)),this.features||{});const h=(0,u.default)({},...(0,c.default)(r));this.features=(0,s.default)(this.features,((e,t)=>!!h[t])),this.VF=(0,p.default)(Object.keys((0,u.default)({},...(0,c.default)(t))).map((e=>[e,e]))),(0,a.default)(d,this.features)||this.triggerFeaturesChanged()}setPlatform(e){let t=!1;switch(e){case"iphone":t=!1!==this.features.RECENT_EMOJI_SYNC||!1!==this.features.ARCHIVE_BROADCAST||!0!==this.features.RESEND_ICON||!1!==this.features.DELETE_MSG_CLEAR_MEDIA,this.features.RECENT_EMOJI_SYNC=!1,this.features.ARCHIVE_BROADCAST=!1,this.features.RESEND_ICON=!0,this.features.DELETE_MSG_CLEAR_MEDIA=!1;break;case"symbian":case"s40":case"bb":t=!1!==this.features.CHAT_MARK_UNSEEN,this.features.CHAT_MARK_UNSEEN=!1}t&&this.triggerFeaturesChanged()}setFeatureFromFlags(e,t,r){let n=!1;switch(r){case f.WebFeaturesFlag.FORCE_UPGRADE:switch(t){case f.WebFeaturesFlag.FORCE_UPGRADE:n=!0;break;case f.WebFeaturesFlag.PRODUCTION:case f.WebFeaturesFlag.DEVELOPMENT:case f.WebFeaturesFlag.NOT_STARTED:n=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${r} and web value is ${t}.`,SEND_LOGS("wap_feature_unreachable_code")}break;case f.WebFeaturesFlag.PRODUCTION:switch(t){case f.WebFeaturesFlag.FORCE_UPGRADE:n=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${r} and web value is ${t}.`,SEND_LOGS("wap_feature_unexpected");break;case f.WebFeaturesFlag.PRODUCTION:n=!0;break;case f.WebFeaturesFlag.DEVELOPMENT:case f.WebFeaturesFlag.NOT_STARTED:n=!1}break;case f.WebFeaturesFlag.DEVELOPMENT:switch(t){case f.WebFeaturesFlag.FORCE_UPGRADE:case f.WebFeaturesFlag.PRODUCTION:case f.WebFeaturesFlag.DEVELOPMENT:case f.WebFeaturesFlag.NOT_STARTED:n=!1}break;case f.WebFeaturesFlag.NOT_STARTED:n=!1}const i=S(e);return this.setFeature(i,n)}setFeature(e,t){let r;r=!!t;const n=this.features[e]!==r;return this.features[e]=r,n&&this.triggerFeaturesChanged(),n}setFeatures(e){const t={},r=(0,u.default)({},E,e);for(const e in r)e in this.VF||(t[e]=this.setFeature(e,r[e]));return t}supportsFeature(e){return!!this.features[e]}supportsFeatureFromFlags(e){const t=S(e);return this.supportsFeature(t)}supportsAllFeatures(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.every((e=>!!this.features[e]))}supportsAnyFeature(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.some((e=>!!this.features[e]))}resetFeatures(){this.proto=[0,0],this.features={},this.triggerFeaturesChanged()}lt(e){const t=this.proto;return e[0]>t[0]||e[0]===t[0]&&e[1]>t[1]}lte(e){const t=this.proto;return e[0]>t[0]||e[0]===t[0]&&e[1]>=t[1]}gt(e){const t=this.proto;return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]}gte(e){const t=this.proto;return e[0]<t[0]||e[0]===t[0]&&e[1]<=t[1]}triggerFeaturesChanged(){this.silenceChangeEvents||this.triggerFeaturesChangedDebounced()}overwriteDebugGKs(){}isThirdPartyStickersEnabled(){return this.supportsAllFeatures(this.F.THIRD_PARTY_STICKERS,this.F.MEDIA_UPLOAD)}isRecentStickersEnabled(){return this.supportsAnyFeature(this.F.RECENT_STICKERS_V_2,this.F.RECENT_STICKERS_V_3)&&this.supportsFeature(this.F.MEDIA_UPLOAD)}isStarredStickersEnabled(){return this.supportsFeature(this.F.STARRED_STICKERS)&&this.isRecentStickersEnabled()}isCatalogManagerEnabled(){return this.supportsAllFeatures(this.F.CATALOG_MANAGER,this.F.MD_BACKEND)}isHighQualityVideoThumbnailsEnabled(){const{UA:e}=r(65127);return!e.isGecko&&this.supportsFeature(this.F.HIGH_QUALITY_VIDEO_THUMBNAILS)}isNewChatInfoEnabled(){return!1}isMediaGalleryFixEnabled(){return this.supportsAllFeatures(this.F.MD_BACKEND,this.F.FIX_MEDIA_GALLERY_MD)}}const A=new T;t.GK=A},57701:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.adminRevokeHistorySyncConsumerEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("admin_revoke_history_sync_consumer");return!1},t.adminRevokeReceiverEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("admin_revoke_receiver");return!1},t.adminRevokeSenderEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("admin_revoke_sender");return!1},t.archiveV2Supported=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("sync_archive_v2_setting");return c.GK.supportsFeature(c.GK.F.ARCHIVE_V_2)},t.bannedShopsEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("banned_shops_ux_enabled");return!1},t.blockCatalogCreationECommerceComplianceIndia=function(e){var t;return f(null==e?void 0:e.id.user,(()=>(0,i.getABPropConfigValue)("web_abprop_block_catalog_creation_ecommerce_compliance_india")),(()=>p.ServerProps.blockCatalogCreationEcommerceComplianceIndia))&&(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===a.COMMERCE_EXPERIENCE_TYPES.NONE},t.buttonsMessagesEnabled=function(){return p.ServerProps.webButtonsMessage},t.cadminSelfDemoteEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("cadmin_self_demote");return!1},t.canAppealCollections=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("smb_collections_appeal_flow_enabled");return p.ServerProps.webCollectionsAppealEnabled},t.canDisplayLabel=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return s.Conn.isSMB;return c.GK.supportsFeature(c.GK.F.LABELS_DISPLAY)},t.canEditLabel=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return!1;return c.GK.supportsFeature(c.GK.F.LABELS_EDIT)},t.canEditLabelAssociation=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return s.Conn.isSMB;return c.GK.supportsFeature(c.GK.F.LABELS_EDIT)},t.canManageCollections=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("smb_collections_enabled");return p.ServerProps.webCollectionsManagement},t.canSeeBizProfileV3=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("business_profile_refresh_m1_enabled");return p.ServerProps.webBizProfileV3Enabled},t.canSeeECommerceComplianceIndiaCountryOriginExemptBusinessJourney=function(e){return f(e,(()=>(0,i.getABPropConfigValue)("smb_ecommerce_compliance_india_m4_5")),(()=>p.ServerProps.smbEcommerceComplianceIndiaM4_5))},t.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney=function(e){return f(e,(()=>(0,i.getABPropConfigValue)("smb_ecommerce_compliance_india_m4")),(()=>p.ServerProps.smbEcommerceComplianceIndiaM4))},t.canSeeECommerceComplianceIndiaSoftEnforcement=function(e){return h(e)},t.canSeeSMBUpsell=function(){return p.ServerProps.webSMBUpsellInBizProfile},t.canSeeStatusV3OnContact=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("web_abprop_business_profile_refresh_status_enabled");return p.ServerProps.webBizProfileV3M2},t.canSendQuickReply=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return s.Conn.isSMB;return c.GK.supportsFeature(c.GK.F.QUICK_REPLIES_QUERY)},t.canToggleCartOnOff=function(){return c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&p.ServerProps.webCartOnOffToggle},t.canViewCollections=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("consumer_collections_enabled");return p.ServerProps.webCollectionsDisplay},t.cartPropEnabled=function(){return p.ServerProps.webCart},t.clearOrDeleteChatSyncEnabled=function(){if(p.ServerProps.syncdClearChatDeleteChatEnabled&&(s.Conn.platform===s.PLATFORMS.ANDROID||s.Conn.platform===s.PLATFORMS.SMBA)&&(0,d.getPrimaryAllowsAllMutations)())return!0;return!1},t.communitiesEnabled=function(){return!1},t.countryGatingEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("country_client_gating_enabled");return!1},t.graphQLForCatalogM1Enabled=function(){return c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&(0,i.getABPropConfigValue)("web_graphql_for_catalog_m1")},t.hideUnsupportedCurrency=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("smb_hide_unsupported_currency_price");return!1},t.identityStoreCacheEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("web_identity_store_cache");return!1},t.interactiveNativeFlowMessagesEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return!(0,i.getABPropConfigValue)("interactive_message_native_flow_killswitch");return!1},t.mdMigrationExperience=function(){return s.Conn.isSMB&&p.ServerProps.webMdMigrationExperience},t.mediaUploadPrekeysFetchEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("media_upload_prekeys_fetch_enabled");return!1},t.nativeFlowMessagesEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("nfm_rendering_enabled");return!1},t.newComposeBoxInputEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("web_new_compose_box_input");return!1},t.orderDetailsCustomItemEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("order_details_custom_item_enabled");return!1},t.orderDetailsFromCartEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("order_details_from_cart_enabled");return!1},t.orderDetailsFromCatalogEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("order_details_from_catalog_enabled");return!1},t.orderManagementEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("order_management_enabled");return!1},t.parseWMIReaction=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("reaction_history_sync")||m();return!1},t.paymentBackgroundEnabled=function(){return!1},t.phaseOutNotABusiness=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("smb_phase_out_not_a_business");return!1},t.pinChatSyncEnabled=function(){if(p.ServerProps.syncdPinChatEnabled)return!!(s.Conn.platform!==s.PLATFORMS.ANDROID&&s.Conn.platform!==s.PLATFORMS.SMBA||(0,d.getPrimaryAllowsAllMutations)());return!1},t.privacyAllowContactsExceptEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("privacy_allow_contacts_except")&&u.PrimaryFeatures.contactExcept;return!1},t.privacySettingsEnabled=function(){return c.GK.supportsFeature(c.GK.F.MD_BACKEND)},t.proactivePrekeysFetchGroupSizeLimit=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("web_proactive_prekeys_fetch_group_size_limit")||0;return 0},t.productListMessageFallbackEnabled=function(){return p.ServerProps.webProductListMessageFallback},t.productListMessagesEnabled=function(){return p.ServerProps.webProductListMessage},t.quickRepliesV2Enabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return s.Conn.isSMB&&(0,i.getABPropConfigValue)("smb_quick_replies_v2_enabled");return!1},t.reactionsAnnouncementOnly=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("reactions_announcement_only");return!1},t.receiveReactionsEnabled=m,t.sendKeyDistributionMsgMinGroupSize=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("web_send_invisible_msg_min_group_size");return 0},t.sendKeyDistributionMsgToNewGroups=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("web_send_invisible_msg_to_new_groups");return!1},t.sendReactionsEnabled=_,t.shopsInteractiveMessageEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("web_shop_storefront_message");return!1},t.smartFiltersEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return s.Conn.isSMB&&(0,i.getABPropConfigValue)("smart_filters_enabled")||!s.Conn.isSMB&&(0,i.getABPropConfigValue)("smart_filters_enabled_consumer");return!1},t.smbBizProfileLoggingEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&s.Conn.isSMB)return(0,i.getABPropConfigValue)("smb_biz_profile_logging_enabled");return!1},t.smbClickToChatLoggingEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&s.Conn.isSMB)return(0,i.getABPropConfigValue)("smb_click_to_chat_logging_enabled");return!1},t.smbStatusLoggingEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&s.Conn.isSMB)return(0,i.getABPropConfigValue)("smb_status_logging_enabled");return!1},t.tos3GatingEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&!s.Conn.isSMB)return(0,i.getABPropConfigValue)("tos_3_client_gating_enabled");return!1},t.tosFetchEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&!s.Conn.isSMB)return(0,i.getABPropConfigValue)("tos_client_state_fetch_enabled");return!1},t.tosFetchIteration=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,i.getABPropConfigValue)("tos_client_state_fetch_iteration");return 0},t.web2FAEnabled=function(){return c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&(0,i.getABPropConfigValue)("web_2fa")},t.webGDPRRequestAccountInfoEnabled=function(){return c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&(0,i.getABPropConfigValue)("web_gdpr_request_account_info_enabled")},t.webMediaAutoDownloadEnabled=function(){return c.GK.supportsFeature(c.GK.F.MEDIA_AUTO_DOWNLOAD)&&p.ServerProps.webMediaAutoDownloadEnabled};var i=r(86945),a=r(93170),s=r(17239),o=n(r(69618)),l=r(79502),c=r(7293),d=r(58052),u=r(34771),p=r(64551);function h(e){return(0,l.getCountryShortcodeByPhone)(e||"")===o.default.COMPLIANCE_INFO_CODES.INDIA||c.GK.supportsFeature(c.GK.F.SKIP_COMPLIANCE_PHONE_CHECK)}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!1;return!!h(e)&&(c.GK.supportsFeature(c.GK.F.MD_BACKEND)?t():r())}function _(){return!!c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&((0,i.getABPropConfigValue)("reactions_send")&&u.PrimaryFeatures.reactionsSend)}function m(){return!!c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&((0,i.getABPropConfigValue)("reactions_receive")||_())}},9978:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyntheticCountryCode=void 0,t.bubbleCountryOnListOfCountries=u,t.formatCountriesOfOrigin=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=d(e,!0);if(""===t)return r;return u(r,t)},t.getCountries=function(){return p.apply(this,arguments)},t.getCountryName=function(){return l.apply(this,arguments)},t.unshiftNotApplicableToListOfCountries=d;var i=n(r(48926)),a=(n(r(56720)),n(r(69618))),s=n(r(43725));const o={countrySeparator:{borderBottom:"bajl15op"}};function l(){return(l=(0,i.default)((function*(e){if(!e)return;return(yield h(s.default.getLocale()))[e.toUpperCase()]}))).apply(this,arguments)}const c=r(54302)({NotApplicable:"NOT_APPLICABLE"});function d(e,t){const r=[...e];return r.unshift([String(c.NotApplicable),s.default.t(1077),s.default.t(1076),...!0===t?[o.countrySeparator]:[]]),r}function u(e,t,r){const n=e.findIndex((e=>{let[r]=e;return r===t})),[i,a]=[...e[n]],s=[...e];return s.splice(n,1),s.unshift([i,a,null,...r?[o.countrySeparator]:[]]),s}function p(){return(p=(0,i.default)((function*(){const e=yield h(s.default.getLocale());return Object.keys(e).filter((e=>!e.includes("@"))).map((t=>[t,e[t]])).sort(((e,t)=>{let[,r]=e,[,n]=t;return String(r).localeCompare(String(n))}))}))).apply(this,arguments)}function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const t=(yield r.e(5211).then(r.t.bind(r,1820,19))).default.includes(e)?e:a.default.L10N.DEFAULT;return(yield r(29127)(`./${t}.json`)).default}))).apply(this,arguments)}t.SyntheticCountryCode=c},68609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={"zh-HK":"zh-TW",pa:"pa-IN"};t.default=r},70210:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={pt:"pt_br",pt_ao:"pt",pt_ch:"pt",pt_cv:"pt",pt_fr:"pt",pt_gq:"pt",pt_gw:"pt",pt_lu:"pt",pt_mo:"pt",pt_mz:"pt",pt_pt:"pt",pt_st:"pt",pt_tl:"pt",zh_hans:"zh_cn",zh_hant:"zh_tw",zh_sg:"zh_cn",tl:"fil",in:"id",iw:"he",mo:"ro",jw:"jv",ji:"yi"};t.default=r},17588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={af:"af",ar:"ar",ar_xb:"ar-XB",az:"az",bg:"bg",bn:"bn",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",fa:"fa",fi:"fi",fil:"fil",fr:"fr",gu:"gu",he:"he",hi:"hi",hr:"hr",hu:"hu",id:"id",it:"it",ja:"ja",kk:"kk",kn:"kn",ko:"ko",lt:"lt",lv:"lv",mk:"mk",ml:"ml",mr:"mr",ms:"ms",nb:"nb",nl:"nl",pa:"pa",pl:"pl",pt:"pt",pt_br:"pt-BR",ro:"ro",ru:"ru",sk:"sk",sl:"sl",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",th:"th",tr:"tr",uk:"uk",ur:"ur",uz:"uz",vi:"vi",zh_cn:"zh-CN",zh_hk:"zh-HK",zh_tw:"zh-TW"};t.default=r},71473:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_AUTO_DOWNLOAD_SIZE=t.AutoDownloadQueue=t.AUTO_DOWNLOAD_TYPES=t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=void 0,t.shouldAutoDownloadMedia=y,t.shouldTrustMedia=g,t.validateMediaSize=E;var i=n(r(48926)),a=n(r(53781)),s=n(r(69618)),o=n(r(61516)),l=r(99234),c=r(78986),d=n(r(11339)),u=r(54676);const p=r(54302)({MEDIA:"media",MMS_THUMBNAIL:"mms_thumbnail"});t.AUTO_DOWNLOAD_TYPES=p;const h=33554432;t.MAX_AUTO_DOWNLOAD_SIZE=h;const f=524288;t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=f;const _=512e3,{MSG_TYPE:m}=s.default;function g(e){return e.isTrusted()}function y(e){switch(e.type){case m.AUDIO:case m.PTT:return(0,l.getAutoDownloadAudio)();case m.STICKER:case m.IMAGE:return(0,l.getAutoDownloadPhotos)();case m.VIDEO:return e.isGif&&e.size<_?(0,l.getAutoDownloadPhotos)():(0,l.getAutoDownloadVideos)();case m.DOCUMENT:return(0,l.getAutoDownloadDocuments)()}return!1}function E(e){switch(e.type){case m.IMAGE:case m.VIDEO:case m.DOCUMENT:return e.size<=h;case m.AUDIO:case m.PTT:return e.size<f;case m.STICKER:return!0}return!1}const S=new class{constructor(){this._downloaderQueue=new a.default(5,{photos:2,videos:1,audio:1,documents:1,mms_thumbnail:4})}getEnqueuedTasksCount(){return this._downloaderQueue.getEnqueuedTasksCount()}clearQueue(){this._downloaderQueue.clearQueue()}enqueue(e,t){if(this.getEnqueuedTasksCount()>=32)return!1;if(t===p.MEDIA&&g(e)&&e.isNewMsg&&y(e)&&E(e))switch(e.type){case m.AUDIO:case m.PTT:return this._enqueueMedia({message:e,group:"audio"}),!0;case m.IMAGE:case m.STICKER:return this._enqueueMedia({message:e,group:"photos"}),!0;case m.VIDEO:return e.isGif&&e.size<_?(this._enqueueMedia({message:e,group:"photos"}),!0):(this._enqueueMedia({message:e,group:"videos"}),!0);case m.DOCUMENT:return this._enqueueMedia({message:e,group:"documents"}),!0}if(t===p.MMS_THUMBNAIL){if(e.type===m.DOCUMENT||(0,u.typeIsUrl)(e))return this._enqueueMmsThumbnail({message:e,group:"mms_thumbnail"}),!0;if(e.type===m.IMAGE||e.type===m.VIDEO)return this._enqueueStatusV3Thumbnail({message:e,group:"mms_thumbnail"}),!0}return!1}_enqueueMedia(e){var t=this;let{message:r,group:n}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){y(r)&&(yield r.downloadMedia({downloadEvenIfExpensive:!1,rmrReason:d.default.WEBC_RMR_REASON_CODE.OTHER,isUserInitiated:!1,isAutoDownload:!0}))})),{group:n,priority:-r.t})}))()}_enqueueMmsThumbnail(e){var t=this;let{message:r,group:n}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,o.default)({msg:r})})),{group:n,priority:-r.t})}))()}_enqueueStatusV3Thumbnail(e){var t=this;let{message:r,group:n}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,c.downloadStatusV3Thumbnail)({msg:r})})),{group:n,priority:-r.t})}))()}};t.AutoDownloadQueue=S},99140:(e,t)=>{"use strict";function r(e){if(!e)return e;const t=e.replace(/[\u202a-\u202e\u2066-\u2069\u200E\u200F\u061C]/g,"�"),r=t.split(".");if(1===r.length)return t;for(let e=r.length-1;e>0;e--){const t=r[e].trim();if(t.length)return r.slice(0,e).join(".")+"."+t}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.cleanFilename=r,t.cleanIncomingFilename=function(e){if(!e)return e;const t=r(e);if(e!==t&&t){const e=t.split("."),r=e.length>=2&&e.pop();["bat","exe","cmd","com","lnk","pif","scr","vb","vbe","vbs","wsh","js","ps1","hta","sh","csh","msi","app","scpt","applescript","reg","vbe","wsf","sct"].includes(r)&&__LOG__(2,!0)`cleanIncomingFilename:extension: ${r||""}`}return t}},56406:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=function(){return!!P.canPlayOgg},t.decodeWebpToRGBANoOpaque=F,t.fetchMedia=function(){return Q.apply(this,arguments)},t.gatherAndSetMetadata=function(){return X.apply(this,arguments)},t.gatherAndSetMetadataNoOpaque=function(){return Z.apply(this,arguments)},t.getImageWidthHeight=function(e){return J(function(){var t=(0,s.default)((function*(t){t(e);const r=new Image;return yield new Promise(((t,n)=>{r.onload=t,r.onabort=()=>{n(new Error("getImageWidthHeight onabort"))},r.onerror=()=>{n(new Error("getImageWidthHeight onerror"))},r.src=e.url()})),{width:r.naturalWidth,height:r.naturalHeight}}));return function(){return t.apply(this,arguments)}}())},t.getImageWidthHeightNoOpaque=G,t.getRawDocumentMimetype=$,t.getResizedThumbData=function(e,t){return new Promise((r=>{const n=new Image;n.setAttribute("crossorigin","anonymous"),n.onload=()=>{const e=t.map((e=>{let{width:t,height:r,minWidth:i,minHeight:a,imageFormat:s,imageFormatOptions:o,keepAspectRatio:l}=e;if(null!=i&&n.width<i||null!=a&&n.height<a)return null;const c=document.createElement("canvas"),d=c.getContext("2d");let u,p,h=0,f=0;if(n.height>n.width){u=t,p=n.height/n.width*t,f=-(p-r)/2}else{p=r,u=n.width/n.height*r,h=-(u-t)/2}return l?(c.width=u,c.height=p):(c.width=t,c.height=r),d.drawImage(n,h,f,u,p),{dataUrl:c.toDataURL(s,o).replace("data:image/jpeg;base64,",""),width:c.width,height:c.height}}));r(e)},n.src=e}))},t.opaqueDataToArrayBuffer=function(e){return J((t=>{t(e);const r=e.getBlob();if(r)return U(r);{const t=(0,c.default)(e.getBase64(),"b64 should be defined");return(0,o.decodeB64)(t)}}))},t.parseWebpNoOpaque=B,t.processRawAudioVideo=function(){return V.apply(this,arguments)},t.processRawDocument=function(){return q.apply(this,arguments)},t.processRawImage=function(){return W.apply(this,arguments)},t.processRawSticker=function(){return H.apply(this,arguments)},t.shouldUseLruMediaStore=function(e){const t=e===M.MEDIA_TYPES.STICKER||e===M.MEDIA_TYPES.IMAGE,r=e===M.MEDIA_TYPES.AUDIO||e===M.MEDIA_TYPES.DOCUMENT||e===M.MEDIA_TYPES.GIF||e===M.MEDIA_TYPES.PPIC||e===M.MEDIA_TYPES.PRODUCT||e===M.MEDIA_TYPES.PTT||e===M.MEDIA_TYPES.VIDEO||e===M.MEDIA_TYPES.TEMPLATE||e===M.MEDIA_TYPES.THUMBNAIL_DOCUMENT||e===M.MEDIA_TYPES.THUMBNAIL_IMAGE||e===M.MEDIA_TYPES.THUMBNAIL_LINK||e===M.MEDIA_TYPES.THUMBNAIL_VIDEO;return(t||r)&&(0,v.getRememberMe)()},t.shouldUseMediaCache=function(e){return e===M.MEDIA_TYPES.STICKER||e===M.MEDIA_TYPES.IMAGE||e===M.MEDIA_TYPES.PRODUCT||e===M.MEDIA_TYPES.PTT||e===M.MEDIA_TYPES.AUDIO},t.videoWidthHeightDuration=function(e){return J((t=>(t(e),P.videoWidthHeightDuration(e.forceToBlob()))))},t.videoWidthHeightDurationNoOpaque=Y;var a=i(r(81109)),s=i(r(48926)),o=r(15688),l=r(50796),c=i(r(45095)),d=r(18412),u=r(67602),p=i(r(97769)),h=r(35718),f=r(99140),_=i(r(69618)),m=i(r(16185)),g=r(44365),y=n(r(55216)),E=n(r(64103)),S=r(1063),v=r(99234),T=i(r(75203)),A=r(7293),C=n(r(36638)),b=r(21921),P=n(r(97692)),M=r(61596),O=r(58668),I=r(43257),w=i(r(34949)),R=r(92108),D=r(64551),N=r(2541),L=r(78521),k=i(r(64386));function G(e){return new Promise(((t,r)=>{const n=new Image,i=window.URL.createObjectURL(e);n.onload=()=>{const e={width:n.naturalWidth,height:n.naturalHeight};window.URL.revokeObjectURL(i),t(e)},n.onabort=()=>{window.URL.revokeObjectURL(i),r(new Error("getImageWidthHeight onabort"))},n.onerror=()=>{window.URL.revokeObjectURL(i),r(new Error("getImageWidthHeight onerror"))},n.src=i}))}function U(e){return(0,S.blobToArrayBuffer)(e).catch((e=>{throw __LOG__(3)`MediaUtils error: ${e}`,e}))}function F(){return x.apply(this,arguments)}function x(){return(x=(0,s.default)((function*(e){const t=yield U(e);return(0,m.default)(t)}))).apply(this,arguments)}function B(){return K.apply(this,arguments)}function K(){return(K=(0,s.default)((function*(e){const t=yield U(e);return(0,R.parseWebp)(t)}))).apply(this,arguments)}function Y(e){return P.videoWidthHeightDuration(e)}function j(e,t){return J(function(){var r=(0,s.default)((function*(r){r(e);const n=yield P.transcode(e.forceToBlob(),t).then((e=>w.default.createFromData(e,e.type)));return r(n),n.autorelease(),n}));return function(){return r.apply(this,arguments)}}())}function W(){return(W=(0,s.default)((function*(e,t){const{transparency:r,minDimension:n}=null!=t?t:{},i=e.forceToBlob(),{width:a,height:s,images:o}=yield C.rotateAndResize(i,D.ServerProps.imageMaxEdge,C.BLOB|C.CANVAS,{transparency:r,minDimension:n}),{images:l}=yield C.rotateAndResize(o.canvas,_.default.IMG_THUMB_MAX_EDGE,C.DATA_URL|C.CANVAS),c=(0,h.getResizedDataUrl)(l.canvas,"image/jpeg",2e4),d=c?N.URL.parseDataURL(c).data:null;return d||__LOG__(2)`processRawImage: Failed to reach max thumbnail size, preview will be null`,{type:O.OUTWARD_TYPES.IMAGE,mediaBlob:o.blob,mimetype:o.blob.type,fullWidth:a,fullHeight:s,preview:d}}))).apply(this,arguments)}function H(){return(H=(0,s.default)((function*(e){const t=e.forceToBlob(),{width:r,height:n,images:i}=yield C.rotateAndResize(t,D.ServerProps.imageMaxEdge,C.BLOB,{transparency:!0}),a=yield C.toWebpSticker(i.blob),s=yield w.default.createFromData(a,a.type);return{type:O.OUTWARD_TYPES.STICKER,mediaBlob:s,mimetype:a.type,fullWidth:r,fullHeight:n}}))).apply(this,arguments)}function V(){return(V=(0,s.default)((function*(e,t,r,n,i){var s;const o=e.forceToBlob(),l=yield(0,b.checkAndRepair)(o,!!n);if(!l)throw __LOG__(3)`processRawAudioVideo bad video file ${o.type}`,new E.InvalidMediaFileType;const c=l.type,d=l.file,u=n||l.isGif;switch((0,S.typeFromMimetype)(c)){case S.FILETYPE.VIDEO:if(t)throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: ptt became video"),new E.InvalidMediaFileType;const e={type:O.OUTWARD_TYPES.VIDEO,mediaBlob:d,mimetype:c,isGif:u,gifAttribution:u?i||0:void 0};if(r&&null!=r.duration&&null!=r.fullHeight&&0!==r.fullHeight&&null!=r.fullWidth&&0!==r.fullWidth&&r.preview)return(0,a.default)((0,a.default)({},e),{},{fullWidth:r.fullWidth,fullHeight:r.fullHeight,preview:r.preview,duration:r.duration.toString()});const{duration:n,thumbs:[o,l]}=yield C.generateVideoThumbsAndDuration({file:d,maxDimensions:[_.default.IMG_THUMB_MAX_EDGE,_.default.VIDEO_THUMB_MAX_EDGE],debugHint:"processRawAudioVideo"}),p=yield w.default.createFromBase64Jpeg(N.URL.parseDataURL(l.url).data);return(0,a.default)((0,a.default)({},e),{},{fullWidth:o.fullWidth,fullHeight:o.fullHeight,preview:N.URL.parseDataURL(o.url).data,fullPreviewData:p,duration:n.toString()});case S.FILETYPE.AUDIO:const h=null!==(s=null==r?void 0:r.duration)&&void 0!==s?s:yield(0,S.getAudioDuration)(d);return{type:t?O.OUTWARD_TYPES.PTT:O.OUTWARD_TYPES.AUDIO,mediaBlob:d,mimetype:c,duration:h.toString(),waveform:null==r?void 0:r.waveform};default:throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: audio/video became other"),new Error(`audio/video became ${c}`)}}))).apply(this,arguments)}function $(){return z.apply(this,arguments)}function z(){return(z=(0,s.default)((function*(e,t){const r=e.type;if(r){if("*"===I.DOC_MIMES||I.DOC_MIMES.includes(r))return r;throw new E.InvalidMediaFileType(`disallowed mimetype ${r}`)}{const r=Math.min(I.MIMETYPE_DETERMINING_LENGTH,e.size),i=yield U(e.slice(0,r)),a=new Uint8Array(i);var n;if((0,I.isMsCompoundFileBinaryFormat)(a.subarray(0,8)))return null!=t&&null!==(n=(0,S.getMimeTypeForFilepath)(t))&&void 0!==n?n:I.MSCFB_MIME;const s=(0,p.default)(a);if(null==s?void 0:s.mime){const e=(0,I.isAllowedDocumentMimetype)(s.mime,t,!0);if(e)return e}else if(t){const e=(0,S.getMimeTypeForFilepath)(t);if(e)return e}throw new E.InvalidMediaFileType(`type: ${String(e.type)} name: ${String(t)}`)}}))).apply(this,arguments)}function q(){return(q=(0,s.default)((function*(e,t,r,n){var i,a;const s=e.forceToBlob(),o=(0,f.cleanFilename)(s.name||t||null),l=yield $(s,o),c=r?(0,S.blobToText)(s):null,[d,u]=yield Promise.all([y.enrich(s,l),c]),p=null!==(i=null==d||null===(a=d.microThumbnail)||void 0===a?void 0:a.dataUrl)&&void 0!==i?i:null==d?void 0:d.thumbUrl,h=p?N.URL.parseDataURL(p).data:null;return{type:O.OUTWARD_TYPES.DOCUMENT,mediaBlob:yield w.default.createFromData(s,l),mimetype:l,filename:o||void 0,documentPreview:d,preview:h,fullPreviewData:null==d?void 0:d.fullPreviewData,fullPreviewSize:d?{width:d.width,height:d.height}:null,pageCount:null!=n?n:null==d?void 0:d.pdfPages,isVcardOverMmsDocument:r,parsedVcards:u?(0,L.parseMultiVcard)(u):null}}))).apply(this,arguments)}function J(e){const t=[];return(0,d.promiseCallSync)(e,null,(function(e){e.retain(),t.push(e)})).finally((()=>{for(let e=0;e<t.length;e++)t[e].autorelease()}))}function Q(){return(Q=(0,s.default)((function*(e){const t=yield(0,T.default)(e,"GET",null,k.default.RESP_TYPE.ARRAY_BUFFER);return t?Promise.resolve({result:t.response,status:t.status}):Promise.resolve(null)}))).apply(this,arguments)}function X(){return(X=(0,s.default)((function*(e,t){let r,n;t.retain();try{switch(e.type){case O.TYPE.VIDEO:const i=t.forceToBlob(),{thumbs:[a],duration:s}=yield C.generateVideoThumbsAndDuration({file:i,maxDimensions:[_.default.VIDEO_THUMB_MAX_EDGE],debugHint:"gatherAndSetMetadata"});let o;A.GK.isHighQualityVideoThumbnailsEnabled()&&(o=yield w.default.createFromBase64Jpeg(N.URL.parseDataURL(a.url).data)),r={mediaBlob:t,renderableUrl:t.url(),fullWidth:a.fullWidth,fullHeight:a.fullHeight,duration:void 0!==s?`${Math.ceil(s)}`:void 0,durationFloat:s,fullPreviewData:o};break;case O.TYPE.AUDIO:const l=yield j(t);l.retain(),r={mediaBlob:l,renderableUrl:l.url()},n=()=>l.autorelease();break;default:e.type!==O.TYPE.IMAGE&&e.type!==O.TYPE.STICKER||(__LOG__(4,void 0,new Error,!0)`object type: ${e.type||""}`,SEND_LOGS("Entering gatherAndSetMetadata (with OpaqueData) unexpectedly")),r={mediaBlob:t,renderableUrl:t.url()}}e.consolidate(r)}catch(r){if(!(r instanceof E.MediaUnsupportedError))throw r;e.consolidate({mediaBlob:t,renderableUrl:t.url()})}finally{t.autorelease(),null!=n&&n()}}))).apply(this,arguments)}function Z(){return(Z=(0,s.default)((function*(e,t){const r=yield Promise.resolve().then((()=>{switch(e.type){case O.TYPE.VIDEO:return Y(t).then((e=>({fullWidth:e.width,fullHeight:e.height,duration:void 0!==e.duration?`${Math.ceil(e.duration)}`:void 0,durationFloat:e.duration})));case O.TYPE.IMAGE:return null!=e.contentInfo.fullHeight&&null!=e.contentInfo.fullWidth&&e.size===t.size?null:G(t).then((e=>({fullWidth:e.width,fullHeight:e.height,size:t.size})));case O.TYPE.STICKER:return(0,g.detectWebpSupport)().then((e=>e?(0,u.promiseProps)({widthHeight:G(t),webpData:B(t)}).then((e=>({fullWidth:e.widthHeight.width,fullHeight:e.widthHeight.height,animationDuration:e.webpData.animationDuration,firstFrameLength:e.webpData.firstFrameLength,singleLoopDuration:e.webpData.singleLoopDuration,emojis:e.webpData.emojis,isAnimated:e.webpData.animationDuration>0,size:t.size,isFirstParty:e.webpData.isFirstParty,isFromStickerMaker:e.webpData.isFromStickerMaker,stickerPackId:e.webpData.stickerPackId,stickerPackName:e.webpData.stickerPackName,stickerPackPublisher:e.webpData.stickerPackPublisher}))):B(t).then(function(){var e=(0,s.default)((function*(e){let{animationDuration:r,firstFrameLength:n,singleLoopDuration:i,emojis:a,isFirstParty:s,isFromStickerMaker:o,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d}=e;if(r>0)return{animationDuration:r,firstFrameLength:n,singleLoopDuration:i,emojis:a,isAnimated:!0,size:t.size,isFirstParty:s,isFromStickerMaker:o,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d};const u=yield F(t);return{animationDuration:r,rgbaBuffer:u.rgbaBuffer,rgbaWidth:u.width,rgbaHeight:u.height,emojis:a,isAnimated:!1,size:t.size,isFirstParty:s,isFromStickerMaker:o,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d}}));return function(){return e.apply(this,arguments)}}())));case O.TYPE.AUDIO:default:return{}}})).catch((0,l.filteredCatch)(E.MediaUnsupportedError,(t=>{throw e.consolidate({}),t})));null!=r&&e.consolidate(r)}))).apply(this,arguments)}},34949:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(15688),a=n(r(45095)),s=r(57319),o=r(1063);let l=[];const c=new s.ShiftTimer((function(){const e=l;l=[];for(let t=0;t<e.length;t++){const r=e[t];r._inAutoreleasePool=!1,0!==r._retainCount||r.released||(r.released=!0,r._releaseImpl())}}));class d{constructor(){this._retainCount=1,this._inAutoreleasePool=!1,this.released=!1,this._b64=void 0,this._blob=void 0,this._url=void 0,this._mimetype=void 0,this._released=void 0}retain(){if(this.released)throw __LOG__(3)`OpaqueData:retain called on released OpaqueData`,new Error("OpaqueData:retain called on released OpaqueData");this._retainCount++}autorelease(){this.released?__LOG__(3)`OpaqueData:autorelease called on released object`:0===this._retainCount?__LOG__(3)`OpaqueData:autorelease too many release calls`:1===this._retainCount?(this._retainCount=0,this._inAutoreleasePool||(this._inAutoreleasePool=!0,l.push(this),c.onOrBefore(1e3))):this._retainCount--}autoreleaseWhenPromiseCompletes(e){const t=()=>{this.autorelease()};e.then(t,t)}throwIfReleased(e){if(this.released)throw __LOG__(4,void 0,new Error)`${e} called on released OpaqueData`,new Error(`${e} called on released OpaqueData`);0===this._retainCount&&__LOG__(4,void 0,new Error)`${e} called on unretained OpaqueData`}url(){return this.throwIfReleased("OpaqueData:url"),this._url?this._url:this._b64?(this._url=`data:image/jpeg;base64,${this._b64}`,this._url):(this._url=window.URL.createObjectURL((0,a.default)(this._blob,"this._blob")),this._url)}getBlob(){return this._blob}getBase64(){return this._b64}validate(){return this._released?Promise.resolve(!1):this._blob?(0,o.validateBlob)(this._blob):Promise.resolve(!0)}size(){return this.throwIfReleased("OpaqueData:size"),this._blob?this._blob.size:null!=this._b64?(0,i.sizeWhenB64Decoded)(this._b64):(__LOG__(4,void 0,new Error,!0)`OpaqueData:size returned 0`,SEND_LOGS("opaque-data-size-0"),0)}formData(){return this.throwIfReleased("OpaqueData:formData"),this.forceToBlob()}type(){return this.throwIfReleased("OpaqueData:type"),this._mimetype||"undefined"}forceToBlob(){this.throwIfReleased("OpaqueData:forceToBlob");const e=this._blob;if(e)return e;const t=this._b64;if(t){this._b64=void 0,this._url=void 0;const e=this._mimetype;return this._blob=new Blob([(0,i.decodeB64)(t)],e?{type:e}:void 0)}throw new Error("OpaqueData:forceToBlob no b64 or blob")}_releaseImpl(){this._mimetype=void 0;this._blob?(this._blob=void 0,this._url&&(window.URL.revokeObjectURL(this._url),this._url=void 0)):(this._b64=void 0,this._url=void 0)}isBlobEqual(e){return e?this._blob===e._blob:!this._blob}}t.default=d,d.createFromBase64Jpeg=e=>new Promise((t=>{const r=new d;return r._b64=e,r._mimetype="image/jpeg",t(r)})),d.createFromData=(e,t)=>new Promise((r=>{const n=new d;return n._blob=e instanceof Blob&&e.type===t?e:new Blob([e],{type:t}),n._mimetype=t,r(n)}))},61516:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(89385),s=r(15688),o=n(r(45095)),l=n(r(70714)),c=n(r(69618)),d=r(26384),u=n(r(92360)),p=r(61596),h=n(r(34949)),f=n(r(28245));function _(){return(_=(0,i.default)((function*(e){const{msg:t,isPreload:r,signal:n}=e,{thumbnailSha256:i,thumbnailEncSha256:_,thumbnailDirectPath:m,mediaKey:g,mediaKeyTimestamp:y}=t;if(!m||!_||!i||null==g||null==y)return;if(!(t.type!==c.default.MSG_TYPE.DOCUMENT&&t.type!==c.default.MSG_TYPE.INTERACTIVE||(0,p.getMsgMediaType)(t)!==p.MEDIA_TYPES.DOCUMENT||null!=t.thumbnailHeight&&null!=t.thumbnailWidth))return;const E=t.asUrl;if(!E||null!=E.thumbnailHeight&&null!=E.thumbnailWidth){__LOG__(2)`media.downloadMmsThumbnail: start`;try{const e=yield d.downloadManager.downloadAndDecrypt({directPath:m,encFilehash:_,filehash:i,mediaKey:g,mediaKeyTimestamp:y,type:(0,u.default)(t),signal:n||(new l.default).signal,userDownloadAttemptCount:0,isPreload:r});if(E)E.thumbnailHQ=(0,s.encodeB64)(e);else{const r=(0,o.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),n={fullPreviewData:yield h.default.createFromData(e,"image/jpeg")};t.type===c.default.MSG_TYPE.DOCUMENT&&(n.fullPreviewSize={height:(0,o.default)(t.thumbnailHeight,"msg.thumbnailHeight"),width:(0,o.default)(t.thumbnailWidth,"msg.thumbnailWidth")}),r.consolidate(n)}__LOG__(2)`media.downloadMmsThumbnail: success`}catch(e){if(e.name===a.ABORT_ERROR)return void __LOG__(2)`media.downloadMmsThumbnail aborted`;__LOG__(3,!0)`media.downloadMmsThumbnail: error\n${(0,f.default)(e)}`}}}))).apply(this,arguments)}},92360:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e.type){case i.default.MSG_TYPE.DOCUMENT:return s.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case i.default.MSG_TYPE.VIDEO:return s.MEDIA_TYPES.THUMBNAIL_VIDEO;case i.default.MSG_TYPE.IMAGE:return s.MEDIA_TYPES.THUMBNAIL_IMAGE;case i.default.MSG_TYPE.CHAT:return s.MEDIA_TYPES.THUMBNAIL_LINK;case i.default.MSG_TYPE.INTERACTIVE:{const{interactiveHeader:t}=e;if(null!=(null==t?void 0:t.mediaType))switch(t.mediaType){case a.InteractiveMessageHeaderMediaType.DOCUMENT:return s.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case a.InteractiveMessageHeaderMediaType.VIDEO:return s.MEDIA_TYPES.THUMBNAIL_VIDEO}break}}throw new Error("getThumbnailTypeForMsg: Unsupported msg type")};var i=n(r(69618)),a=r(34535),s=r(61596)},46220:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e?(0,a.unproxy)(e).isGroup?i.default.UPLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL:i.default.UPLOAD_ORIGIN_TYPE.UNKNOWN};var i=n(r(11339)),a=r(31019)},84866:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBlobCacheImpl=t.MediaBlobCache=void 0;var i=n(r(23493)),a=r(42430),s=r(88297),o=r(58668);class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25e7;if(this._filehashesToCleanUp=new Set,this.getOrCreateURL=e=>{if(this._filehashToUrl[e])return this.touch(e),this._filehashToUrl[e];const t=this.get(e);if(!t)throw new Error(`There is no blob matching filehash: ${e}.`);const r=window.URL.createObjectURL(t);return this._filehashToUrl[e]=r,r},this.revokeURL=(e,t)=>{if(t){if(this._filehashToUrl[e]!==t)throw new Error("The url provided does not match the filehash.");delete this._filehashToUrl[e],window.URL.revokeObjectURL(t)}},this._scheduleCleanup=(0,i.default)((()=>{this._filehashesToCleanUp.forEach((e=>{window.URL.revokeObjectURL(this._filehashToUrl[e]),delete this._filehashToUrl[e]})),this._filehashesToCleanUp.clear()}),0,{leading:!1}),null!=e&&e<0)throw new Error("Size limit cannot be a negative number.");this._usageCounts={},this._filehashToUrl={},this._lruCache=new a.LruCache({sizeLimit:e,getSize:e=>e.size,onEvict:e=>{this._filehashToUrl[e]&&0===this._getUsageCount(e)&&(this.revokeURL(e,this._filehashToUrl[e]),(0,s.getOrCreateMediaObject)(e).consolidate({downloadStage:o.DOWNLOAD_STAGE.INIT,progressiveStage:null}))},shouldEvict:e=>0===this._getUsageCount(e)})}get(e){return this._lruCache.get(e)}has(e){return this._lruCache.has(e)}touch(e){this.get(e)}put(e,t){this._lruCache.put(e,t)}clear(){this._scheduleCleanup.flush(),this._usageCounts={},Object.keys(this._filehashToUrl).forEach((e=>{this._filehashToUrl[e]&&this.revokeURL(e,this._filehashToUrl[e])})),this._filehashToUrl={},this._lruCache.clear()}increaseUsageCount(e){this._usageCounts[e]=this._getUsageCount(e)+1,this._filehashesToCleanUp.delete(e)}decreaseUsageCount(e){const t=this._getUsageCount(e);if(t<=0)throw new Error("Cannot decrease the usageCount to a negative number.");this._usageCounts[e]=t-1,0===this._usageCounts[e]&&(delete this._usageCounts[e],this._filehashesToCleanUp.add(e),this._scheduleCleanup())}_getUsageCount(e){return this._usageCounts[e]||0}}t.MediaBlobCacheImpl=l;const c=new l;t.MediaBlobCache=c},45554:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaKeyCache=void 0,t.shouldUseMediaKeyCache=function(){if(a.GK.supportsAllFeatures(a.GK.F.MD_BACKEND,a.GK.F.CACHE_MEDIA_ENCRYPTION_KEY))return(0,i.getABPropConfigValue)("web_abprop_document_resume_upload");return!1};var n=r(42430),i=r(86945),a=r(7293);const s={sizeLimit:10,getSize:()=>1};const o=new n.LruCache(s);t.MediaKeyCache=o},45987:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanJPEG=function(e){const t=new n.Binary(e),r=new n.Binary(e),K=new n.Binary;let Y,j=!1,W=!1,H=!1,V=!1;const $={version:257,densityUnits:0,xDensity:1,yDensity:1};if(255!==t.readUint8()||t.readUint8()!==y)throw new Error("SOI marker not at the start of the file.");r.advance(2);let z;for(;null!=z||t.size();){if(void 0===z){const e=t.readUint8();if(255!==e)throw new Error(`0x${e.toString(16)} is not a marker prefix.`);z=t.readUint8()}switch(z){case A:if(W)Y=t.readUint16(),r.advance(Y+2),t.advance(t.size()-r.size());else{if(Y=t.readUint16(),"JFIF\0"!==t.readString(5))throw new Error("APP0 marker missing 'JFIF' magic bytes.");V=!0,$.version=t.readUint16(),$.densityUnits=t.readUint8(),$.xDensity=t.readUint16(),$.yDensity=t.readUint16(),r.advance(Y+2),t.advance(t.size()-r.size()),W=!0}break;case S:if(!H&&!V)throw new Error("Missing magic bytes marker.");let e,n;t.advance(t.readUint16()-2);let y=t.readUint8();for(;t.size();){if(n=t.readUint8(),e=255===y&&!B.includes(n),e){z=n;break}y=n}K.writeByteArray(r.readByteArray(r.size()-t.size()-2));continue;case C:if(Y=t.readUint16(),!H&&"Exif\0\0"!==t.readString(6))throw new Error("APP1 marker missing 'EXIF' magic bytes.");H=!0,r.advance(Y+2),t.advance(t.size()-r.size());break;case G:case x:if(!H&&!V)throw new Error("Missing magic bytes marker.");Y=t.readUint16(),r.advance(Y+2),t.advance(t.size()-r.size());break;case E:if(!H&&!V)throw new Error("Missing magic bytes marker.");j=!0,K.writeByteArray(r.readByteArray(2));break;case i:case a:case s:case o:case c:case d:case u:case p:case h:case f:case _:case m:case g:case v:case l:case T:if(!H&&!V)throw new Error("Missing magic bytes marker.");Y=t.readUint16(),K.writeByteArray(r.readByteArray(2+Y)),t.advance(t.size()-r.size());break;case b:case P:case M:case O:case I:case w:case R:case D:case N:case L:case k:case U:case F:throw new Error(`Received unexpected APP marker 0x${z.toString(16)}`);default:throw new Error(`Did not understand marker: 0x${z.toString(16)}`)}if(z=void 0,j)break}if(!j)throw new Error("No EOI tag found.");const q=function(e){const t=new n.Binary;return t.writeBytes(255,216,255,224,0,16,74,70,73,70,0),t.writeUint16(e.version),t.writeUint8(e.densityUnits),t.writeUint16(e.xDensity),t.writeUint16(e.yDensity),t.writeBytes(0,0),t.readByteArray()}($);return new Blob([q,K.readByteArray()],{type:"image/jpeg"})};var n=r(8584);const i=192,a=193,s=194,o=195,l=196,c=197,d=198,u=199,p=201,h=202,f=203,_=205,m=206,g=207,y=216,E=217,S=218,v=219,T=221,A=224,C=225,b=226,P=227,M=228,O=229,I=230,w=231,R=232,D=233,N=234,L=235,k=236,G=237,U=238,F=239,x=254,B=[0,208,209,210,211,212,213,214,215]},84979:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(62918));const s={ignoreSearch:!0,ignoreMethod:!0,ignoreVary:!0};class o extends a.default{constructor(e){super(),this._encodeKey=e=>{const t=encodeURIComponent(e);return`https://_media_cache_v2_.whatsapp.com/${encodeURIComponent(this.storeName)}_${t}`},this.storeName=e}doGet(e){const t=this._encodeKey(e);return this.cacheStore?Promise.resolve(this.cacheStore.match(t,s).then((e=>e?e.arrayBuffer():null))):(__LOG__(3)`Unable to get. This error can occur if abstract method doGet gets called.`,Promise.reject(new Error("Unable to get")))}doPut(e,t){const r=this._encodeKey(e);return this.cacheStore?Promise.resolve(this.cacheStore.put(r,new Response(t)).then((()=>t))):(__LOG__(3)`Unable to put. This error can occur if abstract method doPut gets called.`,Promise.reject(new Error("Unable to put in cache")))}doDel(e){var t=this;return(0,i.default)((function*(){const r=t._encodeKey(e);if(!t.cacheStore)return __LOG__(3)`Unable to delete. This error can occur if abstract method doDel gets called.`,Promise.reject(new Error("Unable to delete"));yield t.cacheStore.delete(r,s)}))()}doClear(){return Promise.resolve(caches.delete(this.storeName).then((e=>{e||__LOG__(2)`Tried to delete a non-existent cache: ${this.storeName}`})))}doOpen(){return caches.open(this.storeName).then((e=>{this.cacheStore=e})).catch((e=>{throw this.cacheStore=null,__LOG__(3)`Unable to open cache: ${this.storeName}, error: ${e}`,e}))}doClose(){return this.cacheStore=null,Promise.resolve()}}t.default=o},48520:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(62918)),s=n(r(91481)),o=r(29830);class l extends a.default{constructor(){super(),this._store=new s.default(o.initialize,o.IdbArrayBufferTable)}doGet(e){var t=this;return(0,i.default)((function*(){const r=yield t._store.get(e);return r?r.data:null}))()}doQueryByIndex(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doGetAll(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doPut(e,t){var r=this;return(0,i.default)((function*(){return(yield r._store.put(e,{id:e,data:t})).data}))()}doDel(e){return this._store.del(e)}doCount(){return this._store.count()}clear(){return this._store.clear()}doOpen(){return Promise.resolve()}doClose(){return Promise.resolve()}}t.default=l},25289:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(62918));class a extends i.default{get(){return Promise.resolve()}queryByIndex(){return Promise.resolve([])}getAll(){return Promise.resolve([])}put(e,t){return Promise.resolve(t)}del(){return Promise.resolve()}count(){return Promise.resolve(0)}clear(){return Promise.resolve()}}t.default=a},55975:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaStore=t.LruMediaStore=void 0;var i=n(r(48926)),a=n(r(51463)),s=n(r(84979)),o=n(r(48520)),l=n(r(25289)),c=r(64103),d=n(r(2680)),u=n(r(71058)),p=n(r(28245));class h{constructor(){this._getBackingStore=(0,a.default)((0,i.default)((function*(){try{const e=function(){const e=function(){if(null!=d.default&&"caches"in self)return new s.default("lru-media-array-buffer-cache");return null!=d.default?new o.default("media_lru_buffer"):null}();return null==e?null:new u.default({maxSize:Number.MAX_SAFE_INTEGER,arrayBufferStore:e})}();if(null!=e)return yield e.open(),e}catch(e){if("SecurityError"===e.name)__LOG__(3)`There was a security error attempting to open the media storage. \
This likely indicates a permissions error. Falling back to dummy \
(no-op) storage.`;else{if(e instanceof c.DbOnLogoutAbort)throw e;__LOG__(4,!0,new Error,!0)`Failed to initialize media store! Falling back to dummy (no-op) storage. Error:
${(0,p.default)(e)}`,SEND_LOGS("Failed to initialize media store")}}return new l.default})))}get(e){var t=this;return(0,i.default)((function*(){return(yield t._getBackingStore()).get(e)}))()}queryByIndex(e,t){var r=this;return(0,i.default)((function*(){return(yield r._getBackingStore()).queryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).getAll()}))()}put(e,t){var r=this;return(0,i.default)((function*(){return(yield r._getBackingStore()).put(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){const r=yield t._getBackingStore();yield r.del(e)}))()}count(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).count()}))()}clear(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.clear()}))()}open(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.open()}))()}close(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.close()}))()}}t.MediaStore=h;const f=new h;t.LruMediaStore=f},71058:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(27870),o=n(r(86128)),l=n(r(62918)),c=n(r(96222)),d=n(r(37804));class u extends l.default{constructor(e){var t;super(),t=this,this._queueMap=new s.PromiseQueueMap,this.updateMaxSizeInterval=null,this._dispose=e=>this._bufferStore.del(e),this.doPut=(e,r)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(r.byteLength>t.getMaxSize())return r;if(r.byteLength>3e7)return r;const n={id:e,timestamp:(new Date).getTime(),size:r.byteLength};try{return yield t._metaInfoStore.putObject(n),t._bufferStore.put(e,r)}catch(e){if(e instanceof o.default.AbortError&&e.message.includes("QuotaExceededError"))return __LOG__(2)`LruMediaStore: encounter QuotaExceededError, thus shrink the size of LruMediaStore`,void t.setMaxSize((0,a.default)(t.getCurrentSize(),"_this.getCurrentSize()")/2);throw e}}))),this.doDel=e=>this._queueMap.enqueue(e,(()=>this._metaInfoStore.del(e))),this._updateMaxSize=(0,i.default)((function*(){const e=yield(0,c.default)();if(null==e)return void t._clearStoreForThisSession();const r=t.getCurrentSize();if(null==r)return;const n=e.available,i=t._calculateTargetedBufferSize(e.quota);if(n>i)return;const a=i-n;r<a?t._clearStoreForThisSession():t.setMaxSize(r-a)}));const{maxSize:r,arrayBufferStore:n}=e;this._bufferStore=n,this._metaInfoStore=new d.default(r,this._dispose),this.updateMaxSizeInterval=setInterval(this._updateMaxSize,6e4)}doGet(e){var t=this;return(0,i.default)((function*(){const r=yield t._bufferStore.get(e);return null!=r&&t.put(e,r),r}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._bufferStore.clear(),e._metaInfoStore.clear()}))()}doCount(){return this._metaInfoStore.count()}doOpen(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.open(),e._bufferStore.open()])}))()}doClose(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.close(),e._bufferStore.close()])}))()}getCurrentSize(){return this._metaInfoStore.getCurrentSize()}getMaxSize(){return this._metaInfoStore.getMaxSize()}setMaxSize(e){return this._metaInfoStore.setMaxSize(e)}_calculateTargetedBufferSize(e){const t=Math.floor(.01*e);return t<1e8?1e8:t>5e8?5e8:t}_clearStoreForThisSession(){this.setMaxSize(0),this.updateMaxSizeInterval&&(clearInterval(this.updateMaxSizeInterval),this.updateMaxSizeInterval=null)}}t.default=u},37804:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(91481)),a=r(29830),s=n(r(3459));class o extends s.default{constructor(e,t){super(new i.default(a.initialize,a.IdbMetaInfoTable),{primaryIndex:a.metaInfoPrimaryIndex,dateIndex:a.metaInfoDateIndex,sizeIndex:a.metaInfoSizeIndex,maxSize:e,dispose:t})}}t.default=o},91481:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(62918));class s extends a.default{constructor(e,t){super(),this._initialize=e,this._table=t}doGet(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.get(e)}))()}doQueryByIndex(e,t){var r=this;return(0,i.default)((function*(){return yield r._initialize(),r._table.all({limit:t.limit,index:[e]})}))()}doGetAll(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.all()}))()}doPut(e,t){var r=this;return(0,i.default)((function*(){return yield r._initialize().then((()=>r._table.createOrReplace(t))),t}))()}doDel(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.remove(e)}))()}doCount(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.count()}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.clear(!0)}))()}doOpen(){return this._initialize()}doClose(){return Promise.resolve()}}t.default=s},3459:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(4352),o=r(27870),l=r(57319),c=n(r(62918));class d extends c.default{constructor(e,t){var r;if(super(),r=this,this._queueMap=new o.PromiseQueueMap,this._purge=()=>{if(this._pendingPurgePromise)return this._pendingPurgePromise;const e=this.open().then((()=>(0,s.promiseLoop)(function(){var e=(0,i.default)((function*(e){const t=()=>{r._pendingPurgePromise=null,e()},n=r.getCurrentSize();if(null==n||n<=r._maxSize)return void t();const a=yield r.queryOneByIndex(r._dateIndex),s=r.getCurrentSize(),o=r._maxSize;if(null==s||s<=o)return void t();if(null==a)return(0,i.default)((function*(){const e=yield r.count();__LOG__(3,void 0,void 0,!0)`SizeLruObjectStore: _purge error: No row returned but currentSize (${s}) > maxSize (${o}). Row count is ${e} (may be out of date).`,SEND_LOGS("size-lru-store-invalid-empty")}))(),Promise.reject(new Error("Query returned no result but currentSize > maxSize"));const l=a[r._primaryIndex];return r.del(l)}));return function(){return e.apply(this,arguments)}}())));return this._pendingPurgePromise=e},this._schedulePurge=()=>{this._purgeTimer.debounce(2e3)},this.doPut=(e,t)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(t[r._primaryIndex]!==e)throw new Error("The key you provide does not match.");const n=yield r._store.get(e),i=null==n?0:r._getSize(n),s=r._getSize(t),o=yield r._store.put(e,t);return r._currentSize=(0,a.default)(r.getCurrentSize(),"_this.getCurrentSize()")-i+s,r._schedulePurge(),o}))),this.doDel=e=>this._queueMap.enqueue(e,(0,i.default)((function*(){const t=yield r._store.get(e);if(null!=t){try{yield r._dispose(e,t)}catch(e){throw __LOG__(3,void 0,void 0,!0)`SizeLRUObjectStore: _dispose error: ${e.message}`,SEND_LOGS("size-lru-store-dispose-error"),e}yield r._store.del(e),r._currentSize=(0,a.default)(r.getCurrentSize(),"_this.getCurrentSize()")-r._getSize(t)}}))),this._store=e,this._primaryIndex=t.primaryIndex,this._dateIndex=t.dateIndex,this._sizeIndex=t.sizeIndex,t.maxSize<0)throw new Error("Cannot set max size to a negative number");this._maxSize=Math.floor(t.maxSize),this._dispose=t.dispose,this._purgeTimer=new l.ShiftTimer((()=>{this._purge().catch((e=>{__LOG__(3)`Error while purging: ${e.message}`}))}))}getCurrentSize(){return this._currentSize}getMaxSize(){return this._maxSize}setMaxSize(e){return e<0?Promise.reject(new Error("Cannot set size to a negative number")):(this._maxSize=Math.floor(e),this._purgeTimer.cancel(),this._purge().catch((e=>{__LOG__(3)`Error while purging during setMaxSize: ${e.message}`})))}putObject(e){const t=e[this._primaryIndex];return this.put(t,e)}_getSize(e){const t=e[this._sizeIndex];return"number"!=typeof t||t<0?(__LOG__(3)`Invalid size in index ${this._sizeIndex}: ${t}`,0):t}doGet(e){return this._store.get(e)}queryOneByIndex(e){var t=this;return(0,i.default)((function*(){const r=yield t._store.queryByIndex(e,{limit:1});return 0===r.length?null:r[0]}))()}doQueryByIndex(e,t){return this._store.queryByIndex(e,t)}doGetAll(){return this._store.getAll()}doClear(){var e=this;return(0,i.default)((function*(){e._purgeTimer.cancel(),yield e._store.clear(),e._currentSize=0}))()}doCount(){return this._store.count()}doOpen(){var e=this;return(0,i.default)((function*(){if(yield e._store.open(),null!=e._currentSize)return;const t=yield e._store.doGetAll();e._currentSize=t.reduce(((t,r)=>t+e._getSize(r)),0)}))()}doClose(){return this._currentSize=null,this._store.close()}}t.default=d},78986:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0});var i={MediaPrep:!0,checkExistence:!0,clearMediaForChat:!0,downloadMsg:!0,downloadProgressiveJpegThumbnail:!0,downloadStatusV3Thumbnail:!0,downloadVideoThumbnail:!0,forwardMediaMsg:!0,manuallySetMedia:!0,prepRawMedia:!0,resumeUploadMsg:!0};Object.defineProperty(t,"MediaPrep",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"checkExistence",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"clearMediaForChat",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"downloadMsg",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"downloadProgressiveJpegThumbnail",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"downloadStatusV3Thumbnail",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"downloadVideoThumbnail",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"forwardMediaMsg",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"manuallySetMedia",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"prepRawMedia",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"resumeUploadMsg",{enumerable:!0,get:function(){return T.default}});var a=r(74025);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=r(39287);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var o=r(79019);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var l=r(96575);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=r(85046);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=r(4007);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var u=r(48086);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var p=n(r(94995)),h=n(r(16389)),f=n(r(48714)),_=n(r(93628)),m=n(r(42454)),g=n(r(65403)),y=n(r(11679)),E=n(r(37461)),S=n(r(79373)),v=n(r(40674)),T=n(r(23127))},21921:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkAndRepair=function(e,t){const r=new i.default.WebcMediaAnalyzed;let n=!1;return function(e){let t;return new Promise(((r,n)=>{__LOG__(2)`MediaAnalyzer:sendMessageToWorker`,t=s||new a.default,s=void 0,t.onmessage=e=>{try{e.data&&"log"===e.data.type?__LOG__(2)`(via Milan) ${e.data.msg}`:r(e.data)}catch(e){n(e)}},t.onerror=e=>{n(new Error(`Milan.onerror = ${(null==e?void 0:e.message)?e.message:e}`))},t.postMessage(e)})).finally((()=>{t&&(t.terminate(),s=new a.default)}))}({type:"prep",file:e,asGif:t}).then((e=>{let{type:t,result:r,error:i,filename:a,file:s}=e;switch(t){case"result":return __LOG__(2)`MediaAnalyzer:checkAndRepair approved file`,n=!!r,r;case"parsingError":return __LOG__(2)`trouble parsing file ${s} (fossil ${a}) ${String(i)}`,s&&(__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got parsing error! ${String(i)}`,SEND_LOGS("media-parsing-error")),void __LOG__(2)`MediaAnalyzer:checkAndRepair rejected file (${String(i)})`}})).catch((e=>{__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got error! ${String(e)}`,SEND_LOGS("media-detection-error")})).finally((()=>{if(r){let t;if(e.name){const r=e.name.split(".");r.length>1&&(t=r[r.length-1])}r.set({webcMediaSupported:n,webcMediaExtensions:t}),r.markWebcMediaAnalyzeT(),r.commit()}}))};var i=n(r(11339)),a=n(r(91528));let s},74025:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDownloadMedia=i,t.cancelDownloadMsg=function(e){e.mediaObject?i(e.mediaObject):e.mediaObject||(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelDownloadMsg msg without mediaObject"))};var n=r(9329);function i(e){(0,n.cancelDownloadMedia)(e)}},39287:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelUploadMedia=i,t.cancelUploadMsg=function(e){e.mediaObject?i(e.mediaObject):(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelUploadMsg msg without mediaObject"))};var n=r(70996);function i(e){(0,n.cancelUploadMedia)(e)}},16389:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(61596),s=r(9329);function o(){return(o=(0,i.default)((function*(e){if(yield e.waitForPhoneUpload(),!e.mediaObject)return __LOG__(4,void 0,new Error,!0)`checkExistence msg without mediaObject, id: ${e.id.toString()} type: ${e.type}`,void SEND_LOGS("media-fault: checkExistence msg without mediaObject");yield(0,s.checkExistence)({mimetype:e.mimetype,mediaObject:e.mediaObject,mediaType:(0,a.getMsgMediaType)(e)})}))).apply(this,arguments)}},48714:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){i.clearMediaForChat(e)};var i=n(r(88297))},60953:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.consolidateMediaUpdate=function(e,t){if(e.isUnsentPhoneMsg()){e.mediaObject&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: consolidateMediaUpdate unsent message"));const t=f(e);if(t.hasOwnProperty("preview")){const r=t.preview;delete t.preview,r&&h.default.createFromBase64Jpeg(r).then((t=>{(null==e?void 0:e.mediaData)&&e.isUnsentPhoneMsg()&&(e.mediaData.preview=t)}))}e.mediaData.set((0,a.default)((0,a.default)({},t),{},{mediaStage:e.phoneUploading?d.MEDIA_DATA_STAGE.REMOTE_UPLOADING:d.MEDIA_DATA_STAGE.REMOTE_NEED_UPLOAD}))}else _(e,e,t)},t.consolidateMediaUpdateWithValues=_;var a=i(r(81109)),s=i(r(69618)),o=i(r(64328)),l=r(21009),c=n(r(88297)),d=r(58668),u=r(61596),p=r(9329),h=i(r(34949));function f(e){const t={};return d.MAPPED_MSG_PROPS.forEach((r=>{const n=e[r],i=d.MSG_TO_MEDIA[r];t[i]=n})),t.type===s.default.MSG_TYPE.INTERACTIVE&&(t.type=(0,l.getInteractiveMsgMediaType)(e)),t}function _(e,t,r){const n=f(t);let i=e.mediaObject;const a=t.filehash;if(i)a&&a!==i.filehash&&(__LOG__(2)`media:msg ${e.id.toString()} ${i.filehash?"changed":"added"} filehash`,c.disassociateMediaFromMsg(i,e),i=c.getOrCreateMediaObject(a),e.mediaObject=i,c.associateMediaWithMsg(i,e));else{i=a?c.getOrCreateMediaObject(a):new l.MediaObject;const t=e.mediaData;void 0!==t.aspectRatio&&(n.aspectRatio=t.aspectRatio),e.mediaObject=i,c.associateMediaWithMsg(i,e)}let s=!1;const{deprecatedMms3Url:h,mediaKey:_,mediaKeyTimestamp:m,encFilehash:g,type:y,streamingSidecar:E,firstFrameSidecar:S,directPath:v,scansSidecar:T,scanLengths:A,staticUrl:C}=t;if(h||g){let e,r;try{e=(0,u.msgToMediaType)(t)}catch(t){e=~u.MEDIA_TYPE_VALUES.indexOf(y)?y:null}s=!i.entries.has({encFilehash:g,deprecatedMms3Url:h}),s?_&&e&&g?r=i.entries.addEntry({deprecatedMms3Url:h,mediaKey:_,mediaKeyTimestamp:m,encFilehash:g,type:e,sidecar:E,directPath:v,firstFrameSidecar:S,scansSidecar:T,scanLengths:A,debugHint:"consolidate",staticUrl:C}):s=!1:_&&(r=i.entries.updateEntry({deprecatedMms3Url:h,mediaKey:_,mediaKeyTimestamp:m,encFilehash:g,type:e,sidecar:E,directPath:v,firstFrameSidecar:S,scansSidecar:T,scanLengths:A,staticUrl:C})),r||(s=!1),s&&i.downloadStage===d.DOWNLOAD_STAGE.ERROR_MISSING&&(n.downloadStage=d.DOWNLOAD_STAGE.INIT)}if(i.consolidate(n)||i.notifyMsgsAsync(),s&&i.downloadStage===d.DOWNLOAD_STAGE.NEED_POKE){let n;try{n=(0,u.getMsgMediaType)(e)}catch(r){if(!t.type)throw r;n=(0,u.msgToMediaType)({type:t.type,isGif:e.isGif})}(0,p.downloadMedia)({mimetype:t.mimetype,mediaObject:i,downloadEvenIfExpensive:!1,mediaType:n,rmrReason:r,downloadOrigin:(0,o.default)(e)})}}},93628:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{msg:t,isUserClick:r,mode:n,downloadEvenIfExpensive:l,rmrReason:c,rmrData:d,isAutoDownload:u}=e,{mediaObject:p}=t;if(p){return p.getPendingProcess("fromDisk").then((0,i.default)((function*(){r&&p.userDownloadAttemptCount++,yield(0,o.downloadMedia)({mimetype:t.mimetype,mediaObject:p,downloadEvenIfExpensive:l,mediaType:(0,s.getMsgMediaType)(t),rmrReason:c,rmrData:d,downloadOrigin:(0,a.default)(t),isVcardOverMmsDocument:t.isVcardOverMmsDocument,mode:n,isAutoDownload:u}),p.userDownloadAttemptCount=0})))}return __LOG__(4,void 0,new Error,!0)`id: ${t.id.toString()} type: ${t.type}`,SEND_LOGS("media-fault: downloadMsg msg without mediaObject"),Promise.resolve()};var i=n(r(48926)),a=n(r(64328)),s=r(61596),o=(n(r(11339)),r(9329))},42454:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(89385),s=n(r(45095)),o=n(r(70714)),l=r(26384),c=r(61596),d=n(r(34949)),u=n(r(28245));function p(){return(p=(0,i.default)((function*(e){const{msg:t,isPreload:r,signal:n}=e;__LOG__(2)`media.downloadProgressiveJpegThumbnail: start`;try{const e=(0,s.default)(t.scanLengths,"msg.scanLengths"),i=(0,s.default)(t.scansSidecar,"msg.scansSidecar"),a=(0,s.default)(t.mediaObject,"msg.mediaObject"),u=(0,s.default)(a.filehash,"mediaObject.filehash"),{encFilehash:p,directPath:h}=t,f=yield l.downloadManager.downloadAndDecrypt({directPath:h,encFilehash:p,filehash:u,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:c.MEDIA_TYPES.IMAGE,signal:n||(new o.default).signal,userDownloadAttemptCount:0,progressiveJpegOpts:{mimetype:"image/jpeg",scansSidecar:i,scanLengths:e,scanCount:1},isPreload:r});a.consolidate({fullPreviewData:yield d.default.createFromData(f,"image/jpeg")}),__LOG__(2)`media.downloadProgressiveJpegThumbnail: success`}catch(e){if(e.name===a.ABORT_ERROR)return void __LOG__(2)`media.downloadProgressiveJpegThumbnail aborted`;__LOG__(3,void 0,void 0,!0)`media.downloadProgressiveJpegThumbnail: error\n${(0,u.default)(e)}`,SEND_LOGS("download-pjpeg-thumbnail-failed")}}))).apply(this,arguments)}},65403:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(69618)),s=n(r(61516)),o=n(r(42454));function l(){return(l=(0,i.default)((function*(e){const{msg:t,isPreload:r,signal:n}=e,{encFilehash:i,thumbnailSha256:l,thumbnailEncSha256:c,thumbnailDirectPath:d}=t;t.type===a.default.MSG_TYPE.IMAGE&&t.scanLengths&&t.scansSidecar&&i?yield(0,o.default)({msg:t,signal:n,isPreload:r}):l&&c&&d&&(yield(0,s.default)({msg:t,signal:n,isPreload:r}))}))).apply(this,arguments)}},11679:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var a=i(r(48926)),s=i(r(45095)),o=i(r(70714)),l=i(r(69618)),c=r(26384),d=n(r(36638)),u=r(61596),p=i(r(34949)),h=i(r(28245)),f=r(2541);function _(){return(_=(0,a.default)((function*(e){const{msg:t}=e,{encFilehash:r,filehash:n,directPath:i}=t;if(!r||!n||!i)return;const{fullPreviewData:a,fullWidth:_,fullHeight:m}=t.mediaData;if(!a||null==_||null==m){__LOG__(2)`media.downloadVideoThumbnail: start`;try{const e=Math.max(parseInt(t.mediaData.duration,10),1),a={video:{size:t.mediaData.size,duration:e},secondsToDownload:1},h=yield c.downloadManager.downloadAndDecrypt({directPath:i,encFilehash:r,filehash:n,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:u.MEDIA_TYPES.VIDEO,signal:(new o.default).signal,userDownloadAttemptCount:0,partialVideoOpts:a,isPreload:!0}),_=new Blob([h],{type:"video/mp4"}),{thumbs:[m]}=yield d.generateVideoThumbsAndDuration({file:_,maxDimensions:[l.default.VIDEO_THUMB_MAX_EDGE],debugHint:"downloadVideoThumbnail",throwOnBlack:!0}),g=yield p.default.createFromBase64Jpeg(f.URL.parseDataURL(m.url).data),y=(0,s.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),E={fullPreviewData:g,fullWidth:m.fullWidth,fullHeight:m.fullHeight};y.consolidate(E),__LOG__(2)`media.downloadVideoThumbnail: success`}catch(e){if(e instanceof d.BlackVideoThumbnailError)return void __LOG__(2)`media.downloadVideoThumbnail: black thumbnail was generated, fallback to blurred thumbnail`;__LOG__(3,!0)`media.downloadVideoThumbnail: error\n${(0,h.default)(e)}`}}}))).apply(this,arguments)}},37461:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(94995)),s=r(58668),o=n(r(11339)),l=n(r(34949));function c(){return(c=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];__LOG__(2)`Prepping media msg`;const i=e.mediaObject;if(!i)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: forwardMediaMsg msg without mediaObject"),Promise.reject(new Error("non initialized media"));const c=e.mediaData.toJSON();null!=c.preview&&(c.preview=i.contentInfo._preview),c.mediaBlob instanceof l.default&&c.mediaBlob.retain();const d=c.isGif?{isGif:!0}:{};c.type===s.OUTWARD_TYPES.PTT&&(c.type=s.OUTWARD_TYPES.AUDIO);const u={businessOwnerJid:e.businessOwnerJid,productId:e.productId,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount,title:e.title,description:e.description},p=yield new a.default(c.type,Promise.resolve(c)).sendToChat(t,{forwardedFromWeb:!0,caption:c.type===s.OUTWARD_TYPES.DOCUMENT||c.type===s.OUTWARD_TYPES.PRODUCT?e.caption:void 0,footer:c.type===s.OUTWARD_TYPES.PRODUCT?e.footer:void 0,addEvenWhilePreparing:!0,placeholderProps:d,isForwarded:e.isForwarded||!e.isSentByMe,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:n,productMsgOptions:u});if(c.type===s.OUTWARD_TYPES.STICKER){var h,f,_;new o.default.StickerSend({stickerSendOrigin:o.default.STICKER_SEND_ORIGIN_TYPE.FORWARD,stickerIsAnimated:Boolean(null===(h=e.mediaData)||void 0===h?void 0:h.isAnimated),stickerIsFirstParty:Boolean(null===(f=e.mediaData)||void 0===f?void 0:f.isFirstParty),stickerIsFromStickerMaker:Boolean(null===(_=e.mediaData)||void 0===_?void 0:_.isFromStickerMaker)}).commit();r(49264).RecentStickerCollectionMd.addStickerWithMediaData(c,e.id.id)}return p}))).apply(this,arguments)}},64328:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.asProduct?i.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:e.isStatusV3?i.default.DOWNLOAD_ORIGIN_TYPE.STATUS_USER:e.isGroupMsg?i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL};var i=n(r(11339))},79373:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{msg:t,media:r,rmrReason:n}=e;const l=t.mediaObject;if(!l)return;o.default.createFromData(r,t.mimetype).then((e=>{(0,s.manuallySetMedia)({mimetype:t.mimetype,mediaObject:l,mediaBlob:e,mediaType:(0,a.getMsgMediaType)(t),rmrReason:n,downloadOrigin:(0,i.default)(t)})}))};var i=n(r(64328)),a=r(61596),s=(n(r(11339)),r(9329)),o=n(r(34949))},79019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaMetadata=function(e){const t=e.mediaObject;if(!t)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata msg without mediaObject"),new Error("msg.mediaMetadata with no mediaObject");const r=t.entries.getEntryByEncFilehash({encFilehash:e.encFilehash,deprecatedMms3Url:e.deprecatedMms3Url});if(!r)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata no entry"),new Error("msg.mediaMetadata with entry mismatch");const n=e.mediaData;return{url:r.deprecatedMms3Url,directPath:r.directPath,encFilehash:r.encFilehash,mediaKey:r.mediaKey,mediaKeyTimestamp:r.mediaKeyTimestamp,filehash:e.filehash,type:n.type,mimetype:n.mimetype,filename:n.filename,duration:n.duration,width:n.fullWidth,height:n.fullHeight,firstFrameLength:n.firstFrameLength,isAnimated:n.isAnimated,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:e.thumbnailSha256,thumbnailEncSha256:e.thumbnailEncSha256,thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth,waveform:e.waveform,staticUrl:e.staticUrl}}},96575:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterMsg=function(e){e.off(null,p);const t=e.mediaObject;t&&s.disassociateMediaFromMsg(t,e)},t.prepareMsg=function(e){const t=e.mediaObject;if(t)return t.resolveWhenConsolidated();const r=e.mediaData,n=r.preview;return n instanceof d.default&&void 0===r.aspectRatio&&(void 0===r.fullWidth||void 0===r.fullHeight)?(0,l.getImageWidthHeight)(n).then((t=>{let{width:r,height:n}=t;e.mediaObject||e.mediaData.set({aspectRatio:r/n})})):Promise.resolve()},t.registerMsg=function(e){e.mimetype||e.type!==o.OUTWARD_TYPES.IMAGE||(e.mimetype="image/jpeg");e.mimetype||e.type!==o.OUTWARD_TYPES.STICKER||(e.mimetype="image/webp");e.on(u,p),(0,a.consolidateMediaUpdate)(e,c.default.WEBC_RMR_REASON_CODE.MSG_INIT)},t.registerMsgEarly=function(e,t){e.isUnsentPhoneMsg()&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: registerMsgEarly msg without mediaObject"));const r={};for(let n=0;n<o.MEDIA_MSG_PROPS.length;n++){const i=o.MEDIA_MSG_PROPS[n],a=t[i];r[i]=void 0!==a?a:e[i]}r.mimetype||r.type!==o.OUTWARD_TYPES.IMAGE||(t.mimetype=r.mimetype="image/jpeg");e.on(u,p),(0,a.consolidateMediaUpdateWithValues)(e,r,c.default.WEBC_RMR_REASON_CODE.MSG_UPDATE);const n={};for(let e=0;e<o.MSG_SPECIFIC_FIELDS.length;e++){const t=o.MSG_SPECIFIC_FIELDS[e];n[t]=r[o.MEDIA_TO_MSG[t]]}e.mediaData.set(n)};var a=r(60953),s=i(r(88297)),o=r(58668),l=r(56406),c=n(r(11339)),d=n(r(34949));const u=`change:phoneUploading change:ack ${o.MEDIA_MSG_PROPS.map((e=>`change:${e}`)).join(" ")}`;function p(e){(0,a.consolidateMediaUpdate)(e,c.default.WEBC_RMR_REASON_CODE.MSG_UPDATE)}},40674:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r;__LOG__(2)`Prepping raw media`,r=t.isPtt?a.OUTWARD_TYPES.PTT:t.asDocument?a.OUTWARD_TYPES.DOCUMENT:t.asGif?a.OUTWARD_TYPES.VIDEO:t.isAudio?a.OUTWARD_TYPES.AUDIO:t.asSticker?a.OUTWARD_TYPES.STICKER:a.OUTWARD_TYPES.UNKNOWN;const n=Promise.resolve(e).then((e=>(e.autoreleaseWhenPromiseCompletes(n),(0,s.default)(e,t))));return new i.default(r,n)};var i=n(r(94995)),a=r(58668),s=n(r(27989))},85046:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadProductImage=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=n(r(70714)),s=r(1063),o=n(r(11105)),l=r(61596),c=n(r(11339));function d(){return(d=(0,i.default)((function*(e,t){const r=yield(0,s.blobToArrayBuffer)(e.forceToBlob()).then((e=>o.default.unencryptedUpload({file:e,hash:t,signal:(new a.default).signal,type:l.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE,uploadOrigin:c.default.UPLOAD_ORIGIN_TYPE.PRODUCT_CATALOG})));return new URL(r.directPath,"https://mmg.whatsapp.net").toString()}))).apply(this,arguments)}},23127:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const{mediaObject:r}=e;if(!r)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: resumeUploadMsg msg without mediaObject"),Promise.resolve();r.userUploadAttemptCount++;const{filehash:n}=r,p=(0,o.shouldUseMediaKeyCache)()&&null!=n&&null!==(t=o.MediaKeyCache.get(n))&&void 0!==t?t:void 0,h=(0,c.uploadMedia)({mimetype:e.mimetype,mediaObject:r,mediaKeyInfo:p,mediaType:(0,l.getMsgMediaType)(e),forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,s.default)(e.chat)}).then(function(){var t=(0,i.default)((function*(t){let{mediaEntry:i}=t;if((0,o.shouldUseMediaKeyCache)()&&null!=n&&o.MediaKeyCache.delete(n),!i)throw new Error("upload failed: media entry was not created");r.userUploadAttemptCount=0;const a={deprecatedMms3Url:i.deprecatedMms3Url,directPath:i.directPath,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,filehash:r.filehash,encFilehash:i.encFilehash,size:r.size,streamingSidecar:i.sidecar,firstFrameSidecar:i.firstFrameSidecar};return yield(0,u.default)(e,a),e}));return function(){return t.apply(this,arguments)}}());return(0,d.resendMsgToChat)(e.chat,h).catch((()=>{e.ack=a.default.ACK.FAILED}))};var i=n(r(48926)),a=n(r(69618)),s=n(r(46220)),o=r(45554),l=r(61596),c=r(70996),d=r(75887),u=(r(13705),n(r(2603)))},4007:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterSticker=function(e){const{mediaObject:t}=e;t&&d.disassociateMediaFromSticker(t,e)},t.deregisterStickerPackIcon=function(e){const{mediaObject:t}=e;t&&d.disassociateMediaFromStickerPack(t,e)},t.downloadStickerOrStickerPackIcon=function(){return g.apply(this,arguments)},t.prepSticker=function(e){__LOG__(2)`Prepping sticker`;const t=e.mediaObject,r=e.mediaData.toJSON();if(r.fullWidth=125,r.fullHeight=125,!t)return __LOG__(4,void 0,new Error,!0)`id: ${e.id}`,SEND_LOGS("media-fault: prepSticker sticker without mediaObject"),new c.default(r.type,Promise.reject(new Error("non initialized media")));return new c.default(r.type,Promise.resolve(r))},t.registerSticker=function(e){m(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker with no filehash`,void SEND_LOGS("sticker-filehash-error");const t=d.getOrCreateMediaObject(e.filehash);return d.associateMediaWithSticker(t,e),t}(e),p.MEDIA_TYPES.STICKER)},t.registerStickerPackIcon=function(e){m(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker pack with no filehash`,void SEND_LOGS("sticker-pack-filehash-error");const t=d.getOrCreateMediaObject(e.filehash);return d.associateMediaWithStickerPack(t,e),t}(e),p.MEDIA_TYPES.IMAGE)};var a=i(r(48926)),s=i(r(70714)),o=r(26384),l=r(7293),c=i(r(94995)),d=n(r(88297)),u=r(58668),p=r(61596),h=i(r(11339)),f=r(9329),_=r(64551);function m(e,t,r){const n=function(e){const t={};return u.MAPPED_STICKER_PROPS.forEach((r=>{const n=e[r],i=u.MSG_TO_MEDIA[r];t[i]=n})),t}(e);if(e.mediaData.set(n),!t)return;e.mediaObject=t;const{deprecatedMms3Url:i,encFilehash:a}=e;if((a||i)&&!t.entries.has({encFilehash:a,deprecatedMms3Url:i})){t.entries.addEntry({deprecatedMms3Url:i,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,encFilehash:a,type:r,directPath:e.directPath,debugHint:"setMediaObjectValues"})&&t.downloadStage===u.DOWNLOAD_STAGE.ERROR_MISSING&&(n.downloadStage=u.DOWNLOAD_STAGE.INIT)}t.consolidate(n)}function g(){return(g=(0,a.default)((function*(e,t){if(e.isPlaceholder||e.isCreateButton)return e.mediaData.mediaStage=u.MEDIA_DATA_STAGE.PREPARING,Promise.resolve();const n=e.mediaObject;if(!n)return Promise.reject(new Error("media-fault: downloadStickerOrStickerPackIcon sticker/stickerPack without mediaObject"));if(n.downloadStage===u.DOWNLOAD_STAGE.RESOLVED)return Promise.resolve();const i="STICKER"===t?h.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_STICKER:h.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_ICON;let a=!1;yield n.getPendingProcess("fromDisk").then((()=>{if(!l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&!e.deprecatedMms3Url||!e.filehash||!e.mediaKey||!e.encFilehash)return a=!0,o.downloadManager.rmr({mediaObject:n,signal:(new s.default).signal,rmrReason:i})})).then((()=>(0,f.downloadMedia)({mimetype:e.mimetype,mediaObject:e.mediaObject,downloadEvenIfExpensive:!0,mediaType:(0,p.msgToMediaType)({type:e.type,isGif:!1}),rmrReason:i,downloadOrigin:h.default.DOWNLOAD_ORIGIN_TYPE.STICKER_PICKER,shouldThrow:!0}))),l.GK.supportsFeature(l.GK.F.MD_BACKEND)&&a&&_.ServerProps.webServerStickerPanel&&r(49264).RecentStickerCollectionMd.updateStickerMediaData(e.filehash,n.entries.getDownloadEntry())}))).apply(this,arguments)}},48086:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.videoStreamingInfo=function(e){const t=e.mediaObject;return t?t.videoStreamingInfo(e.id.toString()):null};r(21009)},2320:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(11290),s=r(99140),o=r(84866),l=r(58668);class c extends a.BaseModel{constructor(){super(...arguments),this.type=(0,a.prop)(l.OUTWARD_TYPES.UNKNOWN),this.directPath=(0,a.prop)(),this.mediaKey=(0,a.prop)(),this.mediaKeyTimestamp=(0,a.prop)(),this.encFilehash=(0,a.prop)(),this.mediaStage=(0,a.prop)(l.MEDIA_DATA_STAGE.INIT),this.size=(0,a.prop)(),this.loadedSize=(0,a.prop)(),this.filehash=(0,a.prop)(),this.mimetype=(0,a.prop)(),this.mediaBlob=(0,a.prop)(),this.renderableUrl=(0,a.prop)(),this.fullHeight=(0,a.prop)(),this.fullWidth=(0,a.prop)(),this.aspectRatio=(0,a.prop)(),this.rgbaBuffer=(0,a.prop)(),this.rgbaHeight=(0,a.prop)(),this.rgbaWidth=(0,a.prop)(),this.animationDuration=(0,a.prop)(0),this.animatedAsNewMsg=(0,a.prop)(!1),this.isAnimated=(0,a.prop)(),this.isFirstParty=(0,a.prop)(),this.isFromStickerMaker=(0,a.prop)(),this.stickerPackId=(0,a.prop)(),this.stickerPackName=(0,a.prop)(),this.stickerPackPublisher=(0,a.prop)(),this.singleLoopDuration=(0,a.prop)(),this.firstFrameLength=(0,a.prop)(),this.firstFrameSidecar=(0,a.prop)(),this.emojis=(0,a.prop)(),this.progressiveStage=(0,a.prop)(),this.isViewOnce=(0,a.prop)(!1),this.staticUrl=(0,a.prop)(),this.preview=(0,a.prop)(),this.sidecar=(0,a.prop)(),this.duration=(0,a.prop)(),this.durationFloat=(0,a.prop)(),this.isGif=(0,a.prop)(),this.gifAttribution=(0,a.prop)(),this.streamable=(0,a.derived)(this._isStreamable,["isGif","isViewOnce","mediaStage","sidecar","type","_swStreamingSupported"]),this._swStreamingSupported=(0,a.prop)(!1),this._listeningToSwSupport=(0,a.prop)(!1),this.filename=(0,a.prop)(),this.pageCount=(0,a.prop)(),this.documentPreview=(0,a.prop)(),this.isVcardOverMmsDocument=(0,a.prop)(!1),this.parsedVcards=(0,a.prop)(),this.fullPreviewSize=(0,a.prop)(),this.fullPreviewData=(0,a.prop)(),this.subtype=(0,a.prop)(),this.waveform=(0,a.prop)()}initialize(){super.initialize()}set(e,t,r){let n,a=r;return"string"==typeof e?n={[e]:t}:(n=e,a=t),n=function(e){if(e.filename&&e.type===d.TYPE.DOCUMENT){const t=(0,s.cleanFilename)(e.filename);return(0,i.default)((0,i.default)({},e),{},{filename:t,caption:t})}return e}(n),super.set(n,a)}_isStreamable(){return this.isStreamable()}isStreamable(){return this.isStreamableType()&&this.listenToServiceWorkerSupport()&&!this.isViewOnce}_updateStreamingSupported(e){this._swStreamingSupported=e}listenToServiceWorkerSupport(){if(this._listeningToSwSupport)return this._swStreamingSupported;const e=r(5882).default;return this.listenTo(e,"change:streamingSupported",this._updateStreamingSupported),this._swStreamingSupported=Boolean(e.streamingSupported),this._listeningToSwSupport=!0,this._swStreamingSupported}isStreamableType(){let e=!1;return e=this.type===l.OUTWARD_TYPES.VIDEO&&!this.isGif&&(this.mediaStage===l.MEDIA_DATA_STAGE.INIT||this.mediaStage===l.MEDIA_DATA_STAGE.FETCHING||this.mediaStage===l.MEDIA_DATA_STAGE.DECRYPTING||this.mediaStage===l.MEDIA_DATA_STAGE.RESOLVED)&&null!=this.fullWidth&&null!=this.fullHeight&&Boolean(this.sidecar&&this.sidecar.byteLength>0),e}isDownloadable(){return!this.isViewOnce&&(null!=this.renderableUrl||o.MediaBlobCache.has(this.filehash)||this.mediaStage===l.MEDIA_DATA_STAGE.EXISTS||this.mediaStage===l.MEDIA_DATA_STAGE.PROGRESSIVE_READY)}}c.Proxy="mediaData";const d=(0,a.defineModel)(c);d.TYPE=l.OUTWARD_TYPES;var u=d;t.default=u},80923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEntryList=t.MediaEntry=void 0;var i=n(r(48926)),a=r(61070),s=r(92844),o=r(44933),l=n(r(21081)),c=r(46640),d=n(r(22283)),u=n(r(87798));const p="PROBABLY_ON_SERVER",h="PROBABLY_OFF_SERVER",f="UNKNOWN";class _{constructor(e){this.useBackupUrl=!1,this._encFilehashPromise=null,this.deprecatedMms3Url=e.deprecatedMms3Url,this.mediaKey=e.mediaKey,this.mediaKeyTimestamp=e.mediaKeyTimestamp,this.encFilehash=e.encFilehash,this.serverStatus=f,this.sidecar=e.sidecar,this.directPath=e.directPath,this.firstFrameSidecar=e.firstFrameSidecar,this.type=e.type,this.scansSidecar=e.scansSidecar,this.scanLengths=e.scanLengths,this.staticUrl=e.staticUrl}url(e){var t=this;return(0,i.default)((function*(){const{useFallback:r,forceHashUrl:n}=e||{},{encFilehash:i}=t;if(!i)return Promise.reject(new Error("media_entry: encFilehash does not exist"));const{selectedHost:a,fallbackHost:s}=yield c.mediaHosts.getHostsInfo({operation:d.default.DOWNLOAD,encFilehash:i,type:t.type}),o=r&&s?s:a;return(0,l.default)({directPath:n?null:t.directPath,encFilehash:i,hostname:o.hostname,type:t.type})}))()}canReuseMediaKey(){if(null==this.directPath)return!1;const e=(0,s.castToUnixTime)(this.mediaKeyTimestamp);return(0,a.isMediaKeyReusable)(e)}markWhetherOnServer(e){this.serverStatus=e?p:h}}t.MediaEntry=_;function m(e){e.entries.sort(((e,t)=>{const r=g(t)-g(e);return 0===r?t.mediaKeyTimestamp-e.mediaKeyTimestamp:r}))}function g(e){let t=0;switch(e.serverStatus){case p:t+=200;break;case h:break;case f:t+=100}return e.encFilehash?t+=20:e._encFilehashPromise&&(t+=10),t}t.MediaEntryList=class{constructor(){this.entries=[]}_updateEntry(e){let{foundEntry:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,sidecar:a,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:u,staticUrl:p}=e;if(r&&!(0,o.b64Equal)(t.mediaKey,r)){const e=t.mediaKey.replace("=","").split("\n")[0],n=r.replace("=","").split("\n")[0];return __LOG__(4,void 0,new Error,!0)`media-fault: mediaKey changed for the same MMS3 url. type:${t.type}. equal?:${e===n}. Debug:\n${JSON.stringify({before:{hasDirectPath:Boolean(t.directPath),hasEncFilehash:Boolean(t.encFilehash),hasMediaKey:Boolean(t.mediaKey),hasDeprecatedMms3Url:Boolean(t.deprecatedMms3Url)},after:{hasDirectPath:Boolean(s),hasEncFilehash:Boolean(i),hasDeprecatedMms3Url:Boolean(u)}},null,2)}`,SEND_LOGS("media-key-mismatch-same-mms3-url"),null}return null!=n&&(t.mediaKeyTimestamp=n),a&&(t.sidecar=a),l&&(t.firstFrameSidecar=l),c&&(t.scansSidecar=c),(null==d?void 0:d.length)&&(t.scanLengths=d),p&&(t.staticUrl=p),t.directPath=s,t}updateEntry(e){let{deprecatedMms3Url:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,type:a,sidecar:s,directPath:o,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u}=e;const p=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t});if(p)return this._updateEntry({foundEntry:p,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,sidecar:s,directPath:o,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:t,staticUrl:u})}addEntry(e){const{deprecatedMms3Url:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,type:a,sidecar:s,directPath:o,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u,debugHint:p}=e;null==i&&(__LOG__(4,void 0,new Error,!0)`Media type ${a} from ${p} is missing encFilehash`,SEND_LOGS(`media-entry-missing-upload-hash-${a}-${p}`));const h=this.entries,f=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t}),m=f?this._updateEntry({foundEntry:f,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,sidecar:s,directPath:o,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:t,staticUrl:u}):null;if(m)return m;if(!r)return null;const g=new _({deprecatedMms3Url:t,mediaKey:r,mediaKeyTimestamp:n,encFilehash:i,type:a,sidecar:s,directPath:o,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u});return h.push(g),g}_getKey(e){let{encFilehash:t,deprecatedMms3Url:r}=e;return null==t?`mms3:${r}`:t}has(e){return null!=this.getEntryByEncFilehash(e)}getEntryByEncFilehash(e){const t=this._getKey(e);return this.entries.find((e=>this._getKey(e)===t))}getUploadEntry(){return m(this),this.entries.find((e=>(0,u.default)(e.mediaKeyTimestamp)))||null}getDownloadEntry(){m(this);const e=this.entries[0];return e&&e.serverStatus!==h?e:null}}},21009:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaObject=void 0,t.consolidate=E,t.getInteractiveMsgMediaType=S,t.webMediaTypeToWamMediaType=function(e){switch(e){case"VIDEO":return 3;case"IMAGE":return 2;case"AUDIO":return 4;case"STICKER":return 16;case"DOCUMENT":return 8;case"PRODUCT":return 18;default:throw new Error(`web media type is invalid: ${e}`)}};var i=n(r(81109)),a=n(r(48926)),s=r(57319),o=n(r(69618)),l=n(r(28011)),c=r(7293),d=r(34535),u=r(80923),p=r(61596),h=r(58668),f=r(56406),_=(n(r(11339)),n(r(34949))),m=n(r(25224)),g=r(64551),y=r(22104);function E(e,t){const r=e.contentInfo;let n=!1;const i=function(e){switch(e){case h.OUTWARD_TYPES.IMAGE:case h.OUTWARD_TYPES.PRODUCT:return h.TYPE.IMAGE;case h.OUTWARD_TYPES.VIDEO:return h.TYPE.VIDEO;case h.OUTWARD_TYPES.STICKER:return h.TYPE.STICKER;case h.OUTWARD_TYPES.AUDIO:case h.OUTWARD_TYPES.PTT:return h.TYPE.AUDIO;case h.OUTWARD_TYPES.DOCUMENT:default:return}}(t.type,t.subtype);i&&!e.type&&(e.type=i,n=!0);const{downloadStage:a,uploadStage:s}=t;a&&a!==e.downloadStage&&(e.downloadStage=a,n=!0),s&&s!==e.uploadStage&&(e.uploadStage=s,n=!0),t.resolvedPreview&&!r.preview&&(t.resolvedPreview.retain(),r.preview=t.resolvedPreview,n=!0),void 0!==t.progressiveStage&&t.progressiveStage!==e.progressiveStage&&(e.progressiveStage=t.progressiveStage,n=!0);const o=t.mediaBlob;o&&!o.isBlobEqual(e.mediaBlob)&&(e.mediaBlob&&e.clearBlob(),o.retain(),e.mediaBlob=o,e.size=o.size(),n=!0),null!=t.size&&(null==e.size||t.size<e.size)&&(e.size=t.size,n=!0);const{loadedSize:l}=t;null!=l&&l!==e.loadedSize&&(e.loadedSize=l,n=!0),t.filehash&&!e.filehash&&(e.filehash=t.filehash,n=!0),t.parsedVcards&&t.parsedVcards!==e.parsedVcards&&(e.parsedVcards=t.parsedVcards,n=!0);const c=e.contentFields();for(let i=0;i<c.length;i++){const a=c[i];switch(a){case"preview":t.preview&&!r._preview&&(e.runProcessIfNotRunBefore("preview",C,t.preview),r._preview=t.preview,n=!0);break;case"fullWidth":case"fullHeight":case"aspectRatio":{const e=t[a];null!=e&&0!==e&&r[a]!==e&&(r[a]=e,n=!0);break}case"animationDuration":case"singleLoopDuration":{const e=t[a];null!=e&&e!==r[a]&&(r[a]=e,n=!0);break}default:const i=t[a];void 0!==i&&void 0===r[a]&&(r[a]=i,n=!0)}}return null!=r.aspectRatio&&0!==r.aspectRatio||(null!=r.fullWidth&&0!==r.fullWidth&&null!=r.fullHeight&&0!==r.fullHeight?(r.aspectRatio=r.fullWidth/r.fullHeight,n=!0):r.preview&&e.runProcessIfNotRunBefore("aspectRatio",P,r.preview)),n}function S(e){var t;if(null!=(null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType))switch(e.interactiveHeader.mediaType){case d.InteractiveMessageHeaderMediaType.DOCUMENT:return h.OUTWARD_TYPES.DOCUMENT;case d.InteractiveMessageHeaderMediaType.VIDEO:return h.OUTWARD_TYPES.VIDEO;case d.InteractiveMessageHeaderMediaType.IMAGE:return h.OUTWARD_TYPES.IMAGE}}function v(e,t,r){for(let n=0;n<r.length;n++){const i=r[n];e[i]=t[i]}}function T(e,t){return t.filehash?e.id.fromMe&&e.ack<o.default.ACK.SENT?(e.local||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: unsent media system message not local")),function(e){switch(e.uploadStage){case h.UPLOAD_STAGE.INIT:case h.UPLOAD_STAGE.PREPARING:return h.MEDIA_DATA_STAGE.PREPARING;case h.UPLOAD_STAGE.UPLOADING:return h.MEDIA_DATA_STAGE.UPLOADING;case h.UPLOAD_STAGE.NEED_UPLOAD:return h.MEDIA_DATA_STAGE.NEED_UPLOAD;case h.UPLOAD_STAGE.ERROR_MISSING:return h.MEDIA_DATA_STAGE.ERROR_MISSING;case h.UPLOAD_STAGE.ERROR_TOO_LARGE:return h.MEDIA_DATA_STAGE.ERROR_TOO_LARGE;case h.UPLOAD_STAGE.UPLOADED:return h.MEDIA_DATA_STAGE.SENDING;case h.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE:return h.MEDIA_DATA_STAGE.ERROR_FILE_NOT_READABLE}}(t)):A(t):h.MEDIA_DATA_STAGE.PREPARING}function A(e){switch(e.downloadStage){case h.DOWNLOAD_STAGE.INIT:return h.MEDIA_DATA_STAGE.INIT;case h.DOWNLOAD_STAGE.EXISTS:return h.MEDIA_DATA_STAGE.EXISTS;case h.DOWNLOAD_STAGE.PREPARING:return h.MEDIA_DATA_STAGE.PREPARING;case h.DOWNLOAD_STAGE.REUPLOADING:return h.MEDIA_DATA_STAGE.REUPLOADING;case h.DOWNLOAD_STAGE.FETCHING:return h.MEDIA_DATA_STAGE.FETCHING;case h.DOWNLOAD_STAGE.PROCESSING:return h.MEDIA_DATA_STAGE.DECRYPTING;case h.DOWNLOAD_STAGE.NEED_POKE:return h.MEDIA_DATA_STAGE.NEED_POKE;case h.DOWNLOAD_STAGE.ERROR_MISSING:return h.MEDIA_DATA_STAGE.ERROR_MISSING;case h.DOWNLOAD_STAGE.ERROR_UNSUPPORTED:return h.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED;case h.DOWNLOAD_STAGE.RESOLVED:return h.MEDIA_DATA_STAGE.RESOLVED;case h.DOWNLOAD_STAGE.PROGRESSIVE_READY:return h.MEDIA_DATA_STAGE.PROGRESSIVE_READY}}function C(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e){const t=yield _.default.createFromBase64Jpeg(e);return t.autorelease(),{resolvedPreview:t}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e){const{width:t,height:r}=yield(0,f.getImageWidthHeight)(e);return{aspectRatio:t/r}}))).apply(this,arguments)}t.MediaObject=class{constructor(){this._msgs=[],this._notifyTimer=new s.ShiftTimer((()=>{!function(e){const t={};v(t,e,h.FIELDS.RAW),v(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const r=e._msgs,n=r.length;for(let i=0;i<n;i++){const[n,a]=r[i];if(null!=n&&!a){if(n.type!==o.default.MSG_TYPE.CIPHERTEXT){t.mediaStage=T(n,e);for(let e=0;e<h.MSG_SPECIFIC_FIELDS.length;e++){const r=h.MSG_SPECIFIC_FIELDS[e];t[r]=n.get(h.MEDIA_TO_MSG[r])}t.type===o.default.MSG_TYPE.INTERACTIVE&&(t.type=S(n))}else{delete t.mediaStage;for(let e=0;e<h.MSG_SPECIFIC_FIELDS.length;e++)delete t[h.MSG_SPECIFIC_FIELDS[e]]}n.mediaData.set(t)}}for(let e=r.length-1;e>=0;e--)r[e][1]&&r.splice(e,1);const i=e._callOnConsolidate;!e._pendingChanges&&i&&(e._callOnConsolidate=null,i.forEach((e=>{e()})));e._saveMedia&&e._saveMedia(e)}(this),function(e){const t={};v(t,e,h.FIELDS.RAW),v(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const r=A(e);e._stickers=e._stickers.filter((e=>{let[t,r]=e;return!r})),e._stickers.forEach((e=>{let[n,a]=e;n.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:r}))})),e._stickerPacks=e._stickerPacks.filter((e=>{let[t,r]=e;return!r})),e._stickerPacks.forEach((e=>{let[n,a]=e;n.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:r}))})),!e._pendingChanges&&e._callOnConsolidate&&(e._callOnConsolidate.forEach((e=>{e()})),e._callOnConsolidate=null);e._saveMedia&&e._saveMedia(e)}(this)})),this._callOnConsolidate=null,this._keyedProcesses=null,this._pendingChangesCount=0,this._saveMedia=null,this._stickers=[],this._stickerPacks=[],this.entries=new u.MediaEntryList,this.downloadStage=h.DOWNLOAD_STAGE.INIT,this.uploadStage=h.UPLOAD_STAGE.INIT,this.userUploadAttemptCount=0,this.userDownloadAttemptCount=0,this.downloadPromise=null,this.uploadPromise=null,this.mediaBlob=null,this.size=void 0,this.loadedSize=void 0,this.filehash=void 0,this.contentInfo={},this.progressiveStage=void 0,this.parsedVcards=null}consolidate(e){return!!E(this,e)&&(this.notifyMsgsAsync(),!0)}clearBlob(){const e=this.mediaBlob;e&&(this.mediaBlob=null,e.autorelease())}contentFields(){const e=this.type||h.TYPE.DOCUMENT;return h.FIELDS[e]}resolveWhenConsolidated(){return this._notifyTimer.ts||this._pendingChanges?new Promise((e=>{this._callOnConsolidate?this._callOnConsolidate.push(e):this._callOnConsolidate=[e]})):Promise.resolve()}notifyMsgsAsync(){this._notifyTimer.debounce(0)}addMsg(e){const t=this._msgs;for(let r=0;r<t.length;r++){const[n,i]=t[r];n!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-media-msg"))}t.push([e,!1]),this.notifyMsgsAsync()}removeMsg(e){const t=this._msgs;let r=!1;for(let n=0;!r&&n<t.length;n++){const[i,a]=t[n];i!==e||a||(t[n][1]=!0,r=!0)}}hasAssociatedMsgsOrStickers(){const e=this._msgs;for(let t=0;t<e.length;t++)if(!e[t][1])return!0;return this.hasAssociatedStickers()||this.hasAssociatedStickerPacks()}associatedMsgs(){const e=this._msgs,t=[];for(let r=0;r<e.length;r++){const[n,i]=e[r];i||t.push(n)}return t}rmr(e){var t=this;return(0,a.default)((function*(){const n=t.associatedStickers();if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){if(n.length>0&&g.ServerProps.webServerStickerPanel){if(0===t.associatedMsgs().filter((e=>null!=e)).length){return r(49264).RecentStickerCollectionMd.removeAndSave(n.map((e=>e.id))),n.forEach((e=>{e.delete()})),Promise.resolve(200)}}}else{if(n.length>0)return(0,y.rmrSticker)(t.entries,t._stickers,n[0]).then((e=>e.status));const e=t.associatedStickerPacks();if(e.length>0)return(0,y.rmrStickerPack)(t.entries,t._stickerPacks,e[0]).then((e=>e.status))}const[i]=t._msgs.find((e=>{let[t,r]=e;return!r&&!t.isUnsentPhoneMsg()}))||[null];if(i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject with no msg")),!i)return Promise.reject(new Error("rmr called on MediaObject with no msg"));e.onMsgSelect(i);const a=yield(0,m.default)(i);if(200===a.status){const e=i.mediaData.type;if("unknown"===e)return Promise.reject(new Error("rmr called on MediaData with unknown type"));const r=a.isMD?t.entries.updateEntry({deprecatedMms3Url:i.deprecatedMms3Url,encFilehash:i.encFilehash,directPath:a.directPath}):t.entries.addEntry({deprecatedMms3Url:a.url,mediaKey:a.mediaKey||i.mediaKey,mediaKeyTimestamp:a.mediaKeyTimestamp,encFilehash:a.encFilehash,type:e,directPath:a.directPath,debugHint:"rmr"});r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr entry can not be found")),null==r||r.markWhetherOnServer(!0)}return a.status}))()}msgProps(e){const t={};v(t,this,h.FIELDS.RAW),v(t,this.contentInfo,this.contentFields()),v(t,e,h.MSG_SPECIFIC_FIELDS),t.preview=this.contentInfo._preview;const r={};for(const e in t){const n=h.MEDIA_TO_MSG[e];n&&(r[n]=t[e])}return r}delete(){this._saveMedia=null;const{cancelDownloadMedia:e,cancelUploadMedia:t}=r(78986);e(this),t(this),this.clearBlob()}runProcessIfNotRunBefore(e,t,r){let n=this._keyedProcesses;n||(n=this._keyedProcesses={}),n.hasOwnProperty(e)||(this._pendingChangesCount++,n[e]=Promise.resolve(r).then(t).then((e=>{this.consolidate(e)})).finally((()=>{this._pendingChangesCount--,0===this._pendingChangesCount&&this.notifyMsgsAsync()})))}getPendingProcess(e){return 0!==this._pendingChangesCount&&this._keyedProcesses&&this._keyedProcesses.hasOwnProperty(e)?this._keyedProcesses[e]:Promise.resolve()}videoStreamingInfo(e){var t=this;return(0,a.default)((function*(){if(t.type!==h.TYPE.VIDEO)return __LOG__(4,void 0,new Error,!0)`type: ${String(t.type)}`,void SEND_LOGS("media-fault: media streaming info request for non-video type");const r=t.entries.getDownloadEntry();if(!r||!r.sidecar)return null;const[n,a]=yield Promise.all([(0,l.default)(p.MEDIA_TYPES.VIDEO,r.mediaKey),r.url()]);return{cryptoKeys:(0,i.default)((0,i.default)({},n),{},{cipherKey:n.encKey,sidecar:r.sidecar}),streamData:{clientUrl:a,size:t.size,msgKey:e}}}))()}addStickerPack(e){const t=this._stickerPacks;for(let r=0;r<t.length;r++){const[n,i]=t[r];n!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-pack-add"))}t.push([e,!1]),this.notifyMsgsAsync()}addSticker(e){const t=this._stickers;for(let r=0;r<t.length;r++){const[n,i]=t[r];n!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-add"))}t.push([e,!1]),this.notifyMsgsAsync()}removeSticker(e){const t=this._stickers;let r=!1;for(let n=0;!r&&n<t.length;n++){const[i,a]=t[n];i!==e||a||(t[n][1]=!0,r=!0)}}removeStickerPack(e){const t=this._stickerPacks;let r=!1;for(let n=0;!r&&n<t.length;n++){const[i,a]=t[n];i!==e||a||(t[n][1]=!0,r=!0)}}hasAssociatedStickers(){return this._stickers.some((e=>{let[t,r]=e;return!r}))}hasAssociatedStickerPacks(){return this._stickerPacks.some((e=>{let[t,r]=e;return!r}))}associatedStickers(){return this._stickers.reduce(((e,t)=>{let[r,n]=t;return n?e:e.concat(r)}),[])}associatedStickerPacks(){return this._stickerPacks.reduce(((e,t)=>{let[r,n]=t;return n?e:e.concat(r)}),[])}toJSON(){return{mediaBlob:this.mediaBlob,size:this.size,filehash:this.filehash,type:this.type,contentInfo:this.contentInfo,downloadStage:this.downloadStage,uploadStage:this.uploadStage}}}},22104:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.rmrSticker=function(){return d.apply(this,arguments)},t.rmrStickerPack=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=n(r(45095)),s=r(7293),o=r(61596),l=n(r(75642)),c=n(r(56891));function d(){return(d=(0,i.default)((function*(e,t,r){if(r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without sticker")),s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const n=yield c.default.mediaUpload("sticker",r.id),i=n.sticker;if(200===n.status&&i){const r=0;t.forEach((e=>{let[t,n]=e;n||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("rmrSticker:same-direct-path-after-rmr")),i.mediaKey=(0,a.default)((0,l.default)(i.mediaKey),"sanitizeBase64(nextSticker.mediaKey)"),t.deprecatedMms3Url=i.url,t.filehash=i.filehash,t.width=i.width,t.height=i.height,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=r,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const n=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:r,encFilehash:i.encFilehash,type:o.MEDIA_TYPES.STICKER,directPath:i.directPath,debugHint:"rmrSticker"});n&&n.markWhetherOnServer(!0)}return n}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t,r){if(r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without stickerPack")),s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const n=yield c.default.mediaUpload("sticker-pack",r.id),i=n.stickerPack;if(200===n.status&&i){const r=0;t.forEach((e=>{let[t,n]=e;n||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("rmrStickerPack:same-direct-path-after-rmr")),t.url=i.url,t.filehash=i.filehash,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=r,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const n=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:r,encFilehash:i.encFilehash,type:o.MEDIA_TYPES.IMAGE,directPath:i.directPath,debugHint:"rmrStickerPack"});n&&n.markWhetherOnServer(!0)}return n}))).apply(this,arguments)}},94995:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(81109)),s=i(r(48926)),o=r(18412),l=i(r(41143)),c=r(35718),d=r(22683),u=i(r(69618)),p=r(99234),h=i(r(92360)),f=i(r(46220)),_=r(7293),m=n(r(36638)),g=r(84866),y=i(r(2320)),E=r(45554),S=n(r(88297)),v=r(58668),T=r(61596),A=r(56406),C=i(r(11339)),b=r(9329),P=r(70996),M=i(r(32219)),O=i(r(34949)),I=i(r(15554)),w=r(15860),R=r(75887),D=r(13705),N=r(64551),L=r(31019),k=r(28080),G=i(r(2603)),U=i(r(74460)),F=r(2541);function x(e,t){return"product"===t.type?C.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:(0,L.unproxy)(e).isGroup?C.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:C.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL}function B(e){return N.ServerProps.webUploadDocumentThumbMmsEnabled&&e===T.MEDIA_TYPES.DOCUMENT}function K(e,t,n){var i;__LOG__(2)`Media:sendToChat chat ${t.id.toString()}`;const{caption:o,footer:y}=n,L=n.quotedMsg?n.quotedMsg.msgContextInfo(t.id):{},k=(0,p.getMeUser)(),K=n.productMsgOptions||{};let Y,j,W,H;!t.isUser&&_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&(Y=k),t.isEphemeralSettingOn()&&(j=t.getEphemeralSetting());const V=t.getEphemeralSettingTimestamp();null!=V&&(W=V);const $=t.getDisappearingModeInitiator();null!=$&&(H=$);const z=(0,a.default)({t:d.Clock.globalUnixTime(),from:k,isNewMsg:!0,to:t.id,self:"out",type:null!==(i=n.type)&&void 0!==i?i:e._baseType,ack:u.default.ACK.CLOCK,local:!0,id:new M.default({from:k,to:t.id,id:(0,w.newTag)(),participant:Y,selfDir:"out"}),caption:o,footer:y,quotedMsg:L.quotedMsg,quotedParticipant:L.quotedParticipant,quotedStanzaID:L.quotedStanzaID,quotedRemoteJid:L.quotedRemoteJid,mentionedJidList:n.mentionedJidList,isForwarded:n.isForwarded,forwardingScore:n.forwardingScore,multicast:n.multicast,forwardedFromWeb:n.forwardedFromWeb,ctwaContext:n.ctwaContext,ephemeralDuration:j,ephemeralSettingTimestamp:W,disappearingModeInitiator:H},K),q=e.waitForPrep().then((e=>{const t=e.mediaBlob;return!t||t instanceof O.default?e:O.default.createFromData(t,t.type).then((t=>(e.mediaBlob=t,e)))})).then((e=>{const r=e.filehash;r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: sendToChat filehash undefined"));const i=S.getOrCreateMediaObject(r),a=i.mediaBlob;a&&(a.retain(),e.mediaBlob instanceof O.default&&e.mediaBlob.autorelease(),e.mediaBlob=a),e.mediaBlob instanceof O.default&&(e.renderableUrl=e.mediaBlob.url()),i.consolidate(e.toJSON()),e.mediaBlob instanceof O.default&&e.mediaBlob.autorelease();if((0,A.shouldUseMediaCache)((0,T.castToV4)(i.type))&&e.mediaBlob instanceof O.default){const t=e.mediaBlob.formData();g.MediaBlobCache.put(r,t)}(0,b.downloadMedia)({mimetype:e.mimetype,mediaObject:i,downloadEvenIfExpensive:!0,mediaType:(0,T.msgToMediaType)({type:e.type,isGif:e.isGif}),rmrReason:C.default.WEBC_RMR_REASON_CODE.SEND_TO_CHAT,downloadOrigin:x(t,z),mode:"manual"});const s=i.msgProps(e);return s.caption=o,o||e.type!==v.OUTWARD_TYPES.DOCUMENT||(s.caption=e.filename),N.ServerProps.viewOnceWrite&&n.isViewOnce&&(s.isViewOnce=!0),s}));let J,Q,X;function Z(){return ee.apply(this,arguments)}function ee(){return(ee=(0,s.default)((function*(e){J=e;const{mediaObject:r}=e;r||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: incorrect media object for created msg")),(0,l.default)(r,"msg is missing mediaObject");const n=(0,T.msgToMediaType)(e),i=r.entries.getUploadEntry(),s=i?{key:i.mediaKey,timestamp:i.mediaKeyTimestamp}:(0,I.default)();let{fullPreviewData:o,fullPreviewSize:d}=r.contentInfo,p=e.body;if(B(n)&&!o&&r.contentInfo.preview){const e=yield m.base64ImageToCanvas(r.contentInfo.preview.url()),t=yield(0,c.generateMicroThumb)(e,1300,{mimetype:"image/jpeg",maxAttempts:10});o=r.contentInfo.preview,d={width:t.width,height:t.height},p=F.URL.parseDataURL(t.dataUrl).data}const _=o&&d&&B(n),g=e.safe(),y=o&&_&&g.type===u.default.MSG_TYPE.DOCUMENT?(0,U.default)({thumbnail:o,mediaKeyInfo:s,mediaType:(0,h.default)(g),uploadOrigin:(0,f.default)(t),forwardedFromWeb:Boolean(e.forwardedFromWeb)}):Promise.resolve(null),S=(0,P.uploadMedia)({mimetype:e.mimetype,mediaObject:r,mediaType:n,forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,f.default)(t),mediaKeyInfo:s}),{filehash:v}=r;(0,E.shouldUseMediaKeyCache)()&&null!=v&&E.MediaKeyCache.put(v,s);const[{kind:A,mediaEntry:C},b]=yield Promise.all([S,y]),M=null==b?void 0:b.mediaEntry;if(Q=A,!C)throw new Error("upload failed: media entry was not created");(0,E.shouldUseMediaKeyCache)()&&null!=v&&E.MediaKeyCache.delete(v);let O={};if(_){if(!(M&&b&&d)){const e={thumbnailResultEntry:M,uploadThumbnailResult:b,fullPreviewSize:d};throw __LOG__(4,void 0,new Error,!0)`upload failed: thumbnail data incomplete\nDebug info:${JSON.stringify(e)}`,SEND_LOGS("mms-thumbnail-data-incomplete"),new Error("upload failed: thumbnail data incomplete")}O={thumbnailDirectPath:M.directPath,thumbnailSha256:b.filehash,thumbnailEncSha256:M.encFilehash,thumbnailHeight:d.height,thumbnailWidth:d.width}}return(0,G.default)(J,(0,a.default)({deprecatedMms3Url:C.deprecatedMms3Url,directPath:C.directPath,mediaKey:C.mediaKey,mediaKeyTimestamp:C.mediaKeyTimestamp,filehash:r.filehash,encFilehash:C.encFilehash,size:r.size,streamingSidecar:C.sidecar,firstFrameSidecar:C.firstFrameSidecar,body:p},O))}))).apply(this,arguments)}if(n.addEvenWhilePreparing){const e=n.placeholderProps||{};X=(0,R.addAndSendMsgToChat)(t,(0,a.default)((0,a.default)({},e),z),(e=>(J=e,q.then((e=>(0,G.default)(J,e))).then((()=>Z(J))))))[1]}else{const e=q.then((e=>{const t=n.useBasePropsType?z.type:e.type;return(0,a.default)((0,a.default)((0,a.default)({},z),e),{},{type:t})}));X=(0,R.addAndSendMsgToChat)(t,e,Z)[1]}return X.then((e=>({result:e,error:null}))).catch((e=>({result:null,error:e}))).then((e=>{var t,n;let{result:i,error:a}=e;if(i===D.SendMsgResult.OK)return J.type===v.OUTWARD_TYPES.STICKER&&(_.GK.supportsFeature(_.GK.F.MD_BACKEND)?N.ServerProps.webServerStickerPanel&&r(49264).RecentStickerCollectionMd.addStickerWithMediaData(J.mediaData,J.id.toString()):r(91692).RecentStickerCollection.addStickerWithMediaData(J.mediaData)),D.SendMsgResult.OK;const s=null===(t=J)||void 0===t||null===(n=t.mediaObject)||void 0===n?void 0:n.uploadStage;if(J&&(J.ack=u.default.ACK.FAILED),Q===P.UploadMediaResultKind.CANCELLATION)return __LOG__(2)`Media:sendToChat canceled`,D.SendMsgResult.ERROR_CANCELLED;if(__LOG__(3)`Media:sendToChat error\nresult: ${i}\nuploadStage: ${s}\nuploadResultKind: ${Q}\nerror: ${String(a)}`,null!=s)switch(s){case v.UPLOAD_STAGE.NEED_UPLOAD:case v.UPLOAD_STAGE.ERROR_TOO_LARGE:return D.SendMsgResult.ERROR_UPLOAD;case v.UPLOAD_STAGE.ERROR_MISSING:return D.SendMsgResult.ERROR_EXPIRED}return Q===P.UploadMediaResultKind.ERROR?D.SendMsgResult.ERROR_UPLOAD:null!=i?i:D.SendMsgResult.ERROR_UNKNOWN}))}t.default=class{constructor(e,t){this._baseType=e,this._mediaData=new y.default({mediaStage:v.MEDIA_DATA_STAGE.PREPARING}),this._prepwork=t.then((e=>{if(this._mediaData.set(e),!e.filehash)return e.mediaBlob||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: no hash or blob")),(0,k.getHash)(e.mediaBlob).then((e=>{this._mediaData.filehash=e}))}),(e=>{throw this._mediaData.mediaStage=v.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED,e}))}sendToChat(e,t){return(0,o.promiseCallSync)(K,null,this,e,t)}waitForPrep(){var e=this;return(0,s.default)((function*(){return yield e._prepwork,e._mediaData}))()}}},88297:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.associateMediaWithMsg=function(e,t){e.addMsg(t)},t.associateMediaWithSticker=function(e,t){e.addSticker(t)},t.associateMediaWithStickerPack=function(e,t){e.addStickerPack(t)},t.clearMediaForChat=function(){},t.delistAndDeleteAllMedia=function(){const e=o;o={};for(const t in e)e[t].delete()},t.disassociateMediaFromMsg=function(e,t){if(t.mediaObject=null,e.removeMsg(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:r}=e;r&&delete o[r];r&&(0,s.shouldUseLruMediaStore)((0,a.msgToMediaType)(t))&&n.LruMediaStore.del(r);e.delete()},t.disassociateMediaFromSticker=function(e,t){if(t.mediaObject=null,e.removeSticker(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:r}=e;r&&delete o[r];r&&n.LruMediaStore.del(r);e.delete()},t.disassociateMediaFromStickerPack=function(e,t){if(t.mediaObject=null,e.removeStickerPack(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:r}=e;r&&delete o[r];r&&n.LruMediaStore.del(r);e.delete()},t.getOrCreateMediaObject=function(e){return o.hasOwnProperty(e)?o[e]:o[e]=new i.MediaObject};var n=r(55975),i=r(21009),a=r(61596),s=r(56406);let o={}},58668:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD_STAGE=t.TYPE=t.OUTWARD_TYPES=t.MSG_TO_MEDIA=t.MSG_SPECIFIC_FIELDS=t.MEDIA_TO_MSG=t.MEDIA_MSG_PROPS=t.MEDIA_DATA_STAGE=t.MAPPED_STICKER_PROPS=t.MAPPED_MSG_PROPS=t.MAPPED_MEDIA_PROPS=t.FIELDS=t.DOWNLOAD_STAGE=void 0;const n=Object.freeze({preview:"body",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",fullHeight:"height",fullWidth:"width",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",sidecar:"streamingSidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl"});t.MEDIA_TO_MSG=n;const i=Object.freeze({body:"preview",directPath:"directPath",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",height:"fullHeight",width:"fullWidth",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",streamingSidecar:"sidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl",stickerPackId:"stickerPackId",stickerPackName:"stickerPackName",stickerPackPublisher:"stickerPackPublisher"});t.MSG_TO_MEDIA=i;const a=Object.keys(i);t.MAPPED_MSG_PROPS=a;const s=Object.keys(n);t.MAPPED_MEDIA_PROPS=s;t.MAPPED_STICKER_PROPS=["filehash","height","mimetype","size","type","width","stickerPackId","stickerPackName","stickerPackPublisher"];const o=[...a,"deprecatedMms3Url","encFilehash","streamable"];t.MEDIA_MSG_PROPS=o;const l=Object.freeze({VIDEO:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","duration","durationFloat","isViewOnce","fullPreviewData","staticUrl"]),AUDIO:Object.freeze(["duration","waveform"]),IMAGE:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","isViewOnce","fullPreviewData","staticUrl"]),PRODUCT:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview"]),STICKER:Object.freeze(["animationDuration","singleLoopDuration","emojis","firstFrameLength","firstFrameSidecar","isAnimated","isFirstParty","isFromStickerMaker","stickerPackId","stickerPackName","stickerPackPublisher","fullWidth","fullHeight","preview","rgbaBuffer","rgbaWidth","rgbaHeight","aspectRatio"]),STICKER_PACK:Object.freeze([]),DOCUMENT:Object.freeze(["aspectRatio","pageCount","preview","isVcardOverMmsDocument","parsedVcards","fullPreviewData","fullPreviewSize"]),RAW:Object.freeze(["mediaBlob","size","loadedSize","filehash","progressiveStage"])});t.FIELDS=l;t.MSG_SPECIFIC_FIELDS=["type","filename","caption","isGif","gifAttribution","mimetype","pageCount","sidecar","subtype","isViewOnce"];const c=r(54302).Mirrored(["INIT","EXISTS","PREPARING","REUPLOADING","FETCHING","PROCESSING","NEED_POKE","ERROR_MISSING","ERROR_UNSUPPORTED","PROGRESSIVE_READY","RESOLVED"]);t.DOWNLOAD_STAGE=c;const d=r(54302).Mirrored(["INIT","PREPARING","UPLOADING","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","UPLOADED"]);t.UPLOAD_STAGE=d;const u=r(54302).Mirrored(["INIT","EXISTS","PREPARING","UPLOADING","SENDING","REUPLOADING","FETCHING","DECRYPTING","RESOLVED","NEED_POKE","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","ERROR_UNSUPPORTED","PROGRESSIVE_READY","REMOTE_UPLOADING","REMOTE_NEED_UPLOAD"]);t.MEDIA_DATA_STAGE=u;t.OUTWARD_TYPES={IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",UNKNOWN:"unknown"};const p=Object.freeze({VIDEO:"VIDEO",IMAGE:"IMAGE",AUDIO:"AUDIO",STICKER:"STICKER",DOCUMENT:"DOCUMENT",PRODUCT:"PRODUCT"});t.TYPE=p},71644:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){try{const t=e?JSON.parse(e):i.default,r={};return s(t,r,"",""),r}catch(e){return null}};var i=n(r(47466)),a=r(31515);function s(e,t,r,n){let i=e;if(Array.isArray(i)||(0,a.isString)(i)){(0,a.isString)(i)&&(i=[i]);for(let e=0;e<i.length;e++){const s=i[e];(0,a.isString)(s)&&(t[s]=n+r)}}else if("object"==typeof i)for(const e in i)s(i[e],t,e,n+r)}},43257:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MSCFB_MIME=t.MSCFB_HEADER=t.MIMETYPE_DETERMINING_LENGTH=t.MIMETYPES=t.EXT_TO_MIME=t.DOC_MIMES=t.DOCUMENT_MIMETYPES=void 0,t.getExtension=function(e){const t=u[e];return t?"."+(t.ext||e.split("/")[1]).toLowerCase():""},t.getMediaMimeType=function(e,t){const r=t.subarray(0,262),n=(0,o.default)(r);if(n)return n.mime;if("image"===e)return"image/jpeg";throw new c.MediaEncryptionError("unknown mime decrypt error for type:"+e)},t.isAllowedDocumentMimetype=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(const n in _){const i=u[n];if(null==i)continue;const{signatureMimetype:a,ext:s}=i;if((r?a:n)===e&&s&&(null==t?void 0:t.toLowerCase().endsWith(s.toLowerCase())))return n}if(r)return e;return null!=e?e:"application/octet-stream"},t.isMsCompoundFileBinaryFormat=function(e){return(0,s.default)(e,d)},t.previewType=function(e){const t=u[e];return null==t?void 0:t.previewType};var a=i(r(35937)),s=i(r(63438)),o=i(r(97769)),l=i(r(71644)),c=n(r(64103));t.MIMETYPE_DETERMINING_LENGTH=262;const d=new Uint8Array([208,207,17,224,161,177,26,225]);t.MSCFB_HEADER=d;t.MSCFB_MIME="application/x-cfb";const u={"text/plain":{ext:"TXT",msgType:"document",icon:"icon-doc-txt",canSend:!0},"text/rtf":{ext:"RTF",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/rtf"},"text/vcard":{ext:"VCF",msgType:"vcard"},"application/zip":{ext:"ZIP",icon:"icon-doc-generic",msgType:"document"},"application/pdf":{ext:"PDF",msgType:"document",icon:"icon-doc-pdf",canSend:!0,signatureMimetype:"application/pdf",previewType:"pdf"},"application/msword":{ext:"DOC",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-excel":{ext:"XLS",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-powerpoint":{ext:"PPT",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:"DOCX",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{ext:"PPTX",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:"XLSX",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"audio/aac":{msgType:"audio",ext:"AAC"},"audio/mp4":{msgType:"audio"},"audio/amr":{msgType:"audio"},"audio/mpeg":{msgType:"audio"},"audio/ogg; codecs=opus":{msgType:"audio",ext:"OGG"},"audio/wav":{msgType:"audio",ext:"wav"},"video/mp4":{msgType:"video",ext:"MP4"},"video/3gpp":{msgType:"video"},"image/jpeg":{msgType:"image"},"image/png":{msgType:"image"}},p=u;t.MIMETYPES=p;const h=(0,a.default)(p,(e=>"document"===(null==e?void 0:e.msgType)));t.DOCUMENT_MIMETYPES=h;t.DOC_MIMES="*";const f=(0,l.default)();t.EXT_TO_MIME=f;const _=(0,a.default)(u,(e=>"document"===(null==e?void 0:e.msgType)&&!0===e.canSend&&null!=e.ext))},691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILE_PROGRESS_THROTTLE_WAIT_MS=void 0;t.FILE_PROGRESS_THROTTLE_WAIT_MS=100},61596:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MEDIA_TYPE_VALUES=t.MEDIA_TYPES=void 0,t.castToV4=function(e){let t;if(null==e)t=l.DOCUMENT;else{if(!(e in l))throw new Error(`castToV4: unexpected mmsv3 type ${e}`);t=l[e]}return t},t.getMsgMediaType=function(e){return d({type:e.type,interactiveHeader:e.interactiveHeader,isGif:e.type===o.VIDEO&&e.isGif})},t.msgToMediaType=d;var i=n(r(52628)),a=n(r(69618)),s=r(34535);const{MSG_TYPE:o}=a.default,l=Object.freeze({AUDIO:"audio",DOCUMENT:"document",GIF:"gif",IMAGE:"image",NATIVE_FLOW:"native_flow",PPIC:"ppic",PRODUCT:"product",PTT:"ptt",STICKER:"sticker",VIDEO:"video",TEMPLATE:"template",THUMBNAIL_DOCUMENT:"thumbnail-document",THUMBNAIL_IMAGE:"thumbnail-image",THUMBNAIL_VIDEO:"thumbnail-video",THUMBNAIL_LINK:"thumbnail-link",HISTORY_SYNC:"md-msg-hist",MD_APP_STATE:"md-app-state",PRODUCT_CATALOG_IMAGE:"product-catalog-image"});t.MEDIA_TYPES=l;const c=(0,i.default)(l);function d(e){let{type:t,isGif:r,interactiveHeader:n}=e;switch(t){case o.IMAGE:return l.IMAGE;case o.VIDEO:return r?l.GIF:l.VIDEO;case o.AUDIO:return l.AUDIO;case o.PTT:return l.PTT;case o.DOCUMENT:return l.DOCUMENT;case o.STICKER:return l.STICKER;case o.PRODUCT:return l.PRODUCT;case o.NATIVE_FLOW:return l.NATIVE_FLOW;case o.INTERACTIVE:if(null!=(null==n?void 0:n.mediaType))switch(n.mediaType){case s.InteractiveMessageHeaderMediaType.DOCUMENT:return l.DOCUMENT;case s.InteractiveMessageHeaderMediaType.VIDEO:return l.VIDEO;case s.InteractiveMessageHeaderMediaType.IMAGE:return l.IMAGE}}throw new Error(`msg is not a media msg: ${t}, isGif=${String(r)}`)}t.MEDIA_TYPE_VALUES=c},22283:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.default=r},18309:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e)};var i=n(r(68138))},7407:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const n=16*Math.ceil(e/16),s=t.slice(0,i.IV_LENGTH+n);return new a.default(r).sign(s,i.HMAC_LENGTH)};var i=r(71940),a=n(r(39827))},71940:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.IV_LENGTH=t.HMAC_LENGTH=void 0,t.calculateStreamingSidecar=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(98913)),s=r(32428),o=n(r(39827));const l=65536;t.IV_LENGTH=16;function c(){return(c=(0,i.default)((function*(e,t){const r=e instanceof ArrayBuffer?e.byteLength:e.buffer.byteLength,n=new o.default(t),i=Math.ceil((r-16)/l),c=(0,a.default)(i,(t=>{const r=t*l,i=e.slice(r,r+16+l);return n.sign(i,10)})),d=yield Promise.all(c);return(0,s.concatArrayBuffers)(...d)}))).apply(this,arguments)}t.HMAC_LENGTH=10},28011:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var a=i(r(48926)),s=r(15688),o=n(r(64103)),l=n(r(12206)),c=r(61596);function d(){return(d=(0,a.default)((function*(e,t){const r=u(e);let n;try{n=(0,s.decodeB64)(t)}catch(e){}if(!t||!r||!n)throw new o.MediaEncryptionError(`createKeys fail: !!mediakey: ${!!t} info: ${r} type: ${e}`);const i=yield l.extractAndExpand(n,r,112);if(!i||i.byteLength<112)throw new o.MediaEncryptionError("computeMediaKeys: hkdf error");return{iv:i.slice(0,16),encKey:i.slice(16,48),macKey:i.slice(48,80),refKey:i.slice(80,112)}}))).apply(this,arguments)}function u(e){switch(e){case c.MEDIA_TYPES.AUDIO:return"WhatsApp Audio Keys";case c.MEDIA_TYPES.DOCUMENT:return"WhatsApp Document Keys";case c.MEDIA_TYPES.GIF:return"WhatsApp Video Keys";case c.MEDIA_TYPES.IMAGE:return"WhatsApp Image Keys";case c.MEDIA_TYPES.PPIC:throw new Error("Cannot create media keys for profile pics");case c.MEDIA_TYPES.PRODUCT:return"WhatsApp Image Keys";case c.MEDIA_TYPES.PTT:return"WhatsApp Audio Keys";case c.MEDIA_TYPES.STICKER:return"WhatsApp Image Keys";case c.MEDIA_TYPES.VIDEO:return"WhatsApp Video Keys";case c.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return"WhatsApp Document Thumbnail Keys";case c.MEDIA_TYPES.THUMBNAIL_IMAGE:return"WhatsApp Image Thumbnail Keys";case c.MEDIA_TYPES.THUMBNAIL_VIDEO:return"WhatsApp Video Thumbnail Keys";case c.MEDIA_TYPES.THUMBNAIL_LINK:return"WhatsApp Link Thumbnail Keys";case c.MEDIA_TYPES.TEMPLATE:throw new Error("Cannot create media keys for template");case c.MEDIA_TYPES.HISTORY_SYNC:return"WhatsApp History Keys";case c.MEDIA_TYPES.MD_APP_STATE:return"WhatsApp App State Keys";case c.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE:throw new Error("Cannot create media keys for product catalog image")}}},74994:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(95024),s=r(46269),o=r(60977),l=r(89626),c=n(r(18309)),d=r(64103),u=n(r(39827)),p=r(23125);const h=10;function f(){return(f=(0,i.default)((function*(e){let{mediaKeys:t,ciphertextHmac:r,expectedPlaintextHash:n,debugString:f}=e;if(yield Promise.resolve(),__LOG__(2)`decryptMedia: [${f}] start`,r.byteLength<h)throw new d.MediaDecryptionError(`ciphertext too short: ${r.byteLength}`);const{iv:_,encKey:m,macKey:g}=t,y=(0,s.castTypedArrays)(Uint8Array,r);try{return yield new u.default(g).sign((0,o.concatTypedArrays)(Uint8Array,[new Uint8Array(_),(0,p.isPerformanceExperimentEnabled)()?y.subarray(0,-10):y.slice(0,-10)]),h).then((e=>{const t=y.buffer.slice(-10);if(!(0,a.arrayBuffersDeepEqual)(e,t))throw new d.MediaDecryptionError("decryptMedia: hmac mismatch");return(0,l.aesCbcDecryptWithIv)(m,_,y.subarray(0,-10))})).then(function(){var e=(0,i.default)((function*(e){if(null==n)return e;if((yield(0,c.default)(e))!==n)throw new d.MediaDecryptionError("decryptMedia: plaintext hash mismatch");return __LOG__(2)`decryptMedia: [${f}] success`,e}));return function(){return e.apply(this,arguments)}}())}catch(e){if(__LOG__(3)`decryptMedia: [${f}] error`,e instanceof d.MediaDecryptionError)throw e;throw new d.MediaDecryptionError(`decryption error: ${String(e)}; stack: ${e.stack}`)}}))).apply(this,arguments)}},80733:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptPartialMedia=t.decrypt=t.cleanupCiphertextAndIv=t.HMAC_SIZE=t.BLOCK_SIZE=void 0;var i=n(r(48926)),a=r(60977),s=r(70452);t.BLOCK_SIZE=16;t.HMAC_SIZE=10;const o=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,iv:r,mediaKeys:n}=e,{encKey:i}=n;try{const e=yield(0,s.getCrypto)().importKey("raw",new Uint8Array(i),"AES-CBC",!1,["decrypt"]).catch((e=>{throw __LOG__(2)`decryptPartialMedia:decrypt importKey error: ${String(e)}`,e}));return(0,s.getCrypto)().decrypt({name:"AES-CBC",iv:r},e,t)}catch(e){throw __LOG__(2)`decryptPartialMedia:decrypt decrypt error: ${String(e)}`,e}}));return function(){return e.apply(this,arguments)}}();t.decrypt=o;const l=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,mediaKeys:r}=e,{encKey:n}=r,i={name:"AES-CBC",iv:(t instanceof Uint8Array?t:new Uint8Array(t)).slice(-16)};try{const e=yield(0,s.getCrypto)().importKey("raw",new Uint8Array(n),"AES-CBC",!1,["encrypt"]).catch((e=>{__LOG__(2)`decryptPartialMedia:getEncryptedPadding importKey error: ${String(e)}`})),t=new Uint8Array([]);return(0,s.getCrypto)().encrypt(i,e,t)}catch(e){return void __LOG__(2)`decryptPartialMedia:getEncryptedPadding encrypt error: ${String(e)}`}}));return function(){return e.apply(this,arguments)}}(),c=e=>{const{serverRangeStart:t,ciphertext:r,mediaKeys:n}=e;let i=r instanceof Uint8Array?r:new Uint8Array(r);const s=i.byteLength%16==0;let o;return 0===t?o=new Uint8Array(n.iv):(o=i.slice(0,16),i=i.slice(16)),s||(i=i.slice(0,i.byteLength-10)),s?l({ciphertext:i,mediaKeys:n}).then((e=>(i=(0,a.concatTypedArrays)(Uint8Array,[i,new Uint8Array(e)]),{ciphertext:i,iv:o}))):Promise.resolve({ciphertext:i,iv:o})};t.cleanupCiphertextAndIv=c;const d=function(){var e=(0,i.default)((function*(e){let{mediaKeys:t,ciphertext:r}=e;const{ciphertext:n,iv:i}=yield c({serverRangeStart:0,ciphertext:r,mediaKeys:t});return o({ciphertext:n,iv:i,mediaKeys:t})}));return function(){return e.apply(this,arguments)}}();t.decryptPartialMedia=d},83899:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{mediaKey:t,plaintext:r,type:n}=e;return new Promise(((e,i)=>{if(t.slice(0,10),__LOG__(2)`encryptMedia: start`,!n)throw new h.MediaEncryptionError('encryptMedia: missing "type"');if(!t)throw new h.MediaEncryptionError('encryptMedia: missing "mediaKey"');(0,p.default)(n,t).then((e=>(0,g.isPerformanceExperimentEnabled)()?function(){return v.apply(this,arguments)}(r,n,e):function(){return y.apply(this,arguments)}(r,n,e))).then((t=>{__LOG__(2)`encryptMedia: success`,e(t)})).catch((e=>{if(__LOG__(3)`encryptMedia: error`,e instanceof h.MediaEncryptionError)throw e;throw new h.MediaEncryptionError(`encryption error: ${String(e)}; stack: ${e.stack}`)})).catch(i)}))};var i=n(r(48926)),a=r(32428),s=r(67602),o=r(60977),l=r(89626),c=n(r(18309)),d=n(r(7407)),u=r(71940),p=n(r(28011)),h=r(64103),f=n(r(39827)),_=r(61596),m=r(92108),g=r(23125);function y(){return(y=(0,i.default)((function*(e,t,r){let{iv:n,encKey:i,macKey:o}=r;const p=yield(0,l.aesCbcEncrypt)(i,e,n),h=p.slice(n.byteLength),g=new f.default(o),y=yield g.sign(p,10);let E=Promise.resolve();if(t===_.MEDIA_TYPES.VIDEO||t===_.MEDIA_TYPES.AUDIO){const e=(0,a.concatArrayBuffers)(p,y);E=(0,u.calculateStreamingSidecar)(e,o)}let S=Promise.resolve();if(t===_.MEDIA_TYPES.STICKER){const{firstFrameLength:t}=(0,m.parseWebp)(e);if(null!=t){const e=(0,a.concatArrayBuffers)(p,y);S=(0,d.default)(t,e,o)}}const v=(0,a.concatArrayBuffers)(h,y);return(0,s.promiseProps)({ciphertextHmac:v,hash:(0,c.default)(v),sidecar:E,firstFrameSidecar:S})}))).apply(this,arguments)}function E(e){let{ivCiphertext:t,signature:r,macKey:n}=e;const i=(0,a.concatArrayBuffers)(t,r);return{sidecar:(0,u.calculateStreamingSidecar)(i,n),firstFrameSidecar:Promise.resolve()}}const S=new Map([[_.MEDIA_TYPES.VIDEO,E],[_.MEDIA_TYPES.AUDIO,E],[_.MEDIA_TYPES.STICKER,function(e){let{plaintext:t,ivCiphertext:r,signature:n,macKey:i}=e;const{firstFrameLength:s}=(0,m.parseWebp)(t);return{sidecar:Promise.resolve(),firstFrameSidecar:null!=s?(0,d.default)(s,(0,a.concatArrayBuffers)(r,n),i):Promise.resolve()}}]]);function v(){return(v=(0,i.default)((function*(e,t,r){var n,i;let{iv:a,encKey:d,macKey:u}=r;const p=yield(0,l.aesCbcEncrypt)(d,e,a),h=new Uint8Array(p).subarray(a.byteLength),_=new f.default(u),m=yield _.sign(p,10),{sidecar:g=Promise.resolve(),firstFrameSidecar:y=Promise.resolve()}=null!==(n=null===(i=S.get(t))||void 0===i?void 0:i({plaintext:e,ivCiphertext:p,signature:m,macKey:u}))&&void 0!==n?n:{},E=(0,o.concatTypedArrays)(Uint8Array,[h,new Uint8Array(m)]).buffer;return(0,s.promiseProps)({ciphertextHmac:E,hash:(0,c.default)(E),sidecar:g,firstFrameSidecar:y})}))).apply(this,arguments)}},27126:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageStreamer=t.EOI_TAG=void 0,t.getProgressiveMediaCacheKey=E;var i=n(r(48926)),a=r(71610),s=r(76100),o=r(95024),l=r(40265),c=r(60977),d=r(89626),u=r(69830),p=n(r(39827)),h=r(84866);class f extends((0,l.customError)("ChunkValidationError")){constructor(e){super(`Chunk ${e} does not match sidecar`)}}const _=16,m=new Uint8Array([2,2]),g=new Uint8Array([255,217]);t.EOI_TAG=g;function y(){return(y=(0,i.default)((function*(e,t){const{encKey:r}=t;return(yield(0,d.aesCbcEncrypt)(r,m,new Uint8Array(e.slice(-16)))).slice(-16)}))).apply(this,arguments)}function E(e,t){return`${e}-progressive-${t}`}t.ImageStreamer=class{constructor(e){this._alignedScanLengths=[],this._increasingScanLengths=[],this._lastDecryptedChunk=0,this._downloadedBytes=new ArrayBuffer(0);const{cryptoKeys:t,scanLengths:r,scansSidecar:n,filehash:i,mimetype:a,debugString:s,onProgressiveUpdate:o}=e;this._cryptoKeys=t,this._scanLengths=r,this._scansSideCar=n,this._filehash=i,this._mimetype=a,this._nextChunkIV=this._cryptoKeys.iv,this._decryptedChunks=new Array(r.length),this._onProgressiveUpdate=o,this._debugString=s}_validateSidecar(e,t){var r=this;return(0,i.default)((function*(){0===t&&(r._nextChunkIV=r._cryptoKeys.iv);const{macKey:n}=r._cryptoKeys,i=r._scansSideCar.slice(10*t,10*t+10),a=r._nextChunkIV;r._nextChunkIV=e.slice(-16);const s=(0,c.concatTypedArrays)(Uint8Array,[new Uint8Array(a),new Uint8Array(e)]),l=yield new p.default(n).sign(s,10);if(!(0,o.arrayBuffersDeepEqual)(l,i))throw new f(t)}))()}_cleanupCipherTextAndIV(e,t){var r=this;return(0,i.default)((function*(){let n=e;const i=n.byteLength%_==0;let a;if(0===t)a=r._cryptoKeys.iv;else{const e=r._increasingScanLengths[t-1];a=r._downloadedBytes.slice(e-_,e)}if(i||(n=n.slice(0,n.byteLength-10)),i){const e=yield function(){return y.apply(this,arguments)}(n,r._cryptoKeys);return{cipherText:(0,c.concatTypedArrays)(Uint8Array,[new Uint8Array(n),new Uint8Array(e)]),iv:a}}return{cipherText:n,iv:a}}))()}_getLastFullyLoadedChunkIndex(e){let t=0;for(let r=0;r<this._alignedScanLengths.length;r++)if(t+=this._alignedScanLengths[r],e<t)return r;return this._alignedScanLengths.length}_handleChunk(e,t){var r=this;return(0,i.default)((function*(){yield r._validateSidecar(e,t);const{cipherText:n,iv:i}=yield r._cleanupCipherTextAndIV(e,t),a=yield(0,d.aesCbcDecrypt)(r._cryptoKeys.encKey,(0,c.concatTypedArrays)(Uint8Array,[new Uint8Array(i),new Uint8Array(n)])),s=yield(0,u.removeEncryptedPadding)(a,m.buffer);return __LOG__(2)`ImageStreamer: [${r._debugString}] Successfully decrypted chunk ${t} of ${r._scanLengths.length} total`,s}))()}_generateBlobFromFullyLoadedChunks(e){var t=this;return(0,i.default)((function*(){var r;const n=yield Promise.all(t._decryptedChunks.slice(0,e)),i=t._scanLengths.slice(0,e).reduce(((e,t)=>e+t),0),a=(0,c.concatTypedArrays)(Uint8Array,n.map((e=>new Uint8Array(e)))).slice(0,i),s=(0,o.arrayBuffersDeepEqual)(g.buffer,a.slice(-g.length).buffer)?a:(0,c.concatTypedArrays)(Uint8Array,[a,g]),l=[s],d=t._mimetype?new Blob(l,{type:t._mimetype}):new Blob(l),u=E(t._filehash,e);return h.MediaBlobCache.put(u,d),__LOG__(2)`ImageStreamer: [${t._debugString}] Generated progressive image using ${e} chunks of ${t._scanLengths.length} total`,null===(r=t._onProgressiveUpdate)||void 0===r||r.call(t,e),t._lastDecryptedChunk=e,s.buffer}))()}_decryptFullyLoadedChunks(e,t){var r=this;return(0,i.default)((function*(){for(let n=0;n<t;n++)if(!r._decryptedChunks[n]){const t=0===n?0:r._increasingScanLengths[n-1],i=e.slice(t,t+r._alignedScanLengths[n]);yield Promise.all(r._decryptedChunks),r._decryptedChunks[n]||(r._decryptedChunks[n]=r._handleChunk(i,n))}}))()}handleProgress(e,t){var r=this;return(0,i.default)((function*(){if(!r._alignedScanLengths.length){r._alignedScanLengths=(0,a.alignChunkLengthsToMultipleOfAesBlockSize)(r._scanLengths,e);for(let e=0;e<r._alignedScanLengths.length;e++){const t=r._alignedScanLengths[e],n=0===e?t:r._increasingScanLengths[e-1]+t;r._increasingScanLengths.push(n)}}const n="string"==typeof t?t.length:t.byteLength,i=r._getLastFullyLoadedChunkIndex(n);if(i<=r._lastDecryptedChunk)return null;try{const e="string"==typeof t?yield(0,s.largeStringToArrayBuffer)(t):t;return r._downloadedBytes=e,yield r._decryptFullyLoadedChunks(r._downloadedBytes,i),yield r._generateBlobFromFullyLoadedChunks(i)}catch(e){__LOG__(3)`ImageStreamer:handleProgress error: ${e}`;const t=`${e.message}, [${r._debugString}]scanLengths length: ${r._scanLengths.length}, scansSidecar byteLength: ${r._scansSideCar.byteLength}.`;e instanceof f?(__LOG__(2)`ImageStreamer:chunk validation error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:chunk validation error`,SEND_LOGS("ImageStreamer:chunk validation error")):(__LOG__(2)`ImageStreamer:handleProgress error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:handleProgress error`,SEND_LOGS("ImageStreamer:handleProgress error"))}}))()}}},15554:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),{key:(0,n.encodeB64)(e),timestamp:i.Clock.globalUnixTime()}};var n=r(15688),i=r(22683)},95987:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const r=(0,a.generateMediaEventId)(),n=new s.default.MediaDownload2({mediaId:r,connectionType:s.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,a.getMetricMediaType)(e.type),overallMmsVersion:4,networkStack:s.default.NETWORK_STACK_TYPE.NATIVE,overallDownloadMode:(0,a.getMetricOverallDownloadModeType)(e.type),overallAttemptCount:e.userDownloadAttemptCount,overallDownloadOrigin:e.downloadOrigin,overallBackendStore:null!==(t=(0,a.getMetricBackendStore)(e.directPath))&&void 0!==t?t:void 0});return i.downloadUploadCrashLogger.mark(r,i.ProgressType.DOWNLOAD_STARTED),{mediaId:r,handleDownloadSuccess:e=>{n.set({overallMediaSize:e,overallDownloadResult:s.default.MEDIA_DOWNLOAD_RESULT_TYPE.OK,overallIsFinal:!0,downloadHttpCode:200}),i.downloadUploadCrashLogger.mark(r,i.ProgressType.DOWNLOAD_FINISHED,{overallMediaSize:e})},handleDownloadHostFound:e=>{let{hostName:t,hostClass:r,failCount:i}=e;n.set({overallDomain:t,overallConnectionClass:r,overallRetryCount:i})},handleDownloadError:(e,t)=>{n.set({overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(e),overallIsFinal:t});const r=(0,a.getStatusCode)(e);null!=r&&(n.downloadHttpCode=r),n.markOverallCumT(),n.commit(),(0,a.logErrorUnknownDetails)(n,e)},handleDownloadAttemptSuccess:e=>{n.set({overallT:e})},handleDownloadAttemptError:e=>{let{err:t,overallT:r,failCount:i}=e;const o=new s.default.MediaDownload2(n);o.set({mediaId:(0,a.generateMediaEventId)(),overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(t),overallIsFinal:!1,overallT:r,overallRetryCount:i});const l=(0,a.getStatusCode)(t);null!=l&&(n.downloadHttpCode=l),n.markOverallCumT(),o.commit(),(0,a.logErrorUnknownDetails)(o,t)},handleDownloadAndDecryptSuccess:()=>{n.markOverallCumT(),n.commit()},markDecryptionEnd:()=>{n.markOverallDecryptT()},markDecryptionStart:()=>{n.startOverallDecryptT()}}};var i=r(22200),a=r(29992),s=n(r(11339))},47235:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadAndDecryptCache=void 0,t.getLRUStoreKey=l;var i=n(r(48926)),a=r(55975),s=r(56406),o=n(r(28245));function l(e){var t,r;const n=null===(t=e.progressiveJpegOpts)||void 0===t?void 0:t.scanCount,i=null===(r=e.progressiveJpegOpts)||void 0===r?void 0:r.scanLengths;if(null!=n&&i)return`${e.filehash}-${n}/${i.length}-scans`;if(e.partialVideoOpts){const{secondsToDownload:t}=e.partialVideoOpts;return`${e.filehash}-${t}-seconds`}return e.filehash}t.DownloadAndDecryptCache=class{get(e,t){return(0,i.default)((function*(){if(!(0,s.shouldUseLruMediaStore)(t.type))return null;try{return yield a.LruMediaStore.get(l(t))}catch(e){return __LOG__(3,!0)`downloadManager.asyncCache.get error:\n${(0,o.default)(e)}`,null}}))()}set(e,t,r){return(0,i.default)((function*(){if((0,s.shouldUseLruMediaStore)(r.type))try{yield a.LruMediaStore.put(l(r),t)}catch(e){__LOG__(3,!0)`downloadManager.asyncCache.set error:\n${(0,o.default)(e)}`}}))()}}},26384:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadManager=void 0;var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=n(r(70714)),l=n(r(67643)),c=n(r(53781)),d=n(r(95987)),u=n(r(28011)),p=n(r(74994)),h=r(80733),f=r(47235),_=r(22200),m=r(37115),g=n(r(56747)),y=r(27126),E=r(21009),S=r(61596),v=r(58668),T=n(r(58596)),A=n(r(11339)),C=n(r(39436)),b=r(47524),P=n(r(28245));const M=1,O=2,I=e=>{switch(e){case S.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return O;case S.MEDIA_TYPES.VIDEO:default:return M}};function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e){const{directPath:t,encFilehash:r,filehash:n,mediaKey:i,onDecryptStart:a,downloadOrigin:l,staticUrl:c,type:f,mode:E,progressiveJpegOpts:S,partialVideoOpts:v,onProgress:T,userDownloadAttemptCount:A}=e,{handleDownloadSuccess:b,handleDownloadHostFound:M,handleDownloadError:O,handleDownloadAttemptSuccess:I,handleDownloadAttemptError:w,handleDownloadAndDecryptSuccess:R,markDecryptionStart:D,markDecryptionEnd:N,mediaId:L}=(0,d.default)({directPath:t,downloadOrigin:l,type:f,userDownloadAttemptCount:A}),k=e.signal||(new o.default).signal,U=n.slice(0,10);__LOG__(2)`downloadManager.download: [${U}] start`;try{const e=null==S?void 0:S.scanCount,o=null!=e&&e===(null==S?void 0:S.scanLengths.length)?null:e;let l=null;const d=(0,g.default)({partialVideoOpts:v,progressiveJpegOpts:S,scanCount:o}),m=null==o&&S?(e,t)=>{var r;null===(r=l)||void 0===r||r.handleProgress(e.total,t)}:null,[A,P,O]=yield Promise.all([(0,u.default)(f,i).then((e=>(S&&(l=new y.ImageStreamer({cryptoKeys:e,scanLengths:S.scanLengths,scansSidecar:S.scansSidecar,mimetype:S.mimetype,filehash:n,debugString:U,onProgressiveUpdate:S.onProgressiveUpdate})),e))),G({scanCount:o,directPath:t,encFilehash:r,type:f,signal:k}),C.default.download({directPath:t,encFilehash:r,staticUrl:c,type:f,signal:k,mode:E,byteRange:d,onResponseText:m,onDownloadHostFound:M,onDownloadAttemptSuccess:I,onDownloadAttemptError:w,debugString:U,onProgress:T})]);let x;var F;if(a&&a(),b(O.byteLength),_.downloadUploadCrashLogger.mark(L,_.ProgressType.DOWNLOAD_DECRYPTION_STARTED),D(),null!=o)x=(0,s.default)(yield null===(F=l)||void 0===F?void 0:F.handleProgress(P,O),"yield imageStreamer?.handleProgress(encryptedFileSize, ciphertextHmac)");else x=v?yield(0,h.decryptPartialMedia)({mediaKeys:A,ciphertext:O}):yield(0,p.default)({mediaKeys:A,ciphertextHmac:O,expectedPlaintextHash:n,debugString:U});return N(),_.downloadUploadCrashLogger.mark(L,_.ProgressType.DOWNLOAD_DECRYPTION_FINISHED),__LOG__(2)`downloadManager.download: [${U}] success`,R(),x}catch(t){throw t instanceof m.MediaNotFoundError?(O(t,Boolean(e.isFinalRmrRetry)),__LOG__(2,!0)`downloadManager.download: [${U}] expected error\n${(0,P.default)(t)}`):(O(t,!0),__LOG__(3,!0)`downloadManager.download: [${U}] error\n${(0,P.default)(t)}`),_.downloadUploadCrashLogger.mark(L,_.ProgressType.DOWNLOAD_ERROR),t}}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e){var t,r;const{mediaObject:n}=e,a=null!==(t=null===(r=n.filehash)||void 0===r?void 0:r.slice(0,10))&&void 0!==t?t:"";n.filehash,n.type,__LOG__(2)`downloadManager.rmr: [${a}] start`,n.consolidate({downloadStage:v.DOWNLOAD_STAGE.REUPLOADING});const s=performance.now(),o=new A.default.WebcMediaRmr((0,i.default)((0,i.default)({},e.rmrData),{},{webcRmrReason:e.rmrReason})),l=(0,b.getEffectiveNetworkType)();null!=l&&(o.webcBrowserNetworkType=l),n.type&&(o.messageMediaType=(0,E.webMediaTypeToWamMediaType)(n.type)),null!=n.size&&(o.webcMediaSize=n.size);try{const e=yield n.rmr({onMsgSelect:function(e){null==o.webcChatType&&e.chat&&(o.webcChatType=e.chat.getWebcChatType()),null==o.webcMessageT&&(o.webcMessageT=e.t),o.messageMediaType=e.getWamMediaType()}});if(o.webcRmrStatusCode=e,__LOG__(2)`downloadManager.rmr: [${a}] status ${e}`,404===e)throw new m.MediaNotOnPhone;if(200!==e)throw new m.ServerStatusCodeError(e)}catch(e){throw o.webcMediaRmrError=!0,e instanceof m.MediaNotOnPhone?(__LOG__(2,!0)`downloadManager.rmr: [${a}] error MediaNotOnPhone\n${(0,P.default)(e)}`,e):(__LOG__(3,!0)`downloadManager.rmr: [${a}] error ${e.status||e.message}\n${e.stack}`,new m.MediaNeedsReupload)}finally{o.webcMediaRmrT=Math.ceil(performance.now()-s),o.commit()}}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e){const{directPath:t,encFilehash:r,signal:n,type:i}=e;yield C.default.checkExistence({directPath:t,encFilehash:r,type:i,signal:n||(new o.default).signal})}))).apply(this,arguments)}function G(e){const{scanCount:t,directPath:r,encFilehash:n,type:i,signal:a}=e;return null==t?Promise.resolve(null):C.default.getEncryptedMediaSize({directPath:(0,s.default)(r,"directPath is required for partial downloads"),encFilehash:(0,s.default)(n,"encFilehash is required for partial downloads"),signal:a,type:i})}const U=new class{constructor(){this.preloader=new c.default(10,{thumbnail:4}),this.downloadAndDecrypt=(0,l.default)((e=>(0,f.getLRUStoreKey)(e)),new f.DownloadAndDecryptCache,(e=>!0===e.isPreload?this.preloader.enqueue((()=>w(e)),{priority:-I(e.type),group:"thumbnail",signal:e.signal}):w(e))),this.rmr=(0,T.default)((e=>e.mediaObject.filehash||""),D),this.checkExistence=(0,T.default)((e=>e.encFilehash),L),_.downloadUploadCrashLogger.init()}};t.downloadManager=U},37115:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return i.AbortError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return i.HttpNetworkError}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return i.HttpStatusCodeError}}),Object.defineProperty(t,"LogoutDrop",{enumerable:!0,get:function(){return n.LogoutDrop}}),Object.defineProperty(t,"MMSForbiddenError",{enumerable:!0,get:function(){return i.MMSForbiddenError}}),Object.defineProperty(t,"MMSThrottleError",{enumerable:!0,get:function(){return i.MMSThrottleError}}),Object.defineProperty(t,"MMSUnauthorizedError",{enumerable:!0,get:function(){return i.MMSUnauthorizedError}}),Object.defineProperty(t,"MediaDecryptionError",{enumerable:!0,get:function(){return a.MediaDecryptionError}}),Object.defineProperty(t,"MediaNeedsReupload",{enumerable:!0,get:function(){return a.MediaNeedsReupload}}),Object.defineProperty(t,"MediaNotFoundError",{enumerable:!0,get:function(){return i.MediaNotFoundError}}),t.MediaNotOnPhone=void 0,Object.defineProperty(t,"NoMediaHostsError",{enumerable:!0,get:function(){return s.NoMediaHostsError}}),Object.defineProperty(t,"ServerStatusCodeError",{enumerable:!0,get:function(){return n.ServerStatusCodeError}}),Object.defineProperty(t,"WebdDrop",{enumerable:!0,get:function(){return n.WebdDrop}});var n=r(77591),i=r(27856),a=r(64103),s=r(40859);class o extends n.ServerStatusCodeError{constructor(){super(404),this.name="MediaNotOnPhone"}}t.MediaNotOnPhone=o},56747:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{partialVideoOpts:t,progressiveJpegOpts:r,scanCount:a}=e;if(r&&null!=a)return{start:0,end:(0,n.alignChunkLengthsToMultipleOfAesBlockSize)(r.scanLengths).slice(0,a).reduce(((e,t)=>e+t),0)};if(t){const{video:{size:e,duration:r},secondsToDownload:n}=t,a=Math.max(e*n/r,131072);return{start:0,end:Math.ceil(a/i.BLOCK_SIZE)*i.BLOCK_SIZE-1}}return null};var n=r(71610),i=r(80733)},40859:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return i.AbortError}}),t.NoMediaHostsError=void 0;var n=r(40265),i=r(89385);class a extends((0,n.customError)("NoMediaHostsError")){}t.NoMediaHostsError=a},46640:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={mediaHosts:!0};Object.defineProperty(t,"mediaHosts",{enumerable:!0,get:function(){return i.mediaHosts}});var i=r(82828);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},51320:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.THRESHOLD=void 0,t.maybeSwitchHost=function(e,t,r,s){let{selectedHost:o,fallbackHost:l}=t,{selectedHost:c,fallbackHost:d}=r;if(s<i)return{changed:!1,host:e};switch(e.type){case n.HOST_TYPE.PRIMARY:if(!e.equals(c))return{changed:!0,host:c};break;case n.HOST_TYPE.FALLBACK:if(!o.equals(c))return{changed:!0,host:c};if(a(e,l,d)||a(e,o.fallback,c.fallback))return{changed:!0,host:o}}return{changed:!1,host:e}};var n=r(17930);const i=52428800;function a(e,t,r){return e.equals(t)&&null!=r&&null!=t&&!t.equals(r)}t.THRESHOLD=i},17930:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHost=t.HOST_TYPE=void 0;var i=n(r(81109)),a=r(61596);const s=new Set(a.MEDIA_TYPE_VALUES),o=Object.freeze({PRIMARY:"primary",FALLBACK:"fallback"});t.HOST_TYPE=o;class l{constructor(e){this.hostname=e.hostname,this.ips=e.ips||[],this.type=e.type,this.class=e.class;const{downloadBuckets:t,supportedDownloadTypes:r,supportedUploadTypes:n}=function(e){var t,r;const n=e||[];let i,a,o;for(const e of n){if(e.download){var l;i=null!==(l=i)&&void 0!==l?l:new Set;for(const t of e.download)i.add(t)}if(e.upload){var c;a=null!==(c=a)&&void 0!==c?c:new Set;for(const t of e.upload)a.add(t)}e.downloadBuckets&&(o=e.downloadBuckets.map((e=>parseInt(e,10))))}return{supportedDownloadTypes:null!==(t=i)&&void 0!==t?t:s,supportedUploadTypes:null!==(r=a)&&void 0!==r?r:s,downloadBuckets:o}}(e.rules);this.downloadBuckets=t,this._supportedDownloadTypes=r,this._supportedUploadTypes=n,this.fallback=null!=e.fallback?new l((0,i.default)((0,i.default)((0,i.default)({},e),e.fallback),{},{type:"fallback",fallback:void 0})):null}equals(e){return this.hostname===(null==e?void 0:e.hostname)}isFallback(){return this.type===o.FALLBACK}supportsDownloadMediaType(e){return this._supportedDownloadTypes.has(e)}supportsUploadMediaType(e){const t="product-catalog-image"===e?"product":e;return this._supportedUploadTypes.has(t)}}t.MediaHost=l},82828:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mediaHosts=t.FETCH_STATE=void 0;var i=n(r(6479)),a=n(r(48926)),s=r(89385),o=n(r(70714)),l=r(40859),c=r(17930),d=n(r(58596)),u=r(97237),p=r(80469),h=r(70426),f=r(77591);const _=["forceRefresh"],m=["name","message","stack"];t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};const g=new class{constructor(){var e=this;this._locked=!1,this._fetch=(0,d.default)((()=>"all"),function(){var t=(0,a.default)((function*(t){let{signal:r}=t;try{const t=yield(0,p.sendQueryMediaConn)(r);e._err=null,e._data={auth:t.auth,authExpirationTime:new Date(t.queryStartTime.getTime()+t.authTTL),authTTL:t.authTTL,hosts:t.hosts.map((e=>new c.MediaHost(e))),hostsRefreshTime:new Date(t.queryStartTime.getTime()+t.ttl),queryStartTime:t.queryStartTime,maxBuckets:t.maxBuckets}}catch(t){const o=t;var n;if(o instanceof f.E507)return e._data=e._previousData,e._previousData=null,e._locked=!0,void setTimeout((0,a.default)((function*(){yield e._refreshIfStale({signal:r}),e._locked=!1})),null!==(n=o.backoff)&&void 0!==n?n:void 0);if(e._data=null,e._err=o,o.name===s.ABORT_ERROR)return void __LOG__(2)`mediaHosts.sendQueryMediaConn aborted`;__LOG__(3,!0)`mediaHosts.sendQueryMediaConn error: ${function(e){const{name:t,message:r,stack:n}=e,a=(0,i.default)(e,m),s=(0,u.normalizeStack)(e),o=s.slice(s.indexOf("\n")+1),l=0===Object.keys(a).length?"":" "+JSON.stringify(a,((e,t)=>e&&"object"==typeof t?String(t):t));return`${e.name||"Error"}: ${e.message}${l}\n${o}`}(o)}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error fetching mms hosts")}}));return function(){return t.apply(this,arguments)}}()),this._reset()}getHostsInfo(e){var t=this;let{directPath:r,encFilehash:n,operation:i,type:s,signal:c,forceRefresh:d=!1}=e;return(0,a.default)((function*(){if(!t._locked){const e={signal:c||(new o.default).signal,forceRefresh:d};yield t._refreshIfStale(e)}if(!t._data)throw new l.NoMediaHostsError("no fetched data");const{auth:e,hosts:a,maxBuckets:u}=t._data,{selectedHost:p,fallbackHost:f}=(0,h.routeSelection)({directPath:r,encFilehash:n,hosts:a,operation:i,type:s,maxBuckets:u});if(!p)throw new l.NoMediaHostsError("no selected host");return{auth:e,selectedHost:p,fallbackHost:f}}))()}_isExpiredOrMissing(){if(!this._data)return!0;const e=this._data;return new Date>=e.authExpirationTime}_needsRefresh(){if(!this._data)return!0;const e=this._data;if(new Date>=e.hostsRefreshTime)return!0;const{authTTL:t,queryStartTime:r}=e,n=Math.floor(.8*t),i=new Date(r.getTime()+n);return new Date>=i}_refreshIfStale(e){var t=this;let{forceRefresh:r}=e,n=(0,i.default)(e,_);return(0,a.default)((function*(){return t._isExpiredOrMissing()||r?(t._reset(),yield t._fetch(n),!0):!!t._needsRefresh()&&(t._fetch(n),!1)}))()}_reset(){this._previousData=this._data,this._data=null,this._err=null}};t.mediaHosts=g},70426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OPERATIONS=void 0,t.routeSelection=function(e){var t,r;let n,{encFilehash:c,directPath:d,hosts:u,operation:p,type:h,maxBuckets:f}=e;if(!u.length)return{selectedHost:null,fallbackHost:null};if(p===l.DOWNLOAD){const e=d?d.match(/&_nc_hot=([0-9]+)/):null,t=parseInt(null==e?void 0:e[1],10),r=Number.isNaN(t)?null:(0,i.unixTime)()-t,{mmsHotContentTimespan:l,mmsVCacheAggregationEnabled:p}=o.ServerProps;let _;null!=l&&l>0&&(h===s.MEDIA_TYPES.STICKER||null!=r&&r<=l)?_=1:p&&null!=f&&(_=(0,a.default)(c,f)+100);const m=function(e){const t=new Map;return e.forEach((e=>{var r;null===(r=e.downloadBuckets)||void 0===r||r.forEach((r=>{t.set(r,e)}))})),t}(u),g=null==_?null:m.get(_),y=m.get(0);(null==g?void 0:g.supportsDownloadMediaType(h))?n=g:(null==y?void 0:y.supportsDownloadMediaType(h))&&(n=y)}const _=u.find((e=>e.isFallback()));return n=null!==(t=n)&&void 0!==t?t:u.find((e=>p===l.UPLOAD?e.supportsUploadMediaType(h):e.supportsDownloadMediaType(h))),{selectedHost:null!==(r=n)&&void 0!==r?r:null,fallbackHost:null!=_?_:null}};var i=r(92844),a=n(r(16870)),s=r(61596),o=r(64551);const l={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.OPERATIONS=l},27856:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return n.AbortError}}),Object.defineProperty(t,"HttpInvalidResponseError",{enumerable:!0,get:function(){return n.HttpInvalidResponseError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return n.HttpNetworkError}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return n.HttpStatusCodeError}}),t.MediaTooLargeError=t.MediaNotFoundError=t.MediaInvalidError=t.MMSUnauthorizedError=t.MMSThrottleError=t.MMSForbiddenError=void 0,Object.defineProperty(t,"MmsDownloadFilehashMismatchError",{enumerable:!0,get:function(){return n.MmsDownloadFilehashMismatchError}}),Object.defineProperty(t,"NoMediaHostsError",{enumerable:!0,get:function(){return i.NoMediaHostsError}});var n=r(35118),i=r(40859);class a extends n.HttpStatusCodeError{constructor(e){super(404,e),this.name="MediaNotFoundError"}}t.MediaNotFoundError=a;class s extends n.HttpStatusCodeError{constructor(e){super(413,e),this.name="MediaTooLargeError"}}t.MediaTooLargeError=s;class o extends n.HttpStatusCodeError{constructor(e){super(415,e),this.name="MediaInvalidError"}}t.MediaInvalidError=o;class l extends n.HttpStatusCodeError{constructor(e){super(401,e),this.name="MMSUnauthorizedError"}}t.MMSUnauthorizedError=l;class c extends n.HttpStatusCodeError{constructor(e){super(403,e),this.name="MMSForbiddenError"}}t.MMSForbiddenError=c;class d extends n.HttpStatusCodeError{constructor(e){super(507,e),this.name="MMSThrottleError"}}t.MMSThrottleError=d},21081:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{directPath:t,encFilehash:r,hostname:n,type:l,mode:c,byteRange:d}=e;return t?function(e){let{directPath:t,encFilehash:r,hostname:n,query:i}=e;const a=new URL(t,`https://${n}`);if(a.hostname!==n)throw __LOG__(4,void 0,new Error,!0)`url.hostname: ${a.hostname}, hostname: ${n}, directPath: ${t}`,SEND_LOGS("malicious directPath"),new Error("malicious directPath");const l=a.searchParams||new o.default(a.search);return l.set("hash",(0,s.default)(r)),Object.keys(i).forEach((e=>{const t=i[e];null!=t&&l.set(e,t)})),`https://${a.host}${a.pathname}?${l.toString()}`}({encFilehash:r,hostname:n,directPath:t,query:{mode:c,bytestart:null==d?void 0:d.start.toString(),byteend:null==d?void 0:d.end.toString(),[a.MMS_URL_MEDIA_TYPE_SEARCH_PARAM]:l,[a.IS_MMS_URL_SEARCH_PARAM]:""}}):(0,i.default)({hostname:n,type:l,encFilehash:r,query:{mode:c,[a.IS_MMS_URL_SEARCH_PARAM]:""}})};var i=n(r(43311)),a=r(95770),s=n(r(19027)),o=n(r(23082))},43311:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{hostname:t,type:r,encFilehash:n,query:l}=e;const c=(0,i.default)(o[r],"MEDIA_TYPE_TO_PATH[type]"),d=new URL(`https://${t}${c}/${(0,a.default)(n)}`),u={};l&&Object.keys(l).forEach((e=>{null!=l[e]&&(u[e]=l[e])}));let p=new s.default(u).toString();p&&(p=`?${p}`);return`https://${d.host}${d.pathname}${p}`};var i=n(r(45095)),a=n(r(19027)),s=n(r(23082));const o={audio:"/mms/audio",document:"/mms/document",gif:"/mms/gif",image:"/mms/image",ppic:"/pps/photo",product:"/mms/image",ptt:"/mms/ptt",sticker:"/mms/sticker","thumbnail-document":"/mms/thumbnail-document","thumbnail-link":"/mms/thumbnail-link",video:"/mms/video","md-app-state":"/mms/md-app-state","product-catalog-image":"/product/image"}},42594:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r;let{auth:n,encFilehash:s,hostname:o,query:l,type:c,byteRange:d}=e;return(0,i.default)({encFilehash:s,hostname:o,type:c,query:{auth:n,token:(0,a.default)(s),resume:null==l||null===(t=l.resume)||void 0===t?void 0:t.toString(10),stream:null==l||null===(r=l.stream)||void 0===r?void 0:r.toString(10),bytestart:null==d?void 0:d.start.toString(10),byteend:null==d?void 0:d.end.toString(10)}})};var i=n(r(43311)),a=n(r(19027))},39436:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0});var i={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}});var a=n(r(27276));Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},5489:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e instanceof n.MMSThrottleError)return!1;return e instanceof n.NoMediaHostsError||e instanceof n.HttpNetworkError||e instanceof n.MMSUnauthorizedError||e instanceof n.HttpStatusCodeError&&e.status>=500};var n=r(27856)},79306:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(27856),s=n(r(19242)),o=r(36823);function l(){return(l=(0,i.default)((function*(e){const t={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsCheckIfUploadExists: start`;try{const t=yield(0,s.default)(e);if("complete"!==t.resume)throw new a.MediaNotFoundError("mmsCheckIfUploadExists");const{directPath:r,url:n,handle:i}=t;if(!r)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing directPath");if(!n)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing url");return __LOG__(2)`mmsCheckIfUploadExists: success`,{directPath:r,url:n,handle:i}}catch(e){throw(0,o.mmsLogError)("mmsCheckIfUploadExists",e,t),e}}))).apply(this,arguments)}},27276:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=n(r(70714)),l=r(91903),c=n(r(5489)),d=r(51320),u=r(46640),p=r(61596),h=n(r(79306)),f=n(r(87439)),_=r(84062),m=n(r(19242)),g=r(36823),y=n(r(72702)),E=n(r(57220)),S=n(r(22283)),v=r(74641),T=n(r(86243)),A=n(r(18586)),C=n(r(66717)),b=r(64551);const P={minTimeout:1e3,retries:3};function M(){return(M=(0,a.default)((function*(e){const{encFilehash:t,signal:r,type:n}=e;let s=!1;const o={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsClient.checkIfUploadExists: start`;try{let e=null;const o=yield(0,l.exponentialBackoff)((0,i.default)((0,i.default)({},P),{},{signal:r}),function(){var i=(0,a.default)((function*(i,a){__LOG__(2)`mmsClient.checkIfUploadExists: attempt #${a+1}`,yield E.default.waitIfOffline({signal:r});try{const{auth:i,selectedHost:o,fallbackHost:l}=yield u.mediaHosts.getHostsInfo({operation:S.default.UPLOAD,encFilehash:t,type:n,signal:r}),c=(0,C.default)({selectedHost:o,fallbackHost:l,lastHostUsed:e,attemptCount:a,lastFetchMadeProgress:s});return e=c,yield(0,h.default)({auth:i,encFilehash:t,hostname:c.hostname,type:n,signal:r,onProgress:()=>{s=!0}})}catch(e){if((0,c.default)(e))return i(e);throw e}}));return function(){return i.apply(this,arguments)}}());return __LOG__(2)`mmsClient.checkIfUploadExists: success`,o}catch(e){throw(0,g.mmsLogError)("mmsClient.checkIfUploadExists",e,o),e}}))).apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e){const{encFilehash:t,type:r,onUploadAttemptSuccess:n}=e;__LOG__(2)`mmsClient.upload: start`;try{const{response:t,retryStartTime:r}=yield F(e);return n(Date.now()-r),__LOG__(2)`mmsClient.upload: success`,(0,s.default)(t,"response")}catch(e){throw(0,g.mmsLogError)("mmsClient.upload",e,{encFilehash:t,type:r},!1),e}}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e){const{directPath:t,encFilehash:r,type:n,debugString:i,staticUrl:a,onDownloadAttemptSuccess:s}=e;__LOG__(2)`mmsClient.download: [${i}] start`;try{const{response:t,retryStartTime:r}=yield N(e);return s(Date.now()-r),__LOG__(2)`mmsClient.download: [${i}] success`,t}catch(e){throw(0,g.mmsLogError)("mmsClient.download",e,{directPath:t,encFilehash:r,type:n,staticUrl:a}),e}}))).apply(this,arguments)}function w(e,t){const{directPath:r,encFilehash:n,type:s,signal:o}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,l.exponentialBackoff)((0,i.default)((0,i.default)({},P),{},{signal:o}),function(){var t=(0,a.default)((function*(t,i){__LOG__(2)`runMmsTaskWithBackoff: attempt #${i+1}`;try{const t=yield function(){return R.apply(this,arguments)}({operation:S.default.DOWNLOAD,directPath:r,encFilehash:n,type:s,signal:o,failCount:i});return yield e(t)}catch(e){if((0,c.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}function R(){return(R=(0,a.default)((function*(e){const{failCount:t,operation:r,directPath:n,encFilehash:i,type:a,signal:s}=e,{selectedHost:o,fallbackHost:l}=yield u.mediaHosts.getHostsInfo({operation:r,directPath:n,encFilehash:i,type:a,signal:s});return(t>=2&&l?l:o).hostname}))).apply(this,arguments)}function D(e,t){return b.ServerProps.downloadHostSwitchingEnabled&&e===p.MEDIA_TYPES.DOCUMENT&&(null!=t?t:0)>d.THRESHOLD}function N(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e){let{debugString:t,signal:r,directPath:n,encFilehash:d,staticUrl:p,type:h,onDownloadHostFound:f,mode:m,byteRange:g,onDownloadAttemptError:y,onResponseText:E,onProgress:b}=e,M=Date.now(),O=!1,I=null;const w=yield(0,l.exponentialBackoff)((0,i.default)((0,i.default)({},P),{},{signal:r}),function(){var e=(0,a.default)((function*(e,i){M=Date.now(),__LOG__(2)`mmsClient.download: [${t}] attempt #${i+1}`;const s=e=>u.mediaHosts.getHostsInfo({operation:S.default.DOWNLOAD,directPath:n,encFilehash:d,type:h,signal:r,forceRefresh:e});try{const{selectedHost:e,fallbackHost:l}=yield s();let c=(0,C.default)({selectedHost:e,fallbackHost:l,attemptCount:i,lastHostUsed:I,lastFetchMadeProgress:O});I=c,f({hostName:c.hostname,hostClass:c.class,failCount:i});let u=0,y=null;const S={selectedHost:e,fallbackHost:l},P=e=>{if(null!=e&&null==y){const t=e.get("Content-Length"),r=parseInt(t,10);y=Number.isNaN(r)?null:r}};return yield(0,A.default)(function(){var e=(0,a.default)((function*(e){let{retry:i,failCount:a}=e;const l=e=>{null==b||b(e),O=!0,e.lengthComputable&&(u=e.loaded)};u=0;const f=new o.default,{signal:A}=f,C=yield(0,T.default)([r,A],(e=>{const r=(0,_.mms4Download)({directPath:n,encFilehash:d,staticUrl:p,hostname:c.hostname,type:h,signal:e,mode:m,byteRange:g,debugString:t,onHeadersReceived:P,onProgress:l,onResponseText:E}).then((e=>({kind:"download-completed",arrayBuffer:e}))),i=D(h,y)?(0,v.pollMediaHosts)({connectionBlock:S,getHost:()=>c,getMediaHosts:()=>s(!0),getRemainingBytes:()=>null!=y?y-u:null,signal:e}).then((e=>({kind:"host-changed",host:e}))):null;return Promise.race([r,i].filter(Boolean)).finally((()=>f.abort()))}));return"host-changed"===C.kind?(c=C.host,I=c,i()):C.arrayBuffer}));return function(){return e.apply(this,arguments)}}())}catch(t){O=!1;const r=(0,c.default)(t);if(!r||i===P.retries||y({err:t,overallT:Date.now()-M,failCount:i}),r)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}());return{response:(0,s.default)(w,"response"),retryStartTime:M}}))).apply(this,arguments)}function k(e,t){return b.ServerProps.uploadHostSwitchingEnabled&&e===p.MEDIA_TYPES.DOCUMENT&&t>d.THRESHOLD}function G(){return U.apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e){let{auth:t,encFilehash:r,hostname:n,type:i,signal:a,byteLength:s}=e;if(!k(i,s))return 0;const{resume:o}=yield(0,m.default)({auth:t,encFilehash:r,hostname:n,type:i,signal:a});if("complete"===o)return 0;const l=parseInt(o,10);return Number.isNaN(l)?(__LOG__(4,void 0,new Error,!0)`mmsClient.upload: offset is NaN, resume=${o}`,SEND_LOGS("upload-offset-is-NaN"),0):l>=s?0:l}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(e){const{ciphertextHmac:t,encFilehash:r,type:n,signal:s,onUploadHostFound:d,onUploadAttemptError:p,onProgress:h}=e;let f=!1,_=Date.now(),m=null;return{response:yield(0,l.exponentialBackoff)((0,i.default)((0,i.default)({},P),{},{signal:s}),function(){var e=(0,a.default)((function*(e,i){const l=e=>u.mediaHosts.getHostsInfo({operation:S.default.UPLOAD,encFilehash:r,type:n,signal:s,forceRefresh:e});_=Date.now(),__LOG__(2)`mmsClient.upload: attempt #${i+1}`;try{yield E.default.waitIfOffline({signal:s});const{auth:e,selectedHost:c,fallbackHost:u}=yield l(),p={selectedHost:c,fallbackHost:u};let _=(0,C.default)({selectedHost:c,fallbackHost:u,attemptCount:i,lastHostUsed:m,lastFetchMadeProgress:f});return m=_,d({hostName:_.hostname,hostClass:_.class,failCount:i}),yield(0,A.default)(function(){var i=(0,a.default)((function*(i){let{retry:a}=i;const c=yield G({auth:e,encFilehash:r,byteLength:t.byteLength,hostname:_.hostname,type:n,signal:s}),d=new o.default,{signal:u}=d,g=yield(0,T.default)([s,u],(i=>{const a=k(n,t.byteLength)?(0,v.pollMediaHosts)({connectionBlock:p,getHost:()=>_,getMediaHosts:()=>l(!0),getRemainingBytes:()=>t.byteLength,signal:i}).then((e=>({kind:"host-changed",host:e}))):null,o=(0,y.default)({auth:e,ciphertextHmac:c>0?new Uint8Array(t).subarray(c):t,hostname:_.hostname,encFilehash:r,type:n,signal:s,onProgress:e=>{f=!0,null==h||h(e,c)},byteRange:c>0?{start:c,end:t.byteLength}:void 0}).then((e=>({kind:"upload-completed",value:e})));return Promise.race([o,a].filter(Boolean)).finally((()=>d.abort()))}));return"host-changed"===g.kind?(_=g.host,m=_,a()):g.value}));return function(){return i.apply(this,arguments)}}())}catch(t){f=!1;const r=(0,c.default)(t);if(!r||i===P.retries||p(t,Date.now()-_),r)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}()),retryStartTime:_}}))).apply(this,arguments)}function B(){return(B=(0,a.default)((function*(e){const{failCount:t,operation:r,directPath:n,encFilehash:i,type:a,signal:s}=e,{selectedHost:o,fallbackHost:l,auth:c}=yield u.mediaHosts.getHostsInfo({operation:r,directPath:n,encFilehash:i,type:a,signal:s});return{hostname:(t>=2&&l?l:o).hostname,auth:c}}))).apply(this,arguments)}var K={download:function(){return I.apply(this,arguments)},upload:function(){return O.apply(this,arguments)},checkExistence:function(e){return w((t=>(0,_.mmsCheckExistence)((0,i.default)((0,i.default)({},e),{},{hostname:t}))),e)},getEncryptedMediaSize:function(e){return w((t=>(0,_.mmsGetEncryptedMediaSize)((0,i.default)((0,i.default)({},e),{},{hostname:t}))),e)},checkIfUploadExists:function(){return M.apply(this,arguments)},deleteMdHistorySyncBlob:function(e){const{directPath:t,encFilehash:r}=e;return function(e,t){const{directPath:r,encFilehash:n,type:s,signal:o,operation:d}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,l.exponentialBackoff)((0,i.default)((0,i.default)({},P),{},{signal:o}),function(){var t=(0,a.default)((function*(t,i){__LOG__(2)`runMmsTaskWithBackoff: attempt #${i+1}`;try{const{hostname:t,auth:a}=yield function(){return B.apply(this,arguments)}({operation:d,directPath:r,encFilehash:n,type:s,signal:o,failCount:i});return yield e(t,a)}catch(e){if((0,c.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}(((e,n)=>(0,f.default)({directPath:t,hostname:e,encFilehash:r,auth:n})),(0,i.default)((0,i.default)({},e),{},{type:p.MEDIA_TYPES.IMAGE,operation:S.default.UPLOAD}))}};t.default=K},87439:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(15688),s=r(35118),o=n(r(18561)),l=n(r(43311)),c=r(61596),d=n(r(19027));function u(){return(u=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,auth:i}=e,u=t.split("?")[0],p=(new TextEncoder).encode(u),h=(0,a.encodeB64UrlSafe)(p),f=(0,l.default)({encFilehash:r,hostname:n,type:c.MEDIA_TYPES.IMAGE,query:{token:(0,d.default)(r),d_md:h,auth:i}}),_=yield(0,o.default)(f,{method:"DELETE"});if(!_.ok)throw new s.HttpStatusCodeError(_.status,"MMS Delete error")}))).apply(this,arguments)}},84062:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mms4Download=function(e){let{directPath:t,encFilehash:r,staticUrl:n,hostname:s,type:o,signal:l,onProgress:d,onResponseText:p,onHeadersReceived:h,mode:f,byteRange:_,debugString:m}=e;const g=n||(0,c.default)({directPath:t,encFilehash:r,hostname:s,type:o,mode:f,byteRange:_});return function(){return u.apply(this,arguments)}({url:g,signal:l,onHeadersReceived:h,onProgress:d,onResponseText:p,ciphertextValidator:_?null:function(){var e=(0,i.default)((function*(e){return(yield(0,a.default)(e))===r}));return function(){return e.apply(this,arguments)}}(),debugString:m,debug:{encFilehash:r,type:o,url:g}})},t.mmsCheckExistence=function(){return p.apply(this,arguments)},t.mmsGetEncryptedMediaSize=function(){return h.apply(this,arguments)},t.validateMmsResponse=f;var i=n(r(48926)),a=n(r(18309)),s=r(27856),o=r(64103),l=r(43816),c=n(r(21081)),d=r(36823);function u(){return(u=(0,i.default)((function*(e){let{url:t,signal:r,onHeadersReceived:n,onProgress:i,onResponseText:a,debug:o,debugString:c,ciphertextValidator:u}=e;__LOG__(2)`mmsDownload: [${c}] start`;try{const e=yield(0,l.extendedFetch)(t,{signal:r,onProgress:i,onResponseText:a,onHeadersReceived:n});yield f({response:e,functionName:"mmsDownload",url:t});const o=yield e.arrayBuffer();if(u&&!(yield u(o)))throw new s.MmsDownloadFilehashMismatchError({url:t});return __LOG__(2)`mmsDownload: [${c}] success`,o}catch(e){throw(0,d.mmsLogError)("mmsDownload",e,o),e}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,type:i,signal:a}=e;yield m({directPath:t,encFilehash:r,hostname:n,type:i,signal:a,functionName:"mmsCheckExistence"})}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,type:i,signal:a}=e,s=(yield m({directPath:t,encFilehash:r,hostname:n,type:i,signal:a,functionName:"mmsGetEncryptedMediaSize"})).headers.get("content-length");if(!s)throw new o.UnableToGetContentLengthError;return parseInt(s,10)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const{response:t,url:r,functionName:n}=e;if(!t.ok)switch(t.status){case 401:throw new s.MMSUnauthorizedError(n,{url:r});case 403:if((yield t.text()).includes("URL signature expired"))throw new s.MediaNotFoundError(n,{url:r,status:t.status});throw new s.MMSForbiddenError(n,{url:r});case 404:case 410:throw new s.MediaNotFoundError(n,{url:r,status:t.status});case 507:throw new s.MMSThrottleError(n,{url:r});default:throw new s.HttpStatusCodeError(t.status,n,{url:r})}}))).apply(this,arguments)}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const{directPath:t,encFilehash:r,hostname:n,type:i,signal:a,functionName:s}=e,o=(0,c.default)({directPath:t,encFilehash:r,hostname:n,type:i,mode:"auto"}),d=yield(0,l.extendedFetch)(o,{method:"HEAD",signal:a});return yield f({response:d,functionName:s,url:o}),d}))).apply(this,arguments)}},19242:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(27856),s=r(43816),o=n(r(42594)),l=r(36823);function c(){return(c=(0,i.default)((function*(e){const{auth:t,encFilehash:r,hostname:n,signal:i,type:c,onProgress:d}=e,u=(0,o.default)({auth:t,encFilehash:r,hostname:n,query:{resume:1},type:c});__LOG__(2)`mmsGetUploadProgress: start`;try{const e=yield(0,s.extendedFetch)(u,{method:"post",signal:i,onProgress:d});if(!e.ok)switch(e.status){case 401:throw new a.MMSUnauthorizedError("mmsGetUploadProgress",{url:u});case 404:throw new a.MediaNotFoundError("mmsGetUploadProgress",{url:u});default:throw new a.HttpStatusCodeError(e.status,"mmsGetUploadProgress",{url:u})}const t=yield e.json();if(!t.resume)throw new a.HttpInvalidResponseError("mmsGetUploadProgress: missing resume",{url:u});return __LOG__(2)`mmsGetUploadProgress: success`,{directPath:t.direct_path,resume:t.resume,url:t.url,handle:t.handle}}catch(e){throw(0,l.mmsLogError)("mmsUpload",e,{encFilehash:r,type:c,url:u}),e}}))).apply(this,arguments)}},36823:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mmsLogError=function(e,t){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t instanceof i.MediaNotFoundError&&r?__LOG__(2)`${e}: expected error`:"object"==typeof t&&(null==t?void 0:t.name)===n.ABORT_ERROR?__LOG__(2)`${e}: canceled`:__LOG__(3)`${e}: error`};var n=r(89385),i=r(27856)},72702:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(27856),s=r(43816),o=n(r(42594)),l=r(36823);function c(){return(c=(0,i.default)((function*(e){const{auth:t,ciphertextHmac:r,encFilehash:n,hostname:i,type:c,signal:d,onProgress:u,byteRange:p}=e,h=(0,o.default)({auth:t,encFilehash:n,hostname:i,type:c,byteRange:p});__LOG__(2)`mmsUpload: start`;try{const e=yield(0,s.extendedFetch)(h,{method:"post",body:r,signal:d,onProgress:u}).then((e=>{if(!e.ok)switch(e.status){case 401:throw new a.MMSUnauthorizedError("mmsUpload",{url:h});case 413:throw new a.MediaTooLargeError("mmsUpload",{url:h});case 415:throw new a.MediaInvalidError("mmsUpload: hash mismatch",{url:h});case 507:throw new a.MMSThrottleError("mmsUpload",{url:h});default:throw new a.HttpStatusCodeError(e.status,"mmsUpload",{url:h})}return e.json()})).then((e=>{if(!e.direct_path)throw new a.HttpInvalidResponseError("mmsUpload: missing direct_path");if(!e.url)throw new a.HttpInvalidResponseError("mmsUpload: missing url");return{directPath:e.direct_path,url:e.url,handle:e.handle}}));return __LOG__(2)`mmsUpload: success`,e}catch(e){throw(0,l.mmsLogError)("mmsUpload",e,{encFilehash:n,type:c,url:h},!1),e}}))).apply(this,arguments)}},74641:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_POLLING_INTERVAL=void 0,t.pollMediaHosts=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(13959),s=r(51320),o=n(r(18586));const l=3e5;function c(){return(c=(0,i.default)((function*(e){let t=e.connectionBlock;return yield(0,a.delayMs)(l,e.signal),(0,o.default)((r=>{let{retry:n}=r;return new Promise((r=>e.getMediaHosts().then((i=>{let{selectedHost:a,fallbackHost:o}=i;const c={selectedHost:a,fallbackHost:o},d=e.getRemainingBytes();if(null==d)return n(l);const{changed:u,host:p}=(0,s.maybeSwitchHost)(e.getHost(),t,c,d);return t=c,u?r(p):n(l)}))))}),e.signal)}))).apply(this,arguments)}t.SERVER_POLLING_INTERVAL=l},66717:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{selectedHost:t,fallbackHost:r,attemptCount:n,lastHostUsed:i,lastFetchMadeProgress:a}=e;if(a&&i)return i;if(n<=1)return t;if(3===n&&r)return r;if((null==i?void 0:i.equals(t))&&null!=t.fallback)return t.fallback;return null!=r?r:t}},51127:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n){const o=(0,a.generateMediaEventId)(),l=new s.default.MediaUpload2({mediaId:o,connectionType:s.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,a.getMetricMediaType)(e),overallMmsVersion:4,overallAttemptCount:r,networkStack:s.default.NETWORK_STACK_TYPE.NATIVE,overallUploadMode:(0,a.getMetricOverallUploadModeType)(e),overallIsForward:n,overallUploadOrigin:t});return{handleArrayBufferCreated:function(e){l.set({overallMediaSize:e})},handleCheckExistingError:function(e){e instanceof i.HttpStatusCodeError&&l.set({resumeHttpCode:e.status})},handleCheckExistingSuccess:function(){l.set({overallUploadResult:s.default.MEDIA_UPLOAD_RESULT_TYPE.DUPLICATE,overallIsFinal:!0,resumeHttpCode:200}),l.markOverallCumT(),l.commit()},handleUploadHostFound:function(e){let{hostName:t,hostClass:r,failCount:n}=e;l.set({overallDomain:t,overallConnectionClass:r,overallRetryCount:n})},handleUploadSuccess:function(){l.set({resumeHttpCode:404,overallUploadResult:s.default.MEDIA_UPLOAD_RESULT_TYPE.OK,overallIsFinal:!0,uploadHttpCode:200,finalizeHttpCode:200}),l.markOverallCumT(),l.commit()},handleUploadError:function(e){l.set({overallUploadResult:(0,a.getMetricUploadErrorResultType)(e),overallIsFinal:!0});const t=(0,a.getStatusCode)(e);null!=t&&(l.uploadHttpCode=t,l.finalizeHttpCode=t),l.markOverallCumT(),l.commit(),(0,a.logErrorUnknownDetails)(l,e)},handleUploadAttemptSuccess:function(e){l.set({overallT:e})},handleUploadAttemptError:function(e,t,r){const n=new s.default.MediaUpload2(l);n.set({mediaId:(0,a.generateMediaEventId)(),overallUploadResult:(0,a.getMetricUploadErrorResultType)(e),overallIsFinal:!1,overallT:t,overallRetryCount:r});const i=(0,a.getStatusCode)(e);null!=i&&(l.uploadHttpCode=i),l.markOverallCumT(),n.commit(),(0,a.logErrorUnknownDetails)(l,e)},mediaId:o,handleEncryptionStart:function(){l.startOverallEncryptT()},handleEncryptionSuccess:function(){l.markOverallEncryptT()}}};var i=r(27856),a=r(29992),s=n(r(11339))},60363:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return n.AbortError}}),Object.defineProperty(t,"FileNotReadableError",{enumerable:!0,get:function(){return i.FileNotReadableError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return n.HttpNetworkError}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return n.HttpStatusCodeError}}),Object.defineProperty(t,"MMSUnauthorizedError",{enumerable:!0,get:function(){return n.MMSUnauthorizedError}}),Object.defineProperty(t,"MediaEncryptionError",{enumerable:!0,get:function(){return i.MediaEncryptionError}}),Object.defineProperty(t,"MediaInvalidError",{enumerable:!0,get:function(){return n.MediaInvalidError}}),Object.defineProperty(t,"MediaNotFoundError",{enumerable:!0,get:function(){return n.MediaNotFoundError}}),Object.defineProperty(t,"MediaTooLargeError",{enumerable:!0,get:function(){return n.MediaTooLargeError}}),Object.defineProperty(t,"NoMediaHostsError",{enumerable:!0,get:function(){return a.NoMediaHostsError}});var n=r(27856),i=r(64103),a=r(40859)},11105:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=n(r(54824))},54824:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(89385),s=r(50796),o=r(92844),l=n(r(51127)),c=r(22200),d=n(r(83899)),u=r(27856),p=r(1063),h=n(r(58596)),f=(n(r(11339)),n(r(39436))),_=r(23125),m=n(r(15554)),g=r(64551),y=n(r(23082));function E(e){let{mediaKey:t,mediaKeyTimestamp:r}=e;if(null!=t&&null!=r)return{mediaKey:t,mediaKeyTimestamp:r};const{key:n,timestamp:i}=(0,m.default)();return{mediaKey:n,mediaKeyTimestamp:i}}var S=new class{constructor(){var e=this;this.checkIfAlreadyUploaded=(0,h.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){const{encFilehash:t,type:r}=e;__LOG__(2)`uploadManager.checkIfAlreadyUploaded: start`;try{const t=yield f.default.checkIfUploadExists(e).catch((0,s.filteredCatch)(u.MediaNotFoundError,(()=>null)));return __LOG__(2)`uploadManager.checkIfAlreadyUploaded: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.checkIfAlreadyUploaded: canceled`:__LOG__(3)`uploadManager.checkIfAlreadyUploaded: error`,e}}));return function(){return e.apply(this,arguments)}}()),this._memoizedUpload=(0,h.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){const{ciphertextHmac:t,encFilehash:r,type:n,signal:i,onUploadHostFound:a,onUploadAttemptSuccess:s,onUploadAttemptError:o,onUploadSuccess:l,onProgress:c}=e,d=yield f.default.upload({ciphertextHmac:t,encFilehash:r,type:n,signal:i,onUploadHostFound:a,onUploadAttemptSuccess:s,onUploadAttemptError:o,onProgress:c});return l(),d}));return function(){return e.apply(this,arguments)}}()),this._getExistingOrUpload=(0,h.default)((e=>e.encFilehash),function(){var t=(0,i.default)((function*(t){const{ciphertextHmac:r,encFilehash:n,signal:i,type:s,onCheckExistingSuccess:o,onCheckExistingError:l,onUploadHostFound:c,onUploadAttemptSuccess:d,onUploadAttemptError:u,onUploadSuccess:p,onProgress:h}=t;__LOG__(2)`uploadManager._getExistingOrUpload: start`;try{const t=yield e.checkIfAlreadyUploaded({encFilehash:n,type:s,signal:i}).catch((e=>{throw l(e),e})).then((t=>t?(o(),t):e._memoizedUpload({ciphertextHmac:r,encFilehash:n,type:s,signal:i,onUploadHostFound:c,onUploadAttemptSuccess:d,onUploadAttemptError:u,onUploadSuccess:p,onCheckExistingSuccess:o,onCheckExistingError:l,onProgress:h})));return __LOG__(2)`uploadManager._getExistingOrUpload: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager._getExistingOrUpload: canceled`:__LOG__(3)`uploadManager._getExistingOrUpload: error`,e}}));return function(){return t.apply(this,arguments)}}()),c.downloadUploadCrashLogger.init()}encryptAndUpload(e){var t=this;return(0,i.default)((function*(){const{blob:r,signal:n,type:s,userUploadAttemptCount:o,forwardedFromWeb:u,uploadOrigin:h,onProgress:f}=e;__LOG__(2)`uploadManager.encryptAndUpload: start`;const{handleCheckExistingSuccess:m,handleCheckExistingError:y,handleUploadHostFound:S,handleUploadAttemptSuccess:T,handleUploadAttemptError:A,handleUploadSuccess:C,handleArrayBufferCreated:b,handleUploadError:P,mediaId:M,handleEncryptionStart:O,handleEncryptionSuccess:I}=(0,l.default)(s,h,o,u);c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_ENCRYPTION_STARTED);try{let a;if((0,_.isPerformanceExperimentEnabled)()){const i=E(e);a=Promise.resolve(r).then((e=>{c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:r instanceof Blob?r.size:r.byteLength});const t=e instanceof Blob?(0,p.blobToArrayBuffer)(e):e;return c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),t})).then((e=>(b(e.byteLength),O(),(0,d.default)({type:s,plaintext:e,mediaKey:i.mediaKey})))).then((r=>{let{hash:a,ciphertextHmac:o,sidecar:l,firstFrameSidecar:d}=r;I(),c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_ENCRYPTION_FINISHED);return(e.mediaKey?t._getExistingOrUpload:t._memoizedUpload)({ciphertextHmac:o,encFilehash:a,type:s,signal:n,onCheckExistingSuccess:m,onCheckExistingError:y,onUploadHostFound:S,onUploadAttemptSuccess:T,onUploadAttemptError:A,onUploadSuccess:C,onProgress:f}).then((e=>({directPath:u&&g.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(e.directPath):e.directPath,encFilehash:a,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,sidecar:l,firstFrameSidecar:d,url:e.url,handle:e.handle})))}))}else{c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:r instanceof Blob?r.size:r.byteLength});const o=r instanceof Blob?(0,p.blobToArrayBuffer)(r):Promise.resolve(r);c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),a=o.then(function(){var r=(0,i.default)((function*(r){b(r.byteLength);const{mediaKey:i,mediaKeyTimestamp:a}=E(e);O();const{ciphertextHmac:o,hash:l,sidecar:p,firstFrameSidecar:h}=yield(0,d.default)({type:s,plaintext:r,mediaKey:i});I();const f=e.mediaKey?t._getExistingOrUpload:t._memoizedUpload;c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_FINISHED);const _=yield f({ciphertextHmac:o,encFilehash:l,type:s,signal:n,onCheckExistingSuccess:m,onCheckExistingError:y,onUploadHostFound:S,onUploadAttemptSuccess:T,onUploadAttemptError:A,onUploadSuccess:C});return c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_ENCRYPTION_FINISHED),{directPath:u&&g.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(_.directPath):_.directPath,encFilehash:l,mediaKey:i,mediaKeyTimestamp:a,sidecar:p,firstFrameSidecar:h,url:_.url,handle:_.handle}}));return function(){return r.apply(this,arguments)}}())}const o=yield a;return __LOG__(2)`uploadManager.encryptAndUpload: success`,c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_FINISHED),o}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.encryptAndUpload: canceled`:__LOG__(3)`uploadManager.encryptAndUpload: error`,c.downloadUploadCrashLogger.mark(M,c.ProgressType.UPLOAD_ERROR),P(e),e}}))()}unencryptedUpload(e){const{file:t,hash:r,type:n,signal:i,uploadOrigin:a}=e,{handleCheckExistingSuccess:s,handleCheckExistingError:o,handleUploadHostFound:c,handleUploadAttemptSuccess:d,handleUploadAttemptError:u,handleUploadSuccess:p}=(0,l.default)(n,a,0,!1);return this._getExistingOrUpload({ciphertextHmac:t,encFilehash:r,type:n,signal:i,onCheckExistingSuccess:s,onCheckExistingError:o,onUploadHostFound:c,onUploadAttemptSuccess:d,onUploadAttemptError:u,onUploadSuccess:p})}};function v(e){const[t,r]=e.split("?"),n=new y.default(r),i=(0,o.unixTime)();return n.set("_nc_hot",String(i)),`${t}?${n.toString()}`}t.default=S},22200:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadUploadCrashLogger=t.ProgressType=void 0;var i=n(r(92417)),a=r(64551);const s=r(54302).Mirrored(["DOWNLOAD_STARTED","DOWNLOAD_FINISHED","DOWNLOAD_DECRYPTION_STARTED","DOWNLOAD_DECRYPTION_FINISHED","DOWNLOAD_ERROR","UPLOAD_STARTED","UPLOAD_FINISHED","UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED","UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED","UPLOAD_ENCRYPTION_STARTED","UPLOAD_ENCRYPTION_FINISHED","UPLOAD_ERROR"]);t.ProgressType=s;const o="DownloadUploadCrashLoggerLikelyCrashed",l=new Set([s.DOWNLOAD_DECRYPTION_FINISHED,s.DOWNLOAD_ERROR,s.UPLOAD_ENCRYPTION_FINISHED,s.UPLOAD_ERROR]);const c=new class{constructor(){this.hasPerformedInit=!1,this._clearAllStorage=()=>{null===i.default||void 0===i.default||i.default.removeItem(o)}}_getStorage(){const e=null===i.default||void 0===i.default?void 0:i.default.getItem(o);return e?JSON.parse(e):{}}_commitStorage(){null===i.default||void 0===i.default||i.default.setItem(o,JSON.stringify(this.storage))}_shouldLog(){return!0===a.ServerProps.webLogUploadDownloadCrashes}init(){!this.hasPerformedInit&&this._shouldLog()&&(window.addEventListener("beforeunload",this._clearAllStorage),this.storage=this._getStorage(),Object.entries(this.storage).forEach((e=>{let[t,{progressType:r,metadata:n}]=e;var i,a;__LOG__(3,void 0,void 0,!0)`downloadUploadCrashLogger.likelyCrashedDuring${a=r,a.toLowerCase().replace(/(?:^|_)(\w)/g,((e,t)=>t.toLocaleUpperCase()))}WithID${t}${n?`AndData => ${i=n,Object.entries(i).map((e=>{let[t,r]=e;return`${t}: ${String(r)}`})).join(", ")}`:""}`,SEND_LOGS("download-upload-manager-likely-crashed")})),this._clearAllStorage(),this.hasPerformedInit=!0)}reset(){this._shouldLog()&&(window.removeEventListener("beforeunload",this._clearAllStorage),this._clearAllStorage(),this.hasPerformedInit=!1)}mark(e,t,r){this._shouldLog()&&(l.has(t)?delete this.storage[String(e)]:this.storage[String(e)]={progressType:t,metadata:r},this._commitStorage())}};t.downloadUploadCrashLogger=c},23125:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPerformanceExperimentEnabled=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_abprop_large_files_encryption_optimization");return!1};var n=r(86945),i=r(7293)},9329:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"MediaDecryptionError",{enumerable:!0,get:function(){return f.MediaDecryptionError}}),Object.defineProperty(t,"MediaNotOnPhone",{enumerable:!0,get:function(){return f.MediaNotOnPhone}}),t.NoEntryAfterRMR=t.MissingEncFilehash=void 0,t.cancelDownloadMedia=function(e){const{downloadPromise:t}=e;if(null==t)return;const r=D.get(t);if(null==r)return;D.delete(t),r()},t.checkExistence=function(){return F.apply(this,arguments)},t.downloadMedia=G,t.manuallySetMedia=function(){return N.apply(this,arguments)};var a=i(r(48926)),s=i(r(23493)),o=r(89385),l=r(40265),c=r(50796),d=i(r(45095)),u=i(r(70714)),p=r(691),h=r(26384),f=r(37115),_=n(r(64103)),m=r(1063),g=r(84866),y=n(r(97692)),E=r(61596),S=r(58668),v=r(56406),T=i(r(11339)),A=r(43257),C=i(r(34949)),b=i(r(86243)),P=r(64551),M=r(78521);class O extends((0,l.customError)("NoEntryAfterRMR")){}t.NoEntryAfterRMR=O;class I extends((0,l.customError)("MissingEncFilehash")){}t.MissingEncFilehash=I;const w=3,R=4,D=new WeakMap;function N(){return(N=(0,a.default)((function*(e){let{mimetype:t,mediaObject:r,mediaBlob:n,mediaType:i,rmrReason:a,downloadOrigin:s}=e;r.mediaBlob||(yield(0,v.gatherAndSetMetadata)(r,n),yield G({mimetype:t,mediaObject:r,downloadEvenIfExpensive:!1,mediaType:i,rmrReason:a,downloadOrigin:s}))}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e){const{mimetype:t}=e,r=P.ServerProps.webLargeFilesUi?(0,s.default)((t=>{e.mediaObject.consolidate({loadedSize:t.loaded})}),p.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,n=yield h.downloadManager.downloadAndDecrypt({directPath:e.directPath,encFilehash:e.encFilehash,filehash:e.objFilehash,isFinalRmrRetry:e.isFinalRmrRetry,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,signal:e.signal,staticUrl:e.staticUrl,type:e.mediaType,onDecryptStart:()=>{e.mediaObject.consolidate({downloadStage:S.DOWNLOAD_STAGE.PROCESSING})},onProgress:r,userDownloadAttemptCount:e.mediaObject.userDownloadAttemptCount,downloadOrigin:e.downloadOrigin,mode:e.mode,progressiveJpegOpts:x({scanLengths:e.scanLengths,scansSidecar:e.scansSidecar,mimetype:t,mediaObject:e.mediaObject})}),i=null!=t&&""!==t?t:(0,A.getMediaMimeType)(e.mediaType,new Uint8Array(n));return new Blob([n],{type:i})}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e){let{mimetype:t,mediaObject:r,downloadEvenIfExpensive:n,mediaType:i,signal:s,rmrReason:l,rmrData:p,downloadOrigin:T,shouldThrow:A,isVcardOverMmsDocument:P,mode:w,isAutoDownload:R,isFinalRmrRetry:N}=e;if(!r)return;const k=r.filehash;if(!k)return;if(r.downloadPromise)return r.downloadPromise;if(r.downloadStage===S.DOWNLOAD_STAGE.ERROR_MISSING)return;if(r.downloadStage===S.DOWNLOAD_STAGE.PREPARING)return;if(r.mediaBlob){return(yield r.mediaBlob.validate())?void r.consolidate({downloadStage:S.DOWNLOAD_STAGE.RESOLVED}):(r.clearBlob(),r.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),void r.notifyMsgsAsync())}const U=g.MediaBlobCache.get(k);let F,x;const B=new u.default;return(0,b.default)([B.signal,s].filter(Boolean),(e=>{const s=function(){var s=(0,a.default)((function*(){if(U)x=U;else{if(F=r.entries.getDownloadEntry(),!F){if(!n)return void r.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE});if(yield h.downloadManager.rmr({mediaObject:r,signal:e,rmrReason:l,rmrData:p}),F=r.entries.getDownloadEntry(),!F)throw new O}r.consolidate({downloadStage:S.DOWNLOAD_STAGE.FETCHING}),F=(0,d.default)(F,"entry");const{encFilehash:a,scansSidecar:s,scanLengths:o,directPath:c,mediaKey:u,mediaKeyTimestamp:f,staticUrl:_}=F;if(!a)throw F.markWhetherOnServer(!1),new I;const m=yield L({directPath:c,encFilehash:a,objFilehash:k,isFinalRmrRetry:N,mediaKey:u,mediaKeyTimestamp:f,signal:e,staticUrl:_,mediaType:i,mediaObject:r,downloadOrigin:T,mode:w,scanLengths:o,mimetype:t,scansSidecar:s});x=i===E.MEDIA_TYPES.PTT||i===E.MEDIA_TYPES.AUDIO?yield y.transcode(m):m}if("text/vcard"===x.type&&P)try{const e=yield(0,m.blobToText)(x);if(e){const t=(0,M.parseMultiVcard)(e);t.length>0?r.consolidate({parsedVcards:t}):(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("vcard_over_mms:Failed to parse vcard over mms contents"))}}catch(e){__LOG__(4,void 0,new Error,!0)`Failed to retrieve blob text contents ${String(e)}`,SEND_LOGS(`vcard_over_mms:blobToText failed with error: ${String(e)}`)}if((0,v.shouldUseMediaCache)(i))R||(g.MediaBlobCache.put(k,x),yield(0,v.gatherAndSetMetadataNoOpaque)(r,x));else{const e=yield C.default.createFromData(x,x.type);yield(0,v.gatherAndSetMetadata)(r,e)}return r.consolidate({downloadStage:S.DOWNLOAD_STAGE.RESOLVED}),r.downloadPromise=null,r.resolveWhenConsolidated()}));return function(){return s.apply(this,arguments)}}()().catch((0,c.filteredCatch)(f.MediaNotFoundError,function(){var e=(0,a.default)((function*(e){if(!F)throw e;if(F.markWhetherOnServer(!1),!n)throw e;return yield h.downloadManager.rmr({mediaObject:r,signal:(new u.default).signal,rmrReason:l,rmrData:p}),r.downloadPromise=null,G({mimetype:t,mediaObject:r,downloadEvenIfExpensive:!1,mediaType:i,rmrReason:l,rmrData:p,downloadOrigin:T,isFinalRmrRetry:!0,isVcardOverMmsDocument:P,mode:w,isAutoDownload:R})}));return function(){return e.apply(this,arguments)}}())).catch((0,c.filteredCatch)(_.MediaUnsupportedError,(e=>{if(r.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_UNSUPPORTED}),__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media unsupported error:"),A)throw e}))).catch((0,c.filteredCatch)(f.MediaNotOnPhone,(e=>{if(r.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_MISSING}),A)throw e}))).catch((0,c.filteredCatch)([O,I],(e=>{if(r.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_MISSING}),__LOG__(3)`Unexpected download error: ${e.name}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS(`unexpected download error: ${e.name}`),A)throw e}))).catch((0,c.filteredCatch)(f.MediaDecryptionError,(e=>{if(r.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_MISSING}),A)throw e}))).catch((e=>{if(r.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),e instanceof _.MediaLoadError){if(__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media load error:"),A)throw e}else if(e instanceof _.TranscodeBlobTooLargeError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: transcode blob too large"),A)throw e}else if(e instanceof _.UnableToPlayVideoError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: unable to play video"),A)throw e}else if(e.name!==o.ABORT_ERROR){if(__LOG__(2)`downloadMedia: error`,A)throw e}else if(A)throw e})).finally((()=>{r.downloadPromise=null}));return D.set(s,(()=>{B.abort()})),r.downloadPromise=s,s}))}))).apply(this,arguments)}function F(){return(F=(0,a.default)((function*(e){let{mimetype:t,mediaObject:r,mediaType:n}=e;const{filehash:i}=r;if(!i)return;if(r.downloadStage!==S.DOWNLOAD_STAGE.INIT)return;if(yield B(r))return;const a=g.MediaBlobCache.get(i),s=new u.default;if(a)return void(r.downloadStage===S.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:S.DOWNLOAD_STAGE.EXISTS}));const o=r.entries.getDownloadEntry();if(!o)return void(r.downloadStage===S.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}));const{encFilehash:l}=o;if(!l)return o.markWhetherOnServer(!1),void(r.downloadStage===S.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}));try{yield h.downloadManager.checkExistence({directPath:o.directPath,encFilehash:l,signal:s.signal,type:n}),r.downloadStage===S.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:S.DOWNLOAD_STAGE.EXISTS})}catch(e){r.downloadStage===S.DOWNLOAD_STAGE.INIT&&r.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),__LOG__(2)`checkExistence: error`}}))).apply(this,arguments)}function x(e){const{scanLengths:t,scansSidecar:r,mimetype:n,mediaObject:i}=e;if(!function(e,t){return!!(e&&t&&e.length>=2&&10*e.length===t.byteLength)}(t,r))return null;const a=new T.default.WebcProgressiveImage({webcFirstRenderScans:0});return{mimetype:n,scansSidecar:(0,d.default)(r,"scansSidecar"),scanLengths:(0,d.default)(t,"scanLengths"),onProgressiveUpdate:e=>{i.downloadStage!==S.DOWNLOAD_STAGE.RESOLVED&&(i.consolidate({downloadStage:S.DOWNLOAD_STAGE.PROGRESSIVE_READY,progressiveStage:e}),a.webcFirstRenderScans||(a.webcFirstRenderScans=e,a.markWebcFirstRenderT()),e>=w&&!a.webcMidQualityT&&a.markWebcMidQualityT(),e!==R||a.webcFullQualityT||(a.markWebcFullQualityT(),a.commit()))}}}function B(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e){if(!e.mediaBlob)return!1;return(yield e.mediaBlob.validate())?(e.consolidate({downloadStage:S.DOWNLOAD_STAGE.RESOLVED}),!0):(e.clearBlob(),e.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),e.notifyMsgsAsync(),!1)}))).apply(this,arguments)}},70996:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UploadMediaResultKind=void 0,t.cancelUploadMedia=function(e){const{uploadPromise:t}=e;if(null==t)return;const r=C.get(t);if(null==r)return;C.delete(t),r()},t.getBlobFromMediaObject=I,t.getOrDownloadBlob=M,t.uploadMedia=function(e){let{mimetype:t,mediaObject:r,mediaType:n,forwardedFromWeb:i,uploadOrigin:s,mediaKeyInfo:u}=e;if(r.uploadPromise)return r.uploadPromise;const p=new d.default,{signal:S}=p,v=Promise.resolve().then((()=>{r.consolidate({uploadStage:g.UPLOAD_STAGE.UPLOADING})})).then((()=>M({mediaObject:r,mimetype:t,mediaType:n,abortSignal:S,uploadOrigin:s}))).then(function(){var e=(0,a.default)((function*(e){const t=r.entries.getUploadEntry();t&&u&&(0,c.default)(t.mediaKey===u.key,"uploadEntry.mediaKey and mediaKeyInfo.mediaKey should be the same");const a=yield function(){return P.apply(this,arguments)}({blob:e,forwardedFromWeb:i,mediaKeyInfo:u,mediaObject:r,mediaType:n,signal:S,uploadEntry:t,uploadOrigin:s});if(!a)throw new Error("could not create media entry");if((n===y.MEDIA_TYPES.PTT||n===y.MEDIA_TYPES.AUDIO)&&!E.canPlayOgg())if(E.shouldUseMediaCache(n)){const e=r.filehash;if(e&&r.mediaBlob)return m.transcode(r.mediaBlob.formData()).then((t=>{_.MediaBlobCache.put(e,t)})).then((()=>a))}else if(r.mediaBlob)return E.gatherAndSetMetadata(r,r.mediaBlob).then((()=>a));return a}));return function(){return e.apply(this,arguments)}}()).then((e=>{if(S.aborted)throw new f.AbortError;return r.consolidate({uploadStage:g.UPLOAD_STAGE.UPLOADED}),__LOG__(2)`MediaAlgo.uploadMedia: success`,{kind:b.SUCCESS,mediaEntry:e}})).catch((e=>{throw e.name===o.ABORT_ERROR?__LOG__(2)`MediaAlgo.uploadMedia: canceled`:__LOG__(3)`MediaAlgo.uploadMedia: error`,e})).finally((()=>{delete r.uploadPromise})).catch((0,l.filteredCatch)(f.FileNotReadableError,(()=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE}),{kind:b.ERROR})))).catch((0,l.filteredCatch)(h.MediaNotOnPhone,(()=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.ERROR_MISSING}),{kind:b.ERROR})))).catch((0,l.filteredCatch)(f.MediaTooLargeError,(()=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.ERROR_TOO_LARGE}),{kind:b.ERROR})))).catch((e=>(r.consolidate({uploadStage:g.UPLOAD_STAGE.NEED_UPLOAD}),e.name===o.ABORT_ERROR?{kind:b.CANCELLATION}:{kind:b.ERROR})));return C.set(v,(()=>{p.abort()})),r.uploadPromise=v,v};var a=i(r(48926)),s=i(r(23493)),o=r(89385),l=r(50796),c=i(r(41143)),d=i(r(70714)),u=r(691),p=i(r(51127)),h=r(37115),f=r(60363),_=r(84866),m=n(r(97692)),g=r(58668),y=r(61596),E=n(r(56406)),S=i(r(11339)),v=r(9329),T=r(64551),A=i(r(11105));const C=new WeakMap;const b={SUCCESS:"success",CANCELLATION:"cancellation",ERROR:"error",TIMEOUT:"timeout"};function P(){return(P=(0,a.default)((function*(e){let{blob:t,forwardedFromWeb:r,mediaKeyInfo:n,mediaObject:i,mediaType:a,signal:o,uploadEntry:l,uploadOrigin:c}=e;if(null==l?void 0:l.canReuseMediaKey())return(0,p.default)(a,c,0,r).handleCheckExistingSuccess(),l;const d=n?n.key:null==l?void 0:l.mediaKey,h=n?n.timestamp:null==l?void 0:l.mediaKeyTimestamp,f=T.ServerProps.webLargeFilesUi?(0,s.default)(((e,t)=>{const r=e.loaded+t;Number.isFinite(r)&&i.consolidate({loadedSize:r})}),u.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,{directPath:_,encFilehash:m,mediaKey:g,mediaKeyTimestamp:y,url:E,sidecar:S,firstFrameSidecar:v}=yield A.default.encryptAndUpload({blob:t,mediaKey:d,mediaKeyTimestamp:h,type:a,signal:o,userUploadAttemptCount:i.userUploadAttemptCount,forwardedFromWeb:r,uploadOrigin:c,onProgress:f});return i.entries.addEntry({deprecatedMms3Url:E,mediaKey:g,mediaKeyTimestamp:y,encFilehash:m,type:a,sidecar:S,directPath:_,firstFrameSidecar:v,debugHint:"upload"})}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e){let{mediaObject:t,mimetype:r,mediaType:n,abortSignal:i,uploadOrigin:a}=e;const s=I(t);if(s)return s;if(yield(0,v.downloadMedia)({mimetype:r,mediaObject:t,downloadEvenIfExpensive:!0,mediaType:n,signal:i,rmrReason:S.default.WEBC_RMR_REASON_CODE.UPLOAD,downloadOrigin:a===S.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL?S.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL:S.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP,mode:"manual"}),t.downloadStage===g.DOWNLOAD_STAGE.ERROR_MISSING)throw new h.MediaNotOnPhone;const o=I(t);if(o)return o;throw new Error("cant upload media w/out mediaBlob after download")}))).apply(this,arguments)}function I(e){const t=e.mediaBlob;return t?t.formData():e.filehash?_.MediaBlobCache.get(e.filehash):void 0}t.UploadMediaResultKind=b},27989:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=Promise.resolve().then((()=>{var r;const n=e.size();let i;i=t.asDocument?s.FILETYPE.DOCUMENT:t.asSticker?s.FILETYPE.STICKER:(0,s.typeFromMimetype)(e.type());const d=null!==(r=t.isVcardOverMmsDocument)&&void 0!==r&&r;if(n>function(e,t){if(e===s.FILETYPE.DOCUMENT)return t?1024*c.ServerProps.vcardMaxSizeKb:(0,c.getMaxFilesSizeServerProp)();return c.ServerProps.media}(i,d))throw new o.default(e);if(n<=0)throw new a.MediaFileEmpty;let u;switch(null!=t.gifAttribution?u=t.gifAttribution:t.asGif&&(u=0),i){case"image":return l.processRawImage(e,{minDimension:t.minDimension,transparency:t.transparency});case"sticker":return l.processRawSticker(e);case"video":case"audio":return l.processRawAudioVideo(e,!!t.isPtt,t.precomputedFields,t.asGif,u,e.type());case"document":return l.processRawDocument(e,t.filename,d,t.documentPageCount);default:throw new Error("Received unsupported mediaType: "+i)}}));return e.retain(),e.autoreleaseWhenPromiseCompletes(r),r};var a=i(r(64103)),s=r(1063),o=n(r(97390)),l=i(r(56406)),c=r(64551)},3151:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RequestMediaReuploadManagerImpl=t.RequestMediaReuploadManager=void 0;var i=n(r(48926)),a=n(r(45095)),s=n(r(27184));class o{constructor(){var e=this;this._rmrRequests=new Map,this.requestMediaReupload=function(){var t=(0,i.default)((function*(t){const r=t.id.id,n=e._rmrRequests.get(r);if(n)return(0,a.default)(n.request,"existingRequest.request");const i=new Promise(((n,i)=>{e._rmrRequests.set(r,{resolve:n,reject:i,msg:t})}));return(0,a.default)(e._rmrRequests.get(r),"_this._rmrRequests.get(msgId)").request=i,yield(0,s.default)(t),i}));return function(){return t.apply(this,arguments)}}(),this.resolveMediaReupload=e=>{let{msgId:t,result:r,directPath:n}=e;const i=this._rmrRequests.get(t);null!=i?(i.resolve({result:r,directPath:n}),this._rmrRequests.delete(t)):__LOG__(3)`resolveMediaReupload: msgId (${t}) is not found in _rmrRequests`},this.getMediaKey=e=>{var t;return null===(t=this._rmrRequests.get(e))||void 0===t?void 0:t.msg.mediaKey}}}t.RequestMediaReuploadManagerImpl=o;const l=new o;t.RequestMediaReuploadManager=l},2603:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(97563);function s(){return(s=(0,i.default)((function*(e,t){yield(0,a.updateLocal)(e.id,t),e.set(t)}))).apply(this,arguments)}},74460:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(89385),o=r(40265),l=r(38284),c=r(21009),d=(n(r(11339)),r(70996)),u=n(r(84644)),p=r(28080);function h(){return(h=(0,a.default)((function*(e){const{thumbnail:t,mediaType:r,mediaKeyInfo:n,uploadOrigin:h,forwardedFromWeb:f,timeout:_,signal:m}=e,g=new c.MediaObject;try{return null==_?yield y():yield(0,l.promiseTimeout)(y(),_)}catch(e){const t=e;if(t instanceof o.TimeoutError)return(0,d.cancelUploadMedia)(g),{kind:d.UploadMediaResultKind.TIMEOUT};throw t}function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(){try{const e=yield(0,u.default)((0,p.getHash)(t),m);g.filehash=e,g.mediaBlob=t;const a=yield(0,u.default)((0,d.uploadMedia)({mimetype:"image/jpeg",mediaObject:g,mediaType:r,forwardedFromWeb:f,uploadOrigin:h,mediaKeyInfo:n}),m);return a.kind===d.UploadMediaResultKind.SUCCESS?(0,i.default)((0,i.default)({},a),{},{filehash:e}):{kind:a.kind}}catch(e){const t=e;if("object"==typeof t&&(null==t?void 0:t.name)===s.ABORT_ERROR)return(0,d.cancelUploadMedia)(g),{kind:d.UploadMediaResultKind.CANCELLATION}}}))).apply(this,arguments)}}))).apply(this,arguments)}},87798:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n.Clock.globalUnixTime()-e<i.ServerProps.mmsMediaKeyTTL+Math.floor(86400*Math.random())};var n=r(22683),i=r(64551)},61438:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADVSignedKeyIndexListSpec=t.ADVSignedDeviceIdentitySpec=t.ADVSignedDeviceIdentityHMACSpec=t.ADVKeyIndexListSpec=t.ADVDeviceIdentitySpec=void 0;var n=r(1390);const i={};t.ADVKeyIndexListSpec=i;const a={};t.ADVSignedKeyIndexListSpec=a;const s={};t.ADVDeviceIdentitySpec=s;const o={};t.ADVSignedDeviceIdentitySpec=o;const l={};t.ADVSignedDeviceIdentityHMACSpec=l,i.internalSpec={rawId:[1,n.TYPES.UINT32],timestamp:[2,n.TYPES.UINT64],currentIndex:[3,n.TYPES.UINT32],validIndexes:[4,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32]},a.internalSpec={details:[1,n.TYPES.BYTES],accountSignature:[2,n.TYPES.BYTES]},s.internalSpec={rawId:[1,n.TYPES.UINT32],timestamp:[2,n.TYPES.UINT64],keyIndex:[3,n.TYPES.UINT32]},o.internalSpec={details:[1,n.TYPES.BYTES],accountSignatureKey:[2,n.TYPES.BYTES],accountSignature:[3,n.TYPES.BYTES],deviceSignature:[4,n.TYPES.BYTES]},l.internalSpec={details:[1,n.TYPES.BYTES],hmac:[2,n.TYPES.BYTES]}},98263:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompanionPropsSpec=t.CompanionPropsPlatformType=t.AppVersionSpec=void 0;var n=r(1390);const i=r(54302)({UNKNOWN:0,CHROME:1,FIREFOX:2,IE:3,OPERA:4,SAFARI:5,EDGE:6,DESKTOP:7,IPAD:8,ANDROID_TABLET:9,OHANA:10,ALOHA:11,CATALINA:12});t.CompanionPropsPlatformType=i;const a={};t.CompanionPropsSpec=a;const s={};t.AppVersionSpec=s,a.internalSpec={os:[1,n.TYPES.STRING],version:[2,n.TYPES.MESSAGE,s],platformType:[3,n.TYPES.ENUM,i],requireFullSync:[4,n.TYPES.BOOL]},s.internalSpec={primary:[1,n.TYPES.UINT32],secondary:[2,n.TYPES.UINT32],tertiary:[3,n.TYPES.UINT32],quaternary:[4,n.TYPES.UINT32],quinary:[5,n.TYPES.UINT32]}},24808:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestPaymentMessageSpec=t.ReactionMessageSpec=t.QuickReplyButtonSpec=t.ProtocolMessageType=t.ProtocolMessageSpec=t.ProductSpec=t.ProductSnapshotSpec=t.ProductSectionSpec=t.ProductMessageSpec=t.ProductListInfoSpec=t.ProductListHeaderImageSpec=t.PointSpec=t.PaymentInviteMessageSpec=t.PaymentInviteMessageServiceType=t.PaymentBackgroundType=t.PaymentBackgroundSpec=t.OrderMessageSpec=t.OrderMessageOrderSurface=t.OrderMessageOrderStatus=t.NativeFlowMessageSpec=t.NativeFlowInfoSpec=t.NativeFlowButtonSpec=t.MoneySpec=t.MessageSpec=t.MessageContextInfoSpec=t.MediaDataSpec=t.LocationSpec=t.LocationMessageSpec=t.LiveLocationMessageSpec=t.ListResponseMessageSpec=t.ListResponseMessageListType=t.ListMessageSpec=t.ListMessageListType=t.InvoiceMessageSpec=t.InvoiceMessageAttachmentType=t.InteractiveMessageSpec=t.InteractiveAnnotationSpec=t.InitialSecurityNotificationSettingSyncSpec=t.ImageMessageSpec=t.HydratedURLButtonSpec=t.HydratedTemplateButtonSpec=t.HydratedQuickReplyButtonSpec=t.HydratedFourRowTemplateSpec=t.HydratedCallButtonSpec=t.HistorySyncNotificationSpec=t.HistorySyncNotificationHistorySyncType=t.HighlyStructuredMessageSpec=t.HeaderSpec=t.HSMLocalizableParameterSpec=t.HSMDateTimeUnixEpochSpec=t.HSMDateTimeSpec=t.HSMDateTimeComponentSpec=t.HSMDateTimeComponentDayOfWeekType=t.HSMDateTimeComponentCalendarType=t.HSMCurrencySpec=t.GroupInviteMessageSpec=t.GroupInviteMessageGroupType=t.FutureProofMessageSpec=t.FourRowTemplateSpec=t.FooterSpec=t.ExternalAdReplyInfoSpec=t.ExternalAdReplyInfoMediaType=t.ExtendedTextMessageSpec=t.ExtendedTextMessagePreviewType=t.ExtendedTextMessageInviteLinkGroupType=t.ExtendedTextMessageFontType=t.DocumentMessageSpec=t.DisappearingModeSpec=t.DisappearingModeInitiator=t.DeviceSentMessageSpec=t.DeviceListMetadataSpec=t.DeclinePaymentRequestMessageSpec=t.ContextInfoSpec=t.ContactsArrayMessageSpec=t.ContactMessageSpec=t.CollectionMessageSpec=t.ChatSpec=t.CatalogSnapshotSpec=t.CancelPaymentRequestMessageSpec=t.CallSpec=t.CallButtonSpec=t.ButtonsResponseMessageType=t.ButtonsResponseMessageSpec=t.ButtonsMessageSpec=t.ButtonsMessageHeaderType=t.ButtonType=t.ButtonTextSpec=t.ButtonSpec=t.BodySpec=t.AudioMessageSpec=t.AppStateSyncKeySpec=t.AppStateSyncKeyShareSpec=t.AppStateSyncKeyRequestSpec=t.AppStateSyncKeyIdSpec=t.AppStateSyncKeyFingerprintSpec=t.AppStateSyncKeyDataSpec=t.AppStateFatalExceptionNotificationSpec=t.AdReplyInfoSpec=t.AdReplyInfoMediaType=t.ActionLinkSpec=void 0,t.VideoMessageSpec=t.VideoMessageAttribution=t.URLButtonSpec=t.TemplateMessageSpec=t.TemplateButtonSpec=t.TemplateButtonReplyMessageSpec=t.StickerSyncRMRMessageSpec=t.StickerMessageSpec=t.SingleSelectReplySpec=t.ShopMessageSurface=t.ShopMessageSpec=t.SenderKeyDistributionMessageSpec=t.SendPaymentMessageSpec=t.SectionSpec=t.RowSpec=t.RequestPaymentMessageSpec=t.ReactionMessageSpec=t.QuickReplyButtonSpec=t.ProtocolMessageType=t.ProtocolMessageSpec=t.ProductSpec=t.ProductSnapshotSpec=t.ProductSectionSpec=t.ProductMessageSpec=t.ProductListInfoSpec=t.ProductListHeaderImageSpec=t.PointSpec=t.PaymentInviteMessageSpec=t.PaymentInviteMessageServiceType=t.PaymentBackgroundType=t.PaymentBackgroundSpec=t.OrderMessageSpec=t.OrderMessageOrderSurface=t.OrderMessageOrderStatus=t.NativeFlowMessageSpec=t.NativeFlowInfoSpec=t.NativeFlowButtonSpec=t.MoneySpec=t.MessageSpec=t.MessageContextInfoSpec=t.MediaDataSpec=t.LocationSpec=t.LocationMessageSpec=t.LiveLocationMessageSpec=t.ListResponseMessageSpec=t.ListResponseMessageListType=t.ListMessageSpec=t.ListMessageListType=t.InvoiceMessageSpec=t.InvoiceMessageAttachmentType=t.InteractiveMessageSpec=t.InteractiveAnnotationSpec=t.InitialSecurityNotificationSettingSyncSpec=t.ImageMessageSpec=t.HydratedURLButtonSpec=t.HydratedTemplateButtonSpec=t.HydratedQuickReplyButtonSpec=t.HydratedFourRowTemplateSpec=t.HydratedCallButtonSpec=t.HistorySyncNotificationSpec=t.HistorySyncNotificationHistorySyncType=t.HighlyStructuredMessageSpec=t.HeaderSpec=t.HSMLocalizableParameterSpec=t.HSMDateTimeUnixEpochSpec=t.HSMDateTimeSpec=t.HSMDateTimeComponentSpec=t.HSMDateTimeComponentDayOfWeekType=t.HSMDateTimeComponentCalendarType=t.HSMCurrencySpec=t.GroupInviteMessageSpec=t.GroupInviteMessageGroupType=t.FutureProofMessageSpec=t.FourRowTemplateSpec=t.FooterSpec=t.ExternalAdReplyInfoSpec=t.ExternalAdReplyInfoMediaType=t.ExtendedTextMessageSpec=t.ExtendedTextMessagePreviewType=t.ExtendedTextMessageInviteLinkGroupType=t.ExtendedTextMessageFontType=t.DocumentMessageSpec=t.DisappearingModeSpec=t.DisappearingModeInitiator=t.DeviceSentMessageSpec=t.DeviceListMetadataSpec=t.DeclinePaymentRequestMessageSpec=t.ContextInfoSpec=t.ContactsArrayMessageSpec=t.ContactMessageSpec=t.CollectionMessageSpec=t.ChatSpec=t.CatalogSnapshotSpec=t.CancelPaymentRequestMessageSpec=t.CallSpec=t.CallButtonSpec=t.ButtonsResponseMessageType=t.ButtonsResponseMessageSpec=t.ButtonsMessageSpec=t.ButtonsMessageHeaderType=t.ButtonType=t.ButtonTextSpec=t.ButtonSpec=t.BodySpec=t.AudioMessageSpec=t.AppStateSyncKeySpec=t.AppStateSyncKeyShareSpec=t.AppStateSyncKeyRequestSpec=t.AppStateSyncKeyIdSpec=t.AppStateSyncKeyFingerprintSpec=t.AppStateSyncKeyDataSpec=t.AppStateFatalExceptionNotificationSpec=t.AdReplyInfoSpec=t.AdReplyInfoMediaType=t.ActionLinkSpec=void 0;var n=r(1390),i=r(93890);const a=r(54302)({UNKNOWN:0,DISPLAY_TEXT:1});t.ButtonsResponseMessageType=a;const s=r(54302)({UNKNOWN:0,RESPONSE:1,NATIVE_FLOW:2});t.ButtonType=s;const o=r(54302)({UNKNOWN:0,EMPTY:1,TEXT:2,DOCUMENT:3,IMAGE:4,VIDEO:5,LOCATION:6});t.ButtonsMessageHeaderType=o;const l=r(54302)({DEFAULT:0,PARENT:1});t.GroupInviteMessageGroupType=l;const c=r(54302)({UNKNOWN_SURFACE:0,FB:1,IG:2,WA:3});t.ShopMessageSurface=c;const d=r(54302)({UNKNOWN:0,SINGLE_SELECT:1});t.ListResponseMessageListType=d;const u=r(54302)({UNKNOWN:0,SINGLE_SELECT:1,PRODUCT_LIST:2});t.ListMessageListType=u;const p=r(54302)({CATALOG:1});t.OrderMessageOrderSurface=p;const h=r(54302)({INQUIRY:1});t.OrderMessageOrderStatus=h;const f=r(54302)({UNKNOWN:0,FBPAY:1,NOVI:2,UPI:3});t.PaymentInviteMessageServiceType=f;const _=r(54302)({GREGORIAN:1,SOLAR_HIJRI:2});t.HSMDateTimeComponentCalendarType=_;const m=r(54302)({MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7});t.HSMDateTimeComponentDayOfWeekType=m;const g=r(54302)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4});t.HistorySyncNotificationHistorySyncType=g;const y=r(54302)({REVOKE:0,EPHEMERAL_SETTING:3,EPHEMERAL_SYNC_RESPONSE:4,HISTORY_SYNC_NOTIFICATION:5,APP_STATE_SYNC_KEY_SHARE:6,APP_STATE_SYNC_KEY_REQUEST:7,MSG_FANOUT_BACKFILL_REQUEST:8,INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:9,APP_STATE_FATAL_EXCEPTION_NOTIFICATION:10});t.ProtocolMessageType=y;const E=r(54302)({NONE:0,GIPHY:1,TENOR:2});t.VideoMessageAttribution=E;const S=r(54302)({DEFAULT:0,PARENT:1});t.ExtendedTextMessageInviteLinkGroupType=S;const v=r(54302)({NONE:0,VIDEO:1});t.ExtendedTextMessagePreviewType=v;const T=r(54302)({SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5});t.ExtendedTextMessageFontType=T;const A=r(54302)({IMAGE:0,PDF:1});t.InvoiceMessageAttachmentType=A;const C=r(54302)({NONE:0,IMAGE:1,VIDEO:2});t.ExternalAdReplyInfoMediaType=C;const b=r(54302)({NONE:0,IMAGE:1,VIDEO:2});t.AdReplyInfoMediaType=b;const P=r(54302)({UNKNOWN:0,DEFAULT:1});t.PaymentBackgroundType=P;const M=r(54302)({CHANGED_IN_CHAT:0,INITIATED_BY_ME:1,INITIATED_BY_OTHER:2});t.DisappearingModeInitiator=M;const O={};t.MessageSpec=O;const I={};t.StickerSyncRMRMessageSpec=I;const w={};t.ReactionMessageSpec=w;const R={};t.ButtonsResponseMessageSpec=R;const D={};t.ButtonsMessageSpec=D;const N={};t.ButtonSpec=N;const L={};t.NativeFlowInfoSpec=L;const k={};t.ButtonTextSpec=k;const G={};t.FutureProofMessageSpec=G;const U={};t.DeviceSentMessageSpec=U;const F={};t.GroupInviteMessageSpec=F;const x={};t.InteractiveMessageSpec=x;const B={};t.NativeFlowMessageSpec=B;const K={};t.NativeFlowButtonSpec=K;const Y={};t.CollectionMessageSpec=Y;const j={};t.ShopMessageSpec=j;const W={};t.FooterSpec=W;const H={};t.BodySpec=H;const V={};t.HeaderSpec=V;const $={};t.ListResponseMessageSpec=$;const z={};t.SingleSelectReplySpec=z;const q={};t.ListMessageSpec=q;const J={};t.ProductListInfoSpec=J;const Q={};t.ProductListHeaderImageSpec=Q;const X={};t.ProductSectionSpec=X;const Z={};t.ProductSpec=Z;const ee={};t.SectionSpec=ee;const te={};t.RowSpec=te;const re={};t.OrderMessageSpec=re;const ne={};t.ProductMessageSpec=ne;const ie={};t.ProductSnapshotSpec=ie;const ae={};t.CatalogSnapshotSpec=ae;const se={};t.TemplateButtonReplyMessageSpec=se;const oe={};t.TemplateMessageSpec=oe;const le={};t.HydratedFourRowTemplateSpec=le;const ce={};t.FourRowTemplateSpec=ce;const de={};t.StickerMessageSpec=de;const ue={};t.LiveLocationMessageSpec=ue;const pe={};t.PaymentInviteMessageSpec=pe;const he={};t.CancelPaymentRequestMessageSpec=he;const fe={};t.DeclinePaymentRequestMessageSpec=fe;const _e={};t.RequestPaymentMessageSpec=_e;const me={};t.SendPaymentMessageSpec=me;const ge={};t.HighlyStructuredMessageSpec=ge;const ye={};t.HSMLocalizableParameterSpec=ye;const Ee={};t.HSMDateTimeSpec=Ee;const Se={};t.HSMDateTimeUnixEpochSpec=Se;const ve={};t.HSMDateTimeComponentSpec=ve;const Te={};t.HSMCurrencySpec=Te;const Ae={};t.ContactsArrayMessageSpec=Ae;const Ce={};t.InitialSecurityNotificationSettingSyncSpec=Ce;const be={};t.AppStateFatalExceptionNotificationSpec=be;const Pe={};t.AppStateSyncKeyRequestSpec=Pe;const Me={};t.AppStateSyncKeyShareSpec=Me;const Oe={};t.AppStateSyncKeyDataSpec=Oe;const Ie={};t.AppStateSyncKeyFingerprintSpec=Ie;const we={};t.AppStateSyncKeyIdSpec=we;const Re={};t.AppStateSyncKeySpec=Re;const De={};t.HistorySyncNotificationSpec=De;const Ne={};t.ProtocolMessageSpec=Ne;const Le={};t.ChatSpec=Le;const ke={};t.CallSpec=ke;const Ge={};t.VideoMessageSpec=Ge;const Ue={};t.AudioMessageSpec=Ue;const Fe={};t.DocumentMessageSpec=Fe;const xe={};t.ExtendedTextMessageSpec=xe;const Be={};t.LocationMessageSpec=Be;const Ke={};t.ContactMessageSpec=Ke;const Ye={};t.InvoiceMessageSpec=Ye;const je={};t.ImageMessageSpec=je;const We={};t.SenderKeyDistributionMessageSpec=We;const He={};t.ContextInfoSpec=He;const Ve={};t.ExternalAdReplyInfoSpec=Ve;const $e={};t.AdReplyInfoSpec=$e;const ze={};t.MessageContextInfoSpec=ze;const qe={};t.DeviceListMetadataSpec=qe;const Je={};t.InteractiveAnnotationSpec=Je;const Qe={};t.PointSpec=Qe;const Xe={};t.LocationSpec=Xe;const Ze={};t.TemplateButtonSpec=Ze;const et={};t.CallButtonSpec=et;const tt={};t.URLButtonSpec=tt;const rt={};t.QuickReplyButtonSpec=rt;const nt={};t.HydratedTemplateButtonSpec=nt;const it={};t.HydratedCallButtonSpec=it;const at={};t.HydratedURLButtonSpec=at;const st={};t.HydratedQuickReplyButtonSpec=st;const ot={};t.MoneySpec=ot;const lt={};t.PaymentBackgroundSpec=lt;const ct={};t.MediaDataSpec=ct;const dt={};t.DisappearingModeSpec=dt;const ut={};t.ActionLinkSpec=ut,O.internalSpec={conversation:[1,n.TYPES.STRING],senderKeyDistributionMessage:[2,n.TYPES.MESSAGE,We],imageMessage:[3,n.TYPES.MESSAGE,je],contactMessage:[4,n.TYPES.MESSAGE,Ke],locationMessage:[5,n.TYPES.MESSAGE,Be],extendedTextMessage:[6,n.TYPES.MESSAGE,xe],documentMessage:[7,n.TYPES.MESSAGE,Fe],audioMessage:[8,n.TYPES.MESSAGE,Ue],videoMessage:[9,n.TYPES.MESSAGE,Ge],call:[10,n.TYPES.MESSAGE,ke],chat:[11,n.TYPES.MESSAGE,Le],protocolMessage:[12,n.TYPES.MESSAGE,Ne],contactsArrayMessage:[13,n.TYPES.MESSAGE,Ae],highlyStructuredMessage:[14,n.TYPES.MESSAGE,ge],fastRatchetKeySenderKeyDistributionMessage:[15,n.TYPES.MESSAGE,We],sendPaymentMessage:[16,n.TYPES.MESSAGE,me],liveLocationMessage:[18,n.TYPES.MESSAGE,ue],requestPaymentMessage:[22,n.TYPES.MESSAGE,_e],declinePaymentRequestMessage:[23,n.TYPES.MESSAGE,fe],cancelPaymentRequestMessage:[24,n.TYPES.MESSAGE,he],templateMessage:[25,n.TYPES.MESSAGE,oe],stickerMessage:[26,n.TYPES.MESSAGE,de],groupInviteMessage:[28,n.TYPES.MESSAGE,F],templateButtonReplyMessage:[29,n.TYPES.MESSAGE,se],productMessage:[30,n.TYPES.MESSAGE,ne],deviceSentMessage:[31,n.TYPES.MESSAGE,U],messageContextInfo:[35,n.TYPES.MESSAGE,ze],listMessage:[36,n.TYPES.MESSAGE,q],viewOnceMessage:[37,n.TYPES.MESSAGE,G],orderMessage:[38,n.TYPES.MESSAGE,re],listResponseMessage:[39,n.TYPES.MESSAGE,$],ephemeralMessage:[40,n.TYPES.MESSAGE,G],invoiceMessage:[41,n.TYPES.MESSAGE,Ye],buttonsMessage:[42,n.TYPES.MESSAGE,D],buttonsResponseMessage:[43,n.TYPES.MESSAGE,R],paymentInviteMessage:[44,n.TYPES.MESSAGE,pe],interactiveMessage:[45,n.TYPES.MESSAGE,x],reactionMessage:[46,n.TYPES.MESSAGE,w],stickerSyncRmrMessage:[47,n.TYPES.MESSAGE,I]},I.internalSpec={filehash:[1,n.FLAGS.REPEATED|n.TYPES.STRING],rmrSource:[2,n.TYPES.STRING],requestTimestamp:[3,n.TYPES.INT64]},w.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec],text:[2,n.TYPES.STRING],groupingKey:[3,n.TYPES.STRING],senderTimestampMs:[4,n.TYPES.INT64]},R.internalSpec={selectedButtonId:[1,n.TYPES.STRING],selectedDisplayText:[2,n.TYPES.STRING],contextInfo:[3,n.TYPES.MESSAGE,He],type:[4,n.TYPES.ENUM,a],__oneofs__:{response:["selectedDisplayText"]}},D.internalSpec={text:[1,n.TYPES.STRING],documentMessage:[2,n.TYPES.MESSAGE,Fe],imageMessage:[3,n.TYPES.MESSAGE,je],videoMessage:[4,n.TYPES.MESSAGE,Ge],locationMessage:[5,n.TYPES.MESSAGE,Be],contentText:[6,n.TYPES.STRING],footerText:[7,n.TYPES.STRING],contextInfo:[8,n.TYPES.MESSAGE,He],buttons:[9,n.FLAGS.REPEATED|n.TYPES.MESSAGE,N],headerType:[10,n.TYPES.ENUM,o],__oneofs__:{header:["text","documentMessage","imageMessage","videoMessage","locationMessage"]}},N.internalSpec={buttonId:[1,n.TYPES.STRING],buttonText:[2,n.TYPES.MESSAGE,k],type:[3,n.TYPES.ENUM,s],nativeFlowInfo:[4,n.TYPES.MESSAGE,L]},L.internalSpec={name:[1,n.TYPES.STRING],paramsJson:[2,n.TYPES.STRING]},k.internalSpec={displayText:[1,n.TYPES.STRING]},G.internalSpec={message:[1,n.TYPES.MESSAGE,O]},U.internalSpec={destinationJid:[1,n.TYPES.STRING],message:[2,n.TYPES.MESSAGE,O],phash:[3,n.TYPES.STRING]},F.internalSpec={groupJid:[1,n.TYPES.STRING],inviteCode:[2,n.TYPES.STRING],inviteExpiration:[3,n.TYPES.INT64],groupName:[4,n.TYPES.STRING],jpegThumbnail:[5,n.TYPES.BYTES],caption:[6,n.TYPES.STRING],contextInfo:[7,n.TYPES.MESSAGE,He],groupType:[8,n.TYPES.ENUM,l]},x.internalSpec={header:[1,n.TYPES.MESSAGE,V],body:[2,n.TYPES.MESSAGE,H],footer:[3,n.TYPES.MESSAGE,W],shopStorefrontMessage:[4,n.TYPES.MESSAGE,j],collectionMessage:[5,n.TYPES.MESSAGE,Y],nativeFlowMessage:[6,n.TYPES.MESSAGE,B],contextInfo:[15,n.TYPES.MESSAGE,He],__oneofs__:{interactiveMessage:["shopStorefrontMessage","collectionMessage","nativeFlowMessage"]}},B.internalDefaults={messageVersion:1},B.internalSpec={buttons:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,K],messageParamsJson:[2,n.TYPES.STRING],messageVersion:[3,n.TYPES.INT32]},K.internalSpec={name:[1,n.TYPES.STRING],buttonParamsJson:[2,n.TYPES.STRING]},Y.internalDefaults={messageVersion:1},Y.internalSpec={bizJid:[1,n.TYPES.STRING],id:[2,n.TYPES.STRING],messageVersion:[3,n.TYPES.INT32]},j.internalDefaults={messageVersion:1},j.internalSpec={id:[1,n.TYPES.STRING],surface:[2,n.TYPES.ENUM,c],messageVersion:[3,n.TYPES.INT32]},W.internalSpec={text:[1,n.TYPES.STRING]},H.internalSpec={text:[1,n.TYPES.STRING]},V.internalSpec={title:[1,n.TYPES.STRING],subtitle:[2,n.TYPES.STRING],documentMessage:[3,n.TYPES.MESSAGE,Fe],imageMessage:[4,n.TYPES.MESSAGE,je],jpegThumbnail:[6,n.TYPES.BYTES],videoMessage:[7,n.TYPES.MESSAGE,Ge],hasMediaAttachment:[5,n.TYPES.BOOL],__oneofs__:{media:["documentMessage","imageMessage","jpegThumbnail","videoMessage"]}},$.internalSpec={title:[1,n.TYPES.STRING],listType:[2,n.TYPES.ENUM,d],singleSelectReply:[3,n.TYPES.MESSAGE,z],contextInfo:[4,n.TYPES.MESSAGE,He],description:[5,n.TYPES.STRING]},z.internalSpec={selectedRowId:[1,n.TYPES.STRING]},q.internalSpec={title:[1,n.TYPES.STRING],description:[2,n.TYPES.STRING],buttonText:[3,n.TYPES.STRING],listType:[4,n.TYPES.ENUM,u],sections:[5,n.FLAGS.REPEATED|n.TYPES.MESSAGE,ee],productListInfo:[6,n.TYPES.MESSAGE,J],footerText:[7,n.TYPES.STRING],contextInfo:[8,n.TYPES.MESSAGE,He]},J.internalSpec={productSections:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,X],headerImage:[2,n.TYPES.MESSAGE,Q],businessOwnerJid:[3,n.TYPES.STRING]},Q.internalSpec={productId:[1,n.TYPES.STRING],jpegThumbnail:[2,n.TYPES.BYTES]},X.internalSpec={title:[1,n.TYPES.STRING],products:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Z]},Z.internalSpec={productId:[1,n.TYPES.STRING]},ee.internalSpec={title:[1,n.TYPES.STRING],rows:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,te]},te.internalSpec={title:[1,n.TYPES.STRING],description:[2,n.TYPES.STRING],rowId:[3,n.TYPES.STRING]},re.internalSpec={orderId:[1,n.TYPES.STRING],thumbnail:[2,n.TYPES.BYTES],itemCount:[3,n.TYPES.INT32],status:[4,n.TYPES.ENUM,h],surface:[5,n.TYPES.ENUM,p],message:[6,n.TYPES.STRING],orderTitle:[7,n.TYPES.STRING],sellerJid:[8,n.TYPES.STRING],token:[9,n.TYPES.STRING],totalAmount1000:[10,n.TYPES.INT64],totalCurrencyCode:[11,n.TYPES.STRING],contextInfo:[17,n.TYPES.MESSAGE,He]},ne.internalSpec={product:[1,n.TYPES.MESSAGE,ie],businessOwnerJid:[2,n.TYPES.STRING],catalog:[4,n.TYPES.MESSAGE,ae],body:[5,n.TYPES.STRING],footer:[6,n.TYPES.STRING],contextInfo:[17,n.TYPES.MESSAGE,He]},ie.internalSpec={productImage:[1,n.TYPES.MESSAGE,je],productId:[2,n.TYPES.STRING],title:[3,n.TYPES.STRING],description:[4,n.TYPES.STRING],currencyCode:[5,n.TYPES.STRING],priceAmount1000:[6,n.TYPES.INT64],retailerId:[7,n.TYPES.STRING],url:[8,n.TYPES.STRING],productImageCount:[9,n.TYPES.UINT32],firstImageId:[11,n.TYPES.STRING],salePriceAmount1000:[12,n.TYPES.INT64]},ae.internalSpec={catalogImage:[1,n.TYPES.MESSAGE,je],title:[2,n.TYPES.STRING],description:[3,n.TYPES.STRING]},se.internalSpec={selectedId:[1,n.TYPES.STRING],selectedDisplayText:[2,n.TYPES.STRING],contextInfo:[3,n.TYPES.MESSAGE,He],selectedIndex:[4,n.TYPES.UINT32]},oe.internalSpec={fourRowTemplate:[1,n.TYPES.MESSAGE,ce],hydratedFourRowTemplate:[2,n.TYPES.MESSAGE,le],contextInfo:[3,n.TYPES.MESSAGE,He],hydratedTemplate:[4,n.TYPES.MESSAGE,le],__oneofs__:{format:["fourRowTemplate","hydratedFourRowTemplate"]}},le.internalSpec={documentMessage:[1,n.TYPES.MESSAGE,Fe],hydratedTitleText:[2,n.TYPES.STRING],imageMessage:[3,n.TYPES.MESSAGE,je],videoMessage:[4,n.TYPES.MESSAGE,Ge],locationMessage:[5,n.TYPES.MESSAGE,Be],hydratedContentText:[6,n.TYPES.STRING],hydratedFooterText:[7,n.TYPES.STRING],hydratedButtons:[8,n.FLAGS.REPEATED|n.TYPES.MESSAGE,nt],templateId:[9,n.TYPES.STRING],__oneofs__:{title:["documentMessage","hydratedTitleText","imageMessage","videoMessage","locationMessage"]}},ce.internalSpec={documentMessage:[1,n.TYPES.MESSAGE,Fe],highlyStructuredMessage:[2,n.TYPES.MESSAGE,ge],imageMessage:[3,n.TYPES.MESSAGE,je],videoMessage:[4,n.TYPES.MESSAGE,Ge],locationMessage:[5,n.TYPES.MESSAGE,Be],content:[6,n.TYPES.MESSAGE,ge],footer:[7,n.TYPES.MESSAGE,ge],buttons:[8,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Ze],__oneofs__:{title:["documentMessage","highlyStructuredMessage","imageMessage","videoMessage","locationMessage"]}},de.internalSpec={url:[1,n.TYPES.STRING],fileSha256:[2,n.TYPES.BYTES],fileEncSha256:[3,n.TYPES.BYTES],mediaKey:[4,n.TYPES.BYTES],mimetype:[5,n.TYPES.STRING],height:[6,n.TYPES.UINT32],width:[7,n.TYPES.UINT32],directPath:[8,n.TYPES.STRING],fileLength:[9,n.TYPES.UINT64],mediaKeyTimestamp:[10,n.TYPES.INT64],firstFrameLength:[11,n.TYPES.UINT32],firstFrameSidecar:[12,n.TYPES.BYTES],isAnimated:[13,n.TYPES.BOOL],pngThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,He]},ue.internalSpec={degreesLatitude:[1,n.TYPES.DOUBLE],degreesLongitude:[2,n.TYPES.DOUBLE],accuracyInMeters:[3,n.TYPES.UINT32],speedInMps:[4,n.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[5,n.TYPES.UINT32],caption:[6,n.TYPES.STRING],sequenceNumber:[7,n.TYPES.INT64],timeOffset:[8,n.TYPES.UINT32],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,He]},pe.internalSpec={serviceType:[1,n.TYPES.ENUM,f],expiryTimestamp:[2,n.TYPES.INT64]},he.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec]},fe.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec]},_e.internalSpec={noteMessage:[4,n.TYPES.MESSAGE,O],currencyCodeIso4217:[1,n.TYPES.STRING],amount1000:[2,n.TYPES.UINT64],requestFrom:[3,n.TYPES.STRING],expiryTimestamp:[5,n.TYPES.INT64],amount:[6,n.TYPES.MESSAGE,ot],background:[7,n.TYPES.MESSAGE,lt]},me.internalSpec={noteMessage:[2,n.TYPES.MESSAGE,O],requestMessageKey:[3,n.TYPES.MESSAGE,i.MessageKeySpec],background:[4,n.TYPES.MESSAGE,lt]},ge.internalSpec={namespace:[1,n.TYPES.STRING],elementName:[2,n.TYPES.STRING],params:[3,n.FLAGS.REPEATED|n.TYPES.STRING],fallbackLg:[4,n.TYPES.STRING],fallbackLc:[5,n.TYPES.STRING],localizableParams:[6,n.FLAGS.REPEATED|n.TYPES.MESSAGE,ye],deterministicLg:[7,n.TYPES.STRING],deterministicLc:[8,n.TYPES.STRING],hydratedHsm:[9,n.TYPES.MESSAGE,oe]},ye.internalSpec={default:[1,n.TYPES.STRING],currency:[2,n.TYPES.MESSAGE,Te],dateTime:[3,n.TYPES.MESSAGE,Ee],__oneofs__:{paramOneof:["currency","dateTime"]}},Ee.internalSpec={component:[1,n.TYPES.MESSAGE,ve],unixEpoch:[2,n.TYPES.MESSAGE,Se],__oneofs__:{datetimeOneof:["component","unixEpoch"]}},Se.internalSpec={timestamp:[1,n.TYPES.INT64]},ve.internalSpec={dayOfWeek:[1,n.TYPES.ENUM,m],year:[2,n.TYPES.UINT32],month:[3,n.TYPES.UINT32],dayOfMonth:[4,n.TYPES.UINT32],hour:[5,n.TYPES.UINT32],minute:[6,n.TYPES.UINT32],calendar:[7,n.TYPES.ENUM,_]},Te.internalSpec={currencyCode:[1,n.TYPES.STRING],amount1000:[2,n.TYPES.INT64]},Ae.internalSpec={displayName:[1,n.TYPES.STRING],contacts:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Ke],contextInfo:[17,n.TYPES.MESSAGE,He]},Ce.internalSpec={securityNotificationEnabled:[1,n.TYPES.BOOL]},be.internalSpec={collectionNames:[1,n.FLAGS.REPEATED|n.TYPES.STRING],timestamp:[2,n.TYPES.INT64]},Pe.internalSpec={keyIds:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,we]},Me.internalSpec={keys:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Re]},Oe.internalSpec={keyData:[1,n.TYPES.BYTES],fingerprint:[2,n.TYPES.MESSAGE,Ie],timestamp:[3,n.TYPES.INT64]},Ie.internalSpec={rawId:[1,n.TYPES.UINT32],currentIndex:[2,n.TYPES.UINT32],deviceIndexes:[3,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32]},we.internalSpec={keyId:[1,n.TYPES.BYTES]},Re.internalSpec={keyId:[1,n.TYPES.MESSAGE,we],keyData:[2,n.TYPES.MESSAGE,Oe]},De.internalSpec={fileSha256:[1,n.TYPES.BYTES],fileLength:[2,n.TYPES.UINT64],mediaKey:[3,n.TYPES.BYTES],fileEncSha256:[4,n.TYPES.BYTES],directPath:[5,n.TYPES.STRING],syncType:[6,n.TYPES.ENUM,g],chunkOrder:[7,n.TYPES.UINT32],originalMessageId:[8,n.TYPES.STRING]},Ne.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec],type:[2,n.TYPES.ENUM,y],ephemeralExpiration:[4,n.TYPES.UINT32],ephemeralSettingTimestamp:[5,n.TYPES.INT64],historySyncNotification:[6,n.TYPES.MESSAGE,De],appStateSyncKeyShare:[7,n.TYPES.MESSAGE,Me],appStateSyncKeyRequest:[8,n.TYPES.MESSAGE,Pe],initialSecurityNotificationSettingSync:[9,n.TYPES.MESSAGE,Ce],appStateFatalExceptionNotification:[10,n.TYPES.MESSAGE,be],disappearingMode:[11,n.TYPES.MESSAGE,dt]},Le.internalSpec={displayName:[1,n.TYPES.STRING],id:[2,n.TYPES.STRING]},ke.internalSpec={callKey:[1,n.TYPES.BYTES],conversionSource:[2,n.TYPES.STRING],conversionData:[3,n.TYPES.BYTES],conversionDelaySeconds:[4,n.TYPES.UINT32]},Ge.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],fileSha256:[3,n.TYPES.BYTES],fileLength:[4,n.TYPES.UINT64],seconds:[5,n.TYPES.UINT32],mediaKey:[6,n.TYPES.BYTES],caption:[7,n.TYPES.STRING],gifPlayback:[8,n.TYPES.BOOL],height:[9,n.TYPES.UINT32],width:[10,n.TYPES.UINT32],fileEncSha256:[11,n.TYPES.BYTES],interactiveAnnotations:[12,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Je],directPath:[13,n.TYPES.STRING],mediaKeyTimestamp:[14,n.TYPES.INT64],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,He],streamingSidecar:[18,n.TYPES.BYTES],gifAttribution:[19,n.TYPES.ENUM,E],viewOnce:[20,n.TYPES.BOOL],thumbnailDirectPath:[21,n.TYPES.STRING],thumbnailSha256:[22,n.TYPES.BYTES],thumbnailEncSha256:[23,n.TYPES.BYTES],staticUrl:[24,n.TYPES.STRING]},Ue.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],fileSha256:[3,n.TYPES.BYTES],fileLength:[4,n.TYPES.UINT64],seconds:[5,n.TYPES.UINT32],ptt:[6,n.TYPES.BOOL],mediaKey:[7,n.TYPES.BYTES],fileEncSha256:[8,n.TYPES.BYTES],directPath:[9,n.TYPES.STRING],mediaKeyTimestamp:[10,n.TYPES.INT64],contextInfo:[17,n.TYPES.MESSAGE,He],streamingSidecar:[18,n.TYPES.BYTES],waveform:[19,n.TYPES.BYTES]},Fe.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],title:[3,n.TYPES.STRING],fileSha256:[4,n.TYPES.BYTES],fileLength:[5,n.TYPES.UINT64],pageCount:[6,n.TYPES.UINT32],mediaKey:[7,n.TYPES.BYTES],fileName:[8,n.TYPES.STRING],fileEncSha256:[9,n.TYPES.BYTES],directPath:[10,n.TYPES.STRING],mediaKeyTimestamp:[11,n.TYPES.INT64],contactVcard:[12,n.TYPES.BOOL],thumbnailDirectPath:[13,n.TYPES.STRING],thumbnailSha256:[14,n.TYPES.BYTES],thumbnailEncSha256:[15,n.TYPES.BYTES],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,He],thumbnailHeight:[18,n.TYPES.UINT32],thumbnailWidth:[19,n.TYPES.UINT32]},xe.internalSpec={text:[1,n.TYPES.STRING],matchedText:[2,n.TYPES.STRING],canonicalUrl:[4,n.TYPES.STRING],description:[5,n.TYPES.STRING],title:[6,n.TYPES.STRING],textArgb:[7,n.TYPES.FIXED32],backgroundArgb:[8,n.TYPES.FIXED32],font:[9,n.TYPES.ENUM,T],previewType:[10,n.TYPES.ENUM,v],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,He],doNotPlayInline:[18,n.TYPES.BOOL],thumbnailDirectPath:[19,n.TYPES.STRING],thumbnailSha256:[20,n.TYPES.BYTES],thumbnailEncSha256:[21,n.TYPES.BYTES],mediaKey:[22,n.TYPES.BYTES],mediaKeyTimestamp:[23,n.TYPES.INT64],thumbnailHeight:[24,n.TYPES.UINT32],thumbnailWidth:[25,n.TYPES.UINT32],inviteLinkGroupType:[26,n.TYPES.ENUM,S]},Be.internalSpec={degreesLatitude:[1,n.TYPES.DOUBLE],degreesLongitude:[2,n.TYPES.DOUBLE],name:[3,n.TYPES.STRING],address:[4,n.TYPES.STRING],url:[5,n.TYPES.STRING],isLive:[6,n.TYPES.BOOL],accuracyInMeters:[7,n.TYPES.UINT32],speedInMps:[8,n.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[9,n.TYPES.UINT32],comment:[11,n.TYPES.STRING],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,He]},Ke.internalSpec={displayName:[1,n.TYPES.STRING],vcard:[16,n.TYPES.STRING],contextInfo:[17,n.TYPES.MESSAGE,He]},Ye.internalSpec={note:[1,n.TYPES.STRING],token:[2,n.TYPES.STRING],attachmentType:[3,n.TYPES.ENUM,A],attachmentMimetype:[4,n.TYPES.STRING],attachmentMediaKey:[5,n.TYPES.BYTES],attachmentMediaKeyTimestamp:[6,n.TYPES.INT64],attachmentFileSha256:[7,n.TYPES.BYTES],attachmentFileEncSha256:[8,n.TYPES.BYTES],attachmentDirectPath:[9,n.TYPES.STRING],attachmentJpegThumbnail:[10,n.TYPES.BYTES]},je.internalSpec={url:[1,n.TYPES.STRING],mimetype:[2,n.TYPES.STRING],caption:[3,n.TYPES.STRING],fileSha256:[4,n.TYPES.BYTES],fileLength:[5,n.TYPES.UINT64],height:[6,n.TYPES.UINT32],width:[7,n.TYPES.UINT32],mediaKey:[8,n.TYPES.BYTES],fileEncSha256:[9,n.TYPES.BYTES],interactiveAnnotations:[10,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Je],directPath:[11,n.TYPES.STRING],mediaKeyTimestamp:[12,n.TYPES.INT64],jpegThumbnail:[16,n.TYPES.BYTES],contextInfo:[17,n.TYPES.MESSAGE,He],firstScanSidecar:[18,n.TYPES.BYTES],firstScanLength:[19,n.TYPES.UINT32],experimentGroupId:[20,n.TYPES.UINT32],scansSidecar:[21,n.TYPES.BYTES],scanLengths:[22,n.FLAGS.REPEATED|n.TYPES.UINT32],midQualityFileSha256:[23,n.TYPES.BYTES],midQualityFileEncSha256:[24,n.TYPES.BYTES],viewOnce:[25,n.TYPES.BOOL],thumbnailDirectPath:[26,n.TYPES.STRING],thumbnailSha256:[27,n.TYPES.BYTES],thumbnailEncSha256:[28,n.TYPES.BYTES],staticUrl:[29,n.TYPES.STRING]},We.internalSpec={groupId:[1,n.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,n.TYPES.BYTES]},He.internalSpec={stanzaId:[1,n.TYPES.STRING],participant:[2,n.TYPES.STRING],quotedMessage:[3,n.TYPES.MESSAGE,O],remoteJid:[4,n.TYPES.STRING],mentionedJid:[15,n.FLAGS.REPEATED|n.TYPES.STRING],conversionSource:[18,n.TYPES.STRING],conversionData:[19,n.TYPES.BYTES],conversionDelaySeconds:[20,n.TYPES.UINT32],forwardingScore:[21,n.TYPES.UINT32],isForwarded:[22,n.TYPES.BOOL],quotedAd:[23,n.TYPES.MESSAGE,$e],placeholderKey:[24,n.TYPES.MESSAGE,i.MessageKeySpec],expiration:[25,n.TYPES.UINT32],ephemeralSettingTimestamp:[26,n.TYPES.INT64],ephemeralSharedSecret:[27,n.TYPES.BYTES],externalAdReply:[28,n.TYPES.MESSAGE,Ve],entryPointConversionSource:[29,n.TYPES.STRING],entryPointConversionApp:[30,n.TYPES.STRING],entryPointConversionDelaySeconds:[31,n.TYPES.UINT32],disappearingMode:[32,n.TYPES.MESSAGE,dt],actionLink:[33,n.TYPES.MESSAGE,ut],groupSubject:[34,n.TYPES.STRING],parentGroupJid:[35,n.TYPES.STRING]},Ve.internalSpec={title:[1,n.TYPES.STRING],body:[2,n.TYPES.STRING],mediaType:[3,n.TYPES.ENUM,C],thumbnailUrl:[4,n.TYPES.STRING],mediaUrl:[5,n.TYPES.STRING],thumbnail:[6,n.TYPES.BYTES],sourceType:[7,n.TYPES.STRING],sourceId:[8,n.TYPES.STRING],sourceUrl:[9,n.TYPES.STRING],containsAutoReply:[10,n.TYPES.BOOL]},$e.internalSpec={advertiserName:[1,n.TYPES.STRING],mediaType:[2,n.TYPES.ENUM,b],jpegThumbnail:[16,n.TYPES.BYTES],caption:[17,n.TYPES.STRING]},ze.internalSpec={deviceListMetadata:[1,n.TYPES.MESSAGE,qe],deviceListMetadataVersion:[2,n.TYPES.INT32]},qe.internalSpec={senderKeyHash:[1,n.TYPES.BYTES],senderTimestamp:[2,n.TYPES.UINT64],senderKeyIndexes:[3,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32],recipientKeyHash:[8,n.TYPES.BYTES],recipientTimestamp:[9,n.TYPES.UINT64],recipientKeyIndexes:[10,n.FLAGS.REPEATED|n.FLAGS.PACKED|n.TYPES.UINT32]},Je.internalSpec={polygonVertices:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,Qe],location:[2,n.TYPES.MESSAGE,Xe],__oneofs__:{action:["location"]}},Qe.internalSpec={xDeprecated:[1,n.TYPES.INT32],yDeprecated:[2,n.TYPES.INT32],x:[3,n.TYPES.DOUBLE],y:[4,n.TYPES.DOUBLE]},Xe.internalSpec={degreesLatitude:[1,n.TYPES.DOUBLE],degreesLongitude:[2,n.TYPES.DOUBLE],name:[3,n.TYPES.STRING]},Ze.internalSpec={quickReplyButton:[1,n.TYPES.MESSAGE,rt],urlButton:[2,n.TYPES.MESSAGE,tt],callButton:[3,n.TYPES.MESSAGE,et],index:[4,n.TYPES.UINT32],__oneofs__:{button:["quickReplyButton","urlButton","callButton"]}},et.internalSpec={displayText:[1,n.TYPES.MESSAGE,ge],phoneNumber:[2,n.TYPES.MESSAGE,ge]},tt.internalSpec={displayText:[1,n.TYPES.MESSAGE,ge],url:[2,n.TYPES.MESSAGE,ge]},rt.internalSpec={displayText:[1,n.TYPES.MESSAGE,ge],id:[2,n.TYPES.STRING]},nt.internalSpec={quickReplyButton:[1,n.TYPES.MESSAGE,st],urlButton:[2,n.TYPES.MESSAGE,at],callButton:[3,n.TYPES.MESSAGE,it],index:[4,n.TYPES.UINT32],__oneofs__:{hydratedButton:["quickReplyButton","urlButton","callButton"]}},it.internalSpec={displayText:[1,n.TYPES.STRING],phoneNumber:[2,n.TYPES.STRING]},at.internalSpec={displayText:[1,n.TYPES.STRING],url:[2,n.TYPES.STRING]},st.internalSpec={displayText:[1,n.TYPES.STRING],id:[2,n.TYPES.STRING]},ot.internalSpec={value:[1,n.TYPES.INT64],offset:[2,n.TYPES.UINT32],currencyCode:[3,n.TYPES.STRING]},lt.internalSpec={id:[1,n.TYPES.STRING],fileLength:[2,n.TYPES.UINT64],width:[3,n.TYPES.UINT32],height:[4,n.TYPES.UINT32],mimetype:[5,n.TYPES.STRING],placeholderArgb:[6,n.TYPES.FIXED32],textArgb:[7,n.TYPES.FIXED32],subtextArgb:[8,n.TYPES.FIXED32],mediaData:[9,n.TYPES.MESSAGE,ct],type:[10,n.TYPES.ENUM,P]},ct.internalSpec={mediaKey:[1,n.TYPES.BYTES],mediaKeyTimestamp:[2,n.TYPES.INT64],fileSha256:[3,n.TYPES.BYTES],fileEncSha256:[4,n.TYPES.BYTES],directPath:[5,n.TYPES.STRING]},dt.internalSpec={initiator:[1,n.TYPES.ENUM,M]},ut.internalSpec={url:[1,n.TYPES.STRING],buttonTitle:[2,n.TYPES.STRING]}},28286:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EphemeralSettingSpec=void 0;var n=r(1390);const i={};t.EphemeralSettingSpec=i,i.internalSpec={duration:[1,n.TYPES.SFIXED32],timestamp:[2,n.TYPES.SFIXED64]}},73027:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WallpaperSettingsSpec=t.PushnameSpec=t.MediaVisibility=t.HistorySyncSpec=t.HistorySyncMsgSpec=t.HistorySyncHistorySyncType=t.GroupParticipantSpec=t.GroupParticipantRank=t.GlobalSettingsSpec=t.ConversationSpec=t.ConversationEndOfHistoryTransferType=void 0;var n=r(1390),i=r(21224),a=r(24808);const s=r(54302)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4});t.HistorySyncHistorySyncType=s;const o=r(54302)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1});t.ConversationEndOfHistoryTransferType=o;const l=r(54302)({REGULAR:0,ADMIN:1,SUPERADMIN:2});t.GroupParticipantRank=l;const c=r(54302)({DEFAULT:0,OFF:1,ON:2});t.MediaVisibility=c;const d={};t.HistorySyncSpec=d;const u={};t.ConversationSpec=u;const p={};t.HistorySyncMsgSpec=p;const h={};t.PushnameSpec=h;const f={};t.GroupParticipantSpec=f;const _={};t.WallpaperSettingsSpec=_;const m={};t.GlobalSettingsSpec=m,d.internalSpec={syncType:[1,n.FLAGS.REQUIRED|n.TYPES.ENUM,s],conversations:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,u],statusV3Messages:[3,n.FLAGS.REPEATED|n.TYPES.MESSAGE,i.WebMessageInfoSpec],chunkOrder:[5,n.TYPES.UINT32],progress:[6,n.TYPES.UINT32],pushnames:[7,n.FLAGS.REPEATED|n.TYPES.MESSAGE,h],globalSettings:[8,n.TYPES.MESSAGE,m],threadIdUserSecret:[9,n.TYPES.BYTES],threadDsTimeframeOffset:[10,n.TYPES.UINT32]},u.internalSpec={id:[1,n.FLAGS.REQUIRED|n.TYPES.STRING],messages:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,p],newJid:[3,n.TYPES.STRING],oldJid:[4,n.TYPES.STRING],lastMsgTimestamp:[5,n.TYPES.UINT64],unreadCount:[6,n.TYPES.UINT32],readOnly:[7,n.TYPES.BOOL],endOfHistoryTransfer:[8,n.TYPES.BOOL],ephemeralExpiration:[9,n.TYPES.UINT32],ephemeralSettingTimestamp:[10,n.TYPES.INT64],endOfHistoryTransferType:[11,n.TYPES.ENUM,o],conversationTimestamp:[12,n.TYPES.UINT64],name:[13,n.TYPES.STRING],pHash:[14,n.TYPES.STRING],notSpam:[15,n.TYPES.BOOL],archived:[16,n.TYPES.BOOL],disappearingMode:[17,n.TYPES.MESSAGE,a.DisappearingModeSpec],unreadMentionCount:[18,n.TYPES.UINT32],markedAsUnread:[19,n.TYPES.BOOL],participant:[20,n.FLAGS.REPEATED|n.TYPES.MESSAGE,f],tcToken:[21,n.TYPES.BYTES],tcTokenTimestamp:[22,n.TYPES.UINT64],contactPrimaryIdentityKey:[23,n.TYPES.BYTES],pinned:[24,n.TYPES.UINT32],muteEndTime:[25,n.TYPES.UINT64],wallpaper:[26,n.TYPES.MESSAGE,_],mediaVisibility:[27,n.TYPES.ENUM,c],tcTokenSenderTimestamp:[28,n.TYPES.UINT64],suspended:[29,n.TYPES.BOOL]},p.internalSpec={message:[1,n.TYPES.MESSAGE,i.WebMessageInfoSpec],msgOrderId:[2,n.TYPES.UINT64]},h.internalSpec={id:[1,n.TYPES.STRING],pushname:[2,n.TYPES.STRING]},f.internalSpec={userJid:[1,n.FLAGS.REQUIRED|n.TYPES.STRING],rank:[2,n.TYPES.ENUM,l]},_.internalSpec={filename:[1,n.TYPES.STRING],opacity:[2,n.TYPES.UINT32]},m.internalSpec={lightThemeWallpaper:[1,n.TYPES.MESSAGE,_],mediaVisibility:[2,n.TYPES.ENUM,c],darkThemeWallpaper:[3,n.TYPES.MESSAGE,_]}},60946:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgRowOpaqueDataSpec=t.MsgOpaqueDataSpec=void 0;var n=r(1390);const i={};t.MsgRowOpaqueDataSpec=i;const a={};t.MsgOpaqueDataSpec=a,i.internalSpec={currentMsg:[1,n.TYPES.MESSAGE,a],quotedMsg:[2,n.TYPES.MESSAGE,a]},a.internalSpec={body:[1,n.TYPES.STRING],caption:[3,n.TYPES.STRING],lng:[5,n.TYPES.DOUBLE],lat:[7,n.TYPES.DOUBLE],paymentAmount1000:[8,n.TYPES.INT32],paymentNoteMsgBody:[9,n.TYPES.STRING],canonicalUrl:[10,n.TYPES.STRING],matchedText:[11,n.TYPES.STRING],title:[12,n.TYPES.STRING],description:[13,n.TYPES.STRING],futureproofBuffer:[14,n.TYPES.BYTES],clientUrl:[15,n.TYPES.STRING],loc:[16,n.TYPES.STRING]}},16258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerErrorReceiptSpec=t.MediaRetryNotificationSpec=t.MediaRetryNotificationResultType=void 0;var n=r(1390);const i=r(54302)({GENERAL_ERROR:0,SUCCESS:1,NOT_FOUND:2,DECRYPTION_ERROR:3});t.MediaRetryNotificationResultType=i;const a={};t.MediaRetryNotificationSpec=a;const s={};t.ServerErrorReceiptSpec=s,a.internalSpec={stanzaId:[1,n.TYPES.STRING],directPath:[2,n.TYPES.STRING],result:[3,n.TYPES.ENUM,i]},s.internalSpec={stanzaId:[1,n.TYPES.STRING]}},93890:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var n=r(1390);const i={};t.MessageKeySpec=i,i.internalSpec={remoteJid:[1,n.TYPES.STRING],fromMe:[2,n.TYPES.BOOL],id:[3,n.TYPES.STRING],participant:[4,n.TYPES.STRING]}},12492:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionSpec=t.SyncdValueSpec=t.SyncdSnapshotSpec=t.SyncdRecordSpec=t.SyncdPatchSpec=t.SyncdMutationsSpec=t.SyncdMutationSyncdOperation=t.SyncdMutationSpec=t.SyncdIndexSpec=t.KeyIdSpec=t.ExternalBlobReferenceSpec=t.ExitCodeSpec=void 0;var n=r(1390);const i=r(54302)({SET:0,REMOVE:1});t.SyncdMutationSyncdOperation=i;const a={};t.SyncdVersionSpec=a;const s={};t.ExitCodeSpec=s;const o={};t.SyncdIndexSpec=o;const l={};t.SyncdValueSpec=l;const c={};t.KeyIdSpec=c;const d={};t.SyncdRecordSpec=d;const u={};t.ExternalBlobReferenceSpec=u;const p={};t.SyncdSnapshotSpec=p;const h={};t.SyncdMutationsSpec=h;const f={};t.SyncdMutationSpec=f;const _={};t.SyncdPatchSpec=_,a.internalSpec={version:[1,n.TYPES.UINT64]},s.internalSpec={code:[1,n.TYPES.UINT64],text:[2,n.TYPES.STRING]},o.internalSpec={blob:[1,n.TYPES.BYTES]},l.internalSpec={blob:[1,n.TYPES.BYTES]},c.internalSpec={id:[1,n.TYPES.BYTES]},d.internalSpec={index:[1,n.TYPES.MESSAGE,o],value:[2,n.TYPES.MESSAGE,l],keyId:[3,n.TYPES.MESSAGE,c]},u.internalSpec={mediaKey:[1,n.TYPES.BYTES],directPath:[2,n.TYPES.STRING],handle:[3,n.TYPES.STRING],fileSizeBytes:[4,n.TYPES.UINT64],fileSha256:[5,n.TYPES.BYTES],fileEncSha256:[6,n.TYPES.BYTES]},p.internalSpec={version:[1,n.TYPES.MESSAGE,a],records:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,d],mac:[3,n.TYPES.BYTES],keyId:[4,n.TYPES.MESSAGE,c]},h.internalSpec={mutations:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,f]},f.internalSpec={operation:[1,n.TYPES.ENUM,i],record:[2,n.TYPES.MESSAGE,d]},_.internalSpec={version:[1,n.TYPES.MESSAGE,a],mutations:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,f],externalMutations:[3,n.TYPES.MESSAGE,u],snapshotMac:[4,n.TYPES.BYTES],patchMac:[5,n.TYPES.BYTES],keyId:[6,n.TYPES.MESSAGE,c],exitCode:[7,n.TYPES.MESSAGE,s],deviceIndex:[8,n.TYPES.UINT32]}},22701:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnarchiveChatsSettingSpec=t.SyncActionValueSpec=t.SyncActionMessageSpec=t.SyncActionMessageRangeSpec=t.SyncActionDataSpec=t.StarActionSpec=t.SecurityNotificationSettingSpec=t.RecentStickerWeightsActionSpec=t.RecentStickerWeightSpec=t.RecentStickerMetadataSpec=t.RecentEmojiWeightsActionSpec=t.RecentEmojiWeightSpec=t.QuickReplyActionSpec=t.PushNameSettingSpec=t.PrimaryFeatureSpec=t.PinActionSpec=t.MuteActionSpec=t.MarkChatAsReadActionSpec=t.LocaleSettingSpec=t.LabelEditActionSpec=t.LabelAssociationActionSpec=t.KeyExpirationSpec=t.FavoriteStickerActionSpec=t.DeleteMessageForMeActionSpec=t.DeleteChatActionSpec=t.ContactActionSpec=t.ClearChatActionSpec=t.ArchiveChatActionSpec=t.AndroidUnsupportedActionsSpec=void 0;var n=r(1390),i=r(93890);const a={};t.RecentStickerWeightSpec=a;const s={};t.RecentEmojiWeightSpec=s;const o={};t.SyncActionValueSpec=o;const l={};t.AndroidUnsupportedActionsSpec=l;const c={};t.PrimaryFeatureSpec=c;const d={};t.KeyExpirationSpec=d;const u={};t.SyncActionMessageSpec=u;const p={};t.SyncActionMessageRangeSpec=p;const h={};t.UnarchiveChatsSettingSpec=h;const f={};t.DeleteChatActionSpec=f;const _={};t.ClearChatActionSpec=_;const m={};t.MarkChatAsReadActionSpec=m;const g={};t.DeleteMessageForMeActionSpec=g;const y={};t.ArchiveChatActionSpec=y;const E={};t.FavoriteStickerActionSpec=E;const S={};t.RecentEmojiWeightsActionSpec=S;const v={};t.RecentStickerMetadataSpec=v;const T={};t.RecentStickerWeightsActionSpec=T;const A={};t.LabelEditActionSpec=A;const C={};t.LabelAssociationActionSpec=C;const b={};t.QuickReplyActionSpec=b;const P={};t.LocaleSettingSpec=P;const M={};t.PushNameSettingSpec=M;const O={};t.SecurityNotificationSettingSpec=O;const I={};t.PinActionSpec=I;const w={};t.MuteActionSpec=w;const R={};t.ContactActionSpec=R;const D={};t.StarActionSpec=D;const N={};t.SyncActionDataSpec=N,a.internalSpec={filehash:[1,n.TYPES.STRING],weight:[2,n.TYPES.FLOAT]},s.internalSpec={emoji:[1,n.TYPES.STRING],weight:[2,n.TYPES.FLOAT]},o.internalSpec={timestamp:[1,n.TYPES.INT64],starAction:[2,n.TYPES.MESSAGE,D],contactAction:[3,n.TYPES.MESSAGE,R],muteAction:[4,n.TYPES.MESSAGE,w],pinAction:[5,n.TYPES.MESSAGE,I],securityNotificationSetting:[6,n.TYPES.MESSAGE,O],pushNameSetting:[7,n.TYPES.MESSAGE,M],quickReplyAction:[8,n.TYPES.MESSAGE,b],recentStickerWeightsAction:[9,n.TYPES.MESSAGE,T],recentStickerMetadata:[10,n.TYPES.MESSAGE,v],recentEmojiWeightsAction:[11,n.TYPES.MESSAGE,S],labelEditAction:[14,n.TYPES.MESSAGE,A],labelAssociationAction:[15,n.TYPES.MESSAGE,C],localeSetting:[16,n.TYPES.MESSAGE,P],archiveChatAction:[17,n.TYPES.MESSAGE,y],deleteMessageForMeAction:[18,n.TYPES.MESSAGE,g],keyExpiration:[19,n.TYPES.MESSAGE,d],markChatAsReadAction:[20,n.TYPES.MESSAGE,m],clearChatAction:[21,n.TYPES.MESSAGE,_],deleteChatAction:[22,n.TYPES.MESSAGE,f],unarchiveChatsSetting:[23,n.TYPES.MESSAGE,h],primaryFeature:[24,n.TYPES.MESSAGE,c],favoriteStickerAction:[25,n.TYPES.MESSAGE,E],androidUnsupportedActions:[26,n.TYPES.MESSAGE,l]},l.internalSpec={allowed:[1,n.TYPES.BOOL]},c.internalSpec={flags:[1,n.FLAGS.REPEATED|n.TYPES.STRING]},d.internalSpec={expiredKeyEpoch:[1,n.TYPES.INT32]},u.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec],timestamp:[2,n.TYPES.INT64]},p.internalSpec={lastMessageTimestamp:[1,n.TYPES.INT64],lastSystemMessageTimestamp:[2,n.TYPES.INT64],messages:[3,n.FLAGS.REPEATED|n.TYPES.MESSAGE,u]},h.internalSpec={unarchiveChats:[1,n.TYPES.BOOL]},f.internalSpec={messageRange:[1,n.TYPES.MESSAGE,p]},_.internalSpec={messageRange:[1,n.TYPES.MESSAGE,p]},m.internalSpec={read:[1,n.TYPES.BOOL],messageRange:[2,n.TYPES.MESSAGE,p]},g.internalSpec={deleteMedia:[1,n.TYPES.BOOL],messageTimestamp:[2,n.TYPES.INT64]},y.internalSpec={archived:[1,n.TYPES.BOOL],messageRange:[2,n.TYPES.MESSAGE,p]},E.internalSpec={directPath:[1,n.TYPES.STRING],lastUploadTimestamp:[2,n.TYPES.STRING],handle:[3,n.TYPES.STRING],encFilehash:[4,n.TYPES.STRING],stickerHashWithoutMeta:[5,n.TYPES.STRING],mediaKey:[6,n.TYPES.STRING],mediaKeyTimestamp:[7,n.TYPES.INT64],isFavorite:[8,n.TYPES.BOOL]},S.internalSpec={weights:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,s]},v.internalSpec={directPath:[1,n.TYPES.STRING],encFilehash:[2,n.TYPES.STRING],mediaKey:[3,n.TYPES.STRING],stanzaId:[4,n.TYPES.STRING],chatJid:[5,n.TYPES.STRING],participant:[6,n.TYPES.STRING],isSentByMe:[7,n.TYPES.BOOL]},T.internalSpec={weights:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,a]},A.internalSpec={name:[1,n.TYPES.STRING],color:[2,n.TYPES.INT32],predefinedId:[3,n.TYPES.INT32],deleted:[4,n.TYPES.BOOL]},C.internalSpec={labeled:[1,n.TYPES.BOOL]},b.internalSpec={shortcut:[1,n.TYPES.STRING],message:[2,n.TYPES.STRING],keywords:[3,n.FLAGS.REPEATED|n.TYPES.STRING],count:[4,n.TYPES.INT32],deleted:[5,n.TYPES.BOOL]},P.internalSpec={locale:[1,n.TYPES.STRING]},M.internalSpec={name:[1,n.TYPES.STRING]},O.internalSpec={showNotification:[1,n.TYPES.BOOL]},I.internalSpec={pinned:[1,n.TYPES.BOOL]},w.internalSpec={muted:[1,n.TYPES.BOOL],muteEndTimestamp:[2,n.TYPES.INT64]},R.internalSpec={fullName:[1,n.TYPES.STRING],firstName:[2,n.TYPES.STRING]},D.internalSpec={starred:[1,n.TYPES.BOOL]},N.internalSpec={index:[1,n.TYPES.BYTES],value:[2,n.TYPES.MESSAGE,o],padding:[3,n.TYPES.BYTES],version:[4,n.TYPES.INT32]}},91344:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedNameCertificateSpec=t.LocalizedNameSpec=t.DetailsSpec=t.BizIdentityInfoVerifiedLevelValue=t.BizIdentityInfoSpec=t.BizIdentityInfoHostStorageType=t.BizIdentityInfoActualActorsType=t.BizAccountPayloadSpec=t.BizAccountLinkInfoSpec=t.BizAccountLinkInfoHostStorageType=t.BizAccountLinkInfoAccountType=void 0;var n=r(1390);const i=r(54302)({ENTERPRISE:0});t.BizAccountLinkInfoAccountType=i;const a=r(54302)({ON_PREMISE:0,FACEBOOK:1});t.BizAccountLinkInfoHostStorageType=a;const s=r(54302)({SELF:0,BSP:1});t.BizIdentityInfoActualActorsType=s;const o=r(54302)({ON_PREMISE:0,FACEBOOK:1});t.BizIdentityInfoHostStorageType=o;const l=r(54302)({UNKNOWN:0,LOW:1,HIGH:2});t.BizIdentityInfoVerifiedLevelValue=l;const c={};t.LocalizedNameSpec=c;const d={};t.VerifiedNameCertificateSpec=d;const u={};t.DetailsSpec=u;const p={};t.BizAccountPayloadSpec=p;const h={};t.BizAccountLinkInfoSpec=h;const f={};t.BizIdentityInfoSpec=f,c.internalSpec={lg:[1,n.TYPES.STRING],lc:[2,n.TYPES.STRING],verifiedName:[3,n.TYPES.STRING]},d.internalSpec={details:[1,n.TYPES.BYTES],signature:[2,n.TYPES.BYTES],serverSignature:[3,n.TYPES.BYTES]},u.internalSpec={serial:[1,n.TYPES.UINT64],issuer:[2,n.TYPES.STRING],verifiedName:[4,n.TYPES.STRING],localizedNames:[8,n.FLAGS.REPEATED|n.TYPES.MESSAGE,c],issueTime:[10,n.TYPES.UINT64]},p.internalSpec={vnameCert:[1,n.TYPES.MESSAGE,d],bizAcctLinkInfo:[2,n.TYPES.BYTES]},h.internalSpec={whatsappBizAcctFbid:[1,n.TYPES.UINT64],whatsappAcctNumber:[2,n.TYPES.STRING],issueTime:[3,n.TYPES.UINT64],hostStorage:[4,n.TYPES.ENUM,a],accountType:[5,n.TYPES.ENUM,i]},f.internalSpec={vlevel:[1,n.TYPES.ENUM,l],vnameCert:[2,n.TYPES.MESSAGE,d],signed:[3,n.TYPES.BOOL],revoked:[4,n.TYPES.BOOL],hostStorage:[5,n.TYPES.ENUM,o],actualActors:[6,n.TYPES.ENUM,s],privacyModeTs:[7,n.TYPES.UINT64],featureControls:[8,n.TYPES.UINT64]}},84331:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebdPayloadSpec=t.WebInfoWebSubPlatform=t.WebInfoSpec=t.UserAgentSpec=t.UserAgentReleaseChannel=t.UserAgentPlatform=t.ServerHelloSpec=t.NoiseCertificateSpec=t.HandshakeMessageSpec=t.DetailsSpec=t.DNSSourceSpec=t.DNSSourceDNSResolutionMethod=t.CompanionRegDataSpec=t.ClientPayloadSpec=t.ClientPayloadProduct=t.ClientPayloadIOSAppExtension=t.ClientPayloadConnectType=t.ClientPayloadConnectReason=t.ClientHelloSpec=t.ClientFinishSpec=t.AppVersionSpec=void 0;var n=r(1390);const i=r(54302)({WHATSAPP:0,MESSENGER:1});t.ClientPayloadProduct=i;const a=r(54302)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.DNSSourceDNSResolutionMethod=a;const s=r(54302)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayloadConnectType=s;const o=r(54302)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayloadConnectReason=o;const l=r(54302)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayloadIOSAppExtension=l;const c=r(54302)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.WebInfoWebSubPlatform=c;const d=r(54302)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.UserAgentReleaseChannel=d;const u=r(54302)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.UserAgentPlatform=u;const p={};t.HandshakeMessageSpec=p;const h={};t.ClientFinishSpec=h;const f={};t.ServerHelloSpec=f;const _={};t.ClientHelloSpec=_;const m={};t.NoiseCertificateSpec=m;const g={};t.DetailsSpec=g;const y={};t.ClientPayloadSpec=y;const E={};t.CompanionRegDataSpec=E;const S={};t.DNSSourceSpec=S;const v={};t.WebInfoSpec=v;const T={};t.WebdPayloadSpec=T;const A={};t.UserAgentSpec=A;const C={};t.AppVersionSpec=C,p.internalSpec={clientHello:[2,n.TYPES.MESSAGE,_],serverHello:[3,n.TYPES.MESSAGE,f],clientFinish:[4,n.TYPES.MESSAGE,h]},h.internalSpec={static:[1,n.TYPES.BYTES],payload:[2,n.TYPES.BYTES]},f.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},_.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},m.internalSpec={details:[1,n.TYPES.BYTES],signature:[2,n.TYPES.BYTES]},g.internalSpec={serial:[1,n.TYPES.UINT32],issuer:[2,n.TYPES.STRING],expires:[3,n.TYPES.UINT64],subject:[4,n.TYPES.STRING],key:[5,n.TYPES.BYTES]},y.internalSpec={username:[1,n.TYPES.UINT64],passive:[3,n.TYPES.BOOL],userAgent:[5,n.TYPES.MESSAGE,A],webInfo:[6,n.TYPES.MESSAGE,v],pushName:[7,n.TYPES.STRING],sessionId:[9,n.TYPES.SFIXED32],shortConnect:[10,n.TYPES.BOOL],connectType:[12,n.TYPES.ENUM,s],connectReason:[13,n.TYPES.ENUM,o],shards:[14,n.FLAGS.REPEATED|n.TYPES.INT32],dnsSource:[15,n.TYPES.MESSAGE,S],connectAttemptCount:[16,n.TYPES.UINT32],device:[18,n.TYPES.UINT32],regData:[19,n.TYPES.MESSAGE,E],product:[20,n.TYPES.ENUM,i],fbCat:[21,n.TYPES.BYTES],fbUserAgent:[22,n.TYPES.BYTES],oc:[23,n.TYPES.BOOL],lc:[24,n.TYPES.INT32],iosAppExtension:[30,n.TYPES.ENUM,l],fbAppId:[31,n.TYPES.UINT64],fbDeviceId:[32,n.TYPES.BYTES]},E.internalSpec={eRegid:[1,n.TYPES.BYTES],eKeytype:[2,n.TYPES.BYTES],eIdent:[3,n.TYPES.BYTES],eSkeyId:[4,n.TYPES.BYTES],eSkeyVal:[5,n.TYPES.BYTES],eSkeySig:[6,n.TYPES.BYTES],buildHash:[7,n.TYPES.BYTES],companionProps:[8,n.TYPES.BYTES]},S.internalSpec={dnsMethod:[15,n.TYPES.ENUM,a],appCached:[16,n.TYPES.BOOL]},v.internalSpec={refToken:[1,n.TYPES.STRING],version:[2,n.TYPES.STRING],webdPayload:[3,n.TYPES.MESSAGE,T],webSubPlatform:[4,n.TYPES.ENUM,c]},T.internalSpec={usesParticipantInKey:[1,n.TYPES.BOOL],supportsStarredMessages:[2,n.TYPES.BOOL],supportsDocumentMessages:[3,n.TYPES.BOOL],supportsUrlMessages:[4,n.TYPES.BOOL],supportsMediaRetry:[5,n.TYPES.BOOL],supportsE2EImage:[6,n.TYPES.BOOL],supportsE2EVideo:[7,n.TYPES.BOOL],supportsE2EAudio:[8,n.TYPES.BOOL],supportsE2EDocument:[9,n.TYPES.BOOL],documentTypes:[10,n.TYPES.STRING],features:[11,n.TYPES.BYTES]},A.internalSpec={platform:[1,n.TYPES.ENUM,u],appVersion:[2,n.TYPES.MESSAGE,C],mcc:[3,n.TYPES.STRING],mnc:[4,n.TYPES.STRING],osVersion:[5,n.TYPES.STRING],manufacturer:[6,n.TYPES.STRING],device:[7,n.TYPES.STRING],osBuildNumber:[8,n.TYPES.STRING],phoneId:[9,n.TYPES.STRING],releaseChannel:[10,n.TYPES.ENUM,d],localeLanguageIso6391:[11,n.TYPES.STRING],localeCountryIso31661Alpha2:[12,n.TYPES.STRING],deviceBoard:[13,n.TYPES.STRING]},C.internalSpec={primary:[1,n.TYPES.UINT32],secondary:[2,n.TYPES.UINT32],tertiary:[3,n.TYPES.UINT32],quaternary:[4,n.TYPES.UINT32],quinary:[5,n.TYPES.UINT32]}},78155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebdPayloadSpec=t.WebInfoWebSubPlatform=t.WebInfoSpec=t.UserAgentSpec=t.UserAgentReleaseChannel=t.UserAgentPlatform=t.ServerHelloSpec=t.NoiseCertificateSpec=t.HandshakeMessageSpec=t.DetailsSpec=t.DNSSourceSpec=t.DNSSourceDNSResolutionMethod=t.CompanionRegDataSpec=t.ClientPayloadSpec=t.ClientPayloadProduct=t.ClientPayloadIOSAppExtension=t.ClientPayloadConnectType=t.ClientPayloadConnectReason=t.ClientHelloSpec=t.ClientFinishSpec=t.CertChainSpec=t.AppVersionSpec=void 0;var n=r(1390);const i=r(54302)({WHATSAPP:0,MESSENGER:1});t.ClientPayloadProduct=i;const a=r(54302)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.DNSSourceDNSResolutionMethod=a;const s=r(54302)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayloadConnectType=s;const o=r(54302)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayloadConnectReason=o;const l=r(54302)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayloadIOSAppExtension=l;const c=r(54302)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.WebInfoWebSubPlatform=c;const d=r(54302)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.UserAgentReleaseChannel=d;const u=r(54302)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.UserAgentPlatform=u;const p={};t.HandshakeMessageSpec=p;const h={};t.ClientFinishSpec=h;const f={};t.ServerHelloSpec=f;const _={};t.ClientHelloSpec=_;const m={};t.CertChainSpec=m;const g={};t.NoiseCertificateSpec=g;const y={};t.DetailsSpec=y;const E={};t.ClientPayloadSpec=E;const S={};t.CompanionRegDataSpec=S;const v={};t.DNSSourceSpec=v;const T={};t.WebInfoSpec=T;const A={};t.WebdPayloadSpec=A;const C={};t.UserAgentSpec=C;const b={};t.AppVersionSpec=b,p.internalSpec={clientHello:[2,n.TYPES.MESSAGE,_],serverHello:[3,n.TYPES.MESSAGE,f],clientFinish:[4,n.TYPES.MESSAGE,h]},h.internalSpec={static:[1,n.TYPES.BYTES],payload:[2,n.TYPES.BYTES]},f.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},_.internalSpec={ephemeral:[1,n.TYPES.BYTES],static:[2,n.TYPES.BYTES],payload:[3,n.TYPES.BYTES]},m.internalSpec={leaf:[1,n.TYPES.MESSAGE,g],intermediate:[2,n.TYPES.MESSAGE,g]},g.internalSpec={details:[1,n.TYPES.BYTES],signature:[2,n.TYPES.BYTES]},y.internalSpec={serial:[1,n.TYPES.UINT32],issuerSerial:[2,n.TYPES.UINT32],key:[3,n.TYPES.BYTES],notBefore:[4,n.TYPES.UINT64],notAfter:[5,n.TYPES.UINT64]},E.internalSpec={username:[1,n.TYPES.UINT64],passive:[3,n.TYPES.BOOL],userAgent:[5,n.TYPES.MESSAGE,C],webInfo:[6,n.TYPES.MESSAGE,T],pushName:[7,n.TYPES.STRING],sessionId:[9,n.TYPES.SFIXED32],shortConnect:[10,n.TYPES.BOOL],connectType:[12,n.TYPES.ENUM,s],connectReason:[13,n.TYPES.ENUM,o],shards:[14,n.FLAGS.REPEATED|n.TYPES.INT32],dnsSource:[15,n.TYPES.MESSAGE,v],connectAttemptCount:[16,n.TYPES.UINT32],device:[18,n.TYPES.UINT32],regData:[19,n.TYPES.MESSAGE,S],product:[20,n.TYPES.ENUM,i],fbCat:[21,n.TYPES.BYTES],fbUserAgent:[22,n.TYPES.BYTES],oc:[23,n.TYPES.BOOL],lc:[24,n.TYPES.INT32],iosAppExtension:[30,n.TYPES.ENUM,l],fbAppId:[31,n.TYPES.UINT64],fbDeviceId:[32,n.TYPES.BYTES]},S.internalSpec={eRegid:[1,n.TYPES.BYTES],eKeytype:[2,n.TYPES.BYTES],eIdent:[3,n.TYPES.BYTES],eSkeyId:[4,n.TYPES.BYTES],eSkeyVal:[5,n.TYPES.BYTES],eSkeySig:[6,n.TYPES.BYTES],buildHash:[7,n.TYPES.BYTES],companionProps:[8,n.TYPES.BYTES]},v.internalSpec={dnsMethod:[15,n.TYPES.ENUM,a],appCached:[16,n.TYPES.BOOL]},T.internalSpec={refToken:[1,n.TYPES.STRING],version:[2,n.TYPES.STRING],webdPayload:[3,n.TYPES.MESSAGE,A],webSubPlatform:[4,n.TYPES.ENUM,c]},A.internalSpec={usesParticipantInKey:[1,n.TYPES.BOOL],supportsStarredMessages:[2,n.TYPES.BOOL],supportsDocumentMessages:[3,n.TYPES.BOOL],supportsUrlMessages:[4,n.TYPES.BOOL],supportsMediaRetry:[5,n.TYPES.BOOL],supportsE2EImage:[6,n.TYPES.BOOL],supportsE2EVideo:[7,n.TYPES.BOOL],supportsE2EAudio:[8,n.TYPES.BOOL],supportsE2EDocument:[9,n.TYPES.BOOL],documentTypes:[10,n.TYPES.STRING],features:[11,n.TYPES.BYTES]},C.internalSpec={platform:[1,n.TYPES.ENUM,u],appVersion:[2,n.TYPES.MESSAGE,b],mcc:[3,n.TYPES.STRING],mnc:[4,n.TYPES.STRING],osVersion:[5,n.TYPES.STRING],manufacturer:[6,n.TYPES.STRING],device:[7,n.TYPES.STRING],osBuildNumber:[8,n.TYPES.STRING],phoneId:[9,n.TYPES.STRING],releaseChannel:[10,n.TYPES.ENUM,d],localeLanguageIso6391:[11,n.TYPES.STRING],localeCountryIso31661Alpha2:[12,n.TYPES.STRING],deviceBoard:[13,n.TYPES.STRING]},b.internalSpec={primary:[1,n.TYPES.UINT32],secondary:[2,n.TYPES.UINT32],tertiary:[3,n.TYPES.UINT32],quaternary:[4,n.TYPES.UINT32],quinary:[5,n.TYPES.UINT32]}},21224:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebNotificationsInfoSpec=t.WebMessageInfoStubType=t.WebMessageInfoStatus=t.WebMessageInfoSpec=t.WebMessageInfoBizPrivacyStatus=t.WebFeaturesSpec=t.WebFeaturesFlag=t.UserReceiptSpec=t.StatusPSASpec=t.ReactionSpec=t.PhotoChangeSpec=t.PaymentInfoTxnStatus=t.PaymentInfoStatus=t.PaymentInfoSpec=t.PaymentInfoCurrency=t.NotificationMessageInfoSpec=t.MediaDataSpec=void 0;var n=r(1390),i=r(24808),a=r(93890);const s=r(54302)({E2EE:0,FB:2,BSP:1,BSP_AND_FB:3});t.WebMessageInfoBizPrivacyStatus=s;const o=r(54302)({UNKNOWN:0,REVOKE:1,CIPHERTEXT:2,FUTUREPROOF:3,NON_VERIFIED_TRANSITION:4,UNVERIFIED_TRANSITION:5,VERIFIED_TRANSITION:6,VERIFIED_LOW_UNKNOWN:7,VERIFIED_HIGH:8,VERIFIED_INITIAL_UNKNOWN:9,VERIFIED_INITIAL_LOW:10,VERIFIED_INITIAL_HIGH:11,VERIFIED_TRANSITION_ANY_TO_NONE:12,VERIFIED_TRANSITION_ANY_TO_HIGH:13,VERIFIED_TRANSITION_HIGH_TO_LOW:14,VERIFIED_TRANSITION_HIGH_TO_UNKNOWN:15,VERIFIED_TRANSITION_UNKNOWN_TO_LOW:16,VERIFIED_TRANSITION_LOW_TO_UNKNOWN:17,VERIFIED_TRANSITION_NONE_TO_LOW:18,VERIFIED_TRANSITION_NONE_TO_UNKNOWN:19,GROUP_CREATE:20,GROUP_CHANGE_SUBJECT:21,GROUP_CHANGE_ICON:22,GROUP_CHANGE_INVITE_LINK:23,GROUP_CHANGE_DESCRIPTION:24,GROUP_CHANGE_RESTRICT:25,GROUP_CHANGE_ANNOUNCE:26,GROUP_PARTICIPANT_ADD:27,GROUP_PARTICIPANT_REMOVE:28,GROUP_PARTICIPANT_PROMOTE:29,GROUP_PARTICIPANT_DEMOTE:30,GROUP_PARTICIPANT_INVITE:31,GROUP_PARTICIPANT_LEAVE:32,GROUP_PARTICIPANT_CHANGE_NUMBER:33,BROADCAST_CREATE:34,BROADCAST_ADD:35,BROADCAST_REMOVE:36,GENERIC_NOTIFICATION:37,E2E_IDENTITY_CHANGED:38,E2E_ENCRYPTED:39,CALL_MISSED_VOICE:40,CALL_MISSED_VIDEO:41,INDIVIDUAL_CHANGE_NUMBER:42,GROUP_DELETE:43,GROUP_ANNOUNCE_MODE_MESSAGE_BOUNCE:44,CALL_MISSED_GROUP_VOICE:45,CALL_MISSED_GROUP_VIDEO:46,PAYMENT_CIPHERTEXT:47,PAYMENT_FUTUREPROOF:48,PAYMENT_TRANSACTION_STATUS_UPDATE_FAILED:49,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUNDED:50,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUND_FAILED:51,PAYMENT_TRANSACTION_STATUS_RECEIVER_PENDING_SETUP:52,PAYMENT_TRANSACTION_STATUS_RECEIVER_SUCCESS_AFTER_HICCUP:53,PAYMENT_ACTION_ACCOUNT_SETUP_REMINDER:54,PAYMENT_ACTION_SEND_PAYMENT_REMINDER:55,PAYMENT_ACTION_SEND_PAYMENT_INVITATION:56,PAYMENT_ACTION_REQUEST_DECLINED:57,PAYMENT_ACTION_REQUEST_EXPIRED:58,PAYMENT_ACTION_REQUEST_CANCELLED:59,BIZ_VERIFIED_TRANSITION_TOP_TO_BOTTOM:60,BIZ_VERIFIED_TRANSITION_BOTTOM_TO_TOP:61,BIZ_INTRO_TOP:62,BIZ_INTRO_BOTTOM:63,BIZ_NAME_CHANGE:64,BIZ_MOVE_TO_CONSUMER_APP:65,BIZ_TWO_TIER_MIGRATION_TOP:66,BIZ_TWO_TIER_MIGRATION_BOTTOM:67,OVERSIZED:68,GROUP_CHANGE_NO_FREQUENTLY_FORWARDED:69,GROUP_V4_ADD_INVITE_SENT:70,GROUP_PARTICIPANT_ADD_REQUEST_JOIN:71,CHANGE_EPHEMERAL_SETTING:72,E2E_DEVICE_CHANGED:73,VIEWED_ONCE:74,E2E_ENCRYPTED_NOW:75,BLUE_MSG_BSP_FB_TO_BSP_PREMISE:76,BLUE_MSG_BSP_FB_TO_SELF_FB:77,BLUE_MSG_BSP_FB_TO_SELF_PREMISE:78,BLUE_MSG_BSP_FB_UNVERIFIED:79,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:80,BLUE_MSG_BSP_FB_VERIFIED:81,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:82,BLUE_MSG_BSP_PREMISE_TO_SELF_PREMISE:83,BLUE_MSG_BSP_PREMISE_UNVERIFIED:84,BLUE_MSG_BSP_PREMISE_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:85,BLUE_MSG_BSP_PREMISE_VERIFIED:86,BLUE_MSG_BSP_PREMISE_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:87,BLUE_MSG_CONSUMER_TO_BSP_FB_UNVERIFIED:88,BLUE_MSG_CONSUMER_TO_BSP_PREMISE_UNVERIFIED:89,BLUE_MSG_CONSUMER_TO_SELF_FB_UNVERIFIED:90,BLUE_MSG_CONSUMER_TO_SELF_PREMISE_UNVERIFIED:91,BLUE_MSG_SELF_FB_TO_BSP_PREMISE:92,BLUE_MSG_SELF_FB_TO_SELF_PREMISE:93,BLUE_MSG_SELF_FB_UNVERIFIED:94,BLUE_MSG_SELF_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:95,BLUE_MSG_SELF_FB_VERIFIED:96,BLUE_MSG_SELF_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:97,BLUE_MSG_SELF_PREMISE_TO_BSP_PREMISE:98,BLUE_MSG_SELF_PREMISE_UNVERIFIED:99,BLUE_MSG_SELF_PREMISE_VERIFIED:100,BLUE_MSG_TO_BSP_FB:101,BLUE_MSG_TO_CONSUMER:102,BLUE_MSG_TO_SELF_FB:103,BLUE_MSG_UNVERIFIED_TO_BSP_FB_VERIFIED:104,BLUE_MSG_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:105,BLUE_MSG_UNVERIFIED_TO_SELF_FB_VERIFIED:106,BLUE_MSG_UNVERIFIED_TO_VERIFIED:107,BLUE_MSG_VERIFIED_TO_BSP_FB_UNVERIFIED:108,BLUE_MSG_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:109,BLUE_MSG_VERIFIED_TO_SELF_FB_UNVERIFIED:110,BLUE_MSG_VERIFIED_TO_UNVERIFIED:111,BLUE_MSG_BSP_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:112,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_FB_VERIFIED:113,BLUE_MSG_BSP_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:114,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_FB_UNVERIFIED:115,BLUE_MSG_SELF_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:116,BLUE_MSG_SELF_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:117,E2E_IDENTITY_UNAVAILABLE:118,GROUP_CREATING:119,GROUP_CREATE_FAILED:120,GROUP_BOUNCED:121,BLOCK_CONTACT:122,EPHEMERAL_SETTING_NOT_APPLIED:123,SYNC_FAILED:124,SYNCING:125,BIZ_PRIVACY_MODE_INIT_FB:126,BIZ_PRIVACY_MODE_INIT_BSP:127,BIZ_PRIVACY_MODE_TO_FB:128,BIZ_PRIVACY_MODE_TO_BSP:129,DISAPPEARING_MODE:130,E2E_DEVICE_FETCH_FAILED:131,ADMIN_REVOKE:132,GROUP_INVITE_LINK_GROWTH_LOCKED:133});t.WebMessageInfoStubType=o;const l=r(54302)({ERROR:0,PENDING:1,SERVER_ACK:2,DELIVERY_ACK:3,READ:4,PLAYED:5});t.WebMessageInfoStatus=l;const c=r(54302)({UNKNOWN:0,PENDING_SETUP:1,PENDING_RECEIVER_SETUP:2,INIT:3,SUCCESS:4,COMPLETED:5,FAILED:6,FAILED_RISK:7,FAILED_PROCESSING:8,FAILED_RECEIVER_PROCESSING:9,FAILED_DA:10,FAILED_DA_FINAL:11,REFUNDED_TXN:12,REFUND_FAILED:13,REFUND_FAILED_PROCESSING:14,REFUND_FAILED_DA:15,EXPIRED_TXN:16,AUTH_CANCELED:17,AUTH_CANCEL_FAILED_PROCESSING:18,AUTH_CANCEL_FAILED:19,COLLECT_INIT:20,COLLECT_SUCCESS:21,COLLECT_FAILED:22,COLLECT_FAILED_RISK:23,COLLECT_REJECTED:24,COLLECT_EXPIRED:25,COLLECT_CANCELED:26,COLLECT_CANCELLING:27,IN_REVIEW:28});t.PaymentInfoTxnStatus=c;const d=r(54302)({UNKNOWN_STATUS:0,PROCESSING:1,SENT:2,NEED_TO_ACCEPT:3,COMPLETE:4,COULD_NOT_COMPLETE:5,REFUNDED:6,EXPIRED:7,REJECTED:8,CANCELLED:9,WAITING_FOR_PAYER:10,WAITING:11});t.PaymentInfoStatus=d;const u=r(54302)({UNKNOWN_CURRENCY:0,INR:1});t.PaymentInfoCurrency=u;const p=r(54302)({NOT_STARTED:0,FORCE_UPGRADE:1,DEVELOPMENT:2,PRODUCTION:3});t.WebFeaturesFlag=p;const h={};t.WebMessageInfoSpec=h;const f={};t.PaymentInfoSpec=f;const _={};t.WebNotificationsInfoSpec=_;const m={};t.NotificationMessageInfoSpec=m;const g={};t.WebFeaturesSpec=g;const y={};t.MediaDataSpec=y;const E={};t.PhotoChangeSpec=E;const S={};t.StatusPSASpec=S;const v={};t.UserReceiptSpec=v;const T={};t.ReactionSpec=T,h.internalDefaults={status:l.PENDING},h.internalSpec={key:[1,n.FLAGS.REQUIRED|n.TYPES.MESSAGE,a.MessageKeySpec],message:[2,n.TYPES.MESSAGE,i.MessageSpec],messageTimestamp:[3,n.TYPES.UINT64],status:[4,n.TYPES.ENUM,l],participant:[5,n.TYPES.STRING],messageC2STimestamp:[6,n.TYPES.UINT64],ignore:[16,n.TYPES.BOOL],starred:[17,n.TYPES.BOOL],broadcast:[18,n.TYPES.BOOL],pushName:[19,n.TYPES.STRING],mediaCiphertextSha256:[20,n.TYPES.BYTES],multicast:[21,n.TYPES.BOOL],urlText:[22,n.TYPES.BOOL],urlNumber:[23,n.TYPES.BOOL],messageStubType:[24,n.TYPES.ENUM,o],clearMedia:[25,n.TYPES.BOOL],messageStubParameters:[26,n.FLAGS.REPEATED|n.TYPES.STRING],duration:[27,n.TYPES.UINT32],labels:[28,n.FLAGS.REPEATED|n.TYPES.STRING],paymentInfo:[29,n.TYPES.MESSAGE,f],finalLiveLocation:[30,n.TYPES.MESSAGE,i.LiveLocationMessageSpec],quotedPaymentInfo:[31,n.TYPES.MESSAGE,f],ephemeralStartTimestamp:[32,n.TYPES.UINT64],ephemeralDuration:[33,n.TYPES.UINT32],ephemeralOffToOn:[34,n.TYPES.BOOL],ephemeralOutOfSync:[35,n.TYPES.BOOL],bizPrivacyStatus:[36,n.TYPES.ENUM,s],verifiedBizName:[37,n.TYPES.STRING],mediaData:[38,n.TYPES.MESSAGE,y],photoChange:[39,n.TYPES.MESSAGE,E],userReceipt:[40,n.FLAGS.REPEATED|n.TYPES.MESSAGE,v],reactions:[41,n.FLAGS.REPEATED|n.TYPES.MESSAGE,T],quotedStickerData:[42,n.TYPES.MESSAGE,y],futureproofData:[43,n.TYPES.BYTES],statusPsa:[44,n.TYPES.MESSAGE,S]},f.internalSpec={currencyDeprecated:[1,n.TYPES.ENUM,u],amount1000:[2,n.TYPES.UINT64],receiverJid:[3,n.TYPES.STRING],status:[4,n.TYPES.ENUM,d],transactionTimestamp:[5,n.TYPES.UINT64],requestMessageKey:[6,n.TYPES.MESSAGE,a.MessageKeySpec],expiryTimestamp:[7,n.TYPES.UINT64],futureproofed:[8,n.TYPES.BOOL],currency:[9,n.TYPES.STRING],txnStatus:[10,n.TYPES.ENUM,c],useNoviFiatFormat:[11,n.TYPES.BOOL],primaryAmount:[12,n.TYPES.MESSAGE,i.MoneySpec],exchangeAmount:[13,n.TYPES.MESSAGE,i.MoneySpec]},_.internalSpec={timestamp:[2,n.TYPES.UINT64],unreadChats:[3,n.TYPES.UINT32],notifyMessageCount:[4,n.TYPES.UINT32],notifyMessages:[5,n.FLAGS.REPEATED|n.TYPES.MESSAGE,h]},m.internalSpec={key:[1,n.TYPES.MESSAGE,a.MessageKeySpec],message:[2,n.TYPES.MESSAGE,i.MessageSpec],messageTimestamp:[3,n.TYPES.UINT64],participant:[4,n.TYPES.STRING]},g.internalSpec={labelsDisplay:[1,n.TYPES.ENUM,p],voipIndividualOutgoing:[2,n.TYPES.ENUM,p],groupsV3:[3,n.TYPES.ENUM,p],groupsV3Create:[4,n.TYPES.ENUM,p],changeNumberV2:[5,n.TYPES.ENUM,p],queryStatusV3Thumbnail:[6,n.TYPES.ENUM,p],liveLocations:[7,n.TYPES.ENUM,p],queryVname:[8,n.TYPES.ENUM,p],voipIndividualIncoming:[9,n.TYPES.ENUM,p],quickRepliesQuery:[10,n.TYPES.ENUM,p],payments:[11,n.TYPES.ENUM,p],stickerPackQuery:[12,n.TYPES.ENUM,p],liveLocationsFinal:[13,n.TYPES.ENUM,p],labelsEdit:[14,n.TYPES.ENUM,p],mediaUpload:[15,n.TYPES.ENUM,p],mediaUploadRichQuickReplies:[18,n.TYPES.ENUM,p],vnameV2:[19,n.TYPES.ENUM,p],videoPlaybackUrl:[20,n.TYPES.ENUM,p],statusRanking:[21,n.TYPES.ENUM,p],voipIndividualVideo:[22,n.TYPES.ENUM,p],thirdPartyStickers:[23,n.TYPES.ENUM,p],frequentlyForwardedSetting:[24,n.TYPES.ENUM,p],groupsV4JoinPermission:[25,n.TYPES.ENUM,p],recentStickers:[26,n.TYPES.ENUM,p],catalog:[27,n.TYPES.ENUM,p],starredStickers:[28,n.TYPES.ENUM,p],voipGroupCall:[29,n.TYPES.ENUM,p],templateMessage:[30,n.TYPES.ENUM,p],templateMessageInteractivity:[31,n.TYPES.ENUM,p],ephemeralMessages:[32,n.TYPES.ENUM,p],e2ENotificationSync:[33,n.TYPES.ENUM,p],recentStickersV2:[34,n.TYPES.ENUM,p],recentStickersV3:[36,n.TYPES.ENUM,p],userNotice:[37,n.TYPES.ENUM,p],support:[39,n.TYPES.ENUM,p],groupUiiCleanup:[40,n.TYPES.ENUM,p],groupDogfoodingInternalOnly:[41,n.TYPES.ENUM,p],settingsSync:[42,n.TYPES.ENUM,p],archiveV2:[43,n.TYPES.ENUM,p],ephemeralAllowGroupMembers:[44,n.TYPES.ENUM,p],ephemeral24HDuration:[45,n.TYPES.ENUM,p],mdForceUpgrade:[46,n.TYPES.ENUM,p],disappearingMode:[47,n.TYPES.ENUM,p],externalMdOptInAvailable:[48,n.TYPES.ENUM,p],noDeleteMessageTimeLimit:[49,n.TYPES.ENUM,p]},y.internalSpec={localPath:[1,n.TYPES.STRING]},E.internalSpec={oldPhoto:[1,n.TYPES.BYTES],newPhoto:[2,n.TYPES.BYTES],newPhotoId:[3,n.TYPES.UINT32]},S.internalSpec={campaignId:[44,n.FLAGS.REQUIRED|n.TYPES.STRING],campaignExpirationTimestamp:[45,n.TYPES.UINT64]},v.internalSpec={userJid:[1,n.FLAGS.REQUIRED|n.TYPES.STRING],receiptTimestamp:[2,n.TYPES.INT64],readTimestamp:[3,n.TYPES.INT64],playedTimestamp:[4,n.TYPES.INT64],pendingDeviceJid:[5,n.FLAGS.REPEATED|n.TYPES.STRING],deliveredDeviceJid:[6,n.FLAGS.REPEATED|n.TYPES.STRING]},T.internalSpec={key:[1,n.TYPES.MESSAGE,a.MessageKeySpec],text:[2,n.TYPES.STRING],groupingKey:[3,n.TYPES.STRING],senderTimestampMs:[4,n.TYPES.INT64],unread:[5,n.TYPES.BOOL]}},19991:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(86945),i=r(64971);var a={isQplEnabled:function(){return(0,n.getABPropConfigValue)("qpl_enabled")},getUploadIntervalInSeconds:function(){return 60*(0,n.getABPropConfigValue)("qpl_upload_delay")},getEventSampling:function(){return(0,n.getABPropConfigValue)("qpl_sampling_as_string")},getInitialUploadDelayInSeconds:function(){return 60*(0,n.getABPropConfigValue)("qpl_initial_upload_delay")},getAbPropKey:function(){return(0,i.getABKey)()||"abkey"}};t.default=a},74152:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=function(e){a?__LOG__(3,void 0,void 0,void 0,["qpl"])`QPL Config has already been initialized`:(s=e,function(){try{let e=s.getEventSampling();0===e.indexOf("json:")&&(e=e.slice(5));const t=JSON.parse(e);t.sampling.forEach((e=>{const t=e[0],r=e[1],n=Math.max(e[2],0);i.set(t,{sampleRate:n,samplingMethod:r})}))}catch(e){(0,n.errorParsingConfig)(e)}}(),a={isQplEnabled:o,uploadInterval:l,getEventDetails:d,uploadDelay:c,getAbPropKey:s.getAbPropKey});return a};var n=r(30433);r(27798);const i=new Map;let a,s;function o(){return s.isQplEnabled()}function l(){return s.getUploadIntervalInSeconds()}function c(){return s.getInitialUploadDelayInSeconds()}function d(e){const t=i.get(e);return t||{sampleRate:0,samplingMethod:1}}},16215:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){return JSON.stringify(e)+"\n"+t.map((function(e){return JSON.stringify((0,i.default)((0,i.default)({},{wa_ab_key2:r}),e))})).join("\n")};var i=n(r(81109))},30433:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.annotationKeyTooLong=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_KEY_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${r}`}).commit()},t.annotationSizeLimitExceeded=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_SIZE_LIMIT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${r}`}).commit()},t.errorParsingConfig=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_PARSING_CONFIG,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.errorUploadingChunk=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_UPLOADING_CHUNK,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.maxPointCountExceeded=function(e,t){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_POINT_COUNT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}`}).commit()},t.maxStorageEventCountReached=function(){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_STORAGE_EVENT_COUNT_REACHED}).commit()},t.pointDataTooLong=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_DATA_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, data: ${r}`}).commit()},t.pointNameTooLong=function(e,t,r){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_NAME_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, pointName: ${r}`}).commit()};var i=n(r(11339));let a=0},37726:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.startQPL=function(){const e=(0,s.config)(i.default);e.isQplEnabled()&&((0,d.start)({isQplEnabled:e.isQplEnabled,sendEvents:t=>(0,o.sendEventsOverNetwork)(t,e.getAbPropKey()),uploadInterval:e.uploadInterval(),startUploadDelay:e.uploadDelay()}),l.QPL.init((e=>{c.QuickLogMarkerId.cast(e.marker_id);return(0,a.add)([e]),Promise.resolve()}),{debug:()=>{},warn:()=>{}},e.getEventDetails,e.isQplEnabled))};var i=n(r(19991)),a=r(63719),s=r(74152),o=r(11675),l=r(48870),c=r(27798),d=r(33994)},92006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markerEnded=function(e,t){const r=`${e}|${t}`;i.delete(r),a.delete(r)},t.validateAnnotations=function(e,t,r){const a=`${e}|${t}`,s=i.get(a)||0;let o=0;function l(r,i){return o+=i,!(o+s>1e3)||((0,n.annotationSizeLimitExceeded)(e,t,r),!1)}function c(r){for(let i=0;i<r.length;i++)return!(r[i].length>50)||((0,n.annotationKeyTooLong)(e,t,r[i]),!1)}if(null==r?void 0:r.bool){const e=Object.keys(r.bool);if(!l("bool",e.length)||!c(e))return!1}if(null==r?void 0:r.int){const e=Object.keys(r.int);if(!l("int",e.length)||!c(e))return!1}if(null==r?void 0:r.double){const e=Object.keys(r.double);if(!l("double",e.length)||!c(e))return!1}if(null==r?void 0:r.bool_array){const e=Object.keys(r.bool_array);for(let t=0;t<e.length;t++)if(!l(e[t],r.bool_array[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.int_array){const e=Object.keys(r.int_array);for(let t=0;t<e.length;t++)if(!l(e[t],r.int_array[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.double_array){const e=Object.keys(r.double_array);for(let t=0;t<e.length;t++)if(!l(e[t],r.double_array[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.string){const e=Object.keys(r.string);for(let t=0;t<e.length;t++)if(!l(e[t],r.string[e[t]].length))return!1;if(!c(e))return!1}if(null==r?void 0:r.string_array){const e=Object.keys(r.string_array);for(let t=0;t<e.length;t++){const n=r.string_array[e[t]];for(let r=0;r<n.length;r++)if(!l(e[t],n[r].length))return!1}if(!c(e))return!1}return i.set(a,s+o),!0},t.validatePoints=function(e,t,r){if(r.length>50)return(0,n.pointNameTooLong)(e,t,r),!1;const i=`${e}|${t}`,s=a.get(i)||0;if(s+1>1e3)return(0,n.maxPointCountExceeded)(e,t),!1;return a.set(i,s+1),!0};var n=r(30433);r(27798);const i=new Map,a=new Map},11675:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendEventsOverNetwork=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(92844),s=n(r(69618)),o=n(r(16215)),l=r(1063),c=r(77591),d=n(r(64386));const u="https://graph.whatsapp.net/wa_qpl_data",p="1063127757113399|745146ffa34413f9dbb5469f5370b7af",h="167028690535322";let f;function _(){return(_=(0,i.default)((function*(e,t){const r=new FormData;r.append("access_token",p),r.append("app_id",h),void 0===f&&(f=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString()),r.append("user_id",f),r.append("upload_time",(0,a.unixTime)().toString()),r.append("batch_info",JSON.stringify({}));const n={app_version:s.default.VERSION_BASE,app_build_number:parseInt(s.default.BUILD_ID,10)||0};r.append("batches[]",(0,l.createFile)([(0,o.default)(n,e,t)],"qpldata.txt"),"qpldata.txt");const i=yield d.default.post(u,r);if(__LOG__(2,void 0,void 0,void 0,["qpl"])`qpl_networkSendEventsOverNetwork, completed XHR`,200!==i.status)throw new c.ServerStatusCodeError(i.status,`Failed call to QPL endpoint: ${u}, response: ${i.responseText}`)}))).apply(this,arguments)}},48870:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogActionType=t.QPLMarkerType=t.QPL=void 0;var i=r(92006),a=n(r(60407)),s=r(27798);let o;const l=r(54302)({SUCCESS:2,FAIL:3,CANCEL:4});t.QuickLogActionType=l;const c=r(54302)({REGULAR:1,USER_FLOW:2});t.QPLMarkerType=c;class d{static clearInstance(){o=null}static init(e,t,r,n){o&&__LOG__(4,void 0,new Error)`QPL already initialized`,o=new a.default({performanceNow:Date.now,moduleLoadTimestamp:Date.now(),logger:t,sendEvent:e,quickLogConfigHelper:{getEventDetails:r,isKillswitchOn:()=>!n()}})}static getInstance(){return o||(__LOG__(3)`Attempt to use QPL logger prior to initialization`,o=new a.default({performanceNow:Date.now,moduleLoadTimestamp:Date.now(),logger:{debug:()=>{},warn:()=>{}},sendEvent:()=>{},quickLogConfigHelper:{getEventDetails:()=>({sampleRate:1,samplingMethod:1}),isKillswitchOn:()=>!0}})),o}static logActiveQplMarkers(){0===d.activeMarkers.size||d.activeMarkers.forEach(((e,t)=>{const r=s.QuickLogMarkerId.getName(t);e<1||__LOG__(3)`QPL [${r}] There are currently ${e} active markers remaining. You need to call markerEnd`}))}static markerStart(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;s.QuickLogMarkerId.getName(e);const n=d.activeMarkers.get(e)||0;n>0&&__LOG__(4,void 0,new Error)`QPL [${s.QuickLogMarkerId.getName(e)}] markerStart is currently opened ${n+1} time(s)`,d.activeMarkers.set(e,n+1),d.getInstance().markerStart(e,r),t&&(0,i.validateAnnotations)(e,r,t)&&d.getInstance().markerAnnotate(e,t,{instanceKey:r})}static markerAnnotate(e,t,r){s.QuickLogMarkerId.getName(e),t&&JSON.stringify(t),r&&JSON.stringify(r),d.tryLogErrorMessage(e,"markerAnnotate"),(0,i.validateAnnotations)(e,(null==r?void 0:r.instanceKey)||0,t)&&d.getInstance().markerAnnotate(e,t,r)}static markerPoint(e,t,r){s.QuickLogMarkerId.getName(e),r&&JSON.stringify(r),d.tryLogErrorMessage(e,"markerPoint"),(0,i.validatePoints)(e,(null==r?void 0:r.instanceKey)||0,t)&&d.getInstance().markerPoint(e,t,r)}static markerEnd(e,t,r){s.QuickLogMarkerId.getName(e),l.getName(t),String(r),d.tryLogErrorMessage(e,"markerEnd"),d.deactivateMarker(e),d.getInstance().markerEnd(e,t,r),(0,i.markerEnded)(e,r||0)}static markerDrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s.QuickLogMarkerId.getName(e),d.tryLogErrorMessage(e,"markerDrop"),d.deactivateMarker(e),d.getInstance().markerDrop(e,t),(0,i.markerEnded)(e,t)}static getActiveMarkerIDs(e){return d.getInstance().getActiveMarkerIDs(e)}static getMarker(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d.getInstance().getMarker(e,t)}static tryLogErrorMessage(e,t){(d.activeMarkers.get(e)||0)<1&&__LOG__(3)`QPL [${s.QuickLogMarkerId.getName(e)}] calling ${t} without a markerStart`}static deactivateMarker(e){const t=d.activeMarkers.get(e)||0,r=Math.max(0,t-1);0===r?d.activeMarkers.delete(e):d.activeMarkers.set(e,r)}}t.QPL=d,d.activeMarkers=new Map},27798:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogMarkerId=void 0;const n=r(54302)({WHATSAPP_COLLECTIONS_MANAGEMENT_VIEW:774768970,WHATSAPP_PRODUCT_APPEAL:774769273,WHATSAPP_CATALOG_CREATE:774769395,WHATSAPP_CATALOG_LOAD_MORE:774769641,WHATSAPP_ORDER_VIEW:774769843,WHATSAPP_PROFILE_VIEW:774770248,WHATSAPP_CATALOG_VIEW:774771408,WHATSAPP_PRODUCT_DELETE:774774122,WHATSAPP_CART_VIEW:774774619,WHATSAPP_CART_ADD:774774794,WHATSAPP_PROFILE_SAVE:774775117,WHATSAPP_PRODUCT_VIEW:774775607,WHATSAPP_COLLECTION_APPEAL:774776895,WHATSAPP_PLM_DETAILS_VIEW:774777097,WHATSAPP_COLLECTION_EDIT:774777483,WHATSAPP_ORDER_CREATE:774777518,WHATSAPP_PROFILE_CATS_VIEW:774777556,WHATSAPP_PRODUCT_SET_VISIBLE:774778628,WHATSAPP_PRODUCT_IMAGES_LOAD:774778674,WHATSAPP_PRODUCT_SAVE:774779113,WHATSAPP_PRODUCT_MESSAGE_SEND:774779800,WHATSAPP_COLLECTION_VIEW_ALL:774780089,WHATSAPP_CATALOG_COLLECTIONS_VIEW:774781666,WHATSAPP_PRODUCT_REPORT:774782053,WHATSAPP_COLLECTION_RENAME:774782934,WHATSAPP_WEB_TEST_EVENT:891422769});t.QuickLogMarkerId=n},33994:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(13959),s=r(63719),o=r(91903),l=r(30433),c=r(77591);const d={minTimeout:1e3,maxTimeout:1e4,retries:5,signal:(new AbortController).signal},u=100,p=4,h=6e4,f=9e5;let _;function m(){return(m=(0,i.default)((function*(e){var t,r,n,i,s;_||(_={sendEvents:e.sendEvents,isQplEnabled:e.isQplEnabled,startUploadDelay:1e3*(null!==(t=e.startUploadDelay)&&void 0!==t?t:300),uploadInterval:1e3*(null!==(r=e.uploadInterval)&&void 0!==r?r:86400),uploadRetryDelayMin:1e3*(null!==(n=e.uploadRetryDelayMin)&&void 0!==n?n:h),uploadRetryDelayMax:1e3*(null!==(i=e.uploadRetryDelayMax)&&void 0!==i?i:f),uploadRetryMaxAttemptsCount:null!==(s=e.uploadRetryMaxAttemptsCount)&&void 0!==s?s:p},yield(0,a.delayMs)(_.startUploadDelay),E())}))).apply(this,arguments)}function g(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){const e=_.uploadRetryDelayMin+Math.floor(Math.random()*(_.uploadRetryDelayMax-_.uploadRetryDelayMin));yield(0,a.delayMs)(e)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(_.isQplEnabled())try{const e=yield(0,s.rowCount)();let t=0;for(;t<e;){const e=yield(0,s.getFromBottom)(u);yield v(e);const r=e[0].id||0,n=e[e.length-1].id||0;yield(0,s.deleteRange)(r,n),t+=e.length}yield(0,a.delayMs)(_.uploadInterval||0),E()}catch(t){e<_.uploadRetryMaxAttemptsCount?(yield g(),E(e+1)):(__LOG__(4,!0,new Error,!0)`QPL Uploader, error during upload session, error: ${t}`,SEND_LOGS("QPL Uploader upload session failed"),(0,l.errorUploadingChunk)(t),yield(0,a.delayMs)(_.uploadInterval||0),E())}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){yield(0,o.exponentialBackoff)(d,((t,r)=>(e[0].id,e[e.length-1].id,_.sendEvents(e).catch((e=>{if(e instanceof c.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`QPL Uploader uploadChunk, retriable error: ${e.errorMessage}, failCount ${r}`,t(e)}throw e})))))}))).apply(this,arguments)}},68106:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=-1;for(let r=0,i=e.length;r<i;r++)t=t>>>8^n[255&(t^e.charCodeAt(r))];return~t};let n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];void 0!==r.g.Int32Array&&(n=new Int32Array(n))},60407:(e,t,r)=>{"use strict";var n=r(95318),i=n(r(81109)),a=n(r(68106));function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0});const o=Object.freeze({TRUST_CLIENT_REPORTED_SAMPLE_RATE:1}),l=Object.freeze({API_CALL:27787270,CRASH_RESILIENCE:27787276,LOCKLESS_IS_MARKER_ON_ACCURACY:27787269,LOCKLESS_MARKER_START:27787266,LOCKLESS_QUEUE_SIZE:27787265,LOCKLESS_STARTED_MARKERS_MAP_COLLISIONS:27787273,LOSS_TRACKING_MARKER_RECEIVED:27787272,LOSS_TRACKING_MARKER_STARTED:27787271,QPL_CONFIG_LOAD:27799150,QPL_CONFIG_SAVE:27791744,QPL_HEARTBEAT_HARDCODED_CONFIG:27792138,QPL_HEARTBEAT_SEVER_CONFIG:27803336,USAGE:27791726,ZERO_SAMPLE_RATE_DUE_MISSING_CONFIG:27787268,ZERO_SAMPLE_RATE_DUE_MISSING_EVENT_IN_CONFIG:27787267}),c=Object.freeze({REGULAR:1,USER_FLOW:2});function d(e,t){const r=t-e;if(0===r)return"0";const[n,i]=r.toFixed(6).split(".",2);return"0"===n?i.replace(/^0+/,""):n+i}function u(e,t,r,n){const a=t[e];if(!a||0===Object.entries(a).length)return null;const s={};return Object.keys(a).forEach((e=>{const t=a[e];null==t||0===t.length?delete a[e]:s[e]=n?n(t):t})),{[e]:(0,i.default)((0,i.default)({},null==r?void 0:r[e]),s)}}function p(e,t){if(null==e)return t;const r=(0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)({},t),u("string",e,t)),u("int",e,t,Math.trunc)),u("double",e,t)),u("bool",e,t)),u("string_array",e,t)),u("int_array",e,t,(e=>e.map(Math.trunc)))),u("double_array",e,t)),u("bool_array",e,t));return Object.keys(r).forEach((e=>{const t=r[e];null!=t&&0!==Object.entries(t).length||delete r[e]})),0!==Object.entries(r).length?r:null}function h(e,t){if(!t)return e;const r={};return t.string&&(r.annotations=t.string),t.int&&(r.annotations_int=t.int),t.double&&(r.annotations_double=t.double),t.bool&&(r.annotations_bool=t.bool),t.string_array&&(r.annotations_string_array=t.string_array),t.int_array&&(r.annotations_int_array=t.int_array),t.double_array&&(r.annotations_double_array=t.double_array),t.bool_array&&(r.annotations_bool_array=t.bool_array),(0,i.default)((0,i.default)({},e),r)}const f=new Map([[1,"random_sampling"],[3,"per_user"]]);function _(e,t){return 0!==e&&(e<=1||("string"==typeof t?0==(r=t,((0,a.default)(r)>>>0)%e):Math.random()*e<=1));var r}class m{constructor(e){let t;s(this,"_settings",void 0),s(this,"_nextListenerId",1),s(this,"_defaultSampleRate",100),s(this,"_listeners",new Map),s(this,"_listenersWithMarker",new Map),s(this,"_debuggingId",void 0),s(this,"_logger",void 0),s(this,"_markerSampleRate",{}),s(this,"activeMarkers",new Map),this._settings=e,this._logger=e.logger,this._listenersWithMarker=null!==(t=e.listenersWithMarker)&&void 0!==t?t:new Map}getMarker(e,t){const r=this._getMarkerInstances(e);if(!r)return null;const n=r.get(t);return n||null}_getMarkerInstances(e){let t;return(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())?null:this.activeMarkers.get(e)}addMarker(e,t,r){let n=this.activeMarkers.get(e);n||(n=new Map,this.activeMarkers.set(e,n)),n.set(t,r)}deleteMarker(e,t){let r;null===(r=this.activeMarkers.get(e))||void 0===r||r.delete(t)}markerStart(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentTimestamp(),{cancelOnUnload:i=!1,trackedForLoss:a=!1,type:s=c.REGULAR,samplingBasis:o=null}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())return;this.getMarker(e,r)&&this._logger.warn(`Duplicate QPL markerId: ${e} & instanceKey: ${r}`);const[d,u,p]=this._getSamplingPolicy(e,o),h={passesSampling:d,timestamp:n,sampleRate:u,samplingMethod:p,points:[],cancelOnUnload:i,trackedForLoss:a,type:s};this._listeners.forEach((t=>{t.onMarkerStart(e,r,n)})),this._listenersWithMarker.forEach((t=>{t.onMarkerStartWithMarker(e,r,n,h)})),d&&this.addMarker(e,r,h),d&&!0===a&&this._uploadEvent({marker_id:l.LOSS_TRACKING_MARKER_STARTED,action_id:0,sample_rate:1,annotations_int:{tracked_marker_id:e},marker_type:c.REGULAR})}markerAnnotate(e,t){let{instanceKey:r=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((n=>{Object.keys(t).forEach((i=>{const a=t[i];a&&Object.keys(a).forEach((t=>{n.onAnnotation(e,r,t,a[t])}))}))}));const n=this.getMarker(e,r);n&&(n.annotations=p(t,n.annotations))}markerPoint(e,t){let{instanceKey:r=0,data:n,timestamp:i=this.currentTimestamp()}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((a=>{let s;return a.onMarkerPoint(e,r,t,null==n||null===(s=n.string)||void 0===s?void 0:s.__key,i)}));const a=this.getMarker(e,r);if(!a)return;const s={name:t,timeSinceStart:Math.trunc(i-a.timestamp)},o=p(n);o&&(s.data=o),a.points.push(s)}markerEnd(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.currentTimestamp();this._listeners.forEach((i=>i.onMarkerEnd(t,e,r,n)));const a=this.getMarker(e,r);if(a){if(a.passesSampling){if(!0!==a.timestampIsApproximate){const s=a.type===c.USER_FLOW?a.points:function(e){return Array.from(new Set(e.map((e=>e.name)))).map((t=>e.find((e=>e.name===t)))).filter(Boolean)}(a.points),l=function(e,t){return!0===t?(0,i.default)((0,i.default)({},e),{},{tracked_for_loss:!0}):e}(h({marker_id:e,action_id:t,instance_id:r,sample_rate:a.sampleRate,method:f.get(a.samplingMethod),duration_ns:d(a.timestamp,n),points:s,metadata:{application_analytics:{time_since_qpl_module_init:n-this._settings.moduleLoadTimestamp}},marker_type:a.type,flags:o.TRUST_CLIENT_REPORTED_SAMPLE_RATE},a.annotations),a.trackedForLoss);this._uploadEvent(l)}this._debuggingId===e&&this._settings.onDebuggingIdEnded&&this._settings.onDebuggingIdEnded()}this.deleteMarker(e,r)}}markerDrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.deleteMarker(e,t);const r=this.currentTimestamp();this._listeners.forEach((n=>{n.onMarkerDrop&&n.onMarkerDrop(e,t,r)}))}markEvent(e,t,r){let n,{timestamp:i=this.currentTimestamp(),annotations:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(n=this._settings.quickLogConfigHelper)||void 0===n?void 0:n.isKillswitchOn())return;const[s,l,d]=this._getSamplingPolicy(e);if(!s)return;const u=p("function"==typeof a?a():a),_={marker_id:e,action_id:0,instance_id:0,sample_rate:l,method:f.get(d),da_type:t,da_level:r,metadata:{application_analytics:{time_since_qpl_module_init:i-this._settings.moduleLoadTimestamp}},marker_type:c.REGULAR,flags:o.TRUST_CLIENT_REPORTED_SAMPLE_RATE};this._uploadEvent(h(_,u))}dropAllMarkers(){this.activeMarkers.clear()}setAlwaysOnSampleRate(e,t){this._markerSampleRate[e]=t}currentTimestamp(){return this._settings.performanceNow()}enableDebug(e){this._debuggingId=parseInt(e,10)}disableDebug(){this._debuggingId=null}addListener(e){const t=this._nextListenerId++;return this._listeners.set(t,e),{dispose:()=>{this._listeners.delete(t)}}}_getSamplingPolicy(e,t){let r,n,i,a,s;if(this._settings.unsampleAllEvents&&this._settings.unsampleAllEvents()||this._debuggingId===e)return[!0,1,1];const o=null!==(r=null===(n=this._settings.quickLogConfigHelper)||void 0===n?void 0:n.getEventDetails(e))&&void 0!==r?r:{sampleRate:0,samplingMethod:1};if(null==this._markerSampleRate[e]&&0!==o.sampleRate&&3===o.samplingMethod){let e;return[!0,null!==(e=o.sampleRate)&&void 0!==e?e:1,3]}const l=null!==(i=null!==(a=this._markerSampleRate[e])&&void 0!==a?a:o.sampleRate)&&void 0!==i?i:this._defaultSampleRate,c=null!==(s=o.samplingMethod)&&void 0!==s?s:1;return[_(l,t),l,c]}_uploadEvent(e){const t=this._settings.decorateEventBeforeUpload?this._settings.decorateEventBeforeUpload(e):e;this._settings.sendEvent(e,t)}getActiveMarkerIDs(e){let{type:t}=e;const r=new Set;return this.activeMarkers.forEach(((e,n)=>{e.forEach((e=>{e.type===t&&r.add(n)}))})),Array.from(r)}forEachMarkerInstance(e,t){const r=this._getMarkerInstances(e);if(r)for(const e of r.keys())t(e)}}var g,y;s(m,"normalizeAnnotations",p),function(e){e[e.REGULAR=1]="REGULAR",e[e.USER_FLOW=2]="USER_FLOW"}(t.QPLMarkerType||(t.QPLMarkerType={})),(g=t.QuickLogActionType||(t.QuickLogActionType={}))[g.SUCCESS=2]="SUCCESS",g[g.FAIL=3]="FAIL",g[g.CANCEL=4]="CANCEL",(y=t.QPLDataEventLevel||(t.QPLDataEventLevel={}))[y.FATAL=1]="FATAL",y[y.ERROR=3]="ERROR",y[y.CRITICAL=4]="CRITICAL",y[y.WARN=5]="WARN",y[y.INFO=7]="INFO",y[y.DEBUG=9]="DEBUG",t.default=m},99234:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UserPrefsEvent=void 0,Object.defineProperty(t,"_setAllKeyValues",{enumerable:!0,get:function(){return y._setAllKeyValues}}),t.assertGetMe=w,t.assertGetMeUser=function(){return(0,u.default)(R(),"meUser")},Object.defineProperty(t,"clearAllLocalState",{enumerable:!0,get:function(){return y.clearAllLocalState}}),Object.defineProperty(t,"clearAllTemporaryStorageData",{enumerable:!0,get:function(){return y.clearAllTemporaryStorageData}}),t.clearDeprecatedKeys=N,t.clearTokens=function(){A.forEach((e=>{y._set(e,void 0)}))},t.deleteComposeContents=function(e){y._clearUserSessionItem(x(e))},t.getAutoDownloadAudio=function(){var e;return null===(e=y._getUser(h.default.KEY_AUTO_DOWNLOAD_AUDIO))||void 0===e||e},t.getAutoDownloadDocuments=function(){var e;return null!==(e=y._getUser(h.default.KEY_AUTO_DOWNLOAD_DOCUMENTS))&&void 0!==e&&e},t.getAutoDownloadPhotos=function(){var e;return null===(e=y._getUser(h.default.KEY_AUTO_DOWNLOAD_PHOTOS))||void 0===e||e},t.getAutoDownloadVideos=function(){var e;return null!==(e=y._getUser(h.default.KEY_AUTO_DOWNLOAD_VIDEOS))&&void 0!==e&&e},t.getBrowserId=function(){return y._get(h.default.KEY_BROWSER_ID)},t.getCollapseMuted=function(){return y._getUser(h.default.KEY_GLOBAL_COLLAPSE_MUTED)},Object.defineProperty(t,"getCollection",{enumerable:!0,get:function(){return y.getCollection}}),t.getComposeContents=function(e){return y._getUserSession(x(e))},t.getContactChecksum=function(){return y._getUser(h.default.KEY_CONTACT_CHECKSUM)},t.getDailyStatsStartTime=Y,t.getForcedMdUpgradeComplete=function(){return y._get(h.default.KEY_FORCED_MD_UPGRADE_COMPLETE,E.default)},t.getGeocoderLocation=function(){return y._getUser(h.default.KEY_GEOCODER_LOCATION)},t.getGlobalCallRingtone=function(){return!y._getUser(h.default.KEY_GLOBAL_MUTE_CALL_RINGTONE)},t.getGlobalNotifications=function(){return!y._getUser(h.default.KEY_GLOBAL_MUTE_NOTIFICATIONS)},t.getGlobalPreviews=function(){return!y._getUser(h.default.KEY_GLOBAL_MUTE_PREVIEWS)},t.getGlobalSecurityNotifications=function(){var e;return null===(e=!y._getUser(h.default.KEY_SECURITY_NOTIFICATIONS))||void 0===e||e},t.getGlobalSounds=function(){return!y._getUser(h.default.KEY_GLOBAL_MUTE_SOUNDS)},t.getGroupParticipantAssignedColor=function(e){return y._getUser(h.default.KEY_GROUP_ASSIGNED_COLOR+"-"+e.toString())},t.getHistorySyncEarliestDate=function(){const e=y._get(h.default.KEY_HISTORY_SYNC_EARLIEST_DATE);if(!e)return B((0,p.unixTime)());return e},t.getIgnoreNondirectGroupMsg=function(){return y._getUser(h.default.KEY_IGNORE_NONDIRECT_GROUP_MSG)},t.getLangPref=function(){return y._get(h.default.KEY_LANG)},t.getLastChatMuteDuration=function(){return y._getUser(h.default.KEY_LAST_CHAT_MUTE_DURATION)},t.getLastComposeBoxPanel=function(){return y._getUser(h.default.KEY_LAST_SELECTED_COMPOSE_BOX_PANEL)},t.getLastMobilePlatform=function(){return y._get(h.default.KEY_MOBILE_PLATFORM)},t.getLastStatusUsage=function(){return y._getUser(h.default.LAST_STATUS_USAGE)},t.getLoginTokens=D,t.getLogoutToken=function(){return y._getPS(h.default.KEY_LOGOUT_TOKEN)},t.getMapsOverQuota=function(){return y._get(h.default.KEY_GMAPS_OVER_LIMIT)},t.getMaybeMeUser=function(){const e=I();return e?(0,T.toUserWid)(e):void 0},t.getMe=I,t.getMeUser=R,t.getMutex=function(){return y._getPSIgnoringCache(h.default.KEY_WHATSAPP_MUTEX)},t.getNUX=L,t.getNewChatInfo=function(){var e;const t=r(7293).GK;return null!==(e=y._getUser(h.default.KEY_NEW_CHAT_INFO))&&void 0!==e?e:t.supportsFeature(t.F.NEW_CHAT_INFO)},t.getNoTakeover=function(){return y._getTS(h.default.KEY_NO_TAKEOVER)},t.getNoticeBannerClosedAt=function(){return y._getUser(h.default.KEY_NOTICE_BANNER_CLOSED_AT)},t.getNoticeId=function(){return y._getUser(h.default.KEY_NOTICE_ID)},t.getOldLogoutCreds=function(){return y._getPS(h.default.KEY_OLD_LOGOUT_CREDS)||[]},t.getOutgoingMessageSound=function(){return y._getUser(h.default.KEY_OUTGOING_MESSAGE_SOUND)},t.getPrimaryFeatures=function(){var e;return null!==(e=y._get(h.default.KEY_PRIMARY_FEATURES))&&void 0!==e?e:[]},t.getPsKillSwitchToken=function(){return y._get(h.default.PS_KILLSWITCH_TOKEN)},t.getPttPlaybackRate=function(){var e;return null!==(e=y._get(h.default.KEY_PTT_PLAYBACK_RATE))&&void 0!==e?e:1},t.getPushname=function(){return y._getUser(h.default.KEY_LAST_PUSHNAME)},Object.defineProperty(t,"getRememberMe",{enumerable:!0,get:function(){return y.getRememberMe}}),t.getSecretBundle=function(){let e=y._get(h.default.KEY_SECRET_BUNDLE);if(!e)return __LOG__(3)`UserPrefs:Attempted to load non-existent secret bundle!`,null;"string"==typeof e&&(e=JSON.parse(e));return(0,l.default)(e,d.decodeB64)},t.getSeenGroupDesc=function(e){return y._getUser(e.toString())},t.getShouldPreemptivelyCleanupLogs=function(){return!1!==y._get(h.default.KEY_LOG_PREEMPT_CLEAN_UP)},t.getShowMdUpgradeCompleteMsg=function(){return y._get(h.default.KEY_SHOW_MD_UPGRADE_COMPLETE_MSG,E.default)},t.getSmbLabelPalette=function(){return y._getUser(h.default.KEY_SMB_LABEL_COLOR_PALETTE)},t.getStorageAlert=function(){return f.STORAGE_ALERT_TYPE.NO_ALERT},t.getStorageDismissState=function(){return{lowQuotaDismissed:!0,highQuotaDismissed:!0}},t.getSystemThemeMode=function(){return y._get(h.default.KEY_SYSTEM_THEME_MODE)},t.getTheme=function(){return y._get(h.default.KEY_THEME)},t.getUnknownId=function(){let e=y._get(h.default.KEY_UNKNOWN_ID);e||(e="unknown"+Math.floor(1e10*Math.random()),G(e));return e},t.getUnreadMentionCountEnabled=function(){return y._get(h.default.KEY_UNREAD_MENTION_COUNT_ENABLED)},t.getUserPrivacySettings=function(){var e;return null!==(e=y._getUser(h.default.KEY_USER_PRIVACY_SETTINGS))&&void 0!==e?e:{}},t.getVersion=function(){return y._get(h.default.KEY_PROTO_VERSION)},t.getVideoVolumeSettings=function(){return{volume:y._get(h.default.KEY_VIDEO_VOLUME),muted:!!y._get(h.default.KEY_VIDEO_MUTE)}},t.getWamBuffer=function(){return y._get(h.default.KEY_WAM_BUFFER,void 0,!0)},t.getWamInfo=function(){return y._get(h.default.KEY_WAM_INFO)},t.initDailyStatsStartTime=function(){Y()},t.knowsPhone=function(){const e=D();return!(!e.client||!e.server)},t.localTakeoverSuccess=function(){const e=y.getRememberMe()?{}:(0,o.default)(y._getAllKeyValues(),S.LS_ONLY_KEYS);e.wa_tab_src=b,(0,u.default)(m.default,"localStorage").setItem(h.default.KEY_LOCAL_TAKEOVER_OK,JSON.stringify(e)),(0,u.default)(m.default,"localStorage").removeItem(h.default.KEY_LOCAL_TAKEOVER_OK)},t.markUserSentMessageToChat=function(e){const t=K(e),r=y._getUser(h.default.KEY_CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(r))return __LOG__(3)`UserPrefs:markUserSentMessageToChat value in store is not an array`,y._setUser(h.default.KEY_CHATS_USER_SENT_MESSAGE_TO,[t]),!1;const n=!r.includes(t);n&&(r.push(t),y._setUser(h.default.KEY_CHATS_USER_SENT_MESSAGE_TO,r));return __LOG__(2)`UserPrefs:markUserSentMessageToChat`,n},t.mdOptedIn=function(){return y._get(h.default.KEY_MD_OPTED_IN,g.default)},t.mutexFilter=function(e){if(e.key!==h.default.KEY_WHATSAPP_MUTEX)return!1;return!(e.newValue||"").includes(b)},t.parseMutex=function(e){const t=e?JSON.parse(e):"";return t?t.toString().split(/:/).pop():t},t.parseTakeover=function(e){const t=e?JSON.parse(e):{};return(0,s.default)(t)?(delete t.wa_tab_src,t):{}},t.removeMutex=function(){y._setPS(h.default.KEY_WHATSAPP_MUTEX)},t.removeNUX=function(e){y._setUser(e)},t.removeUserSentMessageToChat=function(e){const t=y._getUser(h.default.KEY_CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(t))return __LOG__(3)`UserPrefs:removeUserSentMessageToChat value in store is not an array`,void y._setUser(h.default.KEY_CHATS_USER_SENT_MESSAGE_TO,[]);const r=K(e);t.includes(r)&&y._setUser(h.default.KEY_CHATS_USER_SENT_MESSAGE_TO,(0,a.default)(t,r));__LOG__(2)`UserPrefs:removeUserSentMessageToChat`},t.setAutoDownloadAudio=function(e){y._setUser(h.default.KEY_AUTO_DOWNLOAD_AUDIO,e)},t.setAutoDownloadDocuments=function(e){y._setUser(h.default.KEY_AUTO_DOWNLOAD_DOCUMENTS,e)},t.setAutoDownloadPhotos=function(e){y._setUser(h.default.KEY_AUTO_DOWNLOAD_PHOTOS,e)},t.setAutoDownloadVideos=function(e){y._setUser(h.default.KEY_AUTO_DOWNLOAD_VIDEOS,e)},t.setBrowserId=function(e){y._set(h.default.KEY_BROWSER_ID,e)},t.setCollapseMuted=function(e){y._setUser(h.default.KEY_GLOBAL_COLLAPSE_MUTED,e)},Object.defineProperty(t,"setCollection",{enumerable:!0,get:function(){return y.setCollection}}),t.setComposeContents=function(e,t){y._setUserSession(x(e),t)},t.setContactChecksum=function(e){y._setUser(h.default.KEY_CONTACT_CHECKSUM,e)},t.setForcedMdUpgradeComplete=function(e){y._set(h.default.KEY_FORCED_MD_UPGRADE_COMPLETE,e,E.default)},t.setGeocoderLocation=function(e){y._setUser(h.default.KEY_GEOCODER_LOCATION,e)},t.setGlobalCallRingtone=function(e){y._setUser(h.default.KEY_GLOBAL_MUTE_CALL_RINGTONE,!e)},t.setGlobalNotifications=function(e){y._setUser(h.default.KEY_GLOBAL_MUTE_NOTIFICATIONS,!e)},t.setGlobalPreviews=function(e){y._setUser(h.default.KEY_GLOBAL_MUTE_PREVIEWS,!e)},t.setGlobalSecurityNotifications=function(e){y._setUser(h.default.KEY_SECURITY_NOTIFICATIONS,!e)},t.setGlobalSounds=function(e){y._setUser(h.default.KEY_GLOBAL_MUTE_SOUNDS,!e)},t.setGroupParticipantAssignedColor=function(e,t){y._setUser(h.default.KEY_GROUP_ASSIGNED_COLOR+"-"+e.toString(),t)},t.setHistorySyncEarliestDate=B,t.setIgnoreNondirectGroupMsg=function(e){y._setUser(h.default.KEY_IGNORE_NONDIRECT_GROUP_MSG,e)},t.setLangPref=function(e){y._set(h.default.KEY_LANG,e)},t.setLastChatMuteDuration=function(e){y._setUser(h.default.KEY_LAST_CHAT_MUTE_DURATION,e)},t.setLastComposeBoxPanel=function(e){y._setUser(h.default.KEY_LAST_SELECTED_COMPOSE_BOX_PANEL,e)},t.setLastMobilePlatform=function(e){y._set(h.default.KEY_MOBILE_PLATFORM,e)},t.setLastStatusUsage=function(){y._setUser(h.default.LAST_STATUS_USAGE,Date.now())},t.setLoginTokens=function(e){const t=e.client,r=e.server;t&&r&&!(0,c.default)(t)&&(__LOG__(2)`UserPrefs:setLoginTokens`,y._set(h.default.KEY_CLIENT_TOKEN,t),y._set(h.default.KEY_SERVER_TOKEN,r))},t.setLogoutToken=function(e){y._setPS(h.default.KEY_LOGOUT_TOKEN,e)},t.setMapsOverQuota=function(e){y._set(h.default.KEY_GMAPS_OVER_LIMIT,e)},t.setMdOptedIn=function(e){y._set(h.default.KEY_MD_OPTED_IN,e,g.default)},t.setMe=function(e){const t=r(7293).GK;t.supportsFeature(t.F.MD_BACKEND)?y._set(h.default.KEY_LAST_WID_MD,e):y._set(h.default.KEY_LAST_WID,e)},t.setMutex=function(e){const t=e?b+":"+e:e;y._setPS(h.default.KEY_WHATSAPP_MUTEX,t)},t.setNUX=k,t.setNewChatInfo=function(e){y._setUser(h.default.KEY_NEW_CHAT_INFO,e),O.handleNewChatInfoChange(e)},t.setNoTakeover=function(e){y._setTS(h.default.KEY_NO_TAKEOVER,e)},t.setNoticeBannerClosedAt=function(e){y._setUser(h.default.KEY_NOTICE_BANNER_CLOSED_AT,e)},t.setNoticeId=function(e){y._setUser(h.default.KEY_NOTICE_ID,e)},t.setOldLogoutCreds=function(e){y._setPS(h.default.KEY_OLD_LOGOUT_CREDS,e)},t.setOutgoingMessageSound=function(e){y._setUser(h.default.KEY_OUTGOING_MESSAGE_SOUND,e)},t.setPrimaryFeatures=function(e){y._set(h.default.KEY_PRIMARY_FEATURES,e)},t.setPsKillSwitchToken=function(e){y._set(h.default.PS_KILLSWITCH_TOKEN,e)},t.setPttPlaybackRate=function(e){y._set(h.default.KEY_PTT_PLAYBACK_RATE,e)},t.setPushname=function(e){y._setUser(h.default.KEY_LAST_PUSHNAME,e)},t.setRefTok=function(e,t){N(),y.setRefTokCookies(e,t)},Object.defineProperty(t,"setRememberMe",{enumerable:!0,get:function(){return y.setRememberMe}}),t.setSecretBundle=function(e){return y._set(h.default.KEY_SECRET_BUNDLE,(0,l.default)(e,d.encodeB64))},t.setSeenGroupDesc=function(e){y._setUser(e.toString(),!0)},t.setShouldPreemptivelyCleanupLogs=function(e){y._set(h.default.KEY_LOG_PREEMPT_CLEAN_UP,e)},t.setShowMdUpgradeCompleteMsg=function(e){y._set(h.default.KEY_SHOW_MD_UPGRADE_COMPLETE_MSG,e,E.default)},t.setSmbLabelPalette=function(e){y._set(h.default.KEY_SMB_LABEL_COLOR_PALETTE,e)},t.setStorageAlert=function(){},t.setStorageDismissState=function(){},t.setSystemThemeMode=function(e){y._set(h.default.KEY_SYSTEM_THEME_MODE,e)},t.setTheme=function(e){y._set(h.default.KEY_THEME,e)},t.setUnknownId=G,t.setUnreadMentionCountEnabled=function(e){y._set(h.default.KEY_UNREAD_MENTION_COUNT_ENABLED,e)},t.setUserPrivacySettings=function(e){y._setUser(h.default.KEY_USER_PRIVACY_SETTINGS,e)},t.setVersion=function(e){null!=e&&y._set(h.default.KEY_PROTO_VERSION,e)},t.setVideoMutedSetting=F,t.setVideoVolumeSetting=U,t.setVideoVolumeSettings=function(e,t){U(e),F(t)},t.setWamBuffer=function(e){y._set(h.default.KEY_WAM_BUFFER,e,void 0,!0)},t.setWamInfo=function(e){y._set(h.default.KEY_WAM_INFO,e)},t.shouldShowNUX=function(e){const t=L(e);return!t||t.views<t.maxViews},t.takeoverFilter=function(e){if(e.key!==h.default.KEY_LOCAL_TAKEOVER_OK)return!1;return!(e.newValue||"").includes(b)},t.thisTabId=void 0,Object.defineProperty(t,"updatePreservedUserKeys",{enumerable:!0,get:function(){return y.updatePreservedUserKeys}}),t.viewNUX=function(e){const t=L(e);if(!t)throw new Error("UserPrefs:viewNUX key "+e+" does not exist");k(e,{views:t.views+1,maxViews:t.maxViews})};var a=i(r(82569)),s=i(r(13218)),o=i(r(57557)),l=i(r(66604)),c=i(r(52353)),d=r(15688),u=i(r(45095)),p=r(92844),h=i(r(69618)),f=r(60764),_=i(r(34342)),m=i(r(92417)),g=i(r(99304)),y=n(r(53055)),E=i(r(97920)),S=r(70499),v=i(r(39546)),T=r(58021);const A=[h.default.KEY_LOGOUT_TOKEN,h.default.KEY_CLIENT_TOKEN,h.default.KEY_SERVER_TOKEN,h.default.KEY_SECRET_BUNDLE],C=[h.default.KEY_VERSION],b="x"+Math.round(1e9*Math.random()),P=b;t.thisTabId=P;class M extends _.default{constructor(){super(...arguments),this.NEW_CHAT_INFO_CHANGE="NEW_CHAT_INFO_CHANGE"}handleNewChatInfoChange(e){this.trigger(this.NEW_CHAT_INFO_CHANGE,e)}}const O=new M;function I(){const e=r(7293).GK;let t=null;return t=e.supportsFeature(e.F.MD_BACKEND)?y._get(h.default.KEY_LAST_WID_MD):y._get(h.default.KEY_LAST_WID),t&&v.default.isWid(t)?(0,T.createWid)(t):t}function w(){return(0,u.default)(I(),"me")}function R(){return(0,T.toUserWid)(w())}function D(){return{client:y._get(h.default.KEY_CLIENT_TOKEN),server:y._get(h.default.KEY_SERVER_TOKEN)}}function N(){C.forEach((function(e){g.default.removeItem(e)}))}function L(e){return y._getUser(e)}function k(e,t){y._setUser(e,t)}function G(e){return y._set(h.default.KEY_UNKNOWN_ID,e)}function U(e){y._set(h.default.KEY_VIDEO_VOLUME,e)}function F(e){y._set(h.default.KEY_VIDEO_MUTE,e)}function x(e){return`${h.default.KEY_COMPOSE_CONTENTS_PREFIX}${e.toString()}`}function B(e){const t=90*p.DAY_SECONDS,r=(p.YEAR_SECONDS,e-t);return y._set(h.default.KEY_HISTORY_SYNC_EARLIEST_DATE,r),r}function K(e){return`${e.toString()}_`}function Y(){const e=y._get(h.default.KEY_DAILY_STATS_START_TIME);if("number"==typeof e)return e;const t=Date.now();return y._set(h.default.KEY_DAILY_STATS_START_TIME,t),t}t.UserPrefsEvent=O},50313:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.getContactChecksum=function(){return i._getUser(a)},t.getFrequentContacts=function(){return i._getUser(s)},t.getGKFeatures=function(){return i._getUser(o)},t.getGKProto=function(){return i._getUser(l)},t.getHistoryInitialSyncBoundry=function(){const e=i._getUser(c);try{return JSON.parse(e)}catch(e){return null}},t.getInitialGroupPhash=function(e){const t=i._getUser(d);try{return JSON.parse(t)[e]}catch(e){return null}},t.setContactChecksum=function(e){i._setUser(a,e)},t.setFrequentContacts=function(e){i._setUser(s,e)},t.setGKFeatures=function(e){i._setUser(o,e)},t.setGKProto=function(e){i._setUser(l,e)},t.setHistoryInitialSyncBoundry=function(e){i._setUser(c,JSON.stringify(e))},t.setInitialGroupPhash=function(e){i._setUser(d,JSON.stringify(e))};var i=n(r(53055));const a="contact_checksum",s="frequent_contacts",o="gk_features",l="gk_proto",c="history_initial_sync_boundry",d="initial_group_phash"},58052:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearRegistrationInfo=function(){const e=[h,_,m,g,y,C];d.GK.supportsFeature(d.GK.F.MD_BACKEND)?e.push(l.default.KEY_LAST_WID_MD):e.push(l.default.KEY_LAST_WID);e.map((e=>{p._set(e,void 0)}))},t.getADVSecretKey=function(){return p._get(v)},t.getAllCriticalDataSynced=function(){return!!p._get(E,u.default)},t.getArchiveV2EnabledSetting=function(){return p._get(O)},t.getBlocklistHash=function(){return p._get(T)},t.getChatThreadLoggingLastUploadedStartTs=function(){return p._get(N)},t.getChatThreadLoggingOffset=function(){return p._get(R)},t.getChatThreadLoggingSecretB64=function(){return p._get(D)},t.getHistorySyncStatus=k,t.getInitialHistorySyncComplete=function(){return!!p._get(y,u.default)},t.getLastHistorySycnedChunk=function(){return p._get(P)},t.getMdInternVersion=function(){return},t.getMdSyncActionsActionSanitized=function(){return p._get(w)},t.getNoiseInfo=L,t.getNoiseInfoIv=function(){return p._get(f)},t.getPrimaryAllowsAllMutations=function(){return!!p._get(I)},t.getRoutingInfo=function(){const e=p._get(g,u.default);if(e){const{domain:t,edgeRouting:r}=e;return{domain:t,edgeRouting:r?(0,o.decodeB64)(r):null}}return null},t.getShouldCheckContactSyncStatus=function(){return!!p._get(A)},t.getUnarchiveChatsSetting=function(){return p._get(M)},t.getUpgradeMdWamFlag=function(){return!!p._get(b)},t.getWebEncSalt=function(){return p._get(C,u.default)},t.isRegistered=function(){return!(!L()||!c.getMe())},t.setADVSecretKey=function(e){return p._set(v,e)},t.setAllCriticalDataSynced=function(){return p._set(E,!0)},t.setArchiveV2EnabledSetting=function(e){p._set(O,e)},t.setBlocklistHash=function(e){return p._set(T,e)},t.setChatThreadLoggingLastUploadedStartTs=function(e){p._set(N,e)},t.setChatThreadLoggingOffset=function(e){p._set(R,e)},t.setChatThreadLoggingSecretB64=function(e){p._set(D,e)},t.setHistorySyncStatus=function(e){var t;const r=null!==(t=k())&&void 0!==t?t:{};p._set(S,(0,a.default)((0,a.default)({},r),e),void 0,void 0,!1)},t.setInitialHistorySyncComplete=function(){return p._set(y,"true",void 0,void 0,!1)},t.setLastHistorySycnedChunk=function(e,t){if(null==e||null==t)return;p._set(P,`${e}_${t}`,void 0,void 0,!1)},t.setMdInternVersion=function(){},t.setMdSyncActionsActionSanitized=function(e){p._set(w,e)},t.setNoiseInfo=function(e){const t={recoveryToken:e.recoveryToken,pubKey:e.staticKeyPair.pubKey,privKey:e.staticKeyPair.privKey};return p._set(h,(0,s.default)(t,o.encodeB64),void 0,void 0,!1)},t.setNoiseInfoIv=function(e){p._set(f,e,void 0,void 0,!1)},t.setPrimaryAllowsAllMutations=function(){return p._set(I,!0)},t.setRoutingInfo=function(e){const{domain:t,edgeRouting:r}=e,n={domain:t,edgeRouting:r?(0,o.encodeB64)(r):null};return p._set(g,n,u.default)},t.setShouldCheckContactSyncStatus=function(){return p._set(A,!0)},t.setUnarchiveChatsSetting=function(e){p._set(M,e)},t.setUpgradeMdWamFlag=function(e){return p._set(b,e)},t.setWebEncSalt=function(e){return p._set(C,e,void 0,void 0,!1)};var a=i(r(81109)),s=i(r(66604)),o=r(15688),l=i(r(69618)),c=n(r(99234)),d=r(7293),u=i(r(99304)),p=n(r(53055));const h="WANoiseInfo",f="WANoiseInfoIv",_="WAMeInfo",m="WADeviceId",g="WARoutingInfo",y="WaInitialHistorySynced",E="critical_data_synced",S="WAHistorySyncStatus",v="WaADVSecretKey",T="WABlocklistHash",A="WAShouldCheckContactSyncStatus",C="WebEncKeySalt",b="MdUpgradeWamFlag",P="MdHistoryLastChunkProcessed",M="WAUnarchiveChatsSetting",O="WAArchiveV2EnabledSetting",I="WASyncdPrimaryAllowsAllMutations",w="MdSyncActionsActionSanitized",R="ChatThreadLoggingOffset",D="ChatThreadLoggingSecret",N="ChatThreadLoggingLastUploadedStartTs";function L(){const e=p._get(h);if(!e)return null;const t=(0,s.default)(e,o.decodeB64);return{recoveryToken:t.recoveryToken,staticKeyPair:{pubKey:t.pubKey,privKey:t.privKey}}}function k(){return p._get(S)}},53055:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._clearUserSessionItem=function(e){const t=O();if(!t)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;const r=(0,_.default)(L(t.toString(),e));g.default.removeItem(r)},t._get=D,t._getAllKeyValues=function(){const e=R();return(0,l.default)(Object.keys(e).map((function(t){return[t,e.getItem(t)]})))},t._getKeys=S,t._getMe=O,t._getPS=b,t._getPSIgnoringCache=function(e){return D(e,m.default,!1,!0)},t._getTS=function(e){return D(e,g.default)},t._getUser=I,t._getUserSession=function(e){const t=O();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;return D((0,_.default)(L(t.toString(),e)),g.default)},t._set=N,t._setAllKeyValues=function(e){const t=R();Object.keys(e).forEach((function(r){null!=e[r]&&t.setItem(r,e[r])}))},t._setKeys=v,t._setPS=P,t._setTS=function(e,t){N(e,t,g.default)},t._setUser=w,t._setUserSession=function(e,t){const r=O();if(!r)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;N((0,_.default)(L(r.toString(),e)),t,g.default)},t._storage=R,t.clearAllLocalState=function(){return C.apply(this,arguments)},t.clearAllTemporaryStorageData=function(){g.default.clear(A())},t.getCollection=function(e){return I(e)},t.getRememberMe=M,t.setCollection=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null==O()||r||w(e,t)},t.setRefTokCookies=function(e,t){if(void 0===self.document)return;p.setCookie({name:u.default.COOKIE_REF,value:e,path:u.default.PP_REF,domain:u.default.COOKIE_DOMAIN,secure:!0});const r={name:u.default.COOKIE_TOK,value:t,path:u.default.PP_TOK,domain:u.default.COOKIE_DOMAIN,secure:!0};p.setCookie(r)},t.setRememberMe=function(e){const t=!!e;if(t===M())return;__LOG__(2)`UserPrefs:setRememberMe: ${String(t)}`;const r=R();P(u.default.KEY_REMEMBER_ME,t);const n=R();if(r!==n){(0,s.default)(Object.keys(r.dataStore),y.LS_ONLY_KEYS.concat(y.LS_PRESERVE_KEYS)).forEach((function(e){const t=r.getItem(e);null!=t&&(n.setItem(e,t),r.removeItem(e))}))}t||f.Logger.clearLogs()},t.updatePreservedUserKeys=function(){var e;const t=O(),r=null!==(e=b(u.default.KEY_PRESERVED_USER_KEYS))&&void 0!==e?e:[];if(null!=t){const e=y.LS_PRESERVE_USER_KEYS.map((e=>(0,_.default)(L(t.toString(),e))));P(u.default.KEY_PRESERVED_USER_KEYS,(0,o.default)(r,e))}};var a=i(r(48926)),s=i(r(91966)),o=i(r(93386)),l=i(r(17204)),c=i(r(2525)),d=i(r(7287)),u=i(r(69618)),p=n(r(11698)),h=i(r(78144)),f=r(70818),_=i(r(64084)),m=i(r(99304)),g=i(r(97920)),y=(r(31515),r(70499));function E(){void 0!==self.document&&(p.setCookie({name:u.default.COOKIE_REF,expirationDate:0,domain:u.default.COOKIE_DOMAIN,path:u.default.PP_REF}),p.setCookie({name:u.default.COOKIE_TOK,expirationDate:0,domain:u.default.COOKIE_DOMAIN,path:u.default.PP_TOK}))}function S(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,d.default)(t,t.map((t=>e.getItem(t,r))))}function v(e,t){(0,c.default)(t,(function(t,r){e.setItem(r,t)}))}function T(){var e;const t=null!==(e=b(u.default.KEY_PRESERVED_USER_KEYS))&&void 0!==e?e:[],r=[...y.LS_PRESERVE_KEYS,...t];return S(m.default,r,!0)}function A(){return S(g.default,y.TS_PRESERVE_KEYS,!0)}function C(){return(C=(0,a.default)((function*(){const e=T(),t=[g.default.clear(A()),m.default.clear(e)];t.push(f.Logger.clearLogs()),E(),yield Promise.all(t)}))).apply(this,arguments)}function b(e){return D(e,m.default)}function P(e,t){N(e,t,m.default)}function M(){let e=b(u.default.KEY_REMEMBER_ME);const t=r(7293).GK;return t.supportsFeature(t.F.MD_BACKEND)&&!1===e&&(e=!0,P(u.default.KEY_REMEMBER_ME,!0)),null===e&&(e=!0,P(u.default.KEY_REMEMBER_ME,!0)),!!e}function O(){return r(99234).getMaybeMeUser()}function I(e){const t=O();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;return D((0,_.default)(L(t.toString(),e)))}function w(e,t){const r=O();if(!r)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;N((0,_.default)(L(r.toString(),e)),t)}function R(){return M()?m.default:g.default}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R(),r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null==e)throw new Error("_get called with no key");const i=t.getItem(e,n);if(r||null==i)return i;try{return JSON.parse(i,h.default)}catch(r){return __LOG__(2,void 0,void 0,!0)`userPrefs:_get(${e}) '${r}' ${i}`,SEND_LOGS("userprefs-parse-error"),void t.removeItem(e)}}function N(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R(),n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new Error("_set called with no key");if(null==t)r.removeItem(e);else if(n){if("string"!=typeof t)throw new Error("_set: expecting string because isRawString is true");r.setItem(e,t)}else r.setItem(e,JSON.stringify(t),i)}function L(e,t){return[e,t].join(":")}},70499:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TS_PRESERVE_KEYS=t.LS_PRESERVE_USER_KEYS=t.LS_PRESERVE_KEYS=t.LS_ONLY_KEYS=void 0;var i=n(r(69618));const a=[i.default.KEY_LOG_CURSOR,i.default.KEY_WHATSAPP_MUTEX,i.default.KEY_REMEMBER_ME,i.default.KEY_WHATSAPP_LS_VERSION];t.LS_ONLY_KEYS=a;const s=[i.default.KEY_LANG,i.default.KEY_WHATSAPP_MUTEX,i.default.KEY_REMEMBER_ME,i.default.KEY_OLD_LOGOUT_CREDS,i.default.KEY_MD_OPTED_IN,i.default.KEY_PRESERVED_USER_KEYS,i.default.KEY_THEME,i.default.KEY_SYSTEM_THEME_MODE,i.default.KEY_MD_INTERN_VERSION_STR];t.LS_PRESERVE_KEYS=s;const o=[i.default.KEY_SHOW_MD_UPGRADE_COMPLETE_MSG,i.default.KEY_FORCED_MD_UPGRADE_COMPLETE];t.TS_PRESERVE_KEYS=o;const l=[i.default.KEY_EMOJI_VARIANT_COLLECTION,i.default.KEY_RECENT_EMOJI_COLLECTION,i.default.KEY_CHAT_PREFERENCE_COLLECTION,i.default.KEY_GLOBAL_MUTE_NOTIFICATIONS,i.default.KEY_OUTGOING_MESSAGE_SOUND,i.default.KEY_GLOBAL_MUTE_PREVIEWS,i.default.KEY_GLOBAL_COLLAPSE_MUTED,i.default.KEY_GLOBAL_MUTE_SOUNDS,i.default.KEY_AUTO_DOWNLOAD_PHOTOS,i.default.KEY_AUTO_DOWNLOAD_VIDEOS,i.default.KEY_AUTO_DOWNLOAD_AUDIO,i.default.KEY_AUTO_DOWNLOAD_DOCUMENTS,i.default.KEY_TOS_3];t.LS_PRESERVE_USER_KEYS=l},83938:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return Promise.resolve(!1)}},22007:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateICELiteAnswerSDP=function(e,t,r,i,a,s,o){const l=(f=e,f.ip.join(".")),c=e.port+1,d=t,u=r,p=a,h=(0,n.encodeB64)(s);var f;let _=`v=0\no=- ${(new Date).getTime()} 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE 0${o?" 1":""}\na=ice-lite\na=msid-semantic: WMS g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\nm=audio ${c} RTP/SAVP 111\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${d}\na=ice-pwd:${u}\na=ice-options:trickle\na=setup:active\na=mid:0\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${h}\na=rtpmap:111 opus/48000/2\na=fmtp:111 useinbandfec=1\na=fmtp:111 maxplaybackrate=16000; sprop-maxcapturerate=16000\na=rtcp-fb:111 goog-remb\na=ssrc:${i} cname:noAs9WOptAnM/+QP\n`;o&&(_+=`m=video ${c} RTP/SAVP 102\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${d}\na=ice-pwd:${u}\na=ice-options:trickle\na=mid:1\na=extmap:3 urn:3gpp:video-orientation\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=rtcp-rsize\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${h}\na=rtpmap:102 VP8/90000\na=rtcp-fb:102 nack\na=rtcp-fb:102 nack pli\na=rtcp-fb:102 goog-remb\na=ssrc:${p} cname:rcpcNyS/Kejuq2+Y\na=ssrc:${p} msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=ssrc:${p} mslabel:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\na=ssrc:${p} label:df375ff4-7ed5-459d-b991-76c8e47ffc52\n`);return{type:"answer",sdp:_}},t.modifyOfferSDP=function(e,t,r,i,a){let s=e;if(s=s.replace(/a=crypto:[1-9].*\r\n/g,""),s=s.replace(/a=crypto:0.*/g,`a=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${(0,n.encodeB64)(i)}`),s=s.replace(/a=rtcp-fb.*transport-cc.*\r\n/g,""),s=s.replace(/a=extmap:3.*draft-holmer-rmcat.*\r\n/g,""),a){const e=s.search(/m=video/g);let n=s.substring(0,e),i=s.substring(e);n=n.replace(/ssrc:\S+/g,`ssrc:${t}`),i=i.replace(/ssrc:\S+/g,`ssrc:${r}`),i=i.replace(/a=extmap:13 urn:3gpp:video-orientation/g,"a=extmap:3 urn:3gpp:video-orientation"),s=n+i}else s=s.replace(/ssrc:\S+/g,`ssrc:${t}`);return s};var n=r(15688)},84356:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Voip=void 0,t.checkVoipCapability=function(){return Promise.resolve(!1)};var a=i(r(48926)),s=r(15688),o=r(22683),l=r(99234),c=i(r(72451)),d=n(r(12206)),u=r(97048),p=r(46582),h=r(56981),f=r(15860),_=r(22007),m=i(r(69594)),g=i(r(89345)),y=n(r(45473)),E=r(49835),S=r(24746),v=i(r(91932));let T=null,A=new v.default;const C={init:()=>(__LOG__(2)`voip:init`,Promise.resolve(!1)),updateAudioVideoSwitch:()=>{},cleanup:()=>{},refresh:()=>{},callStart:(e,t)=>{if(!m.default.isVoiceCallEnabled()&&!m.default.isVideoCallEnabled())throw new Error("voip:callStart: calling not enabled");if(A.getState()!==E.WEB_CALL_STATES.NONE)throw new Error("Call cannot be started because there is already a call in progress");__LOG__(2)`voip:callStart: ${e.toString()} video: ${t.toString()}`,function(){M.apply(this,arguments)}(e,t)},groupCallStart:()=>{},sendGroupCallInvite:()=>{},endCall:(b=(0,a.default)((function*(){const e=A;A.getState()===E.WEB_CALL_STATES.ACTIVE&&(yield function(){return j.apply(this,arguments)}(A.callId,A.peerJid),(yield(0,p.requireCallCollection)()).remove(e.callId)),e.pc.close(),e.localStream.getTracks().forEach((e=>e.stop())),e.remoteAudioStream&&e.remoteAudioStream.getTracks().forEach((e=>e.stop())),e.remoteVideoStream&&e.remoteVideoStream.getTracks().forEach((e=>e.stop())),A=new v.default})),function(){return b.apply(this,arguments)}),callEndByHandledRemotely:()=>{},acceptCall:()=>{},rejectCall:()=>{},rejectCallWithoutCallCtx:()=>{},resendEncRekeyRetry:()=>{},processMissedIncomingCallMaxRetry:()=>{},mute:()=>{},videoTurnCameraOn:()=>{},videoTurnCameraOff:()=>{},videoStreamPause:()=>{},videoStreamResume:()=>{},videoRequestUpgrade:()=>{},videoAcceptUpgrade:()=>{},videoRejectUpgrade:()=>{},videoCancelUpgrade:()=>{},handleIncomingSignalingMessage:(e,t)=>(0,a.default)((function*(){const r=y.TYPE_NAME[e.type];__LOG__(2)`voip:handleIncomingSignalingMsg: type: "${r}" msg: `;const[n,i]=yield Promise.all([(0,p.requireCallCollection)(),(0,p.requireVoipCommonDisabled)()]),a=n.get(e.call_id);if(null==a?void 0:a.canHandleLocally)switch(e.type){case y.TYPE.OFFER:const r=e.peer_jid,i=e.t;if(r){const{isVideo:e,callId:n,randomBytes:a,key:s,token:o,relay:l}=function(e){const t=e[1]["call-id"];let r=null,n=null,i=null,a=null,s=!1;for(const t of e[2])__LOG__(2)`voip:offer: offerChild: `,"enc"===t[0]?a=new Uint8Array(t[2]):"video"===t[0]?s=!0:"relay"===t[0]&&([r,n,i]=$(t));if(null==r||null==n||null==i)throw new Error("Error parsing relay attributes in Offer");if(null==a)throw new Error("No random byte source found in Offer");return{callId:t,token:r,key:n,relay:i,randomBytes:a,isVideo:s}}(t.payload);yield function(e,t,r){const n=S.AUDIO_CODECS.DEFAULT,i=r?S.VIDEO_CODECS.DEFAULT:S.VIDEO_CODECS.NONE,a=n.concat(i),s=["preaccept",{"call-id":e,"call-creator":t},a.concat([S.CAPABILITIES.DEFAULT,S.ENCOPT.DEFAULT])];return(0,h.sendCallSignalingMsg)({common:{type:"preaccept",call_id:e,peer_jid:t},payload:s})}(n,r.toString({legacy:!0}),e),function(){O.apply(this,arguments)}(e,n,r,a,s,o,l,i)}break;case y.TYPE.OFFER_RECEIPT:case y.TYPE.ACCEPT_RECEIPT:case y.TYPE.MUTE:case y.TYPE.VIDEO_STATE:break;case y.TYPE.ACCEPT:A.getState()===E.WEB_CALL_STATES.OUTGOING_CALLING&&A.setState(E.WEB_CALL_STATES.ACTIVE);break;case y.TYPE.REJECT:A.getState()===E.WEB_CALL_STATES.OUTGOING_CALLING&&(A.pc.close(),A.localStream.getTracks().forEach((e=>e.stop())),A=new v.default);break;case y.TYPE.TERMINATE:A.getState()===E.WEB_CALL_STATES.ACTIVE&&(A.pc.close(),A.localStream.getTracks().forEach((e=>e.stop())),n.remove(A.callId),A=new v.default)}else i.handleIncomingSignalingMessage(e,t)}))(),isInitialized:()=>!0,registerVideoCallback:()=>{},cleanupVideoBuffer:()=>{},updateNetworkMedium:()=>{},registerWebRTCCallback:e=>{T=e},notifyDeviceIdentityChangedOrDeleted:()=>{},getNumParticipantsFromCallOffer:()=>Promise.resolve(-1)};var b;function P(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),e.buffer}function M(){return(M=(0,a.default)((function*(e,t){if(!c.default)throw new Error("Unable to request Media Devices.");const r=yield(0,c.default)({audio:!0,video:t}),n=(0,f.newTag)().substr(0,64);__LOG__(2)`voip:generateId: ${n}`;(yield(0,p.requireCallCollection)()).add({id:n,peerJid:e,offerTime:o.Clock.globalUnixTime(),isVideo:t,outgoing:!0,webClientShouldHandle:!0,canHandleLocally:!0});const i=P(),a=(0,l.assertGetMe)(),s=B(),{token:d,key:u,relay:h}=yield H(i,a,e.toString({legacy:!0}),n,t);r.getTracks().forEach((e=>s.addTrack&&s.addTrack(e,r))),A.localStream=r,s.onnegotiationneeded=()=>I(s,n,a,e,i,u,d,h,t,!0),s.ontrack=e=>R(e)}))).apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e,t,r,n,i,a,s,o){(yield(0,p.requireCallCollection)()).add({id:t,peerJid:r,offerTime:o,isVideo:e,outgoing:!1,webClientShouldHandle:!0,canHandleLocally:!0});const d=(0,l.assertGetMe)();if(u.CallUi.set({from:d,to:r,type:e?"video":"voice"}),g.default.openVoipWindow(),yield K(t,r.toString({legacy:!0}),e),!c.default)throw new Error("Unable to request Media Devices.");const h=yield(0,c.default)({audio:!0,video:e}),f=B();h.getTracks().forEach((e=>f.addTrack&&f.addTrack(e,h))),A.localStream=h,f.onnegotiationneeded=()=>I(f,t,d,r,n.buffer,i,a,s,e,!1),f.ontrack=e=>R(e)}))).apply(this,arguments)}function I(){return w.apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e,t,r,n,i,a,s,o,l,c){const[d,u]=yield x(t,r,n,i),[p,h,f,m]=yield G(t,r,n),g=yield e.createOffer();__LOG__(2,!0)`voip:original-offer: ${g.sdp}`,yield q(o,t,r.toString({legacy:!0}),n.toString({legacy:!0}),E.RELAY_INFO.RELAY_LATENCY),g.sdp&&(g.sdp=(0,_.modifyOfferSDP)(g.sdp,p,h,d,l)),__LOG__(2,!0)`voip:modified-offer: ${g.sdp}`,yield e.setLocalDescription(g),__LOG__(2,!0)`voip:localDescription: `;const y=(0,_.generateICELiteAnswerSDP)(o,s,a,f,m,u,l);__LOG__(2,!0)`voip:generated-answer: ${y.sdp}`,A.setState(c?E.WEB_CALL_STATES.OUTGOING_CALLING:E.WEB_CALL_STATES.INCOMING_CALLING),e.setRemoteDescription(y),A.pc=e,A.answer=y,A.callId=t,A.peerJid=n.toString({legacy:!0}),T&&T({type:E.WEB_CALL_EVENTS.MEDIA_READY,data:A.localStream})}))).apply(this,arguments)}function R(e){if(__LOG__(2)`voip:received-track`,!T)throw new Error("No Track callback registered.");"audio"===e.track.kind&&(A.remoteAudioStream=e.streams[0],T({type:E.WEB_CALL_EVENTS.AUDIO_TRACK_RECEIVED,data:e.streams[0]})),"video"===e.track.kind&&(A.remoteVideoStream=e.streams[0],T({type:E.WEB_CALL_EVENTS.VIDEO_TRACK_RECEIVED,data:e.streams[0]}))}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t,r,n){const i=new TextDecoder,a=yield d.extract(e,t);return d.expand(a,i.decode(r),n)}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t,r){const n=new TextEncoder,i=n.encode(e).buffer,a=n.encode(t).buffer,s=new Uint32Array([r]).buffer,o=yield D(i,s,a,32);return new Uint32Array(o)[0]}))).apply(this,arguments)}function G(e,t,r){const n=L(e,t.toString({legacy:!0,formatFull:!0}),0),i=L(e,r.toString({legacy:!0}),0),a=L(e,t.toString({legacy:!0,formatFull:!0}),2),s=L(e,r.toString({legacy:!0}),2);return Promise.all([n,a,i,s])}function U(){return F.apply(this,arguments)}function F(){return(F=(0,a.default)((function*(e,t){const r=new TextEncoder;return(yield D(e,d.DEFAULT_SALT,r.encode(t).buffer,46)).slice(0,30)}))).apply(this,arguments)}function x(e,t,r,n){const i=U(n,t.toString({legacy:!0,formatFull:!0})),a=U(n,r.toString({legacy:!0}));return Promise.all([i,a])}function B(){return new RTCPeerConnection({sdpSemantics:"unified-plan"},{mandatory:{},optional:[{DtlsSrtpKeyAgreement:!1},{RtpDataChannels:!1}]})}function K(e,t,r){const n=S.AUDIO_CODECS.DEFAULT,i=r?S.VIDEO_CODECS.DEFAULT:S.VIDEO_CODECS.NONE,a=["accept",{"call-id":e,"call-creator":t},n.concat(i).concat([["net",{medium:"3"},null],S.ENCOPT.DEFAULT])];return(0,h.sendCallSignalingMsg)({common:{type:"accept",call_id:e,peer_jid:t},payload:a})}function Y(e){return["terminate",{"call-id":e},null]}function j(){return(j=(0,a.default)((function*(e,t){const r=Y(e),n=r[0];yield(0,h.sendCallSignalingMsg)({common:{type:n,call_id:e,peer_jid:t},payload:r})}))).apply(this,arguments)}function W(e,t,r,n){const i=S.AUDIO_CODECS.DEFAULT,a=n?S.VIDEO_CODECS.DEFAULT:S.VIDEO_CODECS.NONE,s=i.concat(a);return["offer",{"call-id":t,"call-creator":r.toString({legacy:!0})},s.concat([["net",{medium:"3"},null],S.CAPABILITIES.DEFAULT,["enc",{count:"0"},Array.from(new Uint8Array(e))],S.ENCOPT.DEFAULT])]}function H(){return V.apply(this,arguments)}function V(){return(V=(0,a.default)((function*(e,t,r,n,i){const a=W(e,n,t,i),s=a[0];__LOG__(2)`voip:send:offer: payload:`;const o=yield(0,h.sendCallOffer)({common:{type:s,call_id:n,peer_jid:r},payload:a});if(!(null==o?void 0:o.status))throw new Error("Error receiving Offer Ack.");switch(o.status){case 200:if(o.payload){__LOG__(2)`voip:recv:offerAck:`;let e=null,t=null,r=null;for(const n of o.payload[2])"relay"===n[0]&&([e,t,r]=$(n));if(null==e||null==t||null==r)throw new Error("Error parsing relay attributes in Offer Ack");return{token:e,key:t,relay:r}}throw new Error("Error receiving Offer Ack: No Payload");case 409:throw new Error("Error receiving Offer Ack: Phone Busy");default:throw new Error(`Error receiving Offer Ack: Unknown status:${status}`)}}))).apply(this,arguments)}function $(e){let t=null,r=null,n=null;const i=new TextDecoder;for(const a of e[2])if("token"===a[0])t=new Uint8Array(a[2]),t=(0,s.encodeB64)(t),__LOG__(2)`voip:relay token: `;else if("key"===a[0])r=new Uint8Array(a[2]),r=i.decode(r),__LOG__(2)`voip:relay key: `;else if("te2"===a[0]){const e=new Uint8Array(a[2]);if(6===e.length){const t=new DataView(e.buffer);n={ip:[t.getUint8(0),t.getUint8(1),t.getUint8(2),t.getUint8(3)],port:t.getUint16(4)},__LOG__(2)`voip:relay address: `}}if(null==t)throw new Error("Could not extract relay token");if(null==r)throw new Error("Could not extract relay key");if(null==n)throw new Error("Could not extract relay address");return[t,r,n]}function z(e,t,r,n){const i=new ArrayBuffer(6),a=new DataView(i);a.setUint8(0,e.ip[0]),a.setUint8(1,e.ip[1]),a.setUint8(2,e.ip[2]),a.setUint8(3,e.ip[3]),a.setUint16(4,e.port);return[n,{"call-id":t,"call-creator":r},[["te",{latency:"10"},Array.from(new Int8Array(i))]]]}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t,r,n,i){const a=z(e,t,r,i),s=a[0];yield(0,h.sendCallSignalingMsg)({common:{type:s,call_id:t,peer_jid:n},payload:a})}))).apply(this,arguments)}t.Voip=C},69594:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(7293);var i={isVoiceCallEnabled:function(){let e=!1;return e=n.GK.supportsFeature(n.GK.F.WEB_VOIP_VOICE_CALL),e},isVideoCallEnabled:function(){let e=!1;return e=n.GK.supportsFeature(n.GK.F.WEB_VOIP_VIDEO_CALL),e},isGroupCallEnabled:function(){let e=!1;return e=!1,false},isStatefulEnumerationEnabled:function(){let e=!1;return n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&(e=getABPropConfigValue("web_abprop_stateful_enumeration_enabled")),e}};t.default=i},45473:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_STR=t.TYPE_NAME=t.TYPE=t.ENC_RETRY_RECEIPT_ATTRS=void 0;t.TYPE={NONE:0,OFFER:1,OFFER_RECEIPT:2,ACCEPT:3,REJECT:4,TERMINATE:5,TRANSPORT:6,OFFER_ACK:7,OFFER_NACK:8,RELAY_LATENCY:9,RELAY_ELECTION:10,INTERRUPTION:11,MUTE:12,PREACCEPT:13,ACCEPT_RECEIPT:14,VIDEO_STATE:15,NOTIFY:16,GROUP_INFO:17,ENC_REKEY:18,PEER_STATE:19,VIDEO_STATE_ACK:20,FLOW_CONTROL:21,WEB_CLIENT:22,ACCEPT_ACK:23,GROUP_UPDATE:24,OFFER_NOTICE:25,MAX:26};t.TYPE_STR={OFFER:"offer",ACCEPT:"accept",ENC_REKEY:"enc_rekey",REJECT:"reject",RECEIPT:"receipt",OFFER_NOTICE:"offer_notice"};t.TYPE_NAME=["NONE","OFFER","OFFER_RECEIPT","ACCEPT","REJECT","TERMINATE","TRANSPORT","OFFER_ACK","OFFER_NACK","RELAY_LATENCY","RELAY_ELECTION","INTERRUPTION","MUTE","PREACCEPT","ACCEPT_RECEIPT","VIDEO_STATE","NOTIFY","GROUP_INFO","ENC_REKEY","PEER_STATE","VIDEO_STATE_ACK","FLOW_CONTROL","WEB_CLIENT","ACCEPT_ACK","GROUP_UPDATE","OFFER_NOTICE","MAX"];t.ENC_RETRY_RECEIPT_ATTRS={SINGLE_PARTICIPANT:"enc",GROUP_CALL:"enc_rekey_retry"}},32968:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playEndCallTone=function(){}},49835:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_CALL_STATES=t.WEB_CALL_EVENTS=t.WAVideoCodecScheme=t.WACallState=t.WACallEvent=t.WACallEndReason=t.VoipSettingsType=t.VideoUpgradeRequestEndedReason=t.VideoState=t.VOIP_WINDOW_IPC_EVENTS=t.RENDERER_IPC_EVENTS=t.RELAY_INFO=t.PlatformTypeMapping=t.ParticipantState=t.MAIN_IPC_EVENTS=t.CallNetworkMedium=t.CALL_UI_STATES=t.CALL_STATES=t.CALL_RESULT_TYPE=t.CALL_LOG_RESULT_TYPE=t.CALL_LOG_RESULT=void 0;t.WACallEvent={WANone:0,CallOfferSent:1,CallOfferReceived:2,CallOfferAckedWithRelayInfo:3,CallOfferNacked:4,CallOfferReceiptReceived:5,CallAcceptFailed:6,CallAcceptSent:7,CallAcceptReceived:8,CallPreacceptReceived:9,CallTerminateReceived:10,CallRejectReceived:11,CallOfferResend:12,AudioStreamStarted:13,P2PNegotiationSuccess:14,RelayCreateSuccess:15,CallStateChanged:16,P2PNegotiationFailed:17,MediaStreamError:18,AudioInitError:19,NoSamplingRatesForAudioRecord:20,SendOfferFailed:21,HandleOfferFailed:22,SendAcceptFailed:23,HandlePreAcceptFailed:24,HandleAcceptFailed:25,WillCreateSoundPort:26,SoundPortCreateFailed:27,TransportCandSendFailed:28,P2PTransportCreateFailed:29,P2PTransportMediaCreateFailed:30,P2PTransportStartFailed:31,P2PTransportRestartSuccess:32,MissingRelayInfo:33,ErrorGatheringHostCandidates:34,MediaStreamStartError:35,RelayLatencySendFailed:36,RelayElectionSendFailed:37,CallEnding:38,CallCaptureBufferFilled:39,CallCaptureEnded:40,RxTimeout:41,TxTimeout:42,RxTrafficStarted:43,RxTrafficStopped:44,RTCPPacketReceived:45,RTCPByeReceived:46,RelayBindsFailed:47,SoundPortCreated:48,AudioDriverRestart:49,Echo:50,SelfVideoStateChanged:51,PeerVideoStateChanged:52,VideoPortCreated:53,VideoPortCreateFailed:54,VideoDecodeStarted:55,VideoRenderStarted:56,VideoCaptureStarted:57,VideoPreviewFailed:58,VideoPreviewReady:59,VideoPreviewShouldMinimize:60,VideoStreamCreateError:61,VideoRenderFormatChanged:62,VideoCodecMismatch:63,VideoDecodePaused:64,VideoDecodeResumed:65,VideoEncodeFatalError:66,VideoDecodeFatalError:67,BatteryLevelLow:68,PeerBatteryLevelLow:69,GroupInfoChanged:70,FieldstatsReady:71,PendingCallInfoChanged:72,MuteStateChanged:73,InterruptionStateChanged:74,RxTrafficStateForPeerChanged:75,HandleAcceptReceiptFailed:76,GroupParticipantLeft:77,AudioRouteChangeRequest:78,HandleAcceptAckFailed:79,CallMissed:80,WeakWiFiSwitchedToCellular:81,CallAutoConnect:82,RejectedDecryptionFailure:83,PeerDeviceOrientationChanged:84,HandleOfferAckFailed:85,PendingCallAutoRejected:86,FDLeakDetected:87,RestartCamera:88,AudioTestReplayFinished:89,SyncDevices:90,VideoCodecStateChanged:91,CallFatal:92,UpdateJoinableCallLog:93,WAMax:94};t.WAVideoCodecScheme={VideoCodecSchemeNone:0,VideoCodecSchemeH26X:1,VideoCodecSchemeVPX:2,VideoCodecSchemeVPXH26X:3};t.WACallEndReason={WACallEndReasonUnknown:0,WACallEndReasonEndButtonTapped:1,WACallEndReasonEndButtonTappedOnBusy:2,WACallEndReasonReject:3,WACallEndReasonRejectUnavailable:4,WACallEndReasonRejectBlocked:5,WACallEndReasonTimeout:6,WACallEndReasonPeerUnavailable:7,WACallEndReasonRejectedByPeer:8,WACallEndReasonTimedoutByPeer:9,WACallEndReasonTerminatedByPeer:10,WACallEndReasonFailed:11,WACallEndReasonHandledRemotely:12};t.WACallState={WACallStateNone:0,WACallStateCalling:1,WACallStatePreacceptReceived:2,WACallStateReceivedCall:3,WACallStateAcceptSent:4,WACallStateAcceptReceived:5,WACallStateCallActive:6,WACallStateCallActiveElseWhere:7,WACallStateReceivedCallWithoutOffer:8};t.CALL_UI_STATES={NONE:"NONE",OUTGOING_RING:"OUTGOING_RING",INCOMING_RING:"INCOMING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",RECONNECTING:"RECONNECTING",ACTIVE:"ACTIVE",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED"};t.CALL_STATES={INCOMING_RING:"INCOMING_RING",OUTGOING_RING:"OUTGOING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",CONNECTION_LOST:"CONNECTION_LOST",ACTIVE:"ACTIVE",HANDLED_REMOTELY:"HANDLED_REMOTELY",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED",NOT_ANSWERED:"NOT_ANSWERED"};t.WEB_CALL_STATES={OUTGOING_CALLING:"OUTGOING_CALLING",INCOMING_CALLING:"INCOMING_CALLING",ACTIVE:"ACTIVE",NONE:"NONE"};t.WEB_CALL_EVENTS={MEDIA_READY:"MEDIA_STREAM_READY",AUDIO_TRACK_RECEIVED:"AUDIO_TRACK_RECEIVED",VIDEO_TRACK_RECEIVED:"VIDEO_TRACK_RECEIVED"};t.VOIP_WINDOW_IPC_EVENTS={INIT:"VOIP_WINDOW_INIT",UPDATE:"VOIP_WINDOW_UPDATE",REJECT:"VOIP_WINDOW_REJECT",ACCEPT:"VOIP_WINDOW_ACCEPT",IGNORE:"VOIP_WINDOW_IGNORE",END:"VOIP_WINDOW_END",RESET:"VOIP_WINDOW_RESET",TOGGLE_MUTE:"VOIP_WINDOW_TOGGLE_MUTE",TOGGLE_CAMERA:"VOIP_WINDOW_TOGGLE_CAMERA",OPEN_IN_CALL_MENU:"OPEN_IN_CALL_MENU",CLOSE_IN_CALL_MENU:"CLOSE_IN_CALL_MENU",TOGGLE_DEBUG_INFO:"TOGGLE_DEBUG_INFO",GROUP_CALL_INVITE:"GROUP_CALL_INVITE",UPGRADE_REQUEST:"UPGRADE_REQUEST",UPGRADE_ACCEPT:"UPGRADE_ACCEPT",UPGRADE_REJECT:"UPGRADE_REJECT",UPGRADE_CANCEL:"UPGRADE_CANCEL",INITIATE_WINDOW_MOVE:"INITIATE_WINDOW_MOVE",CLOSE_WINDOW_CLICK:"CLOSE_WINDOW_CLICK",MINIMIZE_WINDOW_CLICK:"MINIMIZE_WINDOW_CLICK",MAXIMIZE_WINDOW_CLICK:"MAXIMIZE_WINDOW_CLICK",UNMAXIMIZE_WINDOW_CLICK:"UNMAXIMIZE_WINDOW_CLICK",WINDOW_MAXIMIZED:"WINDOW_MAXIMIZED",WINDOW_UNMAXIMIZED:"WINDOW_UNMAXIMIZED",WINDOW_TITLE_DBL_CLICK:"WINDOW_TITLE_DBL_CLICK",WINDOW_ESC_PRESS:"WINDOW_ESC_PRESS",WINDOW_ALWAYS_ON_TOP_CHANGED:"WINDOW_ALWAYS_ON_TOP_CHANGED",L10N_UPDATE:"L10N_UPDATE"};t.MAIN_IPC_EVENTS={EVENT:"VOIP_MAIN_WINDOW_EVENT",SIGNALING:"VOIP_MAIN_WINDOW_SIGNALING",LOGGING:"VOIP_MAIN_WINDOW_LOGGING",LOG_PATH:"VOIP_MAIN_WINDOW_LOG_PATH",AV_EVENT:"AV_DEVICE_INFO_CHANGED",AV_LOG:"AV_MAIN_WINDOW_LOGGING",AV_DEVICE_CHANGE_TOAST:"AV_DEVICE_CHANGE_TOAST",AV_DEVICE_STATUS_CHANGE:"AV_DEVICE_STATUS_CHANGE"};t.RENDERER_IPC_EVENTS={ENABLE_VOIP_FEATURES:"voip:ENABLE_VOIP_FEATURES",ENABLE_VOIP_GROUP_FEATURES:"voip:ENABLE_VOIP_GROUP_FEATURES",REQUEST_NUM_PARTICIPANTS:"voip:REQUEST_NUM_PARTICIPANTS"};t.CALL_RESULT_TYPE={INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23};t.CALL_LOG_RESULT={0:"invalid",1:"canceled",2:"missed",3:"unavailable",4:"reject",5:"connected"};t.CALL_LOG_RESULT_TYPE={INVALID:0,CANCELED:1,MISSED:2,UNAVAILABLE:3,REJECT:4,CONNECTED:5};t.VoipSettingsType={voipSettingsNone:0,voipSettingsAudio:1,voipSettingsVideo:2};t.VideoState={VideoStateDisabled:0,VideoStateEnabled:1,VideoStatePaused:2,VideoStateUpgradeRequest:3,VideoStateUpgradeAccept:4,VideoStateUpgradeReject:5,VideoStateStopped:6,VideoStateUpgradeRejectByTimeout:7,VideoStateUpgradeCancel:8,VideoStateUpgradeCancelByTimeout:9,VideoStateError:20};t.VideoUpgradeRequestEndedReason={EndedByUser:0,EndedByTimeout:1};t.ParticipantState={ParticipantStateInvalid:0,ParticipantConnected:1,ParticipantIncoming:2,ParticipantRinging:3,ParticipantRejected:4,ParticipantTerminated:5,ParticipantTimedout:6,ParticipantCreatingCall:7,ParticipantInvisible:8,ParticipantVisible:9,ParticipantCancelOffer:10};t.CallNetworkMedium={CallNetworkMediumCellular:1,CallNetworkMediumWifi:2,CallNetworkMediumNone:3};t.PlatformTypeMapping={0:"unknown",1:"android",2:"iphone",3:"wp",4:"ios_tablet",5:"kaios",6:"windows",7:"portal",8:"mac_os_electron",9:"windows_electron"};t.RELAY_INFO={RELAY_ELECTION:"relayelection",RELAY_LATENCY:"relaylatency"}},24746:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_CODECS=t.ENCOPT=t.CAPABILITIES=t.AUDIO_CODECS=void 0;t.CAPABILITIES={DEFAULT:["capability",{ver:"1"},[1,4,255,131,207,4]]};t.ENCOPT={DEFAULT:["encopt",{keygen:"2"},null]};t.AUDIO_CODECS={DEFAULT:[["audio",{enc:"opus",rate:"16000"},null],["audio",{enc:"opus",rate:"8000"},null]],RATE_16K:[["audio",{enc:"opus",rate:"16000"},null]]};t.VIDEO_CODECS={NONE:[],DEFAULT:[["video",{orientation:"0",screen_width:"1920",screen_height:"1080",device_orientation:"0",enc:"vp8",dec:"vp8"},null]]}},91214:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitDeviceLinkEvent=function(){return _.apply(this,arguments)},t.initDeviceLinkEvent=function(e,t,r){u=new l.default.MdLinkDeviceCompanion,p={regStartTime:r,accountSignature:e,identityKey:t}},t.setDeviceLinkPairStage=function(e){if(!u)return;u.set({mdLinkDeviceCompanionStage:e})};var i=n(r(48926)),a=r(15688),s=r(8584),o=r(92844),l=n(r(11339)),c=r(58052),d=n(r(42810));let u=null,p=null;function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const r=new s.Binary;r.writeBuffer(e),r.write("_".charCodeAt(0)),r.writeBuffer(t);const n=r.readByteArray(),i=yield d.default.digest({name:"SHA-256"},n);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=(0,c.getUpgradeMdWamFlag)();if(!u||!p)return;const r=u,n=p,i=yield h(p.accountSignature,p.identityKey),a=(0,o.unixTime)()-n.regStartTime;r.set({mdDurationS:a,mdSessionId:i,mdTimestampS:n.regStartTime,mdWasUpgraded:t,mdLinkDeviceCompanionErrorCode:null==e?0:e}),r.commit(),u=null,p=null,(0,c.setUpgradeMdWamFlag)(!1)}))).apply(this,arguments)}},7902:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(71378)),a=n(r(11339));var s=new class{constructor(){this.logToWam()}logToWam(){const e=i.default.getAutoToolsProperties(),t={webcDocumentWebdriverEvaluate:e.data.dKeys.__webdriver_evaluate,webcDocumentSeleniumEvaluate:e.data.dKeys.__selenium_evaluate,webcDocumentWebdriverScriptFunction:e.data.dKeys.__webdriver_script_function,webcDocumentWebdriverScriptFunc:e.data.dKeys.__webdriver_script_func,webcDocumentWebdriverScriptFn:e.data.dKeys.__webdriver_script_fn,webcDocumentFxdriverEvaluate:e.data.dKeys.__fxdriver_evaluate,webcDocumentDriverUnwrapped:e.data.dKeys.__driver_unwrapped,webcDocumentWebdriverUnwrapped:e.data.dKeys.__webdriver_unwrapped,webcDocumentDriverEvaluate:e.data.dKeys.__driver_evaluate,webcDocumentSeleniumUnwrapped:e.data.dKeys.__selenium_unwrapped,webcDocumentFxdriverUnwrapped:e.data.dKeys.__fxdriver_unwrapped,webcDocumentElementAttrSelenium:e.data.dElKeys.selenium,webcDocumentElementAttrWebdriver:e.data.dElKeys.webdriver,webcDocumentElementAttrDriver:e.data.dElKeys.driver,webcWindowPhantom:e.data.wKeys._phantom,webcWindowNightmare:e.data.wKeys.__nightmare,webcWindowSelenium:e.data.wKeys._selenium,webcWindowCallphantom:e.data.wKeys.callPhantom,webcWindowCallselenium:e.data.wKeys.callSelenium,webcWindowSeleniumIdeRecorder:e.data.wKeys._Selenium_IDE_Recorder,webcWindowNavigatorWebdriver:!0===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.TRUE:!1===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.FALSE:a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.UNDEFINED};new a.default.WebcFingerprint(t).commit()}};t.default=s},50047:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logLabelOperationEvent=function(e,t,r){const n={labelOperation:e};null!=t&&Object.assign(n,{labelCount:t});r&&Object.assign(n,{labelTarget:r});new i.default.LabelEvent(n).commit()};var i=n(r(11339))},88353:(e,t,r)=>{"use strict";t.I=void 0;var n=r(15688),i=r(8584),a=r(87278),s=r(55021);const o=r(11339).default;t.I=class{constructor(e,t,r,n){this.bufferKey=e,this.buffer=new i.Binary(void 0,!0),this.buffer.writeString("WAM");const a=(0,s.getWamProtocolVersion)();this.buffer.writeUint8(a),a>=5&&(this.buffer.writeUint8(1),this.buffer.writeUint16(t),"regular"===this.bufferKey?this.buffer.writeUint8(0):this.buffer.writeUint8(2),this.psIdStore=r),this.eventsWritten=0,this.prevGlobals={},this.dirtyGlobals={},this.unsavedPortion=null,this.saveKey=String(1e9*Math.random()|0),n&&this._setAll(n)}size(){return this.buffer.size()}set(e,t){this.dirtyGlobals[String(e)]=t,this.unsavedPortion&&this.unsavedPortion.set(e,t)}write(e){const t=this.buffer;var r;(this.set(47,e.commitTime),this.set(3433,e.sequenceNumber),"private"===e.wamChannel)&&this.set(6005,null===(r=this.psIdStore)||void 0===r?void 0:r.getLatestPrivateStatsIdValueFromKey(this.bufferKey).toString());this._flushGlobals();const n=e.all,i=Object.keys(n);let s=-1,l=!1;for(let e=0;e<i.length;e++){null!=n[i[e]]&&(s=e,l=!0)}(0,a.writeEvent)(t,e.id,-e.weight,l);for(let r=0;r<=s;r++){const c=i[r],d=o.METRICS.getEvent(e.$className,c).id;let u=n[c];null!=u&&("boolean"==typeof u&&(u=u?1:0),l=r<s,(0,a.writeField)(t,d,u,l))}this.eventsWritten++,this.unsavedPortion&&this.unsavedPortion.write(e)}stringBuffer(){return this.eventsWritten>0?(0,n.encodeB64)(this.buffer.peek((e=>e.readByteArray()))):""}getBuffer(){return this.buffer}_setAll(e){const t="regular"===this.bufferKey?"regular":"private";for(const r in e){const n=e[r],i=o.METRICS.getGlobal(r).channels.includes(t);void 0!==n&&i&&this.set(o.METRICS.getGlobal(r).id,n)}}_flushGlobals(){const e=this.dirtyGlobals,t=this.prevGlobals;for(const r in e){let n=e[r];if("boolean"==typeof n)n=n?1:0;else if(void 0===n)n=null;else if(Number.isNaN(n))continue;if(n!==t[r]){t[r]=n;const e=parseInt(r,10);(0,a.writeGlobalAttribute)(this.buffer,e,n)}}this.dirtyGlobals={}}upgradeWamHeaderFromV3ToV5(e){if(!r(86945).getABPropConfigValue("web_wam_v5_enabled")||this.buffer.size()<4)return this.buffer;const[t,n]=this.buffer.peek((e=>[e.readString(3),e.readUint8()]));if(3===n){const r=new i.Binary(void 0,!0);r.writeString(t),r.writeUint8(5),r.writeUint8(1),r.writeUint16(e),"regular"===this.bufferKey?r.writeUint8(0):r.writeUint8(2);const n=this.buffer.peek((e=>e.readByteArray())).slice(4);r.write(n),this.buffer=r}return this.buffer}}},87278:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeEvent=function(e,t,r,n){return i(e,t,r,n?1:5)},t.writeField=function(e,t,r,n){return i(e,t,r,n?2:6)},t.writeGlobalAttribute=function(e,t,r){return i(e,t,r,0)};var n=r(8584);function i(e,t,r,i){if(null==r)0===i&&a(e,t,i);else if("number"==typeof r&&r===(0|r))0===r?a(e,t,16|i):1===r?a(e,t,32|i):-128<=r&&r<128?(a(e,t,48|i),e.writeInt8(r)):-32768<=r&&r<32768?(a(e,t,64|i),e.writeInt16(r)):(a(e,t,80|i),e.writeInt32(r));else if("number"==typeof r)a(e,t,112|i),e.writeFloat64(r);else if("string"==typeof r){const s=(0,n.numUtf8Bytes)(r);s<256?(a(e,t,128|i),e.writeUint8(s)):s<65536?(a(e,t,144|i),e.writeUint16(s)):(a(e,t,160|i),e.writeUint32(s)),e.writeString(r)}}function a(e,t,r){t<256?(e.writeUint8(r),e.writeUint8(t)):(e.writeUint8(8|r),e.writeUint16(t))}},34894:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11339));const a={document:i.default.MEDIA_TYPE.DOCUMENT,video:i.default.MEDIA_TYPE.VIDEO,gif:i.default.MEDIA_TYPE.GIF,image:i.default.MEDIA_TYPE.PHOTO,audio:i.default.MEDIA_TYPE.AUDIO};t.default=class{constructor(e,t,r){this.mediaPickerSentUnchanged=0,this.mediaPickerDeleted=0,this.mediaPickerChanged=new Set,this.mediaPickerCroppedRotated=new Set,this.mediaPickerDrawing=new Set,this.mediaPickerStickers=new Set,this.mediaPickerText=new Set,this.mediaPickerLikeDoc=0,this.mediaPickerNotLikeDoc=0,this.mediaPickerT=0,this.t0=Date.now(),this.mediaType=a[t],this.mediaPickerOrigin=r,this.medias=new Set,this.medias.add(e),this.changeTypes={mediaPickerCroppedRotated:this.mediaPickerCroppedRotated,mediaPickerDrawing:this.mediaPickerDrawing,mediaPickerStickers:this.mediaPickerStickers,mediaPickerText:this.mediaPickerText}}onAdd(e){this.medias.add(e),"document"===this.mediaType?this.mediaPickerLikeDoc++:this.mediaPickerNotLikeDoc++}onChange(e,t){this.mediaPickerChanged.add(e),this.changeTypes[t].add(e)}onDelete(e){if(this.medias.delete(e),this.mediaPickerDeleted++,0===this.medias.size)return this.onCancel()}onSend(){return this.mediaPickerSent=this.medias.size,this.mediaPickerSentUnchanged=this.mediaPickerSent-this.mediaPickerChanged.size,this.dataPreflight()}onCancel(){return this.mediaPickerSent=0,this.mediaPickerSentUnchanged=0,this.dataPreflight()}onPause(){this.mediaPickerT+=Date.now()-(this.t0||0),this.t0=null}onResume(){this.t0=null!=this.t0?this.t0:Date.now()}dataPreflight(){let e=this.mediaPickerSentUnchanged;return isNaN(e)&&(e=0,__LOG__(4,void 0,new Error,!0)`mediaPickerSentUnchange mediaPickerSent: ${null!=this.mediaPickerSent&&0!==this.mediaPickerSent?this.mediaPickerSent:"undefined"}, mediaPickerChanged: ${this.mediaPickerChanged.size||"undefined"}`,SEND_LOGS("mediaPickerSentUnchange is not a number")),{mediaPickerSent:this.mediaPickerSent,mediaPickerSentUnchanged:e,mediaPickerT:this.mediaPickerT+(Date.now()-(this.t0||0)),mediaType:this.mediaType,mediaPickerOrigin:this.mediaPickerOrigin,mediaPickerChanged:this.mediaPickerChanged.size,mediaPickerCroppedRotated:this.mediaPickerCroppedRotated.size,mediaPickerDrawing:this.mediaPickerDrawing.size,mediaPickerStickers:this.mediaPickerStickers.size,mediaPickerText:this.mediaPickerText.size,mediaPickerLikeDoc:this.mediaPickerLikeDoc,mediaPickerNotLikeDoc:this.mediaPickerNotLikeDoc,mediaPickerDeleted:this.mediaPickerDeleted}}}},90535:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPickerStatsLogger=t.MediaPickerChangeTypes=void 0;var i=n(r(81109)),a=n(r(34894)),s=n(r(11339));t.MediaPickerChangeTypes={mediaPickerCroppedRotated:"mediaPickerCroppedRotated",mediaPickerDrawing:"mediaPickerCroppedRotated",mediaPickerStickers:"mediaPickerCroppedRotated",mediaPickerText:"mediaPickerCroppedRotated"};t.MediaPickerStatsLogger=class{constructor(){this.mediaByTypeAndOrigin=new Map,this.mediaEventReverseIndex=new Map,this.chatRecipients=null}pauseTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onPause()}))}resumeTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onResume()}))}_getKey(e,t){return`${e}_${t}`}_commitLog(e){new s.default.MediaPicker((0,i.default)((0,i.default)({},e),{},{chatRecipients:this.chatRecipients})).commit()}_processNewMedia(e,t,r){const n=this._getKey(t,r),i=this.mediaByTypeAndOrigin.get(n);if(i)i.onAdd(e),this.mediaEventReverseIndex.set(e,i);else{const i=new a.default(e,t,r);this.mediaByTypeAndOrigin.set(n,i),this.mediaEventReverseIndex.set(e,i)}}logChange(e,t){const r=this.mediaEventReverseIndex.get(e);r&&r.onChange(e,t)}logDelete(e){const t=this.mediaEventReverseIndex.get(e);t&&t.onDelete(e)}logSend(){this.mediaByTypeAndOrigin.forEach((e=>{this._commitLog(e.onSend())}))}logCancel(){this.mediaByTypeAndOrigin.forEach((e=>{this._commitLog(e.onCancel())}))}logAdd(e,t,r){this.mediaEventReverseIndex.get(e)||this._processNewMedia(e,t,r)}}},29992:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateMediaEventId=function(){return 1+Math.floor(Number.MAX_SAFE_INTEGER*Math.random())},t.getMetricBackendStore=function(e){if(!e)return o.default.BACKEND_STORE_TYPE.NON_DIRECT_PATH;switch(e.slice(0,2).toLowerCase()){case"/v":return o.default.BACKEND_STORE_TYPE.EVERSTORE;case"/o":return o.default.BACKEND_STORE_TYPE.OIL}return __LOG__(4,void 0,new Error,!0)`Unrecognized direct path type`,SEND_LOGS("unrecognized-direct-path-type"),null},t.getMetricDownloadErrorResultType=function(e){if(e instanceof s.MMSThrottleError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof a.NoMediaHostsError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e instanceof s.HttpNetworkError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_NETWORK;if(e instanceof s.HttpStatusCodeError)switch(e.status){case 404:case 410:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_TOO_OLD;case 416:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANNOT_RESUME;case 401:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_INVALID_URL;case 429:case 507:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;default:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN}if(e.name===i.ABORT_ERROR)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof s.MmsDownloadFilehashMismatchError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_ENC_HASH_MISMATCH;return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getMetricMediaType=function(e){switch(e){case"audio":return o.default.MEDIA_TYPE.AUDIO;case"document":case"thumbnail-document":return o.default.MEDIA_TYPE.DOCUMENT;case"gif":return o.default.MEDIA_TYPE.GIF;case"image":case"thumbnail-image":return o.default.MEDIA_TYPE.PHOTO;case"ppic":return o.default.MEDIA_TYPE.PROFILE_PIC;case"product":return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case"ptt":return o.default.MEDIA_TYPE.PTT;case"sticker":return o.default.MEDIA_TYPE.STICKER;case"video":case"thumbnail-video":return o.default.MEDIA_TYPE.VIDEO;case"template":return o.default.MEDIA_TYPE.TEMPLATE;case"md-msg-hist":return o.default.MEDIA_TYPE.MD_HISTORY_SYNC;case"md-app-state":return o.default.MEDIA_TYPE.MD_APP_STATE;case"product-catalog-image":return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case"thumbnail-link":return o.default.MEDIA_TYPE.URL;default:throw new Error(`webMediaType is invalid: ${e}`)}},t.getMetricOverallDownloadModeType=function(e){if(l(e))return o.default.MEDIA_DOWNLOAD_MODE_TYPE.THUMBNAIL;return o.default.MEDIA_DOWNLOAD_MODE_TYPE.FULL},t.getMetricOverallUploadModeType=function(e){if(l(e))return o.default.MEDIA_UPLOAD_MODE_TYPE.THUMBNAIL;return o.default.MEDIA_UPLOAD_MODE_TYPE.REGULAR},t.getMetricUploadErrorResultType=function(e){if(e instanceof s.MMSUnauthorizedError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_NO_PERMISSIONS;if(e instanceof s.MediaTooLargeError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_BAD_MEDIA;if(e instanceof s.MMSThrottleError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof s.HttpStatusCodeError&&e.status>=500)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_SERVER;if(e instanceof a.NoMediaHostsError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e.name===i.ABORT_ERROR)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof s.HttpNetworkError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UPLOAD;return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getStatusCode=function(e){if(e instanceof s.HttpStatusCodeError)return e.status},t.logErrorUnknownDetails=function(e,t){if(null==t)return;let r;e.overallDownloadResult===o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN?r=o.default.WEBC_MEDIA_OPERATION_CODE.DOWNLOAD:e.overallUploadResult===o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN&&(r=o.default.WEBC_MEDIA_OPERATION_CODE.UPLOAD);if(null==r)return;new o.default.WebcMediaErrorUnknownDetails({mediaId:e.mediaId,webcMediaOperation:r,webcMediaErrorName:t.name}).commit()};var i=r(89385),a=r(40859),s=r(27856),o=n(r(11339));function l(e){switch(e){case"thumbnail-document":case"thumbnail-image":case"thumbnail-video":case"thumbnail-link":return!0}return!1}},30097:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendPerfReporter=void 0;var i=n(r(11339)),a=n(r(57362));t.MessageSendPerfReporter=class{constructor(e,t,r){this._messageIsInvisible=!1,this._messageIsFirstUserMessage=!1,this._startTime=Date.now(),this._stagesMap=new Map,this._mediaType=t,this._messageType=r,this._cacheGroupMetadata(e)}setFetchedPrekeyCount(e){this._fetchedPrekeyCount=e}setSenderKeyDistributionCount(e){this._senderKeyDistributionCount=e}setMessageIsInvisible(e){this._messageIsInvisible=e}setMessageIsFirstUserMessage(e){this._messageIsFirstUserMessage=e}startRenderedStage(){this._start(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}postRenderedStage(){this._post(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}startSavedStage(){this._start(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}postSavedStage(){this._post(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}startPrekeysFetchStage(){this._start(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}postPrekeysFetchStage(){this._post(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}startWrittenWireStage(){this._start(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}postWrittenWireStage(){this._post(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}startReadyToSendStage(){this._start(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}postReadyToSendStage(){this._post(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}startClientEncryptStage(){this._start(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}postClientEncryptStage(){this._post(i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}_start(e){const t=new i.default.AndroidMessageSendPerf({sendStage:e});return this._stagesMap.set(e,t),t}_post(e){const t=this._stagesMap.get(e)||this._start(e);if(t.mediaType=this._mediaType,t.messageType=this._messageType,t.messageIsInvisible=this._messageIsInvisible,t.messageIsFirstUserMessage=this._messageIsFirstUserMessage,t.durationRelative=Date.now()-this._startTime,t.fetchPrekeys=null!=this._fetchedPrekeyCount&&this._fetchedPrekeyCount>0,this._groupMetadata){t.groupSizeBucket=(0,a.default)(this._groupMetadata.participants.length),null!=this._groupMetadata.cachedDeviceSizeBucket&&(t.deviceSizeBucket=this._groupMetadata.cachedDeviceSizeBucket);const e=this._groupMetadata.cachedDeviceCount||0;e>0&&(null!=this._fetchedPrekeyCount&&(t.fetchPrekeysPercentage=Math.round(this._fetchedPrekeyCount/e*100)),null!=this._senderKeyDistributionCount&&(t.senderKeyDistributionCountPercentage=Math.round(this._senderKeyDistributionCount/e*100)))}e===i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE&&null!=t.fetchPrekeysPercentage&&t.fetchPrekeysPercentage>=50?t.weight=0:e===i.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE&&null!=t.senderKeyDistributionCountPercentage&&t.senderKeyDistributionCountPercentage>=50&&(t.weight=20),t.markDurationAbs(),t.commit()}_cacheGroupMetadata(e){if(null!=e&&e.isGroup()){const t=r(63928).default.get(e);null!=t&&(this._groupMetadata=t)}}}},11339:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(52211);const{BOOLEAN:s,INTEGER:o,NUMBER:l,STRING:c,TIMER:d}=a.TYPES,u=Object.freeze({INVALID_PROTOCOL_BUFFER:1}),p=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_DEVICE_IDENTITY:2,ADV_SIGNED_KEY_INDEX_LIST:3,ADV_KEY_INDEX_LIST:4}),h=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),f=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),_=Object.freeze({LIMITED:0,FULL:1,LEGACY:2,LEVEL_3:3,EXTERNAL:4}),m=Object.freeze({API_1:1,API_2:2}),g=Object.freeze({NOT_AVAILABLE:1,SELF_TEST_FAILURE:2,ENC_KEY_READ_FAILURE:3,ENC_KEY_STORED_USED:4,ENC_KEY_PLAIN_DELETED:5,ENC_KEY_PLAIN_RECOVERED:6}),y=Object.freeze({DEBUG:1,ALPHA:2,BETA:3,RELEASE:4}),E=Object.freeze({FOREGROUND:1,BACKGROUND:2}),S=Object.freeze({JNI:1,OPENSLES:2}),v=Object.freeze({AUTO_REPLY_ACTION_FLAG_RECEIVED:0,AUTO_REPLY_ACTION_REPLY_SENT:1}),T=Object.freeze({NON_DIRECT_PATH:1,EVERSTORE:2,OIL:3}),A=Object.freeze({WIFI_ONLY:0,WIFI_OR_CELLULAR:1}),C=Object.freeze({OFF:0,DAILY:1,WEEKLY:2,MONTHLY:3,MANUAL:4}),b=Object.freeze({SHOWN:1,CLICK:2,DISMISS:3,ELIGIBLE:4,REVOKED:5}),P=Object.freeze({GROUP:1,SMB_WELCOME:2,SMB_VERIFIED:3,SMB_EDIT_PROFILE:4,SMB_EDIT_DESCRIPTION:5,SMB_EDIT_CATEGORY:6,SMB_EDIT_HOURS:7,SMB_EDIT_EMAIL:8,SMB_CATALOG:9,SMB_CATALOG_SHARE_BANNER:10,CROSS_SELL_PROFILE_INTERSTITIAL:11,CROSS_SELL_CHATS_INTERSTITIAL:12,CROSS_SELL_CHATS_BANNER:13,BUSINESS_ACCOUNT_SYSTEM_MESSAGE:14,SMB_CATALOG_CART_INTERSTITIAL:15,PAYMENTS_ONBOARD_BANNER:16,SMB_DIRECTORY_UPSELL:17,SMB_CATALG_LIST_LWI_ADVERTISE_BANNER:18,SMB_LWI_AD_HUB_EDUCATIONAL_BANNER:19,SMB_COLLECTION_CREATION:20,SMB_AWAY_MESSAGE:21,SMB_GREETING_MESSAGE:22,PAYMENTS_INCENTIVE_BANNER:23,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITH_VALID_PRODUCT:24,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITHOUT_VALID_PRODUCT:25,SMB_MD_AWARENESS:26,BACKUP_QUOTA:27,SMB_ADD_COVER_PHOTO:28}),M=Object.freeze({SHOPS:0,NATIVE:1}),O=Object.freeze({UNKNOWN:1,SMB:2,ENT:3}),I=Object.freeze({OTHER:0,CHAT:1,PROFILE:2,BLOCK_LIST:3,TRIGGERED_BLOCK:4,ACCOUNT_INFO:5,CALL_LOG:6,OVERFLOW_MENU:7,GROUP_INFO:8,BLOCK_DIALOG:9,MESSAGE_MENU:10,MEDIA_VIEWER:11}),w=Object.freeze({OTHER:0,NO_LONGER_NEEDED:1,NO_SIGN_UP:2,SPAM:3,OFFENSIVE_MESSAGES:4,OTP_DID_NOT_REQUEST:5}),R=Object.freeze({REQUEST_BUILT:1,RESPONSE_RECEIVED:2,RESPONSE_PARSED_VALID:3,MISSING_KEYS_REQUESTED:4,MISSING_KEYS_RECEIVED:5,MUTATIONS_DECRYPTED:6,ABOUT_TO_APPLY_MUTATIONS:7,APPLIED_MUTATIONS:8,PUSHNAME_APPLIED:9,PUSHNAME_INVALID:10,ENTERED_RETRY_MODE:11}),D=Object.freeze({IMPRESSION:0,TAP_ON_MESSAGE:1,TAP_ON_PROFILE:2,TAP_ON_CATALOG_VIEW_ALL:3,TAP_ON_CATLOG_PRODUCT:4,DISMISS_PREVIEW:5}),N=Object.freeze({REGISTRATION:1,SETTINGS:2,COMPLIANCE:3,QUICK_REPLY_SMART_DEFAULT:4}),L=Object.freeze({DESCRIPTION:1,HOURS:2,ADDRESS:3,EMAIL:4,WEBSITE:5,CATEGORY:6,PROFILE:7}),k=Object.freeze({BUSINESS_PROFILE_VIEW_ACTION_IMPRESSION:1,BUSINESS_PROFILE_VIEW_ACTION_CLICK_WEBSITE:2,BUSINESS_PROFILE_VIEW_ACTION_CLICK_LOCATION:3,BUSINESS_PROFILE_VIEW_ACTION_CLICK_HOURS:4,BUSINESS_PROFILE_VIEW_ACTION_CLICK_DESCRIPTION:5,BUSINESS_PROFILE_VIEW_ACTION_CLICK_EMAIL:6,BUSINESS_PROFILE_VIEW_ACTION_CLICK_ADDTOCONTACT:7,BUSINESS_PROFILE_VIEW_ACTION_CLICK_MORE_BIZ_PROFILE:8}),G=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),U=Object.freeze({ENTRY_BANNER:0,ENTRY_REGISTRATION_ONBOARDING:1,ENTRY_CONVERSATIONS:2,ENTRY_SETTINGS:3,ENTRY_DEEPLINK:4,ENTRY_STATUS_TAB_MENU:5,ENTRY_CALLS_TAB_MENU:6}),F=Object.freeze({OVERFLOW:0,PROFILE:1,CATALOG:2,AWAY_MESSAGE:3,GREETING_MESSAGE:4,QUICK_REPLIES:5,LABELS:6,LINKED_ACCOUNTS:7,SHORT_LINK:8,STATISTICS:9,CREATE_ACCOUNT_LINK:10,MANAGE_CTA:11,CREATE_AD:12,CONTINUE_PROMPT:13,ADVERTISE_LIST_ITEM:14,SHOPS:15,DISABLED_CATALOG:16,BANNED_SHOP:17}),x=Object.freeze({FACEBOOK:0,INSTAGRAM:1}),B=Object.freeze({CALLS_TAB_MISSED:1,CALLS_TAB_OUTGOING:2,SELECT_CONTACT:3,CALL_INFO:4,NOTIFICATION_MISSED:5,CONTACT_INFO:6,QUICK_CONTACT_INFO:7,CONVERSATION:8,CALLS_TAB_INCOMING:9,GROUP_CHAT_INFO:10,GROUP_CHAT_RECENT_LOCATION:11,ANDROID_BROADCAST_DETAILS:12,ANDROID_LIST_CHAT_INFO:13,ANDROID_CONTACTS_APPLICATION:14,CONTACT_VCARD:15,CALLS_TAB_NEW_CALL:16,VOICE_MAIL_CALL_BACK:17,IOS_INTENT:18,LIVE_LOCATION_MAP:19,GROUP_CALL_INFO:20,CALLS_TAB_BOTTOM_SHEET:21,STATUS_VIEWER:22,DEBUG_TOOL:23,GROUP_CHAT_PICKER:24,GROUP_CHAT_DIRECT:25,STELLA:26,CHAT_LIST:27,NEW_CHAT:28,CONVERSATION_OPTIONS:29,CALL_FAILED_SCREEN:30,BUSINESS_DIRECTORY:31}),K=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),Y=Object.freeze({UNBOUND:1,BINDED:2}),j=Object.freeze({INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23}),W=Object.freeze({CALL_SEGMENT_ONE_ON_ONE_ACTIVE:1,CALL_SEGMENT_GROUP_ACTIVE:2,CALL_SEGMENT_ONE_ON_ONE_HOLD_SELF:3,CALL_SEGMENT_ONE_ON_ONE_HOLD_PEER:4}),H=Object.freeze({UNKNOWN:1,CALL_ACCEPT_FAILED:2,INIT_MEDIA_STREAM_FAILED:3,START_MEDIA_STREAM_FAILED:4,AUDIO_INIT_ERROR:5,HANDLE_OFFER_FAILED:6,HANDLE_ACCEPT_FAILED:7,SOUND_PORT_CREATE_FAILED:8,P2P_TRANSPORT_CREATE_FAILED:9,P2P_TRANSPORT_MEDIA_CREATE_FAILED:10,INCOMPATIBLE_SRTP_KEY_EXCHANGE:11,SRTP_KEY_GENERATION_ERROR:12,UNSUPPORTED_AUDIO_CAPS:13,P2P_TRANSPORT_START_FAILED:14,RELAY_BIND_FAILED:15,CANNOT_INITIALIZE_AUDIO_RECORD_OBJECT:16,PEER_RELAY_BIND_FAILED:17,VIDEO_CAPTURE_INIT_FAILED:18,VIDEO_CAPTURE_START_FAILED:19,VIDEO_RENDER_INIT_FAILED:20,VIDEO_RENDER_START_FAILED:21,VIDEO_ENCODER_OPEN_FAILED:22,VIDEO_DECODER_OPEN_FAILED:23,VIDEO_STREAM_CREATE_FAILED:24,VIDEO_STREAM_SETUP_FAILED:25,PEER_SETUP_FAILED:26,HANDLE_PREACCEPT_FAILED:27}),V=Object.freeze({CALLER:1,CALLEE:2}),$=Object.freeze({ENDED_BY_USER:1,TIMEOUT:2,RECONNECTING:3,ENDED_BY_SELF:4,ENDED_BY_PEER:5,VIDEO_ENCODER_FATAL_ERROR:6,VIDEO_DECODER_FATAL_ERROR:7,AUDIO_RECORD_FATAL_ERROR:8,CRASH:9,DETECT_IDENTITY_CHANGE:10,USER_INVISIBLE:11,RELAY_BIND_FAILED:12,SETUP_FAILED:13,ACCEPTED_ELSEWHERE:14,REJECTED_ELSEWHERE:15,GROUP_CALL_ENDED:16,CALL_IS_FULL:17}),z=Object.freeze({UNKNOWN:0,P2P:1,UDP_RELAY:2,TCP_RELAY:3,MIXED:4}),q=Object.freeze({DISABLED:0,ENABLED:1,PAUSED:2,UPGRADE_REQUEST:3,MUTED:6,ERROR:20}),J=Object.freeze({NONE:0,UNKNOWN:1,APNS_PUSH:2,IOS_VOIP_PUSH:3,GCM_PUSH:4,ONLINE:5,RIM_PUSH:6}),Q=Object.freeze({DEFAULT:0,TEXTURE:1,TEXTURE_FALLBACK:2}),X=Object.freeze({DEFAULT:0,CONSERVATIVE:1,STRICT:2,ERROR:11}),Z=Object.freeze({ACTION_PRODUCT_ADD_CLICKED:1,ACTION_PRODUCT_ADD_SUCCESS:2,ACTION_PRODUCT_ADD_FAILED:3,ACTION_PRODUCT_EDIT_CLICKED:4,ACTION_PRODUCT_EDIT_SUCCESS:5,ACTION_PRODUCT_EDIT_FAILED:6,ACTION_PRODUCT_DELETE_CLICKED:7,ACTION_PRODUCT_DELETE_SUCCESS:8,ACTION_PRODUCT_DELETE_FAILED:9,ACTION_APPEAL_PRODUCT_CLICKED:10,ACTION_APPEAL_PRODUCT_SUCCESS:11,ACTION_APPEAL_PRODUCT_FAILED:12,ACTION_CREATE_PRODUCT_CATALOG:13,ACTION_CREATE_PRODUCT_CATALOG_SUCCESS:14,ACTION_CREATE_PRODUCT_CATALOG_FAILED:15,ACTION_CATALOG_MENU_ITEM_CLICKED:16,ACTION_PRODUCT_RESUBMIT_CLICKED:17,ACTION_START_IMPORT_FLOW:18,ACTION_IMPORT_POST:19,ACTION_CARD_IMPRESSION:20,ACTION_CARD_ITEM_CLICK:21,ACTION_CARD_MORE_CLICK:22,ACTION_LIST_IMPRESSION:23,ACTION_LIST_ITEM_CLICK:24,ACTION_DETAIL_IMAGE_CLICK:25,ACTION_DETAIL_LINK_CLICK:26,ACTION_IMAGE_LIST_IMPRESSION:27,ACTION_IMAGE_LIST_CLICK:28,ACTION_FULL_IMAGE_IMPRESSION:29,ACTION_FULL_IMAGE_SWIPE:30,ACTION_DETAIL_IMPRESSION:31,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:32,ACTION_PRODUCT_IN_CONVERSATION_CLICK:33,ACTION_SEND_PRODUCT_MESSAGE:34,ACTION_ONBOARD_IMPRESSION:35,ACTION_SHARE_CATALOG_LINK_CLICK:36,ACTION_SHARE_PRODUCT_LINK_CLICK:37,ACTION_CATALOG_IN_CONVERSATION_CLICK:38,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:39,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:40,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:41,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:42,ACTION_SEND_CATALOG_CLICK:43,ACTION_ORDER_MESSAGE_CLICK:44,ACTION_ORDER_LIST_IMPRESSION:45,ACTION_ORDER_LIST_ITEM_CLICK:46,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:47,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:48,ACTION_CART_ADD_PRODUCT:49,ACTION_CART_ICON_CLICK:50,ACTION_CART_SNACKBAR_CLICK:51,ACTION_CART_LIST_IMPRESSION:52,ACTION_CART_EDIT_PRODUCT:53,ACTION_CART_DELETE_PRODUCT:54,ACTION_CART_ABANDON:55,ACTION_SEND_ORDER_MESSAGE:56,ACTION_MENU_CLICK:57,ACTION_PRODUCT_HIDE_CLICKED:58,ACTION_PRODUCT_HIDE_SUCCESS:59,ACTION_PRODUCT_HIDE_CANCELLED:60,ACTION_PRODUCT_HIDE_FAILED:61,ACTION_PRODUCT_UNHIDE_CLICKED:62,ACTION_PRODUCT_UNHIDE_SUCCESS:63,ACTION_PRODUCT_UNHIDE_CANCELLED:64,ACTION_PRODUCT_UNHIDE_FAILED:65,ACTION_CATALOG_LIST_MENU_CLICKED:66,ACTION_CATALOG_LIST_MENU_CLICKED_WITH_ADVERTISE_SHOWN:67,ACTION_COLLECTION_CREATE_CLICKED:68,ACTION_COLLECTION_CREATED:69,ACTION_MENU_COLLECTIONS_CLICK:70,ACTION_COLLECTION_RENAME_CLICKED:71,ACTION_COLLECTION_RENAME_CANCELLED:72,ACTION_COLLECTION_RENAMED:73,ACTION_COLLECTION_DELETE_CLICKED:74,ACTION_COLLECTION_DELETE_CANCELLED:75,ACTION_COLLECTION_DELETED:76,ACTION_COLLECTION_ASSIGN_ITEMS:77,ACTION_COLLECTION_UNASSIGN_ITEMS:78,ACTION_COLLECTION_IMPRESSION:79}),ee=Object.freeze({CATALOG_ENTRY_POINT_PROFILE:1,CATALOG_ENTRY_POINT_SETTINGS:2,CATALOG_ENTRY_POINT_MESSAGE:3,CATALOG_ENTRY_POINT_ATTACHMENT_PANEL:4,CATALOG_ENTRY_POINT_NUX:5,CATALOG_ENTRY_POINT_DEEPLINK:6,CATALOG_ENTRY_POINT_CHAT:7,CATALOG_ENTRY_POINT_ORDER_MESSAGE:8,CATALOG_ENTRY_POINT_INVOICE_ATTACHMENT_PANEL:9,CATALOG_ENTRY_POINT_PRODUCT_LIST_MESSAGE:10,CATALOG_ENTRY_POINT_TOP_BAR:11}),te=Object.freeze({ACTION_CARD_IMPRESSION:1,ACTION_CARD_ITEM_CLICK:2,ACTION_CARD_MORE_CLICK:3,ACTION_LIST_IMPRESSION:4,ACTION_LIST_ITEM_CLICK:5,ACTION_DETAIL_IMAGE_CLICK:6,ACTION_DETAIL_LINK_CLICK:7,ACTION_IMAGE_LIST_IMPRESSION:8,ACTION_IMAGE_LIST_CLICK:9,ACTION_FULL_IMAGE_IMPRESSION:10,ACTION_FULL_IMAGE_SWIPE:11,ACTION_DETAIL_IMPRESSION:12,ACTION_REPORT_PRODUCT:13,ACTION_SEND_PRODUCT_MESSAGE:14,ACTION_REPORT_PRODUCT_SUCCESS:15,ACTION_REPORT_PRODUCT_FAILURE:16,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,ACTION_SHARE_CATALOG_LINK_CLICK:19,ACTION_SHARE_PRODUCT_LINK_CLICK:20,ACTION_CATALOG_IN_CONVERSATION_CLICK:21,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,ACTION_CHAT_CATALOG_ICON_CLICK:26,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:27,ACTION_CART_ADD_PRODUCT:28,ACTION_CART_EDIT_PRODUCT:29,ACTION_CART_DELETE_PRODUCT:30,ACTION_CART_ABANDON:31,ACTION_CART_ICON_CLICK:32,ACTION_CART_SNACKBAR_CLICK:33,ACTION_SEND_ORDER_MESSAGE:34,ACTION_ORDER_LIST_IMPRESSION:35,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:36,ACTION_CART_LIST_IMPRESSION:37,ACTION_ORDER_MESSAGE_CLICK:38,ACTION_ORDER_LIST_ITEM_CLICK:39,ACTION_PLM_CART_CTA_CLICK:40,ACTION_COLLECTION_IMPRESSION:41}),re=Object.freeze({ATTACHMENT:1,CAMERA:2,PTT:3,PAYMENT:4,GIMMICK:5,PHONE:6,VIDEO:7,MESSAGE:8,CALL:9}),ne=Object.freeze({CLICK:1}),ie=Object.freeze({OPEN:1,SELECT_FILTER:2,SEARCH_WITH_FILTER:3,SEARCH:4,SEARCH_ITEM_SELECTED:5,SEARCH_MSG_SENT:6}),ae=Object.freeze({CHAT_LIST:0}),se=Object.freeze({NONE:0,OTHER_LABELS:1,UNREAD:2,GROUP:3,BROADCAST_LIST:4,NEW_CUSTOMER:5,NEW_ORDER:6,PENDING_PAYMENT:7,PAID:8,ORDER_COMPLETE:9,CONTACT:10,NON_CONTACT:11}),oe=Object.freeze({TOS3:1,COUNTRY:2}),le=Object.freeze({NOT_MUTED:1,MUTED_NO_NOTIFICATIONS:2,MUTED_SILENT_NOTIFICATIONS:3}),ce=Object.freeze({CONTACT:0,CHAT:1,GROUP:2,BROADCAST_LIST:3,MESSAGE:4}),de=Object.freeze({INDIVIDUAL:1,SMB:2,ENT:3}),ue=Object.freeze({SMALL:1,MEDIUM:2,LARGE:3,EXTRA_LARGE:4,XX_LARGE:5,XXX_LARGE:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),pe=Object.freeze({CLIENT_RENDERED:1,CLIENT_SAVED:2,CLIENT_WRITTEN_WIRE:3,CLIENT_QUEUED:4,CLIENT_WAITING_TO_ENCRYPT:5,CLIENT_READY_TO_SEND:6,CLIENT_ENCRYPT:7,CLIENT_PREKEYS_FETCH:8}),he=Object.freeze({REGULAR:1,REGULAR_LOW:2,REGULAR_HIGH:3,CRITICAL_BLOCK:4,CRITICAL_UNBLOCK_LOW:5}),fe=Object.freeze({COMMERCE_ACTION_CARD_IMPRESSION:1,COMMERCE_ACTION_CARD_ITEM_CLICK:2,COMMERCE_ACTION_CARD_MORE_CLICK:3,COMMERCE_ACTION_LIST_IMPRESSION:4,COMMERCE_ACTION_LIST_ITEM_CLICK:5,COMMERCE_ACTION_DETAIL_IMAGE_CLICK:6,COMMERCE_ACTION_DETAIL_LINK_CLICK:7,COMMERCE_ACTION_IMAGE_LIST_IMPRESSION:8,COMMERCE_ACTION_IMAGE_LIST_CLICK:9,COMMERCE_ACTION_FULL_IMAGE_IMPRESSION:10,COMMERCE_ACTION_FULL_IMAGE_SWIPE:11,COMMERCE_ACTION_DETAIL_IMPRESSION:12,COMMERCE_ACTION_REPORT_PRODUCT:13,COMMERCE_ACTION_SEND_PRODUCT_MESSAGE:14,COMMERCE_ACTION_REPORT_PRODUCT_SUCCESS:15,COMMERCE_ACTION_REPORT_PRODUCT_FAILURE:16,COMMERCE_ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,COMMERCE_ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,COMMERCE_ACTION_SHARE_CATALOG_LINK_CLICK:19,COMMERCE_ACTION_SHARE_PRODUCT_LINK_CLICK:20,COMMERCE_ACTION_CATALOG_IN_CONVERSATION_CLICK:21,COMMERCE_ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,COMMERCE_ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,COMMERCE_ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,COMMERCE_ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,COMMERCE_ACTION_CHAT_CATALOG_ICON_CLICK:26,COMMERCE_ACTION_CLICK_ON_MESSAGE_BUSINESS_BUTTON:27}),_e=Object.freeze({COMMERCE_ENTRY_POINT_PROFILE:1,COMMERCE_ENTRY_POINT_SETTINGS:2,COMMERCE_ENTRY_POINT_MESSAGE:3,COMMERCE_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_ENTRY_POINT_NUX:5,COMMERCE_ENTRY_POINT_DEEPLINK:6,COMMERCE_ENTRY_POINT_CHAT:7,COMMERCE_ENTRY_POINT_ORDER_MESSAGE:8}),me=Object.freeze({COMMERCE_PERF_ENTRY_POINT_PROFILE:1,COMMERCE_PERF_ENTRY_POINT_SETTINGS:2,COMMERCE_PERF_ENTRY_POINT_PRODUCT_MESSAGE:3,COMMERCE_PERF_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_PERF_ENTRY_POINT_CATALOG_PDP:5,COMMERCE_PERF_ENTRY_POINT_DEEPLINK:6,COMMERCE_PERF_ENTRY_POINT_CATALOG_HOME:7,COMMERCE_PERF_ENTRY_POINT_SHOPS_PDP:8,COMMERCE_PERF_ENTRY_POINT_PRODUCT_LIST_MESSAGE:9}),ge=Object.freeze({COMMERCE_PERF_MARKER_START:1,COMMERCE_PERF_MARKER_CACHE_CONTENT:2,COMMERCE_PERF_MARKER_NETWORK_CONTENT:3,COMMERCE_PERF_MARKER_INTERACT:4}),ye=Object.freeze({COMMERCE_PERF_CATALOG_PDP:1,COMMERCE_PERF_CATALOG_HOME:2,COMMERCE_PERF_PROFILE_CATALOG:3,COMMERCE_PERF_SHOPS_PDP:4}),Ee=Object.freeze({PERSON:1,PUSH:2,OTHER:3,BACKOFF:4}),Se=Object.freeze({HOSTNAME:0,IP4:1,IP6:2}),ve=Object.freeze({CHATD:1,MMS:2}),Te=Object.freeze({PROBLEM_DESCRIPTION:1,SUGGESTED_FAQ:2,EMAIL_SEND:3,IN_APP_FAQ:4,CANCELLED:5,FAQ:6}),Ae=Object.freeze({MSG_SENT:1}),Ce=Object.freeze({DEEP_LINK_EXTERNAL:1,DEEP_LINK_WA_LINK_CLICK:2,QR_CODE_SHEET:3}),be=Object.freeze({DEEP_LINK_UNKNOWN:1,DEEP_LINK_CHAT:2,DEEP_LINK_CONTACT_QR_CODE:3,DEEP_LINK_PAYMENT:4,DEEP_LINK_PRODUCT:5,DEEP_LINK_CATALOG:6,DEEP_LINK_FUTURE_PROOF:7,DEEP_LINK_GROUP_INVITE:8,DEEP_LINK_MSG_FORWARD:9,DEEP_LINK_MESSAGE_QR_CODE:10,DEEP_LINK_OPT_IN_QR_CODE:11,DEEP_LINK_CTWA:12,DEEP_LINK_STICKERPACK:13,DEEP_LINK_NOVI_HUB:14,DEEP_LINK_NOVI_ADD_DEBIT_CARD:15,DEEP_LINK_NOVI_ADD_BANK_ACCOUNT:16,DEEP_LINK_NOVI_WITHDRAW:17,DEEP_LINK_NOVI_RESET_PASSWORD:18,DEEP_LINK_PAYMENT_SIGNUP:19,DEEP_LINK_BIZTOOLS_ACCOUNTS:20,DEEP_LINK_PAYMENT_VIRALITY:21,DEEP_LINK_SETTINGS_ACCOUNT_DELETE:22,DEEP_LINK_SETTINGS_ACCOUNT_REQUEST_INFO:23,DEEP_LINK_SETTINGS_CHATS_HISTORY:24,DEEP_LINK_DISAPPEARING_MODE:25,DEEP_LINK_ARCHIVE_SETTINGS:26,DEEP_LINK_TOS:27,DEEP_LINK_NOVI_CARE:28,DEEP_LINK_NOVI_TPP_ACCOUNT_LINKING:29,DEEP_LINK_CONTACT_SUPPORT:30,DEEP_LINK_BIZTOOLS_DIRECTORY:31,DEEP_LINK_DIRECTORY:32,DEEP_LINK_CALL:33}),Pe=Object.freeze({APP_SWITCH:1,BROWSER:2,CANCELLED:3}),Me=Object.freeze({PRIMARY:1,COMPANION:2}),Oe=Object.freeze({CHAT:1,INITIATED_BY_ME:2,INITIATED_BY_OTHER:3}),Ie=Object.freeze({ACCOUNT_SETTINGS:1,SYSTEM_MESSAGE:2,INDIVIDUAL_CHAT_DISAPPEARING_MESSAGES_SETTING:3,GROUP_CHAT_DISAPPEARING_MESSAGES_SETTING:4,DEEP_LINK:5}),we=Object.freeze({CHAT_PERSONAL:1,CHAT_GROUP:2,STATUS_USER:3,STATUS_ADS:4,PRODUCT_CATALOG:5,GDPR:6,STICKER_PICKER:7,PROFILE_PICTURE:8,BLOKS:9,P2B:10,MESSAGE_HISTORY_SYNC:11}),Re=Object.freeze({NORMAL_QUALITY:1,MID_QUALITY:2,INELIGIBLE_IMAGE_TOO_SMALL:3,INELIGIBLE_PARTIAL_HASHES_NOT_FOUND:4,ERROR_DETERMINING_ELIGIBILITY:5,NOT_DOWNLOADED_ENOUGH_BYTES_TO_DETERMINE_ELIGIBILITY:6}),De=Object.freeze({INVALID_SENDER:1,MISSING_DSM:2,INVALID_DSM:3}),Ne=Object.freeze({MESSAGE:0,PREKEY_MESSAGE:1,SENDER_KEY_MESSAGE:2}),Le=Object.freeze({INDIVIDUAL:0,GROUP:1,LIST:2,STATUS:3}),ke=Object.freeze({INVALID_MESSAGE:0,LEGACY_MESSAGE:1,INVALID_VERSION:2,PRE_KEY_MESSAGE_MISSING_PRE_KEY:3,PRE_KEY_MESSAGE_INVALID_KEY:4,UNTRUSTED_IDENTITY:5,NO_SESSION_AVAILABLE:6,PLAINTEXT_BYTE_MISMATCH:7,UNKNOWN_CIPHERTEXT_TYPE:8,UNKNOWN_CIPHERTEXT_VERSION:9,INVALID_PADDING:10,INVALID_PROTOCOL_BUFFER:11,INVALID_NUMBER_OF_MESSAGE_TYPES:12,INVALID_IMAGE_FILE_LENGTH:13,INVALID_IMAGE_FILE_SHA256:14,INVALID_IMAGE_MEDIA_URL:15,INVALID_IMAGE_MEDIA_KEY:16,INVALID_IMAGE_MIME_TYPE:17,UNKNOWN_V2_TAGS:18,INVALID_EDIT_VERSION:19,INVALID_HSM_NAMESPACE:20,INVALID_HSM_ELEMENT:21,UNKNOWN_PROTOCOL_MESSAGE_TYPE:22,DUPLICATE_MESSAGE:23,FINGERPRINT_IDENTITY_MISMATCH:24,FINGERPRINT_VERSION_MISMATCH:25,INVALID_ARGUMENT:26,INVALID_KEY:27,INVALID_KEY_ID:28,INVALID_MAC:29,NO_MEMORY:30,STALE_KEY_EXCHANGE:31,VRF_SIGNATURE_VERIFICATION_FAILED:32,ERROR_MINIMUM_VALUE:33,ERROR_UNKNOWN:34,INVALID_BROADCAST_STANZA_ATTRIBUTE:35,INVALID_LIST_REPLY_MESSAGE:36,INVALID_LIST_REPLY_ROW_IDENTIFIER:37,INVALID_BUTTONS_RESPONSE_MESSAGE:38,INVALID_BUTTONS_RESPONSE_BUTTON_IDENTIFIER:39,INVALID_ORDER_MESSAGE:40,ERROR_CANCELLED:41,FUTURE_MESSAGE:42,INVALID_EMPTY_PROTOBUF_NOT_ALLOWED:43,SELF_SEND:44,INVALID_MEDIA_MIME_TYPE_TEMPLATE_MESSAGE:45,INVALID_MEDIA_ENC_HASH:46,INVALID_IDENTITY:47,PASSTHROUGH:48,NOT_IN_PENDING_DEVICES:49,EDIT_TYPE_AND_PROTOCOL_MISMATCH:50,DECRYPTION_FAILED:51,DESERIALIZE_INVALID_PROTO_FORMAT:52,DESERIALIZE_RATCHET_KEY_BAD_FORMAT:53,DESERIALIZE_PK_INVALID_PROTO_FORMAT:54,DESERIALZE_PK_KEY_BAD_FORMAT:55,TOO_MANY_MESSAGES_IN_FUTURE:56,EMPTY_VERSION_CONTENT_SUFFIX:57,CONTENT_EXCEEDED_EXPECTED_LENGTH:58,GRP_INVALID_PROTO_FORMAT:59,GRP_INVALID_KEY_FORMAT:60,GRP_VERSION_CONTENT_EMPTY:61,GRP_INVALID_VERSION_CONTENT_LENGTH:62,GRP_SENDER_KEY_INVALID_PROTO_FORMAT:63,GRP_SENDER_KEY_PROTO_ERROR:64,GRP_TOO_MANY_MESSAGES_IN_FUTURE:65}),Ge=Object.freeze({MY_PRIMARY:1,OTHER_PRIMARY:2,MY_COMPANION:3,OTHER_COMPANION:4}),Ue=Object.freeze({ACTION_OPEN:1,ACTION_SAVE:2,ACTION_DISCARD:3,ACTION_PROFILE_FIELD_OPEN:4,ACTION_PROFILE_FIELD_SAVE:5,ACTION_PROFILE_FIELD_DISCARD:6,ACTION_FACEBOOK_ENABLED:7,ACTION_FACEBOOK_DISABLED:8,ACTION_INSTAGRAM_ENABLED:9,ACTION_INSTAGRAM_DISABLED:10,ACTION_FB_IG_POP_SHOWN:11,ACTION_EDIT_COVER_PHOTO_CLICK:12,ACTION_REMOVE_COVER_PHOTO:13}),Fe=Object.freeze({CALL_TOO_SHORT:1}),xe=Object.freeze({CHAT_INFO:1,SYSTEM_MESSAGE:2}),Be=Object.freeze({ROOM_OPEN_FAILURE:1,UNKNOWN_ERROR:2}),Ke=Object.freeze({USER_LEAVE:1,DEVICE_UNPAIR:2,IDENTITY_CHANGE:3,AUDIENCE_CHANGE:4,PERIODIC_ROTATION:5,KEY_CORRUPTION:6}),Ye=Object.freeze({BOTH:1,SELF:2,PEER:3}),je=Object.freeze({NEW:0,RETAINED:1,RESURRECTED:2}),We=Object.freeze({GIPHY:0,TENOR:1}),He=Object.freeze({GET_CATALOG:1,GET_PRODUCT:2,GET_PRODUCT_LIST:3}),Ve=Object.freeze({SUCCESS:1,FAILURE:2}),$e=Object.freeze({INCOMING_CALL_SCREEN_ANSWER:1,INCOMING_CALL_SCREEN_REJECT:2,INCOMING_CALL_NOTIFICATION_ANSWER:3,INCOMING_CALL_NOTIFICATION_REJECT:4,PENDING_CALL_SCREEN_END_AND_ANSWER:5,PENDING_CALL_SCREEN_HOLD_AND_ANSWER:6,PENDING_CALL_SCREEN_REJECT:7,INCOMING_CALL_REMOTE_ANSWER:8,INCOMING_CALL_REMOTE_REJECT:9,PENDING_CALL_NOTIFICATION_END_AND_ANSWER:10,PENDING_CALL_NOTIFICATION_REJECT:11}),ze=Object.freeze({DEFAULT:0,PROBING_ROTT_TO_RELAY:1,PROBING_E2E_PEER_RX:2,PROBING_E2E_RX:3,HIS_RECENT_PEER_RX:4,HIS_RECENT_RX:5,HIS_RECENT_PROBING_ROTT_TO_RELAY:6,HIS_RECENT_PROBING_E2E_PEER_RX:7,HIS_RECENT_PROBING_E2E_RX:8,ONE_SIDE_INITIAL_BANDWIDTH_ESTIMATION:9}),qe=Object.freeze({USER_START:0,USER_CANCEL:1,FLOW_SUCCESS:2,FLOW_ERROR:3,USER_VIEW:4,USER_PAY_NOW:5,USER_VIEW_BASKET:6}),Je=Object.freeze({ADD:1,EDIT:2,DELETE:3,VIEW:4,CLICK_POSITIVE:5,CLICK_NEGATIVE:6,UPDATE_LABEL_COUNT:7}),Qe=Object.freeze({LABEL:1,MESSAGE:2,CONTACT:3,LABELS_SCREEN:4,LABEL_DETAILS_SCREEN:5,EDIT_LABEL_DIALOG:6,DELETE_LABEL_DIALOG:7,LABEL_MESSAGE_DIALOG:8,LABEL_CHAT_DIALOG:9,ADD_LABEL_DIALOG:10,BULK_UNLABEL_DIALOG:11,LABEL_COMBINED_DIALOG:12,GROUP:13,BROADCAST:14}),Xe=Object.freeze({OK:1,ERROR_UNKNOWN:2,SERVER_ERROR:3,SERVER_GOAWAY:4,NETWORK_ERROR:5,ANDROID_KEYSTORE_ERROR:6}),Ze=Object.freeze({APP_STATE_SYNC_KEY_EXPIRY:1,DEVICE_DEREGISTERATION:2,NO_KEYS:3}),et=Object.freeze({INITIAL:1,RECENT_HISTORY:2,FULL_HISTORY:3,PUSHNAME:4,STATUS_V3:5}),tt=Object.freeze({CRITICAL:1,NON_CRITICAL:2}),rt=Object.freeze({APP_STATE:1,HISTORY:2}),nt=Object.freeze({SUCCESS:1,FAILURE:2}),it=Object.freeze({PIN_MUTATION:1,UNPIN_4TH_CHAT_MUTATION:2,DELETE_MUTATION:3,CLEAR_CHAT_REMOVE_STARRED_MUTATION:4,CLEAR_CHAT_KEEP_STARRED_MUTATION:5}),at=Object.freeze({PAIR_SUCCESS_RECEIVED:1,PAIR_DEVICE_SIGN_SENT:2,FIRST_CONNECT:3,UPLOAD_PREKEYS:4,COMPLETE:5}),st=Object.freeze({INITIAL_SYNC:1,RESUME_SYNC:2,REGULAR_SYNC:3}),ot=Object.freeze({MESSAGE_RANGE_UNSET:1,MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET:2,MESSAGE_RANGE_MESSAGES_UNSET:3,MESSAGE_RANGE_MESSAGES_EMPTY:4,MESSAGE_RANGE_MESSAGES_CROSS_LIMIT:5,MESSAGE_RANGE_MESSAGE_KEY_UNSET:6,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET:7,MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET:8,MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET:9,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID:10,MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET:11,MALFORMED_PENDING_MUTATION:12,ACTION_INVALID_INDEX_DATA:13}),lt=Object.freeze({TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:1,SERVER_DATA_MISMATCH:2,PROTOBUF_DESERIALIZATION_FAILED:3,EXTERNAL_PATCH_EXPIRED:4,MISSING_OR_EMPTY_INDEX:5,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:6,DECRYPTION_FAILED:7,MISSING_PATCH_VERSION:8,DUPLICATE_PATCH_VERSION_IN_COLLECTION:9,ENCRYPTION_FAILED:10,MISSING_MUTATION_VERSION:11,MISSING_MUTATION_VALUE:12,INVALID_MUTATION_INDEX:13,PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:14,MISSING_MUTATION_OPERATION:15,MISSING_MUTATION_RECORD:16,MISSING_MUTATION_KEY_ID:17,PATCH_PROTOBUF_DESERIALIZATION_FAILED:18,ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:19,MISSING_MUTATION_INDEX:20,MISSING_ACTION_INDEX:21,INVALID_ACTION_INDEX:22,MISSING_ACTION_VALUE:23,MISSING_ACTION_VERSION:24,MISSING_ACTION_TIMESTAMP:25,MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:26,MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:27,PATCH_PROTOBUF_SERIALIZATION_FAILED:28,ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:29,MISSING_KEY_ON_ALL_CLIENTS:30,TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY:31,MAC_MISMATCH_SNAPSHOT:33,MAC_MISMATCH_PATCH:34,DB_STORE_NOT_READY:35,TERMINAL_PATCH_MISSING_DATA:36,TERMINAL_PATCH_DESERIALIZATION_ERROR:37,TERMINAL_PATCH_UNKNOWN:38,CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:39,MISSING_SNAPSHOT_VERSION:45,MISSING_SNAPSHOT_MAC:46,MISSING_PATCH_SNAPSHOT_MAC:47,MISSING_PATCH_MAC:48,MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:49,MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:50,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:51,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:52,INVALID_KEY_SHARE_KEY_ID:53,MISSING_PATCH_KEY_ID:56,INVALID_KEY_SHARE_KEY_DATA:57,SNAPSHOT_EXPIRED:58,MISSING_SNAPSHOT_KEY_ID:59,SNAPSHOT_MAC_MISMATCH_IN_PATCH:60,SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:61,XMPP_BAD_REQUEST_FOR_COLLECTION:62,XMPP_NOT_FOUND_FOR_COLLECTION:63,XMPP_BAD_REQUEST_GLOBAL_ERROR:64,XMPP_NOT_FOUND_GLOBAL_ERROR:65,XMPP_BAD_METHOD_GLOBAL_ERROR:66,XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:67,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:68,EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:69,SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:70,REQUESTING_MISSING_KEY_WITH_NO_CLIENTS:71,DB_STORE_NOT_READY_LOW_DISK_SPACE:72,SERVER_DID_NOT_SEND_ALL_PATCHES:73}),ct=Object.freeze({SYNCD:1,WEB:2}),dt=Object.freeze({BROWSER:1,DESKTOP:2}),ut=Object.freeze({MANUAL:1,FULL:2,PREFETCH:3,HEADER:4,THUMBNAIL:5}),pt=Object.freeze({OK:1,ERROR_UNKNOWN:2,ERROR_TIMEOUT:3,ERROR_DNS:4,ERROR_INSUFFICIENT_SPACE:5,ERROR_TOO_OLD:6,ERROR_CANNOT_RESUME:7,ERROR_HASH_MISMATCH:8,ERROR_INVALID_URL:9,ERROR_OUTPUT_STREAM:10,ERROR_CANCEL:11,DEDUPED:12,ERROR_ENC_HASH_MISMATCH:14,PREFETCH_END:15,ERROR_CANCEL_PROGRAMMATIC:16,ERROR_MEDIA_CONN:17,ERROR_THROTTLE:18,ERROR_SSL:19,ERROR_NETWORK:20,ERROR_CONNECT:21}),ht=Object.freeze({CHAT_PHOTO_LIBRARY:1,CAMERA_TAB_CAPTURE:2,FORWARD:3,PASTE:4,SHARE_EXTENSION:5,EXPORT:6,MENU_CAMERA_CAPTURE:7,EXTERNAL_CAMERA:8,LINK_PREVIEW_DOWNLOAD:9,CAMERA_TAB_MEDIA_STRIP:10,CAMERA_TAB_PHOTO_LIBRARY:11,CHAT_BUTTON_CAMERA_CAPTURE:12,CHAT_BUTTON_CAMERA_MEDIA_STRIP:13,CHAT_BUTTON_CAMERA_PHOTO_LIBRARY:14,STATUS_TAB_CAMERA_CAPTURE:15,STATUS_TAB_CAMERA_MEDIA_STRIP:16,STATUS_TAB_CAMERA_PHOTO_LIBRARY:17,STATUS_REPLY_CAMERA_CAPTURE:18,STATUS_REPLY_CAMERA_MEDIA_STRIP:19,STATUS_REPLY_CAMERA_PHOTO_LIBRARY:20,MENU_CAMERA_PHOTO_LIBRARY:21,CHAT_GIF_INAPP:22,CHAT_GIF_EXTERNAL:23,STATUS_REPLY_GIF_INAPP:24,STATUS_REPLY_GIF_EXTERNAL:25,SMB_QUICK_REPLY_EDIT:26,SMB_QUICK_REPLY_SEND:27,MEDIA_BROWSER:28,CHAT_QUICK_EDIT:29,CAMERA_TAB_GIF:30,STATUS_TAB_GIF:31,PAYMENT_COMPOSER:32}),ft=Object.freeze({NONE:1,PHOTO:2,VIDEO:3,AUDIO:4,PTT:5,LOCATION:6,CONTACT:7,DOCUMENT:8,URL:9,CALL:10,GIF:11,FUTURE:12,CONTACT_ARRAY:13,LIVE_LOCATION:14,PROFILE_PIC:15,STICKER:16,HSM:17,PRODUCT_IMAGE:18,TEMPLATE:19,MD_APP_STATE:20,MD_HISTORY_SYNC:21,CATALOG_LINK:22,PRODUCT_LINK:23,ORDER:24,LIST:25,LIST_REPLY:26,BUTTON_MESSAGE:27,BUTTON_RESPONSE_MESSAGE:28,PRODUCT_LIST:29,BUTTON_NFM:30,VIEW_ONCE_IMAGE:31,VIEW_ONCE_VIDEO:32,SHOP_STOREFRONT:33,REACTION:34,INTERACTIVE_NFM:35}),_t=Object.freeze({REGULAR:1,FAST_FORWARD_EXIST_CHECK:2,VIDEO_EXIST_CHECK:3,PRODUCT:4,MEDIA_RETRY:5,WEB_REUPLOAD:6,THUMBNAIL:7}),mt=Object.freeze({OK:1,DUPLICATE:3,ERROR_UNKNOWN:2,ERROR_REQUEST:4,ERROR_UPLOAD:5,ERROR_OOM:6,ERROR_IO:7,ERROR_NO_PERMISSIONS:8,ERROR_BAD_MEDIA:9,ERROR_INSUFFICIENT_SPACE:10,ERROR_FNF:11,ERROR_CANCEL:12,ERROR_SERVER:13,ERROR_REQUEST_TIMEOUT:14,ERROR_NOT_FINALIZED:15,ERROR_OPTIMISTIC_HASH:16,ERROR_MEDIA_CONN:17,ERROR_DNS:18,ERROR_THROTTLE:19,ERROR_SSL:20,ERROR_NO_CLIENT_NETWORK:21}),gt=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),yt=Object.freeze({OK:1,ERROR_UNKNOWN:3,ERROR_NETWORK:4,ERROR_EXPIRED:5,ERROR_CANCELLED:6,ERROR_UPLOAD:7,ERROR_BACKFILL_USYNC_FAILED:8}),Et=Object.freeze({INDIVIDUAL:1,GROUP:2,BROADCAST:3,STATUS:4}),St=Object.freeze({PREKEY_MESSAGE:1,CALL_PAYLOAD:2,RETRY_RECEIPT:3,PREKEY_RESPONSE:4,IDENTITY_RESPONSE:5,USYNC_RESPONSE:6}),vt=Object.freeze({ZERO:1,ONE:2,LT10:3,LT100:4,LT500:5,LT1K:6,LT5K:7,GTE5K:8}),Tt=Object.freeze({NATIVE:0,OK_HTTP:1,LIGER:2,APACHE:3,WATLS:4}),At=Object.freeze({ALLOWED:1,BLOCKED:2,UNKNOWN:3}),Ct=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),bt=Object.freeze({NONE:0,OPTIMISTIC:1,OPT_USED:2,OPT_TAKEOVER:3,OPT_DISABLED:4}),Pt=Object.freeze({OTHER:0,CHAT:1,NOTIFICATION:2}),Mt=Object.freeze({RESUME_CHECK:1,UPLOAD:2,FINALIZE:3}),Ot=Object.freeze({NONE_NEW_CONTENT:1,NONE_EXPIRED:2,REUSED:3}),It=Object.freeze({CONSUMER:1,SMB:2,ENT:3}),wt=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),Rt=Object.freeze({OTHER:0,ADD:1,VIEW:2,POPULATE:3}),Dt=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),Nt=Object.freeze({OTHER:0,CIPHERTEXT:1,FANOUT:2,DOWNGRADE:3}),Lt=Object.freeze({IPHONE:1,ANDROID:2,BB:3,BBX:7,S40:4,SYMBIAN:5,WP:6,WEBCLIENT:8,OSMETA:11,ENT:12,SMBA:13,KAIOS:14,SMBI:15,WINDOWS:16,WEB:17,PORTAL:18,BLOKS:19,BLUEA:20,BLUEI:21,FBLITEA:22,GREENA:23,GREENI:24,IGDA:25,IGDI:26,IGLITEA:27,MLITEA:28,MSGRA:29,MSGRI:30,MSGRP:31,MSGRW:32,IGDW:33,PAGE:34,MSGRDM:35,MSGRDW:36,MSGROM:37,MSGROC:38,MSGRM:43,IGDM:44,WEARM:45,CAPI:46,XR:47,MACOS:48,TEST:9,UNKNOWN:10}),kt=Object.freeze({LT4:1,LT8:2,LT16:3,LT32:4,LT64:5,LT128:6,LT256:7,LT512:8,LT1000:9,LT1500:10,LT2000:11,LT2500:12,LT3000:13,LT3500:14,LT4000:15,LT4500:16,LT5000:17,LARGEST_BUCKET:18}),Gt=Object.freeze({SEND_MESSAGE:1,GET_VNAME_CERTIFICATE:2,SEND_LIVE_LOCATION_RETRY:3,SEND_LIVE_LOCATION_KEY:4,SEND_PEER_MESSAGE:5,MULTI_DEVICE_CALL:6,CALL_PEER_E2E_FAIL:7,IDENTITY_CHANGE_NOTIFICATION:8,BACK_OFF:9,USER_INTENT_PREFETCH:10,RESEND_MESSAGE:11,RETRY_MESSAGE:12}),Ut=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_SIGNED_KEY_INDEX_LIST:2}),Ft=Object.freeze({B0:1,B1:2,B5:3,B10:4,B15:5,B20:6,B30:7,B40:8,B50:9,B60:10,B70:11,B80:12,B90:13,B100:14}),xt=Object.freeze({NOBODY:1,ONLY_SHARE_WITH:2,MY_CONTACTS:3,MY_CONTACTS_EXCEPT:4,EVERYONE:5}),Bt=Object.freeze({CONTACT_CARD:1,CHAT_HEADER:2,CHAT_MENU:3,GROUP_MEMBERSHIP_SCREEN:4,STATUS:5,CALLS:6,BROADCAST_LIST:7,PRODUCT:8,CATALOG:9,SETTINGS:10,SPAM_BLOCK:11,CHATS_HOME:12,SHOPS:13,MENTION:14,EPHEMERAL_SETTINGS_MESSAGE:15,MAP:16,SEARCH:17,PAYMENT_TRANSACTION_DETAILS:18}),Kt=Object.freeze({DIT:1,DIRECTORY_SEARCH:2}),Yt=Object.freeze({SUCCESS:1,ERROR_PARSING:2,ERROR_DECODING:3,ERROR_CREDENTIAL:4,ERROR_OTHER:5,ERROR_CLIENT_NETWORK:6,ERROR_WAIT_FOR_TOKEN:7,ERROR_SERVER_OTHER:8,SKIPPED_NO_NETWORK:9,SKIPPED_NO_DATA:10,ERROR_ACCESS_TOKEN:11}),jt=Object.freeze({CREATED:1,ROTATED:2,DELETED:3}),Wt=Object.freeze({TEST_VALUE1:1,TEST_VALUE2:2}),Ht=Object.freeze({NO_REASON:0,REASON_UNKNOWN:1,REASON_WAIT_FOR_FIRST_TOKEN:2,REASON_INVALID_SHARED_KEY:3,REASON_INVALID_FACTOR:4,REASON_GEN_FACTOR_FAILURE:5,REASON_COMPUTE_HMAC_FAILURE:6,REASON_BLIND_FAILURE:7,REASON_UNBLIND_FAILURE:8,REASON_LAST_SIGNREQ_NETWORK_FAILURE:9,REASON_LAST_SIGNREQ_SERVER_ERROR:10,REASON_LAST_SIGNREQ_BAD_REQUEST:11,REASON_LAST_SIGNREQ_OTHER_ERROR:12,REASON_WAIT_FOR_GEN_TOKEN:13,REASON_GEN_SHAREDKEY_FAILURE:14,REASON_WAIT_FOR_GEN_FIRST_TOKEN:15}),Vt=Object.freeze({REASON_PS_PINGER:0,REASON_PS_OFFCYCLE:1}),$t=Object.freeze({SUCCESS:1,CANCEL:2,ERROR:3}),zt=Object.freeze({SPEED_1:0,SPEED_1_5:1,SPEED_2:2}),qt=Object.freeze({AUDIO_QUEUE:0,AVPLAYER:1,AVAUDIOPLAYER:2,OPUSPLAYER:3,ANDROIDPLAYER:4,EXOPLAYER:5}),Jt=Object.freeze({SENT:1,CANCELLED:2,TOO_SHORT:3}),Qt=Object.freeze({FROM_CONVERSATION:0,FROM_VOICEMAIL:1}),Xt=Object.freeze({UNKNOWN:0,AAC:1,MP3:2,AMR_NB:3,AMR_WB:4,OPUS:5,MULTIPLE_TRACKS:6}),Zt=Object.freeze({MANUAL:0,SEQUENTIAL:1}),er=Object.freeze({STICKER_STORE_DATA:0,PREVIEW_IMAGE_DOWNLOAD:1,STICKER_PACK_DATA:2,STICKER_SEARCH:3}),tr=Object.freeze({ACTION_SETTINGS_IMPRESSION:1,ACTION_SETTINGS_ADD_CLICK:2,ACTION_SETTINGS_ADD_ABANDONED:3,ACTION_SETTINGS_ADDED:4,ACTION_SETTINGS_DELETED:5,ACTION_CHAT_IMPRESSION:6,ACTION_CHAT_CLICK:7,ACTION_SETTINGS_EDITED:8,ACTION_CHAT_INVALID_ATTACHMENTS:9,ACTION_SETTINGS_INVALID_ATTACHMENTS:10,ACTION_SETTINGS_MEDIA_TRANSCODE:11,ACTION_CHAT_CLICK_CANCEL:12,ACTION_SMART_DEFAULT_CLICK:13}),rr=Object.freeze({QUICK_REPLY_ENTRY_POINT_KEYBOARD:1,QUICK_REPLY_ENTRY_POINT_ATTACHMENT_PANEL:2,QUICK_REPLY_ENTRY_POINT_SETTINGS_MENU:3,QUICK_REPLY_ENTRY_POINT_BANNERS:4,QUICK_REPLY_ENTRY_POINT_NUX:5}),nr=Object.freeze({UNKNOWN:0,CONVERSATIONS:1,BUTTON:2,KEYBOARD:3}),ir=Object.freeze({QUICK_REPLY_TRANSCODE_RESULT_OK:1,QUICK_REPLY_TRANSCODE_RESULT_CANCELLED:2,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_UNKNOWN:3,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_ENCODING:4,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_FILE_COPY:5,QUICK_REPLY_TRANSCODE_RESULT_FAIL_VIDEO_UNKNOWN:6}),ar=Object.freeze({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112}),sr=Object.freeze({OPEN_TRAY:1,DELETE:2,UPDATE:3}),or=Object.freeze({CALLS_TAB:1,GROUP_CALL_UI:2,ATTACHMENT:3,WEB_MENU:4}),lr=Object.freeze({ACTION_CLICK_SHOPS_SETTING:1,ACTION_CLICK_CATALOG_SETTING:2,ACTION_CLICK_COMMERCE_MANAGER_IN_CATALOG_SETTING:3,ACTION_CLICK_CANCEL_IN_CATALOG_SETTING:4,ACTION_CLICK_VIEW_SHOPS_IN_SHOPS_SETTING:5,ACTION_CLICK_COMMERCE_MANAGER_IN_SHOPS_SETTING:6,ACTION_CLICK_CANCEL_IN_SHOPS_SETTING:7,ACTION_SHOPS_PRODUCT_PREVIEW_VISIBLE:8,ACTION_CLICK_SHOPS_PRODUCT_PREVIEW_TILE:9,ACTION_CLICK_MANAGE_SHOPS:10,ACTION_SHARE_SHOPS:11,ACTION_CLICK_VIEW_SHOPS_FROM_EDIT_BIZ_PROFILE:12,ACTION_CLICK_COMMERCE_MANAGER_FROM_EDIT_BIZ_PROFILE:13,ACTION_CLICK_CANCEL_FROM_EDIT_BIZ_PROFILE:14}),cr=Object.freeze({SUCCESS:1,ERROR_BAD_REQUEST:2,ERROR_SERVER:3,ERROR_OTHER:4,ERROR_CLIENT_NETWORK:5}),dr=Object.freeze({ACCOUNT_SIGNATURE:1,DEVICE_SIGNATURE:2}),ur=Object.freeze({LT32:1,LT64:2,LT128:3,LT256:4,LT512:5,LT1000:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),pr=Object.freeze({STATIC:0,SHARED:1}),hr=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),fr=Object.freeze({UNKNOWN:1,TEXT:2,IMAGE:3,VOICE:4,DOCUMENT:5,AUDIO:6,STICKER:7,LOCATION:8,PRODUCT:9,CONTACT:10,CONTACT_ARRAY:11,CAMERA_CAPTURE_IMAGE:12,MEDIA_GALLERY:13,GIF_VIDEO:14}),_r=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),mr=Object.freeze({RECENT_STORIES:1,PREVIOUS_STORIES:2,MUTED_STORIES:3,MY_STATUS:4}),gr=Object.freeze({REGULAR:1,PAYMENTS:2}),yr=Object.freeze({STICKER_SEARCH:1,FORWARD:2,STICKER_PICKER_TAB_RECENTS:3,STICKER_PICKER_TAB_FAVORITES:4,STICKER_PICKER_TAB_EMOTION:5,STICKER_PICKER_TAB_PACK:6,STICKER_PICKER_TAB_CONTEXTUAL_SUGGESTIONS:7,STICKER_MAKER:8,STICKER_STORE:9}),Er=Object.freeze({HSM:0,BUTTON:1,LIST:2,PRODUCT_LIST:3,BUTTON_NFM:4,PRODUCT_ITEM:5,SHOP_STOREFRONT:6}),Sr=Object.freeze({NONE:1,SPEEX:2,WEBRTC:3,MWEBRTC:4,ECHOSUPPRESSOR:5}),vr=Object.freeze({TITLE:1,CONTENT:2,FOOTER:3,BUTTON:4}),Tr=Object.freeze({B0:1,B1:2,B2:3,B11:4,B51:5,B101:6,B501:7,B1K:8,B10K:9,B100K:10,B1M:11}),Ar=Object.freeze({UPLOAD_SUCCESS:1,EMPTY_LOG_DIR:2,GZIP_FAILURE:3,UPLOAD_FAILURE:4,LOG_SIZE_EXCEEDED:5}),Cr=Object.freeze({OTHER:1,APP_OPEN:2,CHAT_OPEN:3,IMAGE_OPEN:4,FIRST_FTS_RESULT:5,CONTACTS_OPEN:6,GROUP_INFO_OPEN:7,MSG_INFO_OPEN:8}),br=Object.freeze({UNKNOWN:1,CHAT_PERSONAL:2,CHAT_GROUP:3,STATUS_USER:4,PRODUCT_CATALOG:5,STICKER_WEB:6,PAYMENTS_KYC:7,MESSAGE_HISTORY_SYNC:8}),Pr=Object.freeze({OTHER:1,CAMERA:2,GALLERY:3,SHARE:4}),Mr=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TOO_MANY_PORTS:101,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_PINHOLE_SPACE_EXHAUSTED:701,ERR_CODE_FIREWALL_DISABLED:702,ERR_CODE_INBOUND_PINHOLE_NOT_ALLOWED:703,ERR_CODE_NO_SUCH_ENTRY:704,ERR_CODE_PROTOCOL_NOT_SUPPORTED:705,ERR_CODE_INTERNAL_PORT_WILDCARD_NOT_ALLOWED:706,ERR_CODE_PROTOCOL_WILDCARD_NOT_ALLOWED:707,ERR_CODE_WILDCARD_NOT_PERMITTED_IN_SRC_IP:708,ERR_CODE_NO_PACKET_SENT:709,ERR_CODE_SPECIFIED_ARRAY_INDEX_INVALID:713,ERR_CODE_NO_SUCH_ENTRY_IN_ARRAY:714,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_CONFLICT_IN_MAPPING_ENTRY:718,ERR_CODE_SAME_PORT_VALUES_REQUIRED:724,ERR_CODE_ONLY_PERMANENT_LEASES_SUPPORTED:725,ERR_CODE_REMOTE_HOST_ONLY_SUPPORTS_WILDCARD:726,ERR_CODE_EXTERNAL_PORT_ONLY_SUPORTS_WILDCARD:727,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),Or=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),Ir=Object.freeze({INVALID_STANZA:1,JSON_FETCH:2,JSON_PARSE:3,IMAGE_FETCH:4}),wr=Object.freeze({BANNER_APPEAR:1,BANNER_SELECT:2,MODAL_APPEAR:3,MODAL_DISMISS:4,MODAL_LINK_FOLLOW:5,MODAL_ACCEPT:6,BLOCKING_MODAL_APPEAR:7,BLOCKING_MODAL_LINK_FOLLOW:8,BLOCKING_MODAL_ACCEPT:9,BANNER_DISMISS:10,EDUCATION_1_APPEAR:11,EDUCATION_1_DISMISS:12,EDUCATION_1_CONTINUE:13,MODAL_BACK:14,BLOCKING_MODAL_BACK:15}),Rr=Object.freeze({ACTION_IMPRESSION:1,ACTION_CLICK_WEBSITE:2,ACTION_CLICK_LOCATION:3,ACTION_CLICK_HOURS:4,ACTION_CLICK_DESCRIPTION:5,ACTION_CLICK_EMAIL:6,ACTION_CLICK_ADDTOCONTACT:7,ACTION_CLICK_MORE_BIZ_PROFILE:8,ACTION_CLICK_MESSAGE:9,ACTION_CLICK_VOICE_CALL:10,ACTION_CLICK_VIDEO_CALL:11,ACTION_CLICK_FORWARD:12,ACTION_CLICK_CATALOG_ICON:13,ACTION_CLICK_SHOPS_ICON:14,ACTION_CLICK_APP_LINK:15,ACTION_APP_IMPRESSION:16,ACTION_CLICK_STATUS:17,ACTION_EXIT:18,ACTION_COVER_PHOTO_IMPRESSION:19}),Dr=Object.freeze({SERIAL_MISMATCH_CERT_IN_MESSAGE_INVALID:0,NEW_SERIAL_CERT_IN_MESSAGE_INVALID:1,GET_VNAME_CERT_INVALID:2,VNAME_CERT_UPDATE_INVALID:3,IDENTITY_ADDED_INVALID:4,IDENTITY_CHANGED_INVALID:5,IDENTITY_DELETED_INVALID:6,USYNC_VNAME_CERT_INVALID:7,USYNC_NO_VNAME_CERT:8}),Nr=Object.freeze({STATIC:0,SHARED:1}),Lr=Object.freeze({INVALID:0,NOT_SINGLE_SEGMENT_CALL:1,NOT_START_FROM_VIDEO_CALL:2,HAS_AV_SWITCH:3,SELF_CAMERA_OFF:4,PEER_CAMERA_OFF:5,SELF_HAS_NETWORK_TRANSITION:6,PEER_HAS_NETWORK_TRANSITION:7,CALL_TOO_SHORT:8,PASS:100}),kr=Object.freeze({UNCACHED:0,IDLE:1,CHECKING:2,DOWNLOADING:3,UPDATEREADY:4,OBSOLETE:5}),Gr=Object.freeze({UNCACHED:0,IDB:1,SW:2}),Ur=Object.freeze({INDIVIDUAL:0,GROUP:1,BROADCAST_LIST:2}),Fr=Object.freeze({PROD:0,INTERN:1,DEV:2}),xr=Object.freeze({COMPLETED:0,ERROR:1,TIMEOUT:2,ABORTED:3}),Br=Object.freeze({SUCCESS:0,SILENCE:1,ZEROWIDTH:2}),Kr=Object.freeze({DOWNLOAD:1,UPLOAD:2}),Yr=Object.freeze({NEW_GROUP:1,CREATE_A_ROOM:2,PROFILE:3,CATALOG:4,ARCHIVED:5,STARRED:6,LABELS:7,SETTINGS:8,LOG_OUT:9,CONTACT_INFO:10,SELECT_MESSAGES:11,CLOSE_CHAT:12,MUTE_NOTIFICATIONS:13,CLEAR_MESSAGES:14,DELETE_CHAT:15,REPORT_BUSINESS:16,BLOCK:17,SETTINGS_NOTIFICATIONS:18,SETTINGS_THEME:19,SETTINGS_CHAT_WALLPAPER:20,SETTINGS_BLOCKED:21,SETTINGS_HELP:22,OPEN:23,CLOSE:24}),jr=Object.freeze({THREADS_SCREEN_CLICK:1,CHAT_SCREEN_CLICK:2,SETTINGS_SCREEN_CLICK:3}),Wr=Object.freeze({LOAD_PREV:0,LOAD_NEXT:1,LOAD_AROUND:2}),Hr=Object.freeze({NAVIGATE_NEXT:0,RELOAD:1,BACK_FORWARD:2,UNDEFINED:255}),Vr=Object.freeze({ANNOTATION_SIZE_LIMIT_EXCEEDED:1,MAX_POINT_COUNT_EXCEEDED:2,MAX_MARKER_COUNT_EXCEEDED:3,TOO_MANY_OPEN_MARKERS_TO_WRITE:4,POINT_TO_END_AT_NOT_FOUND:5,JSON_FORMAT_ERROR:6,MAX_STORAGE_EVENT_COUNT_REACHED:7,ERROR_UPLOADING_CHUNK:8,POINT_NAME_TOO_LONG:9,ANNOTATION_KEY_TOO_LONG:10,POINT_DATA_TOO_LONG:11,ERROR_PARSING_CONFIG:12}),$r=Object.freeze({UNKNOWN:0,USER_SCROLL:1,NEW_MESSAGE_PREFETCH:2,SEARCH_RESULT_CLICK:3}),zr=Object.freeze({OTHER:0,MSG_CLICK:1,STICKER_PANEL_ICON:2,MEDIA_VIEWER:3,VIDEO_STREAMING:4,STATUS_V3:5,MULTI_SELECT_DOWNLOAD:6,DOCUMENT_DOWNLOAD:7,PIP:8,STICKER_PANEL_STICKER:9,SEND_TO_CHAT:10,UPLOAD:11,MSG_INIT:12,MSG_UPDATE:13,MSG_DELETE:14,MSG_RENDER:15}),qr=Object.freeze({INITIAL_PAIRING:0,OFFLINE_RESUME:1,IDLE:2}),Jr=Object.freeze({TEXT:0,URL:1,IMAGE:2,VIDEO:3,GIF:4}),Qr=Object.freeze({MY:0,RECENT:1,VIEWED:2,MUTED:3}),Xr=Object.freeze({STICKER_MAKER_BUTTON_TAP:0,IMAGE_UPLOADED:1,IMAGE_CROPPED:2,EMOJI_ADDED:3,STICKER_ADDED:4,TEXT_ADDED:5,IMAGE_OUTLINED:6,SEND_STICKER:7}),Zr=Object.freeze({QR:0,MAIN:1,SYNCING:2,OFFLINE:3,CONFLICT:4,PROXYBLOCK:5,TOS_BLOCK:6,SMB_TOS_BLOCK:7,DEPRECATED_VERSION:8}),en=Object.freeze({PHONE:0,SERVER:1}),tn=Object.freeze({GET:0,SET:1}),rn=Object.freeze({WEB:1,WIN32:2,DARWIN:3,IOS_TABLET:4,ANDROID_TABLET:5,WINSTORE:6,MACSTORE:7,DARWIN_BETA:8,WIN32_BETA:9}),nn=Object.freeze({FALSE:0,TRUE:1,UNDEFINED:2}),an=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),sn=Object.freeze({FIRST_WELCOME_MESSAGE_IMP:0,FIRST_MESSAGE_SENT:1,QUICK_QUESTIONS_TAP:2,ICEBREAKERS_IMP:3,SELECT_QUESTION_TAP:4,SEND_TAP:5,ADS_CONTENT_DISMISSED:6}),on=Object.freeze({IQ_REQUEST_FAILED:0,NO_WELCOME_MESSAGE_RETURNED:1,WELCOME_MESSAGE_RETURNED:2}),ln=Object.freeze({DISCONNECTED:1,CONNECTING:2,CONNECTED:3,UNKNOWN:4}),cn=Object.freeze({DISABLED:0,ALLOC:1,ALLOC_AND_RTP:2}),dn=(0,a.defineGlobal)({appBuild:[1657,y,["regular","private"]],appIsBetaRelease:[21,s,["regular","private"]],appVersion:[17,c,["regular","private"]],browser:[779,c,["regular"]],browserVersion:[295,c,["regular"]],datacenter:[2795,c,["regular"]],deviceName:[13,c,["regular","private"]],deviceVersion:[4505,c,["regular"]],expoKey:[5029,c,["regular","private"]],mcc:[5,o,["regular","private"]],memClass:[655,o,["regular","private"]],mnc:[3,o,["regular","private"]],networkIsWifi:[23,s,["regular"]],osVersion:[15,c,["regular","private"]],platform:[11,Lt,["regular","private"]],psCountryCode:[6833,c,["private"]],psId:[6005,c,["private"]],webcBucket:[875,c,["regular"]],webcEnv:[633,Fr,["regular"]],webcNativeAutolaunch:[1009,s,["regular"]],webcNativeBetaUpdates:[1007,s,["regular"]],webcPhoneAppVersion:[1005,c,["regular"]],webcPhoneCharging:[783,s,["regular"]],webcPhoneDeviceManufacturer:[829,c,["regular"]],webcPhoneDeviceModel:[831,c,["regular"]],webcPhoneOsBuildNumber:[833,c,["regular"]],webcPhoneOsVersion:[835,c,["regular"]],webcPhonePlatform:[707,Lt,["regular"]],webcTabId:[3727,c,["regular"]],webcWebArch:[6605,c,["regular"]],webcWebDeviceManufacturer:[6599,c,["regular"]],webcWebDeviceModel:[6601,c,["regular"]],webcWebOsReleaseNumber:[6603,c,["regular"]],webcWebPlatform:[899,rn,["regular"]],yearClass:[689,o,["regular","private"]],yearClass2016:[2617,o,["regular","private"]]});(0,a.defineEvents)({AdvExpectedTsUnavailable:[3038,{},[1,1,1],"regular"],AdvIdentitySignatureInvalid:[3028,{advSignatureType:[1,dr]},[1,1,1],"regular"],AdvIdentityTimestampInvalid:[3046,{advIdentityIncomingTimestampInHours:[2,o],advIdentityLocalTimestampInHours:[1,o],advIdentityPrimaryIdentityMatch:[3,s]},[1,1,1],"regular"],AdvListSignatureInvalid:[3026,{},[1,1,1],"regular"],AdvListTimestampInvalid:[3040,{advListIncomingTimestampInHours:[2,o],advListIsExpired:[3,s],advListLocalTimestampInHours:[1,o]},[1,1,1],"regular"],AdvMetadataCreationFailure:[3048,{advMetadataIsMe:[1,s]},[1,1,1],"regular"],AdvPrimaryIdentityMissing:[3044,{primaryIdentityMissingProtoType:[1,Ut]},[1,1,1],"regular"],AdvProtoDecodeFailed:[3032,{advDecodeErrorType:[2,u],advDecodeProtoType:[1,p]},[1,1,1],"regular"],AdvProtoMissing:[3042,{advCompanionIdentityMissing:[2,s],missingProtoType:[1,St]},[1,1,1],"regular"],AdvStoredTimestampExpired:[3036,{advExpireTimeInHours:[1,o]},[1,1,1],"regular"],AdvTimestampMismatch:[3030,{advProtobufTimestampInHours:[2,o],advStanzaTimestampInHours:[1,o]},[1,1,1],"regular"],AdvUsyncInvalidKeyIndex:[3034,{},[1,1,1],"regular"],AndroidMessageSendPerf:[1994,{appRestart:[16,s],bucketedSenderKeyDistributionCountPercentage:[32,o],deviceSizeBucket:[26,ur],durationAbs:[11,d],durationRelative:[12,d],durationT:[1,d],fetchPrekeys:[15,s],fetchPrekeysPercentage:[21,o],groupSizeBucket:[17,ue],isDirectedMessage:[33,s],isE2eBackfill:[27,s],isMessageFanout:[9,s],isMessageForward:[8,s],isRevokeMessage:[24,s],isViewOnce:[29,s],jobsInQueue:[18,o],mediaType:[3,ft],messageIsFirstUserMessage:[30,s],messageIsInvisible:[31,s],messageType:[4,Et],networkWasDisconnected:[14,s],phoneCores:[34,o],prekeysEligibleForPrallelProcessing:[28,s],sendCount:[13,o],sendRetryCount:[10,o],sendStage:[2,pe],senderKeyDistributionCountPercentage:[23,o],sessionsMissingWhenComposing:[25,s],targetDeviceGroupSizeBucket:[20,ue],threadsInExecution:[19,o]},[1,1,2e3],"regular"],ArchiveSettings:[2788,{keepChatsArchived:[1,s]},[1,1,1],"regular"],AutoReply:[3212,{autoReplyAction:[1,v]},[1,1,1],"private",113760892],BannerEvent:[1578,{bannerOperation:[2,b],bannerType:[1,P]},[1,1,1],"regular"],BizCatalogView:[3006,{bizPlatform:[14,O],cartToggle:[13,s],catalogEntryPoint:[2,ee],catalogEventSampled:[11,s],catalogOwnerJid:[10,c],catalogReportReasonCode:[8,c],catalogSessionId:[3,c],catalogViewAction:[1,te],collectionId:[15,c],collectionIndex:[16,c],deepLinkOpenFrom:[12,Ce],isNewProductAddedToCart:[7,s],isOrderMsgAttached:[5,s],orderId:[4,c],productId:[9,c],productIndex:[17,c],quantity:[6,o],sequenceNumber:[18,o]},[1,1,1],"private",0],BizProfileView:[3008,{bizFbSize:[8,Tr],bizIgSize:[9,Tr],businessProfileJid:[2,c],catalogSessionId:[6,c],isProfileLinked:[10,s],isSelfView:[11,s],linkedAccount:[5,x],profileEntryPoint:[12,Bt],scrollDepth:[4,o],sequenceNumber:[7,o],viewBusinessProfileAction:[1,Rr],websiteSource:[3,an]},[1,1,1],"private",0],BusinessMute:[1376,{muteT:[2,d],muteeId:[1,c]},[1,1,1],"regular"],BusinessProfileView:[2440,{businessOwnerJid:[2,c],businessProfileViewAction:[1,k],businessProfileWebsiteSourceTyp:[3,G]},[1,1,1],"private",113760892],BusinessToolsClick:[2218,{businessToolsItem:[3,F],businessToolsSequenceNumber:[2,o],businessToolsSessionId:[1,c],linkingTarget:[4,x]},[1,1,1],"regular"],BusinessToolsEntry:[2216,{businessToolsEntryPoint:[3,U],businessToolsSequenceNumber:[2,o],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessToolsImpression:[2220,{businessToolsSequenceNumber:[2,o],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessUnmute:[1378,{muteeId:[1,c]},[1,1,1],"regular"],Call:[462,{acceptAckLatencyMs:[1016,d],acceptedButNotConnectedTimeSpentMs:[1015,d],activeRelayProtocol:[412,o],allocErrorBitmap:[593,o],androidAudioRouteMismatch:[1055,s],androidCamera2MinHardwareSupportLevel:[444,_],androidCameraApi:[443,m],androidSystemPictureInPictureT:[477,d],androidTelecomTimeSpentBeforeReject:[497,d],appInBackgroundDuringCall:[1109,s],audStreamMixPct:[1119,l],audioCodecDecodedFecFrames:[755,o],audioCodecDecodedPlcFrames:[756,o],audioCodecEncodedFecFrames:[751,o],audioCodecEncodedNonVoiceFrames:[753,o],audioCodecEncodedVoiceFrames:[752,o],audioCodecReceivedFecFrames:[754,o],audioDeviceIssues:[860,o],audioDeviceLastIssue:[861,o],audioDeviceSwitchCount:[867,o],audioDeviceSwitchDuration:[866,d],audioFrameLoss1xMs:[724,d],audioFrameLoss2xMs:[725,d],audioFrameLoss4xMs:[726,d],audioFrameLoss8xMs:[727,d],audioGetFrameUnderflowPs:[83,o],audioInbandFecDecoded:[679,o],audioInbandFecEncoded:[678,o],audioLossPeriodCount:[722,o],audioNackReqPktsRecvd:[646,o],audioNackReqPktsSent:[645,o],audioNackRtpRetransmitDiscardCount:[649,o],audioNackRtpRetransmitFailCount:[651,o],audioNackRtpRetransmitRecvdCount:[648,o],audioNackRtpRetransmitReqCount:[647,o],audioNackRtpRetransmitSentCount:[650,o],audioNumPiggybackRxPkt:[1008,o],audioNumPiggybackTxPkt:[1007,o],audioPlayCbIntervalGtDefaultCnt:[1138,o],audioPlayCbLatencyGteMaxCnt:[1139,o],audioPutFrameOverflowPs:[82,o],audioRecCbLatencyAvg:[1036,o],audioRecCbLatencyMax:[1035,o],audioRecCbLatencyMin:[1034,o],audioRecCbLatencyStddev:[1037,o],audioRtxPktDiscarded:[677,o],audioRtxPktProcessed:[676,o],audioRtxPktSent:[675,o],audioRxAvgFpp:[728,l],audioRxPktLossPctDuringPip:[642,l],audioTotalBytesOnNonDefCell:[450,l],avAvgDelta:[192,l],avMaxDelta:[193,l],aveNumPeersAutoPaused:[578,o],aveTimeBwResSwitches:[994,d],aveTimeBwVidRcDynCondTrue:[719,d],avgClockCbT:[139,d],avgDecodeT:[136,d],avgEncRestartAndKfGenT:[1048,d],avgEncRestartIntervalT:[1047,d],avgEncodeT:[135,d],avgEventQueuingDelay:[816,o],avgPlayCbT:[137,d],avgRecordCbIntvT:[495,d],avgRecordCbT:[138,d],avgRecordGetFrameT:[140,d],avgTargetBitrate:[141,l],avgTcpConnCount:[413,o],avgTcpConnLatencyInMsec:[414,d],batteryDropMatched:[355,s],batteryDropTriggered:[442,s],batteryLowMatched:[354,s],batteryLowTriggered:[441,s],batteryRulesApplied:[353,s],biDirRelayRebindLatencyMs:[843,d],biDirRelayResetLatencyMs:[844,d],builtinAecAvailable:[33,s],builtinAecEnabled:[38,s],builtinAecImplementor:[36,c],builtinAecUuid:[37,c],builtinAgcAvailable:[34,s],builtinNsAvailable:[35,s],bwaVidDisablingCandidate:[1114,s],bwaVidDisablingRxCandidateDuration:[1116,d],bwaVidDisablingTxCandidateDuration:[1115,d],bweEvaluationScoreE2e:[1068,o],bweEvaluationScoreSfuDl:[1070,o],bweEvaluationScoreSfuUl:[1069,o],c2DecAvgT:[302,d],c2DecFrameCount:[300,o],c2DecFramePlayed:[301,o],c2EncAvgT:[298,d],c2EncCpuOveruseCount:[299,o],c2EncFrameCount:[297,o],c2RxTotalBytes:[296,o],c2TxTotalBytes:[295,o],callAcceptFuncT:[132,d],callAecMode:[39,h],callAecOffset:[42,o],callAecTailLength:[43,o],callAgcMode:[52,f],callAndrGcmFgEnabled:[268,s],callAndroidAudioMode:[55,o],callAndroidRecordAudioPreset:[57,o],callAndroidRecordAudioSource:[56,o],callAudioEngineType:[54,S],callAudioRestartCount:[96,l],callAudioRestartReason:[97,l],callAvgAudioRxPipBitrate:[640,l],callAvgRottRx:[259,d],callAvgRottTx:[258,d],callAvgRtt:[107,d],callAvgVideoRxPipBitrate:[638,l],callBatteryChangePct:[195,l],callCalculatedEcOffset:[50,o],callCalculatedEcOffsetStddev:[51,o],callCreatorHid:[505,c],callDefNetwork:[405,K],callEcRestartCount:[99,l],callEchoEnergy:[46,l],callEchoLikelihood:[44,o],callEchoLikelihoodBeforeEc:[47,l],callEndFuncT:[130,d],callEndReconnecting:[70,s],callEndReconnectingBeforeNetworkChange:[877,s],callEndReconnectingBeforeP2pFailover:[875,s],callEndReconnectingBeforeRelayFailover:[869,s],callEndReconnectingBeforeRelayReset:[948,s],callEndReconnectingSoonAfterCallActive:[848,s],callEndReconnectingSoonAfterNetworkChange:[878,s],callEndReconnectingSoonAfterP2pFailover:[876,s],callEndReconnectingSoonAfterRelayFailover:[870,s],callEndReconnectingSoonAfterRelayReset:[949,s],callEndedDuringAudFreeze:[518,s],callEndedDuringVidFreeze:[517,s],callEndedInterrupted:[23,s],callEnterPipModeCount:[626,o],callFromUi:[2,B],callHistEchoLikelihood:[45,l],callInitialRtt:[109,d],callInterrupted:[22,s],callIsLastSegment:[388,s],callLastRtt:[108,d],callMaxRtt:[106,d],callMessagesBufferedCount:[422,o],callMinRtt:[105,d],callNetwork:[76,K],callNetworkSubtype:[77,o],callNsMode:[53,Ct],callOfferAckTimout:[159,l],callOfferDelayT:[243,d],callOfferElapsedT:[102,d],callOfferFanoutCount:[588,o],callOfferReceiptDelay:[134,d],callP2pAvgRtt:[457,d],callP2pDisabled:[18,s],callP2pMinRtt:[456,d],callPeerAppVersion:[15,c],callPeerIpStr:[10,c],callPeerIpv4:[8,o],callPeerPlatform:[5,c],callPendingCallsAcceptedCount:[501,o],callPendingCallsCount:[498,o],callPendingCallsRejectedCount:[499,o],callPendingCallsTerminatedCount:[500,o],callPipMode10sCount:[628,o],callPipMode10sT:[633,d],callPipMode120sCount:[631,o],callPipMode120sT:[636,d],callPipMode240sCount:[632,o],callPipMode240sT:[637,d],callPipMode30sCount:[629,o],callPipMode30sT:[634,d],callPipMode60sCount:[630,o],callPipMode60sT:[635,d],callPipModeT:[627,d],callPlaybackBufferSize:[59,o],callPlaybackCallbackStopped:[25,s],callPlaybackFramesPs:[93,l],callPlaybackSilenceRatio:[95,l],callRadioType:[231,ar],callRandomId:[529,c],callRecentPlaybackFramesPs:[94,l],callRecentRecordFramesPs:[29,l],callReconnectingStateCount:[438,o],callRecordBufferSize:[58,o],callRecordCallbackStopped:[24,s],callRecordFramesPs:[28,o],callRecordMaxEnergyRatio:[98,l],callRecordSilenceRatio:[26,o],callRejectFuncT:[131,d],callRelayAvgRtt:[455,d],callRelayBindStatus:[16,Y],callRelayCreateT:[104,d],callRelayMinRtt:[454,d],callRelayServer:[17,c],callResult:[63,j],callRingingT:[103,d],callRxAvgBitrate:[121,l],callRxAvgBwe:[122,l],callRxAvgJitter:[125,d],callRxAvgLossPeriod:[128,d],callRxMaxJitter:[124,d],callRxMaxLossPeriod:[127,d],callRxMinJitter:[123,d],callRxMinLossPeriod:[126,d],callRxPktLossPct:[120,l],callRxPktLossRetransmitPct:[892,l],callRxStoppedT:[100,d],callSamplingRate:[30,o],callSegmentIdx:[389,o],callSegmentType:[393,W],callSelfIpStr:[9,c],callSelfIpv4:[7,o],callServerNackErrorCode:[68,o],callSetupErrorType:[71,H],callSetupT:[101,d],callSide:[1,V],callSoundPortFuncT:[133,d],callStartFuncT:[129,d],callSwAecMode:[41,o],callSwAecType:[40,Sr],callT:[92,d],callTermReason:[69,$],callTestBucket:[19,c],callTestEvent:[318,o],callTonesDetectedInRecord:[49,o],callTonesDetectedInRingback:[48,o],callTransitionCount:[78,o],callTransitionCountCellularToWifi:[432,o],callTransitionCountWifiToCellular:[431,o],callTransport:[72,z],callTransportExtrayElected:[515,s],callTransportP2pToRelayFallbackCount:[80,o],callTransportPeerTcpUsed:[587,s],callTransportRelayToRelayFallbackCount:[79,o],callTransportTcpFallbackToUdp:[516,s],callTransportTcpUsed:[514,s],callTxAvgBitrate:[112,l],callTxAvgBwe:[113,l],callTxAvgJitter:[116,d],callTxAvgLossPeriod:[119,d],callTxMaxJitter:[115,d],callTxMaxLossPeriod:[118,d],callTxMinJitter:[114,d],callTxMinLossPeriod:[117,d],callTxPktErrorPct:[111,l],callTxPktLossPct:[110,l],callUserRate:[20,o],callWakeupSource:[156,J],calleeAcceptToDecodeT:[447,d],callerInContact:[476,s],callerOfferToDecodeT:[445,d],callerVidRtpToDecodeT:[446,d],cameraFormats:[765,o],cameraIssues:[850,o],cameraLastIssue:[851,o],cameraOffCount:[331,o],cameraPauseT:[1131,d],cameraPermission:[849,s],cameraPreviewMode:[322,Q],cameraStartDuration:[852,d],cameraStartFailureDuration:[856,d],cameraStartMode:[233,X],cameraStartToFirstFrameT:[916,d],cameraStopDuration:[853,d],cameraStopFailureCount:[858,o],cameraSwitchCount:[855,o],cameraSwitchDuration:[854,d],cameraSwitchFailureDuration:[857,d],clampedBwe:[527,s],codecSamplingRate:[624,o],combinedE2eAvgRtt:[760,l],combinedE2eMaxRtt:[761,l],combinedE2eMinRtt:[759,l],confBridgeSamplingRate:[623,o],conservativeModeStopped:[974,s],conservativeRampUpExploringT:[743,d],conservativeRampUpHeldCount:[643,o],conservativeRampUpHoldingT:[741,d],conservativeRampUpRampingUpT:[742,d],createdFromGroupCallDowngrade:[519,s],dataLimitOnAltNetworkReached:[537,s],deviceBoard:[230,c],deviceHardware:[229,c],dtxRxByteFrameCount:[914,o],dtxRxCount:[912,o],dtxRxDurationT:[911,d],dtxRxTotalCount:[913,o],dtxRxTotalFrameCount:[1083,o],dtxTxByteFrameCount:[910,o],dtxTxCount:[619,o],dtxTxDurationT:[618,d],dtxTxTotalCount:[909,o],dtxTxTotalFrameCount:[1082,o],echoCancellationMsPerSec:[320,o],echoCancelledFrameCount:[940,o],echoEstimatedFrameCount:[941,o],echoSpeakerModeFrameCount:[987,o],encoderCompStepdowns:[81,o],endCallAfterConfirmation:[90,Fe],failureToCreateAltSocket:[534,o],failureToCreateTestAltSocket:[532,o],fastplayMaxDurationMs:[1005,d],fastplayNumFrames:[1004,o],fastplayNumTriggers:[1006,o],fieldStatsRowType:[328,Ye],finishedDlBwe:[503,s],finishedOverallBwe:[528,s],finishedUlBwe:[502,s],freezeAheadBweCongestionCorrPct:[1051,l],freezeBweCongestionCorrPct:[1009,l],groupAcceptNoCriticalGroupUpdate:[1013,s],groupAcceptToCriticalGroupUpdateMs:[1014,d],groupCallCallerParticipantCountAtCallStart:[439,o],groupCallInviteCountSinceCallStart:[360,o],groupCallIsGroupCallInvitee:[357,s],groupCallIsLastSegment:[356,s],groupCallNackCountSinceCallStart:[361,o],groupCallReringCountSinceCallStart:[946,o],groupCallReringNackCountSinceCallStart:[947,o],groupCallSegmentIdx:[329,o],groupCallTotalCallTSinceCallStart:[358,d],groupCallTotalP3CallTSinceCallStart:[359,d],groupCallVideoMaximizedCount:[592,o],hasRestrictedSettingsForAudioCalls:[539,s],highPeerBweT:[884,d],hisBasedInitialTxBitrate:[342,o],hisInfoCouldBeUsedForInitBwe:[339,s],historyBasedBweActivated:[807,s],historyBasedBweEnabled:[806,s],historyBasedBweSuccess:[808,s],historyBasedBweVideoTxBitrate:[809,o],incomingCallUiAction:[387,$e],initBweSource:[337,ze],initialEstimatedTxBitrate:[244,l],isIpv6Capable:[91,s],isLinkedGroupCall:[1090,s],isPendingCall:[976,s],isRejoin:[927,s],isRering:[945,s],isUpnpExternalIpPrivate:[260,s],isUpnpExternalIpTheSameAsReflexiveIp:[261,s],jbAvgDelay:[146,l],jbAvgDelayUniform:[644,l],jbAvgDisorderTargetSize:[1086,l],jbAvgTargetSize:[1012,l],jbDiscards:[150,l],jbEmpties:[151,l],jbEmptyPeriods1x:[997,l],jbEmptyPeriods2x:[998,l],jbEmptyPeriods4x:[999,l],jbEmptyPeriods8x:[1e3,l],jbGets:[152,l],jbLastDelay:[149,l],jbLost:[277,l],jbLostEmptyDuringPip:[641,o],jbLostEmptyHighPeerBwePerSec:[777,l],jbLostEmptyLowPeerBwePerSec:[775,l],jbLostEmptyLowToHighPeerBwePerSec:[776,l],jbMaxDelay:[148,l],jbMaxDisorderTargetSize:[1087,l],jbMinDelay:[147,l],jbNonSpeechDiscards:[846,l],jbPuts:[153,l],jbTotalEmptyPeriods:[996,l],jbVoiceFrames:[1081,o],joinableAfterCall:[895,s],joinableDuringCall:[894,s],joinableNewUi:[893,s],l1Locations:[986,c],lastConnErrorStatus:[415,o],libsrtpVersionUsed:[504,pr],lobbyVisibleT:[1127,d],logSampleRatio:[1120,o],longConnect:[21,s],lossOfAltSocket:[535,o],lossOfTestAltSocket:[533,o],lowDataUsageBitrate:[157,l],lowPeerBweT:[885,d],lowToHighPeerBweT:[886,d],malformedStanzaXpath:[452,c],maxConnectedParticipants:[1085,o],maxEventQueueDepth:[558,o],mediaStreamSetupT:[448,d],micAvgPower:[253,o],micMaxPower:[252,o],micMinPower:[251,o],micPermission:[859,s],micStartDuration:[862,d],micStartToFirstCallbackT:[931,d],micStopDuration:[863,d],multipleTxRxRelaysInUse:[838,s],nativeSamplesPerFrame:[32,c],nativeSamplingRate:[31,c],neteqAcceleratedFrames:[653,o],neteqExpandedFrames:[652,o],networkFailoverTriggeredCount:[1135,o],networkMediumChangeLatencyMs:[995,d],nseEnabled:[1128,s],nseOfflineQueueMs:[1129,d],numAsserts:[933,o],numConnectedParticipants:[330,o],numConnectedPeers:[1052,o],numCriticalGroupUpdateDropped:[567,o],numDirPjAsserts:[985,o],numInvitedParticipants:[1054,o],numL1Errors:[929,o],numL2Errors:[930,o],numOutOfOrderCriticalGroupUpdate:[625,o],numOutgoingRingingPeers:[1053,o],numPeersAutoPausedOnce:[577,o],numRenderSkipGreenFrame:[1029,o],numResSwitch:[993,o],numTransitionsToSpeech:[1113,o],numVidDlAutoPause:[574,o],numVidDlAutoResume:[576,o],numVidDlAutoResumeRejectBadAudio:[579,o],numVidRcDynCondTrue:[717,o],numVidUlAutoPause:[559,o],numVidUlAutoPauseFail:[560,o],numVidUlAutoPauseRejectHighSendingRate:[564,o],numVidUlAutoPauseRejectTooEarly:[565,o],numVidUlAutoPauseUserAction:[566,o],numVidUlAutoResume:[561,o],numVidUlAutoResumeFail:[562,o],numVidUlAutoResumeRejectAudioLqm:[563,o],numberOfProcessors:[27,o],offerAckLatencyMs:[1017,d],oibweDlProbingTime:[805,d],oibweE2eProbingTime:[802,d],oibweNotFinishedWhenCallActive:[868,s],oibweOibleProbingTime:[803,d],oibweUlProbingTime:[804,d],onMobileDataSaver:[525,s],onWifiAtStart:[540,s],oneSideInitRxBitrate:[507,o],oneSideInitTxBitrate:[506,o],oneSideMinPeerInitRxBitrate:[509,o],oneSideRcvdPeerRxBitrate:[508,s],opusVersion:[287,o],p2pSuccessCount:[522,o],pcntPoorAudLqmAfterPause:[599,l],pcntPoorAudLqmBeforePause:[598,l],pcntPoorVidLqmAfterPause:[597,l],pcntPoorVidLqmBeforePause:[596,l],peerCallNetwork:[264,wt],peerCallResult:[66,j],peerTransport:[591,z],peerVideoHeight:[191,o],peerVideoWidth:[190,o],peerXmppStatus:[4,ln],pingsSent:[160,l],pongsReceived:[161,l],poolMemUsage:[510,o],poolMemUsagePadding:[511,o],presentEndCallConfirmation:[89,Fe],prevCallTestBucket:[1060,c],previousCallInterval:[266,d],previousCallVideoEnabled:[265,s],previousCallWithSamePeer:[267,s],previousJoinNotEnded:[1001,s],probeAvgBitrate:[327,l],pushToCallOfferDelay:[158,l],rcMaxrtt:[155,l],rcMinrtt:[154,l],receivedByNse:[1130,s],reconnectingStartsBeforeCallActive:[847,s],recordCircularBufferFrameCount:[84,o],reflectivePortsDiff:[162,l],rekeyTime:[1140,o],relayBindFailureAltNetSwitchSuccess:[583,o],relayBindFailureAltNetSwitchTriggered:[582,o],relayBindFailureAltNetworkSwitchToCallEnd:[586,d],relayBindFailureFallbackCount:[581,o],relayBindFailureIpVersionSwitchToCallEnd:[585,d],relayBindFailureIpVersionSwitchTriggered:[584,o],relayBindTimeInMsec:[424,d],relayElectionTimeInMsec:[423,d],relayFallbackOnRxDataFromRelay:[481,o],relayFallbackOnStopRxDataOnP2p:[482,o],relayFallbackOnTransportStanzaNotification:[483,o],renderFreezeHighPeerBweT:[780,d],renderFreezeLowPeerBweT:[778,d],renderFreezeLowToHighPeerBweT:[779,d],rxProbeCountSuccess:[291,o],rxProbeCountTotal:[290,o],rxRelayRebindLatencyMs:[841,d],rxRelayResetLatencyMs:[842,d],rxTotalBitrate:[145,l],rxTotalBytes:[143,l],rxTpFbBitrate:[294,l],rxTrafficStartFalsePositive:[758,s],sbweAvgDowntrend:[963,l],sbweAvgUptrend:[962,l],sbweCeilingCongestionCount:[783,o],sbweCeilingCount:[781,o],sbweCeilingMissingRtcpCongestionCount:[786,o],sbweCeilingNoNewDataReceivedCongestionCount:[787,o],sbweCeilingPktLossCount:[782,o],sbweCeilingReceiveSideCount:[1106,o],sbweCeilingRttCongestionCount:[784,o],sbweCeilingZeroRttCongestionCount:[785,o],sbweGlobalMinRttCongestionCount:[1103,o],sbweHighestRttCongestionCount:[1133,o],sbweHoldCount:[961,o],sbweMinRttEmaCongestionCount:[1104,o],sbweRampDownCount:[960,o],sbweRampUpCount:[959,o],sbweRampUpPauseCount:[1134,o],senderBweInitBitrate:[975,o],sfuAbnormalUplinkRttCount:[879,o],sfuAvgDlPlrAtBalancedCongestion:[1096,l],sfuAvgDlPlrAtHighDlCongestion:[1094,l],sfuAvgDlPlrAtHighUlCongestion:[1092,l],sfuAvgLqHqTargetBitrateDiff:[1002,l],sfuAvgPeerRttAtBalancedCongestion:[1102,o],sfuAvgPeerRttAtHighPeerCongestion:[1100,o],sfuAvgPeerRttAtHighSelfCongestion:[1098,o],sfuAvgSelfRttAtBalancedCongestion:[1101,o],sfuAvgSelfRttAtHighPeerCongestion:[1099,o],sfuAvgSelfRttAtHighSelfCongestion:[1097,o],sfuAvgTargetBitrate:[673,l],sfuAvgTargetBitrateHq:[943,l],sfuAvgUlPlrAtBalancedCongestion:[1095,l],sfuAvgUlPlrAtHighDlCongestion:[1093,l],sfuAvgUlPlrAtHighUlCongestion:[1091,l],sfuBalancedPktLossAtCongestion:[1075,o],sfuBalancedRttAtCongestion:[1079,o],sfuBwaAllParticipantDlBwUsedPct:[919,l],sfuBwaAllParticipantUlBwUsedPct:[918,l],sfuBwaChangeNumStreamCount:[928,o],sfuBwaSelfDlBwUsedPct:[1003,l],sfuBwaSelfUlBwUsedPct:[917,l],sfuBwaSimulcastDisabledCntReasonBattery:[920,o],sfuBwaSimulcastDisabledCntReasonNetMedium:[921,o],sfuBwaVidEncHqStreamScheduledT:[926,d],sfuBwaVidEncLqStreamScheduledT:[925,d],sfuDownlinkAvgCombinedBwe:[662,l],sfuDownlinkAvgPktLossPct:[667,l],sfuDownlinkAvgRemoteBwe:[661,l],sfuDownlinkAvgSenderBwe:[660,l],sfuDownlinkMaxPktLossPct:[668,l],sfuDownlinkMinPktLossPct:[666,l],sfuDownlinkSbweAvgDowntrend:[973,l],sfuDownlinkSbweAvgUptrend:[972,l],sfuDownlinkSbweCeilingCongestionCount:[797,o],sfuDownlinkSbweCeilingCount:[795,o],sfuDownlinkSbweCeilingMissingRtcpCongestionCount:[800,o],sfuDownlinkSbweCeilingNoNewDataReceivedCongestionCount:[801,o],sfuDownlinkSbweCeilingPktLossCount:[796,o],sfuDownlinkSbweCeilingRttCongestionCount:[798,o],sfuDownlinkSbweCeilingZeroRttCongestionCount:[799,o],sfuDownlinkSbweHoldCount:[971,o],sfuDownlinkSbweRampDownCount:[970,o],sfuDownlinkSbweRampUpCount:[969,o],sfuDownlinkSenderBweDiffStddev:[958,l],sfuDownlinkSenderBweStddev:[957,l],sfuFirstRxBandwidthReportTime:[1111,d],sfuFirstRxParticipantReportTime:[883,d],sfuFirstRxUplinkReportTime:[881,d],sfuHighDlPktLossAtCongestion:[1074,o],sfuHighDlRttAtCongestion:[1078,o],sfuHighUlPktLossAtCongestion:[1073,o],sfuHighUlRttAtCongestion:[1077,o],sfuMaxTargetBitrate:[674,l],sfuMaxTargetBitrateHq:[944,l],sfuMinTargetBitrate:[672,l],sfuMinTargetBitrateHq:[942,l],sfuPeerDownlinkStddevAllCombinedBwe:[813,l],sfuRxBandwidthReportCount:[1110,o],sfuRxParticipantReportCount:[882,o],sfuRxUplinkReportCount:[880,o],sfuSimulcastAvgDecSessFlipTime:[833,d],sfuSimulcastAvgEncSchedEventUpdateTime:[837,d],sfuSimulcastBwaCandidateCnt:[923,o],sfuSimulcastBwaDownlinkBottleneckCount:[874,o],sfuSimulcastBwaUplinkBottleneckCount:[873,o],sfuSimulcastDecAvgKfRecvTimeSinceFlip:[952,d],sfuSimulcastDecAvgNumReplayedCachedPkt:[951,l],sfuSimulcastDecAvgNumSkippedCachedPkt:[950,l],sfuSimulcastDecNumNoKf:[953,o],sfuSimulcastDecSessFlipCount:[744,o],sfuSimulcastDecSessFlipErrorBitmap:[768,o],sfuSimulcastDecSessFlipErrorCount:[767,o],sfuSimulcastEncErrorBitmap:[766,o],sfuSimulcastEncSchedEventCount:[732,o],sfuSimulcastEncSchedEventErrorCount:[735,o],sfuSimulcastEncSchedEventSkipCount:[734,o],sfuSimulcastEncSchedEventSuccessUpdateCount:[733,o],sfuSimulcastMaxDecSessFlipTime:[832,d],sfuSimulcastMaxEncSchedEventUpdateTime:[836,d],sfuSimulcastMinDecSessFlipTime:[831,d],sfuSimulcastMinEncSchedEventUpdateTime:[835,d],sfuUplinkAvgCombinedBwe:[659,l],sfuUplinkAvgPktLossPct:[664,l],sfuUplinkAvgRemoteBwe:[658,l],sfuUplinkAvgRtt:[670,l],sfuUplinkAvgSenderBwe:[657,l],sfuUplinkMaxPktLossPct:[665,l],sfuUplinkMaxRtt:[671,l],sfuUplinkMinPktLossPct:[663,l],sfuUplinkMinRtt:[669,l],sfuUplinkSbweAvgDowntrend:[968,l],sfuUplinkSbweAvgUptrend:[967,l],sfuUplinkSbweCeilingCongestionCount:[790,o],sfuUplinkSbweCeilingCount:[788,o],sfuUplinkSbweCeilingMissingRtcpCongestionCount:[793,o],sfuUplinkSbweCeilingNoNewDataReceivedCongestionCount:[794,o],sfuUplinkSbweCeilingPktLossCount:[789,o],sfuUplinkSbweCeilingRttCongestionCount:[791,o],sfuUplinkSbweCeilingZeroRttCongestionCount:[792,o],sfuUplinkSbweHoldCount:[966,o],sfuUplinkSbweRampDownCount:[965,o],sfuUplinkSbweRampUpCount:[964,o],sfuUplinkSenderBweDiffStddev:[956,l],sfuUplinkSenderBweStddev:[955,l],simulcastAvgLqBitrateWhenHqEnabled:[1011,o],simulcastReplayVideoRenderFreeze2xT:[982,d],simulcastReplayVideoRenderFreeze4xT:[983,d],simulcastReplayVideoRenderFreeze8xT:[984,d],simulcastReplayVideoRenderFreezeT:[981,d],skippedBwaCycles:[748,o],skippedBweCycles:[747,o],smallCallButton:[6,s],speakerAvgPower:[250,o],speakerMaxPower:[249,o],speakerMinPower:[248,o],speakerStartDuration:[864,d],speakerStartToFirstCallbackT:[932,d],speakerStopDuration:[865,d],startedInitBweProbing:[900,s],switchToDefTriggeredByGoodDefNet:[538,o],switchToNonSfu:[750,o],switchToNonSimulcast:[1057,o],switchToSfu:[749,o],switchToSimulcast:[1056,o],symmetricNatPortGap:[257,o],systemNotificationOfNetChange:[541,o],telecomFrameworkCallStartDelayT:[440,d],timeEnc1280w:[992,d],timeEnc160w:[988,d],timeEnc320w:[989,d],timeEnc480w:[990,d],timeEnc640w:[991,d],timeOnNonDefNetwork:[530,d],timeOnNonDefNetworkPerSegment:[531,d],timeSinceLastRtpToCallEndInMsec:[715,d],timeVidRcDynCondTrue:[718,d],totalAqsMsgSent:[1126,o],totalAudioFrameLossMs:[723,d],totalBytesOnNonDefCell:[449,l],totalTimeVidDlAutoPause:[575,d],totalTimeVidUlAutoPause:[573,d],trafficShaperAvgAudioQueueMs:[898,d],trafficShaperAvgQueueMs:[242,d],trafficShaperAvgVideoQueueMs:[899,d],trafficShaperMaxDelayViolations:[240,o],trafficShaperMinDelayViolations:[241,o],trafficShaperOverflowCount:[237,o],trafficShaperQueueEmptyCount:[238,o],trafficShaperQueuedAudioPacketCount:[896,o],trafficShaperQueuedPacketCount:[239,o],trafficShaperQueuedVideoPacketCount:[897,o],transportCurTimeInMsecAsyncWriteWaitingInQueue:[552,d],transportLastSendOsError:[555,o],transportNumAsyncWriteDispatched:[580,o],transportNumAsyncWriteQueued:[551,o],transportOvershoot10PercCount:[699,o],transportOvershoot20PercCount:[700,o],transportOvershoot40PercCount:[701,o],transportOvershootLongestStreakS:[708,o],transportOvershootSinceLast10sCount:[704,o],transportOvershootSinceLast15sCount:[705,o],transportOvershootSinceLast1sCount:[702,o],transportOvershootSinceLast30sCount:[706,o],transportOvershootSinceLast5sCount:[703,o],transportOvershootStreakAvgS:[709,l],transportOvershootTimeBetweenAvgS:[707,l],transportRtpSendErrorRate:[557,l],transportSendErrorCount:[556,o],transportSplitterRxErrCnt:[1059,o],transportSplitterTxErrCnt:[1058,o],transportSrtcpRxRejectedPktCnt:[1141,o],transportSrtpRxMaxPktSize:[1038,o],transportSrtpRxRejectedBitrate:[763,l],transportSrtpRxRejectedDupPktCnt:[772,o],transportSrtpRxRejectedPktCnt:[762,o],transportSrtpTxFailedPktCnt:[774,o],transportSrtpTxMaxPktSize:[773,o],transportTotalNumSendOsError:[554,o],transportTotalTimeInMsecAsyncWriteQueueToDispatch:[553,d],transportUndershoot10PercCount:[710,o],transportUndershoot20PercCount:[711,o],transportUndershoot40PercCount:[712,o],triggeredButDataLimitReached:[536,o],tsLogUpload:[1112,Ar],txProbeCountSuccess:[289,o],txProbeCountTotal:[288,o],txRelayBindUnbindPacketsMissingMessageIntegrity:[1105,o],txRelayRebindLatencyMs:[839,d],txRelayResetLatencyMs:[840,d],txTotalBitrate:[144,l],txTotalBytes:[142,l],txTpFbBitrate:[293,l],upnpAddResultCode:[246,Mr],upnpRemoveResultCode:[247,Or],usedInitTxBitrate:[341,o],userDescription:[87,c],userProblems:[88,o],userRating:[86,o],vidAvgBurstyPktLossLength:[1121,d],vidAvgRandomPktLossLength:[1122,d],vidBurstyPktLossTime:[1123,d],vidCorrectRetxDetectPcnt:[688,o],vidFreezeTMsInSample0:[695,d],vidJbAvgDelay:[1062,l],vidJbDiscards:[1063,l],vidJbEmpties:[1064,l],vidJbGets:[1065,l],vidJbLost:[1061,l],vidJbPuts:[1066,l],vidJbResets:[1067,l],vidNumFecDroppedNoHole:[696,o],vidNumFecDroppedTooBig:[697,o],vidNumRandToBursty:[1124,o],vidNumRetxDropped:[698,o],vidNumRxRetx:[757,o],vidPktRxState0:[693,c],vidRandomPktLossTime:[1125,d],vidRxFecRateInSample0:[694,l],vidUlAutoPausedAtCallEnd:[589,s],vidUlTimeSinceAutoPauseAtCallEnd:[590,d],vidWrongRetxDetectPcnt:[716,o],videoActiveTime:[276,d],videoAheadAvSyncDiscardedFramesAvgDeltaT:[1041,d],videoAheadAvSyncRenderedFramesAvgDeltaT:[1043,d],videoAheadNumAvSyncDiscardFrames:[1039,o],videoAveDelayLtrp:[484,d],videoAvgCombPsnr:[390,l],videoAvgEncodingPsnr:[410,l],videoAvgScalingPsnr:[408,l],videoAvgSenderBwe:[186,l],videoAvgTargetBitrate:[184,l],videoAvgTargetBitrateHq:[828,l],videoBehindAvSyncDiscardedFramesAvgDeltaT:[1042,d],videoBehindAvSyncRenderedFramesAvgDeltaT:[1044,d],videoBehindNumAvSyncDiscardFrames:[1040,o],videoCaptureAvgFps:[222,o],videoCaptureConverterTs:[226,d],videoCaptureDupFrames:[887,o],videoCaptureFrameOverwriteCount:[496,o],videoCaptureHeight:[228,o],videoCaptureWidth:[227,o],videoCodecScheme:[401,o],videoCodecSubType:[303,o],videoCodecType:[236,o],videoDecAvgBitrate:[220,o],videoDecAvgConsecutiveKfVp8:[610,l],videoDecAvgConsecutiveLtrpVp8:[611,l],videoDecAvgFps:[207,l],videoDecAvgFramesFromFoundLtrVp8:[612,l],videoDecAvgFramesFromUnfoundLtrVp8:[613,l],videoDecColorId:[205,o],videoDecCrcMismatchFrames:[419,o],videoDecErrorFrames:[174,o],videoDecErrorFramesCodecSwitch:[714,o],videoDecErrorFramesDuplicate:[713,o],videoDecErrorFramesH264:[680,o],videoDecErrorFramesIgnoreConsecutive:[478,o],videoDecErrorFramesOutoforder:[682,o],videoDecErrorFramesSpsPpsH264:[812,o],videoDecErrorFramesSpsPpsMissingAfterResolutionSwitch:[810,o],videoDecErrorFramesSpsPpsNotSupportedAfterResolutionSwitch:[811,o],videoDecErrorFramesVp8:[681,o],videoDecErrorLtrpFramesVp8:[462,o],videoDecErrorLtrpFramesVp8CrcMismatch:[479,o],videoDecErrorLtrpFramesVp8NoLtr:[480,o],videoDecErrorLtrpFramesVp8NoLtr10:[615,o],videoDecErrorLtrpFramesVp8NoLtr5:[614,o],videoDecFatalErrorNum:[1084,o],videoDecInputFrames:[172,o],videoDecKeyframes:[175,o],videoDecLatency:[223,d],videoDecLatencyH264:[684,d],videoDecLatencyVp8:[683,d],videoDecLostPackets:[210,o],videoDecLtrpFramesVp8:[461,o],videoDecLtrpPoolCreateFailed:[490,s],videoDecName:[204,o],videoDecNumPliThrottledByAllLtrp:[915,o],videoDecNumSkippedFramesVp8:[616,o],videoDecNumSwitchesToAllLtrp:[617,o],videoDecOutputFrames:[173,o],videoDecRestart:[206,o],videoDecSkipPackets:[209,o],videoDecodePausedCount:[232,o],videoDowngradeCount:[273,o],videoEnabled:[163,s],videoEnabledAtCallStart:[270,s],videoEncAllLtrpTimeInMsec:[609,d],videoEncAvgBitrate:[221,o],videoEncAvgConsecutiveKfVp8:[605,l],videoEncAvgConsecutiveLtrpVp8:[606,l],videoEncAvgFps:[216,l],videoEncAvgFpsHq:[825,l],videoEncAvgFramesFromFoundLtrVp8:[604,l],videoEncAvgFramesFromUnfoundLtrVp8:[603,l],videoEncAvgPsnrKeyFrameVp8:[465,l],videoEncAvgPsnrLtrpFrameVp8:[469,l],videoEncAvgPsnrPFramePrevRefVp8:[474,l],videoEncAvgQpKeyFrameVp8:[466,l],videoEncAvgQpLtrpFrameVp8:[470,l],videoEncAvgQpPFramePrevRefVp8:[475,l],videoEncAvgSizeAllLtrpFrameVp8:[685,l],videoEncAvgSizeKeyFrameVp8:[464,l],videoEncAvgSizeLtrpFrameVp8:[468,l],videoEncAvgSizePFramePrevRefVp8:[473,l],videoEncAvgTargetFps:[215,l],videoEncAvgTargetFpsHq:[827,l],videoEncColorId:[213,o],videoEncDeviationAllLtrpFrameVp8:[686,l],videoEncDeviationPFramePrevRefVp8:[687,l],videoEncDiscardFrame:[217,o],videoEncDiscardFrameHq:[938,o],videoEncDropFrames:[179,o],videoEncDropFramesHq:[937,o],videoEncErrorFrames:[178,o],videoEncErrorFramesHq:[936,o],videoEncFatalErrorNum:[1049,o],videoEncInputFrames:[176,o],videoEncInputFramesHq:[934,o],videoEncKeyframes:[180,o],videoEncKeyframesHq:[939,o],videoEncKeyframesVp8:[463,o],videoEncKfErrCodecSwitchT:[731,d],videoEncKfIgnoreOldFrames:[729,o],videoEncKfQueueEmpty:[730,o],videoEncLatency:[224,d],videoEncLatencyHq:[826,d],videoEncLtrpFrameGenFailedVp8:[471,o],videoEncLtrpFramesVp8:[467,o],videoEncLtrpPoolCreateFailed:[491,s],videoEncLtrpToKfFallbackVp8:[494,o],videoEncModifyNum:[1050,o],videoEncName:[212,o],videoEncNumErrorLtrHoldFailedVp8:[600,o],videoEncNumErrorLtrHoldFailedVp810:[602,o],videoEncNumErrorLtrHoldFailedVp85:[601,o],videoEncNumSuccessHfFallbackVp8:[622,o],videoEncNumSwitchesToAllLtrp:[607,o],videoEncOutputFrames:[177,o],videoEncOutputFramesHq:[935,o],videoEncPFramePrevRefVp8:[472,o],videoEncRegularLtrpTimeInMsec:[608,d],videoEncRestart:[214,o],videoEncRestartPresetChange:[1046,o],videoEncRestartResChange:[1045,o],videoEncTimeOvershoot10PercH264:[363,d],videoEncTimeOvershoot10PercH265:[366,d],videoEncTimeOvershoot10PercVp8:[369,d],videoEncTimeOvershoot10PercVp9:[372,d],videoEncTimeOvershoot20PercH264:[364,d],videoEncTimeOvershoot20PercH265:[367,d],videoEncTimeOvershoot20PercVp8:[370,d],videoEncTimeOvershoot20PercVp9:[373,d],videoEncTimeOvershoot40PercH264:[365,d],videoEncTimeOvershoot40PercH265:[368,d],videoEncTimeOvershoot40PercVp8:[371,d],videoEncTimeOvershoot40PercVp9:[374,d],videoEncTimeSpentInFastH264Ms:[1026,d],videoEncTimeSpentInFasterH264Ms:[1025,d],videoEncTimeSpentInMediumH264Ms:[1027,d],videoEncTimeSpentInNegative10Vp8Ms:[1019,d],videoEncTimeSpentInNegative12Vp8Ms:[1018,d],videoEncTimeSpentInNegative4Vp8Ms:[1022,d],videoEncTimeSpentInNegative6Vp8Ms:[1021,d],videoEncTimeSpentInNegative8Vp8Ms:[1020,d],videoEncTimeSpentInSuperfastH264Ms:[1023,d],videoEncTimeSpentInVeryfastH264Ms:[1024,d],videoEncTimeUndershoot10PercH264:[375,d],videoEncTimeUndershoot10PercH265:[378,d],videoEncTimeUndershoot10PercVp8:[381,d],videoEncTimeUndershoot10PercVp9:[384,d],videoEncTimeUndershoot20PercH264:[376,d],videoEncTimeUndershoot20PercH265:[379,d],videoEncTimeUndershoot20PercVp8:[382,d],videoEncTimeUndershoot20PercVp9:[385,d],videoEncTimeUndershoot40PercH264:[377,d],videoEncTimeUndershoot40PercH265:[380,d],videoEncTimeUndershoot40PercVp8:[383,d],videoEncTimeUndershoot40PercVp9:[386,d],videoFecRecovered:[183,o],videoH264Time:[334,o],videoH265Time:[335,o],videoHeight:[189,o],videoInitRxBitrate16s:[904,l],videoInitRxBitrate2s:[901,l],videoInitRxBitrate4s:[902,l],videoInitRxBitrate8s:[903,l],videoInitialCodecScheme:[402,o],videoInitialCodecType:[321,o],videoLastCodecType:[404,o],videoLastSenderBwe:[185,l],videoMaxCombPsnr:[392,l],videoMaxEncodingPsnr:[411,l],videoMaxRxBitrate:[426,l],videoMaxScalingPsnr:[409,l],videoMaxTargetBitrate:[420,l],videoMaxTargetBitrateHq:[829,l],videoMaxTxBitrate:[425,l],videoMaxTxBitrateHq:[824,l],videoMinCombPsnr:[391,l],videoMinEncodingPsnr:[407,l],videoMinScalingPsnr:[406,l],videoMinTargetBitrate:[421,l],videoMinTargetBitrateHq:[830,l],videoNackSendDelay:[872,d],videoNewPktsBeforeNack:[871,o],videoNpsiGenFailed:[594,o],videoNpsiNoNack:[595,o],videoNumAvSyncDiscardFrames:[1010,o],videoNumH264Frames:[332,o],videoNumH265Frames:[333,o],videoPeerState:[275,q],videoPeerTriggeredPauseCount:[654,o],videoRenderAvgFps:[208,o],videoRenderConverterTs:[225,d],videoRenderDelayT:[196,d],videoRenderDupFrames:[888,o],videoRenderFreeze2xT:[304,d],videoRenderFreeze4xT:[305,d],videoRenderFreeze8xT:[306,d],videoRenderFreezeT:[235,d],videoRenderInitFreeze16sT:[908,d],videoRenderInitFreeze2sT:[905,d],videoRenderInitFreeze4sT:[906,d],videoRenderInitFreeze8sT:[907,d],videoRenderInitFreezeT:[526,d],videoRenderNumFreezes:[569,o],videoRenderNumSinceLastFreeze10s:[571,o],videoRenderNumSinceLastFreeze30s:[572,o],videoRenderNumSinceLastFreeze5s:[570,o],videoRenderPauseT:[1132,d],videoRenderSumTimeSinceLastFreeze:[568,d],videoRtcpAppRxFailed:[493,o],videoRtcpAppTxFailed:[492,o],videoRxBitrate:[169,l],videoRxBweHitTxBwe:[187,s],videoRxBytesRtcpApp:[489,l],videoRxFecBitrate:[219,l],videoRxFecFrames:[182,o],videoRxKfBeforeLtrpAfterRpsi:[485,o],videoRxLtrpFramesVp8:[460,o],videoRxNumCodecSwitch:[721,o],videoRxPackets:[201,o],videoRxPktErrorPct:[171,l],videoRxPktLossPct:[170,l],videoRxPktRtcpApp:[487,o],videoRxRtcpFir:[621,o],videoRxRtcpNack:[203,o],videoRxRtcpNpsi:[521,o],videoRxRtcpPli:[202,o],videoRxRtcpRpsi:[459,o],videoRxTotalBytes:[168,l],videoSelfState:[274,q],videoSenderBweDiffStddev:[954,l],videoSenderBweStddev:[348,l],videoTargetBitrateReaches1000kbpsT:[351,d],videoTargetBitrateReaches1500kbpsT:[435,d],videoTargetBitrateReaches2000kbpsT:[436,d],videoTargetBitrateReaches200kbpsT:[349,d],videoTargetBitrateReaches250kbpsT:[433,d],videoTargetBitrateReaches500kbpsT:[350,d],videoTargetBitrateReaches750kbpsT:[434,d],videoTotalBytesOnNonDefCell:[451,l],videoTxBitrate:[165,l],videoTxBitrateHq:[823,l],videoTxBytesRtcpApp:[488,l],videoTxFecBitrate:[218,l],videoTxFecFrames:[181,o],videoTxNumCodecSwitch:[720,o],videoTxPackets:[197,o],videoTxPacketsHq:[818,o],videoTxPktErrorPct:[167,l],videoTxPktErrorPctHq:[821,l],videoTxPktLossPct:[166,l],videoTxPktLossPctHq:[822,l],videoTxPktRtcpApp:[486,o],videoTxResendPackets:[198,o],videoTxResendPacketsHq:[819,o],videoTxRtcpFirEmptyJb:[620,o],videoTxRtcpNack:[200,o],videoTxRtcpNpsi:[520,o],videoTxRtcpPli:[199,o],videoTxRtcpPliHq:[820,o],videoTxRtcpRpsi:[458,o],videoTxTotalBytes:[164,l],videoTxTotalBytesHq:[817,l],videoUpdateEncoderFailureCount:[453,o],videoUpgradeCancelByTimeoutCount:[325,o],videoUpgradeCancelCount:[323,o],videoUpgradeCount:[272,o],videoUpgradeRejectByTimeoutCount:[326,o],videoUpgradeRejectCount:[324,o],videoUpgradeRequestCount:[271,o],videoWidth:[188,o],voipParamsCompressedSize:[1136,o],voipParamsUncompressedSize:[1137,o],vpxLibUsed:[513,Nr],waLongFreezeCount:[891,o],waReconnectFreezeCount:[890,o],waShortFreezeCount:[889,o],waVoipHistoryGetVideoTxBitrateResult:[845,o],waVoipHistoryGetVideoTxBitrateSuccess:[740,s],waVoipHistoryIpAddressNotAvailable:[834,s],waVoipHistoryIsCallRecordLoaded:[737,s],waVoipHistoryIsCallRecordSaved:[738,s],waVoipHistoryIsInitialized:[769,s],waVoipHistoryNumOfCallRecordFound:[771,o],waVoipHistoryNumOfCallRecordLoaded:[739,o],waVoipHistorySaveCallRecordConditionCheckStatus:[770,Lr],warpHeaderRxTotalBytes:[656,l],warpHeaderTxTotalBytes:[655,l],warpMiRxPktErrorCount:[1118,o],warpMiTxPktErrorCount:[1117,o],warpRxPktErrorCount:[746,o],warpTxPktErrorCount:[745,o],wavFileWriteMaxLatency:[1089,d],weakCellularNetConditionDetected:[429,o],weakWifiNetConditionDetected:[430,o],weakWifiSwitchToDefNetSuccess:[397,o],weakWifiSwitchToDefNetSuccessByPeriodicalCheck:[395,o],weakWifiSwitchToDefNetTriggered:[396,o],weakWifiSwitchToDefNetTriggeredByPeriodicalCheck:[394,o],weakWifiSwitchToNonDefNetFalsePositive:[399,o],weakWifiSwitchToNonDefNetSuccess:[400,o],weakWifiSwitchToNonDefNetTriggered:[398,o],wifiRssiAtCallStart:[263,o],wpNotifyCallFailed:[64,o],wpSoftwareEcMatches:[65,s],xmppStatus:[3,ln],xorCipher:[269,cn],zedFileWriteMaxLatency:[1088,d]},[1,1,1],"regular"],CatalogBiz:[1722,{cartToggle:[13,s],catalogAppealReason:[4,c],catalogBizAction:[1,Z],catalogEntryPoint:[7,ee],catalogSessionId:[3,c],collectionCount:[18,o],collectionId:[14,c],collectionIndex:[15,c],deepLinkOpenFrom:[8,Ce],errorCode:[5,o],isOrderMsgAttached:[10,s],orderId:[9,c],productCount:[6,o],productId:[2,c],productIds:[12,c],productIndex:[16,c],quantity:[11,o]},[1,1,1],"regular"],CatalogView:[1630,{bizPlatform:[16,O],cartToggle:[15,s],catalogEntryPoint:[7,ee],catalogEventSampled:[8,s],catalogOwnerJid:[6,c],catalogReportReasonCode:[4,c],catalogSessionId:[2,c],catalogViewAction:[1,te],collectionId:[17,c],collectionIndex:[18,c],deepLinkOpenFrom:[9,Ce],isNewProductAddedToCart:[13,s],isOrderMsgAttached:[10,s],orderId:[11,c],productId:[5,c],productIndex:[19,c],quantity:[12,o]},[1,1,1],"regular"],ChatComposerAction:[2948,{chatComposerActionTarget:[2,re],chatComposerActionType:[1,ne]},[1,1,1],"private",113760892],ChatFilterEvent:[1616,{actionType:[1,ie],filterType:[2,se],searchResultType:[4,ce],sessionId:[3,o],targetScreen:[5,ae]},[1,1,1],"regular"],ChatFolderOpen:[2808,{activityIndicatorCount:[2,o],folderType:[1,c],hasImportantMessages:[3,s]},[1,1,1],"regular"],ChatMessageCounts:[1644,{awayMsgsSent:[56,o],bizCatalogType:[60,M],bizConversationDepth:[65,o],blockReason:[33,w],broadcastMsgsReceived:[30,o],broadcastMsgsSent:[29,o],callOffersReceived:[27,o],callOffersSent:[26,o],callsResultBusy:[70,o],callsResultCancelled:[71,o],callsResultConnected:[72,o],callsResultError:[78,o],callsResultMissed:[73,o],callsResultRejected:[74,o],chatEphemeralityDuration:[15,o],chatMuted:[8,le],chatTypeInd:[2,de],collectionInquiriesSent:[44,o],commerceMsgsReceived:[41,o],commerceMsgsSent:[40,o],disappearingChatInitiator:[59,Oe],entryPointConversionApp:[47,c],entryPointConversionSource:[46,c],ephemeralMessagesReceived:[14,o],ephemeralMessagesSent:[13,o],ephemeralMessagesUnreadExpired:[69,o],fbCtaInquiriesSent:[45,o],firstResponseTime:[25,o],gaStatus:[22,je],greetingMsgsSent:[57,o],groupContainsBiz:[75,s],groupMembershipReplies:[51,o],groupPrivateReplies:[52,o],groupSize:[19,o],isAContact:[6,s],isAGroup:[5,s],isArchived:[10,s],isBlocked:[32,s],isCartAddClicked:[36,s],isCommerceViewed:[35,s],isCtaOnPdpClicked:[37,s],isLabelled:[54,s],isOppositePartyInitiated:[62,s],isPinned:[9,s],labelledMsgs:[55,o],messagesReceived:[4,o],messagesSent:[3,o],messagesStarred:[12,o],messagesUnread:[11,o],newThread:[68,s],ordersSent:[38,o],paymentsSent:[39,o],pdpInquiriesSent:[42,o],pdpViews:[61,o],profileReplies:[64,o],profileViews:[63,o],quickRepliesSent:[58,o],receiverDefaultDisappearingDuration:[21,o],senderDefaultDisappearingDuration:[20,o],spamReports:[31,o],startTime:[7,o],statusReplies:[50,o],statusViews:[49,o],storefrontInquiriesSent:[43,o],threadDs:[66,c],threadId:[67,c],totalCallDuration:[28,o],videoCallsOffered:[76,o],viewOnceMessagesOpened:[18,o],viewOnceMessagesReceived:[17,o],viewOnceMessagesSent:[16,o],voiceCallsOffered:[77,o]},[1,1,1],"regular"],ClockSkewDifferenceT:[3178,{clockSkewHourly:[1,o]},[1,1e3,1e4],"private",37887164],CommercePerf:[2420,{commercePerfEntryPoint:[4,me],commercePerfMarker:[3,ge],commercePerfView:[5,ye],instanceKey:[1,o],timespentT:[2,d]},[1,1,1],"private",113760892],CommerceView:[2438,{businessOwnerJid:[4,c],commerceAction:[1,fe],commerceActionSequenceNumber:[5,o],commerceEntryPoint:[2,_e],commerceEventSampled:[8,s],commerceReportReasonCode:[6,c],commerceSessionId:[3,c],deepLinkOpenFrom:[9,Ce],productId:[7,c]},[1,1,1],"private",113760892],CompanionGetDevicesList:[3010,{getDevicesListApiCount:[2,o],getDevicesListApiDeviceType:[3,c],getDevicesListApiEnumerationType:[4,c],getDevicesListApiT:[1,d]},[1,1,1],"regular"],ContactDiscoveryTimeToEngagement:[3190,{elapsedTime:[1,o]},[1,1,1],"private",0],ContactSend:[2234,{channel:[1,ve],isMultiVcard:[2,s],messageSendResult:[3,yt],messageSendT:[4,d],vcardDataSize:[5,o]},[1,1,1],"regular"],ContactUsSession:[470,{contactUsAutomaticEmail:[3,s],contactUsExitState:[1,Te],contactUsFaq:[2,s],contactUsLogs:[4,s],contactUsMenuFaqT:[12,d],contactUsOutage:[5,s],contactUsOutageEmail:[6,s],contactUsProblemDescription:[7,c],contactUsScreenshotC:[19,l],contactUsT:[11,d],languageCode:[21,c]},[1,1,1],"regular"],CtwaBusinessPreview:[3078,{catalogPresent:[4,s],ctwaBusinessPreviewAction:[1,D],eventTimestampMs:[2,o],openingHoursPresent:[5,s],profileLoadTimeMs:[3,o]},[1,1,1],"private",113760892],CtwaWelcomeMessage:[3022,{ctwaWelcomeMessageAction:[1,sn],ctwaWelcomeMessageContainsIcebreakers:[3,s],ctwaWelcomeMessageError:[4,on],ctwaWelcomeMessageIcebreakersContainAutoreply:[5,s],firstWelcomeMessageImpressionTime:[2,o]},[1,1,1],"private",113760892],Daily:[1158,{accessibilityVoiceover:[108,s],addressbookSize:[11,o],addressbookWhatsappSize:[12,o],androidAdvertisingId:[135,c],androidKeystoreState:[139,g],appCodeHash:[103,c],autoDlAudioCellular:[90,s],autoDlAudioRoaming:[91,s],autoDlAudioWifi:[89,s],autoDlDocCellular:[96,s],autoDlDocRoaming:[97,s],autoDlDocWifi:[95,s],autoDlImageCellular:[87,s],autoDlImageRoaming:[88,s],autoDlImageWifi:[86,s],autoDlVideoCellular:[93,s],autoDlVideoRoaming:[94,s],autoDlVideoWifi:[92,s],backupNetworkSetting:[10,A],backupRestoreEncryptionVersion:[138,o],backupSchedule:[9,C],chatDatabaseSize:[19,o],defaultDisappearingDuration:[140,o],entSecurityNotificationsEnabled:[134,s],favoritedAnimatedStickerCount:[113,o],favoritedFirstPartyStickerCount:[112,o],favoritedTotalStickerCount:[111,o],installedAnimatedStickerPackCount:[116,o],installedAnimatedThirdPartyStickerPackCount:[137,o],installedFirstPartyStickerPackCount:[115,o],installedTotalStickerPackCount:[114,o],ipCountry:[123,c],ipStr:[122,c],languageCode:[5,c],locationCode:[6,c],mdPairTime:[124,o],mediaFolderFileCount:[21,o],mediaFolderSize:[20,o],networkIsRoaming:[7,s],osBuildNumber:[4,c],osNotificationSetting:[118,At],packageName:[102,c],paymentsIsEnabled:[100,s],permissionContacts:[104,s],privacySettingsAbout:[141,xt],privacySettingsAboutExceptNum:[142,Ft],privacySettingsGroups:[143,xt],privacySettingsGroupsExceptNum:[144,Ft],privacySettingsLastSeen:[145,xt],privacySettingsLastSeenExceptNum:[146,Ft],privacySettingsProfilePhoto:[147,xt],privacySettingsProfilePhotoExceptNum:[148,Ft],privacySettingsStatus:[150,xt],privacySettingsStatusExceptNum:[151,Ft],privacySettingsStatusShareNum:[152,Ft],receiptsEnabled:[8,s],simMcc:[2,o],simMnc:[3,o],storageAvailSize:[31,o],storageTotalSize:[32,o],videoFolderFileCount:[23,o],videoFolderSize:[22,o]},[1,1,1],"regular"],DeepLinkClick:[1156,{deepLinkHasPhoneNumber:[2,s],deepLinkHasText:[1,s],deepLinkSessionId:[3,c]},[1,1,1],"regular"],DeepLinkMsgSent:[3198,{deepLinkAction:[1,Ae],deepLinkSessionId:[2,c]},[1,1,1],"regular"],DeepLinkOpen:[2136,{deepLinkOpenFrom:[2,Ce],deepLinkSessionId:[6,c],deepLinkType:[3,be],isContact:[4,s],linkOwnerType:[5,It]},[1,1,1],"regular"],DisappearingModeSettingChange:[3056,{disappearingModeEntryPoint:[4,Ie],lastToggleTimestamp:[3,o],newEphemeralityDuration:[2,o],previousEphemeralityDuration:[1,o]},[1,1,1],"regular"],E2eMessageRecv:[478,{e2eCiphertextType:[5,Ne],e2eCiphertextVersion:[6,o],e2eDestination:[4,Le],e2eFailureReason:[2,ke],e2eSenderType:[8,Ge],e2eSuccessful:[1,s],messageMediaType:[7,ft],offline:[9,s],retryCount:[3,o]},[1,1,20],"regular"],E2eMessageSend:[476,{e2eCiphertextType:[5,Ne],e2eCiphertextVersion:[6,o],e2eDestination:[4,Le],e2eFailureReason:[2,ke],e2eReceiverType:[8,Me],e2eSuccessful:[1,s],encRetryCount:[9,o],messageMediaType:[7,ft],retryCount:[3,o]},[1,1,1],"regular"],E2eRetryAfterDelivery:[894,{deviceType:[4,Me],messageType:[1,Et],msgRetryCount:[3,o],retryRevoke:[2,s]},[1,1,1],"regular"],EditBusinessProfile:[1466,{businessProfileEntryPoint:[10,N],editBusinessProfileSessionId:[2,c],editProfileAction:[1,Ue],editProfileActionField:[9,L],hasAddress:[5,s],hasCategory:[4,s],hasDescription:[3,s],hasEmail:[7,s],hasHours:[6,s],hasWebsite:[8,s]},[1,1,1],"regular"],EphemeralMessageTime:[2742,{zombieStateDuration:[1,o]},[1,1,1],"regular"],EphemeralPurgeCount:[2744,{messageCount:[1,o]},[1,1,1],"regular"],EphemeralSettingChange:[2370,{chatEphemeralityDuration:[1,o],ephemeralSettingEntryPoint:[3,xe],ephemeralSettingGroupSize:[5,kt],previousEphemeralityDuration:[2,o]},[1,1,1],"regular"],ForwardSend:[1728,{disappearingChatInitiator:[21,Oe],e2eCiphertextType:[12,Ne],e2eCiphertextVersion:[11,o],ephemeralityDuration:[18,o],fastForwardEnabled:[5,s],isFrequentlyForwarded:[14,s],mediaCaptionPresent:[10,s],messageForwardAgeT:[4,d],messageIsFanout:[6,s],messageIsFastForward:[3,s],messageIsInternational:[9,s],messageMediaType:[2,ft],messageSendT:[13,d],messageType:[1,Et],receiverDefaultDisappearingDuration:[20,o],resendCount:[8,o],retryCount:[7,o],senderDefaultDisappearingDuration:[19,o],wouldBeFrequentlyForwardedAt3:[16,s],wouldBeFrequentlyForwardedAt4:[17,s]},[1,1,1],"regular"],GatedChatOpened:[3150,{chatGatedReason:[1,oe],selfInitiated:[2,s]},[1,1,1],"regular"],GatedMessageReceived:[3152,{chatGatedReason:[1,oe]},[1,1,1],"regular"],GifFromProviderSent:[1124,{gifSearchProvider:[1,We]},[1,1,1],"regular"],GifSearchCancelled:[1126,{gifSearchProvider:[1,We]},[1,1,1],"regular"],GifSearchNoResults:[1128,{gifSearchProvider:[1,We],inputLanguageCode:[3,c],languageCode:[2,c]},[1,1,1],"regular"],GifSearchResultTapped:[1122,{gifSearchProvider:[1,We],rank:[2,o]},[1,1,1],"regular"],GifSearchSessionStarted:[1134,{gifSearchProvider:[1,We]},[1,1,1],"regular"],GraphqlCatalogRequest:[3206,{graphqlCatalogEndpoint:[1,He],graphqlErrorCode:[3,o],graphqlRequestResult:[2,Ve]},[1,1,1],"private",0],GroupCatchUp:[3058,{mentionsCountPendingPercentage:[4,o]},[1,1,1],"regular"],GroupCreateC:[156,{},[1,1,1],"regular"],GroupJoinC:[158,{},[1,1,1],"regular"],HfmTextSearchComplete:[2186,{},[1,1,1],"regular"],LabelEvent:[1422,{itemsLabeledCount:[5,o],labelCount:[4,o],labelOperation:[2,Je],labelTarget:[1,Qe],predefinedLabelNumber:[3,o]},[1,1,1],"regular"],LdpExampleEvent1:[2866,{rapporValue1:[1,o],rapporValue2:[2,o]},[1,1,1],"private",113760892],Login:[460,{androidKeystoreState:[10,g],connectionOrigin:[6,Ee],connectionT:[5,d],loginResult:[1,Xe],loginT:[3,d],longConnect:[4,s],passive:[8,s],retryCount:[2,o],sequenceStep:[7,o],serverErrorCode:[9,o]},[1,1,1],"regular"],MdAppStateDirtyBits:[2520,{dirtyBitsFalsePositive:[2,s]},[1,20,1e3],"regular"],MdAppStateKeyRotation:[2518,{mdAppStateKeyRotationReason:[1,Ze]},[1,20,1e3],"regular"],MdAppStateMessageRange:[2522,{additionalMessagesCount:[1,o]},[1,20,1e3],"regular"],MdAppStateOfflineNotifications:[2602,{redundantCount:[1,o]},[1,20,1e3],"regular"],MdAppStateSyncDaily:[2300,{crossIndexConflictCount:[11,o],invalidActionCount:[4,o],keyRotationRemoveCount:[12,o],missingKeyCount:[9,o],mutationCount:[1,o],storedMutationCount:[7,o],unsetActionCount:[8,o],unsupportedActionCount:[5,o],uploadConflictCount:[10,o]},[1,1,1],"regular"],MdAppStateSyncMutationStats:[3180,{applied:[1,vt],failed:[2,vt],invalid:[3,vt],orphan:[4,vt],syncdAction:[5,c],unsupported:[6,vt]},[1,1,100],"private",0],MdBadDeviceSentMessage:[2176,{dsmError:[2,De],peerType:[1,Me]},[1,1,1],"regular"],MdBootstrapAppStateCriticalDataProcessing:[3164,{bootstrapAppStateDataStage:[1,R],mdBootstrapPayloadType:[2,tt],mdRegAttemptId:[3,c],mdSessionId:[4,c],mdTimestamp:[5,o]},[1,1,1],"regular"],MdBootstrapAppStateDataDownloaded:[2294,{mdBootstrapContactsCount:[5,o],mdBootstrapHistoryPayloadType:[11,et],mdBootstrapPayloadSize:[4,o],mdBootstrapPayloadType:[2,tt],mdBootstrapStepDuration:[6,o],mdBootstrapStepResult:[7,nt],mdRegAttemptId:[10,c],mdSessionId:[1,c],mdStorageQuotaBytes:[8,o],mdStorageQuotaUsedBytes:[9,o],mdTimestamp:[3,o]},[1,1,1],"regular"],MdBootstrapDataApplied:[2298,{collection:[5,he],historySyncStageProgress:[11,o],mdBootstrapContactsCount:[8,o],mdBootstrapHistoryPayloadType:[10,et],mdBootstrapPayloadType:[3,tt],mdBootstrapSource:[2,rt],mdBootstrapStepDuration:[6,o],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestamp:[4,o],usedSnapshot:[7,s]},[1,1,1],"regular"],MdBootstrapHistoryDataDownloaded:[2296,{historySyncStageProgress:[14,o],mdBootstrapChatsCount:[6,o],mdBootstrapHistoryPayloadType:[13,et],mdBootstrapMessagesCount:[5,o],mdBootstrapPayloadSize:[4,o],mdBootstrapPayloadType:[2,tt],mdBootstrapStepDuration:[7,o],mdBootstrapStepResult:[8,nt],mdHsOldestMessageTimestamp:[11,o],mdRegAttemptId:[12,c],mdSessionId:[1,c],mdStorageQuotaBytes:[9,o],mdStorageQuotaUsedBytes:[10,o],mdTimestamp:[3,o]},[1,1,1],"regular"],MdBootstrapHistoryDataReceived:[2998,{historySyncStageProgress:[5,o],mdBootstrapHistoryPayloadType:[3,et],mdBootstrapPayloadType:[2,tt],mdSessionId:[1,c],mdTimestamp:[4,o]},[1,1,1],"regular"],MdCriticalEvent:[2746,{mdCriticalEventCode:[1,ot]},[1,1,1],"regular"],MdDeviceSyncAck:[2180,{chatType:[1,gt],revoke:[2,s]},[1,1,1],"regular"],MdFatalError:[2304,{collection:[2,he],isBootstrap:[3,s],mdFatalErrorCode:[1,lt]},[1,1,1],"regular"],MdLinkDeviceCompanion:[2576,{mdDurationS:[8,o],mdLinkDeviceCompanionErrorCode:[6,o],mdLinkDeviceCompanionStage:[4,at],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestampS:[7,o],mdWasUpgraded:[5,s]},[1,1,1],"regular"],MdPushnameValidation:[2302,{didWebUserChangeSyncd:[3,s],isSyncdPushnameEmpty:[2,s],matches:[1,s],validationCaller:[4,ct],validationStage:[5,st],webPlatform:[6,dt]},[1,1,1e3],"regular"],MdRetryFromUnknownDevice:[2178,{offline:[2,s],senderType:[1,Me]},[1,1,1],"regular"],MdSyncdDogfoodingFeatureUsage:[3016,{mdSyncdDogfoodingFeature:[1,it]},[1,1,1],"regular"],MediaDownload2:[1590,{connectionType:[31,Se],debugMediaException:[24,c],debugMediaIp:[22,c],debugUrl:[23,c],downloadBytesTransferred:[20,l],downloadConnectT:[15,d],downloadHttpCode:[18,o],downloadIsReuse:[17,s],downloadIsStreaming:[19,s],downloadNetworkT:[16,d],downloadQuality:[37,Re],downloadResumePoint:[14,o],downloadTimeToFirstByteT:[21,d],estimatedBandwidth:[36,l],isViewOnce:[41,s],mediaId:[38,o],networkStack:[30,Tt],overallAttemptCount:[4,o],overallBackendStore:[39,T],overallConnBlockFetchT:[10,d],overallConnectionClass:[29,c],overallCumT:[27,d],overallDecryptT:[12,d],overallDomain:[5,c],overallDownloadMode:[11,ut],overallDownloadOrigin:[35,we],overallDownloadResult:[25,pt],overallFileValidationT:[13,d],overallIsEncrypted:[28,s],overallIsFinal:[26,s],overallMediaSize:[7,l],overallMediaType:[1,ft],overallMmsVersion:[6,o],overallQueueT:[9,d],overallRetryCount:[3,o],overallT:[8,d],usedFallbackHint:[40,c]},[1,1,1],"regular"],MediaPicker:[1038,{chatRecipients:[16,o],isViewOnce:[22,s],mediaPickerChanged:[4,o],mediaPickerCroppedRotated:[10,o],mediaPickerDeleted:[3,o],mediaPickerDrawing:[11,o],mediaPickerFilter:[18,o],mediaPickerLikeDoc:[19,o],mediaPickerNotLikeDoc:[20,o],mediaPickerOrigin:[14,ht],mediaPickerOriginThirdParty:[21,s],mediaPickerSent:[2,o],mediaPickerSentUnchanged:[5,o],mediaPickerStickers:[12,o],mediaPickerT:[15,d],mediaPickerText:[13,o],mediaType:[1,ft],statusRecipients:[17,o]},[1,1,1],"regular"],MediaUpload2:[1588,{connectionType:[43,Se],debugMediaException:[34,c],debugMediaIp:[32,c],debugUrl:[33,c],estimatedBandwidth:[45,l],finalizeConnectT:[28,d],finalizeHttpCode:[31,o],finalizeIsReuse:[30,s],finalizeNetworkT:[29,d],isViewOnce:[49,s],mediaId:[46,o],networkStack:[42,Tt],overallAttemptCount:[4,o],overallConnBlockFetchT:[10,d],overallConnectionClass:[41,c],overallCumT:[37,d],overallCumUserVisibleT:[38,d],overallDomain:[5,c],overallEncryptT:[50,d],overallIsFinal:[36,s],overallIsForward:[16,s],overallIsManual:[13,s],overallLastUploadRetryPhase:[11,Mt],overallMediaKeyReuse:[40,Ot],overallMediaSize:[7,l],overallMediaType:[1,ft],overallMmsVersion:[6,o],overallOptimisticFlag:[12,bt],overallQueueT:[9,d],overallRetryCount:[3,o],overallT:[8,d],overallTranscodeT:[15,d],overallUploadMode:[39,_t],overallUploadOrigin:[44,br],overallUploadResult:[35,mt],overallUserVisibleT:[14,d],resumeConnectT:[17,d],resumeHttpCode:[20,o],resumeIsReuse:[19,s],resumeNetworkT:[18,d],uploadBytesTransferred:[27,l],uploadConnectT:[22,d],uploadHttpCode:[25,o],uploadIsReuse:[24,s],uploadIsStreaming:[26,s],uploadNetworkT:[23,d],uploadResumePoint:[21,o],uploadSource:[48,Pr],usedFallbackHint:[47,c]},[1,1,1],"regular"],MemoryStat:[1336,{hasVerifiedNumber:[7,s],numMessages:[8,l],privateBytes:[3,l],processType:[5,c],sharedBytes:[4,l],uptime:[6,l],workingSetPeakSize:[2,l],workingSetSize:[1,l]},[1,1,1],"regular"],MessageReceive:[450,{deviceSizeBucket:[10,ur],disappearingChatInitiator:[14,Oe],ephemeralityDuration:[13,o],isViewOnce:[9,s],messageIsInternational:[4,s],messageIsOffline:[5,s],messageMediaType:[2,ft],messageQueueTime:[15,d],messageReceiveT0:[6,d],messageReceiveT1:[7,d],messageType:[1,Et],mutedGroupMessage:[8,s],numOfWebUrlsInTextMessage:[3,o],receiverDefaultDisappearingDuration:[12,o],senderDefaultDisappearingDuration:[11,o]},[1,1,1],"regular"],MessageSend:[854,{deviceSizeBucket:[25,ur],disappearingChatInitiator:[30,Oe],e2eBackfill:[23,s],e2eCiphertextType:[10,Ne],e2eCiphertextVersion:[9,o],ephemeralityDuration:[21,o],fastForwardEnabled:[15,s],isFromWamsys:[19,s],isViewOnce:[22,s],mediaCaptionPresent:[8,s],messageForwardAgeT:[14,d],messageIsFanout:[5,s],messageIsFastForward:[13,s],messageIsFirstUserMessage:[26,s],messageIsForward:[4,s],messageIsInternational:[7,s],messageIsInvisible:[29,s],messageIsRevoke:[24,s],messageMediaType:[3,ft],messageSendOptUploadEnabled:[12,s],messageSendResult:[1,yt],messageSendResultIsTerminal:[17,s],messageSendT:[11,d],messageType:[2,Et],receiverDefaultDisappearingDuration:[28,o],resendCount:[16,o],retryCount:[6,o],senderDefaultDisappearingDuration:[27,o],stickerIsFirstParty:[18,s],thumbSize:[20,l]},[1,1,1],"regular"],MessageTemplateBlocks:[3002,{blockEntryPoint:[3,I],blockReason:[2,w],didUserReply:[4,s],templateId:[1,c]},[1,1,1],"private",113760892],OfflineResume:[3112,{chatThreadCount:[1,o],isOfflineCompleteMissed:[2,s],isResumeInForeground:[13,s],lastStanzaT:[3,d],mailboxAge:[14,o],mainScreenLoadT:[4,d],offlineDecryptErrorCount:[5,o],offlineMessageCount:[6,o],offlineNotificationCount:[7,o],offlinePreviewT:[8,d],offlineReceiptCount:[9,o],offlineSizeBytes:[10,o],onTrickleMode:[15,s],pageLoadT:[11,d],socketConnectT:[12,d]},[1,1,1],"regular"],OtpCopyCodeClick:[3080,{businessPhoneNumber:[1,o],otpEntryPoint:[4,Pt],templateId:[3,c]},[1,1,1],"private",0],PaymentsDaily:[2950,{invitedUserCnt:[2,o],invitedUserRegisteredCnt:[3,o],inviterUserCnt:[5,o],invitesReceivedToUserCnt:[4,o],invitesSentToUserCnt:[1,o],startTs:[14,o],totalTransactionReceivedCnt:[10,o],totalTransactionSentCnt:[6,o],transactionReceivedWithBackgroundAndStickerCnt:[13,o],transactionReceivedWithBackgroundCnt:[12,o],transactionReceivedWithStickerCnt:[11,o],transactionSentWithBackgroundAndStickerCnt:[9,o],transactionSentWithBackgroundCnt:[8,o],transactionSentWithStickerCnt:[7,o]},[1,1,1],"private",113760892],PlaceholderActivity:[1980,{deviceSizeBucket:[8,ur],messageIsRevoke:[7,s],messageMediaType:[6,ft],messageType:[5,Et],placeholderActionInd:[2,Rt],placeholderChatTypeInd:[3,Dt],placeholderTimePeriod:[4,o],placeholderTypeInd:[1,Nt]},[1,1,1],"regular"],PrekeysDepletion:[3014,{deviceSizeBucket:[3,ur],messageType:[2,Et],prekeysFetchReason:[1,Gt]},[1,1,1],"regular"],PsBufferUpload:[2244,{applicationState:[6,E],psBufferUploadHttpResponseCode:[3,o],psBufferUploadResult:[1,Yt],psBufferUploadT:[2,d],psDitheredT:[11,o],psForceUpload:[10,s],psTokenNotReadyReason:[4,Ht],psUploadReason:[9,Vt],waConnectedToChatd:[5,s]},[1,1,1],"regular"],PsIdCreate:[2310,{},[1,1,1],"regular"],PsIdUpdate:[2862,{psIdAction:[2,jt],psIdKey:[1,o],psIdRotationFrequence:[3,o]},[1,1,1],"regular"],PsP2bThreadsV1:[2994,{chatEphemeralityDuration:[11,o],chatMuted:[6,le],chatTypeInd:[18,de],ephemeralMessagesReceived:[13,o],ephemeralMessagesSent:[12,o],groupSize:[3,o],isAContact:[1,s],isAGroup:[2,s],isArchived:[5,s],isPinned:[4,s],messagesReceived:[8,o],messagesSent:[7,o],messagesStarred:[9,o],messagesUnread:[10,o],startTime:[17,o],viewOnceMessagesOpened:[14,o],viewOnceMessagesReceived:[16,o],viewOnceMessagesSent:[15,o]},[1,1,1],"private",113760892],PsStructuredMessageInteraction:[3052,{bizPlatform:[1,O],businessOwnerJid:[7,c],messageClass:[3,Er],messageClassAttributes:[5,c],messageInteraction:[4,qe],messageMediaType:[2,ft]},[1,1,1],"private",0],Ptt:[458,{pttDraftPlayCnt:[7,o],pttDraftSeekCnt:[8,o],pttDuration:[5,d],pttLock:[4,s],pttPauseCnt:[9,o],pttResult:[1,Jt],pttSize:[3,l],pttSource:[2,Qt],pttStop:[6,s],pttStopTapCnt:[10,o]},[1,1,1],"regular"],PttDaily:[2938,{pttCancelBroadcast:[9,o],pttCancelGroup:[8,o],pttCancelIndividual:[7,o],pttDraftReviewBroadcast:[15,o],pttDraftReviewGroup:[14,o],pttDraftReviewIndividual:[13,o],pttFastplaybackBroadcast:[21,o],pttFastplaybackGroup:[20,o],pttFastplaybackIndividual:[19,o],pttLockBroadcast:[12,o],pttLockGroup:[11,o],pttLockIndividual:[10,o],pttOutOfChatBroadcast:[29,o],pttOutOfChatGroup:[30,o],pttOutOfChatIndividual:[31,o],pttPausedRecordBroadcast:[22,o],pttPausedRecordGroup:[23,o],pttPausedRecordIndividual:[24,o],pttPlaybackBroadcast:[18,o],pttPlaybackGroup:[17,o],pttPlaybackIndividual:[16,o],pttRecordBroadcast:[3,o],pttRecordGroup:[2,o],pttRecordIndividual:[1,o],pttSendBroadcast:[6,o],pttSendGroup:[5,o],pttSendIndividual:[4,o],pttStopTapBroadcast:[25,o],pttStopTapGroup:[26,o],pttStopTapIndividual:[27,o]},[1,1,1],"regular"],PttLockC:[2984,{},[1,1,1],"regular"],PttPlayback:[2044,{pttDuration:[12,d],pttMainThreadBlock:[7,s],pttMiniPlayerClick:[15,o],pttMiniPlayerClose:[16,s],pttMiniPlayerPauseCnt:[17,o],pttPlayRequestT:[1,d],pttPlaybackFailed:[8,s],pttPlaybackOverallT:[4,d],pttPlaybackSpeed:[10,zt],pttPlaybackSpeedCnt:[11,o],pttPlayedOutOfChat:[18,s],pttPlayedPct:[14,l],pttPlayer:[9,qt],pttPlayerInitT:[2,d],pttPlayerPlayT:[3,d],pttSeekCnt:[13,o],pttTrigger:[5,Zt],pttType:[6,Xt]},[1,1,1],"regular"],QuickReply:[1468,{attachmentGifCount:[7,o],attachmentImageCount:[5,o],attachmentVideoCount:[6,o],isSmartDefault:[10,s],quickReplyAction:[1,tr],quickReplyCount:[2,o],quickReplyEntryPoint:[11,rr],quickReplyKeywordCount:[3,o],quickReplyKeywordMatched:[4,s],quickReplyOrigin:[9,nr],quickReplyTranscodeResult:[8,ir]},[1,1,1],"regular"],ReactionActions:[3184,{messageType:[1,Et],reactionAction:[2,sr]},[1,10,20],"regular"],RoomsCreationFlow:[2202,{entryResult:[3,Pe],errorReason:[2,Be],roomsEntryPoint:[1,or]},[1,1,1],"regular"],SendRevokeMessage:[1348,{messageMediaType:[2,ft],messageType:[1,Et],revokeSendDelay:[3,o]},[1,1,1],"regular"],SenderKeyExpired:[3130,{chatType:[1,gt],deviceSizeBucket:[2,ur],expiryReason:[3,Ke]},[1,1,1],"regular"],SignCredential:[2242,{applicationState:[6,E],overallT:[4,d],projectCode:[7,Kt],retryCount:[2,o],signCredentialResult:[1,cr],signCredentialT:[3,d],waConnectedToChatd:[5,s]},[1,1,1],"regular"],StatusItemView:[1658,{isPosterBiz:[23,s],isPosterInAddressBook:[25,s],mediaType:[4,ft],psaCampaignId:[17,c],psaCampaignItemIndex:[18,o],psaLinkAvailable:[19,s],psaLinkClick:[22,s],psaLinkLoadTime:[21,d],psaLinkOpenResult:[20,$t],statusItemImpressionCount:[14,o],statusItemIndex:[16,o],statusItemLength:[7,d],statusItemLoadTime:[5,d],statusItemReplied:[8,o],statusItemUnread:[9,s],statusItemViewCount:[10,o],statusItemViewResult:[3,hr],statusItemViewTime:[6,d],statusRowIndex:[2,o],statusRowSection:[11,mr],statusViewerSessionId:[1,o]},[1,1,1],"regular"],StatusReply:[1180,{isPosterBiz:[4,s],isPosterInAddressBook:[6,s],statusReplyMessageType:[3,fr],statusReplyResult:[2,_r],statusSessionId:[1,o]},[1,1,1],"regular"],StatusTabOpen:[1172,{psaCampaigns:[5,c],statusAvailableUpdatesCount:[2,o],statusRankT:[3,d],statusSessionId:[1,o],statusTabOpenT:[4,d]},[1,1,1],"regular"],StickerCommonQueryToStaticServer:[2740,{httpResponseCode:[2,o],params:[3,c],queryType:[1,er]},[1,1,1],"regular"],StickerDailyAggregatedEvent:[2884,{stickerAddToFavoriteCount:[11,o],stickerMakerCreates:[16,o],stickerMakerSends:[17,o],stickerPackDeleteCount:[12,o],stickerPickerOpenedCount:[13,o],stickerSearchOpenedCount:[14,o],stickerSendCount:[1,o],stickerSendCountForward:[6,o],stickerSendCountIsAnimated:[9,o],stickerSendCountIsFirstParty:[8,o],stickerSendCountIsWeb:[10,o],stickerSendCountStickerPickerTabEmotion:[5,o],stickerSendCountStickerPickerTabFavorites:[3,o],stickerSendCountStickerPickerTabPack:[15,o],stickerSendCountStickerPickerTabRecents:[2,o],stickerSendCountStickerSearch:[7,o]},[1,1,1],"regular"],StickerSend:[1840,{stickerIsAnimated:[3,s],stickerIsFirstParty:[2,s],stickerIsFromStickerMaker:[5,s],stickerSendMessageType:[4,gr],stickerSendOrigin:[1,yr]},[1,1,1],"regular"],TemplateTruncation:[1946,{buttonIndex:[3,o],originalLength:[2,o],templateComponent:[1,vr]},[1,1,1],"regular"],TestAnonymousDaily:[2328,{},[1,1,1],"private",113760892],TestAnonymousDailyId:[2958,{psTestEnumField:[1,Wt],psTestFloatField:[2,l]},[1,1,1],"private",248614979],TestAnonymousIdLess:[3004,{psTimeSinceLastEventInMin:[1,o]},[1,1,1],"private",0],TestAnonymousMonthlyId:[2960,{},[1,1,1],"private",191000728],TestAnonymousWeeklyId:[2956,{psTestBooleanField:[2,s],psTestStringField:[3,c],psTimeSinceLastEventInMin:[1,o]},[1,1,1],"private",42196056],UiAction:[472,{sizeBucket:[4,ur],uiActionPreloaded:[2,s],uiActionT:[3,d],uiActionType:[1,Cr]},[1,1,1],"regular"],UserActivity:[1384,{userActivityBitmapHigh:[4,o],userActivityBitmapLen:[5,o],userActivityBitmapLow:[3,o],userActivitySessionCum:[7,o],userActivitySessionId:[1,c],userActivitySessionSeq:[6,o],userActivityStartTime:[2,o]},[1,1,1],"regular"],UserActivitySessionSummary:[1502,{ipStr:[7,c],userActivityDuration:[2,o],userActivityForeground:[5,o],userActivitySessionsLength:[3,o],userActivityStartTime:[1,o],userActivityTimeChange:[4,o],userSessionSummarySequence:[6,o]},[1,1,1],"regular"],UserNotice:[2472,{userNoticeContentVersion:[2,o],userNoticeEvent:[3,wr],userNoticeId:[1,o]},[1,1,1],"regular"],UserNoticeError:[2474,{userNoticeContentVersion:[2,o],userNoticeErrorEvent:[3,Ir],userNoticeId:[1,o]},[1,1,1],"regular"],ViewBusinessProfile:[1522,{bizFbSize:[9,Tr],bizIgSize:[10,Tr],businessProfileJid:[3,c],catalogSessionId:[6,c],isProfileLinked:[11,s],isSelfView:[7,s],linkedAccount:[5,x],profileEntryPoint:[8,Bt],scrollDepth:[4,o],viewBusinessProfileAction:[1,Rr],websiteSource:[2,an]},[1,1,1],"regular"],VnameCertHealthEvent:[1890,{vnameCertHealthEventType:[2,Dr]},[1,1,1],"regular"],WaShopsManagement:[2908,{isShopsProductPreviewVisible:[2,s],shopsManagementAction:[1,lr],shopsSellerJid:[3,c]},[1,1,1],"regular"],WamTestAnonymous0:[2240,{testAnonymousChatdConnectivity:[2,s],wamTestAnonymous0Field0:[1,c]},[1,1,1],"private",113760892],WebcAbpropsValidation:[2802,{abpropName:[1,c],abpropValue:[2,c],serverPropName:[3,c],serverPropValue:[4,c]},[1,1,1],"regular"],WebcAssetLoad:[1358,{webcAssetCacheType:[4,Gr],webcAssetFromCache:[2,s],webcAssetLoadT:[3,d],webcAssetName:[1,c],webcAssetSize:[5,l]},[1,1,1],"regular"],WebcChatOpen:[864,{webcChatOpenBeforePaintT:[7,d],webcChatOpenPaintedT:[6,d],webcChatOpenT:[2,d],webcFinalRenderedMessageCount:[5,o],webcRenderedMessageCount:[4,o],webcUnreadCount:[1,l],webcWindowHeightFloat:[8,l]},[1,1,1],"regular"],WebcCpu:[3e3,{cpuSessionSeconds:[2,o],ftsIndexInProgess:[3,s],logInterval:[4,o],percentCpuUsage:[1,o]},[1,1,1],"regular"],WebcDbOpen:[1940,{webcDbName:[1,c],webcDbOpenNumAttempts:[3,o],webcDbOpenWasSuccess:[2,s]},[1,1,1],"regular"],WebcEmojiOpen:[1166,{webcEmojiOpenTab:[1,c]},[1,1,1],"regular"],WebcFingerprint:[1704,{webcCanvasFingerprint:[25,c],webcDocumentDriverEvaluate:[9,s],webcDocumentDriverUnwrapped:[7,s],webcDocumentElementAttrDriver:[14,s],webcDocumentElementAttrSelenium:[12,s],webcDocumentElementAttrWebdriver:[13,s],webcDocumentFxdriverEvaluate:[6,s],webcDocumentFxdriverUnwrapped:[11,s],webcDocumentSeleniumEvaluate:[2,s],webcDocumentSeleniumUnwrapped:[10,s],webcDocumentWebdriverEvaluate:[1,s],webcDocumentWebdriverScriptFn:[5,s],webcDocumentWebdriverScriptFunc:[4,s],webcDocumentWebdriverScriptFunction:[3,s],webcDocumentWebdriverUnwrapped:[8,s],webcWebglFingerprint:[24,c],webcWebglRenderer:[23,c],webcWebglVendor:[22,c],webcWindowSeleniumIdeRecorder:[20,s],webcWindowCallphantom:[18,s],webcWindowCallselenium:[19,s],webcWindowNavigatorWebdriver:[21,nn],webcWindowNightmare:[16,s],webcWindowPhantom:[15,s],webcWindowSelenium:[17,s]},[1,1,1],"regular"],WebcImgError:[1700,{webcImgErrorCode:[1,l]},[1,1,1],"regular"],WebcJobInfo:[3054,{jobName:[1,c],jobPriority:[2,c],jobResultType:[5,xr],pendingJobsCount:[4,o],scenario:[3,qr],webcJobAddedT:[6,d],webcJobCompletedT:[8,d],webcJobStartedT:[7,d]},[1,1,1],"regular"],WebcLogin:[1664,{webcBrowserNetworkType:[14,c],webcBrowserStorageQuotaBytes:[15,o],webcBrowserStorageQuotaUsedBytes:[16,o],webcLoginT:[3,d],webcPersistentLoginEnabled:[17,s],webcQrCodes:[1,o],webcQrLoadT:[2,d],webcSyncChatCount:[8,o],webcSyncChatSize:[10,o],webcSyncChatT:[9,d],webcSyncContactCount:[11,o],webcSyncContactSize:[13,o],webcSyncContactT:[12,d],webcSyncMessageCount:[5,o],webcSyncMessageSize:[7,o],webcSyncMessageT:[6,d],webcSyncT:[4,d]},[1,1,1],"regular"],WebcMediaAnalyzed:[912,{webcMediaAnalyzeT:[3,d],webcMediaExtensions:[2,c],webcMediaSupported:[1,s]},[1,1,1],"regular"],WebcMediaEditorSend:[2890,{editedImageCount:[2,o],emojiLayerCount:[5,o],imageCount:[1,o],paintedImageCount:[3,o],stickerLayerCount:[6,o],textLayerCount:[4,o]},[1,1,1],"regular"],WebcMediaErrorUnknownDetails:[2352,{mediaId:[1,o],webcMediaErrorName:[3,c],webcMediaOperation:[2,Kr]},[1,1,1],"regular"],WebcMediaLoad:[1202,{webcMediaLoadResult:[2,Br],webcMediaLoadT:[1,d]},[1,1,1],"regular"],WebcMediaRmr:[1906,{messageMediaType:[10,ft],webcBrowserNetworkType:[2,c],webcBrowserStorageQuotaBytes:[11,o],webcBrowserStorageQuotaUsedBytes:[12,o],webcChatPosition:[1,o],webcChatType:[9,Ur],webcMediaRmrError:[8,s],webcMediaRmrT:[6,d],webcMediaSize:[7,o],webcMessageIndex:[3,o],webcMessageT:[5,d],webcRmrReason:[14,zr],webcRmrStatusCode:[13,o]},[1,1,1],"regular"],WebcMemoryStat:[1188,{hasVerifiedNumber:[12,s],jsHeapSizeLimit:[9,o],numMessages:[8,l],totalJsHeapSize:[10,o],uptime:[6,l],usedJsHeapSize:[11,o]},[1,1,1],"regular"],WebcMenu:[2504,{webcMenuAction:[2,jr],webcMenuItemLabel:[3,Yr]},[1,1,1],"regular"],WebcMessageQuery:[1876,{webcAudioMessageCount:[14,o],webcBrowserNetworkType:[1,c],webcBrowserStorageQuotaBytes:[20,o],webcBrowserStorageQuotaUsedBytes:[21,o],webcChatPosition:[2,o],webcChatType:[13,Ur],webcDocumentMessageCount:[16,o],webcEarliestMessageIndex:[11,o],webcEarliestMessageT:[12,d],webcMessageCount:[4,o],webcMessageQueryTrigger:[19,$r],webcMessageQueryType:[3,Wr],webcOtherMessageCount:[18,o],webcPhotoMessageCount:[7,o],webcPttMessageCount:[15,o],webcQueryT:[9,d],webcResponseBytes:[10,o],webcStickerMessageCount:[17,o],webcTextMessageCount:[5,o],webcVideoMessageCount:[6,o]},[1,1,1],"regular"],WebcMessageSend:[2072,{messageIsForward:[3,s],messageMediaType:[2,ft],messageSendT:[4,d],messageType:[1,Et]},[1,1,1],"regular"],WebcOfflineResume:[2628,{chatThreadCount:[9,o],decryptErrorCount:[4,o],isOfflineCompleteMissed:[11,s],offlineMessageCount:[2,o],offlineNotificationCount:[12,o],offlineReceiptCount:[3,o],offlineSizeBytes:[8,o],webcLastStanzaT:[10,d],webcMainScreenLoadT:[7,d],webcOfflinePreviewT:[6,d],webcPageLoadT:[1,d],webcSocketConnectT:[5,d]},[1,1,1],"regular"],WebcPageLoad:[642,{webcAppcacheStatus:[29,kr],webcCached:[30,s],webcConnectEnd:[10,d],webcConnectStart:[9,d],webcDomComplete:[19,d],webcDomContentLoadedEventEnd:[18,d],webcDomContentLoadedEventStart:[17,d],webcDomInteractive:[16,d],webcDomLoading:[15,d],webcDomainLookupEnd:[8,d],webcDomainLookupStart:[7,d],webcExeDone:[23,d],webcExeStart:[22,d],webcFetchStart:[6,d],webcInitialMountT:[38,d],webcInitialNavMountT:[39,d],webcInitialPanel:[42,c],webcInitialPanelMountStartT:[43,d],webcInitialPanelMountT:[40,d],webcInitialPanelRenderT:[46,d],webcJsLoadT:[37,d],webcLoadEventEnd:[21,d],webcLoadEventStart:[20,d],webcLoadInForeground:[53,s],webcMainScriptEnd:[45,d],webcMainScriptStart:[44,d],webcNativeLoadT:[36,d],webcNavigation:[32,Hr],webcPageLoadT:[34,d],webcParallellyFetched:[41,s],webcQrCode:[31,s],webcRedirectCount:[33,l],webcRedirectEnd:[5,d],webcRedirectStart:[4,d],webcRequestStart:[12,d],webcResponseEnd:[14,d],webcResponseStart:[13,d],webcSecureConnectionStart:[11,d],webcUnloadEventEnd:[3,d],webcUnloadEventStart:[2,d],webcWsAttempts:[28,l],webcWsNormal:[27,d],webcWsOpening:[24,d],webcWsPairing:[25,d],webcWsSyncing:[26,d]},[1,1,1],"regular"],WebcPageResume:[884,{webcResumeCount:[1,o]},[1,1,1],"regular"],WebcPhoneDisconnected:[878,{webcPhoneBbarShownT:[2,d],webcPhoneDisconnectedT:[1,d]},[1,1,1],"regular"],WebcProgressiveImage:[2226,{webcFirstRenderScans:[1,o],webcFirstRenderT:[2,d],webcFullQualityT:[4,d],webcMidQualityT:[3,d]},[1,1,10],"regular"],WebcQplHealth:[3134,{webcQplHealthEventData:[1,c],webcQplHealthEventType:[2,Vr]},[1,1,1],"regular"],WebcRawPlatforms:[2416,{webcRawPlatform:[1,c]},[1,1,1],"regular"],WebcResourceLoad:[688,{webcResourceCached:[3,s],webcResourceDuration:[2,d],webcResourceName:[1,c]},[1,1,1],"regular"],WebcStatusSession:[1880,{webcStatusMutedItemCount:[4,o],webcStatusMutedRowCount:[7,o],webcStatusRecentItemCount:[2,o],webcStatusRecentRowCount:[5,o],webcStatusSessionId:[1,o],webcStatusViewedItemCount:[3,o],webcStatusViewedRowCount:[6,o]},[1,1,1],"regular"],WebcStatusSync:[1878,{webcStatusMutedItemCount:[4,o],webcStatusMutedRowCount:[7,o],webcStatusRecentItemCount:[2,o],webcStatusRecentRowCount:[5,o],webcStatusSyncT:[1,d],webcStatusViewedItemCount:[3,o],webcStatusViewedRowCount:[6,o]},[1,1,1],"regular"],WebcStatusView:[1882,{webcIsPosterBiz:[11,s],webcIsPostersAddressBook:[12,s],webcStatusLoadT:[6,d],webcStatusLoaded:[4,s],webcStatusMediaType:[5,Jr],webcStatusPlaybackT:[8,d],webcStatusReplyCount:[9,o],webcStatusRowIndex:[3,o],webcStatusRowSection:[2,Qr],webcStatusSessionId:[1,o],webcStatusUnread:[10,s],webcStatusViewT:[7,d]},[1,1,1],"regular"],WebcStickerMakerEvents:[3104,{stickerMakerEventName:[1,Xr]},[1,1,1],"regular"],WebcStorageStat:[1504,{webcStorageQuota:[2,o],webcStorageUsage:[1,o]},[1,1,1],"regular"],WebcStreamModeChange:[770,{webcStreamMode:[1,Zr]},[1,1,1],"regular"],WebcUiFreeze:[1836,{webcUiFreezeFps:[1,l],webcUiFreezeT:[2,d]},[1,1,1],"regular"],WebcWapRequest:[2006,{webcWapRequestAckT:[3,d],webcWapRequestDestination:[6,en],webcWapRequestKind:[5,tn],webcWapRequestName:[8,c],webcWapRequestRecvT:[4,d],webcWapRequestResponseSize:[2,o],webcWapRequestSize:[7,o],webcWapRequestStatus:[9,o]},[1,1,10],"regular"]});var un=(0,i.default)((0,i.default)({},a.events),{METRICS:a.metrics,Global:dn,WamEvent:a.WamEvent,PrivateStatsAllIds:[{key:"DefaultPsId",keyHashInt:113760892,rotationPeriodDays:-1},{key:"IdTtl90Days",keyHashInt:37887164,rotationPeriodDays:90},{key:"IdTtlDaily",keyHashInt:248614979,rotationPeriodDays:1},{key:"IdTtlMonthly",keyHashInt:191000728,rotationPeriodDays:30},{key:"IdTtlWeekly",keyHashInt:42196056,rotationPeriodDays:7}],ADV_DECODE_ERROR_TYPE:u,ADV_DECODE_PROTO_TYPE:p,AEC_MODE:h,AGC_MODE:f,ANDROID_CAMERA2_SUPPORT_LEVEL:_,ANDROID_CAMERA_API:m,ANDROID_KEYSTORE_STATE_TYPE:g,APP_BUILD_TYPE:y,APPLICATION_STATE:E,AUDIO_ENGINE_TYPE:S,AUTO_REPLY_ACTION:v,BACKEND_STORE_TYPE:T,BACKUP_NETWORK_SETTING:A,BACKUP_SCHEDULE:C,BANNER_OPERATIONS:b,BANNER_TYPES:P,BIZ_CATALOG_TYPE:M,BIZ_PLATFORM:O,BLOCK_ENTRY_POINT:I,BLOCK_REASON:w,BOOTSTRAP_APP_STATE_DATA_STAGE_CODE:R,BUSINESS_PREVIEW_ACTION_TYPE:D,BUSINESS_PROFILE_ENTRY_POINT:N,BUSINESS_PROFILE_FIELD:L,BUSINESS_PROFILE_VIEW_ACTION:k,BUSINESS_PROFILE_WEBSITE_SOURCE_TYPE:G,BUSINESS_TOOLS_ENTRY_POINT_TYPE:U,BUSINESS_TOOLS_ITEM_TYPE:F,BUSINESS_TOOLS_LINKED_ACCOUNT_TYPE:x,CALL_FROM_UI:B,CALL_NETWORK_MEDIUM:K,CALL_RELAY_BIND_STATUS:Y,CALL_RESULT_TYPE:j,CALL_SEGMENT_TYPE:W,CALL_SETUP_ERROR_TYPE:H,CALL_SIDE:V,CALL_TERM_REASON:$,CALL_TRANSPORT_TYPE:z,CALL_VIDEO_STATE:q,CALL_WAKEUP_SOURCE:J,CAMERA_PREVIEW_MODE:Q,CAMERA_START_MODE_PARAMS:X,CATALOG_BIZ_ACTION:Z,CATALOG_ENTRY_POINT:ee,CATALOG_VIEW_ACTION:te,CHAT_COMPOSER_ACTION_TARGETS:re,CHAT_COMPOSER_ACTION_TYPES:ne,CHAT_FILTER_ACTION_TYPES:ie,CHAT_FILTER_TARGET_SCREEN:ae,CHAT_FILTER_TYPES:se,CHAT_GATED_REASON:oe,CHAT_MUTED_TYPE:le,CHAT_SEARCH_RESULT_TYPE:ce,CHAT_TYPE:de,CLIENT_GROUP_SIZE_BUCKET:ue,CLIENT_MESSAGE_SEND_STAGE:pe,COLLECTION:he,COMMERCE_ACTION:fe,COMMERCE_ENTRY_POINT:_e,COMMERCE_PERF_ENTRY_POINT:me,COMMERCE_PERF_MARKER:ge,COMMERCE_PERF_VIEW:ye,CONNECTION_ORIGIN_TYPE:Ee,CONNECTION_TYPE:Se,CONTACT_SEND_CHANNEL:ve,CONTACT_US_EXIT_STATE:Te,DEEP_LINK_ACTION:Ae,DEEP_LINK_OPEN_FROM:Ce,DEEP_LINK_TYPE:be,DESTINATION:Pe,DEVICE_TYPE:Me,DISAPPEARING_CHAT_INITIATOR_TYPE:Oe,DISAPPEARING_MODE_ENTRY_POINT_TYPE:Ie,DOWNLOAD_ORIGIN_TYPE:we,DOWNLOAD_QUALITY_TYPE:Re,DSM_ERROR:De,E2E_CIPHERTEXT_TYPE:Ne,E2E_DESTINATION:Le,E2E_FAILURE_REASON:ke,E2E_SENDER_TYPE:Ge,EDIT_PROFILE_ACTION:Ue,END_CALL_CONFIRMATION_TYPE:Fe,EPHEMERAL_SETTING_ENTRY_POINT_TYPE:xe,ERROR_REASON:Be,EXPIRY_REASON:Ke,FIELD_STATS_ROW_TYPE:Ye,GA_STATUS:je,GIF_SEARCH_PROVIDER:We,GRAPHQL_CATALOG_ENDPOINT:He,GRAPHQL_REQUEST_RESULT:Ve,INCOMING_CALL_UI_ACTION_TYPE:$e,INIT_BWE_SOURCE:ze,INTERACTION_TYPE:qe,LABEL_OPERATIONS:Je,LABEL_TARGETS:Qe,LOGIN_RESULT_TYPE:Xe,MD_APP_STATE_KEY_ROTATION_REASON_CODE:Ze,MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE:et,MD_BOOTSTRAP_PAYLOAD_TYPE:tt,MD_BOOTSTRAP_SOURCE:rt,MD_BOOTSTRAP_STEP_RESULT:nt,MD_FEATURE_CODE:it,MD_LINK_DEVICE_COMPANION_STAGE:at,MD_PUSHNAME_VALIDATION_STAGE_CODE:st,MD_SYNCD_CRITICAL_EVENT_CODE:ot,MD_SYNCD_FATAL_ERROR_CODE:lt,MD_VALIDATION_CALLER_CHANNEL:ct,MD_VALIDATION_WEB_PLATFORM:dt,MEDIA_DOWNLOAD_MODE_TYPE:ut,MEDIA_DOWNLOAD_RESULT_TYPE:pt,MEDIA_PICKER_ORIGIN_TYPE:ht,MEDIA_TYPE:ft,MEDIA_UPLOAD_MODE_TYPE:_t,MEDIA_UPLOAD_RESULT_TYPE:mt,MESSAGE_CHAT_TYPE:gt,MESSAGE_SEND_RESULT_TYPE:yt,MESSAGE_TYPE:Et,MISSING_PROTO_TYPE:St,MUTATION_COUNT_BUCKET:vt,NETWORK_STACK_TYPE:Tt,NOTIFICATION_SETTING_TYPE:At,NS_MODE:Ct,OPTIMISTIC_FLAG_TYPE:bt,OTP_ENTRY_POINT:Pt,OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE:Mt,OVERALL_MEDIA_KEY_REUSE_TYPE:Ot,OWNER_TYPE:It,PEER_CALL_NETWORK_MEDIUM:wt,PLACEHOLDER_ACTION:Rt,PLACEHOLDER_CHAT_TYPE:Dt,PLACEHOLDER_TYPE:Nt,PLATFORM_TYPE:Lt,PRECISE_SIZE_BUCKET:kt,PREKEYS_FETCH_CONTEXT:Gt,PRIMARY_IDENTITY_MISSING_PROTO_TYPE:Ut,PRIVACY_SETTINGS_CONTACTS_BUCKETS:Ft,PRIVACY_SETTINGS_VALUE_TYPE:xt,PROFILE_ENTRY_POINT:Bt,PROJECT_CODE:Kt,PS_BUFFER_UPLOAD_RESULT:Yt,PS_ID_ACTION:jt,PS_TEST_ENUM_FIELD:Wt,PS_TOKEN_NOT_READY_REASON:Ht,PS_UPLOAD_REASON:Vt,PSA_LINK_OPEN_RESULT:$t,PTT_PLAYBACK_SPEED_TYPE:zt,PTT_PLAYER_TYPE:qt,PTT_RESULT_TYPE:Jt,PTT_SOURCE_TYPE:Qt,PTT_STREAM_TYPE:Xt,PTT_TRIGGER_TYPE:Zt,QUERY_TYPE:er,QUICK_REPLY_ACTION:tr,QUICK_REPLY_ENTRY_POINT:rr,QUICK_REPLY_ORIGIN:nr,QUICK_REPLY_TRANSCODE_RESULT:ir,RADIO_TYPE:ar,REACTION_ACTION_TYPE:sr,ROOMS_ENTRY_POINT:or,SHOPS_MANAGEMENT_ACTION:lr,SIGN_CREDENTIAL_RESULT:cr,SIGNATURE_TYPE:dr,SIZE_BUCKET:ur,SRTP_LIBRARY_VERSION:pr,STATUS_ITEM_VIEW_RESULT:hr,STATUS_REPLY_MESSAGE_TYPE:fr,STATUS_REPLY_RESULT:_r,STATUS_ROW_SECTION:mr,STICKER_SEND_MESSAGE_TYPE:gr,STICKER_SEND_ORIGIN_TYPE:yr,STRUCTURED_MESSAGE_CLASS:Er,SW_AEC_TYPE:Sr,TEMPLATE_COMPONENT:vr,TRUST_SIGNAL_BUCKETS:Tr,TS_LOG_UPLOAD_RESULT:Ar,UI_ACTION_TYPE:Cr,UPLOAD_ORIGIN_TYPE:br,UPLOAD_SOURCE_TYPE:Pr,UPNP_ADD_RESULT_CODE:Mr,UPNP_REMOVE_RESULT_CODE:Or,USER_NOTICE_ERROR_EVENT:Ir,USER_NOTICE_EVENT:wr,VIEW_BUSINESS_PROFILE_ACTION:Rr,VNAME_CERT_HEALTH_EVENT_TYPE:Dr,VPX_LIB:Nr,WA_VOIP_HISTORY_SAVE_CALL_RECORD_CONDITION_CHECK_STATUS:Lr,WEBC_APPCACHE_STATUS_CODE:kr,WEBC_ASSET_CACHE_TYPE_CODE:Gr,WEBC_CHAT_TYPE:Ur,WEBC_ENV_CODE:Fr,WEBC_JOB_RESULT_TYPE_CODE:xr,WEBC_MEDIA_LOAD_RESULT_CODE:Br,WEBC_MEDIA_OPERATION_CODE:Kr,WEBC_MENU_ITEM_LABEL:Yr,WEBC_MENU_TYPE:jr,WEBC_MESSAGE_QUERY_DIRECTION:Wr,WEBC_NAVIGATION_TYPE:Hr,WEBC_QPL_HEALTH_EVENT_TYPE:Vr,WEBC_QUERY_TRIGGER_TYPE:$r,WEBC_RMR_REASON_CODE:zr,WEBC_SCENARIO_TYPE:qr,WEBC_STATUS_MEDIA_TYPE:Jr,WEBC_STATUS_ROW_SECTION:Qr,WEBC_STICKER_MAKER_EVENT_NAME_TYPE:Xr,WEBC_STREAM_MODE_CODE:Zr,WEBC_WAP_REQUEST_DESTINATION_CODE:en,WEBC_WAP_REQUEST_KIND_CODE:tn,WEBC_WEB_PLATFORM_TYPE:rn,WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE:nn,WEBSITE_SOURCE_TYPE:an,WELCOME_MESSAGE_ACTION_TYPE:sn,WELCOME_MESSAGE_ERROR_TYPE:on,XMPP_STATUS:ln,XOR_CIPHER_MODE:cn});t.default=un},52211:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WamEvent=t.TYPES=t.Metric=t.GlobalMetric=void 0,t.defineEvents=function(e){for(const r in e){var t;const n=e[r],i=n[2];let a=1;a=i[2];const s=null!==(t=n[3])&&void 0!==t?t:"regular",o=5===n.length?n[4]:-1;y({name:r,id:n[0],props:n[1],weight:a,wamChannel:s,privateStatsIdInt:o})}},t.defineGlobal=function(e){const t={};for(const r in e){const n=e[r],[i,a,s=["regular"]]=n,o=f.defineGlobal(r,i,a,s);t[r]={type:o.validator,set(e){this.commitOnSet&&s.includes("regular")&&c.Wam.set(o,e)}}}return new((0,l.defineTypeHash)("Global",t,E))},t.metrics=t.events=void 0;var i=n(r(22205)),a=n(r(11700)),s=n(r(63137)),o=n(r(45095)),l=(r(6604),r(36737)),c=r(77959);const d=Object.freeze({BOOLEAN:"boolean",INTEGER:"integer",NUMBER:"number",STRING:"string",TIMER:"timer"});function u(e){return"number"==typeof e&&e===Math.floor(e)}t.TYPES=d;class p{constructor(e,t,r){this.name=e,this.id=t,this.type=r,this.setValidator()}setValidator(){const e=this.type;if("object"==typeof e){const t=(0,s.default)(e);this.validator=e=>e in t}else e===d.INTEGER||e===d.TIMER?this.validator=u:this.validator=e}}t.Metric=p;class h extends p{constructor(e,t,r,n){super(e,t,r),this.channels=n}}t.GlobalMetric=h;const f=new class{constructor(){this._events={},this._globalMetrics=new Map}_key(e,t){return`${e}::${t}`}getEvent(e,t){const r=this._key(e,t);return(0,o.default)(this._events[r],r)}define(e,t,r,n){const i=this._key(e,t);return i in this._events||(this._events[i]=new p(t,r,n)),this._events[i]}defineGlobal(e,t,r,n){return this._globalMetrics.has(e)||this._globalMetrics.set(e,new h(e,t,r,n)),(0,o.default)(this._globalMetrics.get(e),e)}getGlobal(e){return(0,o.default)(this._globalMetrics.get(e),e)}};t.metrics=f;let _=1;class m extends l.TypeHash{constructor(){super(),this.instanceId=_++,this.eventTime=Date.now(),this.commitTime=void 0,this.startMarkers={}}commit(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c.Wam.commit(this,e)}setTime(e){this.eventTime=e||Date.now()}setSequenceNumber(e){this.sequenceNumber=e}}t.WamEvent=m;const g={};function y(e){let{name:t,id:r,weight:n,props:s,wamChannel:o,privateStatsIdInt:c}=e;const u={id:r,weight:n,wamChannel:o,privateStatsIdInt:c},p={},h=[];for(const e in s){const r=s[e],n=f.define(t,e,r[0],r[1]);p[e]=n.validator,r[1]===d.TIMER&&h.push(e)}const _=(0,l.defineTypeHash)(t,p,m);h.forEach((e=>{u["mark"+(0,a.default)(e)]=function(t){var r,n;const{startMarkers:i,eventTime:a}=this;this[e]=Date.now()-(null!==(r=null===(n=i[e])||void 0===n?void 0:n.ts)&&void 0!==r?r:a),null==t||t.showInTimeline,this.startMark},u[`start${(0,a.default)(e)}`]=function(t){const r=Date.now();this.startMarkers[e]={ts:r},null==t||t.showInTimeline}})),(0,i.default)(_.prototype,u),g[t]=_}t.events=g;class E extends l.TypeHash{constructor(){super(...arguments),this.commitOnSet=!0}}},55843:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMessageCounts=function(e,t){e.webcMessageCount+=t.length;for(let r=0,n=t[r];r<t.length;++r,n=t[r])switch(n.type){case s.CHAT:case s.LOCATION:case s.PAYMENT:case s.VCARD:case s.CIPHERTEXT:case s.MULTI_VCARD:case s.REVOKED:case s.OVERSIZED:e.webcTextMessageCount+=1;break;case s.IMAGE:case s.PRODUCT:e.webcPhotoMessageCount+=1;break;case s.VIDEO:e.webcVideoMessageCount+=1;break;case s.AUDIO:e.webcAudioMessageCount+=1;break;case s.PTT:e.webcPttMessageCount+=1;break;case s.STICKER:e.webcStickerMessageCount+=1;break;case s.DOCUMENT:e.webcDocumentMessageCount+=1;break;default:e.webcOtherMessageCount+=1}},t.newMessageQueryEvent=function(e){return new a.default.WebcMessageQuery({webcResponseBytes:0,webcMessageCount:0,webcTextMessageCount:0,webcVideoMessageCount:0,webcPhotoMessageCount:0,webcAudioMessageCount:0,webcPttMessageCount:0,webcStickerMessageCount:0,webcDocumentMessageCount:0,webcOtherMessageCount:0,webcMessageQueryTrigger:e})};var i=n(r(69618)),a=n(r(11339));const{MSG_TYPE:s}=i.default},57362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<32?a.SMALL:e<64?a.MEDIUM:e<128?a.LARGE:e<256?a.EXTRA_LARGE:e<512?a.XX_LARGE:e<1e3?a.XXX_LARGE:e<1500?a.LT1500:e<2e3?a.LT2000:e<2500?a.LT2500:e<3e3?a.LT3000:e<3500?a.LT3500:e<4e3?a.LT4000:e<4500?a.LT4500:e<5e3?a.LT5000:a.LARGEST_BUCKET};var i=n(r(11339));const{CLIENT_GROUP_SIZE_BUCKET:a}=i.default},16786:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<32?a.LT32:e<64?a.LT64:e<128?a.LT128:e<256?a.LT256:e<512?a.LT512:e<1e3?a.LT1000:e<1500?a.LT1500:e<2e3?a.LT2000:e<2500?a.LT2500:e<3e3?a.LT3000:e<3500?a.LT3500:e<4e3?a.LT4000:e<4500?a.LT4500:e<5e3?a.LT5000:a.LARGEST_BUCKET};var i=n(r(11339));const{SIZE_BUCKET:a}=i.default},97480:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineResumeReporter=void 0;var i=r(92844),a=n(r(11339));const s=new class{constructor(){this.isInitialSync=!1,this.oldestStanzaTs=0,this.offlineResume=new a.default.OfflineResume,this.offlineResume.offlineMessageCount=0,this.offlineResume.offlineReceiptCount=0,this.offlineResume.offlineNotificationCount=0,this.offlineResume.offlineDecryptErrorCount=0,this.offlineResume.offlineSizeBytes=0,this.offlineResume.chatThreadCount=0,this.offlineResume.isOfflineCompleteMissed=!1}roundUp(e,t){return Math.round(e/t)*t}logOldestStanzaTime(e){null!=this.offlineResume&&(0===this.oldestStanzaTs||this.oldestStanzaTs>e)&&(this.oldestStanzaTs=e)}countDays(){if(null==this.offlineResume||0===this.oldestStanzaTs)return 0;const e=(0,i.unixTime)()-this.oldestStanzaTs;return Math.round(e/i.DAY_SECONDS)}logOfflineCount(e){this.offlineResume&&(this.offlineResume.offlineMessageCount+=e.message,this.offlineResume.offlineReceiptCount+=e.receipt,this.offlineResume.offlineNotificationCount+=e.notification)}logOfflineDecryptionErrorCount(e){this.offlineResume&&(this.offlineResume.offlineDecryptErrorCount=e)}logAddOfflineSizeBytes(e){this.offlineResume&&(this.offlineResume.offlineSizeBytes+=e)}logOfflineChatThreadCount(e){const t=this.roundUp(e,10);this.offlineResume&&(this.offlineResume.chatThreadCount=t)}logLastStanzaT(){this.offlineResume&&this.offlineResume.markLastStanzaT()}logMainScreenLoadT(){this.offlineResume&&this.offlineResume.markMainScreenLoadT()}logOfflinePreviewT(){this.offlineResume&&this.offlineResume.markOfflinePreviewT()}logPageLoadT(){this.offlineResume&&(this.offlineResume.markPageLoadT(),window.document&&this.offlineResume&&(this.offlineResume.isResumeInForeground=!document.hidden,document.addEventListener("visibilitychange",this.logResumeInBackground)))}logSocketConnectT(){this.offlineResume&&this.offlineResume.markSocketConnectT()}logMissedOfflineComplete(){this.offlineResume&&(this.offlineResume.isOfflineCompleteMissed=!0)}setIsInitialSync(){this.isInitialSync=!0}logResumeInBackground(){this.offlineResume&&document.hidden&&(this.offlineResume.isResumeInForeground=!1)}commit(){const e=this.offlineResume;e&&(e.offlineSizeBytes=this.roundUp(e.offlineSizeBytes,1e3),e.offlineMessageCount=this.roundUp(e.offlineMessageCount,10),e.offlineReceiptCount=this.roundUp(e.offlineReceiptCount,10),e.offlineNotificationCount=this.roundUp(e.offlineNotificationCount,10),e.mailboxAge=this.countDays(),__LOG__(2)`======== offline resume perf ========
message: ${e.offlineMessageCount}
receipt: ${e.offlineReceiptCount}
notification: ${e.offlineNotificationCount}
chatThreadCount: ${e.chatThreadCount}
offlineSizeBytes: ${e.offlineSizeBytes}
decryptError: ${e.offlineDecryptErrorCount}
lastStanzaT: ${e.lastStanzaT}
pageLoadT: ${e.pageLoadT}
connectionT: ${e.socketConnectT}
offlinePreviewT: ${e.offlinePreviewT}
screenLoadT: ${e.mainScreenLoadT}
isResumeInForeground: ${e.isResumeInForeground}
mailboxAge: ${e.mailboxAge}
======================================`,this.isInitialSync||e.commit(),this.offlineResume=null,window.document&&document.removeEventListener("visibilitychange",this.logResumeInBackground))}};t.OfflineResumeReporter=s},71119:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mainScriptTimer=t.initialScreenTimer=t.exeTimer=t.PageLoad=void 0,t.onInitialRenderComplete=function(){h()},t.saveInitialPanelMountTime=function(e){d=e},t.setInitialScreen=function(e){if(null==u)return;u.set({webcInitialPanel:e})},t.streamInfoChange=function(e,t,r){const n=Math.floor(window.performance.now());p[e]=n,r&&(p.socketSequence=t,f())};var a=i(r(45095)),s=i(r(11339)),o=n(r(6604)),l=i(r(34179)),c=r(77959);let d,u=new s.default.WebcPageLoad;const p={};let h,f;const _=new Promise((e=>h=e)),m=new Promise((e=>f=e));let g=!1;function y(e){return window.performance&&window.performance.timing&&window.performance.timing.navigationStart?e-window.performance.timing.navigationStart:null}function E(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.navigation)return void __LOG__(2)`MetricReporter:logPageLoad metrics not provided by browser!`;if(!u)return;const t=u,r=window.performance.timing,n=window.performance.navigation,i=r.navigationStart,a=r.loadEventEnd-i;if(a<=0)return __LOG__(2)`MetricReporter:logPageLoad delayed`,void setTimeout(E,1e4);function s(e){const t=r[e];return t&&y(t)}t.set({webcPageLoadT:a,webcUnloadEventStart:s("unloadEventStart"),webcUnloadEventEnd:s("unloadEventEnd"),webcRedirectStart:s("redirectStart"),webcRedirectEnd:s("redirectEnd"),webcFetchStart:s("fetchStart"),webcDomainLookupStart:s("domainLookupStart"),webcDomainLookupEnd:s("domainLookupEnd"),webcConnectStart:s("connectStart"),webcConnectEnd:s("connectEnd"),webcSecureConnectionStart:s("secureConnectionStart"),webcRequestStart:s("requestStart"),webcResponseStart:s("responseStart"),webcResponseEnd:s("responseEnd"),webcDomLoading:s("domLoading"),webcDomInteractive:s("domInteractive"),webcDomContentLoadedEventStart:s("domContentLoadedEventStart"),webcDomContentLoadedEventEnd:s("domContentLoadedEventEnd"),webcDomComplete:s("domComplete"),webcLoadEventStart:s("loadEventStart"),webcLoadEventEnd:s("loadEventEnd"),webcCached:r.fetchStart===r.domainLookupEnd,webcNavigation:n.type,webcRedirectCount:n.redirectCount,webcWsOpening:p.OPENING,webcWsPairing:p.PAIRING,webcWsSyncing:p.SYNCING,webcWsNormal:p.NORMAL,webcWsAttempts:p.socketSequence,webcQrCode:!p.SYNCING,webcInitialPanelMountT:d-i}),t.commit(),u=null}Promise.all([_,m]).then((()=>{E(),(0,l.default)(),g||(g=!0,c.Wam.resumeJobs())}));class S{constructor(e){this._hasStarted=!1,this._label=e.label,this._startProperty=e.startProperty,this._endProperty=e.endProperty}start(){this._hasStarted=!0,null!=u&&(u.set({[this._startProperty]:y(Date.now())}),this._measure=o.startMeasure(this._label))}end(){null!=u&&(u.set({[this._endProperty]:y(Date.now())}),(0,a.default)(this._measure,"this._measure").end())}hasStarted(){return this._hasStarted}}const v=new S({label:"PageLoad.webcExe",startProperty:"webcExeStart",endProperty:"webcExeDone"});t.exeTimer=v;const T=new S({label:"PageLoad.webcMainScript",startProperty:"webcMainScriptStart",endProperty:"webcMainScriptEnd"});t.mainScriptTimer=T;const A=new S({label:"PageLoad.webcInitialPanelRender",startProperty:"webcInitialPanelMountStartT",endProperty:"webcInitialPanelRenderT"});t.initialScreenTimer=A;const C=(0,a.default)(u,"_PageLoad");t.PageLoad=C},16860:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.postPrekeysDepletionMetric=function(e){let{count:t,prekeysFetchReason:n,messageType:a,chatId:s}=e;if(null==t||0===t)return;const o={};null!=n&&(o.prekeysFetchReason=n);null!=a&&(o.messageType=a);if(null!=s&&s.isGroup()){const e=r(63928).default.get(s);null!=(null==e?void 0:e.cachedDeviceSizeBucket)&&(o.deviceSizeBucket=e.cachedDeviceSizeBucket)}setTimeout((()=>{for(let e=0;e<t;e++)new i.default.PrekeysDepletion(o).commit()}),0)};var i=n(r(11339))},29590:(e,t,r)=>{"use strict";var n=r(95318);t.Z=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(87614),o=r(57319),l=r(92844),c=n(r(26372));t.Z=class{constructor(e){this.metric=e,this.psIdKeyBySchemaKeyHashInt={},this.psIdSchemaKeyHashIntById={},this.psIdInfoByKey={},e.PrivateStatsAllIds.map((e=>{this.psIdKeyBySchemaKeyHashInt[e.keyHashInt]=e.key,this.psIdSchemaKeyHashIntById[e.key]=e.keyHashInt,this.psIdInfoByKey[e.key]={value:e.keyHashInt,rotationPeriodDays:e.rotationPeriodDays}})),this.psIdKeyBySchemaKeyHashInt[0]="none",this.psIdSchemaKeyHashIntById.none=0,this.psIdInfoByKey.none={value:"none",rotationPeriodDays:-1},this.resolvesOnInit=this.initialize().then((()=>{this.resolvesOnInit=null})),this.rotatePsIdJob=new o.ShiftTimer((()=>{this.rotatePsIds()})),this.rotatePsIdJob.onOrBefore(l.DAY_MILLISECONDS)}initialize(){var e=this;return(0,a.default)((function*(){const t=[],r=yield c.default.getPsMeta(),n=new Set;r.map((r=>{n.add(r.key),void 0===e.psIdInfoByKey[r.key]?t.push(r.key):e.psIdInfoByKey[r.key].value=r.value}));const i=new Date;i.setUTCHours(0,0,0,0);const a=Object.keys(e.psIdInfoByKey).filter((e=>!n.has(e))).map((t=>("none"!==t&&(e.psIdInfoByKey[t].value=(0,s.randomHex)(16)),{key:t,value:e.psIdInfoByKey[t].value,rotateInDays:e.psIdInfoByKey[t].rotationPeriodDays,lastRotationTimeUtc:i.toString()})));yield c.default.addPsMeta(a),yield c.default.removePsMeta(t),a.map((t=>{new e.metric.PsIdUpdate({psIdAction:e.metric.PS_ID_ACTION.CREATED,psIdKey:e.psIdSchemaKeyHashIntById[t.key],psIdRotationFrequence:t.rotateInDays}).commit()})),t.map((t=>{new e.metric.PsIdUpdate({psIdAction:e.metric.PS_ID_ACTION.DELETED,psIdKey:e.psIdSchemaKeyHashIntById[t],psIdRotationFrequence:e.psIdInfoByKey[t].rotationPeriodDays}).commit()}))}))()}rotatePsIds(){var e=this;return(0,a.default)((function*(){try{const t=yield c.default.getPsMeta(),r=new Date;r.setUTCHours(0,0,0,0);const n=(e,t)=>{if(null==e)return!0;const n=new Date(e);return Math.ceil(Math.abs(r-n)/864e5)>=t};yield Promise.all(t.map(function(){var t=(0,a.default)((function*(t){const{key:a,rotateInDays:o,lastRotationTimeUtc:l}=t;if(-1!==o&&(null==l||n(l,o))){const n=(0,s.randomHex)(16);e.psIdInfoByKey[a].value=n,yield c.default.updatePsMeta((0,i.default)((0,i.default)({},t),{},{value:n,lastRotationTimeUtc:r.toString()})),new e.metric.PsIdUpdate({psIdAction:e.metric.PS_ID_ACTION.ROTATED,psIdKey:e.psIdSchemaKeyHashIntById[a],psIdRotationFrequence:o}).commit()}}));return function(){return t.apply(this,arguments)}}()))}catch(e){__LOG__(3)`error while rotating PS ids ${e}`}finally{e.rotatePsIdJob.onOrBefore(l.DAY_MILLISECONDS)}}))()}getPrivateStatsKeyFromInt(e){return this.psIdKeyBySchemaKeyHashInt[e]}getLatestPrivateStatsIdValueFromKey(e){if("regular"===e)throw new Error("tried to get psId for regular channel event");return this.psIdInfoByKey[e].value}}},14528:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new class{constructor(){this._resetNextSet=!1,this._value=0}get(){return this._value}_checkReset(){this._resetNextSet&&(this._resetNextSet=!1,this._value=0,this.initialDisplayDate=null)}inc(){return this._checkReset(),this.set(this._value+1)}set(e){if(this._checkReset(),this._value!==e)return 1===e&&(this.initialDisplayDate=Math.floor(window.performance.now())),this._value=e,this.get()}reset(){this._resetNextSet=!0}};t.default=r},34179:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.getEntriesByType)return void __LOG__(2)`MetricReporter:logResourceLoads metrics not provided by browser!`;const t=window.performance.timing.fetchStart===window.performance.timing.domainLookupEnd,r=window.performance.getEntriesByType("resource"),n=document.createElement("a");r.forEach((function(e){"xmlhttprequest"!==e.initiatorType&&(n.href=e.name,new i.default.WebcResourceLoad({webcResourceName:n.pathname+n.search+n.hash,webcResourceDuration:Math.round(e.duration),webcResourceCached:t}).commit())}))};var i=n(r(11339))},36737:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeHash=void 0,t.defineTypeHash=function(e,t,i){const a={$className:{value:e}};for(const i in t){let s=t[i];if("string"!=typeof s&&"function"!=typeof s||(s={type:s}),!s||"object"!=typeof s)throw new Error(`${e} specified with non-object ${s}`);a[i]={enumerable:!0,get:r(i),set:n(i,s)}}class s extends i{constructor(e){super(),this.all={},e&&this.set(e)}}return Object.defineProperties(s.prototype,a),s};function r(e){return function(){return this.all[e]}}function n(e,t){const r=t.type,n=t.set;return function(t){if(t!==this.all[e]){if(null==t);else if("function"==typeof r){if(!r(t))throw __LOG__(2)`type-validator fails ${t}`,new TypeError(`${this.$className}.${e} type-validator failed`)}else if(typeof t!==r)throw new TypeError(`${this.$className}.${e} requires type ${r}, got ${t}`);n&&n.call(this,t),this.all[e]=t}}}t.TypeHash=class{set(e){for(const t in e)this[t]=e[t]}}},77959:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=void 0,t.injectWamDependencies=function(e){h=e.Browser,m=e.Conn,f=e.CLB,_=e.CONST,g=e.Metric,S=e.UserPrefs,T=e.WamStorage,y=e.isUserLoggedIn,E=e.uploadStats,v=e.WamContext,O=g.PrivateStatsAllIds.map((e=>e.key)),A=new e.PsIdStore(g),e.CoreWamStorageAdaptor.startWamStore(),C=e.uploadPrivateStats,b=e.setWamBufferSizeUnsafeTestOnly,P=e.setPendingDelayUnsafeTestOnly,(0,u.isConnectedToPage)()&&r(7902);M=new d.ShiftTimer((()=>{!function(){Q.apply(this,arguments)}()}));for(;I.length;){I.pop()()}w=!0};var i=n(r(48926)),a=n(r(66604)),s=n(r(63105)),o=n(r(35161)),l=n(r(45095)),c=r(88156),d=r(57319),u=r(41796),p=r(55021);let h,f,_,m,g,y,E,S,v,T,A,C,b,P,M,O=[];const I=[];let w=!1;const R="1";let D=5e4;const N={};let L=0,k=[],G=!1,U=1e4,F=!1,x=null,B=0,K=new c.Resolvable,Y=!1,j=!1;function W(e,t){e.commitTime=null!=t?t:de(),e.sequenceNumber=B++}function H(){return g.APP_BUILD_TYPE.RELEASE}function V(e){if(x&&!e)return;const t=h.info();x={appVersion:_.VERSION_BASE,appBuild:H(),platform:g.PLATFORM_TYPE.WEBCLIENT,appIsBetaRelease:H()===g.APP_BUILD_TYPE.BETA,browser:t.name||null,browserVersion:t.ua||null,deviceName:t.os||null,deviceVersion:t.version||null,webcPhonePlatform:m.platformField||null,webcEnv:g.WEBC_ENV_CODE[_.WAM_ENV],webcTabId:S.thisTabId,webcWebPlatform:g.WEBC_WEB_PLATFORM_TYPE[_.WAM_PLATFORM]},e&&Object.assign(x,e),g.Global.commitOnSet=!1,g.Global.set(x),g.Global.commitOnSet=!0}function $(){return($=(0,i.default)((function*(){(0,p.resetWamProtocolVersion)(5),yield Promise.all(Object.keys(N).map(function(){var e=(0,i.default)((function*(e){var t;const r=null===(t=N[e])||void 0===t?void 0:t.unsavedPortion;if(r)try{const e=yield T.getNextSequenceNumberForStream(R);r.upgradeWamHeaderFromV3ToV5(e)}catch(e){}}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function z(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return k.push(e),G?t?(Y=!1,j=!0,setTimeout((()=>M.forceRunNow()),1)):M.onOrBefore(U):t&&(M.cancel(),Y=!0,j=!1),K.promise}function q(){G=!1,M.cancel();const e=K;return K=new c.Resolvable,e}function J(){G=!0,j=!1,k.length>0&&M.onOrBefore(U),Y&&(Y=!1,j=!0,M.forceRunNow())}function Q(){return(Q=(0,i.default)((function*(){const e=j,t=q(),r=[...k];k=[];try{V(),yield A.resolvesOnInit||Promise.resolve(),yield Promise.all(["regular","none",...O].map((t=>ne(t,r,e))))}finally{t.resolve(),J()}}))).apply(this,arguments)}function X(e){return"regular"===e?"regular":"private"}function Z(){return ee.apply(this,arguments)}function ee(){return(ee=(0,i.default)((function*(e){return new v(e,yield T.getNextSequenceNumberForStream(R),A,x)}))).apply(this,arguments)}function te(){return re.apply(this,arguments)}function re(){return(re=(0,i.default)((function*(e){var t;const r=null!==(t=N[e])&&void 0!==t?t:yield Z(e);return N[e]=r,r}))).apply(this,arguments)}function ne(){return ie.apply(this,arguments)}function ie(){return(ie=(0,i.default)((function*(e,t,r){const n=X(e);if((0,p.getWamProtocolVersion)()<5&&"private"===n)return;let i;try{i=yield te(e)}catch(e){return void __LOG__(3)`wam:_executePendingForContext failed to get context ${String((null==e?void 0:e.stack)?e.stack:e)}`}try{for(let r=0;r<t.length;r++){const a=t[r],[s,...o]=a;if(s){const t=o[0];("regular"===t.wamChannel&&t.wamChannel===n||"private"===t.wamChannel&&e===A.getPrivateStatsKeyFromInt(t.privateStatsIdInt))&&i.write(t)}else{const[e,t]=o;e.channels.includes(n)&&(x[e.name]=t,i.set(e.id,t))}}const a=de();if(i.eventsWritten>0&&(r||i.size()>D||a>L+300||!F)){if(!y())return void(i.buffer.size()>D?N[e]=null:yield ae(e));yield oe(e)}else yield ae(e)}catch(t){__LOG__(3)`wam:_executePending error ${String((null==t?void 0:t.stack)?t.stack:t)}`,f.upload({reason:"wam-error"}),N[e]=null}}))).apply(this,arguments)}function ae(){return se.apply(this,arguments)}function se(){return(se=(0,i.default)((function*(e){if(!N[e])return;const t=N[e].stringBuffer();if(!t)return;const r=(0,l.default)(N[e],"contexts[bufferKey]").unsavedPortion;if(r&&0===r.eventsWritten)return;const n=(0,l.default)(N[e],"contexts[bufferKey]").saveKey;try{if(r){const r=yield T.update(n,e,t);if(!N[e])return;r?(0,l.default)(N[e],"contexts[bufferKey]").unsavedPortion=yield Z(e):(N[e]=N[e].unsavedPortion,yield ae(e))}else{if(yield T.add(n,e,t),!N[e])return;(0,l.default)(N[e],"contexts[bufferKey]").unsavedPortion=yield Z(e)}}catch(e){__LOG__(3)`wam:save WamStorage failed to save ${String(e)}`}}))).apply(this,arguments)}function oe(){return le.apply(this,arguments)}function le(){return(le=(0,i.default)((function*(e){let t;try{t=yield T.deleteAll(e)}catch(e){t={},__LOG__(3)`wam:sendAllLogs failed to read because ${String(e)}`}const r=t;if(N[e]){N[e].unsavedPortion&&!(N[e].saveKey in r)&&(N[e]=N[e].unsavedPortion);const t=(0,l.default)(N[e],"contexts[bufferKey]").saveKey;r[t]=(0,l.default)(N[e],"contexts[bufferKey]").stringBuffer()}const n=yield Promise.all((0,o.default)(r,((t,r)=>ce(t,r,X(e))))),a=(0,s.default)(n);if(a.length!==n.length&&(L=de(),F=!0),N[e]&&!a.includes(N[e].saveKey)&&(N[e]=null),0===a.length)return;const c=a.reduce((function(e,t){return e+r[t].length}),0);c<D?yield Promise.all((0,o.default)(a,function(){var t=(0,i.default)((function*(t){try{yield T.add(t,e,r[t])}catch(e){__LOG__(3)`sendAllLogs: adding to WamStorage failed`}}));return function(){return t.apply(this,arguments)}}())):(N[e]=null,__LOG__(3)`wam dropped ${a.length} buffers! (${c} bytes)`)}))).apply(this,arguments)}function ce(e,t,r){return""===e||"["===e[0]?Promise.resolve():"private"===r?C(e,t):"regular"===r?E(e,t):Promise.resolve()}function de(){return Math.floor(Date.now()/1e3)}const ue=(0,a.default)({commit:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null!=e.commitTime&&0!==e.commitTime?(__LOG__(3)`wam:commit redundant commit! ${e.$className}`,Promise.resolve()):0!==e.weight&&Math.random()*e.weight>1?(e.commitTime=de(),Promise.resolve()):(W(e),z([!0,e],t))},set:function(e,t){return z([!1,e,t])},resumeJobs:J,initialize:V,upgradeWamRuntime:function(){return $.apply(this,arguments)}},(function(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(w)return e(...r);I.push((()=>{e(...r)}))}}));t.Wam=ue},75838:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStore=function(){(0,l.closeWamStorage)()},t.privateStatsKillSwitchGetBlockedToken=p,t.privateStatsKillSwitchSet=h,t.savePrivateStatsToken=u,t.startWamStore=function(){(0,l.startWamStorage)(f)};var i=n(r(81109)),a=n(r(48926)),s=r(40265),o=r(92844),l=r(11562),c=r(99234),d=n(r(26372));function u(e){return d.default.savePsToken({key:"token",token:e,creationTs:(0,o.unixTime)(),redeemCount:1})}function p(){return Promise.resolve((0,c.getPsKillSwitchToken)())}function h(e){return(0,c.setPsKillSwitchToken)(e),Promise.resolve()}const f={getStreamId:()=>1,saveBuffer:()=>Promise.reject(new s.UnimplementedMethod("saveBuffer not implemented yet")),finishBuffer:()=>Promise.reject(new s.UnimplementedMethod("finishBuffer not implemented yet")),getStartingSequenceRow:()=>Promise.reject(new s.UnimplementedMethod("getStartingSequenceRow not implemented yet")),getBuffers:()=>Promise.reject(new s.UnimplementedMethod("getBuffers not implemented yet")),removeBufferByKey:()=>Promise.resolve(),nukeMetrics:()=>Promise.reject(new s.UnimplementedMethod("nukeMetrics not implemented yet")),updatePrivateStatsIds:()=>Promise.reject(new s.UnimplementedMethod("updatePrivateStatsIds not implemented yet")),redeemPrivateStatsToken:function(){var e=(0,a.default)((function*(e){const t=yield d.default.getPsToken();return t?e({redeemCount:t.redeemCount,creationTs:t.creationTs},{maxExpirySeconds:86400})?d.default.savePsToken((0,i.default)((0,i.default)({},t),{},{redeemCount:t.redeemCount+1})).then((()=>t.token)):Promise.resolve(null):null}));return function(){return e.apply(this,arguments)}}(),savePrivateStatsToken:u,privateStatsKillSwitchGetBlockedToken:p,privateStatsKillSwitchSet:h}},55021:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWamProtocolVersion=function(){return r},t.resetWamProtocolVersion=function(e){r=e};let r=3},26372:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(19197));t.default=class{static add(e,t,r){return(0,i.default)((function*(){return(yield a.default.idb()).wam.add({key:e,buffer:r,channel:t},e).catch((e=>{__LOG__(2)`add failed: ${e}\n${null==e?void 0:e.stack}`}))}))()}static update(e,t,r){return(0,i.default)((function*(){let n=0;try{n=yield a.default.idb().then((n=>n.wam.update(e,{key:e,buffer:r,channel:t})))}catch(e){__LOG__(2)`update failed: ${e}\n${null==e?void 0:e.stack}`}return 0!==n}))()}static deleteAll(e){return(0,i.default)((function*(){const t={};try{yield a.default.idb().then((r=>r.wam.where("channel").equals(e).modify((function(e){t[e.key]=e.buffer,delete this.value}))))}catch(e){__LOG__(2)`deleteAll failed: ${e}\n${null==e?void 0:e.stack}`}return t}))()}static getNextSequenceNumberForStream(e){return(0,i.default)((function*(){let t=-1;try{const r=yield a.default.idb();yield r.transaction("rw",["wam_meta"],(0,i.default)((function*(){0===(yield r.wam_meta.where("streamId").equals(e).count())?(yield r.wam_meta.add({streamId:e,seqNum:1}),t=1):yield r.wam_meta.where("streamId").equals(e).modify((function(e){return t=e.seqNum+1,t>=65536&&(t=1),e.seqNum=t,e}))})))}catch(e){__LOG__(2)`getNextSequenceNumberForStream failed: ${e}\n${null==e?void 0:e.stack}`}if(-1===t)throw new Error(`could not get seq number for streamId ${e}`);return t}))()}static removePsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkDelete(e))).catch((e=>{__LOG__(2)`removePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsMeta(){return a.default.idb().then((e=>e.ps_meta.toArray())).catch((e=>(__LOG__(2)`getPsMeta failed: ${e}\n${null==e?void 0:e.stack}`,[])))}static addPsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkPut(e))).catch((e=>{__LOG__(2)`addPsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static updatePsMeta(e){return a.default.idb().then((t=>t.ps_meta.update(e.key,e))).catch((e=>{__LOG__(2)`updatePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsToken(){return a.default.idb().then((e=>e.ps_tokens.get("token"))).catch((e=>{__LOG__(2)`getPsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}static savePsToken(e){return a.default.idb().then((t=>t.transaction("rw",["ps_tokens"],(()=>t.ps_tokens.put(e))))).catch((e=>{__LOG__(2)`savePsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}}},15772:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.forceFlushAllWamBuffers=function(){return(new i.default.TestAnonymousDaily).commit(!0)};var i=n(r(11339))},15078:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11339));var a=new class{constructor(){this._events=new Map}logSend(e){const t=e.tag;if(t)try{const r=e.getName(),n=r.startsWith("query")?i.default.WEBC_WAP_REQUEST_KIND_CODE.GET:i.default.WEBC_WAP_REQUEST_KIND_CODE.SET,a=e.isToPhone?i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.PHONE:i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,s=e.data.byteLength||JSON.stringify(e.data).length;this._createEvent(t,{kind:n,destination:a,name:r,size:s})}catch(e){__LOG__(3)`WAPReporter: fail to log send`}}logBasicSend(e,t){if(e)try{const r=i.default.WEBC_WAP_REQUEST_KIND_CODE.GET,n=i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,a=t[1].toLowerCase(),s=JSON.stringify(t).length;this._createEvent(e,{kind:r,destination:n,name:a,size:s})}catch(e){__LOG__(3)`WAPReporter: fail to log basic send`}}logAck(e){if(!e)return;const t=this._events.get(e);t&&t.markWebcWapRequestAckT({showInTimeline:!1})}logRecv(e,t,r){if(!e)return;const n=this._events.get(e);n&&(n.webcWapRequestResponseSize=t,null!=r&&(n.webcWapRequestStatus=r),n.markWebcWapRequestRecvT({showInTimeline:!1}),n.commit(),this._events.delete(e))}delete(e){e&&this._events.delete(e)}clear(){this._events.clear()}_createEvent(e,t){const r=new i.default.WebcWapRequest({webcWapRequestKind:t.kind,webcWapRequestDestination:t.destination,webcWapRequestName:t.name,webcWapRequestSize:t.size});this._events.set(e,r)}};t.default=a},94300:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.App=function(){return(0,Se.jsx)(Re,{})},t.Screen=t.InitialEmojisCompletionContext=t.AppWrapper=void 0,t.execApiCmd=Me,t.hasPending=function(){return null!=Te&&Te.hasPending()},t.stopCommsBeforeUnload=function(){(0,Ee.stopComms)()};var a=i(r(48926)),s=i(r(51463)),o=i(r(45095)),l=r(38284),c=r(57319),d=i(r(94184)),u=i(r(41143)),p=i(r(30381)),h=r(67294),f=i(r(15421)),_=r(88711),m=i(r(2300)),g=(i(r(95747)),r(89721)),y=i(r(66034)),E=i(r(89248)),S=r(22683),v=r(88102),T=i(r(52665)),A=i(r(8623)),C=r(17239),b=i(r(69618)),P=r(40249),M=i(r(19197)),O=i(r(94049)),I=i(r(78359)),w=r(96384),R=r(24113),D=r(99234),N=r(7293),L=r(57701),k=r(55414),G=i(r(63824)),U=i(r(43725)),F=r(84387),x=r(70818),B=r(83578),K=r(46582),Y=i(r(30071)),j=i(r(11339)),W=r(66776),H=i(r(96753)),V=r(71119),$=r(7111),z=r(77113),q=i(r(43951)),J=i(r(22028)),Q=r(27838),X=r(64551),Z=i(r(31703)),ee=i(r(57050)),te=r(23283),re=r(8080),ne=n(r(12209)),ie=i(r(10258)),ae=r(97628),se=i(r(93373)),oe=i(r(99736)),le=r(65127),ce=r(18644),de=r(83973),ue=r(29898),pe=r(2541),he=i(r(49036)),fe=r(96984),_e=r(65044),me=r(97480),ge=i(r(7260)),ye=i(r(37538)),Ee=r(24747);r(58586);var Se=r(85893);_e.Socket.registerHandler((e=>{(0,K.requireHandleSocketMessage)().then((t=>t(e)))}));const ve=r(54302).Mirrored(["CLIENT_EXPIRED_DIALOG","ANOTHER_SESSION","UNSUPPORTED_TAKEOVER","QR","SYNCING","OFFLINE","PROXYBLOCK","CONFLICT","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION","MAIN","STARTUP","TEMP_BAN","LOGOUT"]);let Te;t.Screen=ve;let Ae=!1,Ce=!1;function be(e){"initialPanelMountTRecorded"===e&&(Ae=!0),"initialPanelRenderTRecorded"===e&&(Ce=!0),Ae&&Ce&&(0,V.onInitialRenderComplete)()}const Pe=(0,s.default)((()=>{(0,V.saveInitialPanelMountTime)(Date.now()),be("initialPanelMountTRecorded")}));function Me(e){let{cmdAndData:t,isExternal:r,sessionId:n}=e;const{resultType:i,data:a}=t;return __LOG__(2)`main:execApiCmd:${i}`,(0,u.default)(null!=Te,"Attempted to exec API command before main was loaded"),Te.execApiCmd({cmd:i,untypedData:a,isExternal:r,sessionId:n})}const Oe=new I.default,Ie=(0,h.createContext)(Oe);t.InitialEmojisCompletionContext=Ie;class we extends h.Component{constructor(){super(...arguments),this.contextMenuRef=(0,h.createRef)(),this.animate=!0,this.state={mode:re.Stream.mode,updating:re.Stream.clientExpired,hardExpired:re.Stream.hardExpired,anotherSession:!1,takingOver:!1,isUnsupportedTakeover:!1,apiCmd:void 0,locale:U.default.getLocale(),mainLoaded:!1,socketProgressStep:0,theme:(0,ae.getTheme)(),systemThemeMode:(0,ae.getSystemThemeMode)(),isKeyboardUser:!1,initialLoadReady:!1,startLogout:!1,stayInSync:!_e.Socket.hasSynced},this._unsetIsKeyboardUser=()=>{this.setState({isKeyboardUser:!1})},this._setIsKeyboardUser=()=>{this.setState({isKeyboardUser:!0})},this._handlers={up:this._setIsKeyboardUser,down:this._setIsKeyboardUser,left:this._setIsKeyboardUser,right:this._setIsKeyboardUser,home:this._setIsKeyboardUser,end:this._setIsKeyboardUser,"command+up":this._setIsKeyboardUser,"command+down":this._setIsKeyboardUser,pageUp:this._setIsKeyboardUser,pageDown:this._setIsKeyboardUser,tab:this._setIsKeyboardUser,"shift+tab":this._setIsKeyboardUser,"shift+?":this._setIsKeyboardUser},this._setWamSystemInfo=null,this._setModeScheduler=new c.ShiftTimer((e=>{e!==this.state.mode&&this.setState({mode:e})})),this._handleStreamModeChange=()=>{const e=re.Stream.mode;this.state.mode!==re.StreamMode.MAIN?this._setModeScheduler.onOrBefore(0,e):this._setModeScheduler.forceRunNow(e)},this._onClientExpired=()=>{this.state.updating!==re.Stream.clientExpired&&this.setState({updating:re.Stream.clientExpired})},this._onHardExpired=()=>{this.setState({hardExpired:re.Stream.hardExpired})},this.onMouseDown=e=>{0!==e.detail&&this._unsetIsKeyboardUser(),v.Cmd.windowMouseDown(e)},this.onClick=e=>{v.Cmd.windowClick(e)},this._handleWindowClick=e=>{var t;const r=e.target;if(!r)return;if("A"!==r.nodeName)return;const n=r.getAttribute("href");if(!n)return;if(null===(t=r.dataset)||void 0===t?void 0:t.nohandle)return;const i=(0,$.parseAPICmd)(n);if("INVALID"===i.resultType)return;const a=this._getDeeplinkSessionId();this._canExecApiCmd()&&Me({cmdAndData:i,isExternal:!0,sessionId:a})&&(N.GK.supportsFeature(N.GK.F.MD_BACKEND)&&this._logDeepLinkClickMetric(i,a),e.preventDefault())},this._logDeepLinkClickMetric=(e,t)=>{if(e.resultType===_.APICmd.GROUP_INVITE)new j.default.DeepLinkClick({deepLinkHasPhoneNumber:!1,deepLinkHasText:!0}).commit();else if(e.resultType===_.APICmd.MSG_SEND){const r=e.data.phone,n=e.data.text;new j.default.DeepLinkClick({deepLinkHasPhoneNumber:!!r,deepLinkHasText:!!n,deepLinkSessionId:t}).commit()}else(e.resultType===_.APICmd.CATALOG||e.resultType===_.APICmd.PRODUCT)&&new j.default.DeepLinkClick({deepLinkHasPhoneNumber:!0,deepLinkHasText:!1}).commit()},this._handleSetTheme=e=>{if(this.state.theme!==e){for(const t of ae.THEME_ASSETS[e])g.AssetLoader.loadAsset(t,g.LOAD_PRIORITY.THEME_ASSET_LOAD,!1);if(X.ServerProps.wallpapersV2){const e=y.default.get("defaultPreference");if(e&&b.default.DEFAULT_CHAT_WALLPAPER!==e.wallpaperColor){const t=(0,fe.toggleWallpaperColor)(e.wallpaperColor,this.state.theme);e.set("wallpaperColor",t)}}(0,ae.setTheme)(e),this.setState({theme:e})}},this._handleSetSystemThemeMode=e=>{(0,ae.setSystemThemeMode)(e),this.setState({systemThemeMode:e})},this._mdReloadPageOnTakeOver=()=>{__LOG__(2)`[md takeover] refreshing page on takeover`,window.location.reload()},this._onReadyForMainScreen=()=>{__LOG__(2)`DebouncedLoadingScreen: Ready for main screen`,this.setState({stayInSync:!1})},this._mdReloadPageWithUnsupportedTakeOver=()=>{__LOG__(2)`[unsupported takeover] refreshing page with unsupported takeover`,window.location.reload()},this._getThemeContextValue=(0,Y.default)((e=>{let{theme:t,systemThemeMode:r}=e;return{theme:t,setTheme:this._handleSetTheme,systemThemeMode:r,setSystemThemeMode:this._handleSetSystemThemeMode}}))}componentDidMount(){!0===(0,D.mdOptedIn)()&&(N.GK.setFeature(N.GK.F.MD_BACKEND,!0),N.GK.setFeature(N.GK.F.MD_ADV,!0),N.GK.setFeature(N.GK.F.MD_VOIP_GROUP,!1));const{theme:e}=this.state;(0,ae.applyThemeToUI)(e),Le().then((t=>{g.AssetLoader.setPlatform(t),g.AssetLoader.loadInitialAssets(ae.THEME_ASSETS[e])})),function(){return De.apply(this,arguments)}().then(z.loadProtoVersions).then((()=>{v.Cmd.mainLoaded(),this.setState({mainLoaded:!0})})).then((()=>Promise.all([(0,K.requireEmojiAssetMapCreator)(),(0,K.requireEmojiConfig)(),Le()]))).then((e=>{let[t,r,n]=e;g.AssetLoader.setPlatform(n),g.AssetLoader.initEmojiAsset(t(r)),Oe.beginPreloadFallback()}));const{listeners:t}=this.props;t.add(v.Cmd,"increment_progress",(()=>{this._incProgress()})),t.add(v.Cmd,"initial_load_ready",(()=>{this.setState({initialLoadReady:!0})})),t.add(te.StorageCmd,"storage_not_enough_space",(()=>{v.Cmd.openModal((0,Se.jsx)(T.default,{onOK:()=>{_e.Socket.logout(!1,B.LogoutReason.StorageQuotaExceeded)},okText:U.default.t(1765),children:U.default.t(1728)}))})),t.add(v.Cmd,"account_temporarily_banned",(e=>{this.setState({temporaryBan:e})})),t.add(v.Cmd,"starting_logout",(()=>{this.setState({startLogout:!0})})),N.GK.supportsFeature(N.GK.F.MD_BACKEND)&&me.OfflineResumeReporter.logPageLoadT();{const e=r(63064).Z;t.add(window,"beforeunload",e.unloadMutex.bind(e)),t.add(window,"unload",e.unloadMutex.bind(e)),t.add(window,"storage",(t=>{e.storagePong(t)&&(N.GK.supportsFeature(N.GK.F.MD_BACKEND)&&(__LOG__(2)`[md takeover] tab taken over. stopping comms`,(0,Ee.stopComms)()),x.Logger.onTakeOver(),this.setState({takingOver:!1,anotherSession:!0}))}))}if(t.add(re.Stream,"change:clientExpired",this._onClientExpired),t.add(re.Stream,"change:hardExpired",this._onHardExpired),t.add(re.Stream,"change:mode",this._handleStreamModeChange),pe.URL.canMuckHistory()){const e=(0,$.parseAPICmd)(window.location.href);if(e.resultType!==_.APICmd.INVALID){const{url:t}=e.data;delete e.data.url,this._maybeExecApiCmd(e),window.history.replaceState({},"",t)}}var n;t.add(U.default,"locale_change",(e=>{let{loc:t}=e;__LOG__(2)`App:componentDidMount:rerenderUI locale change`,(0,D.setLangPref)(t),N.GK.supportsFeature(N.GK.F.MD_BACKEND)&&S.Clock.setIs24HourBasedOnLocale(),this.animate=!1,this.setState({locale:`${U.default.getLocale()}#${p.default.locale()}`})})),this._registerYesterdayTimer(),__LOG__(2)`App:componentDidMount:visibilityState: ${document.visibilityState}`,"prerender"===document.visibilityState?(0,l.promiseTimeout)((0,he.default)(document,"visibilitychange"),5e3).then((()=>this._beginMutex(0))).catch((()=>this._beginMutex(0))):this._beginMutex(0),this.props.listeners.add(window,"click",this._handleWindowClick,{capture:!0}),this.props.listeners.add(window,"blur",(()=>{this._unsetIsKeyboardUser()})),de.updatePoll.poll(de.checkForUpdates),this._logFirstRenderMountTime(),document.createElement=(n=document.createElement.bind(document),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("iframe"===e.toLowerCase()){__LOG__(3)`Modified a created iframe element to include sandbox attributes for security fix.`;const r=n(e,t);return r.sandbox=X.ServerProps.webYouTubePlayerEnhancements||X.ServerProps.webPipRedesign?"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox":"allow-scripts allow-same-origin",r}return n(e,t)}),this.props.listeners.add(ie.default,"system_theme_change",(e=>{this.state.systemThemeMode&&this._handleSetTheme(e)}))}componentDidUpdate(e,t){!0===t.anotherSession&&!1===this.state.anotherSession?M.default.openDB().catch((e=>{__LOG__(3)`Failed to open indexeddb: ${e}`})):!1===t.anotherSession&&!0===this.state.anotherSession&&M.default.idb().then((e=>e.close())).catch((()=>{})),this._maybeExecApiCmd(this.state.apiCmd),this.state.mode!==re.StreamMode.MAIN&&(this.animate=!0),this._logFirstRenderMountTime()}componentWillUnmount(){this._setModeScheduler.cancel(),this._setWamSystemInfo&&this._setWamSystemInfo.cancel()}_beginMutex(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.default)((function*(){if(le.UA.isLocalStorageBroken&&N.GK.supportsFeature(N.GK.F.MD_BACKEND)){if(yield(0,Q.isAnotherTabActive)()){x.Logger.onTakeOver(),t.setState({isUnsupportedTakeover:!0});try{(0,Ee.stopComms)()}catch(e){}return}}(0,Q.setTabActive)(),n&&ue.Updater.shouldForceUpdateOnTakeOver()&&ue.Updater.restart();{const i=r(63064).Z,a=n?i.takeoverLocal(e):i.init(e),s=yield a.catch((e=>(t.setState({takingOver:!0}),t._beginMutex(e,!0))));x.Logger.isTakeOver=s,t.setState({takingOver:!1,anotherSession:s})}}))()}_incProgress(){this.setState({socketProgressStep:this.state.socketProgressStep+1})}_maybeExecApiCmd(e){if(e){if(this._canExecApiCmd()){return Me({cmdAndData:e,isExternal:!0,sessionId:this._getDeeplinkSessionId()}),void(null!=this.state.apiCmd&&this.setState({apiCmd:null}))}e!==this.state.apiCmd&&this.setState({apiCmd:e})}}_canExecApiCmd(){return null!=Te&&Ne(this.state)===ve.MAIN}_logFirstRenderMountTime(){this.state.mode!==re.StreamMode.SYNCING&&Pe()}_calculateProgress(){return 20*this.state.socketProgressStep}_registerYesterdayTimer(){f.default.setLocalTimeout((()=>{__LOG__(2)`App:registerYesterdayTimer:rerenderUI relative timestamps`,__LOG__(2)`Local Clock: ${Date.now()}, Skew: ${S.Clock.getSkew()}`,v.Cmd.midnight(),this._registerYesterdayTimer()}),(0,p.default)().endOf("day").valueOf())}_getTemporaryBanReason(e){const t=(0,D.getMaybeMeUser)().user;switch(e){case 101:return U.default.t(1339,{phone:t});case 102:return U.default.t(1340);case 103:return U.default.t(1341,{phone:t});case 104:return U.default.t(1342);case 106:return U.default.t(1343);default:return U.default.t(1344)}}_getUiAndIconCount(){switch(Ne(this.state)){case ve.CLIENT_EXPIRED_DIALOG:return{ui:(0,Se.jsx)(R.DefaultFavicon,{children:(0,Se.jsx)(E.default,{})}),requiresBackendCheck:!1};case ve.ANOTHER_SESSION:{let e,t;return this.state.takingOver?(e=()=>{},t=U.default.t(370)):(e=()=>{N.GK.supportsFeature(N.GK.F.MD_BACKEND)?this._mdReloadPageOnTakeOver():this._beginMutex(0,!0)},t=U.default.t(263)),{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(A.default,{cancelText:U.default.t(1585),onCancel:window.open.bind(window,"https://www.whatsapp.com/","_self"),okText:t,onOK:e,children:U.default.t(1929)})}),requiresBackendCheck:!1}}case ve.UNSUPPORTED_TAKEOVER:return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(A.default,{okText:U.default.t(1884),onOK:this._mdReloadPageWithUnsupportedTakeOver,children:U.default.t(1883)})}),requiresBackendCheck:!1};case ve.TEMP_BAN:const{code:e,expire:t}=this.state.temporaryBan||{},r=this._getTemporaryBanReason(e),n=p.default.duration(t,"seconds").humanize();return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsxs)(A.default,{cancelText:U.default.t(808),onCancel:()=>{__LOG__(2)`Banned accounts: user selected logout`,_e.Socket.logout()},okText:U.default.t(1711),onOK:window.open.bind(window,(0,w.getFaqUrl)()),children:[(0,Se.jsx)("div",{children:r}),(0,Se.jsx)("div",{children:U.default.t(1338,{duration:n})})]})}),requiresBackendCheck:!0};case ve.QR:return{ui:(0,Se.jsxs)(R.DefaultFavicon,{children:[(0,Se.jsx)(W.ModalManager,{type:W.ModalType},"modal-manager"),(0,Se.jsx)(J.default,{apiCmd:this.state.apiCmd},"qr-code")]}),extraClasses:m.default.isQR,requiresBackendCheck:!0};case ve.STARTUP:case ve.SYNCING:if(N.GK.supportsFeature(N.GK.F.MD_BACKEND)){let e=(0,Se.jsx)(ye.default,{initialLoadReady:this.state.initialLoadReady,onReady:this._onReadyForMainScreen});return{ui:(0,Se.jsx)(R.DefaultFavicon,{children:e}),requiresBackendCheck:!0}}return{ui:(0,Se.jsx)(R.DefaultFavicon,{children:(0,Se.jsx)(ee.default,{progress:this._calculateProgress()})}),requiresBackendCheck:!0};case ve.OFFLINE:return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(H.default,{})}),requiresBackendCheck:!0};case ve.PROXYBLOCK:return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(q.default,{})}),requiresBackendCheck:!0};case ve.CONFLICT:return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(A.default,{cancelText:U.default.t(808),onCancel:()=>_e.Socket.logout(),okText:U.default.t(263),onOK:()=>_e.Socket.takeover(),children:U.default.t(1034)})}),requiresBackendCheck:!0};case ve.TOS_BLOCK:return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(oe.default,{description:U.default.t(1878)})}),requiresBackendCheck:!0};case ve.SMB_TOS_BLOCK:return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(oe.default,{description:U.default.t(1847),children:(0,Se.jsx)(Z.default,{})})}),requiresBackendCheck:!0};case ve.DEPRECATED_VERSION:return{ui:(0,Se.jsx)(R.ErrorFavicon,{children:(0,Se.jsx)(O.default,{})}),requiresBackendCheck:!0};case ve.LOGOUT:return{ui:(0,Se.jsxs)(R.DefaultFavicon,{children:[(0,Se.jsx)(W.ModalManager,{type:W.ModalType},"modal-manager"),(0,Se.jsx)(ge.default,{},"logout")]}),requiresBackendCheck:!0};case ve.MAIN:const{MainComponent:i}=(0,o.default)(Te,"Main");return{ui:[(0,Se.jsx)(se.default,{},"toast-manager"),(0,Se.jsx)(W.ModalManager,{contextMenuRef:this.contextMenuRef,type:W.ModalType},"main-modal-manager"),(0,Se.jsx)(W.ModalManager,{type:W.MediaType},"media-modal-manager"),(0,Se.jsx)(P.ContextMenuManager,{ref:this.contextMenuRef,type:P.Type.MENU},"context-menu-manager"),(0,Se.jsx)(P.ContextMenuManager,{type:P.Type.TOOLTIP},"tooltip-manager"),(0,Se.jsx)(Ie.Provider,{value:Oe,children:(0,Se.jsx)(i,{conn:C.Conn,animate:this.animate})},"main")],extraClasses:m.default.isMain,requiresBackendCheck:!0}}}_getDeeplinkSessionId(){return(0,L.smbClickToChatLoggingEnabled)()?Math.floor(2147483648*Math.random()).toString():void 0}render(){!function(e){if(V.initialScreenTimer.hasStarted())return;const t=Ne(e);if(!function(e){return e!==ve.SYNCING}(t))return;(0,V.setInitialScreen)(t),V.initialScreenTimer.start(),window.requestAnimationFrame((()=>{V.initialScreenTimer.end(),be("initialPanelRenderTRecorded")}))}(this.state);const{isKeyboardUser:e}=this.state,{ui:t,extraClasses:r,requiresBackendCheck:n}=this._getUiAndIconCount(),i=(0,d.default)(m.default.wrapper,r,{"app-wrapper-native":ne.isNative,"app-wrapper-web":ne.isWeb,"safari-fix":ne.hasSafariFix,"edge-fix":ne.hasEdgeFix,"font-fix":ne.hasFontFix,"os-ltr":ne.isOSLTR,"os-rtl":ne.isOSRTL,"os-mac":ne.isOSMac,"os-win":ne.isOSWin,"keyboard-user":e});n&&null!=Te&&!(0,D.knowsPhone)()&&Te.notificationBackend.shutdownAsNeeded();const a=Ne(this.state),s=a===ve.STARTUP||a===ve.SYNCING?"loading-screen":this.state.locale;return(0,Se.jsx)(ae.ThemeContext.Provider,{value:this._getThemeContextValue({theme:this.state.theme,systemThemeMode:this.state.systemThemeMode}),children:(0,Se.jsx)(G.default.Provider,{value:e,children:(0,Se.jsx)(ce.UIE,{displayName:"App",uimState:ce.UIE.State.INACTIVE,children:(0,Se.jsxs)(k.HotKeys,{handlers:this._handlers,className:i,tabIndex:null,onMouseDownCapture:this.onMouseDown,onClickCapture:this.onClick,children:[undefined,undefined,t]},s)})})})}}we.displayName="AppImpl";const Re=(0,F.ListenerHOC)(we);function De(){return(De=(0,a.default)((function*(){const[e,t]=yield Promise.all([(0,K.requireMain)(),Le()]);V.mainScriptTimer.start(),Te=e(t),V.mainScriptTimer.end()}))).apply(this,arguments)}function Ne(e){const{anotherSession:t,isUnsupportedTakeover:r,updating:n,hardExpired:i,mainLoaded:a,mode:s}=e;if(N.GK.supportsFeature(N.GK.F.MD_BACKEND)){var o;if(null===(o=e.temporaryBan)||void 0===o?void 0:o.banned)return ve.TEMP_BAN;if(e.startLogout)return ve.LOGOUT}if(n||i)return ve.CLIENT_EXPIRED_DIALOG;if(r)return ve.UNSUPPORTED_TAKEOVER;if(t)return ve.ANOTHER_SESSION;switch(s){case re.StreamMode.QR:return ve.QR;case re.StreamMode.SYNCING:return ve.SYNCING;case re.StreamMode.OFFLINE:return ve.OFFLINE;case re.StreamMode.PROXYBLOCK:return ve.PROXYBLOCK;case re.StreamMode.CONFLICT:return ve.CONFLICT;case re.StreamMode.TOS_BLOCK:return ve.TOS_BLOCK;case re.StreamMode.SMB_TOS_BLOCK:return ve.SMB_TOS_BLOCK;case re.StreamMode.DEPRECATED_VERSION:return ve.DEPRECATED_VERSION;case re.StreamMode.MAIN:return a?N.GK.supportsFeature(N.GK.F.MD_BACKEND)&&e.stayInSync?ve.SYNCING:ve.MAIN:ve.STARTUP}throw new Error(`app:render Error invalid StreamMode: ${s}`)}function Le(){return C.Conn.platform?Promise.resolve(C.Conn.platform):new Promise((e=>{const t=()=>{const{platform:r}=C.Conn;null!=r&&(C.Conn.off("change:platform",t),e(r))};C.Conn.on("change:platform",t)}))}t.AppWrapper=Re},50669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t,r){this.retryCount=0,this.asset=e,this.resolution=t,this.priority=r}getLoadUrlPromise(){return this._loadUrlPromise}setLoadUrlPromise(e,t){this._loadUrlPromise=e,this._loadUrlAbortController=t}abortLoadUrlPromise(){var e;null===(e=this._loadUrlAbortController)||void 0===e||e.abort()}getConsumerPromise(){return this._consumerPromise}setConsumerPromise(e){this._consumerPromise=e}getConsumerPromiseResolve(){return this._consumerPromiseResolve}setConsumerPromiseResolve(e,t){this._consumerPromiseResolve=e,this._consumerAbortController=t}abortConsumerPromise(){var e;null===(e=this._consumerAbortController)||void 0===e||e.abort()}}},95480:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!r(5882).default.supported)return;const t=!0===e.estimateStorage,n=r(79485).default,u=r(37362).default,p=navigator.serviceWorker;(0,s.detectWebpSupport)().then((t=>{const r=(0,i.default)(e.keep,(e=>[e[a.default.RES.LOW],e[a.default.RES.HIGH]])).map((e=>{var r;const n=null===(r=e[t&&e[d]?d:c])||void 0===r?void 0:r.split("/");return null!=n?n[n.length-1]:null}));(null==p?void 0:p.controller)&&n.request(p.controller,u.CLEAN_ASSETS,r).catch((()=>{}))})).then((()=>t?(0,l.default)():null)).then((e=>{e&&new o.default.WebcStorageStat({webcStorageUsage:e.usage,webcStorageQuota:e.quota}).commit()}))};var i=n(r(94654)),a=n(r(3309)),s=r(44365),o=n(r(11339)),l=n(r(96222));const c="default",d="webp"},14315:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.emojiAssetMapCreator=function(e){return t=>p(t,e)},t.getEmojiTypeFromPlatform=h;var i=n(r(52628)),a=n(r(44908)),s=n(r(88306)),o=r(17239),l=n(r(69618)),c=r(80439);const{EMOJI:{EMOJI_TYPE:d,BUCKET_SIZE:u}}=l.default,p=(0,s.default)(((e,t)=>{const r=new Map,n=h(e),s=t[n],o=s.SELECTOR,l=Math.ceil((0,a.default)((0,i.default)(s.UNICODE_TO_EMOJI)).length/u);for(let e=0;e<l;e+=1){const t=`emoji-${o}-b${e}`,i=40;r.set(t,{id:t,selectors:[`.emoji.${o}.b${e}`,`.emojik.${o}.b${e}`],low:{default:(0,c.getEmojiSpritesPath)(n,e,40,"png"),webp:(0,c.getEmojiSpritesPath)(n,e,i,"webp")},high:{default:(0,c.getEmojiSpritesPath)(n,e,64,"png"),webp:(0,c.getEmojiSpritesPath)(n,e,64,"webp")}})}return r}));function h(e){switch(e){case o.PLATFORMS.IPHONE:case o.PLATFORMS.SMBI:case o.PLATFORMS.IPAD:case o.PLATFORMS.IPOD:return d.APPLE;default:return d.WHATSAPP}}},78359:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(89721);t.default=class{constructor(){var e=this;this._loadingEmojisCount=0,this._hasTriggeredEmojiPreload=!1,this._firstRun=!1,this.beginPreload=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e._hasTriggeredEmojiPreload||(e._hasTriggeredEmojiPreload=!0,window.setTimeout((()=>{n.AssetLoader.loadEmojis()}),t?1e3:0))},this.beginPreloadFallback=()=>{window.setTimeout((()=>{this.beginPreload(!1)}),5e3)},this.incrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._firstRun||(this._firstRun=!0,this._firstRunTiming=performance.now()),this._loadingEmojisCount+=1)},this.decrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._loadingEmojisCount-=1,0===this._loadingEmojisCount&&this._firstRun&&(this.beginPreload(!0),__LOG__(2)`EmojiCompletionTracker:firstScreenEmojis complete in ${Math.ceil(performance.now()-this._firstRunTiming)} ms`))}}}},89721:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LOAD_PRIORITY=t.AssetLoaderImpl=t.AssetLoaderClass=t.AssetLoader=void 0;var a=i(r(48926)),s=i(r(52628)),o=i(r(18446)),l=r(89385),c=i(r(45095)),d=i(r(9006)),u=i(r(41143)),p=i(r(70714)),h=i(r(50669)),f=i(r(95480)),_=i(r(69618)),m=i(r(3309)),g=i(r(75538)),y=r(70449),E=r(14315),S=r(7087),v=i(r(11339)),T=i(r(84644)),A=n(r(22906));const C={INITIAL_EMOJI_LOAD:1,INITIAL_ASSET_LOAD:2,THEME_ASSET_LOAD:2,HELP_ANIMATED_DOODLE:2,LAZY_LOAD_EMOJI:2,NOTIFICATION_ICON:2};t.LOAD_PRIORITY=C;const{EMOJI_TYPE:b}=_.default.EMOJI;class P{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;this._assetStyle=new g.default("asset-style"),this._requestedAssets={},this._loadingDataMap={},this._getEmojiForPlatform=null,this._currentResolution=m.default.currentRes,this._currentlyLoadingCount=0,this._queue=new d.default((e=>-e.priority)),this._hasLoggedDecrementBelowZero=!1,this._handleDpiChange=()=>{const e=m.default.currentRes,t=this._currentResolution;e!==t&&(this._currentResolution=e,Object.keys(this._requestedAssets).forEach((e=>{this._cancelLoad(e,t)})),this._loadAssets((0,s.default)(this._requestedAssets),C.INITIAL_EMOJI_LOAD,{forceCheck:!1}).catch((0,l.catchAbort)((()=>{}))))},this._maxConcurrentRequests=e,window.addEventListener("dpichange",this._handleDpiChange)}initEmojiAsset(e){this._getEmojiForPlatform=e}loadInitialAssets(e){const t=new v.default.WebcAssetLoad({webcAssetName:"initial-assets",webcAssetFromCache:!1,webcAssetCacheType:v.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(e,C.INITIAL_ASSET_LOAD,{estimateStorage:!0}).then((()=>{t.markWebcAssetLoadT(),t.commit();const e=t.webcAssetLoadT;__LOG__(2)`AssetLoader:loadInitialAssets complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadInitialAssets cancelled by more recent request.`})))}loadEmoji(e,t){if(this._getEmojiForPlatform&&this._currentPlatform){const r=this._getEmojiForPlatform(this._currentPlatform),n=y.EmojiUtil.getBucket(e),i=this._getEmojiPrefix(),a=r.get(`${i}b${n}`),s=this._currentResolution;return a?this.loadAsset(a,t,!1).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader: loadEmoji Cancelled by more recent request: ${a.id}-${s}`}))):Promise.reject(new Error("The given emoji glyph id was not found"))}return Promise.reject(new Error("emojiForPlatform or currentPlatform are not set"))}loadEmojis(){const e=(0,c.default)(this._currentPlatform,"this._currentPlatform");(0,u.default)(null!=this._getEmojiForPlatform,"Emojis were loaded before initializing the emoji assets!");const t=[...this._getEmojiForPlatform(e).values()],r=new v.default.WebcAssetLoad({webcAssetName:"emojis",webcAssetFromCache:!1,webcAssetCacheType:v.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(t,C.INITIAL_EMOJI_LOAD,{estimateStorage:!0}).then((()=>{r.markWebcAssetLoadT(),r.commit();const e=r.webcAssetLoadT;__LOG__(2)`AssetLoader:loadEmojis complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadEmojis cancelled by more recent request.`})))}loadAsset(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{id:n}=e,i=m.default.currentRes,a=this._requestedAssets[n];if(a&&!(0,o.default)(e,a))return Promise.reject(new Error(["Attempted to load an asset using an already used ID"].join("\n")));this._requestedAssets[n]=e,this._loadingDataMap[n]=this._loadingDataMap[n]||{};const s="high"===i?"low":"high";this._cancelLoad(n,s);const c=this._loadingDataMap[n][i];if(c&&!r)return c.promise;const d=new h.default(e,i,t),u=new p.default,{signal:f}=u,_=this._buildPromise(d,u).then((t=>{if(f.aborted)throw new l.AbortError;const{selectors:r}=e;return r&&this._assetStyle.setRule(`${r.join(", ")}`,{"background-image":`url('${t}')`}),t})).catch((e=>{const t=this._loadingDataMap[n][i],r=g!==t;if(r||(this._loadingDataMap[n][i]=null),e.name===l.ABORT_ERROR&&(__LOG__(2)`Asset load cancelled by more recent request: ${n}-${i}`,r&&t))return t.promise;throw e}));d.setConsumerPromise(_);const g={promise:_,abort:e=>{this._abortUrlPromise(d,e)}};return this._loadingDataMap[n][i]=g,c&&c.abort(!1),this._startLoad(),_}_buildPromise(e,t){const r=new Promise((r=>{e.setConsumerPromiseResolve(r,t),this._queue.push(e)}));return(0,T.default)(r,t.signal)}_startLoad(){if(!(this._currentlyLoadingCount>=this._maxConcurrentRequests))for(let e=0;e<this._maxConcurrentRequests-this._currentlyLoadingCount;e++){const e=this._queue.pull();if(!e)return;this._currentlyLoadingCount+=1,(0,S.loadUrl)(e).then((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()})).catch((0,l.catchAbort)((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()}))).catch((t=>{this._decrementCurrentlyLoadingCount(),e.retryCount+=1;const r=A.expBackoff(e.retryCount,12e4,1e3,.1);setTimeout((()=>{this._queue.push(e),this._startLoad()}),r),this._startLoad(),(0,S.getSupportedImageFormatUrl)(e).then((e=>{const r=e.split("/");__LOG__(3)`Asset: ${r[r.length-1]} failed. Retrying... ${t.toString()}`}))}))}}_abortUrlPromise(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.getLoadUrlPromise()){e.abortLoadUrlPromise();const r=e.getConsumerPromise();t&&r&&e.abortConsumerPromise()}this._startLoad()}_cancelLoad(e,t){var r;const n=null===(r=this._loadingDataMap[e])||void 0===r?void 0:r[t];n&&(this._loadingDataMap[e][t]=null,n.abort(!0))}setPlatform(e){if(e===this._currentPlatform)return;this._currentPlatform=e;const t=((0,E.getEmojiTypeFromPlatform)(e)===b.APPLE?b.WHATSAPP:b.APPLE)===b.APPLE?"emoji-apple-":"emoji-wa-";if(Object.keys(this._requestedAssets).forEach((e=>{e.startsWith(t)&&(this._cancelLoad(e,"high"),this._cancelLoad(e,"low"))})),null==this._getEmojiForPlatform)return;const r=[...this._getEmojiForPlatform(e).values()];this._loadAssets(r,C.INITIAL_EMOJI_LOAD,{forceCheck:!1})}_getEmojiPrefix(){return(0,E.getEmojiTypeFromPlatform)(this._currentPlatform)===b.APPLE?"emoji-apple-":"emoji-wa-"}_loadAssets(e,t,r){var n=this;return(0,a.default)((function*(){const i=!1!==(null==r?void 0:r.forceCheck),a=!0===(null==r?void 0:r.estimateStorage),o=yield Promise.all(e.map((e=>n.loadAsset(e,t,i))));return(0,f.default)({keep:(0,s.default)(n._requestedAssets),estimateStorage:a}),o}))()}_decrementCurrentlyLoadingCount(){this._currentlyLoadingCount<=0&&!this._hasLoggedDecrementBelowZero&&(this._hasLoggedDecrementBelowZero=!0,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Tried to decrease _loadingCount below zero, would have been negative.")),this._currentlyLoadingCount=Math.max(0,this._currentlyLoadingCount-1)}}t.AssetLoaderImpl=P;const M=new P;t.AssetLoader=M;const O=P;t.AssetLoaderClass=O},7087:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LoadUrlError=void 0,t.getSupportedImageFormatUrl=f,t.loadUrl=function(e){const t=new o.default,r=f(e).then(function(){var r=(0,i.default)((function*(r){yield d.default.waitIfOffline({signal:t.signal});const n=Date.now(),i=yield(0,c.extendedFetch)(r,{signal:t.signal}),a=e.getConsumerPromiseResolve();if(!i.ok||!a)throw new h(r,i.status,Date.now()-n);a(r)}));return function(){return r.apply(this,arguments)}}());return e.setLoadUrlPromise(r,t),r};var i=n(r(48926)),a=r(40265),s=n(r(45095)),o=n(r(70714)),l=r(44365),c=r(43816),d=n(r(57220));const u="default",p="webp";class h extends((0,a.customError)("LoadUrlError")){constructor(e,t,r){super(`Failed to load url. StatusCode: ${t}. Duration: ${r} ms`),this.url=e,this.statusCode=t}}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=yield(0,l.detectWebpSupport)(),{asset:r,resolution:n}=e,i=t&&r[n][p]?p:u;return(0,s.default)(r[n][i],"asset[resolution][format]")}))).apply(this,arguments)}t.LoadUrlError=h},29821:(e,t,r)=>{"use strict";var n=r(95318)(r(48926)),i=r(85893);function a(){return(a=(0,n.default)((function*(){window.Promise=r(74121).Z;const{setupMemoizeCache:e}=r(70634);e(),window.__LOG__=r(70818).log,window.SEND_LOGS=r(85965).sendLogs,window.onerror=r(58955).HC,window.onunhandledrejection=r(58955).TG;const t=r(92417).default,a=r(69618).default,{UA:s}=r(65127),o="1"===(null==t?void 0:t.getItem(a.KEY_LOGOUT_DIRTY_BIT)),l="true"===(null==t?void 0:t.getItem(a.KEY_MD_OPTED_IN)),c=!(null==t?void 0:t.getItem(a.KEY_LAST_WID_MD))&&!(null==t?void 0:t.getItem(a.KEY_LAST_WID)),d=r(35217).Z;if(o||c&&l)try{yield d()}catch(e){__LOG__(4,void 0,new Error,void 0,["bootstrap_qr"])`Preemptive db delete failed with error ${e}`}else try{r(70818).Logger.clearLogsPreemptive()}catch(e){}o&&(null==t||t.clear(),window.location.href=`${window.location.pathname}?post_logout=1`);{var u;const e=(null!==(u=window.location.search)&&void 0!==u?u:"").toLowerCase().includes("post_logout=1"),{URL:t}=r(2541);e&&t.canMuckHistory()&&window.history.replaceState({},document.title,"/")}const{initModules:p}=r(56599);p();const{injectWamDependencies:h}=r(77959);h({Browser:r(87045).default,Conn:r(17239).Conn,CLB:r(85965),CONST:r(69618).default,Metric:r(11339).default,UserPrefs:r(99234),WamStorage:r(26372).default,isUserLoggedIn:r(13194).Z,uploadStats:r(85195).Z,WamContext:r(88353).I,PsIdStore:r(29590).Z,CoreWamStorageAdaptor:r(75838),uploadPrivateStats:r(24569).Z});const{exeTimer:f}=r(71119);f.start();const _=r(45095).default,m=r(73935);r(67294),s.isSafari&&s.browserVersion.startsWith("13.")&&(_(document.body,"document.body").className+=" text-rendering-bug-fix"),r(42053),window.Velocity=r(12641),r(38161),window.WebFont=r(75933),r(92589);const g=r(77303),y=r(22854).Z;g.set(y);const{isFunction:E}=r(31515);["getSelection","open","focus"].forEach((function(e){const t=Object.getPrototypeOf(window)[e];E(t)&&window[e]!==t&&(window[e]=t)}));const S=r(85965);window.Debug||(window.Debug={}),window.Debug.uploadLogs=S.upload;try{if(s.isLocalStorageBroken){const e=r(19197).default;yield e.loadUserIdb()}}finally{const e=r(43725).default;e.init(r(99234).getLangPref()).then((0,n.default)((function*(){const{Clock:e}=yield Promise.resolve().then(r.bind(r,22683));e.setIs24HourBasedOnLocale()}))),r(70818).Logger;const{App:t,hasPending:s}=r(94300);window.Debug.VERSION=a.VERSION_STR,window.Debug.DESKTOP_BETA=!1,window.Debug.BUILD_ID=a.BUILD_ID;const o=r(87045).default;window.onbeforeunload=function(){{const{stopCommsBeforeUnload:t}=r(94300);if(l&&!s())try{t()}catch(e){__LOG__(4,void 0,new Error)`error while stopping comms onbeforeunload: ${e}`}if(o.isDownloading())return void o.clearDownloading();if(__LOG__(2)`webclient close/reload triggered`,__LOG__(2)`latest hash: ${a.LATEST_HASH}`,__LOG__(2)`version: ${a.VERSION_STR}`,o.promptUnloadGuards>0)return;if(s())return e.t(356)}},window.addEventListener("dragover",(function(e){e.preventDefault()})),window.addEventListener("drop",(function(e){e.preventDefault()})),r(71798).loadSVGData();(0,r(87826).Z)()||(m.render((0,i.jsx)(t,{}),_(document.getElementById("app"),"document.getElementById('app')")),f.end())}if(window.navigator.serviceWorker&&!window.navigator.serviceWorker.controller)try{window.navigator.serviceWorker.register("/serviceworker.js",{scope:"/"})}catch(e){}}))).apply(this,arguments)}!function(){a.apply(this,arguments)}()},46331:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastPosition=t.ActionType=t.ActionToast=void 0,t.genId=function(e){return(0,i.default)(e||"action_toast")};var i=n(r(73955)),a=r(89385),s=r(13959),o=r(67294),l=n(r(70714)),c=r(88102),d=r(50452),u=r(85893);const p={LEFT:"LEFT",RIGHT:"RIGHT"};t.ToastPosition=p;t.ActionType=class{constructor(e,t){if(!e)throw new Error("ActionType must have text!");this.text=e,t&&(this.action=t.actionText,this.handler=t.actionHandler)}};class h extends o.Component{constructor(){super(...arguments),this.state={currentInitialAction:this.props.initialAction,actionType:this.props.initialAction,pending:!0},this._action=null,this.handleAction=()=>{this.state.actionType&&this.state.actionType.handler&&this.state.actionType.handler().catch((()=>{}))},this.handleDismiss=()=>{c.Cmd.closeToast(this)}}static getDerivedStateFromProps(e,t){const r=e.initialAction;return r!==t.currentInitialAction?{currentInitialAction:r,actionType:r,pending:!0}:null}componentDidMount(){this._runAction(this.props.pendingAction)}componentDidUpdate(e){e.pendingAction!==this.props.pendingAction&&this._runAction(this.props.pendingAction)}_runAction(e){this._action&&this._action.controller.abort();const t=new l.default,r=t.signal,n=e.then((e=>{if(r.aborted)throw new a.AbortError;this.setState({actionType:e,pending:!1})})).catch((e=>{if(e.name===a.ABORT_ERROR)throw e;this.setState({actionType:e,pending:!1})})).then((()=>(0,s.delayMs)(this.props.settleDuration))).then((()=>{if(r.aborted)throw new a.AbortError;c.Cmd.closeToast(this)})).catch((0,a.catchAbort)((()=>{})));this._action={promise:n,controller:t}}render(){const{actionType:e}=this.state;if(!e)return null;let t,r;return e.action&&e.handler&&(r=(0,u.jsx)(d.ToastActionBtn,{buttonText:e.action,onClick:this.handleAction})),this.state.pending||(t=(0,u.jsx)(d.ToastDismissBtn,{onClick:this.handleDismiss})),(0,u.jsx)(d.ToastBody,{toastPosition:this.props.toastPosition,actionText:e.text,actionBtn:r,dismissBtn:t})}}t.ActionToast=h,h.defaultProps={settleDuration:5e3,toastPosition:p.LEFT},h.displayName="ActionToast"},39770:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{a8nText:t,children:r,className:n,xstyle:m,disabled:g,onClick:y,nowrap:E,spinner:S,type:v}=e;const[T,A]=(0,h.default)(y,{disabled:g}),[C,b]=(0,u.default)(),P=(0,p.default)(T,C);let M;switch(v){case"primary":M="white";break;case"secondary":case"plain-white":case"simplified":M="highlight";break;default:M="default"}g&&(M="default");return(0,f.jsx)("div",(0,i.default)((0,i.default)({},A),{},{"data-a8n":a.default.key(t),className:(0,s.default)(l.default.button,{[l.default.primary]:"primary"===v,[l.default.secondary]:"secondary"===v,[l.default.plainWhite]:"plain-white"===v,[l.default.disabled]:g,[l.default.nowrap]:E,[l.default.simplified]:"simplified"===v,[l.default.warning]:"warning"===v,[l.default.solidWarning]:"solidWarning"===v,[l.default.strong]:"strong"===v,[l.default.strongPrimary]:"strong-primary"===v,[l.default.itemFocused]:b},n,(0,o.default)(m)),ref:P,children:(0,f.jsxs)(c.FlexRow,{align:"center",justify:"center",children:[(0,f.jsx)(c.FlexItem,{a8nText:a.default.key("content"),children:null!=r?r:null}),S?(0,f.jsx)(c.FlexItem,{a8nText:a.default.key("spinner"),xstyle:_.spinner,children:(0,f.jsx)(d.Spinner,{color:M,size:16})}):null]})}))};var i=n(r(81109)),a=n(r(99964)),s=n(r(94184)),o=n(r(56720)),l=n(r(3010)),c=r(29623),d=r(11054),u=n(r(97056)),p=n(r(41104)),h=n(r(60265)),f=r(85893);const _={spinner:{paddingStart:"mhcwslh8"}}},99360:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{children:t,href:r,onClick:n,title:c,className:d,tabIndex:u}=e;return(0,o.jsx)("a",{"data-a8n":i.default.key(e.a8n),"data-testid":"clickable-link",className:(0,a.default)(d,(0,s.default)(l)),href:null!=r?r:void 0,onClick:e=>{null!=r&&(e.metaKey||e.altKey)||(e.preventDefault(),n(e))},role:"button",rel:"noreferrer noopener",target:"_blank",title:c,tabIndex:null!=u?u:void 0,children:t})};var i=n(r(99964)),a=n(r(94184)),s=n(r(56720)),o=r(85893);const l={cursor:"ajgl1lbb"}},40249:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Type=t.ContextMenuManagerImpl=t.ContextMenuManager=void 0;var i=n(r(81109)),a=r(67294),s=r(88102),o=r(60811),l=n(r(43725)),c=r(84387),d=n(r(33358)),u=n(r(2773)),p=n(r(41956)),h=r(85893);const f={MENU:"MENU",TOOLTIP:"TOOLTIP"};t.Type=f;const _={originX:0,originY:0,offsetX:0,offsetY:0,dirX:o.DirX.RIGHT,dirY:o.DirY.BOTTOM,type:o.MenuType.dropdown};function m(e,t,r,n){switch(e){case o.DirX.RIGHT:return t;case o.DirX.LEFT:return r;case o.DirX.CENTER:return t+n/2}}class g extends a.Component{constructor(){super(...arguments),this.state={},this._setRefMenuContainer=e=>{this._refMenuContainer=e},this._setRefDropdown=e=>{this._refDropdown=e},this.handleClose=e=>{(!e||this.state.menu&&this.state.menu.uim===e)&&this.setState({menu:void 0})},this._handleOpen=(e,t)=>{var r;let{menu:n}=this.state;(null===(r=n)||void 0===r?void 0:r.uim)&&n.uim.pop(),n=(0,i.default)((0,i.default)((0,i.default)({},_),{},{dirX:l.default.isRTL()?o.DirX.LEFT:o.DirX.RIGHT},e),{},{key:Math.random(),isTemporaryRender:!0}),e.event&&(n=(0,i.default)((0,i.default)({},n),{},{originX:e.event.clientX,originY:e.event.clientY,offsetX:null!=e.offsetX?e.offsetX:10,offsetY:null!=e.offsetY?e.offsetY:10}),e.event.stopPropagation()),this.setState({menu:n},(()=>{var e;t(null===(e=this._refMenuContainer)||void 0===e?void 0:e.getElement()),this._setDirection()}))},this.isOpen=()=>null!=this.state.menu}componentDidMount(){const e=this.props.type===f.MENU?"open_context_menu":"open_tooltip";this.props.listeners.add(s.Cmd,e,this._handleOpen);const t=this.props.type===f.MENU?"close_context_menu":"close_tooltip";this.props.listeners.add(s.Cmd,t,this.handleClose)}_setDirection(){if(!this._refDropdown)return;const e=this._refDropdown.clientWidth,t=this._refDropdown.clientHeight+10,r=window.innerWidth,n=window.innerHeight;if(!this.state.menu)return;const{anchor:a,originX:s,originY:l,offsetX:c,offsetY:d,dirX:u,dirY:p}=this.state.menu;let h=s,f=s,_=l,g=l,y=0;if(a&&a instanceof HTMLElement){const e=a.getBoundingClientRect();h=e.left,f=e.right,g=e.bottom,_=e.top,y=a.offsetWidth}let E=u;E===o.DirX.RIGHT&&h+e>r&&f-e>0?E=o.DirX.LEFT:E===o.DirX.LEFT&&f-e<0&&h+e<r&&(E=o.DirX.RIGHT);let S,v=p;v===o.DirY.BOTTOM&&g+t+d>n&&_-t>0?v=o.DirY.TOP:v===o.DirY.TOP&&_-0-t<0&&g+t+d<n&&(v=o.DirY.BOTTOM),S=v===o.DirY.TOP?_:g;let T=c,A=d;a||(E===o.DirX.LEFT&&(T=0),v===o.DirY.TOP&&(A=0)),this.setState({menu:(0,i.default)((0,i.default)({},this.state.menu),{},{dirX:E,dirY:v,originX:m(E,h,f,y),originY:S,offsetX:T,offsetY:A,isTemporaryRender:!1})})}render(){let e,t="dropdown";if(this.state.menu){const{menu:r,key:n,originX:i,originY:s,offsetX:l,offsetY:c,dirX:u,dirY:p,type:f,autoFocus:_,findFirstItem:m,horizontal:g,isTemporaryRender:y,theme:E}=this.state.menu,S=Array.isArray(r)?r.map((e=>(0,a.cloneElement)(e,{theme:E}))):r;e=(0,h.jsx)(o.Dropdown,{origin:{x:i+l,y:s+c},onRef:this._setRefDropdown,type:f,dirX:u,dirY:p,horizontal:g,autoFocus:_,findFirstItem:m,isTemporaryRender:y,children:(0,h.jsx)(d.default,{ref:this._setRefMenuContainer,children:S})},"key-"+n),t="picker"===f?"dropdown-picker":"dropdown"}return(0,h.jsx)(u.default.Consumer,{children:r=>{var n;return(0,h.jsx)(u.default.Provider,{value:(null===(n=this.state.menu)||void 0===n?void 0:n.uim)||r,children:(0,h.jsx)(p.default,{transitionName:t,children:e})})}})}}t.ContextMenuManagerImpl=g,g.displayName="ContextMenuManagerImpl";const y=(0,c.ListenerHOC)(g);t.ContextMenuManager=class extends y{isOpen(){return this.getComponent().isOpen()}}},11933:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Clipboard=t.APP_TEXT_MIMETYPE=void 0;var i=n(r(96026)),a=n(r(16579)),s=r(9964),o=n(r(62054)),l=n(r(65930)),c=n(r(95697)),d=n(r(6589)),u=r(52596);t.APP_TEXT_MIMETYPE="application/whatsapp";class p{constructor(e){this._value=e||""}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[this.toString(),e].filter((e=>e)).join(t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[e,this.toString()].filter((e=>e)).join(t),this}toString(){return this._value}}class h{static fromEl(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.isCopyable)(e))?(0,s.getAppTextTemplateData)(e):null;return new h("",t)}static getTemplate(e){let t=e;if(!t)return null;if(!(t instanceof HTMLElement)){if(!t.parentElement)return null;t=t.parentElement}let r=new h("${appText}"),n=t,i=5,a=0,o=!1;for(;n&&a<i;)n instanceof HTMLElement&&(0,s.isCopyable)(n)?(r=h.fromEl(n,!0).append(r.toString()),o=o||!r.isPlainText(),i=5):a++,n=n.parentElement;return o?r.toString():null}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._innerAppText=new p(e),this._appTextTemplate=t}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.append(e,t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.prepend(e,t),this}isPlainText(){return Boolean(!this._appTextTemplate&&""!==this._appTextTemplate)}toString(){return this._appTextTemplate||""===this._appTextTemplate?this._appTextTemplate.replace(/\$\{appText\}/g,this._innerAppText.toString()):this._innerAppText.toString()}}class f{constructor(e,t){const r=e||"";this._plainText=new p(r),t&&(this._appText=new h(r,t))}static _copyableChildrenToClipboard(e){const t=(0,s.findCopyableChildren)(e);return(0,a.default)(t,((e,t)=>e.prepend(this.fromEl(t),"\n")),new f)}static _pruneRangeNodes(e,t,r){let n=t.cloneContents().childNodes,i=(0,l.default)(t);const a=[],s=[];for(let t=0;t<n.length;t++){const o=n[t],l=i[t].parentElement;(r||(0,u.isSelectable)(i[t])||(0,u.hasSelectableChildren)(o))&&(e.contains(i[t])||l&&l.contains(e))&&(a.push(o),s.push(i[t]))}n=a,i=s;let o=r;if(1===n.length){const e=n[0];o=o||(0,u.isSelectable)(i[0]),o||(n=(0,u.findSelectableChildren)(e,o),o=!1)}return{rangeNodes:n,parentIsSelectable:o}}static fromCopyableEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=(0,s.getPrePlainTextData)(e)||"",n=new f(r),i=(0,s.getPlainTextData)(e),o=(0,s.getAppTextTemplateData)(e),l=new f("",o);return i||""===i?(l.appendPlainText(i),n.append(l)):t||(0,u.isSelectable)(e)?(0,c.default)(e,"br")?n.appendPlainText("\n"):((0,a.default)(e.childNodes,((e,t)=>{const r=(0,c.default)(t,"div")?"\n":"";return e.prepend(this.fromSelectableNode(t),r)}),l),n.append(l)):(l.append(this._copyableChildrenToClipboard(e)),n.append(l))}static fromEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.isCopyable)(e)||t?this.fromCopyableEl(e,t):this._copyableChildrenToClipboard(e)}static fromNode(e,t){return e instanceof HTMLElement?this.fromEl(e,t):t?this.fromSelectableNode(e):new f}static fromRange(e,t){const r=t.commonAncestorContainer,n=h.getTemplate(r),i=new f("",n),s=(0,u.isSelectAll)(r)?r:(0,u.findSelectAllParent)(r);if(s instanceof HTMLElement)return i.append(this.fromCopyableEl(s));const{parentIsSelectable:o,rangeNodes:l}=this._pruneRangeNodes(e,t,(0,u.isSelectable)(r));return(0,a.default)(l,((e,t)=>{const r=o?"":"\n",n=this.fromNode(t,o);return e.prepend(n,r)}),i)}static fromSelectableNode(e){if((0,d.default)(e))return new f(e.textContent);if(!(e instanceof HTMLElement))return new f;const t=new f;return(0,o.default)(e,(e=>(0,d.default)(e)||(0,s.isCopyable)(e)?[]:Array.from(e.childNodes)),(e=>{let r;(0,s.isCopyable)(e)&&e instanceof HTMLElement?(r=this.fromCopyableEl(e,!0),t.append(r)):(0,d.default)(e)&&t.appendPlainText(e.textContent)})),t}static fromSelection(e,t){const r=new f;return(0,i.default)(t.rangeCount).map((r=>{const n=t.getRangeAt(r);return this.fromRange(e,n)})).reduce(((e,t)=>e.append(t,"\n")),r)}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new h(this.toPlainString()),this._appText.append(e.toAppString(),t)):this.hasAppText()&&this._appText.append(e.toAppString(),t),this._plainText.append(e.toPlainString(),t),this}appendPlainText(e){return this.append(new f(e)),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new h(this.toPlainString()),this._appText.prepend(e.toAppString(),t)):this.hasAppText()&&this._appText.prepend(e.toAppString(),t),this._plainText.prepend(e.toPlainString(),t),this}hasAppText(){return Boolean(this._appText)}toAppText(){return this.hasAppText()?this._appText:new h(this.toPlainString())}toPlainString(){return this._plainText.toString()}toAppString(){return this.hasAppText()?this._appText.toString():this.toPlainString()}}t.Clipboard=f},9964:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Copyable=t.COPYABLE_CSS_SELECTOR=t.COPYABLE_CSS_CLASS=void 0,t.CopyableCode=function(e){return(0,u.jsx)("code",(0,a.default)({},P(e)))},t.CopyableDel=function(e){return(0,u.jsx)("del",(0,a.default)({},P(e)))},t.CopyableDiv=function(e){return(0,u.jsx)("div",(0,a.default)({},P(e)))},t.CopyableEm=function(e){return(0,u.jsx)("em",(0,a.default)({},P(e)))},t.CopyableImg=void 0,t.CopyableLink=function(e){const t=P(e),r=t.href;if(r&&!d.URL.hasValidUrlScheme(r))return(0,u.jsx)("span",{});return(0,u.jsx)("a",(0,a.default)({},t))},t.CopyableSpan=function(e){return(0,u.jsx)("span",(0,a.default)({},P(e)))},t.CopyableStrong=function(e){return(0,u.jsx)("strong",(0,a.default)({},P(e)))},t.CopyableUl=function(e){return(0,u.jsx)("ul",(0,a.default)({},P(e)))},t.PLAIN_TEXT_DATA_ATTR=void 0,t.findCopyableChildren=function(e){const t=Array.from(e.querySelectorAll(m));return t.filter((e=>!t.some((t=>t!==e&&t.contains(e)))))},t.getAppTextTemplateData=function(e){return e.dataset[T]},t.getPlainTextData=function(e){return e.dataset[y]},t.getPrePlainTextData=function(e){return e.dataset[S]},t.isCopyable=function(e){return e instanceof HTMLElement&&(0,c.default)(e,m)};var i=n(r(6479)),a=n(r(81109)),s=n(r(94184)),o=r(67294),l=n(r(90935)),c=n(r(3815)),d=r(2541),u=r(85893);const p=["forwardedRef"],h=["element"],f=["plainText","prePlainText","appTextTemplate"],_="copyable-text";t.COPYABLE_CSS_CLASS=_;const m=".copyable-text";t.COPYABLE_CSS_SELECTOR=m;const g="data-plain-text",y=(0,l.default)(g);t.PLAIN_TEXT_DATA_ATTR=y;const E="data-pre-plain-text",S=(0,l.default)(E),v="data-app-text-template",T=(0,l.default)(v);const A=(0,o.forwardRef)(((e,t)=>{var r;let{forwardedRef:n}=e;const s=P((0,i.default)(e,p));return(0,u.jsx)("img",(0,a.default)((0,a.default)({ref:null!=n?n:t},s),{},{alt:null!==(r=s.alt)&&void 0!==r?r:""}))}));function C(e,t){let{element:r}=e,n=(0,i.default)(e,h);return(0,u.jsx)(r,(0,a.default)((0,a.default)({},P(n)),{},{ref:t}))}t.CopyableImg=A;const b=(0,o.forwardRef)(C);function P(e){let{plainText:t,prePlainText:r,appTextTemplate:n}=e,o=(0,i.default)(e,f);const l=(0,a.default)({},o);return l.className=(0,s.default)(o.className,_),null!=t&&(l[g]=t),null!=r&&(l[E]=r),null!=n&&(l[v]=n),l}t.Copyable=b},5354:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(6479)),s=n(r(94184)),o=r(67294),l=r(11933),c=n(r(12783)),d=r(85893);const u=["canCut","children","className"];function p(e,t){let{canCut:r,children:n,className:o}=e,l=(0,a.default)(e,u);const p=(0,i.default)((0,i.default)({},l),{},{className:(0,s.default)(o,c.default.noop,"copyable-area"),onCopy:_,onCut:r?m:void 0});return(0,d.jsx)("div",(0,i.default)((0,i.default)({},p),{},{ref:t,children:n}))}var h=(0,o.forwardRef)(p);function f(e){const t=e.currentTarget;if(!(t instanceof HTMLElement))return!1;const r=l.Clipboard.fromSelection(t,window.getSelection());e.clipboardData.setData("text/plain",r.toPlainString());try{e.clipboardData.setData(l.APP_TEXT_MIMETYPE,r.toAppString())}catch(e){}return!0}function _(e){f(e,window.getSelection())&&(e.stopPropagation(),e.preventDefault())}function m(e){const t=window.getSelection();f(e)&&(t.deleteFromDocument(),e.stopPropagation(),e.preventDefault(),e.target.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})))}t.default=h},52596:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Selectable=t.SELECTABLE_INPUT_CSS_CLASS=t.SELECTABLE_CSS_SELECTOR=t.SELECTABLE_CSS_CLASS=void 0,t.SelectableCode=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableCode,(0,a.default)({},t)):(0,p.jsx)("code",(0,a.default)({},t))},t.SelectableDel=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableDel,(0,a.default)({},t)):(0,p.jsx)("del",(0,a.default)({},t))},t.SelectableDiv=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableDiv,(0,a.default)({},t)):(0,p.jsx)("div",(0,a.default)({},t))},t.SelectableEm=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableEm,(0,a.default)({},t)):(0,p.jsx)("em",(0,a.default)({},t))},t.SelectableImg=void 0,t.SelectableLink=function(e){const t=O(e),r=e.href;if(r&&!u.URL.hasValidUrlScheme(r))return(0,p.jsx)("span",{});return e.selectable?(0,p.jsx)(l.CopyableLink,(0,a.default)({},t)):(0,p.jsx)("a",(0,a.default)({},t))},t.SelectableSpan=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableSpan,(0,a.default)({},t)):(0,p.jsx)("span",(0,a.default)({},t))},t.SelectableStrong=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableStrong,(0,a.default)({},t)):(0,p.jsx)("strong",(0,a.default)({},t))},t.SelectableUl=function(e){const t=O(e);return e.selectable?(0,p.jsx)(l.CopyableUl,(0,a.default)({},t)):(0,p.jsx)("ul",(0,a.default)({},t))},t.createSelectableElement=function(e,t){const r=document.createElement(e);r.setAttribute("class",g),(t||""===t)&&(r.dataset[l.PLAIN_TEXT_DATA_ATTR]=t);return r},t.findSelectAllParent=function(e){if(!C(e))return null;let t,r=e,n=0;for(;r&&n<5;){if(A(r)&&r instanceof HTMLElement){t=r;break}r=r.parentElement,n++}return t},t.findSelectableChildren=function(e,t){if(!(e instanceof HTMLElement))return[];if(t||T(e))return Array.from(e.childNodes);const r=Array.from(e.querySelectorAll(y));return r.filter((e=>!r.some((t=>t!==e&&t.contains(e)))))},t.hasSelectableChildren=function(e){if(!(e instanceof HTMLElement))return!1;return!!e.querySelector(y)},t.isSelectAll=A,t.isSelectable=T;var i=n(r(6479)),a=n(r(81109)),s=n(r(94184)),o=r(67294),l=r(9964),c=n(r(3815)),d=n(r(52204)),u=r(2541),p=r(85893);const h=["forwardedRef"],f=["element"],_=["className","plainText","prePlainText","appTextTemplate","selectable","selectAll"],m="selectable-text";t.SELECTABLE_CSS_CLASS=m;const g=`${l.COPYABLE_CSS_CLASS} selectable-text`,y=".selectable-text";t.SELECTABLE_CSS_SELECTOR=y;const E=g;t.SELECTABLE_INPUT_CSS_CLASS=E;const S="select-all",v=".select-all";function T(e){if(!e)return!1;if(!(e instanceof HTMLElement)){return T(e.parentElement)}return(0,c.default)(e,y)||(0,c.default)(e,".selectable-text *")}function A(e){return!!e&&(e instanceof HTMLElement?(0,c.default)(e,v):A(e.parentElement))}function C(e){return!!e&&(e instanceof HTMLElement?(0,c.default)(e,".select-all *"):C(e.parentElement))}const b=(0,o.forwardRef)(((e,t)=>{var r;let{forwardedRef:n}=e,s=(0,i.default)(e,h);const o=O(s);return s.selectable?(0,p.jsx)(l.CopyableImg,(0,a.default)({forwardedRef:t},o)):(0,p.jsx)("img",(0,a.default)((0,a.default)({ref:t},o),{},{alt:null!==(r=s.alt)&&void 0!==r?r:""}))}));function P(e,t){let{element:r}=e,n=(0,i.default)(e,f);const s=O(n);return n.selectable?(0,p.jsx)(l.Copyable,(0,a.default)((0,a.default)({element:r},s),{},{ref:t})):(0,p.jsx)(r,(0,a.default)((0,a.default)({},s),{},{ref:t}))}t.SelectableImg=b;const M=(0,o.forwardRef)(P);function O(e){let{className:t,plainText:r,prePlainText:n,appTextTemplate:a,selectable:o,selectAll:l}=e;const c=(0,i.default)(e,_);return o&&(c.plainText=r,c.prePlainText=n,c.appTextTemplate=a),c.className=(0,s.default)(t,d.default.noop,{[m]:o,[S]:o&&l}),c}t.Selectable=M},60811:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.REACTION_DETAILS_WIDTH=t.MenuType=t.EMOJI_PICKER_WIDTH=t.Dropdown=t.DirY=t.DirX=void 0;var i=n(r(81109)),a=n(r(45095)),s=n(r(45120)),o=n(r(52013)),l=n(r(94184)),c=r(67294),d=r(88102),u=n(r(11241)),p=n(r(70284)),h=n(r(3222)),f=r(55414),_=n(r(43725)),m=r(85893);const g=parseInt(p.default["-emoji-picker-width"].replace(/px$/,""),10);t.EMOJI_PICKER_WIDTH=g;const y=parseInt(p.default["-reaction-details-width"].replace(/px$/,""),10);t.REACTION_DETAILS_WIDTH=y;t.MenuType={dropdown:"dropdown",dropdown_menu:"dropdown_menu",dropdown_text:"dropdown_text",menu:"menu",picker:"picker",emoji_picker:"emoji_picker",sticker_picker:"sticker_picker",color_picker:"color_picker",tooltip:"tooltip",reaction_details_pane:"reaction_details_pane"};const E=r(54302).Mirrored(["LEFT","CENTER","RIGHT"]);t.DirX=E;const S=r(54302).Mirrored(["TOP","BOTTOM"]);function v(e){switch(e){case E.RIGHT:return E.LEFT;case E.LEFT:return E.RIGHT;case E.CENTER:return E.CENTER}}function T(e,t,r){return e!==E.CENTER||null==t||null==r?null:{left:t.offsetWidth/2-r.offsetWidth/2}}t.DirY=S;class A extends c.Component{constructor(){super(...arguments),this.state={showShortcuts:!1,keyboard:!1,selected:null},this._setRefDropdown=e=>{this._refDropdown=e,this.props.onRef&&this.props.onRef(e)},this._setRefNib=e=>{this._refNib=e},this._setRefList=e=>{this._refList=e},this._floaterEscapeOverlap=()=>{this._refList&&this._refDropdown&&!this.props.isTemporaryRender&&d.Cmd.floaterEscapeOverlap(this._refDropdown,10)},this.handleMouseMove=()=>{o.default.focus(this._refDropdown),this.setState({keyboard:!1})},this._selectPrevious=e=>{C(e);const{activeChildren:t,currentlyFocusedIndex:r}=this._getActiveChildren();0!==t.length&&this._focusNewActiveChild(t,r-1)},this.selectNext=e=>{C(e);const{activeChildren:t,currentlyFocusedIndex:r}=this._getActiveChildren();0!==t.length&&this._focusNewActiveChild(t,r+1)},this._getActiveChildren=()=>{const e=[...(0,a.default)(this._refList,"this._refList").querySelectorAll("li:not(.dropdown-item-disabled)")];return{activeChildren:e,currentlyFocusedIndex:e.indexOf(this.state.selected)}},this._focusNewActiveChild=(e,t)=>{const r=(t<0?e.length-1:t)%e.length;o.default.focus(e[r]),this.setState({keyboard:!0,selected:e[r]})},this.close=e=>{e.preventDefault();const{uim:t}=this.props;t&&t.uie.requestDismiss()},this.default=e=>{const t=this.props.onDefault;if(t){s.default.shouldIndicateFocus();const{uim:r}=this.props;r&&r.uie.requestDismiss(),t(e)}},this._resetSelected=e=>{e.stopPropagation(),o.default.focus(this._refDropdown),this.setState({selected:void 0})}}getElement(){return this._refDropdown}_allowKeyboard(){const e=this.props.type;return"emoji_picker"!==e&&"reaction_details_pane"!==e&&"sticker_picker"!==e&&"color_picker"!==e&&"dropdown_text"!==e}componentDidMount(){if(this._floaterEscapeOverlap(),!this._allowKeyboard())return;const{autoFocus:e,children:t,findFirstItem:r}=this.props;if(e){var n;const e=null===(n=this._refList)||void 0===n?void 0:n.querySelector("[tabindex]");let i;r&&e||this._refList&&this._refList.firstChild instanceof HTMLDivElement&&e?i=e:this._refList&&this._refList.children.length>0?i=this._refList.children[0]:null!=t&&(i=c.Children.toArray(t)[0]),o.default.focus(i),this.setState({keyboard:!0,selected:i})}else o.default.focus(this._refDropdown)}componentDidUpdate(e){e.isTemporaryRender&&!this.props.isTemporaryRender&&this._floaterEscapeOverlap()}getStyle(){var e;const{dirX:t,dirY:r,flipOnRTL:n,origin:a}=this.props,s={},o=null!==(e=this.props.style)&&void 0!==e?e:{},[l,c]=function(e,t,r){return[r&&_.default.isRTL()?v(e):e,t]}(t,r,n);if(s[u.default.prefix("transformOrigin")]=function(e,t){const r=v(e);return`${t===S.TOP?S.BOTTOM:S.TOP} ${r}`}(l,c),!a)return(0,i.default)((0,i.default)({},o),s);const d=function(e,t,r,n){var i,a;const s={};switch(e){case E.RIGHT:s.left=Math.min(window.innerWidth-(null!==(i=null==n?void 0:n.offsetWidth)&&void 0!==i?i:0)-32,r.x);break;case E.LEFT:s.right=window.innerWidth-r.x;break;case E.CENTER:s.left=r.x-(null!==(a=null==n?void 0:n.offsetWidth)&&void 0!==a?a:0)/2,s.marginLeft=0,s.marginRight=0}switch(t){case S.BOTTOM:{s.top=r.y;const e=null==n?void 0:n.offsetHeight;if(null!=e){const t=window.innerHeight-e-32;s.top=Math.min(t,r.y)}break}case S.TOP:s.bottom=window.innerHeight-r.y}return s}(l,c,a,this._refDropdown);return(0,i.default)((0,i.default)((0,i.default)({},o),s),d)}render(){const e=this.props,t=e.type,r=(0,l.default)({[p.default.container]:"dropdown"===t||"dropdown_menu"===t||"emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"dropdown_text"===t,[p.default.right]:"dropdown_menu"===t,[p.default.icons]:"menu"===t,[p.default.picker]:"picker"===t,[p.default.emoji]:"emoji_picker"===t,[p.default.sticker]:"sticker_picker"===t,[p.default.colorPicker]:"color_picker"===t,[p.default.reactionDetails]:"reaction_details_pane"===t,[p.default.text]:"dropdown_text"===t,[p.default.tooltip]:"tooltip"===t,[p.default.inverse]:("picker"===t||"emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"dropdown_text"===t||"tooltip"===t)&&e.dirX===E.LEFT,[p.default.inverseVertical]:("emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"dropdown_text"===t)&&e.dirY===S.TOP}),n="picker"===t||"emoji_picker"===t||"sticker_picker"===t||"dropdown_text"===t||"tooltip"===t?(0,m.jsx)("div",{"data-testid":"tooltip-nib",ref:this._setRefNib,className:p.default.nib,"data-animate-dropdown-nib":!0,style:T(this.props.dirX,this._refDropdown,this._refNib)}):null;if(this._allowKeyboard()){const t={enter:this.default,tab:C,"shift+tab":C,up:()=>{},down:()=>{}};return e.horizontal?(t[_.default.LR("left","right")]=this._selectPrevious,t[_.default.LR("right","left")]=this.selectNext,t[_.default.LR("up","down")]=this._selectPrevious,t[_.default.LR("down","up")]=this.selectNext):(t.up=this._selectPrevious,t.down=this.selectNext,t[_.default.LR("left","right")]=this.close,t[_.default.LR("right","left")]=this.default),(0,m.jsxs)(f.HotKeys,{onRef:this._setRefDropdown,handlers:t,className:r,style:this.getStyle(),onMouseMove:this.state.keyboard?this.handleMouseMove:null,onMouseUp:this._resetSelected,children:[(0,m.jsx)("ul",{ref:this._setRefList,className:p.default.items,children:e.children}),n]})}return(0,m.jsxs)("div",{ref:this._setRefDropdown,className:r,style:this.getStyle(),children:[e.children,n]})}}function C(e){e.stopPropagation(),e.preventDefault()}A.defaultProps={type:"dropdown",dirX:E.RIGHT,dirY:S.BOTTOM},A.displayName="DropdownImpl";const b=(0,h.default)(A);t.Dropdown=b},12591:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalLink=void 0,t.openExternalLink=function(e){if(!c.URL.hasValidUrlScheme(e))return void(e.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${e}`,SEND_LOGS("URL error")));const t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",t.style.display="none",document.body&&document.body.appendChild(t);t.click(),document.body&&document.body.removeChild(t)};var i=n(r(99964)),a=r(67294),s=n(r(69618)),o=(n(r(41523)),n(r(81654))),l=r(3940),c=r(2541),d=r(85893);function u(e){const t=(0,a.useRef)(),r=e=>{var r;(0,o.default)(e)&&(null===(r=t.current)||void 0===r||r.click())},{children:n,className:u,href:p,isLongTemplateUrl:h,onClick:f,a8nText:_,"aria-label":m}=e;return c.URL.hasValidUrlScheme(p)?h?(0,d.jsxs)("a",{ref:t,rel:"noopener noreferrer",className:u,href:p,target:"_blank",onClick:f,onKeyDown:r,"aria-label":m,children:[(0,l.substring)(p,0,s.default.TEMPLATE_URL_START),(0,d.jsx)("span",{children:"…"}),(0,l.substring)(p,p.length-s.default.TEMPLATE_URL_END,p.length)]}):(0,d.jsx)("a",{ref:t,rel:"noopener noreferrer",className:u,href:p,target:"_blank",onClick:f,onKeyDown:r,"data-a8n":i.default.key(_),"aria-label":m,children:n}):(p.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${p}`,SEND_LOGS("URL error")),null)}const p=(0,a.memo)(u);t.ExternalLink=p},24113:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultFavicon=function(e){let{children:t}=e;return(0,n.useEffect)((()=>{(0,i.setTitleAndIcon)(0)}),[]),t},t.ErrorFavicon=function(e){let{children:t}=e;return(0,n.useEffect)((()=>{(0,i.setTitleAndIcon)(-1)}),[]),t};var n=r(67294),i=r(1933)},29623:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FlexContainer=t.FlexColumn=void 0,Object.defineProperty(t,"FlexItem",{enumerable:!0,get:function(){return u.FlexItem}}),t.FlexRow=void 0;var i=n(r(81109)),a=n(r(6479)),s=n(r(99964)),o=n(r(94184)),l=r(67294),c=n(r(56720)),d=r(85893),u=r(48846);const p=["a8nText","align","as","direction","justify","wrap","children","className","xstyle","style"],h={flex:{display:"p357zi0d",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},directionHorizontal:{flexDirection:"sap93d0t"},directionVertical:{flexDirection:"f8m0rgwh"},directionHorizontalReverse:{flexDirection:"v76qf5v1"},directionVerticalReverse:{flexDirection:"qzvtbs9h"},justifyStart:{justifyContent:"fhf7t426"},justifyCenter:{justifyContent:"ac2vgrno"},justifyEnd:{justifyContent:"kcgo1i74"},justifyAll:{justifyContent:"o4u7okr9"},justifyAround:{justifyContent:"j1p1mz06"},justifyEvenly:{justifyContent:"s1e5xcja"},alignCenter:{alignItems:"gndfcl4n"},alignStart:{alignItems:"r15c9g6i"},alignEnd:{alignItems:"r6jd426a"},alignStretch:{alignItems:"elxb2u3l"},alignBaseline:{alignItems:"e4eao3g2"},wrap:{flexWrap:"lkhkxwyq"},wrapReverse:{flexWrap:"ns59xd2u"}},f=(0,l.forwardRef)((function(e,t){const{a8nText:r,align:n="start",as:l="div",direction:u,justify:f="start",wrap:_="nowrap",children:m,className:g,xstyle:y,style:E}=e,S=(0,a.default)(e,p);return(0,d.jsx)(l,(0,i.default)((0,i.default)({className:(0,o.default)((0,c.default)(h.flex,"start"===f&&h.justifyStart,"center"===f&&h.justifyCenter,"end"===f&&h.justifyEnd,"all"===f&&h.justifyAll,"around"===f&&h.justifyAround,"evenly"===f&&h.justifyEvenly,"vertical"===u&&h.directionVertical,"horizontal"===u&&h.directionHorizontal,"vertical-reverse"===u&&h.directionVerticalReverse,"horizontal-reverse"===u&&h.directionHorizontalReverse,"start"===n&&h.alignStart,"center"===n&&h.alignCenter,"end"===n&&h.alignEnd,"stretch"===n&&h.alignStretch,"baseline"===n&&h.alignBaseline,"wrap"===_&&h.wrap,"wrap-reverse"===_&&h.wrapReverse,y),g),ref:t,style:E,"data-a8n":s.default.key(r)},S),{},{children:m}))}));t.FlexContainer=f,f.displayName="FlexContainer";const _=(0,l.forwardRef)((function(e,t){return(0,d.jsx)(f,(0,i.default)((0,i.default)({},e),{},{direction:"horizontal",ref:t,children:e.children}))}));t.FlexRow=_,_.displayName="FlexRow";const m=(0,l.forwardRef)((function(e,t){return(0,d.jsx)(f,(0,i.default)((0,i.default)({},e),{},{direction:"vertical",ref:t,children:e.children}))}));t.FlexColumn=m,m.displayName="FlexColumn"},48846:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FlexItem=void 0;var i=n(r(81109)),a=r(67294),s=n(r(56720)),o=n(r(21790)),l=r(85893);const c={flexItem:{flexGrow:"tvf2evcx",flexShrink:"m0h2a7mj",flexBasis:"lb5m6g5c",order:"j7l1k36l",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},alignAuto:{alignSelf:"gjuq5ydh"},alignStart:{alignSelf:"ex3gcxaf"},alignCenter:{alignSelf:"o2es7gts"},alignEnd:{alignSelf:"rwlvdxyg"},alignStretch:{alignSelf:"l33m68ws"}},d=(0,a.forwardRef)((function(e,t){const{a8nText:r,align:n="auto",as:a="div",basis:d,xstyle:u,children:p,order:h,grow:f,shrink:_,style:m}=e,g={flexBasis:"string"==typeof d||null==d?d:`${d}px`,flexGrow:f,flexShrink:_,order:h};return(0,l.jsx)(a,{className:(0,s.default)(c.flexItem,"auto"===n&&c.alignAuto,"start"===n&&c.alignStart,"center"===n&&c.alignCenter,"end"===n&&c.alignEnd,"stretch"===n&&c.alignStretch,u),"data-a8n":r,ref:t,style:(0,i.default)((0,i.default)({},m),(0,o.default)(g)),children:p})}));t.FlexItem=d,d.displayName="FlexItem"},81559:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){const n=(0,s.default)(e),{leading:o,trailing:l,maxWait:c}=null!=r?r:{},d=(0,a.useMemo)((()=>(0,i.default)(n,t,r)),[t,o,c,l,n]);return(0,a.useEffect)((()=>d.cancel),[d]),d};var i=n(r(23279)),a=r(67294),s=n(r(83800))},97056:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e,t]=(0,n.useState)(!1),r=(0,a.useFocusVisibility)();return[(0,i.useFocus)({onFocusChange:t}),e&&r]};var n=r(67294),i=r(60480),a=r(22885)},59909:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[,e]=(0,n.useReducer)((e=>e+1),0);return e};var n=r(67294)},98007:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const{immediate:n=!1}=null!=r?r:{},s=(0,a.default)(e),o=(0,i.useRef)(),l=(0,i.useCallback)((()=>{o.current&&clearInterval(o.current)}),[]),c=(0,i.useCallback)((()=>{l(),o.current=setInterval(s,t)}),[l,t,s]);return(0,i.useEffect)((()=>(n&&c(),l)),[n,c,l]),[c,l]};var i=r(67294),a=n(r(83800))},88624:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,n.useRef)(!1);(0,n.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]);return(0,n.useCallback)((()=>e.current),[])};var n=r(67294)},19529:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.useAddListenerOnce=function(){const e=(0,s.useRef)(),t=(0,s.useCallback)(((t,r,n,a)=>{e.current=c(t,r,n,(0,i.default)((0,i.default)({},a),{},{once:!0}))}),[]),r=(0,s.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.call(e)}),[]);return(0,s.useEffect)((()=>r),[r]),[t,r]},t.useListener=function(e,t,r,n){const i=(0,l.default)(r),a=d(t);(0,s.useLayoutEffect)((()=>{if(null!=r)return c(e,t,i,n)}),[e,null==r,a])},t.useListeners=function(e){const t=e.map((e=>{let{callback:t}=e;return t})),r=(0,s.useRef)(t);r.current=t;const n=e.map((e=>{let{source:t,eventOrEvents:r}=e;return`${(0,a.default)(t)},${d(r)}`})).join("-");(0,s.useLayoutEffect)((()=>{const t=e.map(((e,t)=>{let{source:n,eventOrEvents:i,opts:a}=e;return c(n,i,(function(){for(var e,n,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return null===(e=(n=r.current)[t])||void 0===e?void 0:e.call(n,...a)}),a)}));return()=>t.forEach((e=>e()))}),[n])};var i=n(r(81109)),a=n(r(32176)),s=r(67294),o=r(59923),l=n(r(83800));function c(e,t,r,n){if(null==e)return()=>{};const i=function(e,t){if(Array.isArray(t))return(0,o.isEventsType)(e)?[t.join(" ")]:t;return[t]}(e,t).map((t=>new o.Listener(e,t,(function(){(null==n?void 0:n.once)&&a(),r(...arguments)}),n)));i.forEach((e=>{e.engage()}));const a=()=>{i.forEach((e=>{e.disengage()}))};return a}function d(e){return Array.isArray(e)?e.join("\0"):e}},41104:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(48313).useMergeRefs;t.default=n},41502:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.useRef)();return(0,n.useEffect)((()=>{t.current=e})),t.current};var n=r(67294)},83800:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,n.useRef)(e);t.current=e;return(0,n.useCallback)((function(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(e=t.current)||void 0===e?void 0:e.call(t,...n)}),[])};var n=r(67294)},60265:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r;const n=(0,i.useRef)(),o=!0===(null==t?void 0:t.disabled),l=o?s:e;return[e=>{n.current=e},{"aria-disabled":null!==(r=null==t?void 0:t.disabled)&&void 0!==r?r:void 0,onClick:l,onKeyPress:function(e){var t;(0,a.default)(e)&&(e.stopPropagation(),e.preventDefault(),null===(t=n.current)||void 0===t||t.click())},role:"button",tabIndex:o?-1:0}]};var i=r(67294),a=n(r(81654));function s(){}},99935:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.useManualTimeout=s,t.useTimeout=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const{immediate:n=!1}=null!=r?r:{},[a,o]=s(e),l=(0,i.useCallback)((()=>a(t)),[a,t]);return(0,i.useEffect)((()=>{n&&l()}),[n,l]),[l,o]};var i=r(67294),a=n(r(83800));function s(e){const t=(0,a.default)(e),r=(0,i.useRef)(),n=(0,i.useCallback)((()=>{r.current&&clearTimeout(r.current)}),[]),s=(0,i.useCallback)((e=>{n(),r.current=setTimeout(t,e)}),[n,t]);return(0,i.useEffect)((()=>n),[n]),[s,n]}},38080:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e]=(0,i.useState)((()=>new a.default));return(0,i.useEffect)((()=>()=>e.abort()),[e]),e.signal};var i=r(67294),a=n(r(70714))},47065:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),s=r(50796),o=r(67294),l=i(r(69618)),c=n(r(64103)),d=i(r(97827)),u=i(r(72668)),p=r(52596),h=i(r(90012)),f=r(2541),_=r(85893);const m=new u.default;class g extends o.Component{static getDerivedStateFromProps(e,t){return e.src!==t.src?{src:e.src,available:!0}:null}constructor(e){super(e),this._refNative=(0,o.createRef)(),this.getElement=()=>this._refNative.current,this.handleLoad=e=>{const{target:t}=e;if(t instanceof HTMLImageElement){const e=this.getImgElement();(null==e?void 0:e.complete)&&this._showImgElement(e),this.props.onLoad&&this.props.onLoad({target:t}),this.setState({loading:!1})}},this.handleError=e=>{this.setState({available:!1});const{src:t,crossOrigin:r,noXHR:n,hasPrivacyChecks:i}=this.props;if(!t||!function(e){return"/"===e[0]||f.URL.isHttp(e)}(t))return void this.setState({error:e.error});const o=this.retry;let l;if(o)if(y(o,this.props)){if(!o.noXHR)return;l=o}else{o.release()&&m.remove(o),l=new d.default(t,r,n,i)}else l=new d.default(t,r,n,i);this.retry=l;const u=m.enqueue(l),p=this.props.getUnmountSignal();u.then((()=>{l===this.retry&&(p.aborted||this.setState({available:!0}))})).catch((0,s.filteredCatch)([c.ServerStatusError,c.GaveUpRetry],(e=>{l===this.retry&&(p.aborted||(this.setState({available:!1,error:e}),this.props.onError&&this.props.onError(e)))}))).catch((0,s.filteredCatch)(c.Unmount,(()=>{}))).catch((0,a.catchAbort)((()=>{})))},this.handleContextMenu=e=>{this.props.disableContextMenu&&e.preventDefault()},this.state={src:e.src,available:!0,error:null,loading:!0}}componentDidMount(){if(!this.props.src)return;const e=this.getImgElement();e&&!e.complete&&this._hideImgElement(e)}componentDidUpdate(e){if(y(e,this.props)||this._cancelRetry(),!this.props.src)return;const t=this.getImgElement();t&&!t.complete&&this._hideImgElement(t)}componentWillUnmount(){this._cancelRetry()}_cancelRetry(){if(this.retry){const e=this.retry;e.release()&&m.remove(e)}}getImgElement(){return this._refNative.current}_showImgElement(e){"visible"!==e.style.visibility&&(e.style.visibility="visible")}_hideImgElement(e){"hidden"!==e.style.visibility&&(e.style.visibility="hidden")}render(){const{alt:e,className:t,crossOrigin:r,draggable:n,onClick:i,onMouseMove:a,plainText:s,selectable:o,src:c,style:d,renderLoading:u,renderError:h}=this.props,{available:f,error:m,loading:g}=this.state;if(m&&h)return h(m);const y=Boolean(f&&c);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(p.SelectableImg,{ref:this._refNative,plainText:s||"",selectable:Boolean(o),crossOrigin:r?"anonymous":void 0,onError:y?this.handleError:()=>{},onLoad:y?this.handleLoad:()=>{},src:y&&null!=c?c:l.default.ONE_BY_ONE_TRANS_GIF,alt:e,className:t,draggable:n,onClick:i,onMouseMove:a,style:d,onContextMenu:this.handleContextMenu}),g&&u&&u()]})}}function y(e,t){return e.src===t.src&&e.crossOrigin===t.crossOrigin&&e.noXHR===t.noXHR&&e.hasPrivacyChecks===t.hasPrivacyChecks}g.defaultProps={crossOrigin:!0,noXHR:!1,hasPrivacyChecks:!0},g.displayName="Img";var E=(0,h.default)(g);t.default=E},97827:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),s=r(38284),o=(r(88156),i(r(70714))),l=n(r(64103)),c=i(r(11339)),d=i(r(64386));t.default=class{constructor(e,t,r,n){this.src=e,this.crossOrigin=t,this.noXHR=r,this.hasPrivacyChecks=n,this.generation=0,this.refCount=0,this.inProgress=!1}key(){return`co:${this.crossOrigin?"Y":"N"},noXHR:${this.noXHR?"Y":"N"},src:${this.src}`}sendXHR(){if(this.noXHR)return Promise.resolve(!0);const e=this.src;this.inProgress=!0;const t=new o.default,r=(0,s.promiseTimeout)(d.default.get(e,void 0,void 0,t.signal),3e4,"ImgRetryTimeout");return this._xhrRequest={promise:r,controller:t},this._xhrRequest.promise.then((t=>{const{status:r}=t;if(r>=200&&r<400)return!0;if(r>=500){__LOG__(2)`Img:Retry ${e} failed with error code ${r}. Retrying.`;return new c.default.WebcImgError({webcImgErrorCode:r}).commit(),!1}__LOG__(2)`Img:Retry ${e} failed with error code ${r}. Not retrying.`;throw new c.default.WebcImgError({webcImgErrorCode:r}).commit(),new l.ServerStatusError(null,e,r)})).catch((e=>{if(e instanceof l.ServerStatusError)throw e;if(e.name===a.ABORT_ERROR)throw e;return!1})).finally((()=>{this.inProgress=!1}))}release(){return this.refCount--,this.refCount<=0&&(this._xhrRequest&&this._xhrRequest.controller.abort(),!0)}shouldRetain(){return this.refCount>0}}},72668:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),s=i(r(45095)),o=r(88156),l=i(r(70714)),c=n(r(64103)),d=r(50338),u=i(r(57220)),p=i(r(84644)),h=n(r(22906));class f{constructor(){this._queue=new Map,this._inDelay=new Map,this._numInProgress=0}static maxInProgressRetry(){return 20}enqueue(e){const t=this._queue.get(e.key());if(t){if(e.hasPrivacyChecks!==t.hasPrivacyChecks){const t=`Img:hasPrivacyChecks shouldn't change ${e.key()}`;return Promise.reject(t)}return t.refCount++,t.deferred.promise}return e.deferred=new o.Resolvable,e.refCount++,this._addToQueue(e),e.deferred.promise}remove(e){const t=e.key();this._queue.delete(t);const r=this._inDelay.get(t);r&&(r.controller.abort(),this._inDelay.delete(t))}_addToQueue(e){const t=e.generation;if(e.generation++,t>10){const t=`Stop retrying ${e.src} after 10 times`;throw new c.GaveUpRetry(t)}const r=e.key();if(0===t)this._queue.set(r,e),this._startProcessing();else{const n=new l.default,i=n.signal,s=(0,p.default)(h.expDelaySec(t,60,0),i).catch((0,a.catchAbort)((()=>{})));this._inDelay.set(e.key(),{promise:s,controller:n}),s.then((()=>{this._inDelay.delete(r),i.aborted||this._queue.set(r,e),this._startProcessing()}))}}_startProcessing(){this._waitPromise||(this._waitPromise=u.default.waitIfOffline({signal:(new l.default).signal}).then((()=>{this._waitPromise=null,d.UIBusyTasks.enqueue((()=>{this._processRetries()}))})))}_processRetries(){const e=this._queue.values();let t;for(;(t=e.next())&&!t.done&&!(this._numInProgress>f.maxInProgressRetry());){const e=t.value;this._processRetry((0,s.default)(e,"retry"))}}_processRetry(e){e.inProgress||(e.deferred.resolveWasCalled()?this._queue.delete(e.key()):(this._numInProgress++,e.sendXHR().then((t=>{this._queue.delete(e.key()),t?e.deferred.resolve():e.shouldRetain()&&this._addToQueue(e)})).catch((t=>{this._queue.delete(e.key()),e.deferred.reject(t)})).finally((()=>{this._numInProgress--}))))}}t.default=f},87956:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RotateFocus=t.FocusType=void 0;var i=n(r(45120)),a=n(r(52013)),s=r(67294),o=n(r(54392)),l=n(r(64312)),c=r(42473),d=r(85893);const u=c.FocusType;function p(e,t){const{focusType:r}=e,n=(0,s.useRef)(null),u=()=>n.current;return(0,s.useImperativeHandle)(t,(()=>({getElement:u}))),(0,d.jsx)("div",{ref:n,style:e.style,className:l.default.container,onKeyDown:e=>{if(e.metaKey||e.ctrlKey)return;const t=n.current;let s;var l;(e.key===o.default.KEYBOARD_EVENT_KEY_VALUE.TAB?(e.stopPropagation(),e.preventDefault(),i.default.shouldIndicateFocus(),null!=t&&(s=(0,c.getNextTabbableElement)(t,e.shiftKey?c.TabDirection.BACKWARD:c.TabDirection.FORWARD,r))):null!=t&&t===document.activeElement&&(s=(0,c.getNextTabbableElement)(t,c.TabDirection.FORWARD,r,(e=>"input"===e.nodeName.toLowerCase()))),null!=s)&&(i.default.shouldIndicateFocus(),(l=s).restoreFocus?l.restoreFocus():a.default.focus(l))},tabIndex:"-1",children:e.children})}t.FocusType=u;const h=(0,s.forwardRef)(p);t.RotateFocus=h},22179:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(67294),a=n(r(54392)),s=n(r(95642)),o=r(42473),l=r(85893);function c(e,t){const r=(0,i.useRef)(null),n=()=>r.current;return(0,i.useImperativeHandle)(t,(()=>({getElement:n}))),(0,l.jsx)("div",{ref:r,className:s.default.container,onKeyDown:e=>{if(!e.metaKey&&!e.ctrlKey)return e.key===a.default.KEYBOARD_EVENT_KEY_VALUE.TAB?(e=>{const t=r.current;if(!t)return;const n=e.shiftKey?o.TabDirection.BACKWARD:o.TabDirection.FORWARD,i=(0,o.getNextTabbableElement)(t,n,o.FocusType.TABBABLE);null!=i&&(e.preventDefault(),i.focus())})(e):void 0},tabIndex:"-1",onBlur:e.onBlur,role:"dialog",children:e.children})}var d=(0,i.forwardRef)(c);t.default=d},42473:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TabDirection=t.FocusType=void 0,t.getNextTabbableElement=function(e){let t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.FORWARD,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.CUSTOM,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>!0;d===s.TABBABLE?(t=(0,a.tabbable)(e),r=()=>!0):(t=(0,i.default)(Array.from(e.querySelectorAll("[data-tab]")),(e=>parseInt(e.getAttribute("data-tab"),10)||0)),r=c);const p=n===o.FORWARD?1:-1;let h=0;const{activeElement:f}=document;if(f){const e=t.findIndex((e=>e.contains(f)));h=-1===e?0:l(e+p,t.length)}for(let e=0;e<t.length;e++){const n=l(h+e*p,t.length),i=t[n];if(r(i)&&u(i))return i}return null};var i=n(r(89734)),a=r(88388);const s=r(54302).Mirrored(["CUSTOM","TABBABLE"]);t.FocusType=s;const o=r(54302).Mirrored(["FORWARD","BACKWARD"]);function l(e,t){return(e+t)%t}function c(e){if(e.disabled)return!1;const t=parseInt(e.dataset.tab,10);return!("number"!=typeof t||t<0)&&!function(e){if("hidden"===getComputedStyle(e).visibility)return!0;let t=e;for(;t;){if("none"===getComputedStyle(t).display)return!0;t=t.parentElement}return!1}(e)}t.TabDirection=o},56074:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41609)),a=r(67294),s=n(r(43725)),o=r(52596),l=r(85893);const c=/(.*?)__(\w+?)__/g;function d(e){const{onClick:t,wrapInHiddenToken:r,id:n,plural:d,params:u,className:p,tabIndex:h}=e;return(0,l.jsx)(o.SelectableSpan,{dir:s.default.isRTL()?"rtl":"ltr",selectable:!r,onClick:t,className:p,tabIndex:h,children:(()=>{const e=s.default.t(n,{_plural:d});if(!u||(0,i.default)(u))return e;let t,r;const o=[];for(;t=c.exec(e);){const e=t;o.push(e[1]);const n=e[2];if(n&&null!=u[n]){const e=Array.isArray(u[n])?u[n].map(((e,t)=>(0,l.jsx)(a.Fragment,{children:e},`child_${t}`))):(0,l.jsx)(a.Fragment,{children:u[n]},n);o.push(e)}r=e.index+e[0].length}return"number"==typeof r&&r<e.length&&o.push(e.slice(r)),0===o.length?e:o})()})}d.defaultProps={wrapInHiddenToken:!0};var u=d;t.default=u},24161:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(22074)),a=r(85893);t.default=e=>{let{max:t=100,value:r}=e;return(0,a.jsx)("progress",{value:r,max:t,className:i.default.progress})}},28828:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,a.useRef)(null),[t,r]=(0,a.useState)(g.FIRST_OPEN),n=(0,u.default)();(0,p.useListener)(window,"dpichange",(()=>{n()}));const E=()=>{r(g.READY)},S=e=>{r(g.LOADING),e.stopPropagation(),e.preventDefault()},v=()=>{r(g.REPLAY);const t=e.current;t&&t.play()};let T,A;t===g.FIRST_OPEN&&(T=(0,f.jsx)("div",{className:l.default.overlay,children:(0,f.jsx)(c.Spinner,{size:32})}),A=E);const C=t===g.FIRST_OPEN||t===g.READY||t===g.LOADING?(0,f.jsx)(o.default,{className:(0,i.default)(l.default.poster,{[l.default.hidden]:t===g.FIRST_OPEN}),src:m[s.default.currentRes],onLoad:A},"poster"):null;let b,P;const M=_[s.default.currentRes],O=t!==g.FIRST_OPEN&&t!==g.READY?(0,f.jsx)("video",{autoPlay:!0,className:l.default.player,controls:!0,controlsList:"nodownload",onCanPlayThrough:()=>{t===g.LOADING&&r(g.FIRST_PLAY)},onEnded:()=>{r(g.ENDED)},ref:e,children:(0,f.jsx)("source",{src:M,type:"video/mp4"})},s.default.currentRes):null;switch(t){case g.READY:P=S,b=(0,f.jsx)(y,{});break;case g.LOADING:b=(0,f.jsx)(c.Spinner,{color:"white",size:32});break;case g.ENDED:P=v,b=(0,f.jsx)(d.default,{name:"refresh-large"});break;default:b=null,P=null}const I=b?(0,f.jsx)("div",{className:l.default.overlay,role:"button",onClick:P,children:(0,f.jsx)("div",{className:l.default.button,children:b})}):null;return(0,f.jsx)("div",{className:l.default.video,children:(0,f.jsxs)("div",{className:l.default.container,children:[(0,f.jsxs)(h.default,{transitionName:"fade",children:[T,I,C]}),O]})})};var i=n(r(94184)),a=r(67294),s=n(r(3309)),o=n(r(47065)),l=n(r(73176)),c=r(11054),d=n(r(23217)),u=n(r(59909)),p=r(19529),h=n(r(41956)),f=r(85893);const _={low:r(15109),high:r(26252)},m={low:r(15767),high:r(77152)},g=r(54302).Mirrored(["FIRST_OPEN","READY","LOADING","FIRST_PLAY","ENDED","REPLAY"]);const y=()=>(0,f.jsx)("div",{className:l.default.play,children:(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"34",viewBox:"0 0 28 34",children:(0,f.jsx)("path",{fill:"#FFF",d:"M1 4.983v24.034a2.982 2.982 0 0 0 4.564 2.53L24.792 19.53a2.981 2.981 0 0 0 0-5.058L5.563 2.454A2.983 2.983 0 0 0 1 4.983z"})})})},22028:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t,r]=(0,c.useState)(y.getRememberMe),[n]=(0,c.useState)((()=>!!(0,y.getShowMdUpgradeCompleteMsg)())),[i]=(0,c.useState)((()=>!!(0,y.getForcedMdUpgradeComplete)())),[a,s]=(0,c.useState)(k.Socket.state===k.STATE.UNPAIRED_IDLE),[o,d]=(0,c.useState)(!A.default.online),[p,f]=(0,c.useState)(k.Socket.state===k.STATE.UNPAIRED);(0,D.useListener)(k.Socket,"change:state change:online",(()=>{s(k.Socket.state===k.STATE.UNPAIRED_IDLE),d(!A.default.online),f(k.Socket.state===k.STATE.UNPAIRED)})),(0,c.useEffect)((()=>{}),[]);const _=()=>{E.GK.supportsFeature(E.GK.F.MD_BACKEND)?h.Cmd.refreshQR():k.Socket.poke()};let S;S=o?(0,U.jsx)(F,{children:(0,U.jsxs)("div",{className:P.default.qrButton,children:[(0,U.jsx)("div",{className:P.default.qrButtonIcon,children:(0,U.jsx)(w.default,{name:"connection"})}),v.default.t(296)]},"expiry")}):a?(0,U.jsx)(F,{children:(0,U.jsxs)("button",{className:P.default.qrButton,onClick:_,children:[(0,U.jsx)("div",{className:P.default.qrButtonIcon,children:(0,U.jsx)(w.default,{name:"refresh-large"})}),v.default.t(736)]},"expiry")}):p?(0,U.jsx)(F,{}):(0,U.jsx)("div",{className:P.default.qrcode,children:(0,U.jsx)(I.Spinner,{})});const C=t?null:(0,U.jsx)("div",{className:(0,l.default)(P.default.tip,P.default.rememberMeTip),children:v.default.t(627)});let b;if(e.apiCmd)switch(e.apiCmd.resultType){case u.APICmd.GROUP_INVITE:b=(0,U.jsx)("div",{className:P.default.groupInviteTip,children:(0,U.jsx)("div",{className:P.default.tip,children:v.default.t(554)})});break;case u.APICmd.MSG_SEND:b=(0,U.jsx)("div",{className:P.default.groupInviteTip,children:(0,U.jsx)("div",{className:P.default.tip,children:v.default.t(868)})})}const M=(0,U.jsx)("strong",{children:(0,U.jsx)(T.default,{id:735,params:{android_menu_icon:(0,U.jsx)(x,{})}})}),O=(0,U.jsx)("strong",{children:(0,U.jsx)(T.default,{id:738,params:{iphone_settings_icon:(0,U.jsx)(B,{})}})}),R=(0,U.jsx)("strong",{children:v.default.t(746)}),Y=(0,U.jsx)(T.default,{id:740,params:{android_menu:M,iphone_settings:O,whatsapp_web_menu_item:R}}),j=(0,U.jsx)("strong",{children:v.default.t(743)}),W=(0,U.jsx)(T.default,{id:742,params:{login_step_3_md_link_device:j}}),H=n||i||(0,y.mdOptedIn)();let V,$;n&&($=(0,U.jsx)("div",{className:"landing-header-upgradeCompleteText",children:v.default.t(770)}));i&&($=(0,U.jsx)("div",{className:"landing-header-upgradeCompleteText",children:v.default.t(757)}));V=(0,U.jsxs)("div",{className:"landing-header",children:[(0,U.jsx)(K,{}),(0,U.jsx)("div",{className:"landing-headerTitle",children:v.default.t(745)})]});let z=(0,U.jsx)(G.default,{});return(0,U.jsxs)("div",{className:"landing-wrapper",children:[V," ",$,(0,U.jsxs)("div",{className:"landing-window",children:[(0,U.jsx)("div",{className:"landing-main",children:(0,U.jsxs)("div",{className:P.default.qrWrapper,children:[(0,U.jsxs)("div",{className:P.default.text,children:[(0,U.jsx)("div",{className:(0,l.default)("landing-title",P.default.headline),children:v.default.t(744)}),(0,U.jsxs)("ol",{className:P.default.list,children:[(0,U.jsx)("li",{className:P.default.listItem,children:v.default.t(739)}),(0,U.jsx)("li",{className:P.default.listItem,children:Y}),H&&(0,U.jsx)("li",{className:P.default.listItem,children:W}),(0,U.jsx)("li",{className:P.default.listItem,children:v.default.t(741)})]})]}),(0,U.jsxs)("div",{className:P.default.qr,children:[b,S]}),(0,U.jsx)(m.ExternalLink,{href:(0,g.getLoginFaqUrl)(),className:P.default.hint,children:v.default.t(737)}),E.GK.supportsFeature(E.GK.F.MD_BACKEND)?null:(0,U.jsxs)("div",{className:P.default.toggle,children:[(0,U.jsx)(N.default,{transitionName:"fade_sifo",children:C}),(0,U.jsxs)("label",{children:[(0,U.jsx)("input",{type:"checkbox",name:"rememberMe",checked:t,onChange:e=>{k.Socket.isIncognito||L.default.setRememberMe(e.target.checked).catch((()=>{})),(0,y.setRememberMe)(e.target.checked),r((0,y.getRememberMe)())}}),v.default.t(807)]})]})]})}),z,undefined,undefined]})]})};var a=i(r(48926)),s=r(15688),o=i(r(99964)),l=i(r(94184)),c=r(67294),d=r(24863),u=r(88711),p=i(r(87045)),h=r(88102),f=(i(r(52665)),r(17239)),_=i(r(69618)),m=r(12591),g=r(96384),y=r(99234),E=r(7293),S=r(14111),v=i(r(43725)),T=i(r(56074)),A=i(r(57220)),C=i(r(14528)),b=i(r(37360)),P=i(r(3306)),M=n(r(16413)),O=(r(52596),r(11849)),I=r(11054),w=i(r(23217)),R=i(r(81559)),D=r(19529),N=i(r(41956)),L=i(r(56891)),k=r(65044),G=i(r(28828)),U=r(85893);function F(e){const t=e.children,[r,n]=(0,c.useState)(!1),i=(0,R.default)((()=>{n(!0)}),100),u=(0,c.useRef)(null),m=(0,c.useRef)(null),g=()=>{if(f.Conn.connected)return Promise.resolve(void 0);const e=f.Conn.ref;if(E.GK.supportsFeature(E.GK.F.MD_BACKEND))return O.waSignalStore.getRegistrationInfo().then(function(){var t=(0,a.default)((function*(t){const r=yield S.waNoiseInfo.get();if(!r||!r.staticKeyPair||!t)return __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Empty noiseInfo or empty regInfo"),null;const n=(0,s.encodeB64)(r.staticKeyPair.pubKey),i=(0,s.encodeB64)(t.identityKeyPair.pubKey),a=(0,d.getADVSecretKey)();return e+","+n+","+i+","+a}));return function(){return t.apply(this,arguments)}}());{const t=p.default.id();return Promise.resolve().then((()=>{const r=M.getOrGenerate();return e+","+r+","+t}))}},y=function(){var e=(0,a.default)((function*(){const e=u.current,t=m.current;if(null==e)return Promise.resolve();const r=yield g();r&&(C.default.inc(),t?t.makeCode(r):m.current=new b.default(e,{text:r,colorDark:"#122e31",width:_.default.QR_EDGE,height:_.default.QR_EDGE,correctLevel:b.default.CorrectLevel.L}),e.removeAttribute("title"),e.setAttribute("data-ref",r))}));return function(){return e.apply(this,arguments)}}();(0,D.useListener)(f.Conn,"change:ref",y),(0,c.useEffect)((()=>(y(),h.Cmd.initialLoadReady(),()=>{C.default.reset()})),[]);const v=(0,l.default)(P.default.qrcode,{[P.default.idle]:!!t}),T=r&&null==t?{cursor:"none"}:null;return(0,U.jsxs)("div",{ref:u,"data-a8n":o.default.key("qrcode"),className:v,onContextMenu:null,style:T,onMouseMove:()=>{r&&n(!1),i()},onMouseLeave:()=>{i.cancel(),n(!1)},children:[(0,U.jsx)(N.default,{transitionName:"scale",children:t}),(0,U.jsx)("div",{className:P.default.codeLogo,children:(0,U.jsx)(Y,{})})]})}const x=()=>(0,U.jsx)("span",{className:P.default.icon,children:(0,U.jsxs)("svg",{height:"24px",viewBox:"0 0 24 24",width:"24px",children:[(0,U.jsx)("rect",{fill:"#f2f2f2",height:"24",rx:"3",width:"24"}),(0,U.jsx)("path",{d:"m12 15.5c.825 0 1.5.675 1.5 1.5s-.675 1.5-1.5 1.5-1.5-.675-1.5-1.5.675-1.5 1.5-1.5zm0-2c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5zm0-5c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5z",fill:"#818b90"})]})}),B=()=>(0,U.jsx)("span",{className:P.default.icon,children:(0,U.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[(0,U.jsx)("rect",{fill:"#F2F2F2",width:"24",height:"24",rx:"3"}),(0,U.jsx)("path",{d:"M12 18.69c-1.08 0-2.1-.25-2.99-.71L11.43 14c.24.06.4.08.56.08.92 0 1.67-.59 1.99-1.59h4.62c-.26 3.49-3.05 6.2-6.6 6.2zm-1.04-6.67c0-.57.48-1.02 1.03-1.02.57 0 1.05.45 1.05 1.02 0 .57-.47 1.03-1.05 1.03-.54.01-1.03-.46-1.03-1.03zM5.4 12c0-2.29 1.08-4.28 2.78-5.49l2.39 4.08c-.42.42-.64.91-.64 1.44 0 .52.21 1 .65 1.44l-2.44 4C6.47 16.26 5.4 14.27 5.4 12zm8.57-.49c-.33-.97-1.08-1.54-1.99-1.54-.16 0-.32.02-.57.08L9.04 5.99c.89-.44 1.89-.69 2.96-.69 3.56 0 6.36 2.72 6.59 6.21h-4.62zM12 19.8c.22 0 .42-.02.65-.04l.44.84c.08.18.25.27.47.24.21-.03.33-.17.36-.38l.14-.93c.41-.11.82-.27 1.21-.44l.69.61c.15.15.33.17.54.07.17-.1.24-.27.2-.48l-.2-.92c.35-.24.69-.52.99-.82l.86.36c.2.08.37.05.53-.14.14-.15.15-.34.03-.52l-.5-.8c.25-.35.45-.73.63-1.12l.95.05c.21.01.37-.09.44-.29.07-.2.01-.38-.16-.51l-.73-.58c.1-.4.19-.83.22-1.27l.89-.28c.2-.07.31-.22.31-.43s-.11-.35-.31-.42l-.89-.28c-.03-.44-.12-.86-.22-1.27l.73-.59c.16-.12.22-.29.16-.5-.07-.2-.23-.31-.44-.29l-.95.04c-.18-.4-.39-.77-.63-1.12l.5-.8c.12-.17.1-.36-.03-.51-.16-.18-.33-.22-.53-.14l-.86.35c-.31-.3-.65-.58-.99-.82l.2-.91c.03-.22-.03-.4-.2-.49-.18-.1-.34-.09-.48.01l-.74.66c-.39-.18-.8-.32-1.21-.43l-.14-.93a.426.426 0 00-.36-.39c-.22-.03-.39.05-.47.22l-.44.84-.43-.02h-.22c-.22 0-.42.01-.65.03l-.44-.84c-.08-.17-.25-.25-.48-.22-.2.03-.33.17-.36.39l-.13.88c-.42.12-.83.26-1.22.44l-.69-.61c-.15-.15-.33-.17-.53-.06-.18.09-.24.26-.2.49l.2.91c-.36.24-.7.52-1 .82l-.86-.35c-.19-.09-.37-.05-.52.13-.14.15-.16.34-.04.51l.5.8c-.25.35-.45.72-.64 1.12l-.94-.04c-.21-.01-.37.1-.44.3-.07.2-.02.38.16.5l.73.59c-.1.41-.19.83-.22 1.27l-.89.29c-.21.07-.31.21-.31.42 0 .22.1.36.31.43l.89.28c.03.44.1.87.22 1.27l-.73.58c-.17.12-.22.31-.16.51.07.2.23.31.44.29l.94-.05c.18.39.39.77.63 1.12l-.5.8c-.12.18-.1.37.04.52.16.18.33.22.52.14l.86-.36c.3.31.64.58.99.82l-.2.92c-.04.22.03.39.2.49.2.1.38.08.54-.07l.69-.61c.39.17.8.33 1.21.44l.13.93c.03.21.16.35.37.39.22.03.39-.06.47-.24l.44-.84c.23.02.44.04.66.04z",fill:"#818b90"})]})}),K=()=>(0,U.jsx)("span",{className:P.default.icon,children:(0,U.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"39",height:"39",viewBox:"0 0 39 39",children:[(0,U.jsx)("path",{fill:"#00E676",d:"M10.7 32.8l.6.3c2.5 1.5 5.3 2.2 8.1 2.2 8.8 0 16-7.2 16-16 0-4.2-1.7-8.3-4.7-11.3s-7-4.7-11.3-4.7c-8.8 0-16 7.2-15.9 16.1 0 3 .9 5.9 2.4 8.4l.4.6-1.6 5.9 6-1.5z"}),(0,U.jsx)("path",{fill:"#FFF",d:"M32.4 6.4C29 2.9 24.3 1 19.5 1 9.3 1 1.1 9.3 1.2 19.4c0 3.2.9 6.3 2.4 9.1L1 38l9.7-2.5c2.7 1.5 5.7 2.2 8.7 2.2 10.1 0 18.3-8.3 18.3-18.4 0-4.9-1.9-9.5-5.3-12.9zM19.5 34.6c-2.7 0-5.4-.7-7.7-2.1l-.6-.3-5.8 1.5L6.9 28l-.4-.6c-4.4-7.1-2.3-16.5 4.9-20.9s16.5-2.3 20.9 4.9 2.3 16.5-4.9 20.9c-2.3 1.5-5.1 2.3-7.9 2.3zm8.8-11.1l-1.1-.5s-1.6-.7-2.6-1.2c-.1 0-.2-.1-.3-.1-.3 0-.5.1-.7.2 0 0-.1.1-1.5 1.7-.1.2-.3.3-.5.3h-.1c-.1 0-.3-.1-.4-.2l-.5-.2c-1.1-.5-2.1-1.1-2.9-1.9-.2-.2-.5-.4-.7-.6-.7-.7-1.4-1.5-1.9-2.4l-.1-.2c-.1-.1-.1-.2-.2-.4 0-.2 0-.4.1-.5 0 0 .4-.5.7-.8.2-.2.3-.5.5-.7.2-.3.3-.7.2-1-.1-.5-1.3-3.2-1.6-3.8-.2-.3-.4-.4-.7-.5h-1.1c-.2 0-.4.1-.6.1l-.1.1c-.2.1-.4.3-.6.4-.2.2-.3.4-.5.6-.7.9-1.1 2-1.1 3.1 0 .8.2 1.6.5 2.3l.1.3c.9 1.9 2.1 3.6 3.7 5.1l.4.4c.3.3.6.5.8.8 2.1 1.8 4.5 3.1 7.2 3.8.3.1.7.1 1 .2h1c.5 0 1.1-.2 1.5-.4.3-.2.5-.2.7-.4l.2-.2c.2-.2.4-.3.6-.5s.4-.4.5-.6c.2-.4.3-.9.4-1.4v-.7s-.1-.1-.3-.2z"})]})}),Y=()=>(0,U.jsx)("span",{className:P.default.icon,children:(0,U.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 64 64",children:[(0,U.jsx)("path",{fill:"#FFF",d:"M6.525 43.936a29.596 29.596 0 0 1-3.039-13.075C3.494 14.568 16.755 1.313 33.05 1.313c7.904.004 15.328 3.082 20.91 8.666 5.581 5.586 8.653 13.01 8.65 20.907-.007 16.294-13.266 29.549-29.558 29.549a29.648 29.648 0 0 1-12.508-2.771L1.391 62.687l5.134-18.751z"}),(0,U.jsx)("path",{fill:"#123033",d:"M50.801 13.135c-4.739-4.742-11.039-7.354-17.752-7.357-13.837 0-25.094 11.253-25.099 25.085a25.039 25.039 0 0 0 3.349 12.541l-3.56 12.999 13.304-3.488a25.084 25.084 0 0 0 11.996 3.054h.011c13.83 0 25.088-11.256 25.095-25.087.002-6.703-2.607-13.005-7.344-17.747zM33.05 51.733h-.008a20.866 20.866 0 0 1-10.62-2.906l-.762-.452-7.894 2.07 2.108-7.694-.497-.789a20.802 20.802 0 0 1-3.189-11.097c.004-11.496 9.361-20.85 20.87-20.85a20.73 20.73 0 0 1 14.746 6.115 20.733 20.733 0 0 1 6.104 14.752c-.006 11.497-9.363 20.851-20.858 20.851z"}),(0,U.jsx)("path",{fill:"#123033",d:"M25.429 19.26a8.65 8.65 0 0 0-1.028.011 2.352 2.352 0 0 0-.95.255c-.221.114-.427.277-.75.582-.305.288-.481.54-.668.782a6.974 6.974 0 0 0-1.443 4.291l.001.003a8.243 8.243 0 0 0 .844 3.607c1.043 2.307 2.763 4.746 5.035 7.008a24.676 24.676 0 0 0 1.657 1.6 24.145 24.145 0 0 0 9.814 5.229s.751.179 1.391.218c.021.001.04.003.061.003a9.207 9.207 0 0 0 1.422-.033 5.086 5.086 0 0 0 2.129-.59c.423-.225.623-.337.978-.561 0 0 .11-.072.319-.23.345-.257.558-.438.845-.736.211-.22.394-.479.534-.772.2-.417.401-1.213.481-1.874.061-.505.042-.781.036-.952-.011-.275-.238-.558-.487-.678l-1.486-.668s-2.222-.967-3.581-1.587a1.278 1.278 0 0 0-.452-.104c-.341-.021-.723.068-.966.324v-.004c-.013-.001-.182.145-2.031 2.385-.102.122-.341.387-.754.362a1.086 1.086 0 0 1-.185-.029 3.402 3.402 0 0 1-.49-.17c-.316-.134-.427-.185-.643-.278l-.013-.006a15.361 15.361 0 0 1-4.013-2.556 15.88 15.88 0 0 1-.927-.885c-1.074-1.041-1.953-2.148-2.607-3.24-.035-.06-.09-.146-.15-.242-.107-.174-.225-.381-.262-.523-.095-.376.157-.678.157-.678s.622-.68.911-1.05c.278-.356.518-.704.671-.952.301-.484.39-.982.238-1.37a216.767 216.767 0 0 0-2.219-5.215c-.156-.339-.598-.589-1.005-.636a6.284 6.284 0 0 0-.414-.041"})]})})},31703:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(99360)),a=n(r(69618)),s=r(12591),o=n(r(43725)),l=r(2541),c=r(85893);t.default=()=>{const e=l.URL.build(a.default.SMB_TOS_LEARN_MORE_LINK,{lg:o.default.getLocale()});return(0,c.jsx)(i.default,{href:e,onClick:t=>{t.preventDefault(),setTimeout((()=>(0,s.openExternalLink)(e)),10)},children:o.default.t(690)})}},11054:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RADIUS=void 0,t.Spinner=function(e){const{size:t=65,stroke:r=4,styleThemes:n,color:s=d.default,outgoingMsg:c,max:u=100,value:h}=e,f=function(e,t){if(null==e)return null;const r=Math.max(Math.min(e,t),0);return Math.ceil(100*r/t)}(h,u);(0,i.useEffect)((()=>{}),[]);const _=40+r;return(0,o.jsxs)("svg",{className:(0,a.default)(null==f&&l.container||l.rotate,...(n||[]).map((e=>l[e]))),width:t,height:t,viewBox:`0 0 ${_} ${_}`,role:"status",children:[null!=f?(0,o.jsx)(p,{viewBoxSide:_,stroke:r,outgoingMsg:c,color:"default",progress:u}):null,(0,o.jsx)(p,{progress:f,viewBoxSide:_,stroke:r,outgoingMsg:c,color:s})]})},t.styleThemeOptions=t.colorOptions=void 0;var i=r(67294),a=n(r(56720)),s=n(r(59891)),o=r(85893);const l={accent:{stroke:"dba1p600"},container:{animationName:"gdrnme8s",animationDuration:"hbnrezoj",animationTimingFunction:"f8mos8ky",animationIterationCount:"tkmeqcnu",zIndex:"b9fczbqn"},default:{stroke:"a5uym4to"},highlight:{stroke:"sku37djt"},progress:{stroke:"gibn6ev6"},in:{stroke:"ptcoeott"},noop:{visibility:"g5crjs6l"},out:{stroke:"mbixqzja"},rounded:{strokeLinecap:"bvgz89zs"},path:{animationName:"nmreelbr",animationDuration:"sw4r90y6",animationTimingFunction:"gaqnkt02",animationIterationCount:"tkmeqcnu",strokeDasharray:"kzgl1sas",strokeDashoffset:"fwna6xbl"},solidwhite:{stroke:"ad0o4787"},white:{stroke:"qaop2s2o"},rotate:{transform:"bwjm0vhl",transformOrigin:"sx61ek5s"}},c=(0,s.default)({noop:null});t.styleThemeOptions=c;const d=(0,s.default)({default:null,highlight:null,solidwhite:null,white:null,accent:null,progress:null});t.colorOptions=d;function u(e){if(null==e)return null;const t=Math.ceil(40*Math.PI);return{strokeDasharray:`${t} ${t}`,strokeDashoffset:t-e/100*t}}function p(e){let{stroke:t,viewBoxSide:r,progress:n,color:i,outgoingMsg:s}=e;return(0,o.jsx)("circle",{style:u(n),className:(0,a.default)(l.rounded,null==n&&l.path,l[i],!1===s&&l.in,s&&l.out),cx:r/2,cy:r/2,r:20,fill:"none",strokeWidth:t})}t.RADIUS=20},23217:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{className:t,containerRef:r,directional:n,display:l,height:c,name:d,color:u,title:p,style:h,width:f,xstyle:_,iconXstyle:m,"aria-label":g,"aria-hidden":y}=e;return(0,s.jsx)(a.SVGBase,{"aria-hidden":y,"aria-label":g,className:t,containerRef:r,height:c,isRTL:!!n&&i.default.isRTL(),display:l,name:d,title:p,style:h,width:f,xstyle:[_,u&&o[`${u}Color`]],iconXstyle:m})};n(r(56720));var i=n(r(43725)),a=r(71798),s=r(85893);const o={secondaryColor:{color:"aft2yglh"},tealColor:{color:"jq3rn4u7"}}},71798:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.SVGBase=void 0,t.loadSVGData=T,t.loadSpecificSVG=function(){return A.apply(this,arguments)};var a=n(r(81109)),s=n(r(6479)),o=n(r(48926)),l=r(89385),c=n(r(45095)),d=r(13959),u=r(4352),p=n(r(94184)),h=r(67294),f=n(r(56720)),_=i(r(22906)),m=n(r(38080)),g=r(85893);const y=["aria-label","aria-hidden","name","isRTL","className","display","containerRef","height","width","xstyle","iconXstyle"],E={reverse:{display:"f804f6gw",transform:"n4o0o7gj"},inline:{display:"l7jjieqr",verticalAlign:"fewfhwl7"}};let S,v;function T(e){return v||(v=(0,u.promiseLoop)(((t,n,i)=>{if(null==e?void 0:e.aborted)throw new l.AbortError;const a=(0,d.delayMs)(_.expBackoff(i,12e4,1e3,.1));return r.e(5512).then(r.bind(r,69692)).then((e=>{S=e.default,t()})).catch((()=>a))})))}function A(){return(A=(0,o.default)((function*(e){return yield T(),(0,c.default)(S,"SVGData")[e]}))).apply(this,arguments)}function C(e){const t=e.split("-");for(let e=1;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1).toLowerCase();return t.join("")}function b(e){if(null==e)return{};const t=e.attributes;return t.length>0?function(e){const t={};for(const r of e){let e=r.name;e.startsWith("xmlns")||(e.includes("-")?e=C(e):"class"===e&&(e="className"),t[e]=r.value)}return t}(t):{}}function P(e){var t;const[r,n]=(0,h.useState)(!!S),i=(0,m.default)();(0,h.useEffect)((()=>{r||T(i).then((()=>{if(i.aborted)throw new l.AbortError;n(!0)})).catch((()=>{}))}),[]);const{"aria-label":o,"aria-hidden":c,name:d,isRTL:u,className:_,display:v,containerRef:A,height:C,width:P,xstyle:M,iconXstyle:O}=e,I=(0,s.default)(e,y);if(S&&!S[d])throw new Error("Missing SVG for '"+d+"'!");const w=null===(t=S)||void 0===t?void 0:t[d],R=(0,h.useMemo)((()=>function(e){if(null==e)return null;const t=document.createElement("div");t.innerHTML=e;const r=t.firstElementChild;return"svg"===(null==r?void 0:r.tagName)?(t.removeChild(r),r):null}(w)),[w]),D=(0,h.useMemo)((()=>b(R)),[R]),N={};return null==C&&null==P||(N.height=C,N.width=P,N.preserveAspectRatio="xMidYMid meet"),(0,g.jsx)("span",(0,a.default)((0,a.default)({"data-testid":d,"aria-hidden":c,"aria-label":o,ref:A,"data-icon":d,className:(0,p.default)(_,(0,f.default)(u&&E.reverse,"inline"===v&&E.inline,M))},I),{},{children:(0,g.jsx)("svg",(0,a.default)((0,a.default)((0,a.default)({},D),N),{},{className:(0,f.default)(O),dangerouslySetInnerHTML:{__html:null==R?void 0:R.innerHTML}}))}))}const M=(0,h.memo)(P);t.SVGBase=M},13923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Text=p,t.TextDiv=function(e){return(0,c.jsx)(p,(0,a.default)({as:"div"},e))},t.TextHeader=function(e){const{level:t="1"}=e,r=(0,i.default)(e,d);return(0,c.jsx)(p,(0,a.default)({as:h[t]},r))},t.TextLabel=function(e){let{htmlFor:t}=e,r=(0,i.default)(e,u);return(0,c.jsx)(p,(0,a.default)((0,a.default)({as:"label"},r),{},{extras:{htmlFor:t}}))},t.TextParagraph=function(e){return(0,c.jsx)(p,(0,a.default)({as:"p"},e))},t.TextSpan=function(e){return(0,c.jsx)(p,(0,a.default)({as:"span"},e))};var i=n(r(6479)),a=n(r(81109)),s=n(r(94184)),o=n(r(56720)),l=n(r(25171)),c=r(85893);const d=["level"],u=["htmlFor"];function p(e){var t,r,n,i;const d=null!==(t=e.as)&&void 0!==t?t:"span",u=e.theme?l.default[e.theme]:null,p=e.color?l.default[`color-${e.color}`]:null,h=l.default[`weight-${null!==(r=e.weight)&&void 0!==r?r:"normal"}`],f=null!=e.customSize||null!=(null!==(n=e.xstyle)&&void 0!==n?n:{}).fontSize?null:null!==(i=e.size)&&void 0!==i?i:"14",_=null!=f?l.default[`size-${f}`]:null;let m;return null!=e.customSize&&(m={fontSize:"string"==typeof e.customSize?e.customSize:`${e.customSize}px`}),(0,c.jsx)(d,(0,a.default)((0,a.default)({},e.extras),{},{className:(0,s.default)(u,p,_,h,e.className,(0,o.default)(e.xstyle)),style:m,children:e.children}))}const h={1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"}},50452:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastImpl=t.ToastDismissBtn=t.ToastBody=t.ToastActionBtn=t.Toast=void 0,t.genId=function(e){return(0,i.default)(e||"toast")};var i=n(r(73955)),a=n(r(99964)),s=r(28298),o=r(67294),l=n(r(56720)),c=r(88102),d=n(r(23217)),u=n(r(4478)),p=r(85893);const h={btnSuccess:{color:"j5au4wul",fontWeight:"nbipi2bn"},button:{color:"dud78hvd",cursor:"ajgl1lbb",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo"},close:{color:"afo7vhit"},right:{right:"grt5ktjy"},toast:{alignItems:"gndfcl4n",backgroundColor:"cqvkqxai",borderTopStartRadius:"cynldqnp",borderTopEndRadius:"l5pmshjt",borderBottomEndRadius:"ecxr5yey",borderBottomStartRadius:"lysxvg3k",color:"k17s6i4e",display:"p357zi0d",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo"}};class f extends o.PureComponent{constructor(){super(...arguments),this.delay=this.props.setTimeout((()=>{c.Cmd.closeToast(this)}),this.props.duration),this.onDismiss=()=>{c.Cmd.closeToast(this),this.props.onDismiss&&this.props.onDismiss()}}getId(){return this.props.id}restartDelay(){this.props.clearTimeout(this.delay),this.delay=this.props.setTimeout((()=>{c.Cmd.closeToast(this)}),this.props.duration)}render(){const{msg:e,action:t}=this.props;let r;return t&&(r=(0,p.jsx)(_,{buttonText:t.actionText,onClick:t.dismiss?this.onDismiss:t.onAction,theme:t.theme})),(0,p.jsx)(m,{actionText:e,actionBtn:r})}}t.ToastImpl=f,f.defaultProps={duration:4e3},f.displayName="ToastImpl";const _=e=>{let{buttonText:t,onClick:r,theme:n}=e;return(0,p.jsx)("button",{className:(0,l.default)(h.button,s.uiMargin.start15,"success"===n&&h.btnSuccess),onClick:r,children:t})};t.ToastActionBtn=_;t.ToastDismissBtn=e=>{let{buttonText:t,onClick:r}=e;return(0,p.jsx)("button",{className:(0,l.default)(h.close,s.uiMargin.start15),onClick:r,children:(0,p.jsx)(d.default,{name:"x-alt"})})};const m=e=>{let{toastPosition:t,actionText:r,actionBtn:n,dismissBtn:i}=e;return(0,p.jsxs)("div",{className:(0,l.default)(h.toast,s.uiPadding.vert12,s.uiPadding.horiz16,"RIGHT"===t&&h.right),"data-a8n":a.default.key("toast-body"),children:[(0,p.jsx)("span",{children:r}),n,i]})};t.ToastBody=m;const g=(0,u.default)(f);t.Toast=class extends g{restartDelay(){const e=this.getComponent();e&&e.restartDelay()}}},93373:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(89734)),a=n(r(57557)),s=r(67294),o=n(r(56720)),l=r(88102),c=r(84387),d=n(r(59578)),u=r(50452),p=r(65127),h=n(r(41956)),f=r(85893);const _={slide0:{transform:"qdd0en2n"},slide1:{transform:"gqonocmn"},slide2:{transform:"b5bqnu92"},slide3:{opacity:"axi1ht8l",transform:"j7iro104"},wrapper:{opacity:"bs7a17vp",bottom:"jxacihee",lineHeight:"d53pemmv",marginTop:"fgtikrv0",marginEnd:"gqi0zhd6",marginBottom:"dblt22a0",marginStart:"nzcjdldu",minHeight:"ocs0cmsa",position:"lhggkp7q",zIndex:"pglj95m3",transition:"byw3xhqn"}};class m extends s.Component{constructor(){super(...arguments),this.state={toasts:{}},this._refToasts=new Map,this._setRefToast=(e,t)=>{t?this._refToasts.set(e,t):this._refToasts.delete(e)},this._setToastRefCache=new d.default(this._setRefToast),this.openToast=e=>{let t;(t=this._refToasts.get(e.props.id))&&t instanceof u.Toast?t.restartDelay():(this.state.toasts[e.props.id]=e,this.setState({toasts:this.state.toasts}))},this.closeToast=e=>{const t=this.state.toasts;t[e.props.id]&&this.setState({toasts:(0,a.default)(t,e.props.id)})}}componentDidMount(){this.props.listeners.add(l.Cmd,"open_toast",this.openToast),this.props.listeners.add(l.Cmd,"close_toast",this.closeToast)}componentDidUpdate(e,t){this._animateEnter=Object.keys(t.toasts).length>Object.keys(this.state.toasts).length}render(){const e=this._animateEnter,t=(0,i.default)(this.state.toasts,"id").reverse().map(((t,r)=>(0,f.jsx)("div",{ref:this._setToastRefCache.getRefSetter(t.props.id),className:(0,o.default)(_.wrapper,0===r&&e&&_.slide0,1===r&&_.slide1,2===r&&_.slide2,r>=3&&_.slide3),children:(0,s.cloneElement)(t)},t.props.id))),r=p.UA.isTrident?"fade_sifo":"toast-transition";return(0,f.jsx)(h.default,{transitionName:r,children:t})}}m.displayName="ToastManager";var g=(0,c.ListenerHOC)(m);t.default=g},3222:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r,n;return r=t=class extends o.WrappedComponent{render(){return this.state.hasError?null:(0,c.jsx)(l.default.Consumer,{children:t=>(0,c.jsx)(e,(0,i.default)((0,i.default)({ref:this.setComponent},this.props),{},{uim:(0,a.default)(t,"uim")}))})}},t.defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`UIM(${(0,s.default)(e)})`,t.wrappedComponent=e,r};var i=n(r(81109)),a=n(r(45095)),s=n(r(38701)),o=r(7128),l=n(r(2773)),c=r(85893)},89618:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIMState=t.UIM=void 0;var i=n(r(84753)),a=n(r(82729));const s=r(54302).Mirrored(["ACTIVE","PASSIVE","INACTIVE","DEAD"]);t.UIMState=s;class o{static maybePreventScroll(e){const t=o.Manager.top&&o.Manager.top.uie.getNode();e.target instanceof HTMLElement&&t&&!t.contains(e.target)&&(e.preventDefault(),e.stopPropagation())}constructor(e,t){this.shouldRequestFocus=!0,this.parent=e||this,e||(o.Manager.root&&(__LOG__(4,void 0,new Error,!0)`Attempting to set multiple UIM tree roots. Expecting only one.`,SEND_LOGS("multiple-uim-roots")),o.Manager.root=this),this.uie=t,this.children=[],this.state=t.getUIMState()}get state(){return this._state}set state(e){switch(e){case s.ACTIVE:this.lastActive=Date.now(),o.Manager.top=this;break;case s.PASSIVE:this.lastActive=Date.now(),this._state!==s.ACTIVE&&(o.Manager.top=o.findMostRecentlyActiveFocusable());break;case s.INACTIVE:this._state&&this._state!==e&&(o.Manager.top=o.findMostRecentlyActiveFocusable());break;case s.DEAD:}this._state=e}activate(){this.state=this._state}branch(e){const t=new o(this,e);return this.children.push(t),o.pprint(),t}pop(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.state===s.DEAD)return;this._invalidateAndDismissChildren(this.children,e),(0,a.default)(this.parent.children,(e=>e===this));const r=o.findMostRecentlyActiveFocusable(this);r&&(r.shouldRequestFocus=t),o.Manager.top=r,o.pprint()}_invalidateAndDismissChildren(e,t){e.forEach((e=>{e.state=s.DEAD,e.uie.requestDismiss(t),this._invalidateAndDismissChildren(e.children,t)}))}static findMostRecentlyActiveFocusable(e){const{root:t}=o.Manager;if(t)return l(t,e,(e=>e.state===s.ACTIVE||e.state===s.PASSIVE))}static findMostRecentlyActiveDismissable(e){const{root:t}=o.Manager;if(t)return l(t,e,(e=>e.state===s.ACTIVE))||l(t,e,(e=>e.state===s.PASSIVE))}static pprint(e){if(!e&&!o.Manager.verbose)return;const{root:t}=o.Manager;t&&__LOG__(2)`${d(t,[])}`}}function l(e,t,r){if(!e.children.length)return e;const n=e.children.filter((e=>e!==t)).map((e=>l(e,t,r))).concat([e]).filter(Boolean).filter(r);return(0,i.default)(n,"lastActive")}t.UIM=o,o.State=s,o.Manager={_top:void 0,set top(e){e&&(e.lastActive=Date.now()),e&&this._top!==e&&e.state!==s.INACTIVE&&e.state!==s.DEAD&&e.shouldRequestFocus&&e.uie.requestFocus(),e&&(e.shouldRequestFocus=!0),this._top&&this._top.uie.popable()&&window.removeEventListener("wheel",o.maybePreventScroll,{passive:!1,capture:!0}),e&&e.uie.popable()&&window.addEventListener("wheel",o.maybePreventScroll,{passive:!1,capture:!0}),this._top=e},get top(){return this._top},refocusTopUie(){setTimeout((()=>{this._top&&document.activeElement===document.body&&this._top.uie.requestFocus()}),0)},root:void 0,verbose:!1};function c(e,t,r,n){let i;i=r&&n?"├─┬":r&&!n?"├──":!r&&n?"└─┬":"└──",e===o.Manager.root&&(i="▶");let a=e.uie.getDisplayName();e===o.Manager.top&&(a=`${a} ⬥`);const l=`(${function(e){switch(e){case s.ACTIVE:return"A";case s.PASSIVE:return"P";case s.INACTIVE:return"I";case s.DEAD:return"D"}}(e.state)})${n?"\n":""}`;return`${t.join("")}${i} ${a} ${l}`}function d(e,t,r){return c(e,t,r,!!e.children.length)+e.children.map(((n,i)=>{const a=i<e.children.length-1;return d(n,r?t.concat(["│ "]):t.concat(["  "]),a)})).join("\n")}window.addEventListener("keydown",(e=>{if(27!==e.keyCode)return;const{top:t}=o.Manager,r=t&&t.state===s.ACTIVE?t:o.findMostRecentlyActiveDismissable();r&&r.uie.escapable()&&(e.stopPropagation(),e.preventDefault(),r&&r.uie.requestDismiss(!1))}),{capture:!0});let u=null;function p(e,t){const r=e&&e.state===s.ACTIVE&&e.uie.popable()?e:o.findMostRecentlyActiveDismissable();if(!r||!r.uie.popable())return null;const n=r.uie.getNode();return n&&t.target instanceof Node&&n.contains(t.target)?null:r}window.addEventListener("mousedown",(e=>{if(u=null,!e.screenX||!e.screenY)return;const t=p(o.Manager.top,e);t&&2===e.button?t.uie.requestDismiss():u=t}),{capture:!0}),window.addEventListener("mouseup",(e=>{if(!e.screenX||!e.screenY)return void(u=null);const t=p(o.Manager.top,e);t&&t===u&&setTimeout((()=>t.uie.requestDismiss()),0),u=null}),{capture:!0})},18644:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIE=void 0;var i=r(89618),a=r(67294),s=n(r(38701)),o=n(r(2773)),l=r(85893);let c=null;class d extends a.Component{constructor(e,t){super(e,t),this._didMount=!1,this._pendingRequestFocus=!1,this._requestFocusTimeout=null,this._refAnchorElement=(0,a.createRef)(),this._setRefChild=e=>{const t="function"==typeof(null==e?void 0:e.getComponent)?e.getComponent():e;this._refChild=t,this.props.children&&"function"==typeof this.props.children.ref&&this.props.children.ref(t)},this.uim=this.context?this.context.branch(this):new i.UIM(void 0,this)}componentDidUpdate(e){e.uimState!==this.props.uimState&&(this.uim.state=this.props.uimState)}componentWillUnmount(){c&&this._requestFocusTimeout===c&&(clearTimeout(c),c=null),this.uim.pop(!0,this.props.requestRecentFocusOnUnmount)}activate(){this.uim.activate()}popable(){return this.props.popable}escapable(){return this.props.escapable}requestDismiss(e){this.props.requestDismiss&&this.props.requestDismiss(e)}componentDidMount(){const{requestFocus:e}=this.props;this._didMount=!0,e&&this._pendingRequestFocus&&this._maybeCallRequestFocus()}requestFocus(){const{requestFocus:e}=this.props;e&&this._didMount?this._maybeCallRequestFocus():this._pendingRequestFocus=!0}getDisplayName(){return this.props.displayName}getRef(){return this._refChild}getUIMState(){return this.props.uimState}getNode(){const e=this._refChild;if(null!=e){if(e instanceof HTMLElement)return e;let t="";try{const r=e.getElement();if(null==r||r instanceof HTMLElement)return r;t=`Non HTML element received:\n${(0,s.default)(r.constructor)}`}catch(e){t=`${e.message}:\n${e.stack}`}__LOG__(4,void 0,new Error,!0)`UIE received a child component that does not have a compatible API:\n${t}`,SEND_LOGS("uie-bad-child-api");const r=this._refAnchorElement.current;if((null==r?void 0:r.previousElementSibling)instanceof HTMLElement)return r.previousElementSibling}return null}render(){const{children:e}=this.props;if(!e)return null;const t=(0,a.cloneElement)(e,{ref:this._setRefChild});return(0,l.jsxs)(o.default.Provider,{value:this.uim,children:[t,(0,l.jsx)("div",{ref:this._refAnchorElement,style:{display:"none"},hidden:!0})]})}_maybeCallRequestFocus(){const{requestFocus:e}=this.props;e&&(c&&clearTimeout(c),this._requestFocusTimeout=c=setTimeout((()=>{e(),this._requestFocusTimeout=c=null}),0))}}t.UIE=d,d.State=i.UIM.State,d.defaultProps={uimState:i.UIM.State.ACTIVE,requestRecentFocusOnUnmount:!0},d.contextType=o.default,d.displayName="UIE"},33358:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(67294),i=r(85893),a=(0,n.forwardRef)((function(e,t){let{children:r}=e;const a=(0,n.useRef)();return(0,n.useImperativeHandle)(t,(()=>({getElement:()=>a.current}))),(0,i.jsx)("div",{ref:a,children:r})}));t.default=a},2773:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,r(67294).createContext)(null);t.default=n},32554:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.displayHighQualityLinkPreview=function(e,t){if(!Boolean(e.thumbnailDirectPath||e.thumbnailHQ)||null==e.thumbnailHeight||null==e.thumbnailWidth)return!1;if(s(e.t))return!1;return!(t===a.default.DISP_TYPE.GALLERY)},t.hqLinkPreviewExpired=s;var i=r(22683),a=n(r(69618));function s(e){return i.Clock.globalUnixTime()-e>2592e3}},94270:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionBubbleType=void 0;const n=r(54302).Mirrored(["DEFAULT","NON_CONVERSATION","STICKER","MEDIA_ITEM"]);t.ReactionBubbleType=n},38701:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e?e:e&&(e.displayName||e.name)||"Component"}},7128:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedComponent=t.HOCRef=void 0,t._getComponent=function(){const e=this.component||this.refs.component;if("function"==typeof e._getComponent)return e._getComponent();return e};var i=n(r(81109)),a=n(r(45095)),s=r(67294);t.HOCRef="component";class o extends s.Component{constructor(e){super(e),this.setComponent=e=>{this.component=e},this.state=(0,i.default)({},this.state)}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){__LOG__(4,void 0,new Error,!0)`${e.stack}\n${t.componentStack}`,SEND_LOGS("component-did-catch")}getComponent(){return this.component instanceof o?this.component.getComponent():(0,a.default)(this.component,"this.component")}}t.WrappedComponent=o},84387:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ListenerHOC=function(e){var t,r,n;return r=t=class extends d.WrappedComponent{constructor(){super(...arguments),this.listeners=new h}componentDidMount(){this.listeners.internalUseOnlyMarkMounted()}componentWillUnmount(){this.listeners.internalUseOnlyMarkUnmounted()}_getComponent(){return d._getComponent.call(this)}render(){return this.state.hasError?null:(0,p.jsx)(e,(0,i.default)((0,i.default)({ref:this.setComponent},this.props),{},{listeners:this.listeners}))}},t.defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`Listener(${(0,c.default)(e)})`,t.wrappedComponent=null,r},t.Listeners=void 0;var i=n(r(81109)),a=r(89385),s=n(r(70714)),o=r(88102),l=r(92200),c=n(r(38701)),d=r(7128),u=r(59923),p=r(85893);class h{constructor(){this._mounted=!1,this._unmounted=!1,this._listeners=new Set,this._remove=e=>{e.disengage(),this._listeners.delete(e)}}_add(e){this._unmounted?__LOG__(3)`Listener added after unmounting`:(this._listeners.add(e),this._mounted&&e.engage())}internalUseOnlyMarkMounted(){this._mounted=!0,this._listeners.forEach((e=>{e.engage()}))}internalUseOnlyMarkUnmounted(){this._unmounted=!0,this._listeners.forEach(this._remove),this._abortController&&this._abortController.abort()}add(e,t,r,n){const i=this,a=new u.Listener(e,t,(function(){i._unmounted||r.apply(this,arguments)}),n,r);this._add(a)}addOnce(e,t,r,n){const i=this,a=new u.Listener(e,t,(function(){i._remove(a),i._unmounted||r.apply(this,arguments)}),n,r);this._add(a)}remove(e,t,r,n){this._listeners.forEach((i=>{i.represents(e,t,r,n)&&this._remove(i)}))}uiIdle(e){o.Cmd.uiBusy?this.addOnce(o.Cmd,"ui_idle",e):(this._abortController=this._abortController||new s.default,(0,l.documentFlushed)({signal:this._abortController.signal}).then((()=>{e()}),(e=>{if(e.name!==a.ABORT_ERROR)throw e})))}testsOnlyGetListeners(){return this._listeners}}t.Listeners=h},31019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unproxy=function(e){if(null==e?void 0:e.$ProxyState$state)return e.$ProxyState$state;return e}},4478:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r;return r=t=class extends l.WrappedComponent{constructor(){var e;super(...arguments),e=this,this._timers=new Map,this._timerId=0,this._unmounted=!1,this.setInterval=(e,t)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Setting interval after unmount"));const r=++this._timerId,n=window.setInterval(e,t);return this._timers.set(r,(()=>{window.clearInterval(n),this._timers.delete(r)})),r},this.clearInterval=e=>{const t=this._timers.get(e);t&&t()},this.setTimeout=(e,t)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Setting timeout after unmount"));const[r,n]=this._cbWrapper(e),i=window.setTimeout(n,t);return this._timers.set(r,(()=>{window.clearTimeout(i),this._timers.delete(r)})),r},this.clearTimeout=e=>{const t=this._timers.get(e);t&&t()},this.requestAnimationFrame=e=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Requesting animation frame after unmount"));const[t,r]=this._cbWrapper(e),n=window.requestAnimationFrame(r);return this._timers.set(t,(()=>{window.cancelAnimationFrame(n),this._timers.delete(t)})),t},this.cancelAnimationFrame=e=>{const t=this._timers.get(e);t&&t()},this.throttle=(t,r,n)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Throttling after unmount"));const[i,a]=this._cbWrapper(t),o=(0,s.default)(a,r,n),l=o.cancel.bind(o);o.cancel=()=>{l(),this._timers.delete(i)};const c=function(){e._unmounted||(e._timers.set(i,o.cancel),o(...arguments))};return c.cancel=o.cancel,c.flush=o.flush,c},this.debounce=(t,r,n)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Debouncing after unmount"));const[i,s]=this._cbWrapper(t),o=(0,a.default)(s,r,n),l=o.cancel.bind(o),c=o.flush.bind(o);o.cancel=()=>{l(),this._timers.delete(i)},o.flush=()=>{c()};const d=function(){e._unmounted||(e._timers.set(i,o.cancel),o(...arguments))};return d.cancel=o.cancel,d.flush=o.flush,d},this._cbWrapper=t=>{const r=++this._timerId;return[r,function(){e._timers.delete(r),t(...arguments)}]}}_getComponent(){return l._getComponent.call(this)}componentWillUnmount(){this._unmounted=!0,this._timers.forEach((e=>e()))}render(){return this.state.hasError?null:(0,c.jsx)(e,(0,i.default)({ref:this.setComponent,setInterval:this.setInterval,clearInterval:this.clearInterval,setTimeout:this.setTimeout,clearTimeout:this.clearTimeout,requestAnimationFrame:this.requestAnimationFrame,cancelAnimationFrame:this.cancelAnimationFrame,debounce:this.debounce,throttle:this.throttle},this.props))}},t.displayName=`Timer(${(0,o.default)(e)})`,t.wrappedComponent=null,r};var i=n(r(81109)),a=n(r(23279)),s=n(r(23493)),o=n(r(38701)),l=r(7128),c=r(85893)},90012:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r,n;return r=t=class extends o.WrappedComponent{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.getUnmountSignal=()=>(this._controller||(this._controller=new a.default,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort()}_getComponent(){return o._getComponent.call(this)}render(){return this.state.hasError?null:(0,l.jsx)(e,(0,i.default)({ref:this.setComponent,getUnmountSignal:this.getUnmountSignal},this.props))}},t.defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`UnmountSignal(${(0,s.default)(e)})`,t.wrappedComponent=null,r};var i=n(r(81109)),a=n(r(70714)),s=n(r(38701)),o=r(7128),l=r(85893)},56599:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.initModules=function(){c()};var i=n(r(51463)),a=n(r(70714)),s=r(91903),o=r(46582);const l={minTimeout:1e3,maxTimeout:12e4,retries:1/0,signal:(new a.default).signal};const c=(0,i.default)((function(){return(0,s.exponentialBackoff)(l,((e,t)=>Promise.all([r.e(2101),r.e(7964)]).then(r.bind(r,67019)).catch((r=>(__LOG__(3)`failed to load main bundle`,10===t&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("failed to load main bundle")),e(r)))))).then((e=>(0,o.setMainBundleModules)(e)))}))},46582:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMainBundleModules=s,t.requireCallCollection=function(){return S.apply(this,arguments)},t.requireChatCollection=function(){return g.apply(this,arguments)},t.requireClearAppStates=function(){return f.apply(this,arguments)},t.requireContactCollection=function(){return l.apply(this,arguments)},t.requireEmojiAssetMapCreator=function(){return p.apply(this,arguments)},t.requireEmojiConfig=function(){return u.apply(this,arguments)},t.requireHandleSocketMessage=function(){return d.apply(this,arguments)},t.requireHandleVideoStreamingRequest=function(){return _.apply(this,arguments)},t.requireLabelCollection=function(){return m.apply(this,arguments)},t.requireLoadProtoVersions=function(){return c.apply(this,arguments)},t.requireMain=function(){return o.apply(this,arguments)},t.requireMsgCollection=function(){return y.apply(this,arguments)},t.requireSetHandlers=function(){return A.apply(this,arguments)},t.requireStatusV3Collection=function(){return h.apply(this,arguments)},t.requireStickerPackCollection=function(){return E.apply(this,arguments)},t.requireVoip=function(){return v.apply(this,arguments)},t.requireVoipCommonDisabled=function(){return T.apply(this,arguments)},t.setMainBundleModules=function(e){return a.resolve(e),e};var i=n(r(48926));const a=new(r(88156).Resolvable);function s(){return a.promise}function o(){return(o=(0,i.default)((function*(){return(yield s()).requireMain()}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){return(yield s()).requireContactCollection()}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(){return(yield s()).requireLoadProtoVersions()}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){return(yield s()).requireHandleSocketMessage()}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){return(yield s()).requireEmojiConfig()}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){return(yield s()).requireEmojiAssetMapCreator()}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){return(yield s()).requireStatusV3Collection()}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){return(yield s()).requireClearAppStates()}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){return(yield s()).requireHandleVideoStreamingRequest()}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){return(yield s()).requireLabelCollection()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){return(yield s()).requireChatCollection()}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){return(yield s()).requireMsgCollection()}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){return(yield s()).requireStickerPackCollection()}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){return(yield s()).requireCallCollection()}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){return(yield s()).requireVoip()}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){return(yield s()).requireVoipCommonDisabled()}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(){return(yield s()).requireSetHandlers()}))).apply(this,arguments)}},59923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Listener=void 0,t.isEventsType=s;var i=n(r(11241)),a=n(r(34342));function s(e){return e instanceof a.default||"function"==typeof e.on&&"function"==typeof e.off}t.Listener=class{constructor(e,t,r,n,a){this._hasEngaged=!1,this._hasDisengaged=!1,this.source=e,this.cb=r,this.opts=n,this._cbIdentifier=a,s(e)?this.event=t:this.event=i.default.prefix(t,e)}engage(){if(this._hasEngaged||this._hasDisengaged)return;this._hasEngaged=!0;const e=this.source,t=this.event;s(e)?(e.on(t,this.cb),"function"==typeof e.incObservers&&e.incObservers()):this.opts?e.addEventListener(t,this.cb,this.opts):e.addEventListener(t,this.cb)}disengage(){if(this._hasDisengaged)return;if(this._hasDisengaged=!0,!this._hasEngaged)return;const e=this.source,t=this.event;s(e)?(e.off(this.event,this.cb),"function"==typeof e.decObservers&&e.decObservers()):this.opts?e.removeEventListener(t,this.cb,this.opts):e.removeEventListener(t,this.cb)}represents(e,t,r,n){var i;if(this.source!==e)return!1;if(this.event!==t)return!1;if(this._cbIdentifier!==r)return!1;const{capture:a=!1,once:s=!1,passive:o=!1}=null!=n?n:{},{capture:l=!1,once:c=!1,passive:d=!1}=null!==(i=this.opts)&&void 0!==i?i:{};return a===l&&s===c&&o===d}}},65273:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(30988)),s=n(r(18446)),o=r(50833),l=r(39581),c=n(r(48014)),d=r(47732),u=r(39989),p=n(r(16186)),h=n(r(24055)),f=n(r(46668)),_=r(81829);class m{static create(){const{backgroundColor:e,tintColor:t}=d.DEFAULT_DOMINANT_COLOR.getBackgroundAndTintColors();return new m({id:Math.random(),frame:new h.default({origin:new p.default({x:0,y:0}),size:new f.default({width:0,height:0}),rotation:0,scale:0}),layers:[],paintLayer:new o.DrawLayer({size:f.default.empty(),type:o.DrawLayerType.Paint}),outlineLayer:new o.DrawLayer({size:f.default.empty(),type:o.DrawLayerType.Outline}),background:null,selectedLayer:null,backgroundColor:e,tintColor:t,rotation:0,cropFrame:new h.default({origin:new p.default({x:0,y:0}),size:new f.default({width:0,height:0}),rotation:0,scale:0})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}_update(e){const t=(0,i.default)({},this._props);return null!=e.layers&&(t.layers=e.layers),void 0!==e.paintLayer&&(t.paintLayer=e.paintLayer),void 0!==e.outlineLayer&&(t.outlineLayer=e.outlineLayer),void 0!==e.background&&(t.background=e.background),void 0!==e.frame&&(t.frame=e.frame,t.frame&&(t.cropFrame=t.cropFrame.updateXYWidthHeight({x:0,y:0,width:t.frame.width,height:t.frame.height}))),void 0!==e.cropFrame&&(t.cropFrame=e.cropFrame),void 0!==e.selectedLayer&&(t.selectedLayer=e.selectedLayer),null!=e.backgroundColor&&(t.backgroundColor=e.backgroundColor),null!=e.tintColor&&(t.tintColor=e.tintColor),null!=e.rotation&&(t.rotation=e.rotation),(0,s.default)(this._props,t)?this:new m(t)}updateLayer(e,t){if(e instanceof _.TextLayer&&!(t instanceof _.TextLayer)||e instanceof u.ImageLayer&&!(t instanceof u.ImageLayer))throw new TypeError("MediaEditorData: calling _updateLayer with two different layer types");if(e===t)return this;const r=this.layers.map((r=>r===e?t:r));let n=this.selectedLayer;return n===e&&(n=t),this._update({layers:r,selectedLayer:n})}setBackground(e,t){const{fitToSquare:r=!1,scale:n=1}=null!=t?t:{},i=u.ImageLayer.create({type:u.ImageLayerType.Background,origin:new p.default({x:0,y:0}),image:e,editable:!0,scale:n}),a=i.frame.dimension,s=r?h.default.create({x:0,y:0,width:a,height:a,scale:1,rotation:0}):i.frame,l=new p.default({x:(s.width-i.width)/2,y:(s.height-i.height)/2}),c=i.setScale(n).setOrigin(l),f=(0,d.getDominantColor)(e),{backgroundColor:_,tintColor:m}=f.getBackgroundAndTintColors(),g=new o.DrawLayer({size:s.size,type:o.DrawLayerType.Paint}),y=new o.DrawLayer({size:s.size,type:o.DrawLayerType.Outline});return this._update({background:c,frame:s,backgroundColor:_,tintColor:m,paintLayer:g,outlineLayer:y})}updateBackground(e,t,r,n){var i;const a=null===(i=this.background)||void 0===i?void 0:i.setImage(e).setOrigin(t).setRotation(r).setScale(n);return this._update({background:a,selectedLayer:a})}addImageLayer(e){const t=u.ImageLayer.create(e),r=[...this.layers,t];return this._update({layers:r,selectedLayer:t})}addImageLayerToCenter(e){const t=this.toCanvasPoint(new p.default({x:this.screenWidth/2,y:this.screenHeight/2})),r=new p.default({x:t.x-e.image.width/2,y:t.y-e.image.height/2}),n=(0,i.default)({origin:r,rotation:-this.rotation},e);return this.addImageLayer(n)}addTextLayer(e){const t=e instanceof _.TextLayer?e:_.TextLayer.create((0,i.default)((0,i.default)({},e),{},{rotation:-this.rotation})),r=[...this.layers,t];return this._update({layers:r,selectedLayer:t})}setText(e,t){return this.updateLayer(e,e.setText(t))}setTextColor(e,t){return this.updateLayer(e,e.setTextColor(t))}setTextBackground(e,t){return this.updateLayer(e,e.setTextBackground(t))}setFont(e,t){return this.updateLayer(e,e.setFont(t))}setAlignment(e,t){return this.updateLayer(e,e.setAlignment(t))}setRotation(e){if(e%90!=0)throw new Error("canvas can only be rotated at a 90 degrees interval");return this._update({rotation:e%360})}setCrop(e,t){if(e.x<0||e.y<0||e.x+t.width>this.width||e.y+t.height>this.height)throw new Error("canvas crop must stays within the frame bound");const r=new h.default({origin:e,size:t,rotation:0,scale:0});return this._update({cropFrame:r})}addEmptyTextLayer(e,t){const r={origin:new p.default({x:this.width/4,y:this.height/2}),text:"",textColor:e,textBackground:!1,font:t,alignment:l.TextAlignment.CENTER};return this.addTextLayer(r)}addPaintPath(e){const t=this.paintLayer.addPath(e);return this._update({paintLayer:t})}addOutlinePath(e){const t=this.outlineLayer.addPath(e);return this._update({outlineLayer:t})}cropToOutline(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;if(this.outlineLayer.isEmpty())return this;const r=this.outlineLayer.getAllPoints(),n=(0,c.default)(r,this.frame.rotation,this.frame.scale),i=null!=t?t:n.size.dimension,a=e*n.size.dimension/i,s=n.addPadding(a,this.frame);return this.setCrop(s.origin,s.size)}clearOutlinePaths(){const e=this.outlineLayer.clearPaths();return this._update({outlineLayer:e})}translateLayer(e,t){return this.updateLayer(e,e.setOrigin(t))}translateBackground(e){var t;const r=null===(t=this.background)||void 0===t?void 0:t.setOrigin(e);return this._update({background:r,selectedLayer:r})}transformLayer(e,t,r){return this.updateLayer(e,e.setRotation(t).setScale(r))}transformBackground(e,t){var r;const n=null===(r=this.background)||void 0===r?void 0:r.setRotation(e).setScale(t);return this._update({background:n,selectedLayer:n})}setSelectedLayer(e){return this._update({selectedLayer:e})}moveToTop(e){if(this.layers[this.layers.length-1]===e)return this;const t=[...this.layers.filter((t=>t!==e)),e];return this._update({layers:t})}clearSelectedLayer(){return this._update({selectedLayer:null})}deleteLayer(e){e.delete();let t={layers:this.layers.filter((t=>t!==e))};return e===this.selectedLayer&&(t=(0,i.default)((0,i.default)({},t),{},{selectedLayer:null})),this._update(t)}deleteAllLayers(){return this.layers.forEach((e=>e.delete())),this._update({layers:[],paintLayer:new o.DrawLayer({size:this.size,type:o.DrawLayerType.Paint}),outlineLayer:new o.DrawLayer({size:this.size,type:o.DrawLayerType.Outline}),selectedLayer:null})}hasEdits(){return!this.paintLayer.isEmpty()||!this.outlineLayer.isEmpty()||this.layers.length>0||0!==this.rotation||!this.size.equals(this._props.cropFrame.size)}get layers(){return this._props.layers}get lastTextLayer(){const e=(0,a.default)(this.layers,(e=>e instanceof _.TextLayer));return e instanceof _.TextLayer?e:null}get paintLayer(){return this._props.paintLayer}get outlineLayer(){return this._props.outlineLayer}get background(){return this._props.background}get selectedLayer(){return this._props.selectedLayer}get backgroundColor(){return this._props.backgroundColor}get tintColor(){return this._props.tintColor}get size(){return this._props.frame.size}get frame(){return this._props.frame}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get cropWidth(){return this._props.cropFrame.width}get cropHeight(){return this._props.cropFrame.height}get cropOrigin(){return this._props.cropFrame.origin}get cropSize(){return this._props.cropFrame.size}get cropCenter(){return this._props.cropFrame.getCenter()}get screenWidth(){return this.rotation%180==0?this.cropWidth:this.cropHeight}get screenHeight(){return this.rotation%180==0?this.cropHeight:this.cropWidth}get canvasCenter(){return new p.default({x:this.width/2,y:this.height/2})}get rotation(){return this._props.rotation}get id(){return this._props.id}toScreenPoint(e){const t=Math.max(this.width,this.height),r=new p.default({x:t/2,y:t/2}),n=new p.default({x:e.x+(t-this.width)/2,y:e.y+(t-this.height)/2}).rotate(r,this.rotation),i=new p.default({x:this.cropCenter.x+(t-this.width)/2,y:this.cropCenter.y+(t-this.height)/2}).rotate(r,this.rotation),a=new p.default({x:i.x-this.screenWidth/2,y:i.y-this.screenHeight/2});return new p.default({x:n.x-a.x,y:n.y-a.y})}toCanvasPoint(e){const t=Math.max(this.width,this.height),r=new p.default({x:t/2,y:t/2}),n=this.cropCenter.rotate(r,this.rotation),i=new p.default({x:n.x-this.screenWidth/2,y:n.y-this.screenHeight/2}),a=new p.default({x:e.x+i.x,y:e.y+i.y}).rotate(r,-this.rotation);return new p.default({x:a.x,y:a.y})}resetCropRotate(){return this.setRotation(0).setCrop(new p.default({x:0,y:0}),new f.default({width:this.width,height:this.height}))}isRotated(){return 0!==this.rotation}isCropped(){return!this.cropOrigin.equals(new p.default({x:0,y:0}))||!this.cropSize.equals(this.size)}isOutlined(){return!this.outlineLayer.isEmpty()}}t.default=m},92320:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COLORS=void 0,t.getAllColors=function(){return Object.keys(i)},t.getColorValue=function(e){return a[e]};var n=r(16241);const i=Object.freeze({BLACK:"BLACK",GRAY:"GRAY",WHITE:"WHITE",BLUE:"BLUE",GREEN:"GREEN",PURPLE:"PURPLE",ORANGE:"ORANGE",RED:"RED"});t.COLORS=i;const a={[i.BLACK]:n.Color.fromHex("#434343"),[i.GRAY]:n.Color.fromHex("#9DA0A9"),[i.WHITE]:n.Color.fromHex("#FFFFFF"),[i.BLUE]:n.Color.fromHex("#33CEFF"),[i.GREEN]:n.Color.fromHex("#64DC2F"),[i.PURPLE]:n.Color.fromHex("#BD73FF"),[i.ORANGE]:n.Color.fromHex("#F49226"),[i.RED]:n.Color.fromHex("#FF4A4A")}},39581:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TextAlignment=t.FONTS=void 0,t.getAllFonts=function(){return Object.keys(a)},t.getFontStyle=function(e){return s[e]},t.getFontTranslation=function(e){switch(e){case a.SANS_SERIF:return i.default.t(781);case a.SERIF:return i.default.t(782);case a.NORICAN_REGULAR:return i.default.t(779);case a.BRYNDAN_WRITE:return i.default.t(778);case a.OSWALD_HEAVY:return i.default.t(780);default:throw new Error("Unsupported font")}};var i=n(r(43725));const a=Object.freeze({SANS_SERIF:"SANS_SERIF",SERIF:"SERIF",NORICAN_REGULAR:"NORICAN_REGULAR",BRYNDAN_WRITE:"BRYNDAN_WRITE",OSWALD_HEAVY:"OSWALD_HEAVY"});t.FONTS=a;const s={[a.SANS_SERIF]:{fontFamily:"sans-serif"},[a.SERIF]:{fontFamily:'"Droid Serif", serif'},[a.NORICAN_REGULAR]:{fontFamily:'"Norican"'},[a.BRYNDAN_WRITE]:{fontFamily:'"Bryndan-Write"'},[a.OSWALD_HEAVY]:{fontFamily:'"Oswald"',fontWeight:"bold"}},o=r(54302).Mirrored(["LEFT","CENTER","RIGHT"]);t.TextAlignment=o},70638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class r{constructor(e){const{points:t,color:r,thickness:n,smoothing:i}=e;this._points=[...t],this._color=r,this._thickness=n,this._smoothing=i,Object.freeze(this)}update(e){let t=this.points,n=this.color,i=this.thickness,a=this.smoothing;return null!=e.points&&(t=e.points),null!=e.color&&(n=e.color),null!=e.thickness&&(i=e.thickness),null!=e.smoothing&&(a=e.smoothing),new r({points:t,color:n,thickness:i,smoothing:a})}clone(){const e={points:[...this.points],color:this.color.clone(),thickness:this.thickness,smoothing:this.smoothing};return new r(e)}toString(){return`points: [${this.points.map((e=>e.toString())).join(", ")}]\ncolor: ${this.color.toString()}\nthickness: ${this.thickness}`}equals(e){return this.color.equals(e.color)&&Math.abs(this.thickness-e.thickness)<Number.EPSILON&&this.points.length===e.points.length&&this.points.every(((t,r)=>t.equals(e.points[r])))}isDrag(){return this.points.length>1}isSmooth(){return this.smoothing||this.isDrag()}isStraight(){return!this.isSmooth()}get points(){return this._points}get color(){return this._color}get thickness(){return this._thickness}get smoothing(){return this._smoothing}}t.default=r},16186:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(18446));class s{constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.x&&(t.x=e.x),null!=e.y&&(t.y=e.y),(0,a.default)(this._props,t)?this:new s(t)}clone(){return new s(this._props)}toString(){return`(${this.x}x, ${this.y}y)`}equals(e){return Math.abs(this.x-e.x)<Number.EPSILON&&Math.abs(this.y-e.y)<Number.EPSILON}distance(e){return Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2)}rotate(e,t){const r=t*Math.PI/180,n=this.x-e.x,i=this.y-e.y,a=Math.cos(r)*n-Math.sin(r)*i+e.x,o=Math.sin(r)*n+Math.cos(r)*i+e.y;return new s({x:Math.round(100*a)/100,y:Math.round(100*o)/100})}get x(){return this._props.x}get y(){return this._props.y}}t.default=s},24055:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(18446)),s=n(r(16186)),o=n(r(46668));class l{static create(e){return new l({origin:new s.default({x:e.x,y:e.y}),size:new o.default({width:e.width,height:e.height}),rotation:e.rotation,scale:e.scale})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}updateXYWidthHeight(e){const t=(0,i.default)({},this._props);return null==e.x&&null==e.y||(t.origin=t.origin.update({x:e.x,y:e.y})),null==e.width&&null==e.height||(t.size=t.size.update({width:e.width,height:e.height})),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&(t.scale=e.scale),this.update(t)}update(e){const t=(0,i.default)({},this._props);return null!=e.origin&&(t.origin=e.origin),null!=e.size&&(t.size=e.size),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&Math.abs(t.scale-e.scale)>1e-6&&(t.scale=e.scale),(0,a.default)(this._props,t)?this:new l(t)}clone(){return new l(this._props)}addPadding(e,t){const r=this.getTopLeft(),n=t.getTopLeft(),i=new s.default({x:Math.max(n.x,r.x-e),y:Math.max(n.y,r.y-e)}),a=this.getBottomRight(),o=t.getBottomRight(),l=new s.default({x:Math.min(o.x,a.x+e),y:Math.min(o.y,a.y+e)}),c=l.x-i.x,d=l.y-i.y;return this.updateXYWidthHeight({x:i.x,y:i.y,width:c,height:d})}toString(){return`(${this.origin.toString()}, ${this.size.toString()}, ${this.rotation}r)`}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)&&this.rotation===e.rotation&&this.scale===e.scale}contains(e){return e.x>=this.x&&e.y>=this.y&&e.x<this.x+this.width&&e.y<this.y+this.height}getTopLeft(){return new s.default({x:this.x,y:this.y})}getTopCenter(){return new s.default({x:this.x+this.width/2,y:this.y})}getTopRight(){return new s.default({x:this.x+this.width,y:this.y})}getLeftCenter(){return new s.default({x:this.x,y:this.y+this.height/2})}getCenter(){return new s.default({x:this.x+this.width/2,y:this.y+this.height/2})}getRightCenter(){return new s.default({x:this.x+this.width,y:this.y+this.height/2})}getBottomLeft(){return new s.default({x:this.x,y:this.y+this.height})}getBottomCenter(){return new s.default({x:this.x+this.width/2,y:this.y+this.height})}getBottomRight(){return new s.default({x:this.x+this.width,y:this.y+this.height})}get origin(){return this._props.origin}get size(){return this._props.size}get x(){return this.origin.x}get y(){return this.origin.y}get width(){return this.size.width}get height(){return this.size.height}get rotation(){return this._props.rotation}get scale(){return this._props.scale}get dimension(){return this.size.dimension}}t.default=l},46668:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(18446));class s{constructor(e){const{width:t,height:r}=e;if(t<0)throw new RangeError("MediaEditor:Size width cannot be negative");if(r<0)throw new RangeError("MediaEditor:Size height cannot be negative");this._props=Object.freeze({width:t,height:r}),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.width&&(t.width=e.width),null!=e.height&&(t.height=e.height),(0,a.default)(this._props,t)?this:new s(t)}clone(){return new s(this._props)}toString(){return`(${this.width}w, ${this.height}h)`}equals(e){return Math.abs(this.width-e.width)<Number.EPSILON&&Math.abs(this.height-e.height)<Number.EPSILON}isEmpty(){return this.equals(s.empty())}static empty(){return new s({width:0,height:0})}get width(){return this._props.width}get height(){return this._props.height}get dimension(){return Math.max(this.width,this.height)}}t.default=s},50833:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLayerType=t.DrawLayer=void 0;var i=r(83428),a=n(r(70638)),s=n(r(16186)),o=n(r(24055));const l=r(54302).Mirrored(["Paint","Outline"]);t.DrawLayerType=l;class c{constructor(e){if(this._type=e.type,null!=e.size){const t=e.size;this._frame=new o.default({origin:new s.default({x:0,y:0}),size:t,rotation:0,scale:1}),this._paths=[]}else null!=e.frame&&null!=e.paths&&(this._frame=e.frame,this._paths=e.paths);e.id?this._id=e.id:this._id=(0,i.generateLayerId)(e.type),Object.freeze(this)}delete(){}_update(e){let t=this._paths;null!=e.paths&&(t=e.paths);const r=this._frame,n=this._type;return new c({id:this.id,paths:t,frame:r,type:n})}setOrigin(){throw new TypeError("MediaEditor:DrawLayer resetting origin is not allowed")}setRotation(){throw new TypeError("MediaEditor:DrawLayer resetting rotation is not allowed")}setScale(){throw new TypeError("MediaEditor:DrawLayer resetting scale is not allowed")}addPath(e){const t=new a.default(e),r=[...this._paths,t];return this._update({paths:r})}clearPaths(){return this._update({paths:[]})}isEmpty(){return 0===this._paths.length}getAllPoints(){return this.paths.reduce(((e,t)=>(!t.smoothing&&e.length&&e.push(e[e.length-1]),t.isDrag()&&e.push(t.points[0]),e.push(...t.points.flatMap((e=>t.isSmooth()?[e]:[e,e]))),e)),[])}get paths(){return this._paths}get editable(){return!1}get id(){return this._id}get type(){return this._type}get frame(){return this._frame}get origin(){return this._frame.origin}get size(){return this._frame.size}get x(){return this._frame.x}get y(){return this._frame.y}get width(){return this._frame.width}get height(){return this._frame.height}get rotation(){return this._frame.rotation}get scale(){return this._frame.scale}}t.DrawLayer=c},39989:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayerType=t.ImageLayer=void 0;var i=n(r(81109)),a=n(r(18446)),s=r(83428),o=n(r(24055)),l=n(r(46668));const c=r(54302).Mirrored(["Image","Emoji","Sticker","Background"]);t.ImageLayerType=c;class d{static create(e){var t;const r=e.image.width,n=e.image.height;if(!r||!n)throw new Error("Image must have valid width and height");return new d({id:(0,s.generateLayerId)("image"),type:e.type,image:e.image,editable:e.editable,frame:new o.default({origin:e.origin,size:new l.default({width:r,height:n}),rotation:null!==(t=e.rotation)&&void 0!==t?t:0,scale:e.scale})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setFrame(e){return this._update({frame:e})}setImage(e){return this._update({image:e})}setEditable(e){return this._update({editable:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.image){const r=e.image.width,n=e.image.height;if(!r||!n)throw new Error("Image must have valid width and height");t.image=e.image,t.frame=new o.default({origin:this.frame.origin,size:new l.default({width:r,height:n}),rotation:this.frame.rotation,scale:this.frame.scale})}return null!=e.editable&&(t.editable=e.editable),null!=e.frame&&(t.frame=e.frame),(0,a.default)(this._props,t)?this:new d(t)}get image(){return this._props.image}get editable(){return this._props.editable}get id(){return this._props.id}get frame(){return this._props.frame}get origin(){return this._props.frame.origin}get size(){return this._props.frame.size}get x(){return this._props.frame.x}get y(){return this._props.frame.y}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get rotation(){return this._props.frame.rotation}get scale(){return this._props.frame.scale}isSticker(){return this._props.type===c.Sticker}isEmoji(){return this._props.type===c.Emoji}isBackground(){return this._props.type===c.Background}}t.ImageLayer=d},81829:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayer=t.DEFAULT_FONT_SIZE=void 0;var i=n(r(81109)),a=n(r(18446)),s=r(16241),o=r(92320),l=(r(39581),r(83428)),c=n(r(16186)),d=n(r(24055)),u=n(r(46668)),p=r(31323),h=r(51234);t.DEFAULT_FONT_SIZE=18;const f={lineVerticalPadding:6,lineHorizontalPadding:8,layerPadding:6,backgroundBorderRadius:5,backgroundShadow:{offsetX:0,offsetY:1,radius:6,spread:0,color:new s.Color(0,0,0,.32)}};class _{static create(e){var t;const r=[],n=m(r,f);let i=0;return null!=e.rotation&&(i=e.rotation),new _({id:(0,l.generateLayerId)("text"),text:"",textColor:e.textColor,textBackground:e.textBackground,font:e.font,alignment:e.alignment,lines:r,frame:new d.default({origin:new c.default({x:e.origin.x-n.width/2,y:e.origin.y-n.height/2}),size:n,rotation:i,scale:null!==(t=e.scale)&&void 0!==t?t:1}),maxWidth:0,backgroundPath:""}).setText(e.text)}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setText(e){return this._update({text:e})}setTextColor(e){return this._update({textColor:e})}setTextBackground(e){return this._update({textBackground:e})}setFont(e){return this._update({font:e})}setAlignment(e){return this._update({alignment:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.frame&&(t.frame=e.frame),null!=e.textColor&&(t.textColor=e.textColor),null!=e.textBackground&&(t.textBackground=e.textBackground),null!=e.text&&e.text!==t.text||null!=e.font&&e.font!==t.font){var r,n;t.text=null!==(r=e.text)&&void 0!==r?r:t.text,t.font=null!==(n=e.font)&&void 0!==n?n:t.font,t.lines=(0,h.getLines)(t.text,t.font,18,this._props.maxWidth);const i=m(t.lines,f),a=t.frame.size,s=t.frame.origin,o=new c.default({x:s.x+a.width/2-i.width/2,y:s.y+a.height/2-i.height/2});t.frame=t.frame.update({origin:o,size:i})}if(null!=e.alignment&&(t.alignment=e.alignment),this.font!==t.font||this.text!==t.text||this.alignment!==t.alignment){const e=t.lines.map((e=>e.width));t.backgroundPath=(0,p.generateTextBackgroundPath)(e,t.alignment,{lineVerticalPadding:this.styles.lineVerticalPadding,lineHorizontalPadding:this.styles.lineHorizontalPadding,lineHeight:this.lineHeight,arcSize:this.styles.backgroundBorderRadius})}return(0,a.default)(this._props,t)?this:new _(t)}get lines(){return this._props.lines}get linesOfText(){return this.lines.map((e=>e.text))}get lineWidths(){return this.lines.map((e=>e.width))}get numberOfLines(){return this.lines.length}get fontSize(){return 18}get lineHeight(){return this.fontSize}get styles(){return f}get text(){return this._props.text}get textColor(){return this._props.textColor}get textBackgroundColor(){return this.textColor.isLight()?(0,o.getColorValue)(o.COLORS.BLACK):(0,o.getColorValue)(o.COLORS.WHITE)}get textBackground(){return this._props.textBackground}get font(){return this._props.font}get editable(){return!0}get id(){return this._props.id}get alignment(){return this._props.alignment}get frame(){return this._props.frame}get origin(){return this.frame.origin}get size(){return this.frame.size}get x(){return this.frame.x}get y(){return this.frame.y}get width(){return this.frame.width}get height(){return this.frame.height}get rotation(){return this.frame.rotation}get scale(){return this.frame.scale}get backgroundPath(){return this._props.backgroundPath}}function m(e,t){const r=Math.max(...e.map((e=>e.width)),0)+2*t.lineHorizontalPadding+2*t.layerPadding,n=e.length*(18+2*t.lineVerticalPadding)+2*t.layerPadding;return new u.default({width:r,height:n})}t.TextLayer=_},16241:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0,t.cleanHex=o,t.compareHex=function(e,t){if(!e||!t)return!1;const r=o(e),n=o(t);if(r===n)return!0;let i=0,a=0;for(;i<e.length;){if(r[i]!==n[a]||r[i]!==n[a+1])return!1;i+=1,a+=2}return!0},t.isValidHex=function(e){if(!e)return!1;const t=o(e);if(3===t.length)return r.test(t);if(6===t.length)return n.test(t);return!1};const r=/^[0-9A-F]{3}$/i,n=/^[0-9A-F]{6}$/i;class i{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e<0||e>255)throw new RangeError(`red (${e} given) should be >= 0 and <= 255`);if(t<0||t>255)throw new RangeError(`green (${t} given) should be >= 0 and <= 255`);if(r<0||r>255)throw new RangeError(`blue (${r} given) should be >= 0 and <= 255`);if(n<0||n>1)throw new RangeError(`alpha (${n} given) should be >= 0 and <= 1`);this._red=e,this._green=t,this._blue=r,this._alpha=n}static fromHex(e){let t=e.trim().toLowerCase();if(t.length&&"#"===t[0]&&(t=t.substr(1)),3!==t.length&&6!==t.length)throw new RangeError(`hex ${e} does not have 3 or 6 digits`);3===t.length&&(t=`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`);const r=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),a=parseInt(t.substr(4,2),16);if(isNaN(r)||isNaN(n)||isNaN(a))throw new RangeError(`hex ${e} is invalid`);return new i(r,n,a,1)}static _fromHsl(e,t,r){let n,s,o;if(0===t||0===r)n=s=o=r;else{const i=r<.5?r*(1+t):r+t-r*t,l=2*r-i;n=a(l,i,e+1/3),s=a(l,i,e),o=a(l,i,e-1/3)}return new i(Math.round(255*n),Math.round(255*s),Math.round(255*o))}toRgb(){return{red:this._red,green:this._green,blue:this._blue}}toRgba(){return{red:this._red,green:this._green,blue:this._blue,alpha:this._alpha}}toRgbString(){return`rgb(${this._red}, ${this._green}, ${this._blue})`}toRgbaString(){return`rgba(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}toHex(){return`#${s(this._red.toString(16),2)}${s(this._green.toString(16),2)}${s(this._blue.toString(16),2)}`.toUpperCase()}toHsl(){const e=this._red/255,t=this._green/255,r=this._blue/255,n=Math.max(e,t,r),i=Math.min(e,t,r);let a=(n+i)/2,s=(n+i)/2;const o=(n+i)/2;if(n===i)a=s=0;else{const l=n-i;switch(s=o>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return{hue:a,saturation:s,lightness:o}}getBackgroundAndTintColors(){const{hue:e,saturation:t,lightness:r}=this.toHsl();let n,a;if(r<.55&&t>.1){let s=e;e>.08&&e<.22&&(s=e<.08+.14?.08:.22),n=i._fromHsl(s,t<.01?0:Math.max(t,.75),Math.min(r,.25)),a=new i(255,255,255,1)}else n=i._fromHsl(e,Math.min(t,.33),Math.max(r,.9)),a=i._fromHsl(e,0===t?0:.4,.2);return{backgroundColor:n,tintColor:a}}withAlpha(e){return new i(this._red,this._green,this._blue,e)}isLight(){return.299*this._red+.587*this._green+.114*this._blue>190}isWhite(){const{lightness:e}=this.toHsl();return e>=.996}equals(e){return this._red===e._red&&this._green===e._green&&this._blue===e._blue&&this._alpha===e._alpha}clone(){return new i(this._red,this._green,this._blue,this._alpha)}toString(){return`(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}get red(){return this._red}get green(){return this._green}get blue(){return this._blue}get alpha(){return this._alpha}}function a(e,t,r){let n=r;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function s(e,t){return e.length>=t?e:"0".repeat(t-e.length)+e}function o(e){let t=e.trim();return"#"===t.substring(0,1)&&(t=t.substring(1).toLowerCase()),t}t.Color=i,i.Black=new i(0,0,0),i.White=new i(255,255,255)},83428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerId=function(e){const t=Math.random().toString(36).substring(2,10);return`${e}-${t}`}},48014:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=1/0,a=1/0,s=0,o=0;e.forEach((e=>{const t=e.x,r=e.y;t<n&&(n=t),t>s&&(s=t),r<a&&(a=r),r>o&&(o=r)}));const l=s-n,c=o-a;return i.default.create({x:n,y:a,width:l,height:c,rotation:t,scale:r})};var i=n(r(24055))},47732:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_DOMINANT_COLOR=void 0,t.getDominantColor=function(e){const t=function(e){const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return null;const n=t.height=e.height,i=t.width=e.width;r.drawImage(e,0,0);try{return r.getImageData(0,0,i,n).data}catch(e){return null}}(e);return t?function(e){let t=0,r=0,i=0,a=0,s=0;for(let n=0;n<e.length;n+=20){const o=e[n+3],l=e[n]*o,c=e[n+1]*o,d=e[n+2]*o;t+=l,r+=c,i+=d,a+=o,s++}return a?new n.Color(Math.round(t/a),Math.round(r/a),Math.round(i/a),Math.round(a/s)/255):new n.Color(0,0,0,0)}(t):i};var n=r(16241);const i=new n.Color(220,220,220);t.DEFAULT_DOMINANT_COLOR=i},31323:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateTextBackgroundPath=function(e,t,r){const a=r.arcSize,s=[],o=[],l=Math.max(...e),c=r.lineHeight+2*r.lineVerticalPadding;e.forEach(((i,a)=>{const d=i+2*r.lineHorizontalPadding;let u=0;switch(t){case n.TextAlignment.LEFT:u=0;break;case n.TextAlignment.CENTER:u=(l-i)/2;break;case n.TextAlignment.RIGHT:u=l-i}const p=a*c;s.push({y:p,x:u}),o.push({y:p,x:u+d}),a===e.length-1&&(s.push({y:p+c,x:u}),o.push({y:p+c,x:u+d}))}));let d=[];for(let{left:e,points:t}of[{left:!0,points:s},{left:!1,points:o}]){let r=t,n=!0;for(;n;){t=r,r=[],n=!1;for(let i=0;i<t.length;i++){const s=t[i];if(0===i)r.push(s);else{r.length>=2&&r[r.length-1].x===r[r.length-2].x&&(r.pop(),n=!0);const t=r[r.length-1];s.x!==t.x&&Math.abs(s.x-t.x)<2*a&&(n=!0,e&&t.x<s.x||!e&&t.x>s.x?s.x=t.x:t.x=s.x),r.push(s)}}}const i=[];for(let e=0;e<r.length;e++){const t=r[e];if(0===e||e===r.length-1){i.push(t);continue}const n=r[e-1];if(t.x!==n.x){const e={x:n.x,y:t.y},r=i.length-1;i.length>=2&&i[r].x===e.x&&i[r].x===i[r-1].x&&i.pop(),i.push(e)}i.push(t)}e||i.reverse(),d=d.concat(i)}return function(e,t){function r(t){return 0===t?e[e.length-1]:e[t-1]}function n(t){return t===e.length-1?e[0]:e[t+1]}const a=[];for(let s=0;s<e.length;s++){const{start:o,end:l,clockwise:c}=i(e[s],r(s),n(s),t),d=s===e.length-1?0:s+1,{start:u}=i(e[d],r(d),n(d),t);0===s&&a.push(`M ${o.x},${o.y}`),a.push(`A ${t},${t} 0 0 ${c?1:0} ${l.x},${l.y}`),a.push(`L ${u.x},${u.y}`)}return a.push("Z"),a.join("\n")}(d,a)};var n=r(39581);function i(e,t,r,n){const i=t.y===e.y,a={y:i?e.y:t.y>e.y?e.y+n:e.y-n,x:i?t.x>e.x?e.x+n:e.x-n:e.x},s=e.y===r.y;return{start:a,end:{y:s?e.y:r.y>e.y?e.y+n:e.y-n,x:s?r.x>e.x?e.x+n:e.x-n:e.x},clockwise:i&&(t.y<r.y&&t.x<r.x||t.x>r.x&&t.y>r.y)||!i&&(t.y<r.y&&t.x>r.x||t.x<r.x&&t.y>r.y)}}},51234:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLines=function(e,t,r,i){const a=[];for(const o of e.split("\n")){if(""===o){a.push({text:"",width:0,words:[]});continue}const e=o.split(" ");let l="",c=0,d=[];for(let o=0;o<e.length;o++){const u=(0!==o?" ":"")+e[o],p=l+u,h=s(p,t,r);if(i>0&&h>i&&c>0)a.push({text:l,width:c,words:d}),l="",c=0,d=[],o--;else{l=p,c=h;for(const e of u.split(n.EmojiUtil.emojiRegex())){if(!e)continue;let i=null;if(n.EmojiUtil.isEmoji(e)){const t=n.EmojiUtil.getGlyphId(e);null!=t&&(i=n.EmojiUtil.getGlyphPath(t,"xlarge").high)}const a=s(e,t,r);d.push({text:e,width:a,emojiPath:i})}}}c>0&&a.push({text:l,width:c,words:d})}return a},t.getTextBounds=function(e,t){const r=`${t}px ${(0,i.getFontStyle)(e).fontFamily}`,n=l.get(r);if(null!=n)return n;const a="ABCDEF",c=Math.round(s(a,e,t)),d=t,u=o().getContext("2d");u.textBaseline="middle",u.font=r,u.fillStyle="red",u.fillText(a,0,d/2);const p=u.getImageData(0,0,c,d).data;let h=1/0,f=1/0,_=1/0;for(let e=0;e<c;e++)for(let t=0;t<d;t++){p[4*(t*c+e)+3]>0&&(f=Math.min(f,t),h=Math.min(h,e),_=Math.min(_,d-t))}u.clearRect(0,0,c,d);const m={top:f,left:h,bottom:_};return l.set(u.font,m),m};var n=r(70449),i=r(39581);let a;function s(e,t,r){const a=o().getContext("2d");a.font=`${r}px ${(0,i.getFontStyle)(t).fontFamily}`;let s=0;for(const t of e.split(n.EmojiUtil.emojiRegex()))n.EmojiUtil.isEmoji(t)?s+=r:s+=a.measureText(t).width;return s}function o(){return null==a&&(a=document.createElement("canvas"),a.width=9999,a.height=99),a}const l=new Map},89248:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.useEffect)((()=>{c.Updater.restart(!0).then((()=>{c.Updater.restart()}))}),[]),(0,d.jsxs)(o.Modal,{cover:!0,title:s.default.t(1399),children:[(0,d.jsx)("div",{children:s.default.t(1398)}),(0,d.jsx)("div",{className:a.default.pending,children:(0,d.jsx)(l.Spinner,{stroke:4,size:40,color:"highlight"})})]})};var i=r(67294),a=n(r(43760)),s=n(r(43725)),o=r(57224),l=r(11054),c=r(29898),d=r(85893)},52665:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(67294),a=n(r(39770)),s=r(55414),o=n(r(43725)),l=r(57224),c=r(85893);var d=(0,i.forwardRef)(((e,t)=>{const r=(0,i.useRef)();(0,i.useImperativeHandle)(t,(()=>({getElement:()=>r.current})));const n=t=>{var r;t.stopPropagation(),t.preventDefault(),null===(r=e.onCancel)||void 0===r||r.call(e)},d=e.onOK?(0,c.jsx)(a.default,{a8nText:"popup-controls-ok",type:"primary",onClick:t=>{var r;t.stopPropagation(),t.preventDefault(),null===(r=e.onOK)||void 0===r||r.call(e)},disabled:e.okDisabled,spinner:!0===e.okSpinner,children:e.okText||o.default.t(1765)}):null,u=e.onCancel?(0,c.jsx)(a.default,{a8nText:"popup-controls-cancel",type:e.onOK?"secondary":"primary",onClick:n,children:e.cancelText||o.default.t(1574)}):null,p={escape:e.onCancel?n:()=>{}},h=(0,c.jsxs)(c.Fragment,{children:[u,d]});return(0,c.jsx)(s.HotKeys,{handlers:p,onRef:e=>{r.current=e},children:(0,c.jsx)(l.Modal,{actions:h,children:e.children,cover:e.cover,onDragChange:e.onDragChange,onDrop:e.onDrop,type:e.type,title:e.title})})}));t.default=d},8623:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t,cancelText:r,onCancel:n,okText:s,onOK:o}=e;return(0,a.jsx)(i.default,{cover:!0,children:t,cancelText:r,onCancel:n,okText:s,onOK:o})};var i=n(r(52665)),a=r(85893)},31760:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(13959),o=r(67294),l=r(88102),c=r(28237),d=r(99608),u=n(r(88624)),p=r(19529),h=r(65044),f=r(85893);const _=r(54302).Mirrored(["INITIAL_LOAD","CONNECTING","FAKE_FILL","DOWNLOADING","ORGANIZING"]),m=r(54302).Mirrored(["NOT_STARTED","STARTED","PAST_MIN_TIME"]);var g=e=>{let{onReady:t,onLogout:r,initialLoadReady:n}=e;const g=(0,u.default)(),y=(0,o.useRef)(!1),[E,S]=(0,o.useState)(n?d.Stage.CONNECTING:d.Stage.INITIAL_LOAD),[v,T]=(0,o.useState)({INITIAL_LOAD:n?m.PAST_MIN_TIME:m.NOT_STARTED,CONNECTING:m.NOT_STARTED,FAKE_FILL:m.NOT_STARTED,DOWNLOADING:m.NOT_STARTED,ORGANIZING:m.NOT_STARTED}),[A,C]=(0,o.useState)(0),[b,P]=(0,o.useState)(null);(0,p.useListener)(l.Cmd,"offline_progress_update",(()=>{v.CONNECTING===m.PAST_MIN_TIME&&C(c.OfflineMessageHandler.getOfflineDeliveryProgress());const e=c.OfflineMessageHandler.getHasMessagesToDownload();null==b&&null!=e&&P(e)}));const M=(0,o.useCallback)(function(){var e=(0,a.default)((function*(e,t){T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:m.STARTED}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - starts minimum display time`,yield(0,s.delayMs)(t),g()&&(T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:m.PAST_MIN_TIME}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - ends minimum display time`)}));return function(){return e.apply(this,arguments)}}(),[g]),{CONNECTING:O,DOWNLOADING:I,ORGANIZING:w,FAKE_FILL:R,INITIAL_LOAD:D}=v;return(0,o.useEffect)((()=>{if(w===m.PAST_MIN_TIME)y.current||(t(),y.current=!0);else if(I===m.PAST_MIN_TIME&&A>=100&&w===m.NOT_STARTED)(0,s.delayMs)(450).then((()=>{g()&&(S(d.Stage.ORGANIZING),M(_.ORGANIZING,800))}));else if(O===m.PAST_MIN_TIME&&null!=b&&I===m.NOT_STARTED&&R===m.NOT_STARTED){const e=c.OfflineMessageHandler.getFinishedDownloading();b&&!e?(S(d.Stage.DOWNLOADING),C(c.OfflineMessageHandler.getOfflineDeliveryProgress()),M(_.DOWNLOADING,450)):(C(100),M(_.FAKE_FILL,450).then((()=>{g()&&(h.Socket.hasSynced?y.current||(t(),y.current=!0):(S(d.Stage.ORGANIZING),M(_.ORGANIZING,800)))})))}else n&&D===m.PAST_MIN_TIME&&O===m.NOT_STARTED?(S(d.Stage.CONNECTING),M(_.CONNECTING,1500)):D===m.NOT_STARTED&&M(_.INITIAL_LOAD,500)}),[A,t,b,M,g,n,O,I,w,R,D]),(0,f.jsx)(d.LoadingScreen,{stage:E,progress:A,onLogout:r})};t.default=g},94049:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(52665)),a=n(r(43725)),s=r(83578),o=r(65044),l=r(85893);t.default=()=>(0,l.jsx)(i.default,{cover:!0,cancelText:a.default.t(808),onCancel:o.Socket.logout.bind(o.Socket,!0,s.LogoutReason.UserInitiated),okText:a.default.t(734),onOK:o.Socket.poke.bind(o.Socket),children:a.default.t(1036)})},79592:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(67294),a=n(r(54186)),s=n(r(41502)),o=r(85893);function l(e,t){const{disableFromWithin:r,onDrop:n,onDragChange:l}=e,[c,d]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[h,f]=(0,i.useState)(!1),_=(0,s.default)(u),m=()=>{r&&d(!0)},g=()=>{r&&d(!1)},y=e=>{e.preventDefault(),e.stopPropagation(),u||c||(p(!0),f(!1),function(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}(e))};return(0,i.useEffect)((()=>{null!=_&&_!==u&&l&&l(u,h)}),[h,u,l,_]),(0,i.useImperativeHandle)(t,(()=>({onDragStart:m,onDragEnd:g,onDragOver:y}))),(0,o.jsx)("div",{className:a.default.mask,style:u?{}:{display:"none"},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),u&&(p(!1),f(!1))},onDrop:e=>{e.preventDefault(),e.stopPropagation(),p(!1),f(!0),n&&!c&&n(e)}},"mask")}var c=(0,i.forwardRef)(l);t.default=c},99608:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.LoadingScreen=void 0;var i=n(r(94184)),a=r(67294),s=n(r(39770)),o=n(r(43725)),l=n(r(56074)),c=n(r(49959)),d=n(r(24161)),u=n(r(59909)),p=r(19529),h=r(85893);const f=r(54302).Mirrored(["INITIAL_LOAD","CONNECTING","DOWNLOADING","ORGANIZING"]);t.Stage=f;const _=e=>{(0,a.useEffect)((()=>{const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const t=(0,u.default)();(0,p.useListener)(o.default,"locale_change",t);const r=e.stage===f.INITIAL_LOAD,n=e.stage===f.CONNECTING,_=e.stage===f.DOWNLOADING,y=e.stage===f.ORGANIZING,E=(0,i.default)(c.default.container,{[c.default.containerFixed]:!e.debug,[c.default.initialLoad]:r,[c.default.connecting]:n,[c.default.downloading]:_,[c.default.organizing]:y,[c.default.web]:!0}),S=(0,i.default)(c.default.graphic,{[c.default.shimmering]:r||y}),v=(0,i.default)(c.default.logout,{[c.default.showWarning]:_}),T=(0,i.default)(c.default.warning,{[c.default.showWarning]:_});let A;switch(e.stage){case f.INITIAL_LOAD:A=o.default.t(1927);break;case f.CONNECTING:A=o.default.t(370);break;case f.DOWNLOADING:A=(0,h.jsx)(l.default,{id:758,params:{progress:e.progress}});break;case f.ORGANIZING:A=o.default.t(1021)}return(0,h.jsxs)("div",{className:E,children:[(0,h.jsx)("div",{className:S,children:(0,h.jsx)(m,{})}),(0,h.jsx)("div",{className:c.default.progress,children:(0,h.jsx)(d.default,{value:e.progress,max:100})}),(0,h.jsx)("div",{className:c.default.main,children:A}),(0,h.jsxs)("div",{className:c.default.secondary,children:[(0,h.jsx)(g,{}),"  ",o.default.t(414)]}),null,null!=e.onLogout&&(0,h.jsx)("div",{className:v,children:(0,h.jsx)(s.default,{type:"plain-white",onClick:e.onLogout,children:o.default.t(808)})}),(0,h.jsx)("div",{className:T,children:o.default.t(759)})]})},m=()=>(0,h.jsx)("span",{children:(0,h.jsxs)("svg",{width:"250px",height:"52px",viewBox:"0 0 250 52",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,h.jsxs)("g",{className:c.default.dots,children:[(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"65.7636689",cy:"21.1046108",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"81.0791876",cy:"19.3283142",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"96.3947063",cy:"17.7846275",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"111.710225",cy:"17.5274031",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"127.025744",cy:"17.6118619",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"142.341262",cy:"18.4196288",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"157.656781",cy:"19.9893339",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"172.9723",cy:"22.0657859",r:"3.65625"})]}),(0,h.jsx)("path",{className:c.default.laptop,d:"M190.14097 4.7518926h48.227869l.281462-.00596781c1.058365-.00288774 2.664865.25185461 2.695721 2.87464716.142823 12.13996425 0 22.28077555 0 34.40910725 0 .06028-.024112.168784-.036168.217008l-16.394805-.0086927c-12.47317.0007215-24.136918.0136044-37.78743-.0033633l-.010915-6.2953341c-.030319-9.5718533-.105914-18.2714581.010915-28.31872515.033356-2.86867935 1.976535-2.91690333 3.013351-2.86867935zm20.097267 4.28597465l-19.256815-.00079524.002426 4.98254029c-.000422 6.5558423-.012657 12.8111695-.002954 19.3619492l.011919 4.9777941h46.536157l.008754-4.9777414c.010547-8.1882109.002637-15.913459.002637-24.3331514l-27.302124-.01059555zM179.195421 44.6572387c.397848-.036168.807752-.024112 1.2056-.024112 9.620684 0 19.241369-.012056 28.862053 0 .132616.4701838.54252 1.6393289 1.036816 1.6393289 3.255119.012056 4.510238 0 7.765357 0 .542519.036168.988591-1.1450331 1.133263-1.6513849 9.910029 0 19.820057.012056 29.730086.012056.084392.012056.265232.036168.349624.048224-.016075.2571945-.016075 1.0085894 0 2.2541846 0 1.4209691-1.193544 1.8201689-1.965128 2.1215688-.421959.1205599-.868031.1326159-1.289991.1928959h-63.560505c-.651024-.072336-1.350272-.108504-1.916904-.4701838-.566631-.2893439-1.000647-.7595278-1.350271-1.2779356v-2.8446419z",fill:"currentColor"}),(0,h.jsx)("path",{className:c.default.logo,d:"M37.7314595,31.1612046 C37.0876293,30.8391042 33.9223475,29.2816062 33.332139,29.0666255 C32.7419305,28.8517683 32.3127104,28.7444016 31.8834903,29.3887258 C31.4542703,30.0332973 30.2204788,31.4835521 29.8447567,31.91339 C29.4692818,32.3428571 29.0936834,32.3968494 28.4499768,32.0745019 C27.8060232,31.7521544 25.7314595,31.0723707 23.272278,28.8787027 C21.3582085,27.171583 20.0661004,25.0632896 19.6905019,24.4185946 C19.315027,23.7741467 19.6505946,23.4257297 19.9729421,23.1046178 C20.2625483,22.8161235 20.6167722,22.352556 20.9386255,21.9767104 C21.2606023,21.6007413 21.3678456,21.3320154 21.5824556,20.9026718 C21.7970657,20.472834 21.6898224,20.0968649 21.528834,19.7746409 C21.3678456,19.452417 20.0801853,16.2831815 19.543722,14.993915 C19.0210965,13.7387491 18.4903166,13.9087567 18.0950733,13.8887413 C17.7199691,13.870085 17.2902548,13.8661313 16.8611583,13.8661313 C16.4319382,13.8661313 15.7343629,14.0272433 15.144278,14.6716911 C14.5540695,15.3163861 12.8908108,16.8740077 12.8908108,20.0429961 C12.8908108,23.2121081 15.1978996,26.2734826 15.5198765,26.7031969 C15.8417297,27.1330348 20.0597992,33.6360772 26.5184865,36.4250193 C28.05461,37.0883707 29.2539305,37.4846023 30.1888494,37.7811274 C31.7312742,38.2713822 33.1348263,38.2021931 34.2440772,38.0363861 C35.4810811,37.8515521 38.0533127,36.478888 38.5898996,34.9750116 C39.1263629,33.470888 39.1263629,32.1818687 38.9653745,31.91339 C38.8045097,31.6447876 38.3752896,31.4835521 37.7314595,31.1612046 M25.9838765,47.2013591 L25.9752278,47.2013591 C22.1322625,47.1998763 18.3629343,46.1674749 15.0745946,44.2160926 L14.2926332,43.7519074 L6.18674906,45.8782394 L8.35027028,37.9751042 L7.84111198,37.1648494 C5.69723552,33.7549343 4.56500386,29.8139923 4.56660833,25.767166 C4.57130502,13.9587954 14.1789652,4.35187645 25.9924016,4.35187645 C31.7128649,4.35385328 37.0902239,6.58458689 41.1338378,10.6327722 C45.1773282,14.680834 47.4028724,20.0618996 47.4007737,25.7843398 C47.3959539,37.5936988 37.7882934,47.2013591 25.9838765,47.2013591 M44.2112742,7.556695 C39.3464092,2.68614672 32.8767258,0.00271814672 25.9836293,0 C11.7809421,0 0.221652509,11.5584247 0.215969112,25.7654363 C0.21411583,30.3069652 1.40058687,34.7397683 3.65553668,38.6475984 L-4.61852778e-14,52 L13.6596757,48.4167413 C17.4233205,50.4695597 21.6607876,51.5516293 25.9733745,51.5531121 L25.9838765,51.5531121 L25.984,51.5531121 C40.1852046,51.5531121 51.7456062,39.9934517 51.7512912,25.7860695 C51.7538842,18.9011274 49.0761392,12.4271197 44.2112742,7.556695",fill:"currentColor"})]})}),g=()=>(0,h.jsx)("span",{children:(0,h.jsx)("svg",{width:"10px",height:"12px",viewBox:"0 0 10 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)("path",{d:"M5.00847986,1.6 C6.38255462,1.6 7.50937014,2.67435859 7.5940156,4.02703389 L7.59911976,4.1906399 L7.599,5.462 L7.75719976,5.46214385 C8.34167974,5.46214385 8.81591972,5.94158383 8.81591972,6.53126381 L8.81591972,9.8834238 C8.81591972,10.4731038 8.34167974,10.9525438 7.75719976,10.9525438 L2.25767996,10.9525438 C1.67527998,10.9525438 1.2,10.4731038 1.2,9.8834238 L1.2,6.53126381 C1.2,5.94158383 1.67423998,5.46214385 2.25767996,5.46214385 L2.416,5.462 L2.41679995,4.1906399 C2.41679995,2.81636129 3.49135449,1.68973395 4.84478101,1.60510326 L5.00847986,1.6 Z M5.00847986,2.84799995 C4.31163824,2.84799995 3.73624912,3.38200845 3.6709675,4.06160439 L3.6647999,4.1906399 L3.663,5.462 L6.35,5.462 L6.35111981,4.1906399 C6.35111981,3.53817142 5.88169076,2.99180999 5.26310845,2.87228506 L5.13749818,2.85416626 L5.00847986,2.84799995 Z",fill:"currentColor"})})}),y=(0,a.memo)(_);t.LoadingScreen=y},7260:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(43725)),a=n(r(31230)),s=r(11054),o=r(13923),l=r(85893);var c=()=>(0,l.jsx)("div",{className:a.default.background,children:(0,l.jsxs)("div",{className:a.default.mainWrapper,children:[(0,l.jsx)(s.Spinner,{size:50,stroke:4,color:"highlight"}),(0,l.jsx)(o.TextDiv,{className:a.default.logoutTitle,size:"32",children:i.default.t(1715)}),(0,l.jsx)(o.TextDiv,{theme:"muted",children:i.default.t(1716)})]})});t.default=c},57224:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=function(e){const t=(0,o.useRef)(null),r=null!=e.title?(0,u.jsx)("div",{"data-a8n":a.default.key("popup-title"),className:d.default.popupTitle,children:e.title}):null,n=e.type===p.CustomSize&&e.dimensions?{height:`${e.dimensions.height}px`,width:`${e.dimensions.width}px`}:null,h=(0,s.default)(d.default.popup,{[d.default.popupFlexInvite]:e.type===p.Invite,[d.default.popupFlexUpgrade]:e.type===p.Upgrade,[d.default.popupBox]:e.type===p.Box,[d.default.popupFlex]:e.type===p.Flex,[d.default.popupTower]:e.type===p.Tower,[d.default.popupAuto]:e.type===p.Auto,[d.default.popupColumnButtons]:e.type===p.ColumnButtons,[d.default.popupMultiline]:e.type===p.Multiline,[d.default.popupCustomSize]:e.type===p.CustomSize}),f=(0,i.default)(e.actions)?null:(0,u.jsx)("div",{className:d.default.popupControls,children:e.actions}),_=(0,s.default)("overlay",d.default.backdrop,{[d.default.backdropCover]:e.cover,[d.default.popupGuide]:e.type===p.Guide}),m=(0,u.jsx)("div",{className:d.default.popupContainer,children:(0,u.jsx)("div",{className:h,"data-animate-modal-popup":!0,style:n,children:(0,u.jsxs)("div",{className:d.default.popupBody,"data-animate-modal-body":!0,children:[r,(0,u.jsx)("div",{"data-a8n":a.default.key("popup-contents"),className:d.default.popupContents,children:e.children}),f]})})});return(0,u.jsxs)(l.default,{className:_,onDragOver:e=>{var r;null===(r=t.current)||void 0===r||r.onDragOver(e)},onDragStart:e=>{var r;null===(r=t.current)||void 0===r||r.onDragStart(e)},onDragEnd:e=>{var r;null===(r=t.current)||void 0===r||r.onDragEnd(e)},ref:e.onRef,"data-animate-modal-backdrop":!0,children:[e.onDrop&&(0,u.jsx)(c.default,{ref:t,disableFromWithin:!0,onDragChange:e.onDragChange,onDrop:e.onDrop}),m]})},t.ModalTheme=void 0;var i=n(r(41609)),a=n(r(99964)),s=n(r(94184)),o=r(67294),l=n(r(5354)),c=n(r(79592)),d=n(r(74196)),u=r(85893);const p=r(54302).Mirrored(["Box","Flex","Guide","Tower","Auto","Invite","ColumnButtons","Multiline","Upgrade","CustomSize"]);t.ModalTheme=p},66776:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=void 0,t.ModalManager=function(e){const{type:t,contextMenuRef:r}=e,n=(0,o.useRef)(null),[S,v]=(0,o.useState)(void 0),[T,A]=(0,o.useState)(null),[C,b]=(0,o.useState)(g),[P,M]=(0,o.useState)(void 0),[O,I]=(0,o.useState)(!1),w=()=>{if(!n.current)return;const e=n.current.getNode();e&&!e.contains(document.activeElement)&&s.default.focus(e)},R=()=>{if(!n.current)return;const e=n.current.getNode();e&&s.default.focus(e)},D=e=>{(e=>{const t=e.relatedTarget,n=null==r?void 0:r.current,i=!!n&&n.isOpen();return t instanceof HTMLElement&&!e.currentTarget.contains(t)&&!i})(e)&&w()},N=e=>{S&&(v(void 0),A(null),e&&b(e))},L=e=>{e===T&&N()};let k;(0,f.useListener)(c.Cmd,`open_${t}`,(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.transition||g;const{uim:i,blockClose:s}=r;S&&(n=y);const c=(0,a.default)(`ModalManager${t}`);let d=e;t===E&&(d=(0,o.cloneElement)(e,{requestFocus:R})),l.default.unstable_batchedUpdates((()=>{v(d),A(c),b(n),M(i),I(null!=s&&s)}))})),(0,f.useListener)(c.Cmd,`close_${t}`,N),S&&(k=(0,m.jsx)(p.UIE,{displayName:`Modal${(0,i.default)(e.type)}`,escapable:!O,ref:n,requestFocus:w,requestDismiss:L.bind(null,T),children:e.type===E?(0,m.jsx)(u.default,{onBlur:D,children:S}):(0,m.jsx)(d.RotateFocus,{children:S})},T));return(0,m.jsx)(h.default.Consumer,{children:e=>(0,m.jsx)(h.default.Provider,{value:P||e,children:(0,m.jsx)(_.default,{transitionName:C,children:k})})})},t.ModalType=void 0;var i=n(r(11700)),a=n(r(73955)),s=n(r(52013)),o=r(67294),l=n(r(73935)),c=r(88102),d=r(87956),u=n(r(22179)),p=r(18644),h=n(r(2773)),f=r(19529),_=n(r(41956)),m=r(85893);const g="modal",y="none",E="modal";t.ModalType=E;t.MediaType="media"},96753:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48360)),a=n(r(43725)),s=r(57224),o=r(85893);t.default=()=>(0,o.jsx)(s.Modal,{title:i.default._("Computer not connected",null,{hk:"300jSy"}),cover:!0,children:a.default.t(750)})},43951:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48360)),a=n(r(52665)),s=r(12591),o=r(96384),l=n(r(43725)),c=r(85893);function d(){(0,s.openExternalLink)((0,o.getCannotConnectFaqUrl)())}t.default=()=>(0,c.jsx)(a.default,{cover:!0,title:l.default.t(269),okText:l.default.t(690),onOK:d,children:i.default._("Your computer is connected to a network that prevents WhatsApp from working correctly",null,{hk:"GhGFR"})})},57050:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81629)),a=n(r(30381)),s=r(67294),o=n(r(52665)),l=r(12591),c=r(96384),d=n(r(43725)),u=r(84387),p=r(99608),h=n(r(39211)),f=r(8080),_=n(r(4478)),m=r(65044),g=r(85893);class y extends s.PureComponent{constructor(e){super(e),this._forceUpdate=()=>{this.forceUpdate()},this._retried=()=>{null!=this.timeout&&(this.props.clearTimeout(this.timeout),this.timeout=null),null!=this.interval&&(this.props.clearInterval(this.interval),this.interval=null),this.setState({retriable:!1}),this.startTimeout()},this._allowRetry=()=>{this.setState({retriable:!0}),this.interval=this.props.setInterval(this._forceUpdate,1e3)},this.retry=()=>{m.Socket.poke(),this._retried()},this._onLearnMoreClick=()=>{(0,l.openExternalLink)((0,c.getCannotConnectFaqUrl)())},this.state={retriable:!1}}componentDidMount(){this.startTimeout();const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e),this.props.listeners.add(f.Stream,"change:displayInfo",this._forceUpdate),this.props.listeners.add(m.Socket,"change:retryTimestamp",this._retried)}startTimeout(){this.timeout=this.props.setTimeout(this._allowRetry,3e3)}logout(){__LOG__(2)`Startup: user selected logout`,m.Socket.logout()}render(){let e,t,r,n;const{progress:s}=this.props;switch(f.Stream.displayInfo){case f.StreamInfo.OPENING:e=d.default.t(371),t=d.default.t(750),n=this.logout;break;case f.StreamInfo.PAIRING:case f.StreamInfo.TIMEOUT:e=d.default.t(1354),t=(0,g.jsxs)("span",{children:[d.default.t(751)," ",(0,g.jsx)("span",{className:h.default.action,onClick:this._onLearnMoreClick,role:"button",children:d.default.t(690)})]}),n=this.logout;break;case f.StreamInfo.SYNCING:case f.StreamInfo.CONNECTING:return(0,g.jsx)(p.LoadingScreen,{progress:s,stage:p.Stage.INITIAL_LOAD});default:return f.Stream.mode===f.StreamMode.MAIN?(0,g.jsx)(p.LoadingScreen,{progress:s,stage:p.Stage.INITIAL_LOAD}):null}const l=this.state.retriable;if(l){const e=m.Socket.retryTimestamp-Date.now();if(isNaN(e)||e<1)r=d.default.t(1183),(0,i.default)((()=>m.Socket.poke()));else if(e<6e4){const t=Math.ceil(e/1e3);r=d.default.t(1185,{number:t,_plural:t})}else r=d.default.t(1184,{duration:a.default.duration(e).humanize()})}else r=d.default.t(1183);return(0,g.jsxs)(o.default,{cover:!0,title:e,okText:d.default.t(1181),onOK:l?this.retry:()=>{},cancelText:n?d.default.t(808):null,onCancel:n,children:[r,(0,g.jsx)("hr",{className:h.default.divider}),(0,g.jsx)("div",{className:h.default.textTip,children:t})]})}}y.displayName="Startup";var E=(0,_.default)((0,u.ListenerHOC)(y));t.default=E},37538:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,d.default)();let r,n;(0,p.useListener)(c.Stream,"change:displayInfo",t);const[m]=(0,u.default)(t,1e3),[g]=(0,h.useTimeout)(m,6e3),y=c.Stream.displayInfo;(0,i.useEffect)((()=>{g();const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const E=()=>{__LOG__(2)`Startup: user selected logout`,f.Socket.logout()};switch(y){case c.StreamInfo.OPENING:case c.StreamInfo.PAIRING:case c.StreamInfo.TIMEOUT:r=o.default.t(371),n=o.default.t(750);break;case c.StreamInfo.SYNCING:case c.StreamInfo.CONNECTING:return(0,_.jsx)(s.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:E});default:return c.Stream.mode===c.StreamMode.MAIN?(0,_.jsx)(s.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:E}):null}return(0,_.jsxs)(a.default,{cover:!0,title:r,cancelText:o.default.t(808),onCancel:E,children:[(0,_.jsx)("hr",{className:l.default.divider}),(0,_.jsx)("div",{className:l.default.textTip,children:n})]})};var i=r(67294),a=n(r(52665)),s=n(r(31760)),o=n(r(43725)),l=n(r(30173)),c=r(8080),d=n(r(59909)),u=n(r(98007)),p=r(19529),h=r(99935),f=r(65044),_=r(85893)},99736:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,l.jsxs)(i.default,{cover:!0,cancelText:a.default.t(808),onCancel:o.Socket.logout.bind(o.Socket,!0,s.LogoutReason.UserInitiated),okText:a.default.t(734),onOK:o.Socket.poke.bind(o.Socket),children:[e.description," ",e.children]})};var i=n(r(52665)),a=n(r(43725)),s=r(83578),o=r(65044),l=r(85893)},58955:(e,t,r)=>{"use strict";var n=r(20862);t.TG=function(e){const{promise:t,reason:r}=e;if(s.Logger.logUncaughtError(r,t),!d(r))return;const n=r instanceof Error&&r.stack?null:`unhandled-rejection: ${r}`;i.upload({reason:n,hasTaggedMessage:!0})},t.HC=function(e,t,n,a,u){if(function(e){const t=[...o];return t.push(...l),t.some((t=>{let{partialUserAgent:r,partialMsg:n}=t;return c.includes(r)&&String(e).includes(n)}))}(e))return __LOG__(3)`Ignored Error: ${e||(u||"").toString()}`,!0;try{const{UIM:e}=r(89618);e.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}const p=t.split("?")[0];let h;h=p&&"number"==typeof n?` (${p}:${n}:${a})`:p?` (${p})`:"";if("Script error."===e&&!u)return s.Logger.logUncaughtError(`${h} ${e}`),p&&i.upload({reason:"script-error",hasTaggedMessage:!0}),!1;const f=u instanceof Error&&u.stack?u:`${e||`Given: ${String(u)}`}`;if(s.Logger.logUncaughtError(f),!d(u))return!0;return i.upload({reason:null,hasTaggedMessage:!0}),!0};var i=n(r(85965)),a=r(64103),s=r(70818);const o=[{partialUserAgent:"Chrome",partialMsg:"ResizeObserver loop limit exceeded"}],l=[{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'style' of null"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"Unexpected token :"},{partialUserAgent:"Firefox/52.0,,Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.4) Gecko/20100101 Firefox/52.0",partialMsg:"Cannot read property 'style' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15",partialMsg:"is not an object"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'getElementsByTagName' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36",partialMsg:"Can't find variable: dismissKeyboard"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"ReferenceError: None is not defined"}],c=window.navigator.userAgent;function d(e){return!(e instanceof a.DbOnLogoutAbort)}},27838:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getIsTabActive=function(){return o},t.isAnotherTabActive=function(){return l.apply(this,arguments)},t.setTabActive=function(){o=!0};var i=n(r(48926)),a=n(r(37362)),s=n(r(79485));let o=!1;function l(){return(l=(0,i.default)((function*(){const e=navigator.serviceWorker;if(null==e?void 0:e.controller)try{return(yield s.default.request(e.controller,a.default.ACTIVE_TAB)).some((e=>!0===e.isActive))}catch(e){return __LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("ACTIVE_TAB service worker call failed"),!1}return!1}))).apply(this,arguments)}},97628:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeContext=t.THEME_ASSETS=void 0,t.applyThemeToUI=p,t.getSystemThemeMode=d,t.getTheme=function(){var e;if(d())return o.default.currentTheme;return null!==(e=(0,s.getTheme)())&&void 0!==e?e:a.default.DEFAULT_THEME},t.setSystemThemeMode=u,t.setTheme=c;var i=r(67294),a=n(r(69618)),s=r(99234),o=n(r(10258));const l={light:[{id:"bg-chat-light",selectors:["[data-asset-chat-background-light]"],low:{default:r(17498)},high:{default:r(17498)}},{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:r(54057)},high:{default:r(54057)}},{id:"intro-connection-light",selectors:["[data-asset-intro-image-light]"],low:{default:r(20005)},high:{default:r(20733)}}],dark:[{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:r(54057)},high:{default:r(54057)}},{id:"intro-connection-dark",selectors:["[data-asset-intro-image-dark]"],low:{default:r(18714)},high:{default:r(30046)}}]};function c(e){(0,s.setTheme)(e),p(e)}function d(){var e;return null===(e=(0,s.getSystemThemeMode)())||void 0===e||e}function u(e){(0,s.setSystemThemeMode)(e)}function p(e){const t=document.body;null==t||t.classList.toggle("dark","dark"===e)}t.THEME_ASSETS=l;const h={theme:o.default.currentTheme,systemThemeMode:!0,setTheme:c,setSystemThemeMode:u},f=(0,i.createContext)(h);t.ThemeContext=f},99964:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={key(e){}};t.default=r},45120:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(9686));var a=new class{constructor(){this.shouldIndicateFocusTimestamp=0}shouldIndicateFocus(){this.shouldIndicateFocusTimestamp=Date.now()}maybeIndicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;Date.now()-this.shouldIndicateFocusTimestamp>200||this.indicateFocus(e,t)}indicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}};t.default=a},52013:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(57319);let i=[],a=!1;const s=new n.ShiftTimer((function(){i=[],a=!1}));document.addEventListener("keydown",(()=>{s.forceRunNow()}),{capture:!0,passive:!0});var o={focus(e,t){if(e&&(!i.length||e!==i[i.length-1])){if(a=a||null!=window.event,function(e){5===i.length&&i.shift(),i.push(e)}(e),function(){if(i.length<5)return!1;const e=new Set;for(let t=0;t<i.length;t++){if(e.has(i[t]))return!0;e.add(i[t])}return!1}()&&!a)return __LOG__(4,void 0,new Error,!0)`Focus loop encountered.`,void SEND_LOGS("focus-loop");s.onOrBefore(75),e.focus(t)}}};t.default=o},28298:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uiPadding=t.uiMargin=void 0;n(r(56720));const i={horizMinus6:{marginEnd:"n3fdhnkw",marginStart:"heai6z19"},startMinus6:{marginStart:"heai6z19"},endMinus6:{marginEnd:"n3fdhnkw"},horizMinus4:{marginEnd:"isg5rw3j",marginStart:"nxn8agaf"},startMinus4:{marginStart:"nxn8agaf"},endMinus4:{marginEnd:"isg5rw3j"},topMinus3:{marginTop:"if44n927"},topMinus1:{marginTop:"o9i7y497"},all0:{marginTop:"tt8xd2xn",marginEnd:"jnwc1y2a",marginBottom:"mpdn4nr2",marginStart:"svoq16ka"},horiz0:{marginEnd:"jnwc1y2a",marginStart:"svoq16ka"},vert0:{marginTop:"tt8xd2xn",marginBottom:"mpdn4nr2"},top0:{marginTop:"tt8xd2xn"},bottom0:{marginBottom:"mpdn4nr2"},end0:{marginEnd:"jnwc1y2a"},start0:{marginStart:"svoq16ka"},top1:{marginTop:"b9l0eqez"},all2:{marginTop:"kiiy14zj",marginEnd:"om6y7gxh",marginBottom:"j4enbv94",marginStart:"gj5xqxfh"},horiz2:{marginEnd:"om6y7gxh",marginStart:"gj5xqxfh"},vert2:{marginTop:"kiiy14zj",marginBottom:"j4enbv94"},top2:{marginTop:"kiiy14zj"},bottom2:{marginBottom:"j4enbv94"},end2:{marginEnd:"om6y7gxh"},start2:{marginStart:"gj5xqxfh"},all3:{marginTop:"g1eqewly",marginEnd:"kjemk6od",marginBottom:"kzyzudjh",marginStart:"k6y3xtnu"},horiz3:{marginEnd:"kjemk6od",marginStart:"k6y3xtnu"},vert3:{marginTop:"g1eqewly",marginBottom:"kzyzudjh"},top3:{marginTop:"g1eqewly"},bottom3:{marginBottom:"kzyzudjh"},end3:{marginEnd:"kjemk6od"},start3:{marginStart:"k6y3xtnu"},all4:{marginTop:"qt60bha0",marginEnd:"mw4yctpw",marginBottom:"inww9tbj",marginStart:"qnz2jpws"},horiz4:{marginEnd:"mw4yctpw",marginStart:"qnz2jpws"},vert4:{marginTop:"qt60bha0",marginBottom:"inww9tbj"},top4:{marginTop:"qt60bha0"},bottom4:{marginBottom:"inww9tbj"},end4:{marginEnd:"mw4yctpw"},start4:{marginStart:"qnz2jpws"},all5:{marginTop:"hymafltn",marginEnd:"q471nw87",marginBottom:"g105fvfm",marginStart:"p3lsiedt"},horiz5:{marginEnd:"q471nw87",marginStart:"p3lsiedt"},vert5:{marginTop:"hymafltn",marginBottom:"g105fvfm"},top5:{marginTop:"hymafltn"},bottom5:{marginBottom:"g105fvfm"},end5:{marginEnd:"q471nw87"},start5:{marginStart:"p3lsiedt"},all6:{marginTop:"iin4x6c7",marginEnd:"claouzo6",marginBottom:"ngycyvoj",marginStart:"oz0g9ue8"},horiz6:{marginEnd:"claouzo6",marginStart:"oz0g9ue8"},vert6:{marginTop:"iin4x6c7",marginBottom:"ngycyvoj"},top6:{marginTop:"iin4x6c7"},bottom6:{marginBottom:"ngycyvoj"},end6:{marginEnd:"claouzo6"},start6:{marginStart:"oz0g9ue8"},all8:{marginTop:"dj1c3cmq",marginEnd:"bugiwsl0",marginBottom:"or9x5nie",marginStart:"fooq7fky"},horiz8:{marginEnd:"bugiwsl0",marginStart:"fooq7fky"},vert8:{marginTop:"dj1c3cmq",marginBottom:"or9x5nie"},top8:{marginTop:"dj1c3cmq"},bottom8:{marginBottom:"or9x5nie"},end8:{marginEnd:"bugiwsl0"},start8:{marginStart:"fooq7fky"},all10:{marginTop:"opp68qpq",marginEnd:"spjzgwxb",marginBottom:"brac1wpa",marginStart:"a3oefunm"},horiz10:{marginEnd:"spjzgwxb",marginStart:"a3oefunm"},vert10:{marginTop:"opp68qpq",marginBottom:"brac1wpa"},top10:{marginTop:"opp68qpq"},bottom10:{marginBottom:"brac1wpa"},end10:{marginEnd:"spjzgwxb"},start10:{marginStart:"a3oefunm"},all12:{marginTop:"iy2cu22y",marginEnd:"oz083wsx",marginBottom:"t4zgqcuo",marginStart:"g9zvcdbd"},horiz12:{marginEnd:"oz083wsx",marginStart:"g9zvcdbd"},vert12:{marginTop:"iy2cu22y",marginBottom:"t4zgqcuo"},top12:{marginTop:"iy2cu22y"},bottom12:{marginBottom:"t4zgqcuo"},end12:{marginEnd:"oz083wsx"},start12:{marginStart:"g9zvcdbd"},bottom14:{marginBottom:"k0lnf8n4"},all15:{marginTop:"eg3lofc5",marginEnd:"ds60debm",marginBottom:"pz0xruzv",marginStart:"htq1q0kf"},horiz15:{marginEnd:"ds60debm",marginStart:"htq1q0kf"},vert15:{marginTop:"eg3lofc5",marginBottom:"pz0xruzv"},top15:{marginTop:"eg3lofc5"},bottom15:{marginBottom:"pz0xruzv"},end15:{marginEnd:"ds60debm"},start15:{marginStart:"htq1q0kf"},top16:{marginTop:"fgtikrv0"},all20:{marginTop:"c46o30wg",marginEnd:"rvlagp7p",marginBottom:"du8bjn1j",marginStart:"bv1sdm6y"},horiz20:{marginEnd:"rvlagp7p",marginStart:"bv1sdm6y"},vert20:{marginTop:"c46o30wg",marginBottom:"du8bjn1j"},top20:{marginTop:"c46o30wg"},bottom20:{marginBottom:"du8bjn1j"},end20:{marginEnd:"rvlagp7p"},start20:{marginStart:"bv1sdm6y"},vert28:{marginTop:"ignnouf6",marginBottom:"bibl1e27"},top28:{marginTop:"ignnouf6"},bottom28:{marginBottom:"bibl1e27"},all30:{marginTop:"nylzjxre",marginEnd:"lfum0007",marginBottom:"bvhm1occ",marginStart:"r6x3u63k"},horiz30:{marginEnd:"lfum0007",marginStart:"r6x3u63k"},vert30:{marginTop:"nylzjxre",marginBottom:"bvhm1occ"},top30:{marginTop:"nylzjxre"},bottom30:{marginBottom:"bvhm1occ"},end30:{marginEnd:"lfum0007"},start30:{marginStart:"r6x3u63k"}},a={horizMinus6:i.horizMinus6,startMinus6:i.startMinus6,endMinus6:i.endMinus6,horizMinus4:i.horizMinus4,startMinus4:i.startMinus4,endMinus4:i.endMinus4,topMinus3:i.topMinus3,topMinus1:i.topMinus1,all0:i.all0,horiz0:i.horiz0,vert0:i.vert0,top0:i.top0,bottom0:i.bottom0,end0:i.end0,start0:i.start0,top1:i.top1,all2:i.all2,horiz2:i.horiz2,vert2:i.vert2,top2:i.top2,bottom2:i.bottom2,end2:i.end2,start2:i.start2,all3:i.all3,horiz3:i.horiz3,vert3:i.vert3,top3:i.top3,bottom3:i.bottom3,end3:i.end3,start3:i.start3,all4:i.all4,horiz4:i.horiz4,vert4:i.vert4,top4:i.top4,bottom4:i.bottom4,end4:i.end4,start4:i.start4,all5:i.all5,horiz5:i.horiz5,vert5:i.vert5,top5:i.top5,bottom5:i.bottom5,end5:i.end5,start5:i.start5,all6:i.all6,horiz6:i.horiz6,vert6:i.vert6,top6:i.top6,bottom6:i.bottom6,end6:i.end6,start6:i.start6,all8:i.all8,horiz8:i.horiz8,vert8:i.vert8,top8:i.top8,bottom8:i.bottom8,end8:i.end8,start8:i.start8,all10:i.all10,horiz10:i.horiz10,vert10:i.vert10,top10:i.top10,bottom10:i.bottom10,end10:i.end10,start10:i.start10,all12:i.all12,horiz12:i.horiz12,vert12:i.vert12,top12:i.top12,bottom12:i.bottom12,end12:i.end12,start12:i.start12,bottom14:i.bottom14,all15:i.all15,horiz15:i.horiz15,vert15:i.vert15,top15:i.top15,bottom15:i.bottom15,end15:i.end15,start15:i.start15,top16:i.top16,all20:i.all20,horiz20:i.horiz20,vert20:i.vert20,top20:i.top20,bottom20:i.bottom20,end20:i.end20,start20:i.start20,vert28:i.vert28,top28:i.top28,bottom28:i.bottom28,all30:i.all30,horiz30:i.horiz30,vert30:i.vert30,top30:i.top30,bottom30:i.bottom30,end30:i.end30,start30:i.start30};t.uiMargin=a;const s={all0:{paddingTop:"i5tg98hk",paddingEnd:"f9ovudaz",paddingBottom:"przvwfww",paddingStart:"gx1rr48f"},horiz0:{paddingEnd:"f9ovudaz",paddingStart:"gx1rr48f"},vert0:{paddingTop:"i5tg98hk",paddingBottom:"przvwfww"},top0:{paddingTop:"i5tg98hk"},bottom0:{paddingBottom:"przvwfww"},end0:{paddingEnd:"f9ovudaz"},start0:{paddingStart:"gx1rr48f"},top1:{paddingTop:"qbqilfqo"},all2:{paddingTop:"ppypbuwx",paddingEnd:"fhfm09ip",paddingBottom:"s8gyl5p1",paddingStart:"mjn2akup"},horiz2:{paddingEnd:"fhfm09ip",paddingStart:"mjn2akup"},vert2:{paddingTop:"ppypbuwx",paddingBottom:"s8gyl5p1"},top2:{paddingTop:"ppypbuwx"},bottom2:{paddingBottom:"s8gyl5p1"},end2:{paddingEnd:"fhfm09ip"},start2:{paddingStart:"mjn2akup"},all3:{paddingTop:"ocd2b0bc",paddingEnd:"folpon7g",paddingBottom:"aa0kojfi",paddingStart:"snweb893"},horiz3:{paddingEnd:"folpon7g",paddingStart:"snweb893"},vert3:{paddingTop:"ocd2b0bc",paddingBottom:"aa0kojfi"},top3:{paddingTop:"ocd2b0bc"},bottom3:{paddingBottom:"aa0kojfi"},end3:{paddingEnd:"folpon7g"},start3:{paddingStart:"snweb893"},all4:{paddingTop:"eujn52yf",paddingEnd:"jfqm35v0",paddingBottom:"ckm995li",paddingStart:"bdbt56hn"},horiz4:{paddingEnd:"jfqm35v0",paddingStart:"bdbt56hn"},vert4:{paddingTop:"eujn52yf",paddingBottom:"ckm995li"},top4:{paddingTop:"eujn52yf"},bottom4:{paddingBottom:"ckm995li"},end4:{paddingEnd:"jfqm35v0"},start4:{paddingStart:"bdbt56hn"},all5:{paddingTop:"qomlamqu",paddingEnd:"lnjlmjd6",paddingBottom:"bxcbqipq",paddingStart:"mc6o24uu"},horiz5:{paddingEnd:"lnjlmjd6",paddingStart:"mc6o24uu"},vert5:{paddingTop:"qomlamqu",paddingBottom:"bxcbqipq"},top5:{paddingTop:"qomlamqu"},bottom5:{paddingBottom:"bxcbqipq"},end5:{paddingEnd:"lnjlmjd6"},start5:{paddingStart:"mc6o24uu"},all6:{paddingTop:"n1yiu2zv",paddingEnd:"abxuf49s",paddingBottom:"eb4rp10x",paddingStart:"mhcwslh8"},horiz6:{paddingEnd:"abxuf49s",paddingStart:"mhcwslh8"},vert6:{paddingTop:"n1yiu2zv",paddingBottom:"eb4rp10x"},top6:{paddingTop:"n1yiu2zv"},bottom6:{paddingBottom:"eb4rp10x"},end6:{paddingEnd:"abxuf49s"},start6:{paddingStart:"mhcwslh8"},top7:{paddingTop:"esbfogcw"},all8:{paddingTop:"fbgy3m38",paddingEnd:"ft2m32mm",paddingBottom:"oq31bsqd",paddingStart:"nu34rnf1"},horiz8:{paddingEnd:"ft2m32mm",paddingStart:"nu34rnf1"},vert8:{paddingTop:"fbgy3m38",paddingBottom:"oq31bsqd"},top8:{paddingTop:"fbgy3m38"},bottom8:{paddingBottom:"oq31bsqd"},end8:{paddingEnd:"ft2m32mm"},start8:{paddingStart:"nu34rnf1"},all9:{paddingTop:"qlb265nb",paddingEnd:"i8go5xc4",paddingBottom:"n0ziumnz",paddingStart:"e1yunedv"},horiz9:{paddingEnd:"i8go5xc4",paddingStart:"e1yunedv"},vert9:{paddingTop:"qlb265nb",paddingBottom:"n0ziumnz"},top9:{paddingTop:"qlb265nb"},bottom9:{paddingBottom:"n0ziumnz"},end9:{paddingEnd:"i8go5xc4"},start9:{paddingStart:"e1yunedv"},all10:{paddingTop:"emrlamx0",paddingEnd:"itegkywt",paddingBottom:"aiput80m",paddingStart:"rppts313"},horiz10:{paddingEnd:"itegkywt",paddingStart:"rppts313"},vert10:{paddingTop:"emrlamx0",paddingBottom:"aiput80m"},top10:{paddingTop:"emrlamx0"},bottom10:{paddingBottom:"aiput80m"},end10:{paddingEnd:"itegkywt"},start10:{paddingStart:"rppts313"},all12:{paddingTop:"b7n2qyd4",paddingEnd:"btzf6ewn",paddingBottom:"ekpn4oxx",paddingStart:"nqtxkp62"},horiz12:{paddingEnd:"btzf6ewn",paddingStart:"nqtxkp62"},vert12:{paddingTop:"b7n2qyd4",paddingBottom:"ekpn4oxx"},top12:{paddingTop:"b7n2qyd4"},bottom12:{paddingBottom:"ekpn4oxx"},end12:{paddingEnd:"btzf6ewn"},start12:{paddingStart:"nqtxkp62"},horiz13:{paddingEnd:"pbp0z3j0",paddingStart:"rn41jex5"},start13:{paddingStart:"rn41jex5"},end13:{paddingEnd:"pbp0z3j0"},bottom14:{paddingBottom:"p9a4hubg"},all15:{paddingTop:"pxvlsfnc",paddingEnd:"kyc7k6mt",paddingBottom:"n3bptxsn",paddingStart:"f78eapp6"},horiz15:{paddingEnd:"kyc7k6mt",paddingStart:"f78eapp6"},vert15:{paddingTop:"pxvlsfnc",paddingBottom:"n3bptxsn"},top15:{paddingTop:"pxvlsfnc"},bottom15:{paddingBottom:"n3bptxsn"},end15:{paddingEnd:"kyc7k6mt"},start15:{paddingStart:"f78eapp6"},horiz16:{paddingEnd:"l9g3jx6n",paddingStart:"lyvj5e2u"},start16:{paddingStart:"lyvj5e2u"},end16:{paddingEnd:"l9g3jx6n"},top18:{paddingTop:"a71rq12o"},all20:{paddingTop:"nlnf8xo7",paddingEnd:"iffbo4e8",paddingBottom:"r219jyu0",paddingStart:"khscay3k"},horiz20:{paddingEnd:"iffbo4e8",paddingStart:"khscay3k"},vert20:{paddingTop:"nlnf8xo7",paddingBottom:"r219jyu0"},top20:{paddingTop:"nlnf8xo7"},bottom20:{paddingBottom:"r219jyu0"},end20:{paddingEnd:"iffbo4e8"},start20:{paddingStart:"khscay3k"},all24:{paddingTop:"a4bywxmn",paddingEnd:"h1a80dm5",paddingBottom:"lzi2pvmc",paddingStart:"sta02ykp"},horiz24:{paddingEnd:"h1a80dm5",paddingStart:"sta02ykp"},vert24:{paddingTop:"a4bywxmn",paddingBottom:"lzi2pvmc"},top24:{paddingTop:"a4bywxmn"},bottom24:{paddingBottom:"lzi2pvmc"},end24:{paddingEnd:"h1a80dm5"},start24:{paddingStart:"sta02ykp"},all30:{paddingTop:"msavwer2",paddingEnd:"bcymb0na",paddingBottom:"slgfab0f",paddingStart:"e8k79tju"},horiz30:{paddingEnd:"bcymb0na",paddingStart:"e8k79tju"},vert30:{paddingTop:"msavwer2",paddingBottom:"slgfab0f"},top30:{paddingTop:"msavwer2"},bottom30:{paddingBottom:"slgfab0f"},end30:{paddingEnd:"bcymb0na"},start30:{paddingStart:"e8k79tju"},horiz36:{paddingEnd:"lk91ofgv",paddingStart:"s9xya5d7"},start36:{paddingStart:"s9xya5d7"},end36:{paddingEnd:"lk91ofgv"}},o={all0:s.all0,horiz0:s.horiz0,vert0:s.vert0,top0:s.top0,bottom0:s.bottom0,end0:s.end0,start0:s.start0,top1:s.top1,all2:s.all2,horiz2:s.horiz2,vert2:s.vert2,top2:s.top2,bottom2:s.bottom2,end2:s.end2,start2:s.start2,all3:s.all3,horiz3:s.horiz3,vert3:s.vert3,top3:s.top3,bottom3:s.bottom3,end3:s.end3,start3:s.start3,all4:s.all4,horiz4:s.horiz4,vert4:s.vert4,top4:s.top4,bottom4:s.bottom4,end4:s.end4,start4:s.start4,all5:s.all5,horiz5:s.horiz5,vert5:s.vert5,top5:s.top5,bottom5:s.bottom5,end5:s.end5,start5:s.start5,all6:s.all6,horiz6:s.horiz6,vert6:s.vert6,top6:s.top6,bottom6:s.bottom6,end6:s.end6,start6:s.start6,top7:s.top7,all8:s.all8,horiz8:s.horiz8,vert8:s.vert8,top8:s.top8,bottom8:s.bottom8,end8:s.end8,start8:s.start8,all9:s.all9,horiz9:s.horiz9,vert9:s.vert9,top9:s.top9,bottom9:s.bottom9,end9:s.end9,start9:s.start9,all10:s.all10,horiz10:s.horiz10,vert10:s.vert10,top10:s.top10,bottom10:s.bottom10,end10:s.end10,start10:s.start10,all12:s.all12,horiz12:s.horiz12,vert12:s.vert12,top12:s.top12,bottom12:s.bottom12,end12:s.end12,start12:s.start12,horiz13:s.horiz13,start13:s.start13,end13:s.end13,bottom14:s.bottom14,all15:s.all15,horiz15:s.horiz15,vert15:s.vert15,top15:s.top15,bottom15:s.bottom15,end15:s.end15,start15:s.start15,horiz16:s.horiz16,start16:s.start16,end16:s.end16,top18:s.top18,all20:s.all20,horiz20:s.horiz20,vert20:s.vert20,top20:s.top20,bottom20:s.bottom20,end20:s.end20,start20:s.start20,all24:s.all24,horiz24:s.horiz24,vert24:s.vert24,top24:s.top24,bottom24:s.bottom24,end24:s.end24,start24:s.start24,all30:s.all30,horiz30:s.horiz30,vert30:s.vert30,top30:s.top30,bottom30:s.bottom30,end30:s.end30,start30:s.start30,horiz36:s.horiz36,start36:s.start36,end36:s.end36};t.uiPadding=o},89345:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(34342));class a extends i.default{constructor(){super(...arguments),this.openVoipWindow=()=>{this.manager&&this.manager.openVoipWindow()},this.closeVoipWindow=()=>{this.manager&&this.manager.closeVoipWindow()}}register(e){this.manager=e}unregister(){this.manager&&this.manager.closeVoipWindow(),this.manager=null}}var s=new a;t.default=s},80666:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEditorAction=t.AttachMedia=t.ATTACH_MEDIA_STATE=void 0;var a=i(r(48926)),s=i(r(81109)),o=r(50796),l=r(29984),c=r(11290),d=i(r(69618)),u=i(r(65273)),p=n(r(64103)),h=r(1063),f=i(r(41933)),_=r(78986),m=i(r(97390)),g=i(r(11339)),y=r(17304),E=i(r(34949));r(13705);const S=r(54302).Mirrored(["Outline","OutlineDone","CropRotateCanvas"]);t.MediaEditorAction=S;const v={READY:"ready",PROCESSING:"processing",ERROR:"error"};t.ATTACH_MEDIA_STATE=v;class T extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.file=(0,c.prop)(),this.uiProcessed=(0,c.prop)(!1),this.fileOrigin=(0,c.prop)(),this.isVcardOverMmsDocument=(0,c.prop)(!1),this.stickerMaker=(0,c.prop)(!1),this.state=(0,c.session)(),this.mediaPrep=(0,c.session)(),this.mimetype=(0,c.session)(),this.originalMimetype=(0,c.session)(),this.processPromise=(0,c.session)(),this.exception=(0,c.session)(),this.caption=(0,c.session)(),this.type=(0,c.session)(y.TYPE.UNKNOWN),this.mediaEditorData=(0,c.session)(),this.lastMediaEditorAction=(0,c.session)(),this.editedFile=(0,c.session)(),this._mediaEditorUndoStack=(0,c.session)((()=>[])),this._mediaEditorRedoStack=(0,c.session)((()=>[])),this.preview=(0,c.session)(),this.fullPreview=(0,c.session)(),this.fullPreviewSize=(0,c.session)(),this.filename=(0,c.session)(),this.documentPageCount=(0,c.session)(),this.isGif=(0,c.session)(),this.gifAttribution=(0,c.session)(),this.previewable=(0,c.derived)(this._previewable,["preview","fullPreview","type","filename","fullPreviewSize","mimetype"]),this.filesize=(0,c.derived)(this._filesize,["file"]),this.fileExt=(0,c.derived)(this._fileExt,["filename"])}_previewable(){if(!this.type||!this.mimetype||!this.fullPreview)return!1;switch(this.type){case y.TYPE.DOCUMENT:return!!this.filename;case y.TYPE.IMAGE:case y.TYPE.VIDEO:return!(!this.fullPreviewSize||!this.preview);case y.TYPE.AUDIO:case y.TYPE.STICKER:case y.TYPE.PTT:case y.TYPE.UNKNOWN:return!0;default:throw new Error(`Unsupported attach media type ${this.type}`)}}_filesize(){return this.file instanceof E.default?this.file.size():this.file instanceof Blob?this.file.size:null}_fileExt(){return this.filename?(0,h.getFileExtension)(this.filename):null}initialize(){if(super.initialize(),!(this.file instanceof Promise))throw new Error("cannot process non-promise file");this.processAttachment(this.file)}processAttachment(e){this.state=v.PROCESSING,this.mediaEditorData=u.default.create(),this.processPromise=this._processAttachmentPromiseHelper(e).then((()=>{const e=new Image;e.src=this.fullPreview,e.onload=()=>{const t={};if(this.stickerMaker){t.fitToSquare=!0;const e=2*d.default.STICKER_MAKER_IMAGE_PADDING;t.scale=1-e/d.default.STICKER_DIMENSION}this.mediaEditorData=this.mediaEditorData.setBackground(e,t)}}))}_processAttachmentData(e){if(this.fileOrigin===g.default.MEDIA_PICKER_ORIGIN_TYPE.CHAT_PHOTO_LIBRARY&&!(0,f.default)()){const t=e.file.name;return(0,h.copyFile)(e.file).then((r=>(0,s.default)((0,s.default)({},e),{},{filename:t,file:r})))}return Promise.resolve(e)}_processAttachmentPromiseHelper(e){var t=this;return e.then((e=>this._processAttachmentData(e))).then(function(){var e=(0,a.default)((function*(e){t.set(e);const r={},{file:n,filename:i,isGif:a,asSticker:s,stickerMaker:o,gifAttribution:c,isVcardOverMmsDocument:u,documentPageCount:p}=e;!0===a?(r.asGif=!0,r.gifAttribution=c):e.type===h.FILETYPE.DOCUMENT&&(r.asDocument=!0,r.filename=i,r.isVcardOverMmsDocument=u,r.documentPageCount=p),r.asSticker=s,!0===o&&(r.minDimension=d.default.STICKER_DIMENSION,r.transparency=!0),r.precomputedFields={fullHeight:e.fullPreviewSize?e.fullPreviewSize.height:void 0,fullWidth:e.fullPreviewSize?e.fullPreviewSize.width:void 0,preview:e.preview,duration:e.duration};const f=E.default.createFromData(n,n.type),m=(0,_.prepRawMedia)(f,r);t.set({mediaPrep:m});const g=yield m.waitForPrep(),S=g.documentPreview,T=g.mediaBlob instanceof E.default?window.URL.createObjectURL(g.mediaBlob.forceToBlob()):window.URL.createObjectURL(g.mediaBlob),A={file:g.mediaBlob,fullPreview:T,type:g.type,filename:g.filename,mimetype:g.mimetype,originalMimetype:e.mimetype,preview:g.preview,state:v.READY,isGif:g.isGif,fullPreviewSize:void 0,documentPageCount:p,isVcardOverMmsDocument:g.isVcardOverMmsDocument,editedFile:g.mediaBlob};(0,l.isNonZeroNumber)(g.fullWidth)&&(0,l.isNonZeroNumber)(g.fullHeight)&&(A.fullPreviewSize={height:g.fullHeight,width:g.fullWidth}),g.type===y.TYPE.IMAGE&&(A.preview=T),g.type===y.TYPE.DOCUMENT&&S&&(A.fullPreview=S.url,A.preview=S.thumbUrl,A.fullPreviewSize={height:S.height,width:S.width},A.documentPageCount=S.pdfPages),t.set(A),t.previewable||(__LOG__(4,void 0,new Error,!0)`Invariant violated, processed file is not previewable`,SEND_LOGS("AttachMedia processFile"))}));return function(){return e.apply(this,arguments)}}()).catch((0,o.filteredCatch)([p.InvalidMediaFileType,p.InvalidImageFileType],(t=>{if(this.isGif||this.type===h.FILETYPE.DOCUMENT)throw t;return this._processAttachmentPromiseHelper(e.then((e=>(e.type=h.FILETYPE.DOCUMENT,e))))}))).catch((0,o.filteredCatch)([m.default,p.MediaFileFailedLoad,p.MediaFileEmpty],(e=>(this.set({exception:e,state:v.ERROR}),this)))).catch((()=>(__LOG__(3)`AttachMedia:processFile convert unexpected error to InvalidMediaFileType:`,this.set({exception:new p.InvalidMediaFileType,state:v.ERROR}),this)))}sendToChat(e,t){if(!this.mediaPrep)return Promise.reject(new Error("MediaPrep not available"));if(this.state===v.ERROR)return Promise.reject(new Error(this.exception));if(!(this.state!==v.PROCESSING||this.previewable&&t.addEvenWhilePreparing))return Promise.reject(new Error("Media still processing"));if(this.state===v.READY)return this.mediaPrep.sendToChat(e,t);const r={mimetype:this.mimetype};switch(this.type){case y.TYPE.VIDEO:r.isGif=this.isGif,r.gifAttribution=this.gifAttribution;case y.TYPE.IMAGE:r.width=this.fullPreviewSize.width,r.height=this.fullPreviewSize.height,r.body=this.preview,t.placeholderProps=r;break;case y.TYPE.DOCUMENT:r.pageCount=this.documentPageCount,r.filename=this.filename,r.body=this.preview,t.placeholderProps=r;break;case y.TYPE.AUDIO:case y.TYPE.PTT:}return this.mediaPrep.sendToChat(e,t)}getFileType(){if(!(this.file instanceof Blob||this.file instanceof File))throw new Error("expected file to be a Blob or File");return(0,h.typeFromMimetype)(this.file.type)}isViewableOnce(){return new Set([y.TYPE.IMAGE,y.TYPE.VIDEO]).has(this.type)&&!this.isGif}isSendableAsSticker(){return this.type===y.TYPE.IMAGE}delete(){this.fullPreview&&window.URL.revokeObjectURL(this.fullPreview),super.delete()}updateMediaEditorData(e,t){return this.mediaEditorData===e||(t.undoable&&(this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]),this.lastMediaEditorAction=t.lastAction,this._mediaEditorRedoStack=[]),this.mediaEditorData=e),this.mediaEditorData}undoMediaEditorData(){if(this.canUndoMediaEditorData()){this._mediaEditorRedoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorUndoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}redoMediaEditorData(){if(this.canRedoMediaEditorData()){this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorRedoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}canUndoMediaEditorData(){return this._mediaEditorUndoStack.length>0}canRedoMediaEditorData(){return this._mediaEditorRedoStack.length>0}updateEditedFile(e){this.editedFile=e}updatePreview(e){window.URL.revokeObjectURL(this.preview),this.preview=e}updateFullPreview(e){window.URL.revokeObjectURL(this.fullPreview),this.fullPreview=e}updateCaption(e){this.caption=e}}T.Proxy="attachMedia";const A=(0,c.defineModel)(T);t.AttachMedia=A},14075:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(48926)),s=r(80666),o=r(1255),l=i(r(69618)),c=n(r(64103)),d=r(1063),u=i(r(43725)),p=r(90535),h=i(r(97390)),f=r(64551),_=i(r(87481));const{IMAGE:m,VIDEO:g,DOCUMENT:y,AUDIO:E}=d.FILETYPE,{READY:S,ERROR:v,PROCESSING:T}=s.ATTACH_MEDIA_STATE;let A=1;class C extends o.BaseCollection{constructor(e){let{chatParticipantCount:t}=e;super(),this.errorMsgs=null,this.ignored=0,this.mediaPickerStatsLogger=new p.MediaPickerStatsLogger,this.selection=new _.default([],(e=>e.id),"prev"),this.isStickerMaker=!1,this.mediaPickerStatsLogger.chatRecipients=t,this.listenTo(this.selection,"all",this._handleSelectionEvents.bind(this))}_handleSelectionEvents(e,t){"focus"!==t&&!1!==t||this.trigger("active-change")}removeSingleton(e,t){var r;e&&(t||this.mediaPickerStatsLogger.logDelete(e.id),e.url&&window.URL.revokeObjectURL(e.url),(null===(r=e.original)||void 0===r?void 0:r.url)&&window.URL.revokeObjectURL(e.original.url))}remove(e,t){const r=super.remove(e,t);return r.forEach((e=>this.removeSingleton(e,t))),this.selection.init(this.getPreviewableMedias(),!0),r}delete(){super.delete(),this.forEach((e=>this.removeSingleton(e))),this.selection.init(this.getPreviewableMedias(),!0)}reorder(e,t){return this.reorderMutate(e,t),this.selection.init(this.getPreviewableMedias(),!0),this.getPreviewableMedias()}replace(e,t){const r=this.get(e);if(!r)return;const n=this.indexOf(r),i=r.caption;this.remove(r,{silent:!0}),r.delete();const a=new s.AttachMedia({id:e,caption:i,file:this._normalizeAttachment(t)});return this.add(a,n?{at:n}:{}),a.processPromise}getValidMedias(){return this.filter((e=>e.state===S||e.state===T))}getPreviewableMedias(){return this.filter((e=>e.previewable))}getActive(){return this.selection.getVal()}setActive(e){this.selection.setVal(e)}unsetActive(){this.selection.unset()}setNextAsActive(){const e=this.selection.list.length-1;return-1===this.selection.index||this.selection.index===e||this.selection.setNext(),this.selection.getVal()}setPrevAsActive(){return-1===this.selection.index||0===this.selection.index||this.selection.setPrev(),this.selection.getVal()}processAttachments(e,t){var r=this;return(0,a.default)((function*(){const n=r.getPreviewableMedias().length,i=e.length+n>l.default.MAX_FILES?Math.max(l.default.MAX_FILES-n,0):e.length,a=e.length-i;0===i?a&&r.trigger("max_upload_limit",a):r.ignore(a);const o=e.slice(0,i).map((e=>new s.AttachMedia({id:A++,file:r._normalizeAttachment(e),fileOrigin:t})));r.add(o);const c=r.getActive();return r.unsetActive(),Promise.all(e).then((()=>{r._attemptToSetNextActiveFromAdded(o,c)})),yield Promise.all(o.map((e=>e.processPromise))),o.forEach((e=>r._logMediaAdd(e,t))),r._attemptToSetNextActiveFromAdded(o,c)}))()}_attemptToSetNextActiveFromAdded(e,t){if(this.getActive())return;if(this.getModelsArray().some((e=>e.state===T&&!e.previewable)))return;let r=e.find((e=>e.previewable));r||(r=t),this.selection.init(this.getPreviewableMedias()),r&&this.setActive(r)}_logMediaAdd(e,t){if(null==t)return;const r=e.isGif?"gif":e.type;this.mediaPickerStatsLogger.logAdd(e.id,r,t)}_normalizeAttachment(e){return(0,a.default)((function*(){const t=yield Promise.resolve(e);return t.filename||(t.filename=t.file.name),t.mimetype||(t.mimetype=t.file.type),t.type||(t.type=(0,d.typeFromMimetype)(t.file.type)),!t.type&&t.mimetype&&(t.type=(0,d.typeFromMimetype)(t.mimetype)),t}))()}ignore(e){e>0&&(this.ignored+=e)}uiProcessMsgs(){let e,t=[],r=0,n=0,i=0,a=0,s=0,o=0,d=0,p=0,_=0,S=0,A=0,C=!1;const b=u.default.filesize(f.ServerProps.media),P=u.default.filesize((0,f.getMaxFilesSizeServerProp)()),M=u.default.filesize(1024*f.ServerProps.vcardMaxSizeKb);if(this.forEach((t=>{if(!t.uiProcessed&&(!e&&t.previewable&&(e=t),t.state!==T&&(t.uiProcessed=!0,t.state===v)))if(t.exception instanceof h.default)switch(t.getFileType()){case m:r+=1;break;case g:n+=1;break;case E:i+=1;break;case y:t.isVcardOverMmsDocument?s+=t.documentPageCount:a+=1}else if(t.exception instanceof c.MediaFileEmpty)switch(t.getFileType()){case m:o+=1;break;case g:d+=1;break;case E:p+=1;break;case y:t.isVcardOverMmsDocument?S+=t.documentPageCount:_+=1}else t.exception instanceof c.MediaFileFailedLoad?C=!0:A+=1})),r>0&&t.push(u.default.t(637,{number:r,_plural:r,maxSize:b})),n>0&&t.push(u.default.t(1433,{number:n,_plural:n,maxSize:b})),i>0&&t.push(u.default.t(160,{number:i,_plural:i,maxSize:b})),a>0&&t.push(u.default.t(413,{number:a,_plural:a,maxSize:P})),s>0&&t.push(u.default.t(380,{_plural:s,maxSize:M})),o>0&&t.push(u.default.t(629,{number:o,_plural:o})),d>0&&t.push(u.default.t(1431,{number:d,_plural:d})),p>0&&t.push(u.default.t(158,{number:p,_plural:p})),_>0&&t.push(u.default.t(412,{number:_,_plural:_})),S>0&&t.push(u.default.t(379,{number:S,_plural:S})),A>0&&t.push(u.default.t(473,{number:A,_plural:A})),C&&(t=[],t.push(u.default.t(799))),t.length>1){t=[];const e=r+n+i+a,s=o+d+p+_,l=e+s+A;0===A?(0!==e&&t.push(u.default.t(474,{number:e,_plural:e,maxSize:P})),0!==s&&t.push(u.default.t(470,{number:s,_plural:s}))):t.push(u.default.t(472,{number:l,_plural:l}))}const O=t.join(" ");this.errorMsgs=O,this.ignore(this.getPreviewableMedias().length-l.default.MAX_FILES);const I=this.ignored;return this.ignored=0,I&&this.trigger("max_upload_limit",I),A>0&&this.trigger("files_not_supported"),{errorMsgs:O}}canSend(){return!this.getModelsArray().some((e=>e.state===T&&!e.previewable))}}t.default=C,C.model=s.AttachMedia},32742:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResult=t.BUSINESS_CATEGORY_EMPTY_STR_ID=void 0;var i=r(11290),a=n(r(39546));t.BUSINESS_CATEGORY_EMPTY_STR_ID="__empty_query__";class s extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.categories=(0,i.prop)(),this.notABizId=(0,i.prop)()}getCollection(){return r(3754).BusinessCategoriesResultCollection}}s.Proxy="BusinessCategoriesResult",s.idClass=a.default;const o=(0,i.defineModel)(s);t.BusinessCategoriesResult=o},3754:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResultCollectionImpl=t.BusinessCategoriesResultCollection=void 0;var i=n(r(48926)),a=r(1255),s=r(32742),o=r(46977);class l extends a.BaseCollection{_find(e){return(0,i.default)((function*(){const{categories:t,notABizId:r}=yield(0,o.queryBusinessCategories)(e);return new s.BusinessCategoriesResult({id:e,categories:t,notABizId:r})}))()}}t.BusinessCategoriesResultCollectionImpl=l,l.model=s.BusinessCategoriesResult,l.staleCollection=!0;const c=new l;t.BusinessCategoriesResultCollection=c},64886:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(11290),a=n(r(39546));class s extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.cypher=(0,i.prop)(),this.cypherExpirationTimestamp=(0,i.prop)()}}s.Proxy="business_direct_connection",s.idClass=a.default;var o=(0,i.defineModel)(s);t.default=o},15131:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(1255),o=n(r(64886)),l=r(884),c=r(46977),d=r(50229),u=r(36993),p=r(47114);class h extends s.BaseCollection{_getValidCertificate(e,t,r){return(0,i.default)((function*(){if(!r&&(null==t?void 0:t.certificateChain)){const e=yield(0,l.getValidCertificate)((0,p.stringToCertificateString)(t.certificateChain));if(e)return e}return(0,l.getValidCertificate)(yield(0,l.fetchCertificateFullChain)(e))}))()}_getCypherFromDborApi(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.default)((function*(){const n=yield(0,u.fetchDirectConnectionKeys)(e.toJid());if(!r&&n&&!(0,l.isExpired)(n.cypherExpirationTimestamp))return{id:e,cypher:(0,d.stringToCypherString)(n.cypher),cypherExpirationTimestamp:n.cypherExpirationTimestamp};const[i,s]=yield Promise.all([t._getValidCertificate(e,n,r),(0,c.querySignedUserInfo)(e)]);if(null==i)return __LOG__(3)`[direct-connection] no certificate returned from the get_public_key IQ`,null;const o=(0,a.default)(yield(0,l.getCypher)(i.chain,s),"yield getCypher(validCertificate.chain, userInfo)"),h=s.phoneNumberSignatureExpiration;return yield(0,u.createOrUpdateDirectConnectionKeys)({id:e.toJid(),cypher:(0,d.cypherStringToString)(o),cypherExpirationTimestamp:h,certificateChain:(0,p.certificateStringToString)(i.string)}),{id:e,cypher:o,cypherExpirationTimestamp:h}}))()}getCypher(e){var t=this;let{forceRenew:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.default)((function*(){const n=r?null:t.get(e);return!n||(0,l.isExpired)(n.cypherExpirationTimestamp)?[].concat(yield t.update(e,{forceRenewDirectConnection:r}))[0]:n}))()}_find(e){return this._getCypherFromDborApi(e)}_update(e,t){let{forceRenewDirectConnection:r}=t;return this._getCypherFromDborApi(e,r)}}h.model=o.default;var f=new h;t.default=f},884:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchCertificateFullChain=function(){return _.apply(this,arguments)},t.getCypher=function(){return f.apply(this,arguments)},t.getValidCertificate=function(){return h.apply(this,arguments)},t.isCypherNeeded=function(){return m.apply(this,arguments)},t.isExpired=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.default)();if(null==e)return!0;const r=(0,s.default)(e,p);return!(r.isValid()&&r.isAfter(t))},t.timestampFormat=void 0;var i=n(r(48926)),a=n(r(45095)),s=n(r(30381)),o=r(46977),l=r(69951),c=r(50229),d=r(76059),u=r(47114);const p="YYYYMMDDTHHmmssZ";function h(){return(h=(0,i.default)((function*(e){const t=yield(0,u.extractCertificates)(e),{result:r}=yield(0,u.validateCertificates)(t.slice(1,-1),t.slice(-1));return r?{string:e,chain:t}:null}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const r=(0,u.arrayBufferToBase64)(yield(0,u.getRandomValues)(new Uint8Array(16)));return(0,c.genCypher)(e[0],r,{phone_number:t.phoneNumber,ttl_timestamp:t.phoneNumberSignatureExpiration,phone_number_signature:t.phoneNumberSignature})}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const[{certificate:t},r]=yield Promise.all([(0,o.queryBusinessPublicKey)(e),(0,u.fetchFromCABundle)()]);if(null==t)throw new Error("[direct-connection] no certificate returned from the get_public_key IQ");const n=yield(0,u.extractCertificates)(t),i=(0,a.default)(yield(0,u.genRootIssuers)(n,r),"yield genRootIssuers(extractedCertificate, caBundle)");return(0,u.encodeToString)([...n,...i])}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){var t;const n=r(93581).BusinessProfileCollection;return Boolean((0,d.supportsDirectConnection)()&&null!=l.ChatCollection.get(e)&&(null===(t=(yield n.find(e)).profileOptions)||void 0===t?void 0:t.directConnection))}))).apply(this,arguments)}t.timestampFormat=p},48018:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_BUSINESS_CATEGORIES=t.DEFAULTS=t.BusinessProfile=void 0;var i=r(11290),a=n(r(39546));t.MAX_BUSINESS_CATEGORIES=3;class s extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.tag=(0,i.prop)(),this.description=(0,i.prop)(),this.categories=(0,i.prop)(),this.profileOptions=(0,i.prop)(),this.email=(0,i.prop)(),this.website=(0,i.prop)(),this.latitude=(0,i.prop)(),this.longitude=(0,i.prop)(),this.businessHours=(0,i.prop)(),this.catalogStatus=(0,i.prop)(),this.address=(0,i.prop)(),this.structuredAddress=(0,i.prop)(),this.legalEntityDetails=(0,i.prop)(),this.stale=(0,i.session)(!0)}markStale(){this.stale=!0,this.hasObservers()&&this.getCollection().find(this.id)}getCollection(){return r(93581).BusinessProfileCollection}isValid(){return Array.isArray(this.categories)}}s.Proxy="businessProfile",s.idClass=a.default;const o=(0,i.defineModel)(s);t.BusinessProfile=o;t.DEFAULTS={description:null,email:null,website:null}},93581:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BusinessProfileCollectionImpl=t.BusinessProfileCollection=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(1255),o=r(48018),l=r(46977),c=r(94010),d=r(19380);t.CATALOG_EXISTS="catalog_exists";class u extends s.BaseCollection{_find(e){return this._findAndParse(e,{queryCatalog:!0})}_update(e,t){return this._findAndParse(e,{queryCatalog:!1,getMerchantCompliance:null==t?void 0:t.getMerchantCompliance})}_findAndParse(e,t){var r=this;let{queryCatalog:n,getMerchantCompliance:s}=t;return(0,a.default)((function*(){const t=r.gadd(e);if(!t.id.isUser())return __LOG__(2)`Store:BusinessProfile:find businessProfile is only available to users (${String(e)})`,Promise.resolve({id:e});const a=yield(0,l.queryBusinessProfile)([{wid:t.id,tag:t.tag}],s);if(!Array.isArray(a))return __LOG__(3)`Received invalid business profile response`,null;if(0===a.length)return __LOG__(2)`Store:BusinessProfile:find No businessProfile found for ${String(e)}`,{id:e};const o=a[0],{wid:u,tag:p}=o,h={id:u,tag:p},{profile:f}=o;if(f){const t=d.ContactCollection.get(e);return t&&!t.isContactSyncCompleted&&(t.set("isBusiness",!0),t.set("forcedBusinessUpdateFromServer",!0)),(0,i.default)((0,i.default)({},(0,c.parseBusinessProfile)({id:o.wid,profile:f,queryCatalog:n})),h)}return h}))()}fetchBizProfile(e){const t=this.get(e);return t&&t.markStale(),this.find(e)}onResume(){this.filter((e=>e.stale&&e.hasObservers())).map((e=>this.find(e.id)))}handle(e){let[t]=e;t&&null!=t.tag||__LOG__(3)`Store:BusinessProfile:handle Received invalid update from server`;const r=this.gadd(t.wid);t.tag!==r.tag&&r.markStale()}getValid(e){const t=this.get(e);if(null==t?void 0:t.isValid())return t}}t.BusinessProfileCollectionImpl=u,u.model=o.BusinessProfile,u.staleCollection=!0;const p=new u;t.BusinessProfileCollection=p},93170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.businessTypeOptions=t.DAYS_OF_WEEK=t.COMMERCE_EXPERIENCE_TYPES=t.BUSINESS_HOUR_MODES=void 0;t.DAYS_OF_WEEK=["sun","mon","tue","wed","thu","fri","sat"];t.BUSINESS_HOUR_MODES={OPEN_24H:"open_24h",SPECIFIC_HOURS:"specific_hours",APPOINTMENT_ONLY:"appointment_only"};const n=r(54302)({CATALOG:"catalog",NONE:"none",SHOP:"shop"});t.COMMERCE_EXPERIENCE_TYPES=n;t.businessTypeOptions={limitedLiabilityPartnership:"Limited liability partnership",soleProprietorship:"Sole proprietorship",partnership:"Partnership",publicCompany:"Public Company",privateCompany:"Private Company",other:"Other"}},94010:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BUSINESS_OPEN_STATUS=void 0,t.getBusinessOpenState=A,t.hasShop=t.hasCatalog=t.goToShop=t.goToCommerceManager=void 0,t.isBusinessOpen=b,t.parseBusinessProfile=t.isShopBanned=t.isCompleteBizProfile=void 0,t.quickReplyHoursStr=function(e){const t=b(e)?o.default._("We're currently *open*",null,{hk:"1Skaff"}):o.default._("We're currently *closed*",null,{hk:"18eiaZ"}),r=o.default._("Our business hours are:",null,{hk:"Qljt"}),n=(0,f.getBusinessHours)(e,!0).map((e=>`${(0,s.default)(e.day)}: ${e.hours}`)).join("\n");return[t,r,n].join("\n")};var i=n(r(81109)),a=n(r(6479)),s=n(r(48403)),o=n(r(48360)),l=n(r(87045)),c=r(48018),d=r(93170),u=r(99989),p=r(19380),h=r(64551),f=r(43390);const _=["business_hours","catalog_status","structured_address","profile_options","address","legal_entity_details"],m="catalog_exists";t.CATALOG_EXISTS=m;const g=e=>{var t;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===d.COMMERCE_EXPERIENCE_TYPES.CATALOG||(null==e?void 0:e.catalog_status)===m};t.hasCatalog=e=>{var t;return e&&e instanceof c.BusinessProfile?(null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.CATALOG||e.catalogStatus===m:g(e)};const y=e=>{var t,r;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(r=e.profileOptions)||void 0===r?void 0:r.shopURL)};t.hasShop=y;t.isShopBanned=e=>{var t,r;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.NONE||y(e)&&!!(null==e||null===(r=e.profileOptions)||void 0===r?void 0:r.isBanned)};t.goToShop=e=>{var t;const r=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.shopURL;r&&l.default.open(r)};t.goToCommerceManager=e=>{var t;const r=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceManagerURL;l.default.open(r||"https://business.facebook.com/commerce_manager/")};const E=e=>g(e)||h.ServerProps.shopsProductGrid&&(e=>{var t,r;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===d.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(r=e.profile_options)||void 0===r?void 0:r.shop_url)})(e),S=e=>{let{email:t,landline_number:r,mobile_number:n}=e;const i={email:t};return r&&(i.landlineNumber=r),n&&(i.mobileNumber=n),i},v=e=>{let{entity_name:t,entity_type:r,is_registered:n,entity_type_custom:i,customer_care_details:a,grievance_officer_details:s}=e;const o={entityName:t,entityType:r,isRegistered:n};return i&&(o.entityTypeCustom=i),a&&(o.customerCareDetails=(e=>{let{email:t,landline_number:r,mobile_number:n}=e;return S({email:t,landline_number:r,mobile_number:n})})(a)),s&&(o.grievanceOfficerDetails=(e=>{let{name:t,email:r,landline_number:n,mobile_number:i}=e;const a=S({email:r,landline_number:n,mobile_number:i});return a.name=t,a})(s)),o};t.parseBusinessProfile=e=>{let{profile:t,id:r,queryCatalog:n}=e;if(!t)return{id:r};const{business_hours:s,catalog_status:o,structured_address:l,profile_options:h,address:f,legal_entity_details:m}=t,g=(0,a.default)(t,_),y={};return y.businessHours=s?(e=>{let{config:t,timezone:r}=e;const n={};return t.forEach((e=>{const{day_of_week:t,mode:r}=e;if(r===d.BUSINESS_HOUR_MODES.SPECIFIC_HOURS){const{open_time:i,close_time:a}=e;n[t]||(n[t]={mode:r,hours:[]}),null!=i&&null!=a&&n[t].hours&&n[t].hours.push([i,a])}else n[t]={mode:r}})),{config:n,timezone:r}})(s):null,h&&(y.profileOptions={},y.profileOptions.commerceExperience=h.commerce_experience,y.profileOptions.cartEnabled=h.cart_enabled,y.profileOptions.directConnection=h.direct_connection,null!=h.shop_url&&(y.profileOptions.shopURL=h.shop_url),null!=h.commerce_manager_url&&(y.profileOptions.commerceManagerURL=h.commerce_manager_url),null!=h.is_banned&&(y.profileOptions.isBanned=h.is_banned)),E(t)&&(y.catalogStatus=o,n&&u.CatalogCollection.findCarouselCatalog(r).then((e=>{const t=Array.isArray(e)?e[0]:e,n=p.ContactCollection.get(r);n&&(n.businessCatalog=t)})).catch((()=>__LOG__(3)`Store:BusinessProfile:missing catalog`))),l?y.structuredAddress={streetAddress:l.street_address,cityId:l.city_id,localizedCityName:l.localized_city_name,zipCode:l.zip_code}:y.address=f||null,m&&(y.legalEntityDetails=v(m)),(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},c.DEFAULTS),g),y),{},{id:r})};t.isCompleteBizProfile=e=>{var t,r;return null!=e.address&&null!=e.description&&null!=(null===(t=e.businessHours)||void 0===t?void 0:t.config)&&0!==Object.keys(e.businessHours.config).length&&null!=e.email&&0!==(null===(r=e.website)||void 0===r?void 0:r.length)};const T={OPEN:"open",CLOSED:"closed",OPEN_TODAY:"open_today",CLOSED_TODAY:"closed_today",OPEN_APPOINTMENT:"open_appointment",OPEN_24H:"open_24h",UNKNOWN:"unknown"};function A(e,t){var r,n;if(null==e.timezone)return{status:"unknown"};const i=t||new Date,a=new Date(i.toLocaleString("en-US",{timeZone:e.timezone})),s=(i.getTime()-a.getTime())/1e3/60,o=e.config[d.DAYS_OF_WEEK[i.getDay()]];if(!o)return{status:T.CLOSED_TODAY};switch(o.mode){case d.BUSINESS_HOUR_MODES.OPEN_24H:if(o)return{status:T.OPEN_24H};break;case d.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:if(o)return{status:T.OPEN_APPOINTMENT};break;case d.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:const e=60*i.getHours()+i.getMinutes();if(1===(null===(r=o.hours)||void 0===r?void 0:r.length)){const t=o.hours[0][0],r=o.hours[0][1];return e>=t&&e<=r?{status:T.OPEN,openUntil:C(s+r)}:e<=t?{status:T.CLOSED,opensAt:C(s+t)}:{status:T.CLOSED}}if(2===(null===(n=o.hours)||void 0===n?void 0:n.length)){const t=o.hours[0][0],r=o.hours[0][1],n=o.hours[1][0],i=o.hours[1][1];return e>=t&&e<=r?{status:T.OPEN,openUntil:C(s+r),additionalOpen:C(s+n),additionalClose:C(s+i)}:e<t?{status:T.CLOSED,opensAt:C(s+t),additionalOpen:C(s+n),additionalClose:C(s+i)}:e>=n&&e<=i?{status:T.OPEN,openUntil:C(s+i)}:e<n?{status:T.CLOSED,opensAt:C(s+n)}:{status:T.CLOSED}}}return{status:"unknown"}}function C(e){const t=new Date,r=Math.floor(e/60);return t.setHours(r),t.setMinutes(e%60),t.setSeconds(0),t}function b(e){switch(A(e).status){case T.OPEN_24H:case T.OPEN_APPOINTMENT:case T.OPEN:return!0;case T.CLOSED:case T.CLOSED_TODAY:default:return!1}}t.BUSINESS_OPEN_STATUS=T},65999:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(57037);class a extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.products=(0,n.prop)(),this.itemCount=(0,n.prop)(),this.total=(0,n.prop)(),this.currency=(0,n.prop)(),this.message=(0,n.prop)()}countTotals(){const e=this.cartItemCollection.reduce(((e,t)=>{var r;return e.currency.add(t.currency),{itemCount:e.itemCount+t.quantity,total:e.total+t.quantity*(null!==(r=t.priceAmount1000)&&void 0!==r?r:0),currency:e.currency}}),{itemCount:0,total:0,currency:new Set}),t=1===e.currency.size,r={itemCount:e.itemCount,total:t?e.total:null,currency:t?e.currency.values().next().value:null};this.set(r,{silent:!0})}initialize(){super.initialize(),this.cartItemCollection=new i.CartItemCollection,this.listenTo(this,"change:cartItemCollection",this.countTotals)}getCollection(){return r(12392).CartCollection}}a.Proxy="cart";var s=(0,n.defineModel)(a);t.default=s},12392:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CartCollectionImpl=t.CartCollection=void 0;var i=r(1255),a=n(r(65999)),s=r(17239),o=r(99234),l=r(7293);class c extends i.BaseCollection{constructor(e,t){super(),this.imageWidth=100,this.imageHeight=100,null!=e&&(this.imageWidth=e),null!=t&&(this.imageHeight=t)}saveToCache(){if(!l.GK.supportsFeature(l.GK.F.MD_BACKEND))try{if(!s.Conn.shouldSaveToCache())return;const e=this.reduce(((e,t)=>{const{cartItemCollection:r,itemCount:n,total:i,currency:a,id:s,message:o}=t,l=r.map((e=>({id:e.id,priceAmount1000:e.priceAmount1000,currency:e.currency,name:e.name,quantity:e.quantity,imageHash:e.imageHash})));return l.length>0&&e.push({id:s,products:l,itemCount:n,total:i,currency:a,message:o}),e}),[]);(0,o.setCollection)(c.cachePolicy.id,e,!0)}catch(e){__LOG__(3)`Error while saving carts to cache, ${String(e)}`}}initializeFromCache(e){try{(e||[]).forEach((e=>{const t=new a.default({id:e.id,itemCount:e.itemCount,total:e.total,currency:e.currency,message:e.message});t.cartItemCollection.add(e.products),this.add(t,{merge:!0})}))}catch(e){__LOG__(3)`Error while restoring carts from cache, ${String(e)}`}}findCart(e){return this.gadd(e)}}t.CartCollectionImpl=c,c.model=a.default,c.cachePolicy={id:"cart_collection",policy:i.CACHE_POLICY.LOAD,delay:2e3};const d=new c;t.CartCollection=d},9581:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_QUANTITY=t.CartItem=void 0;var n=r(11290);t.MAX_QUANTITY=99;class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.priceAmount1000=(0,n.prop)(),this.currency=(0,n.prop)(),this.name=(0,n.prop)(),this.quantity=(0,n.prop)(),this.imageHash=(0,n.prop)(),this.imageCdnUrl=(0,n.prop)()}getCollection(){return r(12392).CartCollection}}i.Proxy="cart-item";const a=(0,n.defineModel)(i);t.CartItem=a},57037:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CartItemCollection=void 0;var n=r(1255),i=r(9581);class a extends n.BaseCollection{}t.CartItemCollection=a,a.model=i.CartItem},34535:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveMessageHeaderMediaType=t.IM_MEDIA_HEADER_TYPES=void 0;const n=r(54302).Mirrored(["IMAGE","VIDEO","DOCUMENT"]);t.InteractiveMessageHeaderMediaType=n;const i=new Set([n.IMAGE,n.VIDEO,n.DOCUMENT]);t.IM_MEDIA_HEADER_TYPES=i},84064:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(54302)({NATIVE_FLOW:"native_flow",SHOPS_STOREFRONT:"shops_storefront"});t.default=n},5165:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(54302)({ORDER_DETAILS:"order_details",ORDER_STATUS:"order_status"});t.default=n},8803:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Label=void 0,t.intColorToHex=u;var i=r(11290),a=r(17239),s=n(r(69618)),o=r(7293),l=r(34741),c=r(31912);class d extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.name=(0,i.prop)(),this.colorIndex=(0,i.prop)(),this.color=(0,i.prop)(),this.count=(0,i.prop)(),this.stale=(0,i.session)(!0),this.hexColor=(0,i.derived)(this._hexColor,["color","colorIndex"])}initialize(){super.initialize(),this.labelItemCollection=new l.LabelItemCollection,this._triggerLabelUpdate(),this.listenTo(this,"change:name",this._triggerLabelUpdate),this.listenTo(this,"change:color",this._triggerLabelUpdate),this.listenTo(this,"change:colorIndex",this._triggerLabelUpdate),this.listenTo(this,"change:count",this._triggerLabelUpdate),o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&(this.listenTo(this.labelItemCollection,"add",this._handleLabelItemCollectionUpdate),this.listenTo(this.labelItemCollection,"remove",this._handleLabelItemCollectionUpdate))}_hexColor(){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const e=this.colorIndex;if(null==e)return;return a.Conn.platform===a.PLATFORMS.SMBI?s.default.IPHONE_LABEL_COLOR_PALETTE[e]:s.default.ANDROID_LABEL_COLOR_PALETTE[e]}if(this.color)return u(this.color)}_find(e){return Promise.resolve({id:e})}_triggerLabelUpdate(){this.name&&r(16770).LabelCollection.trigger(`label_updated_${this.id}`)}_handleLabelItemCollectionUpdate(){const e=this.labelItemCollection.filter((e=>e.parentType!==c.LabelItemParentType.Contact)).length;this.count=String(e)}}function u(e){return`#${(parseInt(e,10)>>>0).toString(16).slice(-6)}`}d.Proxy="label";const p=(0,i.defineModel)(d);t.Label=p},16770:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelCollectionImpl=t.LabelCollection=t.LABEL_PROPERTIES=void 0;var a=i(r(48926)),s=i(r(82729)),o=r(89385),l=r(50796),c=r(13959),d=r(4352),u=i(r(48360)),p=r(46331),h=r(1255),f=r(88102),_=r(17239),m=r(45741),g=n(r(64103)),y=r(99234),E=r(7293),S=i(r(43725)),v=r(8803),T=r(82663),A=r(50047),C=r(31912),b=r(905),P=i(r(11339)),M=n(r(22906)),O=i(r(17072)),I=i(r(56891)),w=r(77591),R=r(65044),D=r(85893);const N=Object.freeze({NAME:"name",COLOR:"color"});t.LABEL_PROPERTIES=N;const L=Object.freeze({UPDATING:"updating",SUCCEEDED:"succeeded",FAILED:"failed"});class k extends h.BaseCollection{constructor(){super(),this.checksum=void 0,this.listenTo(this,"remove",this.handleRemove)}initializeAssociationsFromCache(e){e.forEach((e=>{let{labelId:t,associationId:r,type:n}=e;(0,b.addToLabelCollection)(r,[t],n===T.LabelAssociationType.Jid?C.LabelItemParentType.Chat:C.LabelItemParentType.Msg)}))}addNewLabel(e,t){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND))throw new Error("This call is only supported in non-MD mode");(0,A.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.ADD,1,P.default.LABEL_TARGETS.LABEL);const r=I.default.createLabel(e,t),n=new p.ActionType(S.default.t(15,{labelName:e})),i=(0,p.genId)(),a=r.then((t=>{let{status:r}=t;return 200===r?new p.ActionType(S.default.t(105,{labelName:e})):new p.ActionType(S.default.t(104,{labelName:e}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new p.ActionType(S.default.t(104,{labelName:e})))));return f.Cmd.openToast((0,D.jsx)(p.ActionToast,{id:i,initialAction:n,pendingAction:a})),r}removeAllLabelsMD(e){return this.addOrRemoveLabelsMD((e.labels||[]).map((e=>({type:"remove",id:e}))),[e])}addOrRemoveLabelsMD(e,t){E.GK.supportsFeature(E.GK.F.MD_BACKEND)&&e.forEach((e=>{let{id:r,type:n}=e;t.forEach((e=>{const t=(0,b.getParentTypeFromModel)(e),i=e.id.toString();"add"===n?(0,b.addToLabelCollection)(i,[r],t):(0,b.removeLabelFromCollection)(i,r,t)}))}))}addOrRemoveLabels(e,t){const r=(0,p.genId)(),n=new p.ActionType(S.default.t(12,{count:e.length,_plural:e.length})),i=(0,m.editLabelAssociation)(e,t).then((()=>{this.addOrRemoveLabelsMD(e,t)})).then((()=>new p.ActionType(S.default.t(14,{count:e.length,_plural:e.length})))).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new p.ActionType(S.default.t(13)))));f.Cmd.openToast((0,D.jsx)(p.ActionToast,{id:r,initialAction:n,pendingAction:i}))}deleteLabel(e){(0,A.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.DELETE,1,P.default.LABEL_TARGETS.LABEL);const t=I.default.deleteLabel(e),r=this.get(e);if(!r)return void __LOG__(2)`deleteLabel - label does not exist`;const{name:n}=r,i=new p.ActionType(S.default.t(56,{labelName:n})),a=(0,p.genId)(),s=t.then((e=>{let{status:t}=e;return 200===t?new p.ActionType(S.default.t(55,{labelName:n})):new p.ActionType(S.default.t(54,{labelName:n}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new p.ActionType(S.default.t(54,{labelName:n})))));return f.Cmd.openToast((0,D.jsx)(p.ActionToast,{id:a,initialAction:i,pendingAction:s})),t}_getActionLabelUpdateString(e,t){switch(e){case N.NAME:return t===L.UPDATING?u.default._("Updating label name",null,{hk:"2FancO"}):t===L.SUCCEEDED?u.default._("Label name updated",null,{hk:"Nacb5"}):u.default._("Label name update failed",null,{hk:"33PW5z"});case N.COLOR:return t===L.UPDATING?u.default._("Updating label color",null,{hk:"49XPdJ"}):t===L.SUCCEEDED?u.default._("Label color updated",null,{hk:"2cuEYz"}):u.default._("Label color update failed",null,{hk:"Dzw1J"})}return""}updateLabel(e,t){(0,A.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.EDIT,1,P.default.LABEL_TARGETS.LABEL);const r=I.default.editLabel(e.id,e.name,e.color),n=new p.ActionType(this._getActionLabelUpdateString(t,L.UPDATING)),i=(0,p.genId)(),a=r.then((e=>{let{status:r}=e;return 200===r?new p.ActionType(this._getActionLabelUpdateString(t,L.SUCCEEDED)):new p.ActionType(this._getActionLabelUpdateString(t,L.FAILED))})).catch((()=>(__LOG__(3)`updatingLabel dropped`,new p.ActionType(this._getActionLabelUpdateString(t,L.FAILED)))));return f.Cmd.openToast((0,D.jsx)(p.ActionToast,{id:i,initialAction:n,pendingAction:a})),r}getNewLabelColor(){return(0,a.default)((function*(){try{return(yield I.default.queryNextLabelColor()).labelColors[0].color}catch(e){return}}))()}getLabelColorPalette(){return this.labelColorPalette=this.labelColorPalette||(0,y.getSmbLabelPalette)(),this.labelColorPalette&&this.labelColorPalette.waVersion===_.Conn.phone.wa_version?Promise.resolve(this.labelColorPalette.colors):this._getColorPaletteLoop().then((e=>{const t=e.labelColors.map((e=>{let{color:t}=e;return t}));return(0,y.setSmbLabelPalette)({colors:t,waVersion:_.Conn.phone.wa_version}),t})).catch((()=>{}))}_getColorPaletteLoop(){return(0,d.promiseLoop)(((e,t,r)=>{const n=(0,c.delayMs)(M.expBackoff(r,12e4,1e3,.1));return("CONNECTED"===R.Socket.stream?Promise.resolve():(0,O.default)(R.Socket,"change:stream",(()=>"CONNECTED"===R.Socket.stream))).then((()=>I.default.queryLabelPalette().then((t=>{e(t)})))).catch((e=>{if(e.name===o.ABORT_ERROR)throw e;return r>3||404===e?(__LOG__(3)`labels:loadLabelPalette:error ${String(e)}`,404===e?Promise.reject(new w.E404):Promise.reject(new g.GaveUpRetry(`Gave up loading label palette ${r} tries`))):n}))}),0)}handleRemove(e){const{labelItemCollection:t}=e;t.toArray().forEach((e=>{const{parentId:t,parentType:r,labelId:n}=e,i=(0,b.getParentCollection)(r).get(t);i&&(i.labels=(0,s.default)(i.labels,(e=>e!==n)))}))}onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,l.filteredCatch)(w.WebdDrop,(()=>{})))}))}delete(){super.delete(),delete this.checksum}sync(e){if(!e||this.checksum!==e)return this.findQuery({}).catch((0,l.filteredCatch)([w.WebdDrop,g.ProtoVersionUndefined],(()=>{})))}handle(e){var t,r;if(e.checksum&&this.updateChecksum(e.checksum),null===(t=e.labels)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.labelUpdates){let t;return e.labels[0].labelUpdates.forEach((e=>{e.collection.forEach((r=>{r!==C.LabelItemParentType.Msg&&r!==C.LabelItemParentType.Chat||(t=!0);const n=e.id,i=(0,b.getParentCollection)(r).get(e.id);i&&(i.labels&&i.labels.forEach((t=>{e.labels.includes(t)||(0,b.removeLabelFromCollection)(n,t,r)})),i.labels=e.labels)}))})),void(t&&this.trigger("bulk_msg_chat_label_change"))}const n=[],i=[];e.labels.forEach((e=>{"delete"===e.type?n.push(e.label):i.push(e.label)})),this.remove(n.map((e=>{let{id:t}=e;return t}))),this.add(i,{merge:!0})}_findQuery(){var e=this;return(0,a.default)((function*(){const t=yield I.default.queryLabels();return t.checksum&&e.updateChecksum(t.checksum),t.labels}))()}_find(){return this._findQuery()}updateChecksum(e){this.checksum=e}getLabelsForModel(e,t){return this.filter((r=>r.labelItemCollection.get((0,b.createLabelItemId)(e,r.id,t)))).map((e=>e.id))}}t.LabelCollectionImpl=k,k.model=v.Label,k.staleCollection=!0,k.resumeOnAvailable=!0;const G=new k;t.LabelCollection=G},24137:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);r(31912);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.parentType=(0,n.prop)(),this.parentId=(0,n.prop)(),this.labelId=(0,n.prop)()}}i.Proxy="labelItem";var a=(0,n.defineModel)(i);t.default=a},34741:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemCollection=void 0;var i=n(r(82569)),a=r(1255),s=r(7293),o=n(r(24137)),l=r(905);class c extends a.BaseCollection{constructor(){super(),s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&(this.listenTo(this,"add",this._handleAdd),this.listenTo(this,"remove",this._handleRemove))}_handleAdd(e){this._handleChange(e,!0)}_handleRemove(e){this._handleChange(e,!1)}_handleChange(e,t){const r=(0,l.getParentCollection)(e.parentType).get(e.parentId);if(!r)return;const n=r.labels||[];t?n.includes(e.labelId)||(r.labels=[e.labelId].concat(n)):r.labels=(0,i.default)(n,e.labelId)}}t.LabelItemCollection=c,c.model=o.default},52388:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(11290),o=r(9468),l=r(96519),c=r(21374),d=r(12496),u=r(5641),p=n(r(39546));class h extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.afterCursor=(0,s.prop)(),this.index=(0,s.prop)(),this.fetchedFromServer=(0,s.session)(),this._products=(0,s.session)(),this._msgs=(0,s.session)()}initialize(){super.initialize(),this.productCollection=new u.ProductCollection,this.msgProductCollection=new u.ProductCollection,this.collections=new d.ProductCollCollection,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.listenTo(this,"change:_msgs",this.triggerMsgUpdate),this.triggerProductUpdate(),this.triggerMsgUpdate()}triggerProductUpdate(){this._products&&this.productCollection.add(this._products,{merge:!0}),this._products=void 0}triggerMsgUpdate(){this._msgs&&this.msgProductCollection.add(this._msgs,{merge:!0}),this._msgs=void 0}markProductCollectionOld(){this.productCollection.forEach((e=>e.markOld()))}addProduct(e){var t=this;return(0,i.default)((function*(){const{id:r}=t,n=yield(0,l.addProduct)(e),i=t.productCollection.at(0);n.catalogWid=r,n.index=i?i.index-1:0;const s=t.productCollection.add(n,{merge:!0,at:0})[0];return(0,a.default)(s,"addedProduct")}))()}editProduct(e){var t=this;return(0,i.default)((function*(){const r=yield(0,l.editProduct)(e),n=t.productCollection.add(r,{merge:!0})[0];return t.collections&&t.collections.forEach((t=>{t.productCollection.get(e.id)&&t.productCollection.add(r,{merge:!0})})),(0,a.default)(n,"editedProduct")}))()}refreshProduct(e){var t=this;return(0,i.default)((function*(){const r=t.productCollection.get(e);r&&(r.stale=!0);const n=yield(0,l.queryProduct)(t.id,e);if(null!=n.data){const i=(0,c.mapProductResponseToModel)(n.data,t.id);r&&t.productCollection.add(i,{merge:!0}),t.collections&&t.collections.forEach((t=>{t.productCollection.get(e)&&t.productCollection.add(i,{merge:!0})}))}}))()}pullProduct(e,t){var r=this;return(0,i.default)((function*(){const n=yield(0,l.queryProduct)(r.id,e,void 0,void 0,void 0,t);if("NOT_FOUND"===n.error&&r.productCollection.remove(e),null!=n.data){const e=new o.Product((0,c.mapProductResponseToModel)(n.data,r.id));r.updateProduct(e)}}))()}updateProduct(e){this.productCollection.add(e,{merge:!1})}getCollection(){return r(99989).CatalogCollection}}h.Proxy="catalog",h.idClass=p.default;var f=(0,s.defineModel)(h);t.default=f},99989:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CatalogCollectionImpl=t.CatalogCollection=void 0;var i=n(r(48926)),a=r(1255),s=n(r(52388)),o=r(78711),l=r(96519),c=r(21374),d=r(48870),u=(r(27798),r(64551)),p=r(31515),h=r(77591),f=r(58021);class _ extends a.BaseCollection{addMsgAsProduct(e){const t=e.businessOwnerJid&&(0,f.createWid)(e.businessOwnerJid);if(!t)return;const r=this.get(t),n=r&&e.productId&&r.msgProductCollection.get(e.productId),i=r&&e.productId?r.productCollection.get(e.productId):null;if((null==i?void 0:i.t)&&i.t>=e.t)return;if(null==n?void 0:n.fetchedFromServer)return;const a=(0,c.mapMsgToProductModel)(e);return super.add({id:t,afterCursor:void 0,_msgs:[a],stale:!0,fetchedFromServer:!!i},{merge:!0})}_queryProduct(e){var t=()=>super.add,r=this;let{catalogWid:n,productId:a,productMsgMediaData:s,width:o,height:d,shouldFetchComplianceFields:u,canLogQpl:p}=e;return(0,i.default)((function*(){const e=yield(0,l.queryProduct)(n,a,o,d,u,p);if("NOT_FOUND"===e.error){const e=r.get(n);return null==e||e.productCollection.remove(a),Promise.reject(new h.E404("CatalogCollection:findProduct:_queryProduct NOT_FOUND"))}if(!e.data)return t().call(r,{id:n,afterCursor:void 0});const{data:i}=e;if(!i.image_cdn_urls)return Promise.reject(new Error("CatalogCollection:findProduct:_queryProduct: could not find image_cdn_urls for product"));const f=(0,c.mapProductResponseToModel)(i,n);f.productMsgMediaData=s;const _=[f];return t().call(r,{id:n,afterCursor:void 0,_products:_,_msgs:_},{merge:!0})}))()}findProduct(e){let{catalogWid:t,productId:r,productMsgMediaData:n,shouldFetchComplianceFields:i,canLogQpl:a}=e;return r?this._queryProduct({catalogWid:t,productId:r,productMsgMediaData:n,shouldFetchComplianceFields:i,canLogQpl:a}):Promise.reject(new Error("CatalogCollection:findProduct Received productId type "+(void 0===r?"undefined":"null")))}_queryCatalog(e,t,r,n,a,s){return(0,i.default)((function*(){const i=e?e.index:0;s&&d.QPL.markerPoint(s,"datasource_catalog_start");const o=yield(0,l.queryCatalog)(t,r,10,void 0,void 0,n,a);if(s&&d.QPL.markerPoint(s,"datasource_catalog_end"),!o.data.length)return{id:t,afterCursor:null};const u=[];return o.data.forEach((e=>{e.image_cdn_urls&&u.push((0,c.mapProductResponseToModel)(e,t))})),{id:t,afterCursor:o.paging.cursors.after,_products:u,fetchedFromServer:!0,index:i+u.length}}))()}_findQuery(e,t){const r=this.get(e),n=r&&!r.stale?r.afterCursor:void 0;return this._queryCatalog(r,e,n,void 0,void 0,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}findCarouselCatalog(e){var t=()=>super.add,r=this;return(0,i.default)((function*(){const n=r.get(e),i=(0,p.isString)(e)?(0,f.createWid)(e):e;n&&n.set({index:0});const a=yield r._queryCatalog(n,i,void 0,void 0,Boolean(u.ServerProps.shopsProductGrid));return n&&n.markProductCollectionOld(),t().call(r,a,{merge:!0})}))()}findNextProductPage(e,t){var r=this;return(0,i.default)((function*(){!0===t&&(0,o.qplPointCatalogView)("datasource_start");const n=yield r.update(e);!0===t&&(0,o.qplPointCatalogView)("datasource_end");return(Array.isArray(n)?n[0]:n).productCollection.getProductModels()}))()}findCollectionMembership(e,t){var r=()=>super.add,n=this;return(0,i.default)((function*(){let i=n.get(e);const a=(0,p.isString)(e)?(0,f.createWid)(e):e,s=i&&!i.stale?i.afterCursor:void 0,o=yield n._queryCatalog(i,a,s,t);r().call(n,o,{merge:!0}),i=n.get(e),i&&(i.stale=!1)}))()}}t.CatalogCollectionImpl=_,_.model=s.default,_.staleCollection=!0;const m=new _;t.CatalogCollection=m},78711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCatalogView=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_CATALOG_VIEW,e)},t.qplPointProductMessageSend=function(e){n.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PRODUCT_MESSAGE_SEND,e)};var n=r(48870),i=r(27798)},9468:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Product=t.MIN_PRICE=t.MAX_PRODUCT_IMAGES=t.MAX_PRICE=void 0;var i=r(11290),a=r(1063),s=n(r(2320)),o=r(58668),l=r(7514);t.MIN_PRICE=0;t.MAX_PRICE=4503599627370496;t.MAX_PRODUCT_IMAGES=10;class c extends i.BaseModel{constructor(){super(...arguments),this.old=(0,i.session)(!1),this.checkmark=(0,i.session)(!1),this.id=(0,i.prop)(),this.isHidden=(0,i.prop)(),this.catalogWid=(0,i.prop)(),this.url=(0,i.prop)(),this.name=(0,i.prop)(),this.description=(0,i.prop)(),this.availability=(0,i.prop)(),this.reviewStatus=(0,i.prop)(),this.canAppeal=(0,i.prop)(),this.currency=(0,i.prop)(),this.priceAmount1000=(0,i.prop)(),this.salePriceAmount1000=(0,i.prop)(),this.salePriceStartDate=(0,i.prop)(),this.salePriceEndDate=(0,i.prop)(),this.retailerId=(0,i.prop)(),this.productImageCollection=(0,i.session)(),this.imageCount=(0,i.prop)(),this.index=(0,i.prop)(),this.additionalImageCdnUrl=(0,i.prop)(),this.additionalImageHashes=(0,i.prop)(),this.imageCdnUrl=(0,i.prop)(),this.imageHash=(0,i.prop)(),this.complianceInfo=(0,i.prop)(),this.productMsgMediaData=(0,i.session)(),this.fetchedFromServer=(0,i.session)(),this.t=(0,i.prop)()}initialize(){super.initialize(),this.productImageCollection=new l.ProductImageCollection,this.listenTo(this,"change:imageCdnUrl",this.triggerMainImageUpdate),this.initImageUpdate()}triggerAdditionalImageUpdate(){var e;let t=0;null===(e=this.additionalImageCdnUrl)||void 0===e||e.forEach(((e,r)=>{this.productImageCollection.gadd({id:`_${r+1}`,mediaUrl:e,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}),t=r+1})),this.productImageCollection.filter(((e,r)=>r>t)).forEach((e=>e.markOld()))}triggerMainImageUpdate(){var e;this.imageCdnUrl?this.productImageCollection.gadd({id:"_0",mediaUrl:this.imageCdnUrl,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}):null===(e=this.productImageCollection.get("_0"))||void 0===e||e.markOld()}initImageUpdate(){if(this.fetchedFromServer||!this.productMsgMediaData)this.triggerMainImageUpdate();else for(let e=0;e<this.imageCount;e++)this.productImageCollection.gadd({id:`_${e}`,type:"product",mediaData:new s.default({mediaStage:o.MEDIA_DATA_STAGE.PREPARING}),fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0})}markOld(){this.old=!0}lazyloadProductImageCollection(){return this.triggerAdditionalImageUpdate(),this.productImageCollection}getProductImageCollectionCount(){return this.productImageCollection.length}getProductImageCollectionHead(){return this.productImageCollection.head()}getHeadImageFile(){var e;const{productImageCollection:t,name:r}=this,n=t.head();if(!n)return;let i;const s=null===(e=n.mediaData)||void 0===e?void 0:e.mediaBlob;if(s._blob&&(i=s._blob),!i)return;return(0,a.createFile)([i],`${r}.jpg`,{type:"image/jpeg"})}evictImagesFromCache(){this.productImageCollection.forEach((e=>e.evictFromCache()))}getPreviewImage(){return this.productImageCollection.head()}}c.Proxy="product";const d=(0,i.defineModel)(c);t.Product=d},91450:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductMsgSnapshot=E,t.sendProductMessage=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(80666),l=n(r(14075)),c=r(88102),d=n(r(69618)),u=n(r(43725)),p=r(78711),h=n(r(11339)),f=r(13151),_=r(50452),m=r(85893);function g(){return y.apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t){const r=(0,s.default)(new l.default({chatParticipantCount:t}),"new AttachMediaCollection({\n  chatParticipantCount\n})");if((0,p.qplPointProductMessageSend)("image_upload_start"),yield r.processAttachments([{file:e}],h.default.MEDIA_PICKER_ORIGIN_TYPE.CHAT_PHOTO_LIBRARY),(0,p.qplPointProductMessageSend)("image_upload_end"),!r.canSend())return;const n=r.getPreviewableMedias();if(1!==n.length)return;const[i]=n;return i.caption||(i.caption=void 0),i}))).apply(this,arguments)}function E(e){return(0,i.default)((0,i.default)({businessOwnerJid:e.catalogWid.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),title:e.name,description:e.description},0===e.priceAmount1000?{priceAmount1000:null,currencyCode:null}:{currencyCode:e.currency,priceAmount1000:e.priceAmount1000}),{},{salePriceAmount1000:(0,f.isSalePriceActive)(e)?e.salePriceAmount1000:null})}function S(){return(S=(0,a.default)((function*(e,t,r){const n=t.getHeadImageFile();if(!n)throw c.Cmd.openToast((0,m.jsx)(_.Toast,{msg:u.default.t(1101),id:(0,_.genId)()})),new Error("Tried to send product message. Media file is not available.");const a=e.getParticipantCount(),s=yield g(n,a);if(!s)throw c.Cmd.openToast((0,m.jsx)(_.Toast,{msg:u.default.t(1101),id:(0,_.genId)()})),new Error("Tried to send product message. Media data is not available.");const l={quotedMsg:r,caption:s.caption,addEvenWhilePreparing:s.previewable&&s.state===o.ATTACH_MEDIA_STATE.PROCESSING,useBasePropsType:!0};s.sendToChat(e,(0,i.default)((0,i.default)({},l),{},{type:d.default.MSG_TYPE.PRODUCT,productMsgOptions:E(t)}))}))).apply(this,arguments)}},94629:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(5641);class a extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.name=(0,n.prop)(),this.isHidden=(0,n.prop)(),this.reviewStatus=(0,n.prop)(),this.commerceUrl=(0,n.prop)(),this.rejectReason=(0,n.prop)(),this.totalItemsCount=(0,n.prop)(),this.afterCursor=(0,n.prop)(),this.canAppeal=(0,n.prop)()}initialize(){super.initialize(),this.productCollection=new i.ProductCollection,this.afterCursor=void 0}addProducts(e){this.productCollection.add(e,{merge:!0})}}a.Proxy="productColl";var s=(0,n.defineModel)(a);t.default=s},12496:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollCollection=void 0;var i=n(r(48926)),a=r(1255),s=r(97951),o=r(21374),l=n(r(94629)),c=r(60323),d=r(48870);r(27798);const u=100,p=e=>({id:e.id,name:e.name,reviewStatus:e.reviewStatus,totalItemsCount:e.totalItemsCount,canAppeal:e.canAppeal,commerceUrl:e.commerceUrl,rejectReason:e.rejectReason});class h extends a.BaseCollection{constructor(){super(...arguments),this.afterCursor=""}findCollectionsList(e,t,r,n){var a=this;return(0,i.default)((function*(){n&&d.QPL.markerPoint(n,"datasource_collections_start");try{const r=yield(0,s.attemptWithDirectConnectionRetry)(e,(r=>(0,c.queryCollections)(e,a.afterCursor,10,t,u,u,r)));n&&d.QPL.markerPoint(n,"datasource_collections_end"),a.afterCursor=r.afterCursor,a.add(r.collections.map(p),{merge:!0}),r.collections.forEach((t=>{const r=a.get(t.id);r&&r.addProducts(t.products.map((t=>(0,o.mapProductResponseToModel)(t,e))))})),a.trigger("change")}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionsList, error: ${e}`,SEND_LOGS("Find collections list failed"),e}}))()}getCollectionModels(e){const t=this.toArray();return e?t:t.filter((e=>!e.isHidden&&"APPROVED"===e.reviewStatus))}findCollectionProducts(e,t,r,n){var a=this;return(0,i.default)((function*(){let r=a.get(t);const i=r?r.afterCursor:void 0;n&&d.QPL.markerPoint(n,"datasource_start");try{const l=yield(0,s.attemptWithDirectConnectionRetry)(e,(r=>(0,c.querySingleCollection)(e,t,i,10,u,u,r)));n&&d.QPL.markerPoint(n,"datasource_end"),1===l.collections.length&&(a.add(l.collections.map(p),{merge:!0}),r=a.get(t),r&&(r.addProducts(l.collections[0].products.map((t=>(0,o.mapProductResponseToModel)(t,e)))),r.afterCursor=l.afterCursor))}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionProducts, error: ${e}`,SEND_LOGS("Find collection products failed"),e}}))()}}t.ProductCollCollection=h,h.model=l.default,h.staleCollection=!0},5641:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollection=t.PRODUCT_REVIEW_STATUS=void 0;var n=r(1255),i=r(9468);const a={NO_REVIEW:"NO_REVIEW",PENDING:"PENDING",REJECTED:"REJECTED",APPROVED:"APPROVED",OUTDATED:"OUTDATED"};t.PRODUCT_REVIEW_STATUS=a;class s extends n.BaseCollection{getProductModels(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=super.toArray();if(super.length<1)return t;const r=super.head();if(!(null==r?void 0:r.catalogWid))return t;const n=e?new Set([a.OUTDATED,a.NO_REVIEW,a.APPROVED,a.REJECTED,a.PENDING]):new Set([a.APPROVED]),i=super.filter((e=>n.has(e.reviewStatus)&&!e.old));return e?i:i.filter((e=>!e.isHidden))}add(e,t){const r=t?super.add(e,t):super.add(e);return this.sort(),r}evictImagesFromCache(e){const t=this.get(e);t&&t.evictImagesFromCache()}}t.ProductCollection=s,s.model=i.Product,s.comparator=function(e,t){return e.index-t.index}},51954:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.STATIC_WHATSAPP_IMAGE_URI=t.ProductImage=void 0;var i=n(r(48926)),a=n(r(81109)),s=r(37178),o=n(r(70714)),l=r(77712),c=r(11290),d=r(64103),u=r(55975),p=r(78986),h=n(r(2320)),f=r(58668),_=r(56406),m=n(r(34949)),g=r(28080);const y="https://static.whatsapp.net";t.STATIC_WHATSAPP_IMAGE_URI=y;const E=(0,s.createTimer)({algo:{type:"fibonacci",first:0,second:1},jitter:.25,max:9e5});function S(e){return"_productimage_"+(e.includes(y)?e:new URL(e).pathname)}class v extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.type=(0,c.prop)(),this.mediaUrl=(0,c.prop)(),this.blobUrl=(0,c.session)(),this.mediaData=(0,c.session)(),this.fetchedFromServer=(0,c.prop)(),this.old=(0,c.session)(!1)}initialize(){super.initialize(),this.listenTo(this,"change:mediaUrl change:fetchedFromServer",this.triggerImageUpdate),this.triggerImageUpdate()}_processAndUpdateMediaData(e){let t={};const r=m.default.createFromData(e,"image/jpeg");(0,p.prepRawMedia)(r,{}).waitForPrep().then((e=>(t=(0,a.default)((0,a.default)({},t),{},{mediaBlob:e.mediaBlob,type:e.type,mimetype:e.mimetype,fullWidth:e.fullWidth,fullHeight:e.fullHeight}),Promise.all(["string"==typeof e.preview?m.default.createFromBase64Jpeg(e.preview):Promise.resolve(null),m.default.createFromData(e.mediaBlob),(0,g.getHash)(e.mediaBlob)])))).then((e=>{const[r,n,i]=e;t=(0,a.default)((0,a.default)({},t),{},{preview:r,mediaBlob:n,renderableUrl:n.url(),mediaStage:f.MEDIA_DATA_STAGE.RESOLVED,filehash:i}),i!==this.mediaData.filehash&&this.mediaData.set(t)}))}triggerImageUpdate(){var e=this;return(0,i.default)((function*(){if(!e.fetchedFromServer||!e.mediaUrl)return;e.mediaData||e.addChild("mediaData",new h.default({mediaStage:f.MEDIA_DATA_STAGE.PREPARING}));const t=S(e.mediaUrl),r=yield u.LruMediaStore.get(t);if(r)return e._processAndUpdateMediaData(r);const n={delay:e=>{let{taskDuration:t}=e;const r=1e3*E();return Math.max(r-t,0)},signal:(new o.default).signal,retries:10};try{const{result:r}=yield(0,l.backoff)(n,function(){var t=(0,i.default)((function*(t){const r=yield(0,_.fetchMedia)(e.mediaUrl);return r&&r.status>=200&&r.status<300?r:t(new d.CatalogImageDownloadError)}));return function(){return t.apply(this,arguments)}}());u.LruMediaStore.put(t,r),e._processAndUpdateMediaData(r)}catch(t){__LOG__(3)`Failed to fetch ${e.mediaUrl}`,e.mediaData.set({mediaStage:f.MEDIA_DATA_STAGE.ERROR_MISSING})}}))()}markOld(){this.old=!0}evictFromCache(){if(this.mediaUrl){const e=S(this.mediaUrl);u.LruMediaStore.del(e)}}}v.Proxy="productImage";const T=(0,c.defineModel)(v);t.ProductImage=T},7514:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductImageCollection=void 0;var n=r(1255),i=r(51954);class a extends n.BaseCollection{toArray(){return super.filter((e=>e.old?(this.remove(e),!1):e))}}t.ProductImageCollection=a,a.model=i.ProductImage},89295:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageList=t.INVALID_PRODUCT_TOKEN=void 0;var i=n(r(48926)),a=r(11290),s=r(884),o=r(99989),l=r(69951),c=n(r(32219)),d=r(21374),u=r(5641),p=r(92002),h=r(40264),f=r(64551);const _="DELETED";t.INVALID_PRODUCT_TOKEN=_;const m=["ERROR","SUCCESS"];class g extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.catalogId=(0,a.prop)(),this.title=(0,a.prop)(),this.requiresDirectConnection=(0,a.prop)(),this._productsLoadingStatus=(0,a.session)(),this._productList=(0,a.session)(),this._products=(0,a.session)()}initialize(){super.initialize(),this.productCollection=o.CatalogCollection.gadd({id:this.catalogId}).productCollection,this._productsLoadingStatus=new Map,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.triggerProductUpdate(),this.listenTo(this.productCollection,"remove",this.triggerProductRemoved),this.listenTo(l.ChatCollection,"add",this.triggerChatAdded)}triggerProductRemoved(e){(0,p.updateProductListHeaderImageRejected)(e,this.id)}triggerProductUpdate(){null!=this._products&&(this._products.forEach((e=>{const t=this._getFetchStatus(e);if(this.setProductLoadingStatus(e.id,t),"DELETED"===e.status&&this.triggerProductRemoved(e),"DELETED"!==e.status&&"ERROR"!==t){const t=(0,d.mapProductResponseToModel)(e,this.catalogId);t.reviewStatus===u.PRODUCT_REVIEW_STATUS.REJECTED&&this.triggerProductRemoved(t),this.productCollection.add(t,{merge:!0})}})),this._products=void 0)}triggerChatAdded(e){var t=this;return(0,i.default)((function*(){e.id.equals(t.catalogId)&&(yield(0,s.isCypherNeeded)(t.catalogId))&&(t.productCollection.reset(),t._productsLoadingStatus=new Map)}))()}getNextProductBatchToLoad(){const e=this.getPageSize(),t=this._productList.productSections.reduce(((e,t)=>{let{products:r}=t;return[...e,...r.map((e=>{let{productId:t}=e;return t})).filter(Boolean).filter((e=>"NONE"===this.getProductLoadingStatus(e)))]}),[]).slice(0,e);return t.forEach((e=>this.setProductLoadingStatus(e,"PENDING"))),t}getPageSize(){const e=f.ServerProps.webProductListMessagePageSize||h.PRODUCT_PAGE_SIZE,t=this.getProductSize();return t<3*e?t:2*e}getProductSize(){return this._productList.productSections.reduce(((e,t)=>{let{products:r}=t;return e+r.length}),0)}setProductLoadingStatus(e,t){this._productsLoadingStatus.set(e,t)}getProductLoadingStatus(e){return this._productsLoadingStatus.get(e)||"NONE"}getTotalProductsFetchedOrFailed(){return Array.from(this._productsLoadingStatus).filter((e=>{let[t,r]=e;return m.includes(r)})).length}getProductList(){return this._productList}getSections(){return this._productList.productSections}getSectionsCount(){return this._productList.productSections.reduce(((e,t)=>{let{title:r}=t;return null!=r&&""!==r?e+1:e}),0)}isFetching(){let e=!1;return this._productsLoadingStatus.forEach((t=>{"PENDING"===t&&(e=!0)})),e}_getFetchStatus(e){return e.status!==_&&e.image_cdn_urls?"SUCCESS":"ERROR"}}g.Proxy="product_list",g.idClass=c.default;const y=(0,a.defineModel)(g);t.ProductMessageList=y},18952:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageListCollectionImpl=t.ProductMessageListCollection=void 0;var i=n(r(48926)),a=r(1255),s=r(96519),o=r(89295),l=(r(27798),r(58021));class c extends a.BaseCollection{_queryProductList(e,t){return(0,i.default)((function*(){const r=e.catalogId,n=yield(0,s.queryProductList)(r,e.getNextProductBatchToLoad(),void 0,void 0,t);return{id:e.id,_products:n,fetchedFromServer:!0}}))()}_findQuery(e,t){const r=this.get(e);return null==r?Promise.resolve({id:e}):this._queryProductList(r,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}getOrAdd(e,t,r,n,i){let a=this.get(e);if(null!=a)return a;if(null==n)return null;const s=(0,l.createWid)(n);return a=this.add({id:e,catalogId:s,_productList:t,title:i,requiresDirectConnection:r})[0],null!=a?a:null}}t.ProductMessageListCollectionImpl=c,c.model=o.ProductMessageList,c.staleCollection=!0;const d=new c;t.ProductMessageListCollection=d},40264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_PAGE_SIZE=void 0;t.PRODUCT_PAGE_SIZE=6},13151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSalePriceActive=t.isEmptyPrice=t.getActivePrice=void 0;const r=e=>null!=e.salePriceAmount1000&&(null==e.salePriceStartDate||e.salePriceStartDate<=Date.now())&&(null==e.salePriceEndDate||e.salePriceEndDate>Date.now());t.isSalePriceActive=r;const n=e=>r(e)?e.salePriceAmount1000:e.priceAmount1000;t.getActivePrice=n;t.isEmptyPrice=e=>{const{currency:t,priceAmount1000:r}=e,i=n(e);return!t||null==r||null==i}},6822:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductComplianceCategory=t.ProductAvailability=void 0;const n=r(54302)({IN_STOCK:"in stock",OUT_OF_STOCK:"out of stock",UNKNOWN:"unknown"});t.ProductAvailability=n;const i=r(54302)({Default:"DEFAULT",CountryOriginExempt:"COUNTRY_ORIGIN_EXEMPT"});t.ProductComplianceCategory=i},65563:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyTypes=void 0;const n=r(54302)({TEXT:"text",ADDRESS_SMART_DEFAULT:"address_smart_default",HOURS_SMART_DEFAULT:"hours_smart_default",PROFILE_SMART_DEFAULT:"profile_smart_default"});t.QuickReplyTypes=n},47169:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(65563),a=r(2223);class s extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.shortcut=(0,n.prop)(),this.message=(0,n.prop)(),this.count=(0,n.prop)(),this.keywords=(0,n.prop)(),this.pendingCount=(0,n.session)(0),this.totalCount=(0,n.derived)(this._totalCount,["count","pendingCount"]),this.type=(0,n.derived)(this._type,["id"])}_totalCount(){return this.count+this.pendingCount}_type(){var e;switch(null!==(e=i.QuickReplyTypes.cast(this.id))&&void 0!==e?e:i.QuickReplyTypes.TEXT){case i.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return i.QuickReplyTypes.ADDRESS_SMART_DEFAULT;case i.QuickReplyTypes.HOURS_SMART_DEFAULT:return i.QuickReplyTypes.HOURS_SMART_DEFAULT;case i.QuickReplyTypes.PROFILE_SMART_DEFAULT:return i.QuickReplyTypes.PROFILE_SMART_DEFAULT;default:return i.QuickReplyTypes.TEXT}}useOnce(){this.isSmartDefault()?(this.count+=1,(0,a.updateQuickReply)(this)):(this.pendingCount+=1,this.getCollection().periodicFlush())}getCollection(){return r(99662).QuickReplyCollection}isSmartDefault(){switch(this.type){case i.QuickReplyTypes.PROFILE_SMART_DEFAULT:case i.QuickReplyTypes.HOURS_SMART_DEFAULT:case i.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return!0;default:return!1}}}s.Proxy="quickReply";var o=(0,n.defineModel)(s);t.default=o},99662:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyCollectionImpl=t.QuickReplyCollection=void 0;var i=n(r(48926)),a=r(50796),s=r(57319),o=r(1255),l=r(7293),c=n(r(47169)),d=r(47787),u=n(r(56891)),p=r(77591);class h extends o.BaseCollection{constructor(){super(...arguments),this.checksum=void 0,this.flushCountsTimer=new s.ShiftTimer((()=>{this.hasPendingCounts()&&this.flushCounts()})),this.sortQuickReply=(e,t)=>e.totalCount===t.totalCount?e.id<t.id?-1:1:e.totalCount>t.totalCount?-1:1,this.onCountsFlushed=e=>{let{id:t,count:r}=e;const n=this.get(t);n&&(n.count=r,n.pendingCount=0)}}delete(){super.delete(),delete this.checksum}filterShortcuts(e){return this.filter((t=>{let{shortcut:r}=t;return r.toLowerCase().startsWith(e.toLowerCase())})).sort(this.sortQuickReply)}sync(e){(0,d.addSmartDefaults)(),l.GK.supportsFeature(l.GK.F.QUICK_REPLIES_QUERY)&&(this.synced()&&this.checksum===e?this.hasPendingCounts()&&this.flushCounts():this.findQuery({}).catch((0,a.filteredCatch)(p.WebdDrop,(()=>{}))))}periodicFlush(){l.GK.supportsFeature(l.GK.F.QUICK_REPLIES_QUERY)&&this.flushCountsTimer.debounceAndCap(2e3,5e3)}updateChecksum(e){this.checksum=e}synced(){return void 0!==this.checksum}hasPendingCounts(){return this.some((e=>{let{pendingCount:t}=e;return t>0}))}getAllPendingCounts(){const e={};return this.forEach((t=>{let{id:r,pendingCount:n}=t;n>0&&(e[r]=n)})),e}flushCounts(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))throw new Error("This call is only supported in non-MD mode");const e=this.getAllPendingCounts();u.default.flushQuickReplyCounts(e).then((t=>{t.checksum&&this.updateChecksum(t.checksum),t.data.filter((t=>{let{id:r}=t;return void 0!==e[r]})).forEach(this.onCountsFlushed)})).catch((0,a.filteredCatch)(p.WebdDrop,(()=>{})))}_findQuery(){var e=this;return(0,i.default)((function*(){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))throw new Error("This call is only supported in non-MD mode");const t=e.getAllPendingCounts(),r=yield u.default.queryQuickReplies(t);return r.checksum&&e.updateChecksum(r.checksum),r.data.filter((e=>{let{id:r}=e;return void 0!==t[r]})).forEach(e.onCountsFlushed),r.data}))()}handle(e){e.checksum&&this.updateChecksum(e.checksum);const t=[],r=[];e.quickReplies.forEach((e=>{"delete"===e.type?t.push(e):r.push(e)})),this.remove(t.map((e=>{let{id:t}=e;return t}))),this.add(r,{merge:!0})}}t.QuickReplyCollectionImpl=h,h.model=c.default,h.cachePolicy={id:"quick_replies_collection",policy:o.CACHE_POLICY.LOAD,delay:2e3};const f=new h;t.QuickReplyCollection=f},47787:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSmartDefaults=function(){if(!(0,o.quickRepliesV2Enabled)())return function(){const e=a.QuickReplyTypes.PROFILE_SMART_DEFAULT;r(99662).QuickReplyCollection.remove(e)}(),function(){const e=a.QuickReplyTypes.ADDRESS_SMART_DEFAULT;r(99662).QuickReplyCollection.remove(e)}(),void function(){const e=a.QuickReplyTypes.HOURS_SMART_DEFAULT;r(99662).QuickReplyCollection.remove(e)}();(function(){const e=a.QuickReplyTypes.PROFILE_SMART_DEFAULT,t=function(){const e=i.ContactCollection.get((0,s.getMaybeMeUser)());if(e){const t=a.QuickReplyTypes.PROFILE_SMART_DEFAULT;return new c.default({id:t,shortcut:l.default.t(1131),message:e.displayName,count:-1,keywords:[]})}}(),n=r(99662).QuickReplyCollection;n.get(e)?t&&n.add({id:e,message:t.message},{merge:!0}):t&&n.add(t,{merge:!0})})(),function(){const e=a.QuickReplyTypes.ADDRESS_SMART_DEFAULT,t=function(){const e=r(93581).BusinessProfileCollection.get((0,s.getMaybeMeUser)());if((null==e?void 0:e.latitude)||(null==e?void 0:e.longitude)||(null==e?void 0:e.address)){const t=a.QuickReplyTypes.ADDRESS_SMART_DEFAULT,r=e.address||l.default.t(1128);return new c.default({id:t,shortcut:l.default.t(1129),message:l.default.t(1127,{pinEmoji:"📍",address:r}),count:-1,keywords:[]})}}(),n=r(99662).QuickReplyCollection;n.get(e)?t&&n.add({id:e,message:t.message},{merge:!0}):t&&n.add(t,{merge:!0})}(),function(){const e=a.QuickReplyTypes.HOURS_SMART_DEFAULT,t=function(){var e;const t=r(93581).BusinessProfileCollection,n=r(94010).quickReplyHoursStr,i=t.get((0,s.getMaybeMeUser)());if(null==i||null===(e=i.businessHours)||void 0===e?void 0:e.config){const e=a.QuickReplyTypes.HOURS_SMART_DEFAULT,t=n(i.businessHours);return new c.default({id:e,shortcut:l.default.t(1130),message:t,count:-1,keywords:[]})}}(),n=r(99662).QuickReplyCollection;n.get(e)?t&&n.add({id:e,message:t.message},{merge:!0}):t&&n.add(t,{merge:!0})}()};var i=r(19380),a=r(65563),s=r(99234),o=r(57701),l=n(r(43725)),c=n(r(47169))},89310:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(11290),a=n(r(39546));class s extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)()}contact(){return r(19380).ContactCollection.gadd(this.id)}getCollection(){return r(32826).BlocklistCollection}}s.Proxy="blocklist",s.idClass=a.default;var o=(0,i.defineModel)(s);t.default=o},32826:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistCollectionImpl=t.BlocklistCollection=void 0;var i=r(1255),a=n(r(89310));class s extends i.BaseCollection{constructor(){super(),this.listenTo(this,"add",this.blockContact),this.listenTo(this,"remove",this.unblockContact)}blockContact(e){e.contact().isContactBlocked=!0}unblockContact(e){e.contact().isContactBlocked=!1}}t.BlocklistCollectionImpl=s,s.model=a.default;const o=new s;t.BlocklistCollection=o},15871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.displayText=(0,n.prop)(),this.selected=(0,n.session)(!1)}}i.Proxy="replyButton";var a=(0,n.defineModel)(i);t.default=a},47688:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonCollection=void 0;var i=r(1255),a=n(r(15871));class s extends i.BaseCollection{}t.ButtonCollection=s,s.model=a.default},40122:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(76716),a=r(11290),s=n(r(16142)),o=r(88102),l=r(17239),c=n(r(69594)),d=r(49835);class u extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.peerJid=(0,a.prop)(),this.offerTime=(0,a.prop)(),this.isVideo=(0,a.prop)(!1),this.isGroup=(0,a.prop)(!1),this.groupCallParticipants=(0,a.prop)(),this.canHandleLocally=(0,a.prop)(!1),this.outgoing=(0,a.prop)(!1),this.webClientShouldHandle=(0,a.prop)(!1),this.participants=(0,a.collection)(s.default),this.callInfo=(0,a.prop)(),this._state=(0,a.prop)(),this._ringTimeout=(0,a.prop)()}getState(){return this._state}setState(e){var t;(t=this._state,e in h[t||"EMPTY"])&&(this._state=e,this.handleNotification())}handleNotification(){const e=this.getState();if(!(!l.Conn.tosShowCallNotification||!this.peerJid||c.default.isVoiceCallEnabled()&&!this.isVideo||c.default.isVideoCallEnabled()&&this.isVideo))if(e===d.CALL_STATES.INCOMING_RING){o.Cmd.alertCall(this.peerJid,this.id,this.isVideo,this.isGroup,this.canHandleLocally);i.MainAudioChannel.claim(this,(()=>{}))()}else o.Cmd.cancelCall(this.peerJid)}getCollection(){return r(31218).CallCollection}}u.Proxy="call";var p=(0,a.defineModel)(u);t.default=p;const h={EMPTY:{[d.CALL_STATES.INCOMING_RING]:!0,[d.CALL_STATES.OUTGOING_CALLING]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.HANDLED_REMOTELY]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0},INCOMING_RING:{[d.CALL_STATES.HANDLED_REMOTELY]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[d.CALL_STATES.FAILED]:!0},OUTGOING_CALLING:{[d.CALL_STATES.OUTGOING_RING]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.NOT_ANSWERED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0},OUTGOING_RING:{[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.NOT_ANSWERED]:!0},CONNECTING:{[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[d.CALL_STATES.FAILED]:!0},CONNECTION_LOST:{[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0},ACTIVE:{[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.CONNECTION_LOST]:!0},HANDLED_REMOTELY:{},ENDED:{},REJECTED:{},REMOTE_CALL_IN_PROGRESS:{},FAILED:{},NOT_ANSWERED:{}}},31218:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallCollectionImpl=t.CallCollection=void 0;var i=n(r(81109)),a=n(r(82492)),s=n(r(14176)),o=r(88156),l=r(76716),c=r(1255),d=n(r(40122)),u=n(r(69618)),p=n(r(83938)),h=n(r(96489)),f=r(17506),_=n(r(69594)),m=r(66934),g=r(45473),y=r(32968),E=r(49835);const{VOIP_LOG_COLOR:S}=u.default;let v=null,T=null;class A extends c.BaseCollection{constructor(){super(...arguments),this.pendingOffers={},this.pendingVoipCapChecks={}}handleQuery(){return Promise.resolve()}handle(e){var t;v&&T||(v=r(84356).Voip,T=r(84356).checkVoipCapability);const n=e.shift();if(null===(t=n.data)||void 0===t?void 0:t[0]){const e=m.VoipSignaling.parseCallSignalingMsg(n);if(!e)return;let t={};_.default.isVoiceCallEnabled()&&(Array.isArray(n.data[0])&&(n.data=n.data[0]),(0,m.base64DecodeRecursively)(n.data),t={peer_jid:e.peer_jid,payload:n.data,peer_platform:e.peer_platform,peer_app_version:e.peer_version,epoch_msec:null!=e.t?String(1e3*e.t):void 0,elapsed_msec:null!=e.e?String(1e3*e.e):void 0,is_offline:n.data[1].offline});const r=e.call_id;let a=null,s=null,l=null;const c=JSON.parse(JSON.stringify(n)),d=c.data[2]&&c.data[2].find((e=>"enc"===e[0]));d&&(d[2]="xxx bytes"),__LOG__(2)`voip:incoming_signaling(peer):${JSON.stringify(e)}:`;let u=!1;switch(e.type){case g.TYPE.OFFER:if((0,f.getDoNotDisturb)()&&!h.default.isFocused)return void __LOG__(2)`CallCollection:handle: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`;if(u=!0,a=e.isVideoCall,s=e.isGroupCall_DEPRECATED,l=e.t,v.isInitialized()){this.pendingVoipCapChecks[r]=Promise.all([T((0,i.default)({},e)),(0,p.default)()]).then((e=>{let[t,r]=e;return t&&r}));const t=n.data[2]&&n.data[2].find((e=>"enc"===e[0]));this.pendingOffers[r]=new o.Resolvable,this.pendingOffers[r].promise.then((e=>{e&&m.VoipSignaling.receiveCallOfferKey(e,t)}))}}this.pendingVoipCapChecks[r]?this.pendingVoipCapChecks[r].then((i=>{let o;var c;(o=!s&&(a?i&&_.default.isVideoCallEnabled():i),this.processIncomingCall(r,n.from,{isVideo:a,isGroupCall:s,canHandleLocally:o,offerTime:l}),o&&this.pendingOffers[r]&&_.default.isVoiceCallEnabled())?this.pendingOffers[r].promise.then((()=>{var r;null===(r=v)||void 0===r||r.handleIncomingSignalingMessage(e,t)})):(this.cleanupPendingOffer(r),null===(c=v)||void 0===c||c.handleIncomingSignalingMessage(e,t))})).finally((()=>{delete this.pendingVoipCapChecks[r]})):this.pendingOffers[r]?(u&&this.processIncomingCall(r,n.from),_.default.isVoiceCallEnabled()&&this.pendingOffers[r].promise.then((()=>{var r;null===(r=v)||void 0===r||r.handleIncomingSignalingMessage(e,t)}))):(u&&this.processIncomingCall(r,n.from,{isVideo:a,isGroupCall:s,canHandleLocally:!1,offerTime:l}),v.handleIncomingSignalingMessage(e,t))}else{__LOG__(2)`voip:incoming_signaling(paired phone):${JSON.stringify(n)}:`;const e=this.get(n.id);switch(n.type){case"offer_key":const t=this.pendingOffers[n.id];t&&n.key instanceof ArrayBuffer?t.resolve(n.key):__LOG__(3)`received offer_key: no pending offer`;break;case"accept":case"reject":e&&e.setState(E.CALL_STATES.HANDLED_REMOTELY),v.callEndByHandledRemotely(n.id),this.cleanupPendingOffer(n.id);break;case"terminate":e&&e.setState(E.CALL_STATES.ENDED),this.cleanupPendingOffer(n.id)}}}processIncomingCall(e,t,r){if(null!=this.get(e))return void __LOG__(2)`voip:processIncomingCall: Attempting to add existing call with call ID`;let n=r;const i={id:e};null!=t&&(i.peerJid=t),n&&(n=(0,s.default)(n,(e=>null==e)),(0,a.default)(i,n)),this.add(i,{merge:!0})}cleanupPendingOffer(e){delete this.pendingOffers[e]}setActiveCall(e){var t,r;const n=this.activeCall&&!e,i=null===(t=this.activeCall)||void 0===t?void 0:t.webClientShouldHandle;this.activeCall=e,this.trigger("change:activeCall",e),n&&i&&(0,y.playEndCallTone)(),null===(r=this._releaseAudioChannelClaim)||void 0===r||r.call(this),null!=e&&(this._releaseAudioChannelClaim=l.MainAudioChannel.claim(this,(()=>{})))}}t.CallCollectionImpl=A,A.model=d.default;const C=new A;t.CallCollection=C},8384:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.callId=(0,n.prop)(),this.isIncoming=(0,n.prop)(!1),this.isRinging=(0,n.prop)(!1),this.isInterrupted=(0,n.prop)(!1),this.isMuted=(0,n.prop)(!1),this.isTrafficStopped=(0,n.prop)(!1),this.isInvitingToGroupCall=(0,n.prop)(!1),this.isVideoStopped=(0,n.prop)(!1),this.isVideoPaused=(0,n.prop)(!1),this.isVideoDecodePaused=(0,n.prop)(!1),this.isVideoDecodeStarted=(0,n.prop)(!1),this.isOfferingVideoUpgrade=(0,n.prop)(!1)}}i.Proxy="callParticipant";var a=(0,n.defineModel)(i);t.default=a},16142:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(32304)),a=r(1255),s=n(r(8384));class o extends a.BaseCollection{}t.default=o,o.model=s.default,o.comparator=(e,t)=>e.id===t.id?0:(0,i.default)(e.id,t.id)?-1:1},13424:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CALL_TYPES=t.BaseCallUi=void 0;var n=r(11290),i=r(49835);t.CALL_TYPES={VOICE:"VOICE",VIDEO:"VIDEO"};class a extends n.BaseModel{constructor(){super(...arguments),this.callId=(0,n.session)(),this.state=(0,n.session)(i.CALL_UI_STATES.NONE),this.from=(0,n.session)(),this.to=(0,n.session)(),this.type=(0,n.session)(),this.muted=(0,n.session)(),this.peerMuted=(0,n.session)(),this.speaker=(0,n.session)(),this.outgoing=(0,n.session)(),this.startTime=(0,n.session)(),this.showFullscreenCallView=(0,n.session)(!1),this.showCallStatusBar=(0,n.session)(!1),this.externalInputAvailable=(0,n.session)(),this.interrupted=(0,n.session)(),this.peerBusy=(0,n.session)(),this.peerVideoState=(0,n.session)(),this.voipWindowId=(0,n.session)(),this.isGroup=(0,n.session)(),this.groupCallParticipants=(0,n.session)()}onStateChange(){}onAudioOutputChange(){}overrideOutputRoute(){return Promise.resolve()}}t.BaseCallUi=a,a.Proxy="callUi"},97048:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CALL_TYPES",{enumerable:!0,get:function(){return i.CALL_TYPES}}),Object.defineProperty(t,"CALL_UI_STATES",{enumerable:!0,get:function(){return s.CALL_UI_STATES}}),t.CallUi=void 0,Object.defineProperty(t,"OUTPUT_DEVICES",{enumerable:!0,get:function(){return n.OUTPUT_DEVICES}});var n=r(71386),i=r(13424),a=r(11290),s=r(49835);const o=new((0,a.defineModel)(i.BaseCallUi));t.CallUi=o},63183:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.KIND=t.ConversationEndOfHistoryTransferModelPropType=t.Chat=t.CHAT_KIND=void 0,t.getForwardedMessageFields=je;var a=i(r(48926)),s=i(r(57557)),o=i(r(2525)),l=i(r(91966)),c=i(r(75472)),d=i(r(66678)),u=i(r(41609)),p=i(r(23279)),h=r(89385),f=r(50796),_=i(r(45095)),m=r(13959),g=r(4352),y=i(r(48360)),E=r(86945),S=i(r(70714)),v=r(46331),T=i(r(15421)),A=r(54958),C=r(11290),b=i(r(54248)),P=r(48285),M=i(r(6977)),O=i(r(77653)),I=i(r(65568)),w=r(51612),R=i(r(59893)),D=i(r(16173)),N=r(4484),L=r(22683),k=r(88102),G=r(17239),U=i(r(69618)),F=i(r(89520)),x=r(19380),B=i(r(35667)),K=r(47473),Y=r(96751),j=r(60324),W=i(r(96222)),H=n(r(64103)),V=r(99234),$=i(r(24238)),z=r(7293),q=r(29331),J=i(r(89748)),Q=i(r(43725)),X=r(905),Z=r(10435),ee=i(r(64084)),te=r(78986),re=i(r(11339)),ne=r(17304),ie=r(59871),ae=r(55843),se=i(r(32219)),oe=r(54676),le=r(72472),ce=r(47524),de=r(371),ue=r(68315),pe=r(91450),he=r(82039),fe=i(r(86243)),_e=r(15860),me=r(81027),ge=r(86657),ye=r(75887),Ee=(r(13705),r(19569)),Se=r(69694),ve=r(92052),Te=r(19011),Ae=i(r(58492)),Ce=n(r(22906)),be=r(70768),Pe=r(37894),Me=i(r(41809)),Oe=r(43323),Ie=r(27211),we=r(58871),Re=i(r(87798)),De=r(84728),Ne=i(r(17072)),Le=i(r(56891)),ke=r(77591),Ge=i(r(39546)),Ue=r(58021),Fe=r(65044),xe=r(85893);const Be=r(54302)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1,INCOMPLETE:2});t.ConversationEndOfHistoryTransferModelPropType=Be;const Ke={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"};t.CHAT_KIND=t.KIND=Ke;class Ye extends Ae.default{constructor(){super(...arguments),this.id=(0,C.prop)(),this.t=(0,C.prop)(),this.unreadCount=(0,C.prop)(0),this.archive=(0,C.prop)(),this.isReadOnly=(0,C.prop)(),this.isAnnounceGrpRestrict=(0,C.prop)(),this.modifyTag=(0,C.prop)(),this.muteExpiration=(0,C.prop)(0),this.name=(0,C.prop)(),this.notSpam=(0,C.prop)(),this.pin=(0,C.prop)(),this.labels=(0,C.prop)(),this.changeNumberOldJid=(0,C.prop)(),this.changeNumberNewJid=(0,C.prop)(),this.lastReceivedKey=(0,C.prop)(),this.ephemeralDuration=(0,C.prop)(),this.ephemeralSettingTimestamp=(0,C.prop)(),this.disappearingModeInitiator=(0,C.prop)(),this.createdLocally=(0,C.session)(),this.pendingAction=(0,C.session)(),this.formattedTitle=(0,C.session)(),this.active=(0,C.session)(),this.pausedTimerId=(0,C.session)(),this.presenceResendTimerId=(0,C.session)(),this.recording=(0,C.session)(),this.typing=(0,C.session)(),this.colors=(0,C.session)(),this.composeContents=(0,C.session)((()=>({}))),this.attachMediaContents=(0,C.session)(),this.pttRecordingSession=(0,C.session)(),this.squelch=(0,C.session)(),this.reactionSquelch=(0,C.session)(),this.pendingSeenCount=(0,C.session)(0),this.unreadMsgAnchor=(0,C.session)(),this.markedUnread=(0,C.session)(),this.trusted=(0,C.session)(),this.canSend=(0,C.session)(),this.promises=(0,C.session)((()=>({}))),this.ftsCache=(0,C.session)((()=>({}))),this.composeQuotedMsg=(0,C.session)(),this.composeQuotedMsgRemoteJid=(0,C.session)(),this.quotedMsgAdminGroupJid=(0,C.session)(),this.groupMetadata=(0,C.session)(),this.presence=(0,C.session)(),this.mute=(0,C.session)(),this.contact=(0,C.session)(),this.liveLocation=(0,C.session)(),this.liveLocationQueried=(0,C.session)(!1),this.ackedProps=(0,C.session)((()=>({}))),this.mediaCount=(0,C.session)(0),this.linkCount=(0,C.session)(0),this.docCount=(0,C.session)(0),this.productCount=(0,C.session)(0),this.unreadMentionsOfMe=(0,C.prop)(),this.unreadMentionCount=(0,C.prop)(),this.hasUnreadMention=(0,C.prop)(!1),this.archiveAtMentionViewedInDrawer=(0,C.prop)(!1),this.hasChatBeenOpened=(0,C.prop)(!1),this.tcToken=(0,C.prop)(),this.tcTokenTimestamp=(0,C.prop)(),this.tcTokenSenderTimestamp=(0,C.prop)(),this.msgUnsyncedButtonReplyMsgs=(0,C.prop)(),this.vcardDismissed=(0,C.session)(!1),this.endOfHistoryTransfer=(0,C.session)(!1),this.endOfHistoryTransferType=(0,C.prop)(),this.hasEstablishedE2EESession=(0,C.session)(!1),this.pendingInitialLoading=(0,C.prop)(!1),this.kind=(0,C.derived)(this._kind),this.isUser=(0,C.derived)(this._isUser),this.isPSA=(0,C.derived)(this._isPSA),this.isGroup=(0,C.derived)(this._isGroup),this.isBroadcast=(0,C.derived)(this._isBroadcast),this.isBusinessGroup=(0,C.derived)(this._isBusinessGroup),this.canUnread=(0,C.derived)(this._canUnread),this.hasUnread=(0,C.derived)(this._hasUnread,["unreadCount"]),this.optimisticUnreadCount=(0,C.derived)(this._optimisticUnreadCount,["unreadCount","pendingSeenCount"]),this.shouldShowUnreadDivider=(0,C.derived)(this._shouldShowUnreadDivider,["unreadCount","unreadMsgAnchor"]),this.shouldAppearInList=(0,C.derived)(this._shouldAppearInList,["createdLocally","msgs","msgsLength"]),this.previewMessage=(0,C.derived)(this._previewMessage,["msgs","msgsChanged"]),this.showChangeNumberNotification=(0,C.derived)(this._showChangeNumberNotification,["changeNumberOldJid","changeNumberNewJid","id","isUser"]),this.shouldShowUnreadInTitle=(0,C.derived)(this._shouldShowUnreadInTitle,["isGroup","archive","optimisticUnreadCount","muteExpiration"]),this.deleteSignal=(0,C.derived)(this._getDeleteSignal)}initialize(){super.initialize(),this.addQueue=new J.default,this.sendQueue=new J.default,this._ephemeralMessagesToDelete=new Set,this._ephemeralMessageTimerIds=new Map,this._abortController=new S.default,this.msgs.msgLoadState.contextLoaded=!0,this.addChild("presence",ue.PresenceCollection.gadd(this.id));const e=le.MuteCollection.get(this.id);if(e?this.addChild("mute",e):this.addChild("mute",le.MuteCollection.gadd({id:this.id,expiration:this.muteExpiration})),this.listenTo(this.mute,"change:expiration",this.updateMuteExpiration),this.addChild("contact",x.ContactCollection.gadd(this.id)),this.name&&!this.contact.name){const e={name:this.name};this.isGroup?this.contact.set(e):(0,Ie.updateLocal)(this.contact.id,e).then((()=>{this.contact.set(e)}))}if(this.listenTo(this.contact,"change:name",this.updateTitle),this.listenTo(this.contact,"change:isContactBlocked",this.updateCanSend),this.isGroup&&(this.trusted=!0),this.listenTo(be.TosManager,"change",this.updateCanSend),this.listenTo(this.contact,"change:privacyMode",this.updateCanSend),this.isGroup||this.isBroadcast){const e=this.getGroupMetadataCollection();let t;this.isBroadcast&&!e.get(this.id)&&(t=!0);const r=e.gadd(this.id);if(this.addChild("groupMetadata",r),this.listenTo(r,"change:stale change:announce",this.updateIsAnnounceGrpRestrict),this.listenTo(r.participants,"change:isAdmin add remove",this.updateIsAnnounceGrpRestrict),this.listenTo(r,"change:trusted change:stale",this.isTrusted),this.listenTo(r,"change:participants change:stale",this.updateReadOnly),this.listenTo(r.participants,"change:contact.formattedShortName",this.updateTitle),(0,Z.isGroupCatchUpEnabled)()){if(this.unreadMentionsOfMe){const e=this.unreadMentionsOfMe.map((e=>new Me.default({id:e.id,timestamp:e.timestamp})));r.unreadMentionMetadata.addUnreadMentions(e,Oe.UnreadMessageType.PERSISTANCE_LOAD)}null!=this.unreadMentionCount&&(r.unreadMentionMetadata.pendingUnreadMentionCount=this.unreadMentionCount),this._handleUnreadMention(),this.listenTo(r.unreadMentionMetadata.unreadMentionCollection,"add remove reset",this._handleUnreadMention),this.listenTo(r.unreadMentionMetadata,"change:pendingUnreadMentionCount",this._handleUnreadMention)}this.updateReadOnly(),this.updateIsAnnounceGrpRestrict();const n=this.id;this.listenTo(this,"change:isReadOnly",(function(){this.isTrusted(),this.updateCanSend(),he.ProfilePicThumbCollection.update(n).catch((0,f.filteredCatch)(ke.WebdDrop,(()=>{}))),e.update(n).catch((0,f.filteredCatch)(ke.WebdDrop,(()=>{})))})),this.listenTo(this,"change:isAnnounceGrpRestrict",this.updateCanSend),this.listenTo(this,"change:archive",(()=>{!0===this.archive&&(0,A.shouldEnableArchiveV2)()&&(0,ve.setArchiveEnabledSetting)(!0)})),t&&e.update(n).catch((0,f.filteredCatch)(ke.WebdDrop,(()=>{})))}else this.listenTo(this.presence,"change:isOnline",(()=>(0,de.presenceOnlineChanged)(this)));const t=this.getCollection();t.notSpam[this.id]&&!this.notSpam&&(0,Ee.sendNotSpam)(this).catch((()=>{})),t.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"update_sort_time",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this.msgs,"add",this._deregisterExpiredViewOnceMessage),this.listenTo(this.msgs,"bulk_add",this.deregisterExpiredViewOnceBulkMessages),this.listenTo(this.msgs,"add remove change:ephemeralExpirationTimestamp",this._resetEphemeralMessageExpirationTimer),this.listenTo(this.msgs,"bulk_add",(e=>{e.forEach((e=>{this._resetEphemeralMessageExpirationTimer(e)}))})),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=(0,p.default)(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache),this.listenTo(Q.default,"locale_change",(()=>{this.updateTitle()})),G.Conn.isSMB&&(0,X.initializeLabels)(this)}_handleUnreadMention(){this.isGroup&&this.groupMetadata&&(0,Z.isElevatedImportantMessageEnabled)()&&(this.hasUnreadMention=this.groupMetadata.unreadMentionMetadata.getUnreadMentionCount()>0)}_kind(){return Ge.default.isGroup(this.id)?Ke.GROUP:Ge.default.isBroadcast(this.id)?Ke.BROADCAST:Ge.default.isUser(this.id)?Ke.CHAT:void __LOG__(2)`chat:unknown kind id:${this.id.toString()}`}_isUser(){return Ge.default.isUser(this.id)}_isPSA(){return Ge.default.isPSA(this.id)}_isGroup(){return Ge.default.isGroup(this.id)}_isBroadcast(){return Ge.default.isBroadcast(this.id)}_isBusinessGroup(){var e;const t=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getAdmins();if(!t)return!1;for(const e of t){const t=x.ContactCollection.get(e.id);if(null==t?void 0:t.isBusiness)return!0}return!1}isSupportGroup(){var e;return this.isGroup&&!0===(null===(e=this.groupMetadata)||void 0===e?void 0:e.support)}isSupportGroupOrSupportAdmin(){return this.isSupportGroup()||(0,$.default)(this.id.user)}_canUnread(){return!this.isBroadcast}_hasUnread(){return 0!==this.unreadCount}_optimisticUnreadCount(){const{unreadCount:e,pendingSeenCount:t}=this;return e===U.default.MARKED_AS_UNREAD?e:Math.max(0,e-t)}_shouldShowUnreadDivider(){if(0===this.unreadCount)return!1;if(this.unreadMsgAnchor){const{msgChunk:e}=this.unreadMsgAnchor,t=e?e.getModelsArray():[];return this.unreadMsgAnchor!==t.find((e=>e.isUnreadType))}if(this.msgs.msgLoadState.noEarlierMsgs){return this.msgs.filter((e=>e.isUnreadType)).length!==this.unreadCount}return!0}_shouldAppearInList(){if(z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&this.isBroadcast)return!1;if(this._shouldAppearInListLatched)return!0;if(Ge.default.isStatusV3(this.id))return!1;{const e=this.msgs.some((e=>!(e.type===U.default.MSG_TYPE.GROUPS_V4_INVITE&&e.from.equals((0,V.getMaybeMeUser)())||e.isInitialE2ENotification||e.type===U.default.MSG_TYPE.CALL_LOG||e.isBizNotification||"change_number"===e.subtype||e.isDisappearingModeSystemMessage)));return this._shouldAppearInListLatched=!this.createdLocally||e,this._shouldAppearInListLatched}}_previewMessage(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&t.type!==U.default.MSG_TYPE.E2E_NOTIFICATION&&t.type!==U.default.MSG_TYPE.NOTIFICATION_TEMPLATE&&t.type!==U.default.MSG_TYPE.REACTION)return t}if(this.msgs.length>0)return this.msgs.last()}_showChangeNumberNotification(){if(!z.GK.supportsFeature(z.GK.F.CHANGE_NUMBER_V_2))return!1;const{changeNumberOldJid:e,changeNumberNewJid:t,id:r,isUser:n}=this;if(!n)return!1;if(!e&&!t)return!1;const i=x.ContactCollection.get(t||r);return!(null==i?void 0:i.isMyContact)}_shouldShowUnreadInTitle(){const e=!!this.muteExpiration;if(this.archive)return!1;if(this.optimisticUnreadCount<=0)return!1;if(!this.isGroup)return!e;if(!e)return!0;if(!this.msgs||0===this.msgs.length)return!1;let t=!1;const r=this.msgs,n=this.optimisticUnreadCount;let i=Math.max(0,r.length-n);for(;i<r.length;i++){const e=this.msgs.at(i);if(!e)continue;const r=(0,V.getMaybeMeUser)();if(e.isMentioned(r)||e.isQuoted(r)){const r=this.getCollection().get(e.sender);if(!r||!r.muteExpiration){t=!0;break}}}return t}_getDeleteSignal(){return this._abortController.signal}set(e,t,r){"string"==typeof e?"muteExpiration"===e&&this.mute&&this.mute.setMute(t):e.hasOwnProperty("muteExpiration")&&this.mute&&this.mute.setMute(e.muteExpiration);return super.set(e,t,r)}addPendingAction(e){const t=()=>{this.decPending()};e.then(t,t),this.pendingAction++}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}onActiveUpdate(){this.isGroup&&this.active&&(this.squelch=U.default.SQUELCH_RESET_VALUE,this.reactionSquelch=U.default.SQUELCH_RESET_VALUE,this.hasChatBeenOpened=!0),this.presence.chatActive=this.active,this.active||(this.msgs.filter((e=>(0,De.isExpired)(e.safe()))).forEach(te.deregisterMsg),z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&(0,j.removeExpiredMessagesFromHistory)([...this._ephemeralMessagesToDelete]),this._ephemeralMessagesToDelete.forEach((e=>{this._ephemeralMessagesToDelete.delete(e),e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0})})))}onPendingActionUpdate(){this.pendingAction<0&&(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}onNotSpamChange(){var e;(this.getCollection().notSpam[this.id]=this.notSpam,this.isGroup)&&(null===(e=this.groupMetadata)||void 0===e||e.set({notAddedByContact:!1}));this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")}hasMaybeSentMsgToChat(){return this.getAllMsgs().some((e=>e.isSentByMe))}isTrusted(){let e=!1;var t;this.isGroup?e=this.isReadOnly||this.notSpam||(null===(t=this.groupMetadata)||void 0===t?void 0:t.isTrusted()):this.isBroadcast?e=!0:this.isUser&&(e=this.notSpam||this.contact.isMyContact);return!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=Boolean(e)}updateMuteExpiration(){const e=Number(this.mute.expiration);(0,we.updateLocal)(this.id,{muteExpiration:e}).then((()=>this.muteExpiration=e))}updateTitle(){var e,t;this.isBroadcast?this.formattedTitle=this.contact.name||(null!==(e=null===(t=this.groupMetadata)||void 0===t?void 0:t.participants)&&void 0!==e?e:[]).map((function(e){return e.contact.formattedShortName})).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser()||"":this.isGroup&&(this.formattedTitle=this.contact.name)}isSuspendedGroup(){if(z.GK.supportsFeature(z.GK.F.MD_BACKEND)){var e;return(0,E.getABPropConfigValue)("group_suspend_v0_enabled")&&this.isGroup&&!!(null===(e=this.groupMetadata)||void 0===e?void 0:e.suspended)}return!1}isInviteGrowthLockedGroup(){var e;return!!(z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&(0,E.getABPropConfigValue)("growth_lock_v0_enabled"))&&(this.isGroup&&"invite"===(null===(e=this.groupMetadata)||void 0===e?void 0:e.growthLockType)&&(this.groupMetadata.growthLockExpiration||0)>L.Clock.globalUnixTime())}title(){return this.isGroup?this.formattedTitle||Q.default.t(1367):this.formattedTitle}getTcToken(){return z.GK.supportsFeature(z.GK.F.MD_BACKEND)?null==this.tcToken||null==this.tcTokenTimestamp||(0,N.isTokenExpired)(this.tcTokenTimestamp,N.TcTokenMode.Receiver)?null:this.tcToken:null}isPresenceUnknown(){return!(!z.GK.supportsFeature(z.GK.F.MD_BACKEND)||!(0,E.getABPropConfigValue)("trusted_contacts_ti")||null!=this.getTcToken())}updateCanSend(){return this.isReadOnly||this.isAnnounceGrpRestrict||(0,Pe.shouldBlockByTos)(this.contact)||(0,K.shouldBlockByCountry)(this.contact)?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isContactBlocked||this.isPSA):this.canSend=!0}delete(){super.delete(),this.getCollection().remove(this.id),this._abortController.abort(),this.presence.delete(),this.liveLocation&&this.liveLocation.delete(),k.Cmd.closeChat(this),this.groupMetadata&&this.groupMetadata.delete(),this.mediaMsgs&&this.mediaMsgs.delete(),this.linkMsgs&&this.linkMsgs.delete(),this.docMsgs&&this.docMsgs.delete(),this.productMsgs&&this.productMsgs.delete();const e=this.starredMsgs;e&&(e.delete(),e.stopListening(),e.reset()),this.receivedVcardMsgs&&this.receivedVcardMsgs.delete(),(0,V.deleteComposeContents)(this.id)}isDirty(){return 0!==this.unreadCount}resetMediaMsgs(){const{mediaMsgs:e,linkMsgs:t,docMsgs:r,productMsgs:n}=this;e&&(e.delete(),e.queryMedia({chat:this})),t&&(t.delete(),t.queryLinks(this)),r&&(r.delete(),r.queryDocs(this)),n&&(n.delete(),n.queryProducts(this))}isMsgForMediaCollection(e){return e.isMedia&&!e.isViewOnce}addMediaMsgs(e,t){if(!e)return;const r=Array.isArray(e)?e:[e],n=[],i=[],a=[],s=[];r.forEach((e=>{this.isMsgForMediaCollection(e)&&n.push(e),e.asDoc&&a.push(e),e.linkPreview&&i.push(e),null!=e.asProduct&&s.push(e)})),this.mediaMsgs&&n.length&&this.mediaMsgs.add(n,t),this.linkMsgs&&i.length&&this.linkMsgs.add(i,t),this.docMsgs&&a.length&&this.docMsgs.add(a,t),this.productMsgs&&s.length&&this.productMsgs.add(s,t)}onNewMsg(e){var t=this;if(!e)return;let r=Promise.resolve();e.isSentByMe&&!this.notSpam&&(r=(0,we.updateLocal)(this.id,{notSpam:!0}).then((()=>this.notSpam=!0))),"i"!==e.eventType&&r.then((0,a.default)((function*(){const r={};if(z.GK.supportsFeature(z.GK.F.MD_BACKEND)||(r.t=e.t),t.promises.updateSortTime&&t.promises.updateSortTime.abortController.abort(),t.updateMediasCountOnMsg(e),(!z.GK.supportsFeature(z.GK.F.MD_BACKEND)||z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&e.isSentByMeFromWeb)&&t.archive&&(0,A.shouldUnarchiveChat)(e.isSentByMe)&&(r.archive=!1),t.promises.setArchive&&t.promises.setArchive.abortController.abort(),e.isSentByMe?t.markedUnread=!1:((0,b.default)({id:t.id,participant:e.author,type:"paused"},!1),z.GK.supportsFeature(z.GK.F.MD_BACKEND)||"a"!==e.eventType&&"d"!==e.eventType||(r.unreadCount=t.unreadCount+1||1)),yield(0,we.updateLocal)(t.id,r),z.GK.supportsFeature(z.GK.F.MD_BACKEND))try{const{unreadCount:e,timestamp:n}=yield(0,P.getChatMeta)(t.id);r.t=n,r.unreadCount=e}catch(e){__LOG__(4,void 0,new Error)`onNewMsg: unable to find metadata from chat table for id:${t.id.toString()}`}return r}))).then((t=>{e.isSentByMeFromWeb&&e.sendDeferred?this.setAndKeepPrevious(t,e.sendDeferred.promise):this.set(t);const r=B.default.get(this.id);if(r&&(r.timestamp=L.Clock.globalUnixTime()),"gp2"!==e.type||"add"!==e.subtype&&"create"!==e.subtype||this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,V.getMaybeMeUser)().toString()}`,this.id),!e.isSentByMe){switch(e.eventType){case"d":case"a":"d"===e.eventType&&k.Cmd.alertNewMsg(e),this.msgs.length<U.default.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs(void 0,re.default.WEBC_QUERY_TRIGGER_TYPE.NEW_MESSAGE_PREFETCH).catch((0,f.filteredCatch)(ke.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onNewMsg failed\n${e}`}));break;case"n":e.type===U.default.MSG_TYPE.CALL_LOG&&k.Cmd.alertNewMsg(e);break;case"s":if("gp2"===e.type&&"add"===e.subtype&&(0,V.getMaybeMeUser)().equals(e.recipients[0])&&!this.contact.name)return;k.Cmd.alertNewMsg(e);this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,V.getMaybeMeUser)().toString()}`,this.id)}const r=e.mediaData;if(!r||"image"!==r.type&&"video"!==r.type||k.Cmd.newMediaMsg(e),z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&t.unreadCount&&(0,q.processOrphanPeerReceipt)(e.id),(0,Z.isGroupCatchUpEnabled)()&&(0,oe.isImportantMessage)(e)){var n;const t=new Me.default({id:e.id.toString(),timestamp:e.t});if(null===(n=this.groupMetadata)||void 0===n||n.unreadMentionMetadata.addUnreadMentions(t,Oe.UnreadMessageType.NEW_MESSAGE),this.archiveAtMentionViewedInDrawer){const e=new Map;e.set(this.id.toString(),!1),(0,P.updateChatArchiveDrawer)(e),this.archiveAtMentionViewedInDrawer=!1}}}}))}canPin(){var e;if(this.archive)return!1;const t=null===(e=this.promises)||void 0===e?void 0:e.setArchive;return!(null==t?void 0:t.archive)}canArchive(){return!this.isBroadcast||z.GK.supportsFeature(z.GK.F.ARCHIVE_BROADCAST)}sendDismissChangeNumber(){if(this.promises.sendDismissChangeNumber)return this.promises.sendDismissChangeNumber;const e=z.GK.supportsFeature(z.GK.F.MD_BACKEND)?Promise.resolve({status:200,_duplicate:null}):Le.default.sendConversationDismissChangeNumber(this.id);this.promises.sendDismissChangeNumber=e;const t=new v.ActionType(y.default._("Dismissing change number notification.",null,{hk:"XSlwz"})),r=e.then((e=>200===e.status?new v.ActionType(y.default._("Change number notification dismissed.",null,{hk:"1QpySR"})):e.status>=400?new v.ActionType(y.default._("Couldn't dismiss change number notification.",null,{hk:"4BWKLI"})):void 0)).catch((()=>(__LOG__(3)`models:chat:sendDismissChangeNumber dropped`,new v.ActionType(y.default._("Couldn't dismiss change number notification.",null,{hk:"4BWKLI"}),{actionText:Q.default.t(139),actionHandler:this.sendDismissChangeNumber.bind(this)}))));return k.Cmd.openToast((0,xe.jsx)(v.ActionToast,{id:(0,v.genId)(),initialAction:t,pendingAction:r})),e.then((e=>{if(200===e.status&&!e._duplicate)return(0,we.updateLocal)(this.id,{changeNumberNewJid:void 0,changeNumberOldJid:void 0}).then((()=>{this.changeNumberOldJid=this.changeNumberNewJid=void 0}))})).finally((()=>{this.promises.sendDismissChangeNumber=null}))}setComposeContents(e){this.composeContents=e}getSessionPersistedComposeContents(){return(0,V.getComposeContents)(this.id)}getComposeContents(){return(0,u.default)(this.composeContents)?this.getSessionPersistedComposeContents()||{}:this.composeContents}setAttachMediaContents(e){this.attachMediaContents=e}preload(){1===this.msgs.length&&this.loadEarlierMsgs().catch((0,f.filteredCatch)(ke.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:preload failed\n${e}`}))}onEmptyMRM(){__LOG__(2)`models:Chat:removeMsg 0 messages left, querying...`,this.loadEarlierMsgs().catch((0,f.filteredCatch)(ke.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onEmptyMRM failed\n${e}`}))}loadEarlierMsgs(e,t,r){var n=this;return(0,a.default)((function*(){z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&(yield n.waitForChatLoading());let i=e;const a=null!=t?t:re.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL;if(i||(i=n.msgs),i.msgLoadState.noEarlierMsgs)return Promise.resolve();if(i.msgLoadState.isLoadingEarlierMsgs)return i.loadEarlierPromise;const s=i?i.head():null,o=yield n._loadMsgs("before",i,a,r),l=s?s.msgChunk:i;return l&&Array.isArray(o)&&o.length<U.default.PAGE_SIZE&&(l.msgLoadState.noEarlierMsgs=!z.GK.supportsFeature(z.GK.F.MD_BACKEND)||n.endOfHistoryTransferType!==Be.INCOMPLETE),l&&n.isMostRecentCMC(l)&&n.trigger("msgs:loadEarlier"),o}))()}isMostRecentCMC(e){return this.msgs===e}loadRecentMsgs(e,t){let r=e;return r||(r=this.msgs),this.isMostRecentCMC(r)?Promise.resolve():r.msgLoadState.isLoadingRecentMsgs?r.loadRecentPromise:this._loadMsgs("after",r,re.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL,t)}_loadMsgs(e,t,r,n){let i;i="after"===e?t.last():t.head();let a={};i?a=i.id.clone():a.remote=this.id,a.count=U.default.PAGE_SIZE,a.direction=e;const s=(0,ae.newMessageQueryEvent)(r);return this._loadMsgsPromiseLoop(i,t,ie.MsgCollection.findQuery.bind(ie.MsgCollection,a,{logOnSend:e=>{s.webcResponseBytes+=e.binarySize}}),e,s,!0,n)}_updateMsgLoadState(e,t,r){const n=(null==e?void 0:e.msgChunk)&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,e&&n&&((0,_.default)(e.msgChunk,"msg.msgChunk").msgLoadState.contextLoaded=!0),"after"===r?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===r?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!1)}_loadMsgsPromiseLoop(e,t,r,n,i){var s=this;let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0;const c=performance.now();"after"===n?(t.msgLoadState.isLoadingRecentMsgs=!0,i.webcMessageQueryType=re.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_NEXT):"before"===n?(t.msgLoadState.isLoadingEarlierMsgs=!0,i.webcMessageQueryType=re.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_PREV):"around"===n&&(t.msgLoadState.isLoadingAroundMsgs=!0,i.webcMessageQueryType=re.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_AROUND),i.webcBrowserNetworkType=(0,ce.getEffectiveNetworkType)(),i.webcChatType=this.getWebcChatType(),"number"==typeof this.initialIndex&&(i.webcChatPosition=this.initialIndex);const d=(0,fe.default)([l,this._abortController.signal].filter(Boolean),(o=>(0,g.promiseLoop)(function(){var l=(0,a.default)((function*(a,l,d){if(o.aborted)throw new h.AbortError;const u=(0,m.delayMs)(Ce.expBackoff(d,12e4,1e3,.1));let p=Promise.resolve();z.GK.supportsFeature(z.GK.F.MD_BACKEND)||"CONNECTED"===Fe.Socket.stream||(p=(0,Ne.default)(Fe.Socket,"change:stream",(()=>"CONNECTED"===Fe.Socket.stream)));try{yield p;const l=yield r();if(o.aborted)throw new h.AbortError;let d;i.webcQueryT=Math.ceil(performance.now()-c),Array.isArray(l[0])?(d=l[0][0],l.forEach((e=>(0,ae.logMessageCounts)(i,e)))):(d=l[0],(0,ae.logMessageCounts)(i,l)),d&&(i.webcEarliestMessageT=d.t,d.msgChunk===s.msgs&&(i.webcEarliestMessageIndex=s.msgs.length-1)),(0,W.default)().then((e=>{e&&(i.webcBrowserStorageQuotaBytes=e.quota,i.webcBrowserStorageQuotaUsedBytes=e.usage)})).finally((()=>i.commit())),s._updateMsgLoadState(e,t,n),a(l)}catch(r){if(r.name===h.ABORT_ERROR)throw r;return d>3||404===r?(s._updateMsgLoadState(e,t,n),__LOG__(3)`chat:loadMsgs:error ${String(r)}`,404===r?Promise.reject(new ke.E404):Promise.reject(new H.GaveUpRetry(`Gave up msg fetch after ${d} tries`))):u}}));return function(){return l.apply(this,arguments)}}(),0))).catch((0,f.filteredCatch)(H.GaveUpRetry,(()=>[]))).catch((0,f.filteredCatch)(ke.E404,(e=>{if(o)return[];throw e})));return"after"===n?t.loadRecentPromise=d:"before"===n?t.loadEarlierPromise=d:"around"===n&&(t.loadAroundPromise=d),d}getSearchContext(e,t){let r,n=null;e instanceof ne.Msg?n=e:e instanceof se.default&&(r=e);let i=n?n.msgChunk:void 0;const a=Math.trunc(U.default.PAGE_SIZE/3*2);if(!i||!i.msgLoadState.contextLoaded){i||(i=new w.ChatMsgsCollection,this.msgChunks.push(i),n&&i.add(n));const e=n?n.id.clone():r.clone();e.count=a;const s=function(){if(n)return n.msgChunk;if(null!=r){const e=ie.MsgCollection.get(r);return(null==e?void 0:e.msgChunk)?e.msgChunk:i}return i},o=(0,ae.newMessageQueryEvent)(re.default.WEBC_QUERY_TRIGGER_TYPE.SEARCH_RESULT_CLICK);this._loadMsgsPromiseLoop(n,i,ie.MsgCollection.getContext.bind(ie.MsgCollection,e,s,(e=>{o.webcResponseBytes+=e.binarySize})),"around",o,null==t).then((e=>{const t=s();t&&i&&t!==i&&this.notifyMsgCollectionMerge(t,i,t);const o=e[0],l=r?ie.MsgCollection.get(r):n;l&&Array.isArray(o)&&o.length<a&&((0,_.default)(l.msgChunk,"loadedMsg.msgChunk").msgLoadState.noEarlierMsgs=!z.GK.supportsFeature(z.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==Be.INCOMPLETE,i&&l.msgChunk!==i&&(i.msgLoadState.noEarlierMsgs=!z.GK.supportsFeature(z.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==Be.INCOMPLETE))})).catch((()=>{t&&(t.isQuotedMsgAvailable=!1)}))}return{collection:i,msg:n,key:r,highlightMsg:!0}}sendStarMsgs(e,t){return this.promises.sendStarMsgs?this.promises.sendStarMsgs:this.promises.sendStarMsgs=(0,Se.sendStarMsgs)(this.id,e,t).then((()=>{e.forEach((e=>{e.set("star",t)})),t?(0,Te.addStarredMsgs)(e):(0,Te.removeStarredMsgs)(e)})).finally((()=>{this.promises.sendStarMsgs=null}))}sendRevokeMsgs(e,t,r){return this.promises.sendRevokeMsgs?this.promises.sendRevokeMsgs:this.promises.sendRevokeMsgs=Promise.all(e.map((e=>(0,me.sendRevoke)(e,t,r)))).finally((()=>{this.promises.sendRevokeMsgs=null}))}sendDeleteMsgs(e,t){return this.promises.sendDeleteMsgs||(this.promises.sendDeleteMsgs=(0,ge.sendDeleteMsgs)(e,t,this.id).then((()=>(e.forEach((e=>{e.delete()})),e.length))).catch((0,f.filteredCatch)(ke.ServerStatusCodeError,(()=>{let t=0;return e.forEach((e=>{(e.ack===U.default.ACK.FAILED||e.isExpired())&&(e.delete(),t++)})),t}))).finally((()=>{this.promises.sendDeleteMsgs=null}))),this.promises.sendDeleteMsgs}deleteMsgs(e,t){this.deleteMsgsBeforeMsgInclusive(void 0,!e,t)}deleteMsgsOlderThan(e,t,r){const n=this.msgs;let i=n.head();!i||i.t>=e||(i=n.last(),i&&i.t<e?this.deleteMsgs(t,r):this.deleteMsgsPartial((function(n){return n&&(r&&!(0,oe.msgMatchesType)(n,r)||n.star&&!t||n.t>=e||n.isInitialE2ENotification)})))}deleteMsgsBeforeMsgInclusive(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(e){if(!this.msgs.get(e.id))return;t=this.msgs.indexOf(e)}else t=this.msgs.length;this.deleteMsgsPartial((function(e,i){return n&&!(0,oe.msgMatchesType)(e,n)||e.msgChunk===this.msgs&&i>t||r&&e.star||e.isInitialE2ENotification&&r}),!0)}deleteMsgsPartial(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this.unreadCount;if(this.getAllCMCs().forEach((r=>{const n=r.filter(((t,r,n)=>!e.apply(this,[t,r,n])));r.remove(n,void 0,t),n.forEach((e=>{e.delete()}))})),(0,d.default)(this.msgChunks).forEach((e=>{0===e.length&&this.removeMsgsCollection(e)})),this.msgs.length>0){const e=r>this.msgs.length?this.msgs.length:r;(0,we.updateLocal)(this.id,{unreadCount:e}).then((()=>{this.unreadCount=e,this.msgs.msgLoadState.noEarlierMsgs=!z.GK.supportsFeature(z.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==Be.INCOMPLETE}))}}deleteMessages(e){this.msgs.remove(e)}getFirstMsgWithStatus(){return this.msgs.getModelsArray().find((function(e){return!e.isNotification&&(e.isSentByMe||e.type===U.default.MSG_TYPE.PTT||e.isViewOnce||e.isEphemeral)}))}getLastReceivedMsg(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&(!t.local||t.ack>U.default.ACK.CLOCK))return t}}getLastReceivedNonExpiredMsg(e){for(let t=this.msgs.length-1;t>=0;t--){const r=this.msgs.at(t);if(r&&(!r.local||r.ack>U.default.ACK.CLOCK)&&(!r.isEphemeral||null!=r.ephemeralExpirationTimestamp&&r.ephemeralExpirationTimestamp>e))return r}}getLastMsgKeyForAction(){const e=this.msgs.last();let t;return e&&(t=!this.lastReceivedKey||e.id.fromMe&&e.local&&e.ack===U.default.ACK.CLOCK?e.id:this.lastReceivedKey),t||void 0}getLastTimestampMsg(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&"i"!==(0,oe.eventTypeFromMsgType)(t))return t}}getWebcChatType(){switch(this.kind){case Ke.CHAT:return re.default.WEBC_CHAT_TYPE.INDIVIDUAL;case Ke.GROUP:return re.default.WEBC_CHAT_TYPE.GROUP;case Ke.BROADCAST:return re.default.WEBC_CHAT_TYPE.BROADCAST_LIST;default:throw new TypeError(`Invalid Chat.kind ${String(this.kind)}`)}}deregisterExpiredViewOnceBulkMessages(e){e.forEach(this._deregisterExpiredViewOnceMessage)}_deregisterExpiredViewOnceMessage(e){(0,De.isExpired)(e.safe())&&(0,te.deregisterMsg)(e)}_resetEphemeralMessageExpirationTimer(e){T.default.clearTimeout(this._ephemeralMessageTimerIds.get(e)),this._ephemeralMessageTimerIds.delete(e),this._ephemeralMessagesToDelete.delete(e);const{ephemeralExpirationTimestamp:t}=e;if(null==t||!this.msgs.includes(e))return;const r=()=>{this._ephemeralMessageTimerIds.delete(e),this.active?this._ephemeralMessagesToDelete.add(e):(z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&(0,j.removeExpiredMessagesFromHistory)([e]),e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0}))};if(e.isExpired())r();else{const n=T.default.setGlobalTimeout(r,1e3*t);this._ephemeralMessageTimerIds.set(e,n)}}sendProductMessage(e,t){var r=this;return(0,a.default)((function*(){yield(0,pe.sendProductMessage)(r,e,t)}))()}sendGroupInviteMessage(e,t,r,n,i,a){const s=(0,V.getMaybeMeUser)(),o={ack:U.default.ACK.CLOCK,from:s,id:new se.default({from:s,to:this.id,id:(0,_e.newTag)(),participant:void 0,selfDir:"out"}),local:!0,self:"out",t:L.Clock.globalUnixTime(),to:this.id,type:"groups_v4_invite",isNewMsg:!0,inviteGrpJpegThum:a,inviteCode:r,inviteCodeExp:n,inviteGrp:e,inviteGrpName:t,comment:i};return(0,ye.addAndSendMsgToChat)(this,o)[1]}_isMediaMsg(e){return Boolean(e.asMms&&!e.ctwaContext)}isUnreadMsg(e){const t=this.msgs.filter((e=>e.isUnreadType));return t.includes(e,t.length-this.unreadCount)}_forwardMessageAndSendToChat(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._isMediaMsg(e))return(0,te.forwardMediaMsg)(e,this,r).then(void 0);const n=je(e),i=(0,V.getMaybeMeUser)();let a;z.GK.supportsFeature(z.GK.F.MD_BACKEND)?t.isGroup()&&(a=(0,Ue.toUserWid)(i)):a=void 0;const s=new se.default({from:i,to:t,id:(0,_e.newTag)(),participant:a,selfDir:"out"});e.ctwaContext&&(n.body=e.ctwaContext.sourceUrl,n.type=U.default.MSG_TYPE.CHAT,n.mediaObject=void 0),this.isEphemeralSettingOn()&&(n.ephemeralDuration=this.getEphemeralSetting());const o=this.getEphemeralSettingTimestamp();null!=o&&(n.ephemeralSettingTimestamp=o);const l=this.getDisappearingModeInitiator();return null!=l&&(n.disappearingModeInitiator=l),Object.assign(n,{id:s,from:i,t:L.Clock.globalUnixTime(),to:t,ack:U.default.ACK.CLOCK,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1,isForwarded:e.isForwarded||!e.isSentByMe,forwardedFromWeb:!0,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:r}),(0,ye.addAndSendMsgToChat)(this,n),Promise.resolve()}forwardMessages(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.default)((function*(){const n=t.id,i=t.contact;if(i.isUser&&i.isBlocked())throw new F.default("Forwarded to contact is blocked",i);const a=[];for(const i of e)try{yield t._forwardMessageAndSendToChat(i,n,r)}catch(e){t._isMediaMsg(i)&&a.push(i)}return a}))()}updateReadOnly(){var e;if(this.isSupportGroup()&&this.isReadOnly)return;let t=Promise.resolve();if(this.isGroup&&!(null===(e=this.groupMetadata)||void 0===e?void 0:e.stale)){let e=!1;var r,n;if(z.GK.supportsFeature(z.GK.F.MD_BACKEND))e=!(null===(r=this.groupMetadata)||void 0===r?void 0:r.participants.get((0,V.getMeUser)()));else e=!(null===(n=this.groupMetadata)||void 0===n?void 0:n.participants.get((0,V.getMaybeMeUser)()));t=(0,we.updateLocal)(this.id,{isReadOnly:e}).then((()=>this.isReadOnly=e))}t.then((()=>{this.isBroadcast&&this.updateTitle()}))}updateIsAnnounceGrpRestrict(){const e=this.groupMetadata;if(this.isGroup&&null!=e&&!e.stale){const t=e.participants.get((0,V.getMaybeMeUser)()),r=t&&!t.isAdmin&&e.announce;(0,we.updateLocal)(this.id,{isAnnounceGrpRestrict:r}).then((()=>this.isAnnounceGrpRestrict=r))}}sortMsgs(e){const t=e.map((e=>{const t=(0,_.default)(e.msgChunk,"msg.msgChunk");return{msg:e,chunkT:(0,_.default)(t.at(0),"chunk.at(0)").t,index:t.indexOf(e)}}));return(0,c.default)(t,["chunkT","index"]).map((e=>e.msg))}waitForChatLoading(){let e=Promise.resolve();return z.GK.supportsFeature(z.GK.F.MD_BACKEND)&&this.pendingInitialLoading&&(e=(0,Ne.default)(this,"change:pendingInitialLoading",(()=>!this.pendingInitialLoading))),e}_updateAssignedColor(){var e,t;if(!this.colors)return;const r=null!==(e=null===(t=this.groupMetadata)||void 0===t?void 0:t.participants)&&void 0!==e?e:[],n=this.colors,i=(0,l.default)(Object.keys(n),r.map((e=>e.id.toString())).map(ee.default));i.forEach((function(e){delete n[e]})),i.length&&this._saveAssignedColors()}loadAssignedColors(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),(0,V.getGroupParticipantAssignedColor)(this.id)||{}}saveAssignedColors(){const e=this.colors;e&&(0,V.setGroupParticipantAssignedColor)(this.id,e)}assignedColor(e){const t=this.colors||(this.colors=this.loadAssignedColors());let r;const n=(0,ee.default)(e.toString());if(r=t[n])return r;{const e={};(0,o.default)(t,((t,r)=>{e[t]?e[t].push(r):e[t]=[r]}));let i=Number.POSITIVE_INFINITY;for(let t=1;t<=U.default.NUM_COLORS;t++){if(!e[t]){r=t;break}e[t].length<i&&(i=e[t].length,r=t)}return t[n]=r,this._saveAssignedColors(),r}}unstarAll(){const e=this.getAllMsgs();e.forEach((e=>{e&&(e.star=!1)})),(0,Te.removeStarredMsgs)(e)}constructMediaMsgs(e){if(!e)return this.getMediaMsgs();if(e.isViewOnce)return new I.default;let t;return this.getMediaMsgs().includes(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new I.default,t.includes(e)||(e.msgChunk?t.add(e.msgChunk.filter(this.isMsgForMediaCollection)):t.add(e)),t}fts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0;if(1===t){const n=this.ftsCache[e];if(n)return n;{const n=ie.MsgCollection.search(e,t,r,this.id);this.ftsCache[e]=n;const i=()=>{this.ftsCache[e]=null};return setTimeout(i,3e5),n.catch(i),n}}return ie.MsgCollection.search(e,t,r,this.id)}_clearFtsCache(){this.ftsCache={}}updateSortTime(){if(this.promises.updateSortTime)return;const e=new S.default,t=e.signal,r=(0,fe.default)([t,this._abortController.signal],(e=>(0,m.delayMs)(0).then((()=>{const e=this.getLastTimestampMsg();if(e)this.t=e.t;else if(this.msgs.msgLoadState.noEarlierMsgs);else if(!this.pendingMsgs)return this.loadEarlierMsgs()})).then((t=>{if(e.aborted)throw new h.AbortError;if(t){const e=this.getLastTimestampMsg();this.t=e?e.t:void 0}})).catch((()=>{})).finally((()=>{this.promises.updateSortTime=void 0}))));this.promises.updateSortTime={promise:r,abortController:e}}removeFromCollection(e){var t;(e.star&&(0,Te.removeStarredMsgs)([e]),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.getLinks().length>0&&this.linkMsgs?this.linkMsgs.remove(e):e.asDoc&&this.docMsgs?this.docMsgs.remove(e):null!=e.asProduct&&this.productMsgs&&this.productMsgs.remove(e),this.updateMediasCountOnMsg(e,!0),(0,Z.isGroupCatchUpEnabled)()&&e.chat.isGroup)&&(null===(t=e.chat.groupMetadata)||void 0===t||t.unreadMentionMetadata.removeUnreadMentions(e.id.toString()))}getMediaMsgs(){return this.mediaMsgs||(this.mediaMsgs=new I.default),this.mediaMsgs}getLinkMsgs(){return this.linkMsgs||(this.linkMsgs=new O.default),this.linkMsgs}getDocMsgs(){return this.docMsgs||(this.docMsgs=new M.default),this.docMsgs}getParticipantCount(){var e;return(null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.length)||1}getProductMsgs(){return this.productMsgs||(this.productMsgs=new R.default),this.productMsgs}getReceivedVcardMsgs(){return this.contact.isMyContact||!this.contact.isUser?null:(this.receivedVcardMsgs||(this.receivedVcardMsgs=new D.default,this.receivedVcardMsgs.parent=this),this.receivedVcardMsgs)}dismissVcard(){this.vcardDismissed=!0}updateMediasCountOnMsg(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!z.GK.supportsFeature(z.GK.F.MEDIAS_COUNT))return;const r=t?-1:1;e.isMedia&&(this.mediaCount+=r);const n=e.getLinks().length;n&&(this.linkCount+=r*n),e.asDoc&&(this.docCount+=r)}resetMediasCount(e){z.GK.supportsFeature(z.GK.F.MEDIAS_COUNT)&&(null!=e.mediaCount&&(this.mediaCount=e.mediaCount),null!=e.linkCount&&(this.linkCount=e.linkCount),null!=e.docCount&&(this.docCount=e.docCount))}getStarredMsgs(){let e=this.starredMsgs;return e||(this.starredMsgs=e=new Te.StarredMsgCollection,this.starredMsgs.add(Te.AllStarredMsgsCollection.filter((e=>e.chat===this)))),e}setAndKeepPrevious(e,t){const r=Object.keys(e);r.forEach((e=>{e in this.ackedProps||(this.ackedProps[e]=this[e])})),t.finally((()=>{r.forEach((e=>{delete this.ackedProps[e]}))})),this.set(e)}getAckedPhoneProps(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,ephemeralDuration:this.ephemeralDuration,ephemeralSettingTimestamp:this.ephemeralSettingTimestamp,changeNumberOldJid:this.changeNumberOldJid,changeNumberNewJid:this.changeNumberNewJid,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}}matchFilter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!(0,u.default)(e)||(e.label?this.labels&&this.labels.includes(e.label):e.kind===U.default.SMB_SEARCH_FILTERS.UNREAD?!!this.hasUnread&&!this.isBroadcast:e.kind===U.default.SMB_SEARCH_FILTERS.CONTACT?this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===U.default.SMB_SEARCH_FILTERS.NON_CONTACT?!this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===this.kind)}getEphemeralSetting(){var e;const t=this.isGroup?null===(e=this.groupMetadata)||void 0===e?void 0:e.ephemeralDuration:this.ephemeralDuration;return null==t||0===t?null:t<0?(__LOG__(3)`[ephemeral] invalid duration of ${t} for chat ${this.id.toString()}`,null):t}getEphemeralSettingTimestamp(){return this.isGroup||0===this.ephemeralSettingTimestamp?null:this.ephemeralSettingTimestamp}isEphemeralSettingOn(){const e=this.getEphemeralSetting();return null!=e&&0!==e}shouldShowEphemeralSetting(){if(!z.GK.supportsAnyFeature(z.GK.F.EPHEMERAL_MESSAGES,z.GK.F.MD_BACKEND))return!1;if(this.isGroup){var e,t;const r=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getSuperAdmin();if(null==r?void 0:r.contact.isEnterprise)return!1;if(!(null===(t=this.groupMetadata)||void 0===t?void 0:t.canSetEphemeralSetting())&&!this.isEphemeralSettingOn())return!1}return!this.isBroadcast&&!this.contact.isEnterprise}getDisappearingModeInitiator(){return this.isGroup?null:(0,Z.isDisappearingModeEnabled)()?null!=this.disappearingModeInitiator?this.disappearingModeInitiator:this.isEphemeralSettingOn()?Y.DisappearingModeInitiator.ChangedInChat:null:null}getCollection(){return r(69951).ChatCollection}getGroupMetadataCollection(){return r(63928).default}}function je(e){var t;let r=["buttons","caption","broadcast","ephemeralDuration","ephemeralSettingTimestamp","ephemeralStartTimestamp","ephemeralOutOfSync","dynamicReplyButtons","replyButtons","isMdHistoryMsg","bizPrivacyStatus"];!0===e.isDynamicReplyButtonsMsg&&e.type===U.default.MSG_TYPE.CHAT||(r=["footer",...r]),(null===(t=e.quotedMsg)||void 0===t?void 0:t.type)!==U.default.MSG_TYPE.PRODUCT&&(r=["quotedMsg","quotedParticipant","quotedRemoteJid","quotedStanzaID",...r]);const n=e.asUrl;return null==n||null==n.mediaKeyTimestamp||(0,Re.default)(n.mediaKeyTimestamp)||(r=["mediaKey","mediaKeyTimestamp","thumbnailHQ","thumbnailDirectPath","thumbnailSha256","thumbnailEncSha256","thumbnailHeight","thumbnailWidth",...r]),(0,s.default)(e.toJSON(),r)}Ye.Proxy="chat",Ye.idClass=Ge.default;const We=(0,C.defineModel)(Ye);t.Chat=We},42265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(e,t)=>{const r=e.pin||0,n=t.pin||0;if(r||n)return r!==n?r>n?-1:1:e.id.toString()<t.id.toString()?-1:1;const i=e.t||0,a=t.t||0;return i!==a?i>a?-1:1:e.id.toString()<t.id.toString()?-1:1};t.default=r},69951:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCollectionImpl=t.ChatCollection=void 0;var i=n(r(48926)),a=n(r(35937)),s=n(r(39693)),o=n(r(63105)),l=n(r(35161)),c=n(r(41609)),d=n(r(23279)),u=r(50796),p=r(13959),h=r(67602),f=r(1255),_=r(80140),m=r(63183),g=n(r(42265)),y=r(17239),E=n(r(69618)),S=r(19380),v=r(11082),T=n(r(74036)),A=n(r(45126)),C=r(99234),b=r(7293),P=r(50338),M=r(16770),O=n(r(32219)),I=n(r(51783)),w=r(99662),R=r(91692),D=r(3060),N=r(32613),L=r(3553),k=n(r(68132)),G=r(16774),U=r(66299),F=r(27211),x=n(r(17072)),B=r(77591),K=n(r(39546)),Y=r(65044);class j extends f.BaseCollection{constructor(){super(),this.notSpam={},this.promises={sendUnstarAll:null},this._sortEnabled=!1,this._viewOnceCleanupTaskQueue=new Set,this.enableSortListener(),this.listenTo(Y.Socket,"change:stream",(()=>{Y.Socket.stream===Y.STREAM.RESUMING&&this.forEach((e=>{e.pendingMsgs=!1}))})),this.listenToOnce(this,"sort",(0,d.default)(this.setIndexes,100)),this._scheduleViewOnceMediaCleanup()}_scheduleViewOnceMediaCleanup(){clearTimeout(this._viewOnceCleanupTimeout),this._viewOnceCleanupTimeout=setTimeout((()=>{P.IdleCallbackTasks.enqueue((()=>{this._runViewOnceMediaCleanup(),this._scheduleViewOnceMediaCleanup()}))}),18e5)}_runViewOnceMediaCleanup(){this.forEach((e=>{const t=e.id;this._viewOnceCleanupTaskQueue.has(t)||(P.IdleCallbackTasks.enqueue((()=>{this._viewOnceCleanupTaskQueue.delete(t);const e=this.get(t);!1===(null==e?void 0:e.active)&&e.deregisterExpiredViewOnceBulkMessages(e.msgs)})),this._viewOnceCleanupTaskQueue.add(t))}))}enableSortListener(e){this._sortEnabled||(this.listenTo(this,"change:t change:pin change:shouldAppearInList",this.sort),e&&this.sort(),this._sortEnabled=!0)}disableSortListener(){this._sortEnabled&&(this.stopListening(null,null,this.sort),this._sortEnabled=!1)}setIndexes(){this.forEach(((e,t)=>{e.initialIndex=t}))}getActive(){return this.filter((e=>e.active))[0]}_findQuery(e){var t=this;return(0,i.default)((function*(){const n={},i=yield(0,v.find)(!!e.retry,n);if("preempted"===i)return Promise.reject(new f.CollectionSilentQueryError("chats preempted"));if(y.Conn.platform===y.PLATFORMS.IPHONE||y.Conn.platform===y.PLATFORMS.SMBI){const e=r(59871).MsgCollection;(0,c.default)(i)?e.trigger(E.default.COLLECTION_HAS_SYNCED):setTimeout((()=>{e.trigger(E.default.COLLECTION_HAS_SYNCED)}),2500)}return t.trigger(E.default.COLLECTION_HAS_SYNCED,n),Promise.resolve(i)}))()}sync(){this.findQuery({}).catch((0,u.filteredCatch)(B.WebdDrop,(()=>{})));const e=r(59871).MsgCollection;return Promise.all([(0,x.default)(this,E.default.COLLECTION_HAS_SYNCED),e.hasSynced()])}getKeysForResyncMsgs(){return this.filter((function(e){return e.shouldAppearInList})).map((function(e){const t=e.getAckedPhoneProps(),r=e.lastReceivedKey;return r&&(t.id=r.id,t.fromMe=r.fromMe.toString(),t.participant=r.participant),t}))}resyncMessages(){var e=this;return(0,i.default)((function*(){__LOG__(2)`ChatStore:resyncMessages`;const t=e.getKeysForResyncMsgs();try{const n=yield(0,D.resyncMessages)(t);if(n.status>=400)return __LOG__(3)`ChatStore:resyncMessages resume error ${n.status}`,Promise.reject(new Error("ChatStore:resyncMessages resume error "+n.status));__LOG__(2)`ChatStore:resyncMessages resume success`;try{e.disableSortListener(),n.data.forEach((t=>{if(t.disableUnreadAnchor=!1,t.firstUnreadKey=void 0,t.keys&&1===t.keys.length){const e=t.keys[0];t.firstUnreadKey=new O.default({id:e[0],fromMe:e[1],participant:e[2],remote:t.id})}if("delete"!==t.type&&!K.default.isPSA(t.id)){const e=S.ContactCollection.get(t.id);if(e){if(t.name){const r={name:t.name};(0,F.updateLocal)(e.id,r).then((()=>{e.set(r)}))}}else S.ContactCollection.add({id:t.id,name:t.name})}const r=e.get(t.id);if(r)if("clear"===t.type){r.resetMediaMsgs();const e=[];r.msgs.forEach((t=>e.push(t))),r.msgChunks.length&&r.msgChunks.forEach((t=>{t.forEach((t=>e.push(t)))})),r.set({t:t.t,unreadCount:t.unreadCount,createdLocally:!1,archive:t.archive,isReadOnly:t.isReadOnly,modifyTag:t.modifyTag,msgs:[],notSpam:t.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:t.disableUnreadAnchor,pendingMsgs:t.pendingMsgs,pin:t.pin,changeNumberOldJid:t.changeNumberOldJid,changeNumberNewJid:t.changeNumberNewJid,muteExpiration:t.muteExpiration,ephemeralDuration:t.ephemeralDuration,ephemeralSettingTimestamp:t.ephemeralSettingTimestamp}),e.forEach((e=>{e.delete()})),__LOG__(2)`model:chat:resume: cleared chat for ${t.id}`}else"delete"===t.type?(r.delete(),__LOG__(2)`model:chat:resume: deleted chat for ${t.id}`):r.set(t,{merge:!0});else e.add(t)})),e.enableSortListener(!0)}catch(e){__LOG__(3)`model:chat:resume error in processing reply:${String(e)}`}(0,p.delayMs)(100).then((()=>{b.GK.supportsFeature(b.GK.F.USER_NOTICE)&&I.default.sync(!0),b.GK.supportsFeature(b.GK.F.SETTINGS_SYNC)&&k.default.sync(!0),n.checksum&&(0,N.resyncContacts)(n.checksum),n.statusChecksum&&r(59387).StatusV3Collection.sync(n.statusChecksum),n.quickRepliesChecksum&&w.QuickReplyCollection.sync(n.quickRepliesChecksum),n.labelsChecksum&&M.LabelCollection.sync(n.labelsChecksum),n.stickerPackChecksum&&U.StickerPackCollection.sync(n.stickerPackChecksum),null!=n.recentStickersChecksum&&R.RecentStickerCollection.sync(n.recentStickersChecksum),null!=n.starredStickersChecksum&&G.StarredStickerCollection.sync(n.starredStickersChecksum)})).catch((e=>{__LOG__(3)`model:chat:resume error in processing checksum:${String(e)}`}))}catch(e){return(0,u.filteredCatch)(B.WebdDrop,(function(e){return __LOG__(3)`ChatStore:resyncMessages resume dropped`,Promise.reject(e)}))(e)}}))()}unstarAllMessages(e,t){return(0,L.unstarAllMessages)(e,t)}forwardMessagesToChats(e,t){return(0,i.default)((function*(){const n=Promise.all(e.map((e=>(0,h.promiseProps)({message:e,canForward:e.canForward()&&(null!=r(59871).MsgCollection.get(e.id)||e.isEphemeral)})))),a=yield Promise.all(t.filter((e=>e.canSend)).map(function(){var e=(0,i.default)((function*(e){let t;t=e.isUser&&e.contact.isBlocked()?(0,_.unblockContact)(e.contact):Promise.resolve(!0);const[r]=yield Promise.all([n,t]),i=(0,l.default)((0,o.default)(r,{canForward:!0}),"message"),a=(0,l.default)((0,o.default)(r,{canForward:!1}),"message");return(0,h.promiseProps)({chat:e,undelivered:e.forwardMessages(i,!0),canForward:i,cannotForward:a})}));return function(){return e.apply(this,arguments)}}())),c=(0,s.default)(a.map((e=>{let{chat:t,undelivered:r,canForward:n,cannotForward:i}=e,a=null;return(r.length||i.length)&&(a=(0,T.default)({chat:t,undelivered:r,canForward:n,cannotForward:i})),a?{chat:t,reason:a}:null})));if(c.length)throw new A.default(c);return!0}))()}saveToCache(){if(!y.Conn.shouldSaveToCache())return;const{id:e}=j.cachePolicy;__LOG__(2)`ChatCollection:saveToCache save: ${String(e)}`;const t=this.map(((e,t)=>{const r=e.toJSON(),n=t<20?Math.min(e.unreadCount+20,50):Math.min(Math.max(3,e.unreadCount),20);return r.msgs=e.msgs?e.msgs.slice(-n).map((e=>(0,a.default)(e.toJSON(),(e=>void 0!==e)))):[],r}));(0,C.setCollection)(e,t,!0)}onResume(){const e=this.getActive();e&&e.presence.subscribe()}delete(){super.delete(),this.listenToOnce(this,"sort",(0,d.default)(this.setIndexes,100))}}t.ChatCollectionImpl=j,j.model=m.Chat,j.comparator=g.default;const W=new j;t.ChatCollection=W},6977:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(50796),s=r(1255),o=i(r(69618)),l=n(r(64103)),c=r(17304),d=r(59871),u=r(77591);class p extends s.BaseCollection{constructor(){super(...arguments),this.hasDocBefore=!0}delete(){super.delete(),this.stopListening(),this.reset()}queryDocs(e,t){if(t)return this.queryDocBefore||(this.queryDocBefore=d.MsgCollection.queryMedia(t.id.remote,o.default.MEDIA_QUERY_LIMIT,"before",t.id,"document").then((e=>((!e||e.length<o.default.MEDIA_QUERY_LIMIT)&&(this.hasDocBefore=!1),this.add(e.filter(h),{at:0}),{length:e.length}))).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined,u.E404],(()=>{}))).finally((()=>{this.queryDocBefore=null,this.trigger("query_doc_before")})),this.trigger("query_doc_before")),this.queryDocBefore;{const t=e.msgs;if(0===this.length){if(!t||0===t.length)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(t.filter(h),{at:0})}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*o.default.MEDIA_QUERY_LIMIT){const r=0===this.length?t.head():this.head();return this.queryDocs(e,r)}return new Promise((e=>{e({eof:!1})}))}}}function h(e){return null!=e.asDoc&&!e.isVcardOverMmsDocument}t.default=p,p.model=c.Msg},77653:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(50796),s=r(4352),o=r(1255),l=i(r(69618)),c=n(r(64103)),d=r(17304),u=r(59871),p=r(77591);class h extends o.BaseCollection{constructor(){super(...arguments),this.hasLinkBefore=!0}delete(){super.delete(),this.stopListening(),this.reset()}queryLinks(e,t){if(t)return this.queryLinkBefore||(this.queryLinkBefore=u.MsgCollection.queryMedia(t.id.remote,l.default.MEDIA_QUERY_LIMIT,"before",t.id,"url").then((e=>((!e||e.length<l.default.MEDIA_QUERY_LIMIT)&&(this.hasLinkBefore=!1),this.add(e,{at:0}),this.createLinksAndAddMsgs(e),{length:e.length}))).catch((0,a.filteredCatch)([p.WebdDrop,c.ProtoVersionUndefined,p.E404],(()=>{}))).finally((()=>{this.queryLinkBefore=null,this.trigger("query_link_before")})),this.trigger("query_link_before")),this.queryLinkBefore;{const t=e.msgs.getModelsArray();if(0===this.length){if(!t||0===t.length)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(t.filter((e=>e.getLinks().length>0)),{at:0}),this.createLinksAndAddMsgs(t)}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*l.default.MEDIA_QUERY_LIMIT){const t=0===this.length?e.msgs.head():this.head();return this.queryLinks(e,t)}return new Promise((e=>{e({eof:!1})}))}}createLinksAndAddMsgs(e){const t=[];(0,s.promiseLoop)(((r,n,i)=>{if(e.length===i)return void r();const a=e[i];if(null!=a){a.getLinks().length&&t.push(a)}})).then((()=>{this.add(t),this.trigger("query_link_before")}))}}t.default=h,h.model=d.Msg,h.comparator=(e,t)=>e.t-t.t},65568:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(50796),s=r(1255),o=i(r(69618)),l=n(r(64103)),c=r(17304),d=r(59871),u=r(77591);const p="before",h="after";function f(e){return e.isMedia&&!e.isViewOnce}class _ extends s.BaseCollection{constructor(){super(...arguments),this.hasMediaBefore=!0,this.hasMediaAfter=!0}delete(){super.delete(),this.stopListening()}getAfter(e){const t=this.indexOf(e);return t<0||t===this.length-1?null:this.at(t+1)}getBefore(e){const t=this.indexOf(e);return t<=0?null:this.at(t-1)}loadEarlierMedias(){const e=this.head();e&&this.queryMedia({msg:e})}loadRecentMedias(){const e=this.last();e&&this.queryMedia({msg:e,direction:h})}loadMoreAroundIfNeeded(e){if(!e||e.isViewOnce)return;const t=this.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}queryMedia(e){var t;const{chat:r,msg:n}=e,i=null!==(t=e.direction)&&void 0!==t?t:p;if(!n&&r){const e=r.msgs;if(!e||0===e.length)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(e.filter(f),{at:0});const t=this.toArray();if(r.msgs.msgLoadState.noEarlierMsgs)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));if(t.length<=2*o.default.MEDIA_QUERY_LIMIT){const n=0===t.length?e.head():t[0];return this.queryMedia({chat:r,msg:n})}return new Promise((e=>{e({eof:!1})}))}if(n&&i===p){if(this.queryMediaBefore)return this.queryMediaBefore;let e=0;return this.queryMediaBefore=d.MsgCollection.queryMedia(n.id.remote,o.default.MEDIA_QUERY_LIMIT,i,n.isMedia?n.id:void 0).then((t=>{const n=t.messages;(!n||n.length<o.default.MEDIA_QUERY_LIMIT)&&(this.hasMediaBefore=!1);let i=[];n&&n.length>0&&(i=n.filter(f)),this.add(i,{at:0});const a={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return r&&r.resetMediasCount(a),e=i.length,{length:e}})).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined,u.E404],(()=>{}))).finally((()=>{this.queryMediaBefore=null,this.trigger("query_media_before",e)})),this.trigger("query_media_before",0),this.queryMediaBefore}if(n&&i===h)return this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=d.MsgCollection.queryMedia(n.id.remote,o.default.MEDIA_QUERY_LIMIT,i,n.id).then((e=>{const t=e.messages;(!t||t.length<o.default.MEDIA_QUERY_LIMIT)&&(this.hasMediaAfter=!1);let n=[];t&&t.length>0&&(n=t.filter(f)),this.add(n);const i={mediaCount:e.mediaCount,linkCount:e.linkCount,docCount:e.docCount};return r&&r.resetMediasCount(i),{length:n.length}})).catch((0,a.filteredCatch)([u.WebdDrop,l.ProtoVersionUndefined,u.E404],(()=>{}))).finally((()=>{this.queryMediaAfter=null,this.trigger("query_media_after")}))}}t.default=_,_.model=c.Msg},51612:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgLoadState=t.ChatMsgsCollection=void 0;var i=n(r(81109)),a=n(r(41143)),s=r(1255),o=r(11290),l=r(17304);class c extends o.BaseModel{constructor(){super(...arguments),this.noEarlierMsgs=(0,o.prop)(),this.isLoadingEarlierMsgs=(0,o.prop)(),this.isLoadingRecentMsgs=(0,o.prop)(),this.isLoadingAroundMsgs=(0,o.prop)(),this.contextLoaded=(0,o.prop)()}}c.Proxy="msgLoad";const d=(0,o.defineModel)(c);t.MsgLoadState=d;class u extends s.BaseCollection{constructor(){super(),this.msgLoadState=new d({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)}delete(){this.stopListening(),super.delete(),this.msgLoadState.delete()}triggerChangeLast(e,t,r){const n=this.last();if(this._last!==n){this._last=n;let i=!1;const a=!!r.add,s=!!r.remove;t.includes(e)&&a&&!s&&(i=!0),this.trigger("change:last",n,i)}}add(e,t){let n;Array.isArray(e)?1===e.length&&(n=e[0]):n=e;let a=[];if(null!=n&&(n.isInitialE2ENotification||n.isDisappearingModeSystemMessage)){const r=this.some((e=>e.isInitialE2ENotification));if(n.isInitialE2ENotification&&(r||(a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:0})))),n.isDisappearingModeSystemMessage){if(!this.some((e=>e.isDisappearingModeSystemMessage))){const n=r?1:0;a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:n}))}}a&&this.trigger("insert_msgs",a,t)}else a=super.add(e,t);if(a.length>0){r(59871).MsgCollection.add(a,t).forEach((e=>{e&&this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",a,t)}return a}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=super.remove(e,t),i=!!t&&t.silent,a=n.filter((e=>!!e));return a.length&&!i&&(this.trigger("remove_msgs",a,t),r||this.trigger("update_sort_time")),n}replace(e){this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise;const t=e.getModelsArray();this.set(t,{silent:!0,merge:!1}),t.forEach((e=>{this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",t)}onMsgLoadStateChange(e){let t;const r=()=>{e()},n=()=>{(0,a.default)(null!=t,"prevMsgLoadState cannot be null after bulk_add"),t.off("change",r);const n=this.msgLoadState;n.on("change",r),t=n,e()};t=this.msgLoadState,t.on("change",r),this.on("bulk_add",n);let i=()=>{(0,a.default)(null!=t,"prevMsgLoadState cannot be null when unsubscribing"),this.off("bulk_add",n),t.off("change",r)};return()=>{const e=i;e&&(i=null,e())}}}t.ChatMsgsCollection=u,u.model=l.Msg},33929:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PREFERENCE=t.ChatPreference=void 0;var i=r(11290),a=n(r(39546));const s="defaultPreference";t.DEFAULT_PREFERENCE=s;class o extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.wallpaperColor=(0,i.prop)(),this.saveToCameraRoll=(0,i.prop)(),this.showDoodle=(0,i.prop)()}getCollection(){return r(66034).default}}o.Proxy="chatPreference",o.idClass=a.default,o.allowedIds=[s];const l=(0,i.defineModel)(o);t.ChatPreference=l},66034:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1255),a=r(33929),s=n(r(69618));class o extends i.BaseCollection{initializeFromCache(e){this.add([{id:a.DEFAULT_PREFERENCE,wallpaperColor:s.default.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0},...e||[]],{merge:!0})}get(e){return super.get(e)||super.get(a.DEFAULT_PREFERENCE)}delete(){super.delete(),this.add({id:a.DEFAULT_PREFERENCE,wallpaperColor:s.default.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0})}}o.model=a.ChatPreference,o.cachePolicy={id:s.default.KEY_CHAT_PREFERENCE_COLLECTION,policy:i.CACHE_POLICY.LOAD,delay:1e3};var l=new o;t.default=l},59893:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1255),i=r(17304);class a extends n.BaseCollection{constructor(){super(...arguments),this.hasProductBefore=!0}delete(){super.delete(),this.stopListening(),this.reset()}queryProducts(e){const t=e.msgs;return this.hasProductBefore=!1,this.add(t.filter((e=>null!=e.asProduct)),{at:0}),Promise.resolve()}}t.default=a,a.model=i.Msg,a.comparator=(e,t)=>e.t-t.t},16173:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(50796),i=r(1255),a=r(7293),s=r(17304),o=r(59871),l=r(77591);class c extends i.BaseCollection{constructor(){super(...arguments),this.syncPromise=null,this.isSynced=!1}onResume(){this.isSynced=!1,this.sync(this.parent)}sync(e){return a.GK.supportsFeature(a.GK.F.INDEX_RECEIVED_VCARD)?this.isSynced?Promise.resolve():(this.syncPromise||(this.syncPromise=o.MsgCollection.queryVcard(e.id).then((e=>this.add(e))).catch((0,n.filteredCatch)(l.E499,(()=>{}))).catch((()=>{})).finally((()=>{this.isSynced=!0,this.syncPromise=null}))),this.syncPromise):(this.isSynced=!0,Promise.resolve())}}t.default=c,c.model=s.Msg,c.resumeOnAvailable=!0},11006:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(31727)),a=n(r(41809));class s extends i.default{oldestUnreadMention(){var e;const t=null!==(e=this.last())&&void 0!==e?e:null;return t&&this.remove(t),t}}t.default=s,s.model=a.default,s.comparator=(e,t)=>t.timestamp-e.timestamp},4550:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=n(r(44558)),s=r(55975);function o(){return(o=(0,i.default)((function*(){(yield Promise.allSettled([(0,a.default)(),s.LruMediaStore.clear()])).forEach((e=>{if("rejected"===e.status)throw e.reason}))}))).apply(this,arguments)}},98423:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.handle=function(e){let[t]=e;switch(t.type){case"const":l.default[t.key]=t.value;break;case"read":if(t.isStatus){f.StatusV3Collection.handle([t]);break}case"unread":const e=s.ChatCollection.get(t.jid);e&&("read"===t.type?(0,_.markSeen)(e):"unread"===t.type&&(0,_.markUnseen)(e));break;case"log":o.upload({reason:o.SERVER_REQUESTED,immediate:!0,force:!0,isHighPri:!0});break;case"privacy":if(t.jid){const e=u.PresenceCollection.get(t.jid);e&&e.reset(),p.ProfilePicThumbCollection.update(t.jid).catch((0,a.filteredCatch)(m.WebdDrop,(()=>{}))),h.StatusCollection.update(t.jid).catch((0,a.filteredCatch)(m.WebdDrop,(()=>{})))}else __LOG__(3)`Store:Cmd:handle:privacy no jid`;break;case"identity":if(t.jid){const e=c.ContactCollection.get(t.jid);e?(0,d.updateIdentity)(e,t):__LOG__(3)`Store:Cmd:handle:identity no contact`}else __LOG__(3)`Store:Cmd:handle:identity no jid`;break;default:__LOG__(3)`Store:Cmd:handle:unknown ${t.type}`}};var a=r(50796),s=r(69951),o=i(r(85965)),l=n(r(69618)),c=r(19380),d=r(84765),u=r(68315),p=r(82039),h=r(46133),f=r(59387),_=r(9609),m=r(77591)},17239:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=t.ConnImpl=t.Conn=void 0;var i=n(r(23279)),a=n(r(44908)),s=r(11290),o=r(88102),l=n(r(69618)),c=r(99234),d=r(7293),u=n(r(83938)),p=n(r(43725)),h=r(46582),f=n(r(11339)),_=n(r(69594));const m={ANDROID:"android",BB:"bb",BBX:"bbx",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",S40:"s40",SMBA:"smba",SMBI:"smbi",SYMBIAN:"symbian",WP7:"wp7"};t.PLATFORMS=m;class g extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.ref=(0,s.prop)(),this.refTTL=(0,s.prop)(),this.refId=(0,s.prop)(),this.wid=(0,s.prop)(),this.connected=(0,s.prop)(),this.protoVersion=(0,s.prop)(),this.clientToken=(0,s.prop)(),this.serverToken=(0,s.prop)(),this.secret=(0,s.prop)(),this.isResponse=(0,s.prop)(),this.battery=(0,s.prop)(),this.plugged=(0,s.prop)(),this.lc=(0,s.prop)(),this.lg=(0,s.prop)(),this.locales=(0,s.prop)(),this.is24h=(0,s.prop)(),this.platform=(0,s.prop)(),this.phone=(0,s.prop)(),this.tos=(0,s.prop)(),this.smbTos=(0,s.prop)(0),this.pushname=(0,s.prop)(),this.blockStoreAdds=(0,s.session)(!1),this.isVoipInitialized=(0,s.session)(!1),this.refExpiry=(0,s.derived)(this._refExpiry,["ref","refTTL"]),this.locale=(0,s.derived)(this._locale,["lg","lc"]),this.localesList=(0,s.derived)(this._localesList,["locales","lg","lc"]),this.allLocales=(0,s.derived)(this._allLocales,["localesList"]),this.allLanguages=(0,s.derived)(this._allLanguages,["localesList"]),this.platformField=(0,s.derived)(this._platformField,["platform"]),this.tosShowCallNotification=(0,s.derived)(this._tosShowCallNotification,["tos"]),this.isSMB=(0,s.derived)(this._isSMB,["platform"])}_refExpiry(){return Date.now()+this.refTTL}_locale(){return this.formatLocale(this.lg,this.lc)}_localesList(){return this.locales&&this.locales.length?this.locales.split(",").map((e=>{const[t,r]=e.split("-");return t?[t,r]:null})).filter(Boolean):this.lg?[[this.lg,this.lc]]:[]}_allLocales(){return(0,a.default)(this.localesList.map((e=>{let[t,r]=e;return this.formatLocale(t,r)}))).filter(Boolean)}_allLanguages(){return(0,a.default)(this.localesList.map((e=>{let[t,r]=e;return t})))}_platformField(){return"wp7"===this.platform?f.default.PLATFORM_TYPE.WP:this.platform&&f.default.PLATFORM_TYPE[this.platform.toUpperCase()]||f.default.PLATFORM_TYPE.UNKNOWN}_tosShowCallNotification(){return d.GK.supportsFeature(d.GK.F.MD_BACKEND)||this.tos<2}_isSMB(){return this.platform===m.SMBA||this.platform===m.SMBI}initialize(){s.BaseModel.prototype.initialize.call(this),this.listenTo(this,"change:locale",(function(e,t){p.default.setLocale(t,l.default.L10N_PRIORITY.PHONE)})),this.listenTo(this,"change:plugged",(0,i.default)((()=>{f.default.Global.webcPhoneCharging=this.plugged}),5e3,{leading:!0})),this.listenTo(this,"change:phone",(()=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{mcc:t,mnc:r}=e;t&&"string"==typeof t&&(t=parseInt(t,10));r&&"string"==typeof r&&(r=parseInt(r,10));f.default.Global.set({mcc:null!=t?t:null,mnc:null!=r?r:null,webcPhoneDeviceManufacturer:e.device_manufacturer||null,webcPhoneDeviceModel:e.device_model||null,webcPhoneOsBuildNumber:e.os_build_number||null,webcPhoneOsVersion:e.os_version||null,webcPhoneAppVersion:e.wa_version||null})}(this.phone)})),this.listenTo(this,"change:platform",this.handlePlatformChange),this.listenTo(o.Cmd,"main_stream_mode_ready_legacy",this.updateVoipAvailability)}delete(){(0,c.setPushname)(),(0,c.setVersion)(),this.clear()}canSetMyPushname(){return!this.isSMB}updateVoipAvailability(){__LOG__(2)`Conn: updateVoipAvailability`,(0,h.requireVoip)().then((e=>{if(!_.default.isVoiceCallEnabled()&&!_.default.isVideoCallEnabled())return __LOG__(2)`Conn: updateVoipAvailability, Voip GK false`,e.cleanup(),void(this.isVoipInitialized=!1);this.id&&(0,c.getMaybeMeUser)()?(0,u.default)().then((t=>{t?(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip true`,e.init().then((t=>{__LOG__(2)`Conn: updateVoipAvailability, Voip initialized: ${t}`,this.isVoipInitialized=t,t&&e.updateAudioVideoSwitch()}))):(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip false`,e.cleanup(),this.isVoipInitialized=!1)})):(__LOG__(2)`Conn: updateVoipAvailability, getMaybeMeUser undefined`,e.cleanup(),this.isVoipInitialized=!1)}))}handlePlatformChange(){__LOG__(2)`Conn: platform change: ${this.platform}`,this.platform&&(0,c.setLastMobilePlatform)(this.platform)}formatLocale(e,t){return e?t?e.toLowerCase()+"-"+t.toUpperCase():e.toLowerCase():null}shouldSaveToCache(){return!!(0,c.getMe)()&&!!this.id}}t.ConnImpl=g,g.Proxy="conn";const y=new((0,s.defineModel)(g))({id:"1"});t.Conn=y},32161:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new RegExp("[A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]");t.default=r},121:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(32161)),a=r(11290),s=r(32826),o=r(352),l=r(17239),c=n(r(69618)),d=r(47969),u=r(99234),p=r(57701),h=n(r(43725)),f=r(905),_=n(r(64084)),m=r(82039),g=r(959),y=r(46133),E=n(r(39546)),S=n(r(39938));const v=/^[^0-9]+$/;class T extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.name=(0,a.prop)(),this.shortName=(0,a.prop)(),this.pushname=(0,a.prop)(),this.type=(0,a.prop)("in"),this.verifiedName=(0,a.prop)(),this.isBusiness=(0,a.prop)(),this.isEnterprise=(0,a.prop)(),this.verifiedLevel=(0,a.prop)(),this.privacyMode=(0,a.prop)(),this.statusMute=(0,a.prop)(),this.sectionHeader=(0,a.prop)(),this.labels=(0,a.prop)(),this.isContactSyncCompleted=(0,a.prop)(),this.forcedBusinessUpdateFromServer=(0,a.prop)(),this.disappearingModeDuration=(0,a.prop)(),this.disappearingModeSettingTimestamp=(0,a.prop)(),this.isContactBlocked=(0,a.session)(!1),this.verificationString=(0,a.session)(),this.verificationBinary=(0,a.session)(),this.pendingAction=(0,a.session)(),this.promises=(0,a.session)((()=>({}))),this.status=(0,a.session)(),this.profilePicThumb=(0,a.session)(),this.businessProfile=(0,a.session)(),this.commonGroups=(0,a.session)(),this.liveLocations=(0,a.session)(),this.businessCatalog=(0,a.session)(),this.locale=(0,a.session)(),this.notifyName=(0,a.derived)(this._notifyNameFunction,["pushname","isBusiness","verifiedLevel","verifiedName"]),this.mentionName=(0,a.derived)(this._mentionName,["isMyContact","isBusiness","verifiedLevel","name","notifyName"]),this.displayName=(0,a.derived)(this._displayName,["id","mentionName","isMe"]),this.userid=(0,a.derived)(this._userid),this.userhash=(0,a.derived)(this._userhash),this.searchName=(0,a.derived)(this._searchName,["name","id","locale"]),this.searchVerifiedName=(0,a.derived)(this._searchVerifiedName,["verifiedLevel","verifiedName"]),this.header=(0,a.derived)(this._header,["name"]),this.isMe=(0,a.derived)(this._isMe),this.isUser=(0,a.derived)(this._isUser),this.isGroup=(0,a.derived)(this._isGroup),this.isBroadcast=(0,a.derived)(this._isBroadcast),this.isPSA=(0,a.derived)(this._isPSA),this.formattedShortNameWithNonBreakingSpaces=(0,a.derived)(this._formattedShortNameWithNonBreakingSpaces,["shortName","formattedName","id","locale"]),this.formattedShortName=(0,a.derived)(this._formattedShortName,["shortName","formattedName","id","locale"]),this.formattedName=(0,a.derived)(this._formattedName,["name","id","locale","verifiedLevel","verifiedName"]),this.formattedUser=(0,a.derived)(this._formattedUser,["name","id","locale","verifiedLevel","verifiedName"]),this.isWAContact=(0,a.derived)(this._isWAContact,["type"]),this.isMyContact=(0,a.derived)(this._isMyContact,["name"]),this.showBusinessCheckmarkAsPrimary=(0,a.derived)(this._showBusinessCheckmarkAsPrimary,["isBusiness","verifiedLevel","name","verifiedName"]),this.showBusinessCheckmarkAsSecondary=(0,a.derived)(this._showBusinessCheckmarkAsSecondary,["isBusiness","verifiedLevel","name","verifiedName"]),this.shouldForceBusinessUpdate=(0,a.derived)(this._shouldForceBusinessUpdate,["forcedBusinessUpdateFromServer","isContactSyncCompleted"])}_notifyNameFunction(){return this.isBusiness&&this.verifiedLevel!==c.default.VERIFIED_LEVEL.HIGH?this.verifiedName:this.pushname}_mentionName(){return!this.isMyContact&&this.isBusiness&&this.verifiedLevel!==c.default.VERIFIED_LEVEL.HIGH?null:this.name||this.notifyName}_displayName(){return this.isMe&&l.Conn.pushname?l.Conn.pushname:this.mentionName||(0,S.default)(this.id)}_userid(){return this.isUser?E.default.user(this.id):null}_userhash(){return this.isUser?(0,_.default)((this.id.user||"")+"WA_ADD_NOTIF"):null}_searchName(){return E.default.isPSA(this.id)?h.default.accentFold(h.default.t(1922)):this.name?h.default.accentFold(this.name):null}_searchVerifiedName(){return this.verifiedLevel!==c.default.VERIFIED_LEVEL.HIGH?null:this.verifiedName?h.default.accentFold(this.verifiedName):null}_header(){if(this.name){const e=this.name.toLowerCase(),t=i.default.exec(e);if(t&&0===t.index||t&&v.test(e.slice(t.index))){const e=t[0],r=h.default.removeAccents(e);return(0,d.getCollator)().compare(r,e)?e:r}return"#"}}_isMe(){return this.id.equals((0,u.getMaybeMeUser)())}_isUser(){return E.default.isUser(this.id)}_isGroup(){return E.default.isGroup(this.id)}_isBroadcast(){return E.default.isBroadcast(this.id)}_isPSA(){return E.default.isPSA(this.id)}_formattedShortNameWithNonBreakingSpaces(){return this.id?this.isMe?h.default.t(1911):this.shortName||this.formattedName&&this.formattedName.replace(/\s/g," "):""}_formattedShortName(){return this.id?this.isMe?h.default.t(1911):this.shortName||this.formattedName:""}_formattedName(){return this.id?this.isMe?h.default.t(1911):E.default.isPSA(this.id)?h.default.t(1922):this.name?this.name:this.verifiedLevel===c.default.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:this.isUser?(0,S.default)(this.id):"":""}_formattedUser(){return this.getFormattedUser()}_isWAContact(){return this.isUser&&"in"===this.type}_isMyContact(){var e;return!(!this.isUser||!(null===(e=this.name)||void 0===e?void 0:e.length))}_showBusinessCheckmarkAsPrimary(){return this.isBusiness&&this.verifiedLevel===c.default.VERIFIED_LEVEL.HIGH&&(this.name===this.verifiedName||!this.name)}_showBusinessCheckmarkAsSecondary(){return this.isBusiness&&this.verifiedLevel===c.default.VERIFIED_LEVEL.HIGH&&Boolean(this.name)&&this.name!==this.verifiedName}_shouldForceBusinessUpdate(){return!this.forcedBusinessUpdateFromServer&&!this.isContactSyncCompleted}initialize(){super.initialize(),this.id&&(this.isMe&&this.addChild("status",y.StatusCollection.gadd(this.id)),this.isMe&&this.addChild("profilePicThumb",m.ProfilePicThumbCollection.gadd(this.id)),(this.isBusiness||this.isMe&&l.Conn.isSMB)&&this.addChild("businessProfile",r(93581).BusinessProfileCollection.gadd(this.id)),this.listenTo(this,"change:isBusiness",(()=>(0,o.onIsBusinessChange)(this))),this.isMe&&this.listenTo(l.Conn,"change:pushname",(()=>{this.set({pushname:l.Conn.pushname})})),this.listenTo(h.default,"locale_change",(()=>{this.locale=h.default.getLocale()})),this.listenTo(this,"change:name",this.updateShortName),this.isContactBlocked=!!s.BlocklistCollection.get(this.id),this.pendingAction=0,l.Conn.isSMB&&(0,f.initializeLabels)(this))}updateShortName(){if(this.isUser&&this.name&&!this.shortName){const e=(0,g.getShortName)(this.name);e&&this.set("shortName",e)}}getStatus(){return E.default.user(this.id)||__LOG__(2)`contact:getStatus for non-user ${this.id.toString()}`,this.status=y.StatusCollection.gadd(this.id)}getProfilePicThumb(){return this.profilePicThumb=m.ProfilePicThumbCollection.gadd(this.id)}addPendingAction(e){const t=()=>{this.decPending()};return e.then(t,t),this.pendingAction++,e}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`contact:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}isBlocked(){return!!s.BlocklistCollection.get(this.id)}searchMatch(e,t,r){var n;return(0,p.canDisplayLabel)()&&r?!(e&&this.searchName&&!this.searchName.includes(e))&&Boolean(null===(n=this.labels)||void 0===n?void 0:n.includes(r)):!!e&&(!(!this.searchName||!this.searchName.includes(e))||(!(!this.userid||!this.userid.includes(e))||(!!(t&&this.userid&&this.userid.includes(t))||(!(!this.searchVerifiedName||!this.searchVerifiedName.includes(e))||!(!this.pushname||!h.default.accentFold(this.pushname).includes(e))))))}getFormattedUser(){return this.id?E.default.isPSA(this.id)?h.default.t(1922):this.name?this.name:this.verifiedLevel===c.default.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:(0,S.default)(this.id):""}set(e,t,r){const n=super.set(e,t,r);if("string"!=typeof e&&(null==t?void 0:t.merge)&&n){if(n.isPSA)return n;!e.name&&n.name&&(n.unset("name"),n.unset("shortName")),!e.verifiedName&&n.verifiedName&&n.unset("verifiedName")}return n}getCollection(){return r(19380).ContactCollection}setNotMyContact(){this.name&&this.set("name",void 0)}}T.Proxy="contact",T.idClass=E.default;var A=(0,a.defineModel)(T);t.default=A},19380:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ContactCollectionImpl=t.ContactCollection=void 0;var i=n(r(23279)),a=r(50796),s=r(1255),o=r(45873),l=n(r(69618)),c=n(r(121)),d=r(47969),u=r(43024),p=r(8071),h=r(99234),f=n(r(43725)),_=n(r(35029)),m=n(r(17072)),g=r(77591),y=r(65044);class E extends s.BaseCollection{constructor(){super(),this._contactHashes=new _.default,this.checksum=void 0,this._frequentContacts={},this._sort=(0,i.default)((()=>super.sort()),1e3),this._silentSort=(0,i.default)((()=>super.sort({silent:!0})),1e3),this.listenTo(f.default,"locale_change",(()=>this.sort())),this.listenTo(this,"change:name",this.sort),this.listenTo(y.Socket,"change:stream",(()=>{y.Socket.stream===y.STREAM.RESUMING&&this.forEach((e=>{e.unset("verificationString"),e.unset("verificationBinary")}))})),this.listenTo(this,"add",this.contactAdded),this.listenTo(this,"remove",this.contactRemoved)}sort(e){return(null==e?void 0:e.silent)?this._silentSort():this._sort()}ensureSorted(){this._sort.flush()}initializeFromCache(e){e&&(__LOG__(2)`Store:Contact init from cache`,this.add(e,{silent:!0,merge:!0}))}contactAdded(e){this._contactHashes.put(e)}contactRemoved(e){this._contactHashes.remove(e)}contactHashLength(){return this._contactHashes.length}delete(){super.delete(),this.setChecksum(),delete this.checksum,this._frequentContacts={},(0,p.setFrequent)({}).catch((()=>{})),this._contactHashes.clear()}isFilteredContact(e){return!!e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}getFilteredContacts(){return this.filter((function(e){return e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}))}getGroupContacts(){return this.filter((e=>e.isGroup))}_find(e){const t=this.get(e);return t?Promise.resolve(t):Promise.resolve({id:e})}_findQuery(e){return(0,u.contactFindQuery)(e)}sync(){return this.findQuery({}).catch((0,a.filteredCatch)(g.WebdDrop,(()=>{}))),(0,m.default)(this,l.default.COLLECTION_HAS_SYNCED)}updateFrequentContacts(e){this._frequentContacts=e}frequentContacts(e,t){let r=e&&this._frequentContacts[e];if(r||(r=this._frequentContacts.message),!r)return[];const n=null==t?void 0:t.id;return r.map((e=>this.get(e))).filter((e=>!!e&&!e.id.equals(n)))}getUserCount(){return this.map((e=>e.isUser?1:0)).reduce(((e,t)=>e+t),0)}setChecksum(e){this.checksum=e,(0,h.setContactChecksum)(this.checksum),(0,o.setChecksum)(e).catch((()=>{}))}resolveWidsFromHash(e){return this._contactHashes.get(e)}}t.ContactCollectionImpl=E,E.model=c.default,E.comparator=d.ContactComparator;const S=new E;t.ContactCollection=S},47969:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ContactComparator=void 0,t.getCollator=function(){return o};var i=r(88102),a=n(r(69618)),s=r(99234);let o;l(),i.Cmd.on("set_locale",l);function l(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.default.L10N.DEFAULT;if(null===(e=self.Intl)||void 0===e?void 0:e.Collator){const e=self.Intl.Collator([t],{sensitivity:"base"});o={compare(t,r){try{return e.compare(t,r)}catch(e){return 0}}}}else o={compare:(e,t)=>e.localeCompare(t)}}t.ContactComparator=(e,t)=>{const r=e.id.toString(),n=t.id.toString(),i=(0,s.getMaybeMeUser)(),a=i&&i.toString();if(r===a)return 1;if(n===a)return-1;const l=e.name,c=t.name;if(!l&&c)return 1;if(l&&!c)return-1;if(l&&c&&e.header&&t.header){const r=o.compare(e.header,t.header);return 0===r?o.compare(l,c):r}return r&&n?r.localeCompare(n):-1}},959:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getShortName=function(e){if(null==e)return null;const[t]=e.split(/\s/);if(i.default.exec(t))return t;return __LOG__(2)`[short-name] unable to get short name for contact: ${e}`,null};var i=n(r(32161))},35029:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(82729)),a=n(r(45095)),s=n(r(39546));class o{constructor(){this._map={},this.length=0}static getSidelistHash(e){return e.isUser?"string"==typeof e.userhash&&e.userhash.slice?e.userhash.slice(0,4):(__LOG__(3)`Store:Contact can't call slice on contact.userhash`,null):null}put(e){const t=o.getSidelistHash(e);if(t&&!this._map[t]){if(this._map[t]){const r=this._map[t];r instanceof s.default?this._map[t]=[r,e.id]:r instanceof Array&&r.push(e.id)}else this._map[t]=e.id;this.length++}}remove(e){const t=o.getSidelistHash(e);if(!t||!this._map[t])return;const r=(0,a.default)(this._map[t],"this._map[hash]");r instanceof s.default?delete this._map[t]:r instanceof Array&&(0,i.default)(r,(t=>t.equals(e.id))),this.length++}get(e){const t=this._map[e];return t instanceof s.default?[t]:t}clear(){this._map={},this.length=0}}t.default=o},18787:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ConversionTupleExpiry=t.ConversionTuple=void 0;var i=r(8584),a=n(r(15421)),s=r(11290),o=r(22683),l=n(r(39546));const c=604800;t.ConversionTupleExpiry=c;class d extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.conversionData=(0,s.prop)(),this.conversionSource=(0,s.prop)(),this.timestamp=(0,s.prop)((()=>o.Clock.globalUnixTime())),this.alarmId=(0,s.session)()}initialize(){super.initialize(),this.listenTo(this,"change:timestamp",this._setExpiryTimer),this._setExpiryTimer()}_setExpiryTimer(){const e=this.timestamp+c;if(e<0)return __LOG__(3)`Invalid conversionTuple timer`,void this.delete();this.alarmId=a.default.setLocalTimeout((()=>{this.delete()}),1e3*e,this.alarmId)}_clearAlarm(){this.alarmId&&(a.default.clearTimeout(this.alarmId),this.alarmId=void 0)}elapsedSeconds(){return o.Clock.globalUnixTime()-this.timestamp}formatTuple(){const e={conversionDelaySeconds:this.elapsedSeconds()};return this.conversionData&&(e.conversionData=this.conversionData),this.conversionSource&&(e.conversionSource=this.conversionSource),e}toJSON(){const e=this.serialize(),t=e.conversionData;if(t instanceof ArrayBuffer){const r=new i.Binary(t);e.conversionData=r.readString(t.byteLength)}return e}delete(){super.delete(),this.getCollection().remove(this.id),this._clearAlarm()}getCollection(){return r(35667).default}}d.Proxy="conversionTuple",d.idClass=l.default;const u=(0,s.defineModel)(d);t.ConversionTuple=u},35667:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1255),i=r(22683),a=r(18787),s=r(7111);class o extends n.BaseCollection{initializeFromCache(e){if(!e)return;const t=i.Clock.globalUnixTime()-a.ConversionTupleExpiry,r=e.filter((e=>e.timestamp-t>0)).map((e=>{const t=(0,s.parseConversionData)(e.conversionData);return t?e.conversionData=t:delete e.conversionData,e}));this.add(r),this.saveToCache()}}o.model=a.ConversionTuple,o.cachePolicy={id:"conversion_tuple",policy:n.CACHE_POLICY.LOAD,delay:1e3};var l=new o;t.default=l},21547:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);const i=864e5;class a extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.startTime=(0,n.prop)(),this.pttCancelBroadcast=(0,n.prop)(0),this.pttCancelGroup=(0,n.prop)(0),this.pttCancelIndividual=(0,n.prop)(0),this.pttDraftReviewBroadcast=(0,n.prop)(0),this.pttDraftReviewGroup=(0,n.prop)(0),this.pttDraftReviewIndividual=(0,n.prop)(0),this.pttFastplaybackBroadcast=(0,n.prop)(0),this.pttFastplaybackGroup=(0,n.prop)(0),this.pttFastplaybackIndividual=(0,n.prop)(0),this.pttLockBroadcast=(0,n.prop)(0),this.pttLockGroup=(0,n.prop)(0),this.pttLockIndividual=(0,n.prop)(0),this.pttPlaybackBroadcast=(0,n.prop)(0),this.pttPlaybackGroup=(0,n.prop)(0),this.pttPlaybackIndividual=(0,n.prop)(0),this.pttRecordBroadcast=(0,n.prop)(0),this.pttRecordGroup=(0,n.prop)(0),this.pttRecordIndividual=(0,n.prop)(0),this.pttSendBroadcast=(0,n.prop)(0),this.pttSendGroup=(0,n.prop)(0),this.pttSendIndividual=(0,n.prop)(0),this.pttPausedRecordBroadcast=(0,n.prop)(0),this.pttPausedRecordGroup=(0,n.prop)(0),this.pttPausedRecordIndividual=(0,n.prop)(0),this.pttStopTapBroadcast=(0,n.prop)(0),this.pttStopTapGroup=(0,n.prop)(0),this.pttStopTapIndividual=(0,n.prop)(0),this.pttOutOfChatBroadcast=(0,n.prop)(0),this.pttOutOfChatGroup=(0,n.prop)(0),this.pttOutOfChatIndividual=(0,n.prop)(0)}getEndTime(){return this.startTime+i}shouldBeSubmitted(){return!this.isExpired()&&this.getEndTime()<Date.now()}isExpired(){const e=Date.now()-18144e5;return this.startTime<e}}a.Proxy="daily-aggregated-stats";var s=(0,n.defineModel)(a);t.default=s},66423:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DailyAggregatedStatsCollectionImpl=t.DailyAggregatedStatsCollection=void 0;var i=n(r(45095)),a=r(1255),s=n(r(21547)),o=r(99234);const l=864e5;class c extends a.BaseCollection{gaddForDate(e){var t;const r=(0,o.getDailyStatsStartTime)(),n=e.getTime()-r,a=Math.floor(n/l),s=r+l*a;return null!==(t=this.get(s))&&void 0!==t?t:(0,i.default)(this.add({id:s.toString(),startTime:s})[0],"this.add({\n  id: startTime.toString(),\n  startTime\n})[0]")}gaddForToday(){return this.gaddForDate(new Date)}initializeFromCache(e){if(null==e)return;const t=e.map((e=>new s.default(e))).filter((e=>u(e)&&!e.isExpired()));this.add(t)}serialize(){return this.toArray().filter((e=>u(e)&&!e.isExpired())).map((e=>e.toJSON()))}}t.DailyAggregatedStatsCollectionImpl=c,c.model=s.default,c.cachePolicy={id:"daily_aggregated_stats",policy:a.CACHE_POLICY.LOAD,delay:1e3};const d=new c;function u(e){return(e.startTime-(0,o.getDailyStatsStartTime)())%l==0}t.DailyAggregatedStatsCollection=d},93894:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.weight=(0,n.prop)()}}i.Proxy="recentEmoji";var a=(0,n.defineModel)(i);t.default=a},92671:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiCollectionImpl=t.RecentEmojiCollection=void 0;var i=n(r(23493)),a=n(r(23279)),s=r(50796),o=r(1255),l=n(r(69618)),c=r(70449),d=r(7293),u=n(r(93894)),p=n(r(56891)),h=r(77591);class f extends o.BaseCollection{constructor(){super(),this.dirty=!1,this._throttledSync=(0,i.default)((function(e){e.sync()}),36,{leading:!1}),this.listenTo(this,"change:weight change:length",(0,a.default)(this._sortTrimScale,100))}_sortTrimScale(){const e=this.length;e&&(this.sort(),e>36&&this.remove(this.models.slice(36)))}delete(){super.delete(),this.dirty=!1,this._throttledSync.cancel()}sync(){return this.findQuery({},{set:!0}).finally((()=>{this.dirty=!1})).catch((0,s.filteredCatch)(h.WebdDrop,(()=>{})))}_findQuery(){return d.GK.supportsFeature(d.GK.F.RECENT_EMOJI_SYNC)&&!d.GK.supportsFeature(d.GK.F.MD_BACKEND)?p.default.recentEmojiQuery(this.dirty?this.toArray():void 0).then((function(e){if(Array.isArray(e))return e.forEach((function(e){e.id=c.EmojiUtil.normalizeAllEmojis(e.id)})),e;throw __LOG__(3)`models:recentEmoji:findQuery error`,new Error("recent emoji fetch error")})):Promise.reject(new o.CollectionSilentQueryError("gk recent emoji sync unsupported"))}throttledSync(){d.GK.supportsFeature(d.GK.F.RECENT_EMOJI_SYNC)&&(__LOG__(2)`models:RecentEmoji:throttledSync dirty: ${String(this.dirty)}`,this._throttledSync(this))}increment(e){const t=c.EmojiUtil.getSkinToneBase(e)||e;this.get(t)||this.add({id:t,weight:0}),this.forEach((e=>{e.id===t?e.weight+=1:e.weight*=.9})),this.dirty=!0,this.throttledSync()}}t.RecentEmojiCollectionImpl=f,f.cachePolicy={id:l.default.KEY_RECENT_EMOJI_COLLECTION,policy:o.CACHE_POLICY.LOAD,delay:2e3},f.comparator=(e,t)=>e.weight>t.weight?-1:1,f.model=u.default;const _=new f;t.RecentEmojiCollection=_},14423:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50796),s=r(57319),o=r(11290),l=n(r(69618)),c=r(19380),d=r(99234),u=r(7293),p=r(62415),h=r(55981),f=r(10435),_=(n(r(11339)),n(r(96091))),m=n(r(48911)),g=r(48537),y=n(r(11824)),E=n(r(56891)),S=r(77591),v=n(r(39546));class T extends o.BaseModel{constructor(){super(...arguments),this.participants=(0,o.collection)(_.default),this.pendingParticipants=(0,o.collection)(m.default),this.id=(0,o.prop)(),this.creation=(0,o.prop)(),this.owner=(0,o.prop)(),this.desc=(0,o.prop)(),this.descId=(0,o.prop)(),this.descTime=(0,o.prop)(),this.descOwner=(0,o.prop)(),this.restrict=(0,o.prop)(),this.announce=(0,o.prop)(),this.noFrequentlyForwarded=(0,o.prop)(),this.ephemeralDuration=(0,o.prop)(),this.growthLockExpiration=(0,o.prop)(),this.growthLockType=(0,o.prop)(),this.size=(0,o.prop)(),this.support=(0,o.prop)(),this.suspended=(0,o.prop)(!1),this.uniqueShortNameMap=(0,o.prop)(),this.isParentGroup=(0,o.prop)(),this.parentGroup=(0,o.prop)(),this.subgroups=(0,o.prop)(),this.stale=(0,o.session)(!0),this.trusted=(0,o.session)(!0),this.inviteCode=(0,o.session)(),this.groupInviteCodePromise=(0,o.session)(),this.revokeGroupInvitePromise=(0,o.session)(),this.revokeGroupV4AddInvitePromise=(0,o.session)(),this.groupInviteLink=(0,o.derived)(this._groupInviteLink,["inviteCode"]),this.cachedDeviceCount=(0,o.session)(),this.cachedDeviceSizeBucket=(0,o.session)(),this.notAddedByContact=(0,o.prop)(!1),this.addedBy=(0,o.prop)(),this.groupType=(0,o.derived)(this._groupType,["parentGroup","isParentGroup"])}_groupInviteLink(){return this.inviteCode?`${l.default.GROUP_INVITE_LINK_URL}${this.inviteCode}`:null}_groupType(){return null!=this.parentGroup?h.GroupType.SUBGROUP:!0===this.isParentGroup?h.GroupType.COMMUNITY:h.GroupType.DEFAULT}hasUniqueShortNameMention(e){var t;if(!this.uniqueShortNameMap||!e.shortName||!e.isMyContact)return!1;const r=this._normalizeShortName(e.shortName);return null!==(t=this.uniqueShortNameMap.get(r))&&void 0!==t&&t}_normalizeShortName(e){return e.toLowerCase().trim()}delete(){super.delete(),this.getCollection().remove(this.id),this.participants.delete()}canSetSubject(){return!!this.participants.iAmMember()&&((this.participants.iAmAdmin()||!u.GK.supportsFeature(u.GK.F.GROUPS_V_3)||!0!==this.restrict)&&!this.support)}canSetDescription(){return!!u.GK.supportsFeature(u.GK.F.GROUPS_V_3)&&(!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)&&!this.support)}canSetGroupProperty(){return!!u.GK.supportsFeature(u.GK.F.GROUPS_V_3)&&(!!this.participants.iAmAdmin()&&!this.support)}canSetEphemeralSetting(){return!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)&&!this.support}initialize(){o.BaseModel.prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:isSuperAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this.participants,"add remove reset",this.triggerParticipantsChange),this.listenTo(this,"change:owner",this.isTrusted),this.listenTo(this,"change:notAddedByContact",this.isTrusted),this.isTrusted(),this._updateUniqueShortNameMapTimer=this._createUniqueNameMapShiftTimer(),this.listenTo(this.participants,"change:contact.shortName",this.onParticipantShortNameUpdated),this.uniqueShortNameMap=new Map,this.unreadMentionMetadata=new y.default}onParticipantShortNameUpdated(){var e;null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(T.UPDATE_NAME_MAP_DEBOUNCE_TIME)}triggerParticipantsChange(){var e;(0,f.isDropLastNameEnabled)()&&(null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(T.UPDATE_NAME_MAP_DEBOUNCE_TIME));this.trigger("change:participants")}_createUniqueNameMapShiftTimer(){return new s.ShiftTimer((()=>{if((0,f.isDropLastNameEnabled)()){const e=new Map;this.participants&&this.participants.forEach((t=>{if(t.contact.shortName&&t.contact.isMyContact){const r=this._normalizeShortName(t.contact.shortName);e.has(r)?e.set(r,!1):e.set(r,!0)}})),this.uniqueShortNameMap=e}}))}isTrusted(){if(this.stale)return this.trusted;if(this.support)return this.trusted=!0;if(this.addedBy){const e=c.ContactCollection.get(this.addedBy);if(null==e?void 0:e.isMyContact)return this.notAddedByContact=!1,this.trusted=!0}return this.notAddedByContact?this.trusted=!1:this.trusted=!0}revokeGroupV4AddInvite(e){if(this.revokeGroupV4AddInvitePromise)return this.revokeGroupV4AddInvitePromise;const t=this.id.toString(),{pendingParticipants:r}=this;let n=Promise.resolve();return n=(0,g.revokeGroupInviteV4)(e,t),this.revokeGroupV4AddInvitePromise=n.then((t=>(t.status>=200&&t.status<300&&r.remove(e),t.status))).catch((()=>(__LOG__(3)`models:groupMetadata:participantCollection:revokeGroupV4AddInvite failed`,500))).finally((()=>{this.revokeGroupV4AddInvitePromise=null}))}queryGroupV4PendingInvite(){var e=this;return(0,i.default)((function*(){if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND)){const t=(0,d.getMaybeMeUser)().toString(),r=e.id.toString();return E.default.findGroupPendingInvitesFromPhone(t,r).then((t=>{e.collection&&e.collection.add({id:e.id,pendingParticipants:t.participants},{merge:!0})})).catch((0,a.filteredCatch)(S.WebdDrop,(()=>{})))}yield(0,p.updatePendingParticipants)(e.id)}))()}getCollection(){return r(63928).default}}T.Proxy="groupMetadata",T.idClass=v.default,T.UPDATE_NAME_MAP_DEBOUNCE_TIME=200;var A=(0,o.defineModel)(T);t.default=A},63928:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(93386)),s=r(50796),o=r(1255),l=r(69951),c=n(r(64103)),d=r(7293),u=r(90101),p=i(r(14423)),h=r(96269),f=r(10790),_=i(r(56891)),m=r(77591),g=i(r(39546)),y=r(58021);class E extends o.BaseCollection{onResume(){(0,a.default)(l.ChatCollection.where({active:!0}).filter((e=>e.isGroup||e.isBroadcast)),l.ChatCollection.where({isBroadcast:!0})).forEach((e=>{this.find(e.id).catch((0,s.filteredCatch)([m.WebdDrop,c.ProtoVersionUndefined],(()=>{})))}))}_find(e){if(g.default.isGroup(e)){const t=r(69951).ChatCollection.get(e);return(null==t?void 0:t.isReadOnly)?d.GK.supportsFeature(d.GK.F.MD_BACKEND)?(__LOG__(3)`queryGroupFromPhone: not implemented for MD`,Promise.resolve({id:e})):(0,h.queryGroupFromPhone)(e):(0,u.getGroupMetadataFromStorage)(e).then((t=>t?Promise.resolve(t):(0,f.sendQueryGroup)(e))).then((t=>((0,f.updateSubject)(e,null!=(null==t?void 0:t.subject)?t.subject:""),t)))}return g.default.isBroadcast(e)?d.GK.supportsFeature(d.GK.F.MD_BACKEND)?(__LOG__(3)`contactFindBroadcast: not implemented for MD`,Promise.resolve({id:e})):_.default.contactFindBroadcast(e).then((t=>{if(200===t.status){const r=this.get(e);return r&&!r.stale?r:{id:e,participants:t.recipients}}if(404===t.status)return __LOG__(3)`models:GroupMetadataCollection:_find:False broadcast list query`,{id:e};throw __LOG__(3)`models:GroupMetadataCollection:_find:bclist error: ${t.status}`,new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)})):(__LOG__(2)`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`,Promise.reject(new Error(`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`)))}_handle(e){return e}handlePendingInvite(e){const{gid:t,participants:r}=e;this.add({id:(0,y.createWid)(t),pendingParticipants:r},{merge:!0})}}E.model=p.default,E.staleCollection=!0;var S=new E;t.default=S},55981:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupType=void 0;const n=r(54302).Mirrored(["DEFAULT","COMMUNITY","SUBGROUP"]);t.GroupType=n},45077:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(11290),a=r(19380),s=n(r(39546));class o extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.isAdmin=(0,i.prop)(),this.isSuperAdmin=(0,i.prop)(),this.contact=(0,i.session)()}initialize(){super.initialize(),this.addChild("contact",a.ContactCollection.gadd(this.id))}}o.Proxy="participant",o.idClass=s.default;var l=(0,i.defineModel)(o);t.default=l},96091:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=r(69951),s=n(r(31727)),o=r(56489),l=r(99234),c=r(7293),d=n(r(43725)),u=n(r(45077)),p=n(r(26812));class h extends s.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.sendForNeededAddRequest=e=>{var t,r;const n=this.parent.id,i=a.ChatCollection.assertGet(n),s=null!==(t=null===(r=i.groupMetadata)||void 0===r?void 0:r.desc)&&void 0!==t?t:"";(0,o.sendForNeededAddRequest)(e,i.formattedTitle||i.name,s,this.parent.id)},this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(d.default,"locale_change",this._debouncedSort)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e,t){const r=t||{};return r.isParticipantCollectionAdd||(r.remove=!0),super.set(e,r)}add(e,t){const r=t||{};return r.isParticipantCollectionAdd=!0,super.add(e,r)}canAdd(){return!!this.iAmAdmin()}canPromote(e){return!!e&&(!(0,l.getMaybeMeUser)().equals(e.id)&&(!!this.iAmAdmin()&&!e.isAdmin))}canDemote(e){if(!e)return!1;if(!this.iAmAdmin())return!1;if((0,l.getMaybeMeUser)().equals(e.id))return!1;return!(c.GK.supportsFeature(c.GK.F.GROUPS_V_3)&&e.isSuperAdmin)&&!!e.isAdmin}canRemove(e){return!!e&&(!(0,l.getMaybeMeUser)().equals(e.id)&&!!this.iAmAdmin())}canVerifyIdentity(e){return!!c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&(!!e&&!(0,l.getMaybeMeUser)().equals(e.id))}iAmMember(){return 1===this.filter((e=>e.id.equals((0,l.getMaybeMeUser)()))).length}iAmRestrictedMember(){var e;const t=this.parent.id;return!0===(null===(e=a.ChatCollection.assertGet(t).groupMetadata)||void 0===e?void 0:e.restrict)&&!this.iAmAdmin()}iAmAdmin(){return 1===this.filter((e=>e.id.equals((0,l.getMaybeMeUser)())&&e.isAdmin)).length}iAmSuperAdmin(){return 1===this.filter((e=>e.id.equals((0,l.getMaybeMeUser)())&&e.isSuperAdmin)).length}getAdmins(){return this.where({isAdmin:!0})}getSuperAdmin(){return this.findFirst((e=>e.isSuperAdmin))}}t.default=h,h.model=u.default,h.comparator=p.default},26812:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(47969);var i=(e,t)=>(0,n.ContactComparator)(e.contact,t.contact);t.default=i},48911:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=n(r(31727)),s=n(r(43725)),o=n(r(45077)),l=n(r(26812));class c extends a.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(s.default,"locale_change",this._debouncedSort)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd||(t.remove=!0),super.set(e,t)}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd=!0,super.add(e,t)}}t.default=c,c.model=o.default,c.comparator=l.default},11824:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(11290),a=n(r(11006));r(43323);class s extends i.BaseModel{constructor(){super(...arguments),this.unreadMentionCollection=(0,i.prop)(),this.pendingUnreadMentionCount=(0,i.prop)()}initialize(){this.unreadMentionCollection=new a.default,this.pendingUnreadMentionCount=0}hasMentionId(e){return null!=this.unreadMentionCollection.get(e)}addUnreadMentions(e){this.unreadMentionCollection.add(e)}removeUnreadMentions(e){this.unreadMentionCollection.remove(e)}oldestUnreadMention(){return this.unreadMentionCollection.oldestUnreadMention()}reset(){this.pendingUnreadMentionCount=0,this.unreadMentionCollection.reset()}getUnreadMentionCount(){return this.pendingUnreadMentionCount+this.unreadMentionCollection.length}}var o=(0,i.defineModel)(s);t.default=o},43323:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadMessageType=void 0;const n=r(54302).Mirrored(["NEW_MESSAGE","PERSISTANCE_LOAD","HISTORYC_SYNC_CHUNK"]);t.UnreadMessageType=n},1255:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCollection=void 0,Object.defineProperty(t,"CACHE_POLICY",{enumerable:!0,get:function(){return u.CACHE_POLICY_TYPE}}),t.CollectionSilentQueryError=void 0;var a=i(r(48926)),s=i(r(81109)),o=i(r(73955)),l=i(r(39693)),c=i(r(43063)),d=r(50796),u=r(73923),p=i(r(31727)),h=r(17239),f=n(r(64103)),_=r(99234),m=(r(27798),r(8080)),g=r(31515),y=r(77591),E=r(65044);const S="QUERY",v="FIND",T="UPDATE",A=(new Object).toString(),C={id:"none",policy:u.CACHE_POLICY_TYPE.NONE};class b extends Error{constructor(e){super(e),this.name="CollectionSilentQueryError",this.message=e}}t.CollectionSilentQueryError=b;class P extends p.default{constructor(){super(),this._inflight={},this._cachePolicy=(0,u.createCachePolicy)(this,this.constructor.cachePolicy||C),this._staleCollection=this.constructor.staleCollection||!1,this._resumeOnAvailable=this.constructor.resumeOnAvailable||!1,(!0===this._staleCollection||(0,g.isFunction)(this.onResume))&&(this.listenTo(E.Socket,"change:stream",this._handleStreamChange),this.listenTo(E.Socket,"didResume",this._onResume),this._resumeOnAvailable&&this.listenTo(m.Stream,"change:available",(()=>{m.Stream.available&&this._needsUpdate&&this._onResume()}))),this._cachePolicy.enableCaching(),this._cachePolicy.constructor.policy===u.CACHE_POLICY_TYPE.LOAD&&this.listenTo(h.Conn,"me_ready",this._updateFromCache)}initializeFromCache(e){this.add(e)}saveToCache(){if(!h.Conn.shouldSaveToCache())return;const{id:e}=this._cachePolicy;__LOG__(2)`baseCollection:saveToCache save: ${String(e)}`,(0,_.setCollection)(e,this.toJSON())}add(e,t){if(e){if(h.Conn.blockStoreAdds)throw new y.LogoutDrop("adding to store when blocking store adds");const r=Array.isArray(e)?e:[e];if(r.every((e=>null==e?void 0:e.isState))){const e=(0,c.default)(r,(e=>this.get(e.id)));return e.length&&super.add(e,t),r}}return super.add(e,t)}findQuery(e,t){return this._query(S,e,t)}find(e,t){return e?this._query(v,e,t):(__LOG__(4,void 0,new Error,!0)`Called find without an id`,SEND_LOGS("find-without-id"),Promise.reject(new Error("called find without an id")))}update(e,t){return e?this._query(T,e,t):(__LOG__(4,void 0,new Error,!0)`Called update without an id`,SEND_LOGS("update-without-id"),Promise.reject(new Error("called update without an id")))}handle(e){const t=this._handle(e.shift());if(this._staleCollection){const e=Array.isArray(t)?t:[t];(0,l.default)(e).forEach((e=>{e.stale=!1}))}this.add(t,{merge:!0})}gadd(e,t){if(this.modelClass.prototype.isIdType(e)){const r=this.get(e);return r||this.add({id:e},t)[0]}if(e.id){const r=t||{};return r.merge=!0,this.add(e,r)[0]}throw new Error("gadd called without an id attr (id)")}gaddUp(e){let t,r=this._staleCollection;if(this.modelClass.prototype.isIdType(e)){const n={stale:r,id:e};t=this.get(e)||this.add(n,{merge:!0})[0]}else e.id&&(this.get(e.id)&&(r=!1),e=(0,s.default)({stale:r},e),t=this.add(e,{merge:!0})[0]);if(t){const e=t;return t.stale&&this.find(t.id).catch((0,d.filteredCatch)(y.WebdDrop,(()=>{}))),e}throw new Error(".gaddUp called without an id attr (id)")}delete(){this._inflight={},this.reset()}isStateStale(e){const t=this.get(e);return!!t&&t.stale}_handleResume(){switch(E.Socket.stream){case E.STREAM.DISCONNECTED:if(!this._staleCollection)return;this.forEach((e=>{e&&(e.stale=!0)}));break;case E.STREAM.RESUMING:case E.STREAM.SYNCING:case E.STREAM.CONNECTED:}}_onResume(){(0,g.isFunction)(this.onResume)&&(this._resumeOnAvailable&&!m.Stream.available?this._needsUpdate=!0:(this.onResume(),this._needsUpdate=!1))}_query(e,t,r){let n=(0,g.isString)(t)?t:t.toString();n===A&&(n=(0,o.default)("collection_query_"));const i=e===S?void 0:this.get(t),a="force-"+n;return(this._inflight[a]&&e===v||e===T)&&(n=a),this._inflight[n]?e===v&&i&&!i.stale?Promise.resolve(i):this._inflight[n]:!i||i.stale||e===T?this._inflight[n]=this._serverQuery(e,t,r).finally((()=>{delete this._inflight[n]})).catch((0,d.filteredCatch)(y.LogoutDrop,(e=>{__LOG__(3)`LogoutDrop error: ${e.toString()}`}))).catch((e=>{if(!(e instanceof b))throw e;__LOG__(2)`baseCollection:query query promise rejected: ${String(e)}`})).catch((0,d.filteredCatch)(y.WebdDrop,(function(e){throw __LOG__(3)`WebdDrop error: ${e.toString()}`,e}))):Promise.resolve(i)}_serverQuery(e,t,r){var n=this;return(0,a.default)((function*(){let i;if(e===T)i=n._update(t,r);else if(e===v)i=n._find(t,r);else{const e=null==r?void 0:r.logOnSend;i=n._findQuery(t,e)}const a=yield i;if(n._staleCollection){const e=Array.isArray(a)?a:[a];(0,l.default)(e).forEach((function(e){void 0===e.stale&&(e.stale=!1)}))}let s;if(s=(null==r?void 0:r.set)?n.set(a):n.add(a,{merge:!0}),Array.isArray(a))return s;if(s[0])return s[0];throw new f.ModelCreateError("Unknown",a)}))()}_update(e,t){return this._find(e,t)}_handleStreamChange(){this._handleResume(),this._cachePolicy.constructor.policy===u.CACHE_POLICY_TYPE.LOAD&&this._updateFromCache()}_updateFromCache(){const{id:e}=this._cachePolicy;this._cachePolicy.disableCaching(),h.Conn.shouldSaveToCache()&&(__LOG__(2)`baseCollection:initFromCache load: ${String(e)}`,this.initializeFromCache((0,_.getCollection)(e)),this._cachePolicy.enableCaching())}}t.BaseCollection=P},25389:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMirror=void 0,t.genBitMask=function(e,t){const r=[];for(let n=0;n<t.length;n++){const i=e[`change:${t[n]}`],a=Math.floor(i/32);s(r,a+1),r[a]|=1<<i%32}return r},t.genMirrorMask=function(e){const t={};let r=0;const n=e=>{t[`change:${e}`]=r++};e.props&&Object.keys(e.props).forEach(n);e.session&&Object.keys(e.session).forEach(n);e.derived&&Object.keys(e.derived).forEach(n);return t};var i=n(r(4788));function a(e,t){e[t]=e[e.length-1],e.pop()}function s(e,t){if(t<=e.length)return;const r=t-e.length;for(let t=0;t<r;t++)e.push(0)}t.BaseMirror=class{constructor(e){this.state=e}destructor(){this.state.off("all",this.onGatherEvent,this)}initListener(){this.state.on("all",this.onGatherEvent,this),this.masks=[],this.listeners=[],this.changeEvents=[]}onGatherEvent(e){if("change"===e){if(!this.changeEvents.filter(Boolean).length)return;this.onChange(),this.changeEvents=[]}else{const t=this.state.mirrorMask[e];if(void 0===t)return;const r=t/32|0;s(this.changeEvents,r+1),this.changeEvents[r]|=1<<(t%32|0)}}onChange(){const e=this.state,t=this.changeEvents;(0,i.default)(this.masks,this.listeners).forEach((r=>{let[n,i]=r;const a=Math.min(t.length,n.length);for(let r=0;r<a;r++)if(t[r]&n[r]){const[t,r]=i;null!=t&&null!=r&&t(r,e);break}}))}addListener(e,t,r){this.listeners||this.initListener(),this.masks.push(t),this.listeners.push([e,r])}removeListener(e){const t=this.listeners;for(let r=0;r<t.length;r++)t[r][0]===e&&(t[r][0]=null,t[r][1]=null,a(this.masks,r),a(t,r))}}},11290:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0,Object.defineProperty(t,"collection",{enumerable:!0,get:function(){return p.collection}}),t.defineModel=function(e){const t=(0,p.convert)(e),r=(0,p.stateExtend)(g,t);if(e.Proxy){const n=(0,c.genMirrorMask)(t);r.prototype.mirrorMask=n,r.prototype.proxyName=e.Proxy,(0,h.ProxyStateFactory)(e.Proxy,t,n)}return r},Object.defineProperty(t,"derived",{enumerable:!0,get:function(){return p.derived}}),Object.defineProperty(t,"prop",{enumerable:!0,get:function(){return p.prop}}),Object.defineProperty(t,"session",{enumerable:!0,get:function(){return p.session}});var i=n(r(81109)),a=n(r(7287)),s=n(r(2525)),o=n(r(52353)),l=n(r(14176)),c=r(25389),d=r(88102),u=n(r(34342)),p=r(67820),h=r(80134),f=r(31515),_=r(77591);const m=/^change:/;class g extends u.default{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(super(),this.stale=(0,p.session)(!1),this.__fired=null,this.__changes=null,this.__initialized=!1,t._internalInitializationDoNotUse)return;this.stale=(null==e?void 0:e.stale)||this.getDefault("stale"),this.parent=t.parent,this.collection=t.collection,this._initDeriveds(),this._initCollections();const r=this.__defaults,n=r?(0,i.default)((0,i.default)({},r),e):e;n&&!function(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)&&this.set(n,(0,i.default)({silent:!0},t)),this.initialize(),this.__initialized=!0}initialize(){if(this.collection&&this.id&&!this.collection.modelClass.prototype.isIdType(this.id))throw new Error(`Model id:${String(this.id)} is wrong type`);this._uiObservers=0,this.mirrorMask&&(this.mirror=new c.BaseMirror(this))}_refreshStaleModel(){if(this._uiObservers||!this.stale){if(!this.getCollection)throw new Error("base_model:_refreshStaleModel getCollection does not exist");this.getCollection().find(this.id).catch(_.WebdDrop,(()=>{}))}}incObservers(e){if(this._uiObservers++,e)return;r(57220).default.online&&this.stale&&(d.Cmd.uiBusy?this.listenToOnce(d.Cmd,"ui_idle",this._refreshStaleModel):this._refreshStaleModel())}decObservers(){this._uiObservers>0&&this._uiObservers--,0===this._uiObservers&&this.stopListening(d.Cmd,"ui_idle",this._refreshStaleModel)}hasObservers(){return this._uiObservers>0}addChild(e,t){const r={};r[e]=t,this.set(r,{silent:!0}),this.listenTo(t,"all",this._getCachedEventBubblingHandler(e))}get(e){return this[e]}set(e,t,r){var n;let i=r;return"string"==typeof e?this._set(e,t,i):(i=t,(null===(n=i)||void 0===n?void 0:n.merge)?this._set((0,l.default)(e,o.default),i):this._set(e,i))}_markChange(e){this.__initialized&&(this._getChanges().push(e),this.__fired&&(this.__fired[e]=!1))}_set(e,t,r){const n=!!this.__changes,[i,a]=(0,f.isString)(e)?[{[e]:t},r]:[e,t];let s=Object.keys(i).reduce(((e,t)=>{const r=this._setKV(t,i[t],a);return r&&e.push(...r),e}),[]),o=0;for(;s&&s.length>0;){if(o++>5)throw new Error("Circular derived properties / event listeners");const e=this._topo;if(!e)throw new Error("_topo unexpectedly undefined");const t=y(e,s);s=t.reduce(((e,r,n)=>{const i=this._setD(r,t.slice(n+1));return i&&e.push(...i),e}),[])}if(!(null==a?void 0:a.silent)&&this.hasUnfiredChanges()){const e=this.__fired={},t=this._getChanges(),r=t.length>0;for(;t.length;){const r=t.shift();if(!e[r]){e[r]=!0;const t=this._definition[r].evt;(this.isListening(t)||this.isListening("all"))&&this.trigger(t,this,this[r])}}(r&&this.isListening("change")||this.isListening("all"))&&this.trigger("change",this)}return n||(this.__changes&&(this.__changes=null),this.__fired&&(this.__fired=null)),this}_setKV(e,t,r){if(this._collections[e])return void this[e].set(t,r);const n=this._definition[e];if(!n)return void(this[e]=t);if(n.attr===p.Attr.DERIVED)throw new Error(`Attempting to directly set derived property: ${e}`);const i=n.sk;if(t===this[e])return;this[i]=t,this._markChange(e);const a=this._deps;return(null==a?void 0:a[e])?a[e]:void 0}_setD(e,t){var r;const n=this._definition[e],i=n.sk,a=n.fn.call(this);if(this[i]!==a&&(this[i]=a,this._markChange(e),null===(r=this._deps)||void 0===r?void 0:r[e])){const r=function(e,t){const r=new Set(t);return e.filter((e=>!r.has(e)))}(this._deps[e],t);if(r.length)return r}}hasUnfiredChanges(){const e=this.__fired,t=this.__changes;if(!t)return!1;if(!e)return!0;for(let r=0;r<t.length;r++)if(!e[t[r]])return!0;return!1}_getChanges(){return this.__changes||(this.__changes=[])}_initDeriveds(){this.__derived.forEach((e=>{this[this._definition[e].sk]=p.INIT}))}_initCollections(){(0,s.default)(this._collections,((e,t)=>{this[t]=new e(null,{parent:this})}))}unset(e,t){const r=Array.isArray(e)?e:[e];this.set((0,a.default)(r),t)}clear(){this.unset([...this.__props,...this.__session])}delete(){this.stopListening()}reset(){this.set(this.__defaults)}toJSON(){return this.serialize()}serialize(){const e={};for(let t=0;t<this.__props.length;t++)e[this.__props[t]]=this[this.__props[t]];return(0,s.default)(this._collections,((t,r)=>{e[r]=this[r].serialize()})),e}getDefault(e){const t=this._definition[e];if(!t)return;const r=t.defaultValue;return(0,f.isFunction)(r)?r():r}_getCachedEventBubblingHandler(e){return function(t,r,n){m.test(t)?this.trigger("change:"+e+"."+t.split(":")[1],r,n):"change"===t&&this.trigger("change",this)}.bind(this)}static isIdType(e){return!(!this.allowedIds||!this.allowedIds.includes(e))||(this.idClass?e instanceof this.idClass:"string"==typeof e)}}function y(e,t){const r=new Set(t);return e.filter((e=>r.has(e)))}t.BaseModel=g},14648:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY_TYPE=t.BaseCachePolicy=void 0;var i=n(r(34342));const a={LOAD:"LOAD",NONE:"NONE"};t.CACHE_POLICY_TYPE=a;class s extends i.default{constructor(e,t){super(),this._collection=e,this._id=t}enableCaching(){}disableCaching(){}get collection(){return this._collection}get id(){return this._id}}t.BaseCachePolicy=s,s.policy=a.NONE},73923:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CACHE_POLICY_TYPE",{enumerable:!0,get:function(){return i.CACHE_POLICY_TYPE}}),t.createCachePolicy=function(e,t){switch(t.policy){case"LOAD":return new a.default(e,t);case"NONE":return new s.default(e,t)}return new s.default(e,{id:"none",policy:"NONE"})};var i=r(14648),a=n(r(1088)),s=n(r(58433))},1088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=r(14648);class s extends a.BaseCachePolicy{constructor(e,t){super(e,t.id),this._trigger=t.trigger||"all",this._delay=t.delay,this._saveToCache=(0,i.default)(this.saveToCache,this._delay)}saveToCache(){this.collection.saveToCache()}enableCaching(){this.listenTo(this.collection,this._trigger,this._saveToCache)}disableCaching(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}t.default=s,s.policy=a.CACHE_POLICY_TYPE.LOAD},58433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(14648);class i extends n.BaseCachePolicy{constructor(e,t){super(e,t.id)}}t.default=i,i.policy=n.CACHE_POLICY_TYPE.NONE},31727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(48206),s=n(r(34342));class o extends s.default{constructor(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),e.parent&&(this.parent=e.parent);const{model:t,comparator:r}=this.constructor;if(!t)throw new Error("Collection initialized without model. It is likely that you have a circular dependency. Run `yarn lint:circular` to find it and use inline `require` instead of `import` to avoid it.");this.modelClass=t,r&&(this._comparator=r),this._reset()}add(e,t){let r;return r=Array.isArray(e)?e.slice():e?[e]:[],this.set(r,(0,i.default)({merge:!1,add:!0,remove:!1},t))}set(e,t){if(!e)return __LOG__(3)`collection:set called with no models`,[];const r=(0,i.default)({add:!0,remove:!0,merge:!0},t);let n,a,s,o;const l=this._comparator&&!1!==r.sort,c=[],d=[],u={},{add:p,merge:h,remove:f}=r,_=null!=r.at?r.at:void 0,m=!(l||!p||!f)&&[];for(let t=0,i=e.length;t<i;t++){if(o=e[t],this.isModel(o)&&(a=o),n=o.id,!n){__LOG__(3)`collection:set model has no id`;continue}if(s=this.get(n),s){const n=s;f&&(u[s.id.toString()]=!0),h&&(o=a&&o===a?a.attributes:o,n.set(o,r)),e[t]=n}else if(p){if(a=e[t]=this._prepareModel(o,r),!a)continue;{const e=a;c.push(e),this._addReference(e)}}if(a=s||a,!a)continue;const i=a;!m||a.id&&u[a.id.toString()]||m.push(i),u[i.id.toString()]=!0}if(f){for(let e=0,t=this.length;e<t;e++){a=this._models[e];const t=a;u[a.id.toString()]||d.push(t)}d.length&&this.remove(d,(0,i.default)({},r))}let g;if(c.length||(null==m?void 0:m.length))if(l&&(g=!0),"number"==typeof _)this._models.splice(_,0,...c);else{const e=m||c;for(let t=0,r=e.length;t<r;t++)this._models.push(e[t])}if(g&&this.sort({silent:!0}),!r.silent){for(let e=0,t=c.length;e<t;e++)a=c[e],a.trigger?a.trigger("add",a,this,r):this.trigger("add",a,this,r);(g||m.length)&&this.trigger("sort",this,r)}return e}remove(e){let t,r,n,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=Array.isArray(e)?e.slice():[e],o=[];for(let e=0,l=s.length;e<l;e++)if(i=s[e],i&&(n=i instanceof this.modelClass?i.id:i,t=o[e]=this.get(n),t)){const e=t;this._deIndex(t),r=this._models.indexOf(t),this._models.splice(r,1),a.silent||(a.index=r,e.trigger?e.trigger("remove",t,this,a):this.trigger("remove",t,this,a)),this._removeReference(e)}return o}reset(){for(let e=0,t=this._models.length;e<t;e++)this._removeReference(this._models[e]);this._reset(),this.trigger("reset",this)}sort(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._comparator)throw new Error("Cannot sort without comparator");return this._models.sort(this._comparator.bind(this)),e.silent||this.trigger("sort",this,e),this}replaceId(e,t){const r=this.get(e);r&&(this._removeFromIndex(e),r.set({id:t}),this._addIndex(r))}reorderMutate(e,t){(0,a.arrayMoveMutate)(this._models,e,t)}get(e){return this._index[e]}assertGet(e){const t=this._index[e];return t||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Collection:assertGet no result")),t}at(e){return this._models[e]}get length(){return this._models.length}get isCollection(){return!0}get models(){return this._models}serialize(){return this.map((e=>e.toJSON()))}toJSON(){return this.serialize()}isModel(e){return e instanceof this.modelClass}includes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0===t?e instanceof this.modelClass&&null!=this.get(e.id):this._models.includes(e,t)}indexOf(e,t){return this._models.indexOf(e,t)}lastIndexOf(e,t){return this._models.lastIndexOf(e,t)}every(e){return this._models.every(e)}some(e){return this._models.some(e)}forEach(e){this._models.forEach(e)}map(e){return this._models.map(e)}filter(e){return this._models.filter(e)}findFirst(e){return this._models.find(e)}reduce(e,t){return this._models.reduce(e,t)}slice(e,t){return this._models.slice(e,t)}where(e){return this.filter((t=>{for(const r in e)if(e[r]!==t.get(r))return!1;return!0}))}head(){return this._models[0]}last(){return this._models[this._models.length-1]}toArray(){return this._models.slice()}getModelsArray(){return this._models}reorder(e,t){return(0,a.arrayMove)(this._models,e,t)}_reset(){this._models=[],this._index={}}_prepareModel(e,t){if(this.isModel(e))return e.collection||(e.collection=this),e;{const r=(0,i.default)((0,i.default)({},t),{},{collection:this});try{return new this.modelClass(e,r)}catch(e){return void __LOG__(3)`collection:_prepareModel exception: ${e.stack}`}}}_addReference(e){this._addIndex(e),e.collection||(e.collection=this),e.on&&e.on("all",this._onModelEvent,this)}_removeReference(e){this===e.collection&&delete e.collection,this._deIndex(e),e.off&&e.off("all",this._onModelEvent,this)}_addIndex(e){this._index[e.id]=e}_deIndex(e){delete this._index[e.id]}_removeFromIndex(e){this.get(e)&&delete this._index[e]}_onModelEvent(e,t,r,n){const i=e.indexOf(":"),a=-1===i?e:e.slice(0,i);("add"!==a&&"remove"!==a||r===this)&&("destroy"===a&&this.remove(t,n),this.trigger.apply(this,arguments))}}t.default=o},67820:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NO_DEFAULT_VALUE=t.INIT=t.Attr=void 0,t.collection=function(e){return{val:e,type:g}},t.convert=function(e){const t=new e({},{_internalInitializationDoNotUse:!0}),r={name:e.name||"Unknown",props:{},session:{},derived:{},collections:{},isIdType:e.isIdType};e.Collection&&(r.Collection=e.Collection);e.idClass&&(r.idClass=e.idClass);e.allowedIds&&(r.allowedIds=e.allowedIds);const n=new Set(["constructor"]),i=new Set(["collection","parent","__changes","__fired","__initialized"]);(function(e){const t=[];for(const r in e)"function"!=typeof e[r]&&t.push([r,e[r]]);return t})(t).forEach((t=>{let[a,o]=t;if(!i.has(a))switch(o.type){case f:r.props[a]=y(o);break;case _:r.session[a]=y(o);break;case m:r.derived[a]=(0,s.default)(o,"type"),n.add(o.fn.name);break;case g:r.collections[a]=o.val;break;default:throw new Error(`Invalid defineModel Class type for ${e.name}:${a}.`)}}));const a=function(e){const t={},r=Object.getPrototypeOf({});let n=e;Object.getOwnPropertyNames(n).forEach((e=>{"function"==typeof n[e]&&(t[e]=n[e])}));for(;(n=Object.getPrototypeOf(n))&&n!==r;)Object.getOwnPropertyNames(n).forEach((e=>{e in t||(t[e]=n[e])}));return t}(t);return n.forEach((e=>{delete a[e]})),Object.assign(r,a),r},t.derived=function(e,t){return{fn:e,deps:t,type:m}},t.prop=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h;const t={defaultValue:e,type:f};return t},t.session=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h;const t={defaultValue:e,type:_};return t},t.stateExtend=function(e,t){const r=(0,l.default)(t.name,"protoDef.name");delete t.name;const n=function(e,t){return{[t]:class extends e{}}[t]}(e,r),o=n.prototype,d=o.__props=[],h=o.__session=[],f=o.__derived=[],_=o._collections={},m=o._definition={},g=o._derived={};(0,a.default)(t.props,(function(e,t){d.push(t),S(o,t,e,p.PROP)})),(0,a.default)(t.session,(function(e,t){h.push(t),S(o,t,e,p.SESSION)})),(0,a.default)(t.derived,(function(e,t){f.push(t),function(e,t,r){const n=E(t),i=r.fn;e._definition[t]=e._derived[t]={sk:n,evt:"change:"+t,attr:p.DERIVED,fn:i,deps:r.deps},Object.defineProperty(e,t,{get(){const e=this[n];if(e!==u)return e;const t=i.call(this);return this[n]=t,t},set(){throw new TypeError(`'${t}' is a derived property, it can't be set directly.`)}})}(o,t,e)})),(0,a.default)(t.collections,(function(e,t){_[t]=e})),Object.assign(o,(0,s.default)(t,["props","session","derived","collections"]));const y=d.concat(h),v=y.length;Object.defineProperties(o,{attributes:{get(){const e={};for(let t=0;t<v;++t)e[y[t]]=this[y[t]];return e}},isState:{get:()=>!0,set(){throw new Error("attempt to set isState")}}});const T={};for(let e=0;e<v;e++){const t=y[e];"defaultValue"in m[t]&&(T[t]=u)}(0,i.default)(T)||(o.__defaults=T);if(f.length){const e=[],t={},r={};(0,a.default)(g,((n,i)=>{r[i]=!0,(0,a.default)(n.deps,(n=>{r[n]=!0,(t[n]||(t[n]=[])).push(i),e.push([i,n])}))})),e.length&&(o._deps=t,o._topo=c.default.array(Object.keys(r),e).reverse())}return n};var i=n(r(41609)),a=n(r(2525)),s=n(r(57557)),o=n(r(13218)),l=n(r(45095)),c=n(r(94633)),d=r(31515);const u={sentinel:"DEFAULT VALUE PLACEHOLDER"};t.INIT=u;const p={PROP:"PROP",SESSION:"SESSION",DERIVED:"DERIVED"};t.Attr=p;const h=Symbol("NO_DEFAULT_VALUE");t.NO_DEFAULT_VALUE=h;const f="Props",_="Session",m="Derived",g="Collection";function y(e){const t=e.defaultValue;return t===h?{}:{defaultValue:t}}function E(e){return"__x_"+e}function S(e,t,r,n){if(!(0,o.default)(r))throw new Error("Invalid Prop/Session definition.");const i={sk:E(t),evt:`change:${t}`,attr:n};void 0!==r.defaultValue&&(i.defaultValue=r.defaultValue),e._definition[t]=i;const a=(0,d.isFunction)(i.defaultValue);if(null!=i.defaultValue&&!a){if(Array.isArray(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: Array provided.");if((0,o.default)(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: WAUnsafeObjectType provided.")}const s=i.sk;Object.defineProperty(e,t,{set(e){this.set(t,e)},get(){const e=this[s];return e!==u?e:a?this[s]=i.defaultValue():i.defaultValue}})}},80134:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyStates=t.ProxyStateFactory=t.DuplicatedProxyProperty=void 0;var i=n(r(6479)),a=r(40265);const s=["props","session","collections","derived"];class o extends((0,a.customError)("DuplicatedProxyProperty")){}t.DuplicatedProxyProperty=o;const l={};t.ProxyStates=l;t.ProxyStateFactory=(e,t,r)=>{const{props:n,session:a,collections:c,derived:d}=t,u=(0,i.default)(t,s),p=function(e){this.$ProxyState$state=e},h={};if([n,a,c,d].forEach((t=>{t&&Object.keys(t).forEach((t=>{h[t]={get(){return __LOG__(4,void 0,new Error,!0)`Cannot read proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Access"),this.$ProxyState$state[t]},set(r){__LOG__(4,void 0,new Error,!0)`Cannot write proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Write"),this.$ProxyState$state[t]=r}}}))})),h.proxyName={value:e},h.mirrorMask={value:r},h.isProxyOf={value(e){return this.$ProxyState$state===e}},["set","get",...Object.keys(u)].forEach((e=>{h[e]={value(){const t=this.$ProxyState$state;return t[e].apply(t,arguments)}}})),(p.prototype=Object.create(null,h)).constructor=p,e in l)throw new o(`Duplicated proxy property "${e}".`);l[e]=p}},71306:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(50796),s=i(r(48360)),o=r(46331),l=r(11290),c=r(69951),d=r(88102),u=n(r(64103)),p=r(99234),h=r(7293),f=i(r(43725)),_=i(r(33861)),m=i(r(56891)),g=r(77591),y=i(r(39546)),E=r(85893);class S extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.duration=(0,l.prop)(),this.participants=(0,l.collection)(_.default),this.active=(0,l.session)(!1),this.keepAliveTimer=(0,l.session)(),this.stopPromise=(0,l.session)()}initialize(){super.initialize(),this.listenTo(this.participants,"remove reset",(()=>{this.hasParticipants()||this.delete()}));const e=c.ChatCollection.get(this.id);e&&!e.liveLocation&&(e.liveLocation=this)}delete(){super.delete(),this.stopViewingMap(),this.participants.delete(),this.getCollection().remove(this.id);const e=c.ChatCollection.get(this.id);e&&(e.liveLocation=void 0)}hasParticipants(){return this.participants.length>0}startViewingMap(){this.active||(this.active=!0,this._updateLiveLocations(),this._startKeepAlive())}stopViewingMap(){this.active&&(this.active=!1,this._pauseLiveLocations(),this._stopKeepAlive())}userHasLiveLocation(e){return!!this.participants.get(e)}iHaveLiveLocation(){return this.userHasLiveLocation((0,p.getMaybeMeUser)())}stopMyLiveLocation(e){if(!this.iHaveLiveLocation())return Promise.reject(new u.ActionError);if(this.stopPromise)return this.stopPromise;if(h.GK.supportsFeature(h.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const t=this.stopPromise=m.default.disableLiveLocation(this.id),r=new o.ActionType(s.default._("Stopping live location sharing",null,{hk:"3Zapuy"})),n=e||(0,o.genId)(),i=t.then((e=>200===e.status?new o.ActionType(s.default._("Stopped sharing live location",null,{hk:"1sRjWg"})):e.status>=400?new o.ActionType(s.default._("Couldn't stop sharing live location",null,{hk:"2ckYx4"})):void 0)).catch((()=>(__LOG__(3)`models:liveLocation:disableLiveLocation dropped`,new o.ActionType(s.default._("Couldn't stop sharing live location",null,{hk:"2ckYx4"}),{actionText:f.default.t(139),actionHandler:this.stopMyLiveLocation.bind(this,n)}))));return d.Cmd.openToast((0,E.jsx)(o.ActionToast,{id:n,initialAction:r,pendingAction:i})),t.then((e=>{if(200===e.status&&!e._duplicate){const e=this.participants.get((0,p.getMaybeMeUser)());e&&e.disable()}})).finally((()=>{this.stopPromise=null}))}_updateLiveLocations(){this.getCollection().update(this.id).catch((()=>{}))}_pauseLiveLocations(){m.default.unsubscribeLiveLocation(this.id).catch((0,a.filteredCatch)(g.WebdDrop,(()=>{})))}_sendKeepAlive(){m.default.subscribeLiveLocation(this.id,!1).catch((0,a.filteredCatch)(g.WebdDrop,(()=>{})))}_startKeepAlive(){if(null!=this.keepAliveTimer)return;const e=this.duration;null!=e&&0!==e&&(this.keepAliveTimer=window.setInterval(this._sendKeepAlive.bind(this),1e3*e))}_stopKeepAlive(){null!=this.keepAliveTimer&&(window.clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}getCollection(){return r(85865).LiveLocationCollection}}S.Proxy="liveLocation",S.idClass=y.default;var v=(0,l.defineModel)(S);t.default=v},85865:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LiveLocationCollectionImpl=t.LiveLocationCollection=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(50796),o=r(1255),l=r(22683),c=n(r(69618)),d=r(19380),u=r(7293),p=n(r(71306)),h=r(31515),f=n(r(56891)),_=r(77591),m=n(r(39546));class g extends o.BaseCollection{_find(e){var t=this;return(0,a.default)((function*(){if(!m.default.isUser(e)&&!m.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));if(u.GK.supportsFeature(u.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const r=yield f.default.subscribeLiveLocation(e,!0);if(r.status&&r.status>=400)return 499===r.status?__LOG__(2)`liveLocation:subscribe query not implemented on the phone`:__LOG__(3)`model:LiveLocation:_find error ${r.status}`,Promise.reject(r.status);const n=(0,h.isNumber)(r.duration)?r.duration:void 0,a=r.participants?r.participants.map((e=>(0,i.default)((0,i.default)({},t._extractLocationFields(e)),{},{id:e.id,expiration:0===e.expiration?1/0:e.expiration}))):[];return{id:e,duration:n,participants:a}}))()}getActive(e){var t=this;return(0,a.default)((function*(){if(!m.default.isUser(e)&&!m.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));try{const r=yield f.default.queryActiveLiveLocation(e);if(r.status&&r.status>=400)return 499===r.status?__LOG__(2)`liveLocation:participant query not implemented on the phone`:__LOG__(3)`model:LiveLocation:getActive error ${r.status}`,Promise.reject(r.status);if(!r.participants||!r.participants.length)return;const n=r.participants.map((e=>({id:e.id,expiration:0===e.expiration?1/0:e.expiration})));t.add({id:e,participants:n},{merge:!0})}catch(e){return(0,s.filteredCatch)(_.WebdDrop,(()=>{}))(e)}}))()}onResume(){this.filter((e=>e.active&&e.hasParticipants())).forEach((e=>{this.update(e.id)}))}handle(e){Array.isArray(e)?e.forEach((e=>{switch(e.type){case"update":{const t=this._extractLocationFields(e),r=d.ContactCollection.get(e.jid);(null==r?void 0:r.liveLocations)&&r.liveLocations.forEach((e=>e.set(t)));break}case"disable":{const t=this.get(e.chat);if(t){const r=t.participants.get(e.jid);r&&(e.seq>r.sequence||-1===e.seq)&&r.disable()}break}default:__LOG__(3)`models:liveLocation:handle unknown type: ${e.type}`}})):__LOG__(3)`models:liveLocation:handle unrecognized payload`}processMsg(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.type===c.default.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to process non live-location msg"));const r=e.id.remote,{lat:n,lng:i,accuracy:a,speed:s,degrees:o,sequence:d,comment:u,shareDuration:p,t:h}=e;if(!h||!p)return;const f=h+p;if(f<=l.Clock.globalUnixTime())return;const _={id:e.sender,lat:n,lng:i,accuracy:a,speed:s,degrees:o,sequence:d,comment:u,expiration:f,lastUpdated:h,msg:e};-1===d&&delete _.sequence;const m=this.get(r);if(m){const e=m.participants.get(_.id);if(t)return void(e&&e.lastUpdated<=_.lastUpdated&&e.set(_));if(e&&m.participants.removeParticipant(e),m.hasParticipants())return void m.participants.add(_)}this.add({id:r,participants:[_]})}removeMsg(e){e.type===c.default.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to remove non live-location msg"));const t=e.id.remote,r=e.sender,n=this.get(t);n&&n.participants.remove(r)}_extractLocationFields(e){return void 0===e.lat||void 0===e.lng?{}:{lastUpdated:l.Clock.globalUnixTime()-e.elapsed,lat:e.lat,lng:e.lng,accuracy:e.accuracy,speed:e.speed,degrees:e.degrees,comment:e.comment}}}t.LiveLocationCollectionImpl=g,g.model=p.default,g.staleCollection=!0,g.resumeOnAvailable=!0;const y=new g;t.LiveLocationCollection=y},57465:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(15421)),a=r(11290),s=r(22683),o=r(19380),l=r(99234),c=r(3879),d=r(31515),u=n(r(39546));class p extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.msg=(0,a.prop)(),this.lat=(0,a.prop)(),this.lng=(0,a.prop)(),this.accuracy=(0,a.prop)(),this.speed=(0,a.prop)(),this.degrees=(0,a.prop)(),this.sequence=(0,a.prop)(),this.comment=(0,a.prop)(),this.expiration=(0,a.prop)(),this.lastUpdated=(0,a.prop)(),this.contact=(0,a.session)(),this.expireTimerId=(0,a.session)(),this.disabled=(0,a.session)(!1),this.isMe=(0,a.derived)(this._isMe,["id"]),this.valid=(0,a.derived)(this._valid,["lat","lng"])}_isMe(){return this.id.equals((0,l.getMaybeMeUser)())}_valid(){return t=this.lat,(0,d.isNumber)(t)&&t>=-90&&t<=90&&(e=this.lng,(0,d.isNumber)(e)&&e>=-180&&e<=180);var e,t}initialize(){super.initialize(),this.addChild("contact",o.ContactCollection.gadd(this.id)),(0,c.addLiveLocation)(this.contact,this),this.listenTo(this,"change:expiration",this._setExpireTimer),this._setExpireTimer()}delete(){super.delete(),this._disableMsg(),(0,c.removeLiveLocation)(this.contact,this),this._clearExpireTimer()}remainingTime(){return this.expiration-s.Clock.globalUnixTime()}elapsedTime(){return s.Clock.globalUnixTime()-this.lastUpdated}disable(){this.disabled=!0}_disableMsg(){const e=this.msg;e&&(e.shareDuration=s.Clock.globalUnixTime()-e.t-1)}_setExpireTimer(){this.expiration&&(this.remainingTime()<=0?this._expire():this.expireTimerId=i.default.setGlobalTimeout(this._expire.bind(this),1e3*this.expiration,this.expireTimerId))}_clearExpireTimer(){i.default.clearTimeout(this.expireTimerId),this.expireTimerId=null}_expire(){this.disable()}}p.Proxy="liveLocationParticipant",p.idClass=u.default;var h=(0,a.defineModel)(p);t.default=h},33861:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1255),a=r(47969),s=r(99234),o=n(r(57465));class l extends i.BaseCollection{constructor(){super(),this.listenTo(this,"change:disabled",(e=>{e.disabled&&this.removeParticipant(e)}))}delete(){this.forEach((e=>this.removeParticipant(e)))}validLocations(){return this.filter((e=>e.valid))}removeParticipant(e){this.remove(e),e.delete()}}t.default=l,l.model=o.default,l.comparator=(e,t)=>{const r=(0,s.getMaybeMeUser)();return e.contact.id.equals(r)?-1:t.contact.id.equals(r)?1:(0,a.ContactComparator)(e.contact,t.contact)}},96489:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.isFocused=(0,n.session)(!0)}initialize(){super.initialize(),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}delete(){super.delete()}_onFocus(){this.isFocused=!0}_onBlur(){this.isFocused=!1}}i.Proxy="mainWindowState";var a=new((0,n.defineModel)(i));t.default=a},96876:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(57319),a=r(11290),s=r(22683),o=r(99234),l=r(7293),c=n(r(68132)),d=r(65044);class u extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.showAwarenessMsg=(0,a.prop)(!1),this.showCountDownMsg=(0,a.prop)(!1),this.daysLeftTillDeadline=(0,a.prop)(0),this.expirationTime=(0,a.prop)(),this.deadlineExpiredLogoutTimer=(0,a.session)()}processMdOptInDeadline(){if(l.GK.supportsFeature(l.GK.F.EXTERNAL_MD_OPT_IN_AVAILABLE)&&c.default.mdOptInDeadline.timestamp>0){const e=c.default.mdOptInDeadline.timestamp,t=s.Clock.globalUnixTime(),r=s.Clock.daysDelta(t,e);if(t>e)return __LOG__(2)`MdOptInDeadline:processMdOptInDeadline logout due to MD opt-in deadline expiration`,(0,o.setMdOptedIn)(!0),(0,o.setShowMdUpgradeCompleteMsg)(!0),(0,o.setForcedMdUpgradeComplete)(!0),void d.Socket.logout();0===r?this.set({showCountDownMsg:!0,expirationTime:s.Clock.relativeStr(e),daysLeftTillDeadline:null,showAwarenessMsg:!1}):r<=7?this.set({showCountDownMsg:!0,daysLeftTillDeadline:r,expirationTime:null,showAwarenessMsg:!1}):this.set({showAwarenessMsg:!0,expirationTime:null,daysLeftTillDeadline:null,showCountDownMsg:!1}),this.deadlineExpiredLogoutTimer.cancel(),this.deadlineExpiredLogoutTimer.onOrAfter(1e3*(e-t))}}initialize(){super.initialize(),this.deadlineExpiredLogoutTimer=new i.ShiftTimer((function(){__LOG__(2)`MdOptInDeadline:deadlineExpiredLogoutTimer logout due to MD opt-in deadline expiration`,(0,o.setMdOptedIn)(!0),(0,o.setShowMdUpgradeCompleteMsg)(!0),(0,o.setForcedMdUpgradeComplete)(!0),d.Socket.logout()}))}}u.Proxy="mdOptInDeadline";var p=new((0,a.defineModel)(u));t.default=p},17304:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE=t.MsgImpl=t.Msg=void 0,t.createProductInquiry=function(e,t,r,n){const i=function(e){return new pe(e)}({ack:v.default.ACK.CLOCK,id:new V.default({id:"product_inquiry",remote:t,fromMe:!0}),from:t,t:y.Clock.globalUnixTime(),type:de.PRODUCT,title:e.name,description:e.description,businessOwnerJid:t.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),body:r.preview instanceof q.default?r.preview.getBase64():null,currencyCode:e.currency,priceAmount1000:e.priceAmount1000,salePriceAmount1000:(0,Q.isSalePriceActive)(e)?e.salePriceAmount1000:null,sessionId:n});return i.mediaData.set(r),i};var a=i(r(48926)),s=i(r(23279)),o=i(r(57557)),l=i(r(45578)),c=i(r(41609)),d=i(r(39138)),u=n(r(93131)),p=i(r(45095)),h=r(40277),f=r(27870),_=r(88156),m=r(11290),g=r(92115),y=r(22683),E=r(88102),S=r(17239),v=i(r(69618)),T=r(19380),A=r(96751),C=r(24808),b=r(70449),P=r(29179),M=i(r(96222)),O=r(70014),I=r(76059),w=r(99234),R=r(82142),D=i(r(53988)),N=r(7293),L=r(57701),k=(r(55981),i(r(84064))),G=i(r(7056)),U=i(r(43725)),F=r(905),x=r(11902),B=r(10435),K=n(r(86688)),Y=n(r(78986)),j=i(r(2320)),W=r(58668),H=i(r(11339)),V=i(r(32219)),$=n(r(54676)),z=i(r(5165)),q=i(r(34949)),J=r(7111),Q=r(13151),X=r(19708),Z=r(13705),ee=r(64551),te=r(31515),re=r(3940),ne=r(97563),ie=r(12896),ae=r(78521),se=r(84728),oe=i(r(17072)),le=i(r(39546)),ce=i(r(39938));const{MSG_TYPE:de}=v.default;t.TYPE=de;class ue extends m.BaseModel{constructor(){super(...arguments),this.id=(0,m.prop)(),this.rowId=(0,m.prop)(),this.body=(0,m.prop)(),this.type=(0,m.prop)(),this.subtype=(0,m.prop)(),this.t=(0,m.prop)(),this.notifyName=(0,m.prop)(),this.from=(0,m.prop)(),this.to=(0,m.prop)(),this.author=(0,m.prop)(),this.self=(0,m.prop)("in"),this.ack=(0,m.prop)(),this.invis=(0,m.prop)(),this.isNewMsg=(0,m.prop)(),this.star=(0,m.prop)(!1),this.recvFresh=(0,m.prop)(),this.caption=(0,m.prop)(),this.interactiveAnnotations=(0,m.prop)(),this.contextInfo=(0,m.prop)(),this.clientUrl=(0,m.prop)(),this.loc=(0,m.prop)(),this.lat=(0,m.prop)(),this.lng=(0,m.prop)(),this.isLive=(0,m.prop)(),this.accuracy=(0,m.prop)(),this.speed=(0,m.prop)(),this.degrees=(0,m.prop)(),this.comment=(0,m.prop)(),this.sequence=(0,m.prop)(),this.shareDuration=(0,m.prop)(),this.finalLat=(0,m.prop)(),this.finalLng=(0,m.prop)(),this.finalAccuracy=(0,m.prop)(),this.finalThumbnail=(0,m.prop)(),this.finalSpeed=(0,m.prop)(),this.finalDegrees=(0,m.prop)(),this.finalTimeOffset=(0,m.prop)(),this.deprecatedMms3Url=(0,m.prop)(),this.directPath=(0,m.prop)(),this.mimetype=(0,m.prop)(),this.duration=(0,m.prop)(),this.filehash=(0,m.prop)(),this.encFilehash=(0,m.prop)(),this.size=(0,m.prop)(),this.filename=(0,m.prop)(),this.streamingSidecar=(0,m.prop)(),this.mediaKey=(0,m.prop)(),this.mediaKeyTimestamp=(0,m.prop)(),this.pageCount=(0,m.prop)(),this.isGif=(0,m.prop)(),this.gifAttribution=(0,m.prop)(),this.isViewOnce=(0,m.prop)(),this.streamable=(0,m.prop)(),this.width=(0,m.prop)(),this.height=(0,m.prop)(),this.thumbnailDirectPath=(0,m.prop)(),this.thumbnailSha256=(0,m.prop)(),this.thumbnailEncSha256=(0,m.prop)(),this.thumbnailHeight=(0,m.prop)(),this.thumbnailWidth=(0,m.prop)(),this.waveform=(0,m.prop)(),this.staticUrl=(0,m.prop)(),this.stickerPackId=(0,m.prop)(),this.stickerPackName=(0,m.prop)(),this.stickerPackPublisher=(0,m.prop)(),this.scanLengths=(0,m.prop)(),this.scansSidecar=(0,m.prop)(),this.isFromTemplate=(0,m.prop)(!1),this.devicesAdded=(0,m.prop)(),this.devicesRemoved=(0,m.prop)(),this.isThisDeviceAdded=(0,m.prop)(),this.firstFrameLength=(0,m.prop)(),this.firstFrameSidecar=(0,m.prop)(),this.isAnimated=(0,m.prop)(),this.canonicalUrl=(0,m.prop)(),this.matchedText=(0,m.prop)(),this.thumbnail=(0,m.prop)(),this.thumbnailHQ=(0,m.prop)(),this.richPreviewType=(0,m.prop)(),this.doNotPlayInline=(0,m.prop)(),this.title=(0,m.prop)(),this.description=(0,m.prop)(),this.businessOwnerJid=(0,m.prop)(),this.productId=(0,m.prop)(),this.currencyCode=(0,m.prop)(),this.priceAmount1000=(0,m.prop)(),this.salePriceAmount1000=(0,m.prop)(),this.retailerId=(0,m.prop)(),this.url=(0,m.prop)(),this.productImageCount=(0,m.prop)(),this.sessionId=(0,m.prop)(),this.recipients=(0,m.prop)(),this.broadcast=(0,m.prop)(),this.quotedMsg=(0,m.prop)(),this.quotedStanzaID=(0,m.prop)(),this.quotedRemoteJid=(0,m.prop)(),this.quotedParticipant=(0,m.prop)(),this.quotedGroupSubject=(0,m.prop)(),this.quotedParentGroupJid=(0,m.prop)(),this.mentionedJidList=(0,m.prop)(),this.footer=(0,m.prop)(),this.hydratedButtons=(0,m.prop)(),this.buttons=(0,m.prop)(),this.selectedId=(0,m.prop)(),this.selectedIndex=(0,m.prop)(),this.multicast=(0,m.prop)(),this.urlText=(0,m.prop)(),this.urlNumber=(0,m.prop)(),this.clearMedia=(0,m.prop)(),this.isVcardOverMmsDocument=(0,m.prop)(!1),this.vcardList=(0,m.prop)(),this.vcardFormattedName=(0,m.prop)(),this.revokeSender=(0,m.prop)(),this.protocolMessageKey=(0,m.prop)(),this.futureproofBuffer=(0,m.prop)(),this.templateParams=(0,m.prop)(),this.textColor=(0,m.prop)(),this.backgroundColor=(0,m.prop)(),this.font=(0,m.prop)(),this.campaignId=(0,m.prop)(),this.campaignDuration=(0,m.prop)(),this.actionLink=(0,m.prop)(),this.statusPSAReadTimestamp=(0,m.prop)(),this.isForwarded=(0,m.prop)(!1),this.forwardingScore=(0,m.prop)(),this.labels=(0,m.prop)(),this.hasReaction=(0,m.prop)(!1),this.paymentCurrency=(0,m.prop)(),this.paymentAmount1000=(0,m.prop)(),this.paymentMessageReceiverJid=(0,m.prop)(),this.paymentTransactionTimestamp=(0,m.prop)(),this.paymentStatus=(0,m.prop)(),this.paymentTxnStatus=(0,m.prop)(),this.paymentNoteMsg=(0,m.prop)(),this.paymentRequestMessageKey=(0,m.prop)(),this.paymentExpiryTimestamp=(0,m.prop)(),this.paymentInviteServiceType=(0,m.prop)(),this.paymentBackground=(0,m.prop)(),this.ephemeralStartTimestamp=(0,m.prop)(),this.ephemeralDuration=(0,m.prop)(),this.ephemeralSettingTimestamp=(0,m.prop)(),this.ephemeralOutOfSync=(0,m.prop)(),this.ephemeralSharedSecret=(0,m.prop)(),this.disappearingModeInitiator=(0,m.prop)(),this.bizPrivacyStatus=(0,m.prop)(),this.privacyModeWhenSent=(0,m.prop)(),this.verifiedBizName=(0,m.prop)(),this.inviteCode=(0,m.prop)(),this.inviteCodeExp=(0,m.prop)(),this.inviteGrp=(0,m.prop)(),this.inviteGrpName=(0,m.prop)(),this.inviteGrpJpegThum=(0,m.prop)(),this.inviteGrpType=(0,m.prop)(),this.sellerJid=(0,m.prop)(),this.message=(0,m.prop)(),this.orderTitle=(0,m.prop)(),this.itemCount=(0,m.prop)(),this.orderId=(0,m.prop)(),this.surface=(0,m.prop)(),this.status=(0,m.prop)(),this.token=(0,m.prop)(),this.totalAmount1000=(0,m.prop)(),this.totalCurrencyCode=(0,m.prop)(),this.historySyncMetaData=(0,m.prop)(),this.mdDowngrade=(0,m.prop)(),this.isSendFailure=(0,m.prop)(),this.appStateSyncKeyShare=(0,m.prop)(),this.appStateSyncKeyRequest=(0,m.prop)(),this.appStateFatalExceptionNotification=(0,m.prop)(),this.broadcastParticipants=(0,m.prop)(),this.broadcastEphSettings=(0,m.prop)(),this.broadcastId=(0,m.prop)(),this.ctwaContext=(0,m.prop)(),this.list=(0,m.prop)(),this.listResponse=(0,m.prop)(),this.productListItemCount=(0,m.prop)(),this.productHeaderImageRejected=(0,m.prop)(!1),this.lastPlaybackProgress=(0,m.prop)(0),this.sendDeferred=(0,m.session)(),this.local=(0,m.session)(),this.search=(0,m.session)(),this.msgChunk=(0,m.session)(),this.phoneUploading=(0,m.session)(),this.startOfDay=(0,m.session)(),this.startOfDaySkew=(0,m.session)(),this._quotedMsgObj=(0,m.session)(),this.isQuotedMsgAvailable=(0,m.session)(!0),this.senderObj=(0,m.session)(),this.mediaData=(0,m.session)(),this.forwardedFromWeb=(0,m.session)(!1),this.squelch=(0,m.session)(),this.wamMessageSendPerfReporter=(0,m.session)(),this.isDynamicReplyButtonsMsg=(0,m.prop)(!1),this.dynamicReplyButtons=(0,m.prop)(),this.replyButtons=(0,m.prop)(),this.buttonsResponse=(0,m.prop)(),this.selectedButtonId=(0,m.prop)(),this.headerType=(0,m.prop)(),this.nativeFlowName=(0,m.prop)(),this.nativeFlowButtons=(0,m.prop)(),this.interactiveHeader=(0,m.prop)(),this.interactiveType=(0,m.prop)(),this.interactivePayload=(0,m.prop)(),this.reactionParentKey=(0,m.prop)(),this.reactionText=(0,m.prop)(),this.reactionTimestamp=(0,m.prop)(),this.isMdHistoryMsg=(0,m.prop)(!1),this._links=(0,m.session)((()=>[])),this._headerLinks=(0,m.session)((()=>[])),this._footerLinks=(0,m.session)((()=>[])),this.linksIndexParsed=(0,m.session)(0),this._waitForPhoneUploadPromise=(0,m.session)(),this.requiresDirectConnection=(0,m.prop)(null),this.chat=(0,m.derived)(this._chat),this.hasTemplateButtons=(0,m.derived)(this._hasTemplateButtons,["buttons"]),this.ephemeralExpirationTimestamp=(0,m.derived)(this._ephemeralExpirationTimestamp,["t","subtype","ephemeralStartTimestamp","ephemeralDuration"]),this.isEphemeral=(0,m.derived)(this._isEphemeral,["ephemeralDuration","type","subtype"]),this.isQuickReply=(0,m.derived)(this._isQuickReply,["buttons"]),this.isFutureproof=(0,m.derived)(this._isFutureproof,["type","subtype"]),this.isGroupMsg=(0,m.derived)(this._isGroupMsg),this.isStickerMsg=(0,m.derived)(this._isStickerMsg),this.isStatusV3=(0,m.derived)(this._isStatusV3),this.isPSA=(0,m.derived)(this._isPSA),this.isProductListMessage=(0,m.derived)(this._isProductListMessage),this.isRTL=(0,m.derived)(this._isRTL,["dir"]),this.asProductInquiry=(0,m.derived)(this._asProductInquiry),this.statusV3TextBg=(0,m.derived)(this._statusV3TextBg),this.isSentByMe=(0,m.derived)(this._isSentByMe),this.isSentByMeFromWeb=(0,m.derived)(this._isSentByMeFromWeb,["isUserCreatedType"]),this.isRevokedByMe=(0,m.derived)(this._isRevokedByMe),this.isInternational=(0,m.derived)(this._isInternational),this.isNotification=(0,m.derived)(this._isNotification,["type","subtype"]),this.asGroupNotification=(0,m.derived)(this._asGroupNotification,["type"]),this.asBroadcastNotification=(0,m.derived)(this._asBroadcastNotification,["type"]),this.isBizNotification=(0,m.derived)(this._isBizNotification,["type","subtype"]),this.asProduct=(0,m.derived)(this._asProduct,["type"]),this.asAlbumAsset=(0,m.derived)(this._asAlbumAsset,["type","isNotification","caption","isForwarded","asRevoked","isGif","quotedMsg","ctwaContext","isViewOnce"]),this.asAutoDownloadableMedia=(0,m.derived)(this._asAutoDownloadableMedia,["type"]),this.asGroupedSticker=(0,m.derived)(this._asGroupedSticker,["type","isNotification","asRevoked","quotedMsg","ctwaContext"]),this.isMedia=(0,m.derived)(this._isMedia,["type"]),this.asDoc=(0,m.derived)(this._asDoc,["type"]),this.asImage=(0,m.derived)(this._asImage,["type"]),this.asVideo=(0,m.derived)(this._asVideo,["type"]),this.asAudio=(0,m.derived)(this._asAudio,["type"]),this.asPtt=(0,m.derived)(this._asPtt,["type"]),this.asMms=(0,m.derived)(this._asMms,["type"]),this.asUrl=(0,m.derived)(this._asUrl,["type","subtype"]),this.asRevoked=(0,m.derived)(this._asRevoked,["type"]),this.asViewOnce=(0,m.derived)(this._asViewOnce,["type","isViewOnce"]),this.asVisualMedia=(0,m.derived)(this._asVisualMedia,["type"]),this.numTimesForwarded=(0,m.derived)(this._numTimesForwarded,["isForwarded","forwardingScore"]),this.isFrequentlyForwarded=(0,m.derived)(this._isFrequentlyForwarded,["numTimesForwarded"]),this.eventType=(0,m.derived)(this._eventType,["type","invis","isNewMsg"]),this.sender=(0,m.derived)(this._sender),this.text=(0,m.derived)(this._text,["type","body","caption","comment","isLive","paymentNoteMsg","subtype"]),this.containsEmoji=(0,m.derived)(this._containsEmoji,["text"]),this.isFailed=(0,m.derived)(this._isFailed,["isSentByMe","ack","mdDowngrade","isSendFailure"]),this.vcard=(0,m.derived)(this._vcard,["type","body"]),this.isUnsentMedia=(0,m.derived)(this._isUnsentMedia,["ack","asMms","isSentByMe"]),this.dir=(0,m.derived)(this._dir,["type","text","subtype"]),this.rtl=(0,m.derived)(this._rtl,["type","text","subtype"]),this.linkPreview=(0,m.derived)(this._linkPreview,["matchedText","body","title","description"]),this.isGroupsV4InviteExpired=(0,m.derived)(this._isGroupsV4InviteExpired,["type","inviteCode","inviteCodeExp"]),this.isUnreadType=(0,m.derived)(this._isUnreadType,["type"]),this.isUserCreatedType=(0,m.derived)(this._isUserCreatedType,["type"]),this.supportsMessageFooter=(0,m.derived)(this._supportsMessageFooter,["isDynamicReplyButtonsMsg","isFromTemplate"]),this.supportsMessageFooterLinks=(0,m.derived)(this._supportsMessageFooterLinks,["type","isDynamicReplyButtonsMsg"]),this.hasBodyOrFooter=(0,m.derived)(this._hasBodyOrFooter,["text","footer"]),this.initialPageSize=(0,m.derived)(this._initialPageSize,["isFrequentlyForwarded"]),this.productListHeaderImage=(0,m.derived)(this._productListHeaderImage,["productHeaderImageRejected","list"]),this.isInitialE2ENotification=(0,m.derived)(this._isInitialE2ENotification,["type","subtype"]),this.isDisappearingModeSystemMessage=(0,m.derived)(this._isDisappearingModeSystemMessage,["type","subtype"]),this.isProbablyForwardedPtt=(0,m.derived)(this._isProbablyForwardedPtt,["type","mimetype"]),this._saveLastPlaybackProgress=(0,s.default)(((e,t)=>{(0,ne.updateLocal)(e,{lastPlaybackProgress:t})}),500)}_chat(){return this._getChatCollection().get(this.id.remote)}_hasTemplateButtons(){return this.isFromTemplate&&null!=this.buttons&&this.buttons.length>0}_ephemeralExpirationTimestamp(){const{ephemeralDuration:e,ephemeralStartTimestamp:t,t:r,subtype:n,id:{fromMe:i}}=this;return(0,R.getEphemeralExpirationTimestamp)(e,t,r,n,i)}_isEphemeral(){return(this.type!==de.PROTOCOL||"ephemeral_setting"!==this.subtype)&&(null!=this.ephemeralDuration&&0!==this.ephemeralDuration)}_isQuickReply(){if(!this.hasTemplateButtons)return!1;if(null==this.buttons)return!1;const e=this.buttons.at(0);return null!=e&&e.subtype===v.default.TEMPLATE_BUTTON_SUBTYPE.QUICK_REPLY}_isFutureproof(){return this.type===de.UNKNOWN||this.type===de.PAYMENT&&"futureproof"===this.subtype}_isGroupMsg(){return le.default.isGroup(this.from)||le.default.isGroup(this.to)}_isStickerMsg(){return this.type===de.STICKER}_isStatusV3(){return le.default.isStatusV3(this.id.remote)}_isPSA(){return le.default.isPSA(this.id.remote)}_isProductListMessage(){var e;return this.type===de.LIST&&(null===(e=this.list)||void 0===e?void 0:e.listType)===C.ListMessageListType.PRODUCT_LIST}_isRTL(){return"rtl"===this.dir||void 0===this.dir&&U.default.isRTL()}_asProductInquiry(){const e=this.safe();return e.type===v.default.MSG_TYPE.PRODUCT&&e.id&&e.id.id.startsWith(v.default.PRODUCT_INQUIRY_TYPE)?e:null}_statusV3TextBg(){if(!this.isStatusV3)return null;const e=this.backgroundColor;return e?`rgba(${e>>16&255}, ${e>>8&255}, ${255&e}, ${e>>24&255})`:null}_isSentByMe(){return"in"!==this.id.self&&!this.isNotification&&le.default.equals(this.from,(0,w.getMaybeMeUser)())}_isSentByMeFromWeb(){return this.id.fromMe&&this.local&&this.isUserCreatedType}_isRevokedByMe(){return le.default.equals(this.revokeSender,(0,w.getMaybeMeUser)())}_isInternational(){var e;const t=this.id.fromMe?this.to.toString({legacy:!0}):this.from.toString({legacy:!0}),r=null===(e=(0,w.getMaybeMeUser)())||void 0===e?void 0:e.toString({legacy:!0});return t&&r?(0,h.phoneCC)(t)!==(0,h.phoneCC)(r):(__LOG__(3)`Msg: could not derive isInternational as some data is missing`,!1)}_isNotification(){return $.isNotification(this.type,this.subtype)}_asGroupNotification(){const e=this.safe();switch(e.type){case de.GROUP_NOTIFICATION:case de.GP2:return e;default:return null}}_asBroadcastNotification(){const e=this.safe();return e.type===de.BROADCAST_NOTIFICATION?e:null}_isBizNotification(){if(this.type===de.NOTIFICATION_TEMPLATE){if(g.BIZ_SYSTEM_MSG_SUBTYPES.includes(this.subtype))return!0;if(g.BIZ_SYSTEM_MSG_SUBTYPES_V2.includes(this.subtype))return!0;switch(this.subtype){case"verified_initial_unknown":case"verified_initial_low":case"verified_initial_high":case"verified_transition_any_to_none":case"verified_transition_any_to_high":case"verified_transition_high_to_low":case"verified_transition_high_to_unknown":case"verified_transition_unknown_to_low":case"verified_transition_low_to_unknown":case"verified_transition_none_to_low":case"verified_transition_none_to_unknown":case"biz_verified_transition_top_to_bottom":case"biz_verified_transition_bottom_to_top":case"biz_intro_top":case"biz_intro_bottom":case"biz_name_change":case"biz_move_to_consumer_app":case"biz_two_tier_migration_top":case"biz_two_tier_migration_bottom":return!0;default:return!1}}return!1}_asProduct(){const e=this.safe();return"product"===e.type?e:null}_asAlbumAsset(){const e=this.safe();return e.type!==v.default.MSG_TYPE.IMAGE&&(e.type!==v.default.MSG_TYPE.VIDEO||!0===e.isGif)||e.isNotification||e.caption||e.asRevoked||e.quotedMsg||e.ctwaContext||e.isViewOnce?null:e}_asAutoDownloadableMedia(){const e=this.safe();switch(e.type){case v.default.MSG_TYPE.IMAGE:case v.default.MSG_TYPE.STICKER:case v.default.MSG_TYPE.AUDIO:case v.default.MSG_TYPE.PTT:case v.default.MSG_TYPE.VIDEO:case v.default.MSG_TYPE.DOCUMENT:return e}return(0,$.typeIsUrl)(e)?e:null}_asGroupedSticker(){const e=this.safe();return e.type!==v.default.MSG_TYPE.STICKER||e.isNotification||e.asRevoked||e.quotedMsg||e.ctwaContext?null:e}_isMedia(){return["image","video","audio"].includes(this.type)}_asDoc(){const e=this.safe();return e.type===v.default.MSG_TYPE.DOCUMENT?e:null}_asImage(){const e=this.safe();return e.type===v.default.MSG_TYPE.IMAGE?e:null}_asVideo(){const e=this.safe();return e.type===v.default.MSG_TYPE.VIDEO?e:null}_asAudio(){const e=this.safe();return e.type===v.default.MSG_TYPE.AUDIO?e:null}_asPtt(){const e=this.safe();return e.type===v.default.MSG_TYPE.PTT?e:null}_asMms(){const e=this.safe();return(0,$.typeIsMms)(e)?e:null}_asUrl(){const e=this.safe();return(0,$.typeIsUrl)(e)?e:null}_asRevoked(){const e=this.safe();return e.type===de.REVOKED?e:null}_asViewOnce(){const e=this.asVisualMedia;return(null==e?void 0:e.isViewOnce)?e:null}_asVisualMedia(){const e=this.safe();return e.type===v.default.MSG_TYPE.IMAGE||e.type===v.default.MSG_TYPE.VIDEO?e:null}_numTimesForwarded(){return this.forwardingScore?this.forwardingScore||0:this.isForwarded?1:0}_isFrequentlyForwarded(){return this.numTimesForwarded>=v.default.FREQUENTLY_FORWARDED_SENTINEL}_eventType(){if(!this.isNewMsg)return"i";const e=(0,$.eventTypeFromMsgType)(this);return this.invis?"i"===e?"i":"n":e}_sender(){return this.isSentByMe?this.from:this.isGroupMsg||this.isStatusV3?this.author:this.from}_text(){var e;if(this.isFromTemplate||this.isDynamicReplyButtonsMsg)return this.type===de.CHAT?this.body:this.caption;switch(this.type){case de.CHAT:return this.body;case de.IMAGE:case de.VIDEO:return this.caption;case de.LOCATION:return this.isLive?this.comment:void 0;case de.PAYMENT:const{paymentNoteMsg:t}=this;return t?t.body:void 0;case de.GROUPS_V4_INVITE:return this.comment;case de.LIST:return null===(e=this.list)||void 0===e?void 0:e.description;case de.PRODUCT:return(0,d.default)(this.title,{length:v.default.MAX_REPLY_PRODUCT_TITLE_LENGTH});case de.HSM:case de.TEMPLATE_BUTTON_REPLY:return this.body;case de.INTERACTIVE:return null!=this.nativeFlowName?(0,O.formatNFMText)(this):this.caption;case de.NATIVE_FLOW:return(0,O.formatNFMText)(this);default:return}}_containsEmoji(){const{text:e}=this;return!!e&&b.EmojiUtil.containsEmoji(e)}_isFailed(){const e=this.isSentByMe&&this.ack<v.default.ACK.CLOCK;return N.GK.supportsFeature(N.GK.F.MD_BACKEND)?e||!!this.mdDowngrade||!!this.isSendFailure:e}_vcard(){if(this.type===de.VCARD)try{return(0,ae.parseVcard)(this.body)}catch(e){return}}_isUnsentMedia(){return this.ack<v.default.ACK.SENT&&null!=this.asMms&&this.isSentByMe}_dir(){return this.type===de.VCARD?this.subtype?u.dir(this.subtype):void 0:this.text?u.dir(this.text):void 0}_rtl(){return this.type===de.VCARD?!!this.subtype&&"rtl"===u.dir(this.subtype):!!this.text&&"rtl"===u.dir(this.text)}_linkPreview(){return(0,te.isString)(this.matchedText)&&(!(0,c.default)(this.title)||!(0,c.default)(this.description))&&this.body.includes(this.matchedText)}_isGroupsV4InviteExpired(){if(this.type!==v.default.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(!this.inviteCode)return!0;const e=(new Date).getTime()/1e3;return parseInt(e,10)>=parseInt(this.inviteCodeExp,10)}_isUnreadType(){return(0,ie.isUnreadTypeMsg)(this)}_isUserCreatedType(){return[de.PROTOCOL,de.CHAT,de.LOCATION,de.VCARD,de.MULTI_VCARD,de.IMAGE,de.VIDEO,de.AUDIO,de.PTT,de.DOCUMENT,de.STICKER,de.PRODUCT,de.GROUPS_V4_INVITE,de.ORDER].includes(this.type)}_supportsMessageFooter(){return this.isFromTemplate||this.isDynamicReplyButtonsMsg}_supportsMessageFooterLinks(){return this.isDynamicReplyButtonsMsg||this.type===de.LIST||this.type===de.INTERACTIVE}_hasBodyOrFooter(){return null!=this.text||null!=this.footer}_initialPageSize(){return this.isFrequentlyForwarded?v.default.FREQUENTLY_FORWARDED_INITIAL_PAGE_SIZE:v.default.INITIAL_PAGE_SIZE}_productListHeaderImage(){var e,t,r,n;return!0===this.productHeaderImageRejected?null:null!==(e=null===(t=this.list)||void 0===t||null===(r=t.productListInfo)||void 0===r||null===(n=r.headerImage)||void 0===n?void 0:n.jpegThumbnail)&&void 0!==e?e:null}_isInitialE2ENotification(){return this.type===de.E2E_NOTIFICATION&&"encrypt"===this.subtype||g.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT.includes(this.subtype)}_isDisappearingModeSystemMessage(){return this.type===de.NOTIFICATION_TEMPLATE&&"disappearing_mode"===this.subtype}_isProbablyForwardedPtt(){return this.type===de.AUDIO&&(0,G.default)(this.mimetype)}shouldBeDisplayedAsPtt(){return this.type===de.PTT||ee.ServerProps.pttForwardedFeaturesEnabled&&this.isProbablyForwardedPtt&&null!=this.waveform}initialize(){if(super.initialize(),this._pendingAckUpdate=new f.PromiseQueue,this.sender)this.addChild("senderObj",T.ContactCollection.gadd(this.sender));else switch(this.type){case de.NOTIFICATION:case de.NOTIFICATION_TEMPLATE:case de.GROUP_NOTIFICATION:case de.GP2:case de.BROADCAST_NOTIFICATION:case de.E2E_NOTIFICATION:case de.CALL_LOG:case de.PROTOCOL:break;default:__LOG__(2)`msg:msg with no sender id:${this.id.toString()}, from:${this.from.toString()}, author:${this.author&&this.author.toString()}, type:${this.type}`}let e;this.mentionedJidList=this.mentionedJidList||[],this.mentionedJidList.forEach((e=>T.ContactCollection.gadd(e)));const t=this.getCollection();(e=t.preAck[this.id])&&(__LOG__(2)`Msg:initialize updating msg with out of order ack`,this.updateAck(e.ack,e.t),delete t.preAck[this.id]),this.type===de.CIPHERTEXT&&this.listenToOnce(this,"change:type",this.onCiphertextDecrypted),this.mediaObject=void 0,$.typeIsMms(this)&&(this._createMediaDataChild(),this.isViewOnce&&!(0,se.isUnviewed)(this.safe())||Y.registerMsg(this)),this.isSentByMeFromWeb&&(this.sendDeferred=new _.Resolvable,this.sendDeferred.promise.finally((()=>{this.sendDeferred=null}))),this.isLive&&r(85865).LiveLocationCollection.processMsg(this,!1),S.Conn.isSMB&&(0,F.initializeLabels)(this),this.isViewOnce&&(this.listenTo(this,"change:ack",this.onViewOnceMediaStatusChanged),this.listenTo(this.mediaData,"change:mediaStage",this.onViewOnceMediaStatusChanged))}_getLinks(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=t)return[arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t];const r=(0,re.firstNCodepoints)(e,t);let n=K.findLinks(r,false,this.sender);if((0,re.numCodepoints)(e)>t&&n.length>0){const i=n[n.length-1];(0,re.numCodepoints)(r.slice(0,i.index))+(0,re.numCodepoints)(i.url)===t&&(n=K.findLinks(e,false,this.sender))}return[n,t]}getLinks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1;const{text:t}=this;if(null==t)return this._links;const[r,n]=this._getLinks(t,this._links,this.linksIndexParsed,e);return this.linksIndexParsed=n,this._links=r}_displayHeaderLinksForListMessages(){var e,t;return"list"===this.type&&(null===(e=this.list)||void 0===e?void 0:e.listType)===C.ListMessageListType.SINGLE_SELECT&&null!=(null===(t=this.list)||void 0===t?void 0:t.title)}_displayHeaderLinksForNonListMessages(){return!0===this.isDynamicReplyButtonsMsg&&null!=this.title}_getHeaderLinks(e){if(this._headerLinks.length>0)return this._headerLinks;const[t]=this._getLinks(e,this._headerLinks);return this._headerLinks=t}getHeaderLinks(){var e,t;return this._displayHeaderLinksForListMessages()?this._getHeaderLinks((null===(t=this.list)||void 0===t?void 0:t.title)||""):this._displayHeaderLinksForNonListMessages()?this._getHeaderLinks(this.title):this.type===de.INTERACTIVE&&null!=(null===(e=this.interactiveHeader)||void 0===e?void 0:e.title)?this._getHeaderLinks(this.interactiveHeader.title):[]}getFooterLinks(){if(!this.supportsMessageFooterLinks||null==this.footer)return[];if(this._footerLinks.length>0)return this._footerLinks;const[e]=this._getLinks(this.footer,this._footerLinks);return this._footerLinks=e}getGalleryLinks(){return(0,l.default)(this.getLinks(),"href").filter((e=>e.isHttp))}getSuspiciousLinks(){return this.getLinks().filter((e=>{var t;return null===(t=e.suspiciousCharacters)||void 0===t?void 0:t.size}))}_createMediaDataChild(){this.addChild("mediaData",new j.default)}hasSymbol(){return this.type===de.INTERACTIVE?this.interactiveType===k.default.SHOPS_STOREFRONT||this.interactiveType===k.default.NATIVE_FLOW&&this.nativeFlowName===z.default.ORDER_DETAILS:["image","video","audio","ptt","location","vcard","multi_vcard","document","ciphertext","oversized","unknown","call_log","revoked","sticker","payment","groups_v4_invite","product","order"].includes(this.type)}mayFail(){return this.isSentByMe&&this.ack<v.default.ACK.SENT}isUnsentPhoneMsg(){return!this.local&&this.isSentByMe&&this.ack<v.default.ACK.SENT}canReply(){return!(this.type===de.LIST&&!(0,$.listMsgCanRender)(this))&&(this.chat.canSend&&!this.mayFail()&&!this.isNotification&&!this.chat.isSuspendedGroup()&&this.type!==de.UNKNOWN&&this.type!==de.CIPHERTEXT&&this.type!==de.OVERSIZED&&this.type!==de.REVOKED&&this.interactiveButtonsReleased())}canPrivateReply(){return!this.mayFail()&&!this.isNotification&&this.type!==de.UNKNOWN&&this.type!==de.CIPHERTEXT&&this.type!==de.OVERSIZED&&this.type!==de.REVOKED&&!this.isSentByMe&&this.isGroupMsg&&this.interactiveButtonsReleased()}canPrivateReplyInRestrictedGrp(){return!!this.chat.isAnnounceGrpRestrict&&!this.chat.isReadOnly&&!this.mayFail()&&!this.isSentByMe&&!this.isNotification&&this.type!==de.UNKNOWN&&this.type!==de.CIPHERTEXT&&this.type!==de.OVERSIZED&&this.type!==de.REVOKED&&this.interactiveButtonsReleased()}canForward(){var e,t;if(this.type===de.CIPHERTEXT)return!1;if(this.type===de.OVERSIZED)return!1;if(this.type===de.REVOKED)return!1;if(this.type===de.UNKNOWN)return!1;if(this.type===de.PAYMENT)return!1;if(this.type===de.LIST)return(null===(e=this.list)||void 0===e?void 0:e.listType)===C.ListMessageListType.PRODUCT_LIST&&(0,$.listMsgCanRender)(this);if(this.type===de.GROUPS_V4_INVITE)return!1;if(this.type===de.LOCATION&&this.isLive)return!1;if(this.type===de.ORDER)return!1;if(this.type===de.INTERACTIVE&&null!=this.nativeFlowName)return!1;if(!this.interactiveButtonsReleased())return!1;if(this.ack<v.default.ACK.SENT&&this.isSentByMe)return!1;if(this.asMms){const e=this.mediaData;if(e.mediaStage===W.MEDIA_DATA_STAGE.EXISTS)return!0;if(e.mediaStage===W.MEDIA_DATA_STAGE.ERROR_MISSING)return!1;if(e.mediaStage===W.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED)return!1;if(e.mediaStage!==W.MEDIA_DATA_STAGE.RESOLVED&&(this.type===de.IMAGE||this.type===de.VIDEO||this.type===de.PTT))return!1;if(this.isViewOnce)return!1;if(this.isUnsentMedia)return!1}return!(null===(t=this.nativeFlowButtons)||void 0===t?void 0:t.length)}canQuickForward(){return!(!this.canForward()||this.isFrequentlyForwarded||0!==this.getSuspiciousLinks().length||this.type===v.default.MSG_TYPE.PTT||this.type===v.default.MSG_TYPE.STICKER||!this.interactiveButtonsReleased())&&(null!=this.asMms||this.linkPreview||this.type===v.default.MSG_TYPE.VCARD||this.type===v.default.MSG_TYPE.LOCATION||null!=this.ctwaContext)}canStar(){return!(this.type===de.LIST&&!(0,$.listMsgCanRender)(this))&&(!this.isNotification&&!this.isFutureproof&&!this.isViewOnce&&this.type!==de.REVOKED&&!(this.ack<v.default.ACK.SENT&&this.isSentByMe)&&this.interactiveButtonsReleased())}interactiveButtonsReleased(){return this.isFromTemplate||!this.hasTemplateButtons&&this.type!==v.default.MSG_TYPE.TEMPLATE_BUTTON_REPLY}isGroupLeave(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&le.default.equals(this.recipients[0],(0,w.getMaybeMeUser)())}isTrusted(){var e;return!!le.default.equals(this.sender,(0,w.getMaybeMeUser)())||(!!(null===(e=this.senderObj)||void 0===e?void 0:e.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():this.chat.notSpam))}getVcardWids(){return this.type!==de.VCARD?null:(0,ae.vcardWids)(this.vcard)}getLocObject(){const e=this.loc;if(e){const[t,r=null]=e.split("\n");return{name:t,addr:r}}return null}resumeRemoteUpload(){return this.isUnsentPhoneMsg()&&!this.phoneUploading&&((0,X.sendMsgRecord)(this).then((e=>{e!==Z.SendMsgResult.OK&&(this.phoneUploading=!1)})),this.phoneUploading=!0),this.forceDownloadMediaEvenIfExpensive()}forceRMR(){return Promise.reject(new Error("unimplemented forceRMR"))}isForcingRMR(){return!1}cancelDownload(){Y.cancelDownloadMsg(this)}resumeUpload(){return this.mediaData.mediaStage!==W.MEDIA_DATA_STAGE.NEED_UPLOAD&&(__LOG__(4,void 0,new Error,!0)`resumeUpload called while state was ${this.mediaData.mediaStage}`,SEND_LOGS("resume-non-need-upload")),Y.resumeUploadMsg(this)}cancelUpload(){Y.cancelUploadMsg(this)}waitForPhoneUpload(){var e=this;return(0,a.default)((function*(){Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()||(e._waitForPhoneUploadPromise||(e._waitForPhoneUploadPromise=(0,oe.default)(e.mediaData,"change:mediaStage change:filehash",(()=>Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()))),yield e._waitForPhoneUploadPromise,e._waitForPhoneUploadPromise=null)}))()}forceDownloadMediaEvenIfExpensive(){return this.downloadMedia({downloadEvenIfExpensive:!0,rmrReason:H.default.WEBC_RMR_REASON_CODE.MSG_CLICK,isUserInitiated:!0})}downloadMedia(e){if(this.asRevoked)return Promise.resolve();const{downloadEvenIfExpensive:t,rmrReason:r,isUserInitiated:n,isAutoDownload:i}=e;if(this.asMms||(__LOG__(4,void 0,new Error,!0)`id: ${this.id.toString()} type: ${this.type}`,SEND_LOGS("media-fault: downloadMedia msg is not mms type")),this.isUnsentPhoneMsg()){let t=this._waitForPhoneUploadPromise;return t||(t=this._waitForPhoneUploadPromise=(0,oe.default)(this.mediaData,"change:mediaStage change:filehash",(()=>!!this.mediaData.filehash&&!this.isUnsentPhoneMsg())).then((()=>{this._waitForPhoneUploadPromise=null}))),t.then((()=>this.downloadMedia(e)))}return Y.downloadMsg({msg:this,isUserClick:r===H.default.WEBC_RMR_REASON_CODE.MSG_CLICK,downloadEvenIfExpensive:t,rmrReason:r,rmrData:this._getRmrData(r),mode:n?"manual":"auto",isAutoDownload:i})}_getRmrData(e){const t={webcRmrReason:e,webcMessageT:this.t},r=this.chat;if(r){t.webcChatType=r.getWebcChatType(),null!=r.initialIndex&&(t.webcChatPosition=r.initialIndex);const{msgChunk:e}=this;e&&e===r.msgs&&(t.webcMessageIndex=e.length-e.indexOf(this)-1)}return t}applyUpdate(e){if(e.type&&this.type!==e.type&&$.typeIsMms(e))return this.type!==de.CIPHERTEXT&&(__LOG__(4,void 0,new Error,!0)`updated ${this.id.toString()} from ${this.type} to ${String(e.type)}`,SEND_LOGS("invalid-type-update")),this._createMediaDataChild(),Y.registerMsgEarly(this,e),Y.prepareMsg(this).then((()=>{this.set(e)})).catch((e=>{__LOG__(4,void 0,new Error,!0)`error = ${String(e)}`,SEND_LOGS("preregister-error")}));if(this.set(e),this.isLive&&r(85865).LiveLocationCollection.processMsg(this,!0),this.paymentTransactionTimestamp){this.getCollection().updateLastTransactionTime(this.id.remote,this.paymentTransactionTimestamp)}return Promise.resolve()}waitForPrep(){var e=this;return(0,a.default)((function*(){var t;const r=null==e.requiresDirectConnection?(0,I.genDirectConnectionMessageModifiers)(e.type,null===(t=e.list)||void 0===t?void 0:t.listType,e.businessOwnerJid).then((t=>e.set(t))):Promise.resolve(),n=$.typeIsMms(e)?Y.prepareMsg(e):Promise.resolve();return yield r,n}))()}delete(e){super.delete();r(19011).AllStarredMsgsCollection.remove(this),this.isLive&&r(85865).LiveLocationCollection.removeMsg(this);this.getCollection().remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id,{},Boolean(null==e?void 0:e.skipUpdatingSortTime)),$.typeIsMms(this)&&Y.deregisterMsg(this),r(16770).LabelCollection.removeAllLabelsMD(this);const t=this._getChatCollection().get(this.id.remote);if(t){t.unreadMsgAnchor===this&&(t.unreadMsgAnchor=void 0);if((!e||!e.doNotResetLastReceived)&&t.lastReceivedKey===this.id){let e;const r=t.getLastReceivedMsg();r&&(e=r.id),(0,x.setLastReceivedKey)(t.id,e).then((()=>{t.lastReceivedKey=e}))}t.composeQuotedMsg===this&&(t.composeQuotedMsg=null)}}isLastMessage(){const e=this.chat.msgs.last();return this.id.equals(null==e?void 0:e.id)}quotedMsgObj(){if(!this.quotedMsg&&!this.paymentRequestMessageKey)return null;if(this._quotedMsgObj){const e=this.getCollection();return $.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}if(this.quotedMsg)this._quotedMsgObj=this._getQuotedMsgObj();else{if(!this.paymentRequestMessageKey)return null;this._quotedMsgObj=this._getQuotedPaymentRequestMsg()}const e=this.getCollection();return $.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}_getQuotedMsgObj(){const e=(0,w.getMaybeMeUser)(),t=!this.quotedParticipant||le.default.equals(this.quotedParticipant,e),r=t?"out":"in",n=this.quotedRemoteJid?this.quotedRemoteJid:this.id.remote,i={id:this.quotedStanzaID,from:t?e:n,to:t?n:e,self:r,author:(0,p.default)(this.quotedParticipant,"this.quotedParticipant"),remote:n};return!(le.default.isGroup(i.from)||le.default.isGroup(i.to))&&!le.default.isStatusV3(n)||le.default.equals(e,this.quotedParticipant)&&!N.GK.supportsFeature(N.GK.F.MD_BACKEND)||(i.participant=(0,p.default)(this.quotedParticipant,"this.quotedParticipant")),Object.assign(i,this.quotedMsg),$.createQuotedMsg(i)}_getQuotedPaymentRequestMsg(){if(!this.paymentRequestMessageKey)return null;const e=this.paymentRequestMessageKey.remote?this.paymentRequestMessageKey.remote:this.id.remote,t=this.paymentRequestMessageKey.fromMe,r=null!=this.paymentRequestMessageKey.self?this.paymentRequestMessageKey.self:t?"out":"in",n=this.paymentRequestMessageKey.participant||this.paymentMessageReceiverJid,i={id:this.paymentRequestMessageKey.id,from:t?(0,w.getMaybeMeUser)():e,to:t?e:(0,w.getMaybeMeUser)(),self:r,participant:n,author:n,remote:e,amount1000:this.paymentAmount1000,currency:this.paymentCurrency,receiverJid:this.sender,type:this.type,subtype:"request"};return $.createQuotedMsg(i)}getQuotedMsgAdminGroupJid(){return null==this.quotedMsg?this.quotedRemoteJid:null}getQuotedMsgAdminGroupSubject(){return null==this.quotedMsg?this.quotedGroupSubject:null}getQuotedMsgAdminParentGroupJid(){return null==this.quotedMsg?this.quotedParentGroupJid:null}msgContextInfo(e){const t=(0,o.default)(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","quotedMsg","quotedStanzaID","quotedRemoteJid","quotedParticipant","senderObj","multicast","replyButtons","buttons"]);let r=null;return e&&!this.id.remote.equals(e)&&(r=this.id.remote),{quotedMsg:t,quotedParticipant:this.sender,quotedStanzaID:this.id.id,quotedRemoteJid:r}}displayName(e,t){if(!this.sender)return"";if(this.sender.equals((0,w.getMaybeMeUser)()))return U.default.t(1911);const r=this.senderObj,n=e?r.shortName:void 0;if(n)return n;if(r.name)return r.name;{const e=t&&this.notifyName?" ~"+this.notifyName:"";return(0,ce.default)(this.sender)+e}}isQuoted(e){const t=this.quotedMsgObj();return!!t&&t.sender.equals(e)}isMentioned(e){return!!this.mentionedJidList&&this.mentionedJidList.findIndex((t=>t.equals(e)))>-1}mentionMap(){if(!this.mentionedJidList)return null;if(!this.mentionedJidList.length)return null;const e={};return this.mentionedJidList.forEach((t=>{e[`@${le.default.user(t)||""}`]=T.ContactCollection.gadd(t)})),e}updateAck(e,t){const r=this.ack;N.GK.supportsFeature(N.GK.F.MD_BACKEND)&&!this.isStatusV3&&this.chat.isGroup&&this.isMdHistoryMsg&&e>=v.default.ACK.RECEIVED&&this.id.fromMe||((0,te.isNumber)(e)&&(void 0===r||e>r||e===v.default.ACK.FAILED)?(this.ack=e,e>=1&&null!=t&&null==this.ephemeralStartTimestamp&&this.updateEphemeralStartTimestamp(t),"ephemeral_setting"===this.subtype&&1===e&&null!=t&&(0,P.updateEphemeralSettingTimestamp)(this.chat,t),this._pendingAckUpdate.enqueue((()=>(0,ne.updateLocal)(this.id,{ack:e})))):e===v.default.ACK.FAILED&&this.ack===v.default.ACK.CLOCK&&(this.ack=v.default.ACK.FAILED,this.phoneUploading=!1,this._pendingAckUpdate.enqueue((()=>(0,ne.updateLocal)(this.id,{ack:e})))))}updateLastPlaybackProgress(e){this.lastPlaybackProgress=e,this._saveLastPlaybackProgress(this.id,e)}avParams(){return Y.mediaMetadata(this)}resend(){var e=this;if(this.isFailed){const t={ack:v.default.ACK.CLOCK};return N.GK.supportsFeature(N.GK.F.MD_BACKEND)&&(t.isSendFailure=!1,t.mdDowngrade=!1),this._pendingAckUpdate.enqueue((0,a.default)((function*(){yield(0,ne.updateLocal)(e.id,t),e.set(t)}))),this.asMms?this.isSentByMeFromWeb?this.resumeUpload():this.resumeRemoteUpload():(0,X.sendMsgRecord)(this)}return Promise.resolve()}onCiphertextDecrypted(){if(this.isStatusV3)return;const e=this.chat,t=e.msgs.length,r=e.msgs.indexOf(this);-1!==r&&t-r<=10&&E.Cmd.alertNewMsg(this)}onViewOnceMediaStatusChanged(){if(!this.isViewOnce)return;if(null==this.mediaData)return;const e=this.isSentByMe&&this.ack>=v.default.ACK.SENT&&this.mediaData.mediaStage===W.MEDIA_DATA_STAGE.RESOLVED,t=!this.isSentByMe&&this.ack>=v.default.ACK.PLAYED;(e||t)&&(this.stopListening(this,"change:ack",this.onViewOnceMediaStatusChanged),this.stopListening(this.mediaData,"change:mediaStage",this.onViewOnceMediaStatusChanged),Y.deregisterMsg(this))}_canRevoke(){return this.isUserCreatedType&&(!le.default.isBroadcast(this.id.remote)||"iphone"===S.Conn.platform)&&!this.broadcast&&!this.isUnsentPhoneMsg()&&!this.isUnsentMedia&&!this.chat.isSuspendedGroup()}canSenderRevoke(){const e=(0,B.isNoDeleteMessageTimeLimitEnabled)()?v.default.REVOKE_WINDOW_V2:v.default.REVOKE_WINDOW,t=Math.trunc(+new Date/1e3)-this.t<=e;return this._canRevoke()&&this.id.fromMe&&t}canAdminRevoke(){var e;const t=Math.trunc(+new Date/1e3)-this.t<=v.default.REVOKE_WINDOW_V2;return(0,L.adminRevokeSenderEnabled)()&&this._canRevoke()&&Boolean(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmAdmin())&&t}getWamDisappearingModeInitiator(){const e=this.disappearingModeInitiator;if(null==e)return null;switch(e){case A.DisappearingModeInitiator.InitiatedByMe:return H.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_ME;case A.DisappearingModeInitiator.InitiatedByOther:return H.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_OTHER;case A.DisappearingModeInitiator.ChangedInChat:return H.default.DISAPPEARING_CHAT_INITIATOR_TYPE.CHAT}}getWamMessageType(){return this.isStatusV3?H.default.MESSAGE_TYPE.STATUS:this.isGroupMsg?H.default.MESSAGE_TYPE.GROUP:le.default.isBroadcast(this.id.remote)?H.default.MESSAGE_TYPE.BROADCAST:H.default.MESSAGE_TYPE.INDIVIDUAL}getWamMediaType(){var e,t;if(!0===this.isDynamicReplyButtonsMsg)return H.default.MEDIA_TYPE.BUTTON_MESSAGE;switch(this.type){case de.IMAGE:return H.default.MEDIA_TYPE.PHOTO;case de.VIDEO:return this.mediaData.isGif?H.default.MEDIA_TYPE.GIF:H.default.MEDIA_TYPE.VIDEO;case de.AUDIO:return H.default.MEDIA_TYPE.AUDIO;case de.PTT:return H.default.MEDIA_TYPE.PTT;case de.DOCUMENT:return H.default.MEDIA_TYPE.DOCUMENT;case de.UNKNOWN:return H.default.MEDIA_TYPE.FUTURE;case de.LOCATION:return this.isLive?H.default.MEDIA_TYPE.LIVE_LOCATION:H.default.MEDIA_TYPE.LOCATION;case de.VCARD:return H.default.MEDIA_TYPE.CONTACT;case de.MULTI_VCARD:return H.default.MEDIA_TYPE.CONTACT_ARRAY;case de.CHAT:return this.linkPreview?(0,J.matchCatalogUrl)(this.matchedText)?H.default.MEDIA_TYPE.CATALOG_LINK:(0,J.matchProductUrl)(this.matchedText)?H.default.MEDIA_TYPE.PRODUCT_LINK:H.default.MEDIA_TYPE.URL:H.default.MEDIA_TYPE.NONE;case de.STICKER:return H.default.MEDIA_TYPE.STICKER;case de.PRODUCT:return H.default.MEDIA_TYPE.PRODUCT_IMAGE;case de.LIST:switch(null!==(e=null===(t=this.list)||void 0===t?void 0:t.listType)&&void 0!==e?e:C.ListMessageListType.UNKNOWN){case C.ListMessageListType.SINGLE_SELECT:return H.default.MEDIA_TYPE.LIST;case C.ListMessageListType.PRODUCT_LIST:return H.default.MEDIA_TYPE.PRODUCT_LIST;default:return H.default.MEDIA_TYPE.NONE}case de.LIST_RESPONSE:return H.default.MEDIA_TYPE.LIST_REPLY;case de.BUTTONS_RESPONSE:return H.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case de.ORDER:return H.default.MEDIA_TYPE.ORDER;case de.INTERACTIVE:return(0,D.default)(this.interactiveType);case de.REACTION:return H.default.MEDIA_TYPE.REACTION;default:return H.default.MEDIA_TYPE.NONE}}getForwardingScoreWhenForwarded(){const e=this.numTimesForwarded+(this.id.fromMe?0:1);return e>=ee.ServerProps.frequentlyForwardedThreshold?v.default.FREQUENTLY_FORWARDED_SENTINEL:e}updateEphemeralStartTimestamp(e){var t=this;return(0,a.default)((function*(){yield(0,ne.updateLocal)(t.id,{ephemeralStartTimestamp:e}),t.ephemeralStartTimestamp=e}))()}isExpired(){return null!=this.ephemeralExpirationTimestamp&&this.ephemeralExpirationTimestamp<=y.Clock.globalUnixTime()}timeUntilExpiration(){const e=this.ephemeralExpirationTimestamp;return null==e?null:this.isExpired()?0:e-y.Clock.globalUnixTime()}_logStorageEstimate(e){return(0,a.default)((function*(){const t=yield(0,M.default)();t&&(e.webcBrowserStorageQuotaBytes=t.quota,e.webcBrowserStorageQuotaUsedBytes=t.usage)}))()}getCollection(){return r(59871).MsgCollection}_getChatCollection(){return r(69951).ChatCollection}isDownloadable(){var e;return!this.asRevoked&&(!this.isViewOnce&&(this.type===v.default.MSG_TYPE.VCARD||this.type===v.default.MSG_TYPE.MULTI_VCARD||!!(null===(e=this.mediaData)||void 0===e?void 0:e.isDownloadable())&&this.type!==v.default.MSG_TYPE.STICKER))}safe(){return this}unsafe(){return this}}t.MsgImpl=ue,ue.Proxy="msg",ue.idClass=V.default;const pe=(0,m.defineModel)(ue);t.Msg=pe},52846:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(11290),a=n(r(32219));class s extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.unsyncedButtonReplies=(0,i.prop)()}}s.Proxy="msgButtonReplyMsg",s.idClass=a.default;var o=(0,i.defineModel)(s);t.default=o},81037:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1255),a=n(r(52846));class s extends i.BaseCollection{}t.default=s,s.model=a.default},59871:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgCollectionImpl=t.MsgCollection=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(50796),o=n(r(45095)),l=r(67602),c=r(29984),d=r(1255),u=n(r(69618)),p=r(24808),h=r(76581),f=r(99234),_=r(7293),m=r(17304),g=n(r(81037)),y=n(r(32219)),E=r(17780),S=n(r(86500)),v=r(31515),T=n(r(17072)),A=n(r(56891)),C=r(77591),b=n(r(39546)),P=r(58021),M=r(65044);class O extends d.BaseCollection{constructor(){super(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.productListMessagesPrefetchChain=Promise.resolve([]),this.onSearchTag=e=>{this.pendingSearchTag=e},this.listenTo(M.Socket,"change:stream",(function(){M.Socket.stream===M.STREAM.DISCONNECTED&&(this.preAck={})})),this.listenTo(this,"remove",this.removeFromCollection)}removeFromCollection(e){e.chat&&e.chat.removeFromCollection(e)}_findQuery(e,t){var n=this;return(0,a.default)((function*(){const i=n;let a;switch(e.direction){case"before":case"after":a=e.direction;break;default:a="before"}const s={add:a,isHistory:!0},o=yield(0,h.msgFindQuery)(a,e,t,void 0);return o.status>=400?(__LOG__(3)`model:Msg:findQuery error ${o.status}`,Promise.reject(o.status)):(o.forEach((function(e){e.invis=!0})),__LOG__(2)`model:Msg:findQuery:got:${o.length}:${e.direction}`,i.processMultipleMessages(e.remote,o,s,(function(){const t=i.get(e),n=r(69951).ChatCollection.get(e.remote);return t?t.msgChunk:n?n.msgs:void 0})))}))()}add(e,t){const r=(Array.isArray(e)?e:[e]).filter((e=>{if(null==e.ephemeralDuration||0===e.ephemeralDuration)return!0;return!new m.Msg(e).isExpired()})),n=super.add(r,t);return this._syncTemplateButtonClickState(n),this._syncQuickReplyButtonClickState(n),this._prefetchProductListMessages(n),n}_prefetchProductListMessages(e){const t=r(18952).ProductMessageListCollection;this.productListMessagesPrefetchChain=e.filter((e=>{var t,r;return null!=e&&e.isNewMsg&&e.type===u.default.MSG_TYPE.LIST&&(null===(t=e.list)||void 0===t?void 0:t.listType)===p.ListMessageListType.PRODUCT_LIST&&null!=(null===(r=e.list)||void 0===r?void 0:r.productListInfo)})).reduce(((e,r)=>{var n,i;if(null==r)return e;const a=r.requiresDirectConnection,s=r.isForwarded?r.businessOwnerJid:r.from.toString({legacy:!0}),o=null===(n=r.list)||void 0===n?void 0:n.productListInfo;if(null==s||null==o)return e;const l=t.getOrAdd(r.id,o,a,s,null===(i=r.list)||void 0===i?void 0:i.title);return null==l||0!==l.productCollection.getModelsArray().length||l.isFetching()?e:e.then((()=>t.update(l.id)))}),this.productListMessagesPrefetchChain)}_syncTemplateButtonClickState(e){for(let t=0;t<e.length;t++){const r=e[t];if(!r)continue;const n=r.chat;if(r.type===u.default.MSG_TYPE.TEMPLATE_BUTTON_REPLY&&null!=r.selectedIndex&&r.sender.equals((0,f.getMaybeMeUser)())){null==n.msgUnsyncedButtonReplyMsgs&&(n.msgUnsyncedButtonReplyMsgs=new g.default);const{msgUnsyncedButtonReplyMsgs:e}=n,t=r.quotedMsgObj();if(!t)continue;let i=e.get(t.id);i||(e.add({id:t.id,unsyncedButtonReplies:new S.default}),i=e.get(t.id));const{unsyncedButtonReplies:a}=(0,o.default)(i,"buttonReplyMsg");a.add(r);const s=this.get(t.id);if(null==s?void 0:s.buttons){const e=s.buttons.get(`${(0,o.default)(r.selectedIndex,"msg.selectedIndex")}`);e&&(e.selected=!0),a.remove(r)}}else if(r.isFromTemplate&&r.buttons){const{msgUnsyncedButtonReplyMsgs:e}=n;if(null==e)continue;const t=e.get(r.id);t&&(t.unsyncedButtonReplies.forEach((e=>{const t=(0,o.default)(r.buttons,"msg.buttons").get(`${(0,o.default)(e.selectedIndex,"replyMsg.selectedIndex")}`);t&&(t.selected=!0)})),t.unsyncedButtonReplies.delete())}}}_syncQuickReplyButtonClickState(e){for(let t=0;t<e.length;t++){const r=e[t];if(r)if(r.type===u.default.MSG_TYPE.BUTTONS_RESPONSE&&null!=r.selectedButtonId&&r.sender.equals((0,f.getMaybeMeUser)())){const e=r.quotedMsgObj();if(!e)continue;const t=this.get(e.id);if(null==t?void 0:t.replyButtons){const e=t.replyButtons.get(r.selectedButtonId);e&&(e.selected=!0)}}else if(r.isDynamicReplyButtonsMsg&&r.replyButtons&&r.replyButtons.every((e=>!e.selected))&&r.chat){const e=Math.max(0,r.chat.msgs.models.length-1e3);r.chat.msgs.getModelsArray().slice(e).filter((e=>{var t;return e.type===u.default.MSG_TYPE.BUTTONS_RESPONSE&&null!=e.selectedButtonId&&e.sender.equals((0,f.getMaybeMeUser)())&&(null===(t=e.quotedMsgObj())||void 0===t?void 0:t.id.toString())===r.id.toString()})).map((e=>{let{selectedButtonId:t}=e;return t})).forEach((e=>{var t;const n=null===(t=r.replyButtons)||void 0===t?void 0:t.get(e);null!=n&&(n.selected=!0)}))}}}getStarred(e,t,r,n){var i=this;return(0,a.default)((function*(){const a={count:"number"!=typeof t||isNaN(t)?u.default.PAGE_SIZE:t,chat:e||void 0,remote:null==r?void 0:r.remote,id:null==r?void 0:r.id,fromMe:null==r?void 0:r.fromMe,participant:null==r?void 0:r.participant,media:n?"gif":void 0},s=yield(0,h.msgFindQuery)("star",a),o=s.status;return s.status>=400?(499===o?__LOG__(2)`model:Msg:getStarred error 499 (unimplemented)`:__LOG__(3)`model:Msg:getStarred error ${o}`,Promise.reject(o)):i.processMultipleMessages(void 0,s,{add:"search"})}))()}getMessagesById(e){var t=this;return(0,a.default)((function*(){const r=yield(0,h.msgFindByIds)(e);return(0,l.promiseProps)({messages:t.processMultipleMessages(void 0,r,{add:"search"}),eof:!0,canceled:!1})}))()}queryVcard(e){var t=this;return(0,a.default)((function*(){const r=yield(0,h.queryVcard)(e);return 499===r.status?(__LOG__(2)`model:Msg:queryVcard error 499 (unimplemented)`,Promise.reject(new C.E499)):t.processMultipleMessages(void 0,r,{add:"search"})}))()}incrementalStarredUpdate(e){return this.processMultipleMessages(void 0,e,{add:"search"})}search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a=`${e}__${i.label||i.kind||""}`;if(1!==t||n)return this._search(e,t,r,n,i.label,i.kind);{const s=this.ftsCache[a];if(s)return s;{const s=this._search(e,t,r,n,i.label,i.kind);this.ftsCache[a]=s;const o=()=>{this.ftsCache[a]=null};return setTimeout(o,u.default.FTS_TTL),s.catch(o),s}}}_search(e,t,r,n,i,s){var o=this;return(0,a.default)((function*(){const a={searchTerm:e,page:(0,v.isNumber)(t)&&0!==t?t:1,count:(0,v.isNumber)(r)&&0!==r?r:u.default.PAGE_SIZE,remote:n,tagToCancel:n?o.pendingSearchTag:void 0,label:i,kind:s},c=yield(0,h.msgFindQuery)("search",a,void 0,o.onSearchTag);if(a.tagToCancel===o.pendingSearchTag&&(o.pendingSearchTag=void 0),499===c.status)return(0,l.promiseProps)({messages:Promise.resolve([]),eof:!1,canceled:!0});if(404===c.status)return Promise.reject(new C.E404);if(c.status>=400)return __LOG__(3)`model:Msg:search error ${c.status}`,Promise.reject(new C.ServerStatusCodeError(c.status,"failed to find a msg during fts"));{const e=Array.isArray(c)?c:c.messages,t=!!Array.isArray(c)||c.eof;return(0,l.promiseProps)({messages:o.processMultipleMessages(void 0,e,{add:"search"}),eof:t,canceled:!1})}}))()}queryMedia(e,t,r,n,i){var s=this;return(0,a.default)((function*(){const a={remote:e,count:(0,v.isNumber)(t)&&0!==t?t:u.default.PAGE_SIZE,id:null==n?void 0:n.id,fromMe:null==n?void 0:n.fromMe,participant:null==n?void 0:n.participant,direction:r||"before",media:i},o=yield(0,h.msgFindQuery)("media",a);return o.status>=400?(__LOG__(3)`model:Msg:media error ${o.status}`,404===o.status?Promise.reject(new C.E404):Promise.reject(new C.ServerStatusCodeError(o.status,"failed to find a msg during media query"))):i?s.processMultipleMessages(void 0,o,{add:"search"}):(0,l.promiseProps)({docCount:o.docCount,linkCount:o.linkCount,mediaCount:o.mediaCount,messages:s.processMultipleMessages(void 0,o.messages,{add:"search"})})}))()}getContext(e,t,r){const n=this.get(e);if(n)return Promise.all([(0,h.msgFindQuery)("before",e,r),(0,h.msgFindQuery)("after",e,r)]).then((r=>{let[i,a]=r;if(!Array.isArray(i)||!Array.isArray(a))throw __LOG__(3)`model:msg:getContext fetch error`,i.status||a.status;return n.search=!1,Promise.all([this.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),this.processMultipleMessages(e.remote,a,{add:"after",isHistory:!0},t)])}));{const n={add:"after",isHistory:!0};return(0,h.msgFindQuery)("after",e,r).then((r=>{if(!Array.isArray(r))throw __LOG__(3)`model:msg:getContext:after fetch error`,r.status;if(b.default.isStatusV3(r[0].id.remote))throw new Error("statusV3, stop querying before the msg");return this.processMultipleMessages(e.remote,r,n,t)})).then((t=>{const n=(0,o.default)(t[0],"after[0]"),i=n.id.clone();i.count=e.count+1;const a={add:"before",isHistory:!0};return Promise.all([(0,h.msgFindQuery)("before",i,r).then((t=>{if(!Array.isArray(t))throw __LOG__(3)`model:msg:getContext:before fetch error`,t.status;if(!t[t.length-1].id.equals(e))throw __LOG__(3)`model:msg:getContext:before ctx message mismatch`,405;return this.processMultipleMessages(e.remote,t,a,(function(){return n.msgChunk}))})),Promise.resolve(t)])}))}}hasSynced(){return(0,T.default)(this,u.default.COLLECTION_HAS_SYNCED)}delete(){super.delete(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={}}getKeysForResyncReceipts(){const e=[],t=(0,i.default)((0,i.default)({},this.lastReceivedReceipt),this.lastReceivedPaymentTransaction);for(const n in t){const t=(0,P.createWid)(n),i=r(69951).ChatCollection.get(t);let a;if(i&&(a=i.getFirstMsgWithStatus()),a){const r=a.id;r.t=this.lastReceivedReceipt[t]||a.t||0,r.payT=this.lastReceivedPaymentTransaction[t],e.push(r)}else __LOG__(3)`Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: ${t.toString()}`}return e}resyncReceipts(){__LOG__(2)`Msg:resyncReceipts`;const e=this.getKeysForResyncReceipts();return 0===e.length?Promise.resolve():_.GK.supportsFeature(_.GK.F.MD_BACKEND)?Promise.reject(new Error("This call is only supported in non-MD mode")):A.default.resyncReceipts(e).then((e=>{Array.isArray(e)?(__LOG__(2)`Msg:resyncReceipts success`,e.forEach((e=>{this.updateLastReceipt(e.id,e.t),this.updateLastTransactionTime(e.id,e.payT),e.acks.forEach((t=>{const{id:r,fromMe:n,participant:i,status:a,t:s}=t;if(null!=r&&null!=n&&null!=a){const t=new y.default({fromMe:n,remote:e.id,id:r,participant:i}),o=this.get(t);o&&(o.isEphemeral&&s?o.updateEphemeralStartTimestamp(s):o.updateAck(a))}else __LOG__(3)`Msg:resyncReceipts invalid response: ${JSON.stringify(t)}`})),e.msgs.length>0&&this.processMultipleMessages(e.id,e.msgs,{update:!0,isHistory:!1}).catch((0,s.filteredCatch)(C.LogoutDrop,(()=>{})))}))):__LOG__(3)`Msg:resyncReceipts error`})).catch((0,s.filteredCatch)([C.LogoutDrop,C.EphemeralDrop,C.BrowserReplacedDrop],(()=>{}))).catch((e=>{throw __LOG__(3)`Msg:resyncReceipts dropped ${String(e)} ${e?e.stack:"no stack"}`,new Error("Msg:resyncReceipts dropped")}))}updateLastReceipt(e,t){const r=this.lastReceivedReceipt[e];(0,c.isNonZeroNumber)(t)&&(!r||t>r)&&(this.lastReceivedReceipt[e]=t)}updateLastTransactionTime(e,t){const r=this.lastReceivedPaymentTransaction[e];t&&(!r||t>r)&&(this.lastReceivedPaymentTransaction[e]=t)}processMultipleMessages(e,t,r,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=()=>(0,E._processMultipleMessages)(e,t,r,n);if(e){let t;const r=this.pendingAdd[e];return t=r&&i?r.then(a):a(),t.finally((()=>{e&&this.pendingAdd[e]===t&&(this.pendingAdd[e]=null)})).catch((()=>{})),this.pendingAdd[e]=t}return a()}markAllAsStale(){this.forEach((e=>e.unset("recvFresh")))}}t.MsgCollectionImpl=O,O.model=m.Msg;const I=new O;t.MsgCollection=I},54311:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantCollection=t.MsgInfoParticipant=t.MsgInfo=void 0;var i=r(11290),a=n(r(31727)),s=r(19380),o=r(47969),l=n(r(32219)),c=n(r(39546));class d extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.t=(0,i.prop)(),this.contact=(0,i.session)()}initialize(){super.initialize(),this.addChild("contact",s.ContactCollection.gadd(this.id))}}d.Proxy="msgInfoParticipant",d.idClass=c.default;const u=(0,i.defineModel)(d);t.MsgInfoParticipant=u;class p extends a.default{}t.ParticipantCollection=p,p.model=u,p.comparator=(e,t)=>(0,o.ContactComparator)(e.contact,t.contact);class h extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.usePlayReceipt=(0,i.prop)(),this.playedRemaining=(0,i.prop)(0),this.readRemaining=(0,i.prop)(0),this.deliveryRemaining=(0,i.prop)(0),this.deliveryPrivacyMode=(0,i.prop)(),this.played=(0,i.collection)(p),this.read=(0,i.collection)(p),this.delivery=(0,i.collection)(p),this.settled=(0,i.derived)(this._settled,["usePlayReceipt","playedRemaining","readRemaining"])}_settled(){return this.usePlayReceipt?!this.playedRemaining:!this.readRemaining}getCollection(){return r(17972).MsgInfoCollection}}h.Proxy="msgInfo",h.idClass=l.default;const f=(0,i.defineModel)(h);t.MsgInfo=f},17972:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoCollectionImpl=t.MsgInfoCollection=void 0;var i=r(1255),a=r(54311),s=r(28259),o=r(52821),l=n(r(32219)),c=r(65044);class d extends i.BaseCollection{_initializeStaleCollection(){this.listenTo(c.Socket,"change:stream",(()=>{c.Socket.stream===c.STREAM.DISCONNECTED&&this.forEach((e=>{e.settled||e.set("stale",!0)}))}))}_find(e){const t=r(59871).MsgCollection.get(e);return t?t.isSentByMe?(0,s.sendQueryMsgInfo)(t):Promise.reject(new i.CollectionSilentQueryError("message not sent by me")):Promise.reject(new i.CollectionSilentQueryError(`No message found for id: ${e}`))}updateInfo(e,t,r,n,i,a){const s=new l.default({from:t,to:r,id:e,participant:i}),c=new l.default({from:t,to:r,id:e}),d=this.get(s)||this.get(c);if(d)return(0,o.updateMsgInfo)(d,n,i,a)}}t.MsgInfoCollectionImpl=d,d.model=a.MsgInfo,d.staleCollection=!0;const u=new d;t.MsgInfoCollection=u},54676:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addRecordsToChat=T,t.broadcastFanout=function(e){let t;if(!e.invis){const n=v(e);n&&(t=n.map((e=>e.remote)),n.forEach((t=>{const n=r(59871).MsgCollection;if(!n.some((0,s.default)({id:t}))){const i=P(e);i.to=t.remote,i.id=t,i.broadcast=!0;const a=n.add(i,{merge:!0});(0,r(50101).findChat)(t.remote).then((function(e){a.forEach((t=>{if(t.type!==l.default.MSG_TYPE.PROTOCOL){e.isEphemeralSettingOn()&&(t.ephemeralDuration=e.getEphemeralSetting());const r=e.getEphemeralSettingTimestamp();null!=r&&(t.ephemeralSettingTimestamp=r);const n=e.getDisappearingModeInitiator();null!=n&&(t.disappearingModeInitiator=n)}})),T(a,e,!0)}))}})))}return t},t.createQuotedMsg=function(e){if(!e)return null;const t=new _.default({from:e.from,to:e.to,id:e.id,participant:e.participant,selfDir:e.self});e.id=t;return new(0,r(17304).Msg)(e).safe()},t.eventTypeFromMsgType=function(e){const t=e.type,r=e.subtype,n=(0,d.getMaybeMeUser)();let i;i=t===l.default.MSG_TYPE.GP2||t===l.default.MSG_TYPE.GROUP_NOTIFICATION?"subject"===r?"n":"add"===r||"invite"===r?e.recipients&&y.default.equals(e.recipients[0],n)?"s":"i":"remove"===r?e.recipients&&y.default.equals(e.recipients[0],n)?"n":"i":"create"===r?"n":"i":t===l.default.MSG_TYPE.BROADCAST_NOTIFICATION||t===l.default.MSG_TYPE.NOTIFICATION||t===l.default.MSG_TYPE.E2E_NOTIFICATION?"create"===r?"n":"i":t===l.default.MSG_TYPE.GROUPS_V4_INVITE&&e.from.equals(n)?"i":t===l.default.MSG_TYPE.CALL_LOG?"n":e.broadcast?y.default.isBroadcast(e.id.remote)?"n":"i":t===l.default.MSG_TYPE.REVOKED?"i":y.default.isPSA(e.id.remote)?e.ack===l.default.ACK.RECEIVED?"d":"a":t===l.default.MSG_TYPE.CIPHERTEXT||t===l.default.MSG_TYPE.OVERSIZED?"a":t===l.default.MSG_TYPE.NOTIFICATION_TEMPLATE||t===l.default.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===r||t===l.default.MSG_TYPE.UNKNOWN&&"reaction"===r||t===l.default.MSG_TYPE.REACTION?"i":"d";return i},t.getBroadcastFanoutKeys=v,t.getOriginalQuotedMsgIfPossible=function(e,t){var r;if(!e)return e;const n=null===(r=t.get(e.id))||void 0===r?void 0:r.safe();return n&&!n.asRevoked?n:e},t.hasMentionOfMe=E,t.isImportantMessage=function(e){return E(e)||S(e)},t.isNotification=function(e,t){switch(e){case l.default.MSG_TYPE.GROUP_NOTIFICATION:case l.default.MSG_TYPE.GP2:case l.default.MSG_TYPE.BROADCAST_NOTIFICATION:case l.default.MSG_TYPE.NOTIFICATION:case l.default.MSG_TYPE.NOTIFICATION_TEMPLATE:case l.default.MSG_TYPE.E2E_NOTIFICATION:case l.default.MSG_TYPE.CALL_LOG:return!0;case l.default.MSG_TYPE.PROTOCOL:return"ephemeral_setting"===t;default:return!1}},t.listMsgCanRender=function(e){var t;return(null===(t=e.list)||void 0===t?void 0:t.listType)!==c.ListMessageListType.PRODUCT_LIST||(0,u.productListMessagesEnabled)()&&!m.ServerProps.webProductListMessageRenderKillSwitch},t.msgMatchesType=function(e,t){switch(t){case"text":return e.type===l.default.MSG_TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===l.default.MSG_TYPE.IMAGE;case"video":return e.type===l.default.MSG_TYPE.VIDEO&&!e.isGif;case"gif":return e.type===l.default.MSG_TYPE.VIDEO&&e.isGif;case"audio":return e.type===l.default.MSG_TYPE.AUDIO;case"ptt":return e.type===l.default.MSG_TYPE.PTT;case"document":return e.type===l.default.MSG_TYPE.DOCUMENT;case"location":return e.type===l.default.MSG_TYPE.LOCATION;case"vcard":return e.type===l.default.MSG_TYPE.VCARD||e.type===l.default.MSG_TYPE.MULTI_VCARD;case"url":return e.type===l.default.MSG_TYPE.CHAT&&"url"===e.subtype;case"sticker":return e.type===l.default.MSG_TYPE.STICKER;case void 0:default:return!1}},t.repliedToMyMessage=S,t.typeIsMms=function(e){var t;switch(e.type){case"image":case"video":case"audio":case"ptt":case"sticker":case"document":case"product":return!0;case"protocol":return"history_sync_notification"===e.subtype;case l.default.MSG_TYPE.NATIVE_FLOW:return e.headerType===c.ButtonsMessageHeaderType.IMAGE;case l.default.MSG_TYPE.INTERACTIVE:return Boolean((null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType)&&p.IM_MEDIA_HEADER_TYPES.has(e.interactiveHeader.mediaType));default:return!1}},t.typeIsUrl=function(e){return e.type===l.default.MSG_TYPE.CHAT&&"url"===e.subtype};var i=n(r(48926)),a=n(r(30988)),s=n(r(6410)),o=n(r(35161)),l=n(r(69618)),c=r(24808),d=r(99234),u=r(57701),p=r(34535),h=n(r(78144)),f=r(11902),_=n(r(32219)),m=r(64551),g=r(77591),y=n(r(39546));function E(e){const t=(0,d.getMaybeMeUser)();return!!(null==e?void 0:e.mentionedJidList)&&e.mentionedJidList.some((e=>t.user===e.user&&t.server===e.server))}function S(e){const t=(0,d.getMaybeMeUser)();return!(!t||!e)&&(!(!e.quotedMsg||!e.quotedParticipant)&&t.equals(e.quotedParticipant))}function v(e){var t;let n,i,a;if(e instanceof r(17304).Msg)i=e,a=e.id;else{if(!(e instanceof _.default))return void __LOG__(3)`model:msgs:broadcastFanout: unknown msgOrKey: ${String(e)}`;a=e}if(!y.default.isStatusV3(a.remote)){if((null===(t=i)||void 0===t?void 0:t.recipients)&&0!==i.recipients.length)n=i.recipients;else{const e=r(63928).default.get(a.remote);e?n=(0,o.default)(P(e.participants),"id"):__LOG__(2)`model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: ${a.remote.toString()}`}return n?n.map((e=>new _.default({fromMe:a.fromMe,remote:e,id:a.id}))):void 0}}function T(e,t,n,i,a,s){const o=i||t.msgs;if(0===e.length)return;let l=o===t.msgs;if(s)if(l)__LOG__(2)`models:msg:store:resetMostRecentMsgs .msgs === cmc !`,A(t,o,e);else{l=!0;A(t,o,e).then((()=>{const e=new(0,r(51612).ChatMsgsCollection);e.replace(t.msgs),t.msgChunks.push(e),t.replaceMsgsCollection(o),t.msgs.trigger("change:last",t.msgs.last())}))}else n?l?A(t,o,e):b(o,e):b(o,e,{at:0,silent:e.every(M)});const c=r(59871).MsgCollection;if(n&&l||!c.lastReceivedReceipt[t.id]){for(let t=e.length-1;t>=0;t--){const r=e[t],n=r.id;if(n.fromMe&&!r.isNotification){c.updateLastReceipt(n.remote,r.t);break}}}if(n&&l||!c.lastReceivedPaymentTransaction[t.id]){for(let t=e.length-1;t>=0;t--){const r=e[t],n=r.id;r.paymentTransactionTimestamp&&c.updateLastTransactionTime(n.remote,r.paymentTransactionTimestamp)}}const d=a;d&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=e.find((function(e){return e.id.toString()===d.toString()})))}function A(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,r){const n=(0,a.default)(r,(e=>!!e));if(!n)return Promise.resolve();b(t,r),yield(0,f.setLastReceivedKey)(e.id,n.id),e.lastReceivedKey=n.id}))).apply(this,arguments)}function b(e,t,r){try{e.add(t,r)}catch(e){if(!(e instanceof g.LogoutDrop))throw e;__LOG__(3)`setRecords LogoutDrop: ${e.toString()}`}}function P(e){return null!=e&&"object"==typeof e?JSON.parse(JSON.stringify(e),h.default):e}function M(e){return"i"===e.eventType}},40214:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Mute=t.GLOBAL_REACTIONS_MUTE=t.GLOBAL_MUTE=void 0;var a=i(r(30381)),s=r(46331),o=i(r(15421)),l=r(11290),c=r(88102),d=n(r(64103)),u=i(r(43725)),p=r(45197),h=r(31515),f=i(r(39546)),_=r(85893);const m="global_mute";t.GLOBAL_MUTE=m;const g="global_reactions_mute";t.GLOBAL_REACTIONS_MUTE=g;class y extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.expiration=(0,l.prop)(0),this.callExpiration=(0,l.prop)(0),this._unmuteTimer=(0,l.session)(),this._unmuteCallTimer=(0,l.session)(),this.promises=(0,l.session)((function(){return{}})),this.isMuted=(0,l.derived)(this._isMuted,["expiration"]),this.isCallMuted=(0,l.derived)(this._isCallMuted,["callExpiration"])}_isMuted(){return!!this.expiration}_isCallMuted(){return!!this.callExpiration}initialize(){super.initialize(),null!=this.expiration&&0!==this.expiration&&this.mute(this.expiration),null!=this.callExpiration&&0!==this.callExpiration&&this.muteCall(this.callExpiration)}setMute(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))}mute(e,t,r){let n=e;if(!(0,h.isNumber)(n))return __LOG__(2)`models:Mute:mute called with invalid expiration ${n}`,Promise.reject(new d.ActionError);n=Math.round(n),n>2e9&&__LOG__(2)`models:Mute:mute called with wrong units?${this.id.toString()} exp:${n}`;const i=()=>{if(this.isMuted&&(o.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer")),-1===n)__LOG__(2)`models:Mute:mute ${this.id.toString()} muted, no expiration`;else{const e=n-(0,a.default)().unix();__LOG__(2)`models:Mute:mute ${this.id.toString()} duration:${e}`,this._unmuteTimer=o.default.setGlobalTimeout(this.unmute.bind(this),1e3*n)}this.set({expiration:n})},l=f.default.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;const e=this.promises.mute=(0,p.sendConversationMute)(this.id,n,this.expiration),a=l?new s.ActionType(u.default.t(76)):new s.ActionType(u.default.t(39)),o=r||(0,s.genId)(),d=this.promises.mute.catch((()=>{__LOG__(3)`models:Mute:mute dropped`;const e=l?u.default.t(74):u.default.t(37);throw new s.ActionType(e,{actionText:u.default.t(139),actionHandler:this.mute.bind(this,n,t,o)})})).then((e=>{if(200===e.status){const e=l?u.default.t(75):u.default.t(38);return new s.ActionType(e,{actionText:u.default.t(143),actionHandler:this.unmute.bind(this,t,o)})}if(e.status>=400)throw l?new s.ActionType(u.default.t(74)):new s.ActionType(u.default.t(37))}));return c.Cmd.openToast((0,_.jsx)(s.ActionToast,{id:o,initialAction:a,pendingAction:d})),e.then((function(e){200!==e.status||e._duplicate||i()})).finally((()=>{this.promises.mute=null}))}return i(),Promise.resolve()}muteCall(e){let t=e;if(!(0,h.isNumber)(t))return __LOG__(2)`models:Mute:muteCall called with invalid expiration ${t}`,Promise.reject(new d.ActionError);if(t=Math.round(t),t>2e9&&__LOG__(2)`models:Mute:muteCall called with wrong units?${this.id.toString()} exp:${t}`,this.isCallMuted&&(o.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer")),-1===t)__LOG__(2)`models:Mute:muteCall ${this.id.toString()} muted, no expiration`;else{const e=t-(0,a.default)().unix();__LOG__(2)`models:Mute:muteCall ${this.id.toString()} duration:${e}`,this._unmuteCallTimer=o.default.setGlobalTimeout(this.unmuteCall.bind(this),1e3*t)}return this.set({callExpiration:t}),Promise.resolve()}canMute(){let e=!1;if(f.default.isGroup(this.id)){const t=r(63928).default.get(this.id);t&&(e=t.participants.iAmMember())}return e||f.default.isUser(this.id)}_clearUnmuteTimer(){o.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0}_clearUnmuteCallTimer(){o.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer"),this.callExpiration=0}unmute(e,t){const r=()=>{__LOG__(2)`models:Mute:unmute ${this.id.toString()}`,this._clearUnmuteTimer()},n=f.default.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;const i=this.promises.unmute=(0,p.sendConversationMute)(this.id,0,this.expiration),a=n?new s.ActionType(u.default.t(83)):new s.ActionType(u.default.t(50)),o=t||(0,s.genId)(),l=this.promises.unmute.catch((()=>{__LOG__(3)`models:Mute:unmute dropped`;const t=n?u.default.t(81):u.default.t(48);throw new s.ActionType(t,{actionText:u.default.t(139),actionHandler:this.unmute.bind(this,e,o)})})).then((e=>{if(200===e.status)return n?new s.ActionType(u.default.t(82)):new s.ActionType(u.default.t(49));if(e.status>=400)throw n?new s.ActionType(u.default.t(81)):new s.ActionType(u.default.t(48))}));return c.Cmd.openToast((0,_.jsx)(s.ActionToast,{id:o,initialAction:a,pendingAction:l})),i.then((function(e){200!==e.status||e._duplicate||r()})).finally((()=>{this.promises.unmute=null}))}return r(),Promise.resolve()}unmuteCall(){return __LOG__(2)`models:Mute:unmuteCall ${this.id.toString()}`,this._clearUnmuteCallTimer(),Promise.resolve()}delete(){super.delete(),this.getCollection().remove(this.id),this._clearUnmuteTimer()}getCollection(){return r(72472).MuteCollection}}y.Proxy="mute",y.idClass=f.default,y.allowedIds=[m,g];const E=(0,l.defineModel)(y);t.Mute=E},72472:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MuteCollectionImpl=t.MuteCollection=void 0;var n=r(1255),i=r(17239),a=r(99234),s=r(57701),o=r(40214);let l=!0,c=!0,d=!0,u=!0,p=!1,h=!1;class f extends n.BaseCollection{initializeFromCache(e){Array.isArray(e)?e.forEach((e=>{[o.GLOBAL_MUTE,o.GLOBAL_REACTIONS_MUTE].includes(e.id)&&this.add(e,{remove:!1})})):null!=e&&e.id===o.GLOBAL_MUTE&&this.add(e,{remove:!1}),this.setGlobalNotifications((0,a.getGlobalNotifications)()),this.setGlobalSounds((0,a.getGlobalSounds)()),this.setGlobalCallRingtone((0,a.getGlobalCallRingtone)()),this.setGlobalPreviews((0,a.getGlobalPreviews)()),this.setCollapseMuted((0,a.getCollapseMuted)()),this.setOutgoingMessageSound((0,a.getOutgoingMessageSound)())}saveToCache(){if(!i.Conn.shouldSaveToCache())return;const{id:e}=this.constructor.cachePolicy,t=[];__LOG__(2)`models:mute:cache-save: ${String(e)}`;const r=this.get(o.GLOBAL_MUTE),n=this.get(o.GLOBAL_REACTIONS_MUTE);r&&t.push(r.toJSON()),(0,s.receiveReactionsEnabled)()&&n&&t.push(n.toJSON()),t.length?(0,a.setCollection)(e,t):__LOG__(3)`models:mute:cache-save: globalMuteModel or globalReactionsMuteModel does not exist`}globalMute(){const e=this.get(o.GLOBAL_MUTE);return e||this.add({id:o.GLOBAL_MUTE})[0]}globalReactionsMute(){const e=this.get(o.GLOBAL_REACTIONS_MUTE);return e||this.add({id:o.GLOBAL_REACTIONS_MUTE})[0]}getGlobalSounds(){return l}setGlobalSounds(e){l=e,(0,a.setGlobalSounds)(e)}getGlobalCallRingtone(){return c}setGlobalCallRingtone(e){c=e,(0,a.setGlobalCallRingtone)(e)}getGlobalNotifications(){return d}setGlobalNotifications(e){d=e,(0,a.setGlobalNotifications)(e)}getGlobalPreviews(){return u}setGlobalPreviews(e){u=e,(0,a.setGlobalPreviews)(e)}getCollapseMuted(){return p}setCollapseMuted(e){p=e,(0,a.setCollapseMuted)(e),this.trigger("change:collapseMuted",p)}getOutgoingMessageSound(){return h}setOutgoingMessageSound(e){h=e,(0,a.setOutgoingMessageSound)(e)}handle(e){e.forEach((e=>{const t=r(69951).ChatCollection.get(e.id);t&&"mute"===e.type&&t.mute.setMute(e.muteExpiration)}))}}t.MuteCollectionImpl=f,f.model=o.Mute,f.cachePolicy={id:"mute",policy:n.CACHE_POLICY.LOAD,delay:1e3};const _=new f;t.MuteCollection=_},51783:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),s=r(89385),o=n(r(42341)),l=r(40265),c=r(50796),d=n(r(45095)),u=r(40277),p=r(37178),h=r(29984),f=n(r(70714)),_=r(77712),m=r(11290),g=r(17239),y=n(r(69618)),E=r(35118),S=n(r(18561)),v=r(99234),T=r(7293),A=n(r(43725)),C=n(r(11339)),b=r(64551),P=r(2541),M=r(77591);class O extends((0,l.customError)("NoticeJsonParseError")){}const I=["logout","refresh"],w=(0,p.createTimer)({algo:{type:"constant",delay:432e5}}),R=(0,p.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:18e6});class D extends m.BaseModel{constructor(){super(...arguments),this.id=(0,m.prop)(),this.noticeId=(0,m.prop)(),this.blocking=(0,m.prop)(),this.policyVersion=(0,m.prop)(),this.banner=(0,m.prop)(),this.blockingModal=(0,m.prop)(),this.shouldShowButterBar=(0,m.session)(!0),this.backgroundFetches=(0,m.session)()}initialize(){super.initialize(),this.fetchNoticeData=this.fetchNoticeData.bind(this),this.listenTo(A.default,"locale_change",this.fetchNoticeData)}dismissButterBarNotice(){0!==b.ServerProps.greenAlertBannerDuration&&(new C.default.UserNotice({userNoticeId:this.noticeId,userNoticeContentVersion:this.policyVersion,userNoticeEvent:C.default.USER_NOTICE_EVENT.BANNER_DISMISS}).commit(),this._dismissAndStartButterBarTimer(b.ServerProps.greenAlertBannerDuration),(0,v.setNoticeBannerClosedAt)(Date.now()))}_dismissAndStartButterBarTimer(e){this.shouldShowButterBar=!1,this._clearButterBarTimer(),this._butterBarTimeoutHandler=window.setTimeout((()=>{this.shouldShowButterBar=!0,(0,v.setNoticeBannerClosedAt)(null)}),e)}delete(){this.resetNotice(),super.delete()}sanitizeBlockingModal(e){if(!e)return null;const t=e=>{if(!e)return null;const t=e.action;if(t){const r=I.find((e=>`whatsapp:user-notice?action=${e}`===t));if(r)return e.action=r,e;__LOG__(3)`Notice: Unknown action type ${t}`}return null};return e.primaryButton=t(e.primaryButton),e.secondaryButton=t(e.secondaryButton),e}_isoFromCallingCode(e){const t=parseInt(e,10),r=o.default[t];return(0,d.default)(r,"isoFromCC")}validateResponseFields(e,t){e.forEach((e=>{if(!(e in t))throw new Error(`Missing field ${e} in notice content.`)}))}extractBlockingModal(e){if(e)return this.validateResponseFields(["icon","iconDescription","title","body","primaryButton"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconSvg:{light:"",dark:""},iconDescription:e.iconDescription,title:e.title,body:e.body,primaryButton:e.primaryButton,secondaryButton:e.secondaryButton}}extractBanner(e){if(e)return this.validateResponseFields(["icon","iconDescription","text"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconDescription:e.iconDescription,text:e.text,iconSvg:{light:"",dark:""}}}extractUserNoticeContent(e){const{policyVersion:t}=e;if(!t)throw new Error("Missing field policyVersion in notice content.");__LOG__(2)`Notice:fetchNoticeData successful for policyVersion ${t}`;const r=e.banner&&this.extractBanner(e.banner),n=e["blocking-modal"]&&this.extractBlockingModal(e["blocking-modal"]),i=n&&this.sanitizeBlockingModal(n);this.set({policyVersion:t,blockingModal:i,banner:r}),this.makeIconFetch(r,i)}resetBackgroundFetches(){var e;null===(e=this.backgroundFetches)||void 0===e||e.forEach((e=>{__LOG__(2)`Notice: aborting fetches`,e.abort()}))}resetNotice(){this.resetBackgroundFetches(),this.unset(["banner","blocking","blockingModal","noticeId","policyVersion"]),(0,v.setNoticeId)(null),(0,v.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0}_clearButterBarTimer(){const e=this._butterBarTimeoutHandler;null!=e&&window.clearTimeout(e)}fetchNoticeData(){if((0,h.isNonZeroNumber)(this.noticeId)&&T.GK.supportsFeature(T.GK.F.USER_NOTICE)){var e,t;this.resetBackgroundFetches(),this.set({blockingModal:void 0,banner:void 0});const r=(0,v.getMeUser)(),n=(0,u.findCC)(r.user),i=this._isoFromCallingCode(n),a=P.URL.build(y.default.NOTICE_CONTENT_ENDPOINT_URL,{id:this.noticeId,lg:null!==(e=g.Conn.lg)&&void 0!==e?e:"zz",lc:null!==(t=g.Conn.lc)&&void 0!==t?t:"ZZ",cc:i,platform:g.Conn.isSMB?"smbweb":"web"});this.makeContentFetch(a)}}_shouldUpdateVersion(e,t){return null==e||null!=t&&t>e}handleResponse(e){if(T.GK.supportsFeature(T.GK.F.USER_NOTICE))if(e.length){const{blocking:t,id:r,version:n}=e[0],i=this.noticeId,a=this._shouldUpdateVersion(this.policyVersion,n);__LOG__(2)`Notice: received notice id: ${r}, blocking: ${t}, version: ${n}`,this.set({blocking:t,noticeId:r,policyVersion:a?n:this.policyVersion}),(r!==i||a)&&this.fetchNoticeData();r!==(0,v.getNoticeId)()&&((0,v.setNoticeId)(r),(0,v.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0),e.length>1&&(__LOG__(4,void 0,new Error,!0)`Notice: more than one notice from phone response`,SEND_LOGS("notice-unallowed-length"))}else __LOG__(2)`Notice: received empty notice`,this.resetNotice()}sync(e){!0!==e&&this._initializeShouldShowButterBar();const t="Notice:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,r(56891).default.queryNoticeState)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.notices)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,c.filteredCatch)(M.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("notice-query-failed")}))}_initializeShouldShowButterBar(){const e=(0,v.getNoticeBannerClosedAt)();if(null!=e&&0!==b.ServerProps.greenAlertBannerDuration){const t=e+b.ServerProps.greenAlertBannerDuration-Date.now();if(t>0)return void this._dismissAndStartButterBarTimer(t)}this.shouldShowButterBar=!0}makeContentFetch(e){var t=this;return(0,a.default)((function*(){try{const r=yield t.attemptFirstFetchAndRetriesAfter(e);try{const e=r&&JSON.parse(r);e&&t.extractUserNoticeContent(e)}catch(e){throw new C.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:C.default.USER_NOTICE_ERROR_EVENT.JSON_PARSE}).commit(),new O(`Received invalid User Notice content for id ${t.noticeId}`)}}catch(e){if(e.name===s.ABORT_ERROR)return;if("NoticeJsonParseError"!==e.name){new C.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:C.default.USER_NOTICE_ERROR_EVENT.JSON_FETCH}).commit()}t.resetNotice(),__LOG__(4,void 0,new Error,!0)`Notice: Error Message : ${e.message}`,SEND_LOGS("notice-content-error")}}))()}makeIconFetch(e,t){var r=this;return(0,a.default)((function*(){const n=[null==e?void 0:e.icon.light,null==e?void 0:e.icon.dark,null==t?void 0:t.icon.light,null==t?void 0:t.icon.dark].map((e=>e?r.attemptFirstFetchAndRetriesAfter(e):Promise.resolve(null)));try{const[e,t,a,s]=yield Promise.all(n);let o=r.banner,l=r.blockingModal;r.banner&&e&&t&&(o=(0,i.default)((0,i.default)({},r.banner),{iconSvg:{light:e,dark:t}})),r.blockingModal&&a&&s&&(l=(0,i.default)((0,i.default)({},r.blockingModal),{iconSvg:{light:a,dark:s}})),r.set({banner:o,blockingModal:l})}catch(e){if(e.name===s.ABORT_ERROR)return;new C.default.UserNoticeError({userNoticeId:r.noticeId,userNoticeContentVersion:r.policyVersion,userNoticeErrorEvent:C.default.USER_NOTICE_ERROR_EVENT.IMAGE_FETCH}).commit(),__LOG__(4,void 0,new Error,!0)`Notice: Icon fetch error : ${e.message}`,SEND_LOGS("notice-icon-fetch-error")}}))()}shouldRetry(e){return 404===e||429===e||e>=500}attemptFirstFetchAndRetriesAfter(e){var t=this;return(0,a.default)((function*(){var r;const n=new f.default,i=n.signal,a=null!==(r=t.backgroundFetches)&&void 0!==r?r:[];t.backgroundFetches=[...a,n];try{const r=yield(0,S.default)(e,{signal:i});if(!r.ok){const e=r.status;throw t.shouldRetry(e)?new E.HttpStatusCodeError(e,"noticeFetchErr"):new Error("contentResponseUnhandledError")}return r.text()}catch(r){if("HttpStatusCodeError"===r.name)return t.retryFetch(e,r.status);throw r}}))()}retryFetch(e,t){var r,n=this;const i=new f.default,s=i.signal,o=null!==(r=this.backgroundFetches)&&void 0!==r?r:[];this.backgroundFetches=[...o,i];const l=function(){var t=(0,a.default)((function*(t){__LOG__(2)`Notice: Fetch Retry attempt`;const r=yield(0,S.default)(e,{signal:s});if(!r.ok){if(__LOG__(3)`Notice: Could Not download`,n.shouldRetry(r.status))return t(new Error("retryFailed"));throw new Error("contentResponseUnhandledError")}return r.text()}));return function(){return t.apply(this,arguments)}}();let c,d;return 404===t?(d=2,c=e=>{let{taskDuration:t}=e;const r=w();return Math.max(r-t,0)}):(d=8,c=e=>{let{taskDuration:t}=e;const r=36e5*R();return Math.max(r-t,0)}),(0,_.backoff)({delay:c,retries:d,signal:s},l)}}D.Proxy="notice";var N=new((0,m.defineModel)(D))({id:"default_notice_id"});t.default=N},3e4:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Presence=t.ChatstateCollection=t.Chatstate=void 0,t.processStagesRecursively=m;var i=n(r(23279)),a=r(1255),s=r(11290),o=r(22683),l=r(19380),c=n(r(43725)),d=r(42931),u=n(r(39546));class p extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.type=(0,s.prop)(),this.t=(0,s.prop)(),this.deny=(0,s.prop)(),this.updateTime=(0,s.session)(),this.expireTimerId=(0,s.session)()}}p.Proxy="chatstate",p.idClass=u.default;const h=(0,s.defineModel)(p);t.Chatstate=h;class f extends a.BaseCollection{}t.ChatstateCollection=f,f.model=h;class _ extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.isOnline=(0,s.session)(!1),this.stale=(0,s.session)(!0),this.hasData=(0,s.session)(!1),this.isSubscribed=(0,s.session)(!1),this.withholdDisplayStage=(0,s.session)(d.WithholdDisplayStage.None),this.forceDisplay=(0,s.session)(!1),this.chatActive=(0,s.session)(!1),this.withholdDisplayTimer=(0,s.session)(),this.forceDisplayTimer=(0,s.session)(),this.chatstate=(0,s.session)(),this.chatstates=(0,s.collection)(f),this.isGroup=(0,s.derived)(this._isGroup),this.isUser=(0,s.derived)(this._isUser)}_isGroup(){return u.default.isGroup(this.id)}_isUser(){return u.default.isUser(this.id)}initialize(){super.initialize();const e=this.isGroup?{id:"",type:"unavailable"}:{id:this.id};this.addChild("chatstate",new h(e)),this.isGroup?this.listenTo(this.chatstates,"add change",(0,i.default)((()=>{let e,t=!1;this.chatstates.forEach((r=>{"composing"!==r.type&&"recording"!==r.type||e&&!(e.updateTime<r.updateTime)||(e=r),t=t||"unavailable"!==r.type})),this.set({isOnline:t}),this.chatstate.set({id:e?e.id:"",type:e?e.type:"unavailable"})}))):this.listenTo(this.chatstate,"change:type",(()=>{this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)}delete(){super.delete(),this.getCollection().remove(this.id),this.chatstate.delete(),this.chatstates.forEach((e=>e.delete()))}reset(){this.hasData=!1,this.isGroup?this.chatstates.forEach((e=>{e.type="unavailable"})):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})}isActive(){const e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)}getGroupSubtitleText(){if(!this.hasData)return null;if(!this.isGroup)return __LOG__(4,void 0,new Error,!0)`getGroupSubtitleText is used when presence is not for a group`,SEND_LOGS("getGroupSubtitleText-not-group"),null;const e=this._getActiveContact();if(null==e)return null;const t=e.formattedShortName;return"composing"===this.chatstate.type?c.default.t(1601,{participant:t}):c.default.t(1602,{participant:t})}_getActiveContact(){const e=this.chatstate.id;return e?l.ContactCollection.get(e):null}getUserSubtitleText(){if(!this.hasData)return null;if(!this.isUser)return __LOG__(4,void 0,new Error,!0)`getUserSubtitleText is used when presence is not for a user`,SEND_LOGS("getUserSubtitleText-not-user"),null;const e=this.chatstate;switch(e.type){case"available":return c.default.t(1594);case"composing":return c.default.t(1595);case"recording":return c.default.t(1596);case"unavailable":return e.deny||null==e.t?null:o.Clock.lastSeenStr(e.t)}}getFormattedString(){return this.hasData?this.isGroup?this.getGroupSubtitleText():this.isUser?this.getUserSubtitleText():null:null}onChatActiveChange(){if(this.chatActive){if(this.hasData)this.withholdDisplayStage=d.WithholdDisplayStage.None;else{const e=this._getActiveContact();!0===(null==e?void 0:e.isBusiness)?m(this,[d.WithholdDisplayStage.Business,d.WithholdDisplayStage.Info,d.WithholdDisplayStage.None]):m(this,[d.WithholdDisplayStage.Info,d.WithholdDisplayStage.None])}this.forceDisplayTimer=setTimeout((()=>{this.set({forceDisplay:!0,forceDisplayTimer:void 0})}),2e3)}else this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=void 0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=void 0)}subscribe(){return this.getCollection().find(this.id)}getCollection(){return r(68315).PresenceCollection}}function m(e,t){if(0===t.length)return;const[r,...n]=t;e.set({withholdDisplayStage:r,withholdDisplayTimer:r===d.WithholdDisplayStage.None?null:setTimeout((()=>{m(e,n)}),r===d.WithholdDisplayStage.Business?5e3:1500)})}_.Proxy="presence",_.idClass=u.default;const g=(0,s.defineModel)(_);t.Presence=g},68315:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceCollectionImpl=t.PresenceCollection=void 0;var i=n(r(48926)),a=r(1255),s=r(3e4),o=r(1985),l=n(r(39546));class c extends a.BaseCollection{_subscribe(e){return(0,i.default)((function*(){const t=r(69951).ChatCollection.get(e);yield(0,o.subscribePresence)(e,null==t?void 0:t.getTcToken())}))()}_find(e){var t=this;return(0,i.default)((function*(){return!t.gadd(e).isUser||l.default.isServer(e)||l.default.isPSA(e)||(yield t._subscribe(e)),{id:e}}))()}reSubscribeWhenActive(e){var t=this;return(0,i.default)((function*(){const r=t.get(e);null!=r&&!1!==r.isSubscribed&&(yield t._subscribe(e))}))()}clearAllPresence(){this.forEach((e=>{e.reset(),e.set({stale:!0,isSubscribed:!1})}))}}t.PresenceCollectionImpl=c,c.model=s.Presence,c.staleCollection=!0;const d=new c;t.PresenceCollection=d},42931:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WithholdDisplayStage=void 0;const n=r(54302).Mirrored(["Info","Business","None"]);t.WithholdDisplayStage=n},34771:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrimaryFeaturesClass=t.PrimaryFeatures=void 0;var n=r(11290),i=r(99234);class a extends n.BaseModel{constructor(){super(...arguments),this.contactExcept=(0,n.prop)(!1),this.reactionsSend=(0,n.prop)(!1)}initializeFromLocalStorage(){this._setPrimaryFeatures((0,i.getPrimaryFeatures)())}setPrimaryFeatures(e){(0,i.setPrimaryFeatures)(e),this._setPrimaryFeatures(e)}_setPrimaryFeatures(e){const t=new Set(e);this.contactExcept=t.has("contact_except"),this.reactionsSend=t.has("reactions_send")}}t.PrimaryFeaturesClass=a,a.Proxy="primaryFeatures";const s=new((0,n.defineModel)(a))({id:"1"});t.PrimaryFeatures=s},46328:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROFILE_PIC_COMMAND=void 0;const r=Object.freeze({REMOVE:"remove",SET:"set"});t.PROFILE_PIC_COMMAND=r},93836:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumb=t.FALLBACK=void 0;var i=n(r(81109)),a=r(11290),s=n(r(69618)),o=r(99234),l=r(7293),c=r(2541),d=n(r(39546)),u=n(r(5882));const p={SINGLE:"SINGLE",GROUP:"GROUP"};t.FALLBACK=p;class h extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.token=(0,a.prop)(),this.tag=(0,a.prop)(),this.raw=(0,a.prop)(),this.eurl=(0,a.prop)(),this.previewEurl=(0,a.prop)(),this.stale=(0,a.session)(!0),this.eurlStale=(0,a.session)(!1),this.pendingPic=(0,a.session)(),this.img=(0,a.derived)(this._img,["tag","raw","stale","eurl","eurlStale","previewEurl"]),this.imgFull=(0,a.derived)(this._imgFull,["tag","raw","stale","eurl","eurlStale"]),this.fallbackType=(0,a.derived)(this._fallbackType,["id"])}_img(){return this.raw?"data:image/jpeg;base64,"+this.raw:!this.tag&&this.stale?null:this.tag?l.GK.supportsFeature(l.GK.F.MD_BACKEND)?this.previewEurl:this.generateUrl("s"):void 0}_imgFull(){return!this.raw&&this.tag||!this.stale?!this.raw&&this.tag?l.GK.supportsFeature(l.GK.F.MD_BACKEND)?this.eurl:this.generateUrl("l"):void 0:null}_fallbackType(){return d.default.isUser(this.id)?p.SINGLE:(d.default.isGroup(this.id),p.GROUP)}markStale(e){this.stale=!0,(null==e?void 0:e.eurl)&&(this.eurlStale=!0)}validate(){if(this.stale||this.eurlStale)return this.getCollection().update(this.id)}generateUrl(e){let t={t:e,u:this.id.toString(),i:this.tag||"",n:this.token||""};return this.token||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("profilePicThumb::generateUrl: empty token for profile pic")),u.default.alive&&this.eurl&&!this.eurlStale&&(t=(0,i.default)({e:this.eurl},t)),c.URL.build(s.default.PP_URL,t)}canSet(){if(d.default.isGroup(this.id)){var e;const t=r(69951).ChatCollection.get(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!!this.id.equals((0,o.getMaybeMeUser)())}canDelete(){if(d.default.isGroup(this.id)&&this.tag){var e;const t=r(69951).ChatCollection.assertGet(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!(!this.id.equals((0,o.getMaybeMeUser)())||!this.tag)}getCollection(){return r(82039).ProfilePicThumbCollection}}h.Proxy="profilePicThumb",h.idClass=d.default;const f=(0,a.defineModel)(h);t.ProfilePicThumb=f},82039:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbCollectionImpl=t.ProfilePicThumbCollection=void 0;var a=i(r(41609)),s=r(50796),o=r(1255),l=r(17239),c=n(r(64103)),d=r(99234),u=r(7293),p=i(r(64084)),h=r(46328),f=r(5018),_=r(93836),m=r(78521),g=r(77591),y=i(r(39546)),E=r(58021);class S extends o.BaseCollection{get(e){const t=super.get(e);if(!this.modelClass.prototype.isIdType(e))return t;const r=super.get((0,p.default)(e.toString()));if(r){if(this.remove(r,{silent:!0}),t&&t.tag)return t;{const t=r.toJSON();return t.id=e,this.add(t,{silent:!0,merge:!0})[0]}}return t||void 0}saveToCache(){if(!l.Conn.shouldSaveToCache())return;const e=S.cachePolicy.id;let t=this.filter((e=>y.default.isWid(e.id)&&!!e.eurl&&!!e.token));t=t.map((function(e){const t=e.toJSON();return t.id=(0,p.default)(t.id.toString()),t})),__LOG__(2)`models:profilePic:cache-save: ${String(e)}`,(0,d.setCollection)(e,t)}initializeFromCache(e){if(!this.length||!e)return;const t=this.reduce(((e,t)=>(e[(0,p.default)(t.id.toString())]=t.id.toString(),e)),new Object);if((0,a.default)(t))return;const r=e.reduce(((e,r)=>(t[r.id]&&(r.id=(0,E.createWid)(t[r.id]),r.stale=!0,r.token&&e.push(r)),e)),[]);this.add(r,{merge:!0})}onResume(){const e=this.filter((e=>{const t=r(69951).ChatCollection.get(e.id);return e.hasObservers()&&e.stale&&(y.default.isUser(e.id)||y.default.isGroup(e.id))&&!(null==t?void 0:t.isReadOnly)})).map((e=>(e.tag||e.unset("tag",{silent:!0}),e)));this.resyncPictures(e)}_find(e){const t=r(69951).ChatCollection.get(e);if(null==t?void 0:t.isReadOnly)return u.GK.supportsFeature(u.GK.F.MD_BACKEND)?Promise.resolve({id:e,stale:!0}):(0,f.profilePicFindThumbFromPhone)(e,this.get(e)).then((e=>(e.tag||e.raw||(e.eurl=null,e.tag=null,e.raw=null,e.eurlStale=!1),e))).catch((0,s.filteredCatch)(c.ProtoVersionUndefined,(()=>({id:e,stale:!0}))));if(y.default.isUser(e)||y.default.isGroup(e)){const t={id:e};return(0,f.profilePicFind)(e).then((e=>(t.tag=e.tag,t.raw=null,t.eurl=e.eurl,t.eurlStale=!1,t.token=e.token,u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(t.previewEurl=e.previewEurl),t))).catch((0,s.filteredCatch)(g.ServerStatusCodeError,(e=>{switch(e.status){case 401:t.tag="",t.raw=void 0;break;case 423:case 429:t.stale=!0;break;default:t.tag=null,t.eurl=null,t.eurlStale=!1}return Promise.resolve(t)}))).catch((0,s.filteredCatch)(g.WebdDrop,(function(){return{id:e,stale:!0}})))}return Promise.resolve({id:e,tag:null})}imageChanged(e,t){const r=this.get(e);r&&(t===h.PROFILE_PIC_COMMAND.REMOVE?r.set({tag:void 0,eurl:void 0}):t!==h.PROFILE_PIC_COMMAND.SET&&r.tag===t||this.update(r.id).catch((0,s.filteredCatch)(g.WebdDrop,(()=>{}))))}resyncPictures(e){return 0===e.length?Promise.resolve():(0,f.profilePicResync)(e.map((function(e){return{id:e.id,tag:e.tag}}))).then((t=>{__LOG__(2)`ProfilePicThumbStore:resyncPictures success`,t.forEach((t=>{const r=this.get(t.id);r&&r.set({tag:t.tag,token:t.token,raw:void 0,stale:!1,eurl:t.eurl,eurlStale:!1,previewEurl:t.previewEurl}),e.forEach((e=>{e.eurlStale&&this.update(e.id)})),e.forEach((e=>{e.stale=!1}))}))})).catch((0,s.filteredCatch)(g.WebdDrop,(()=>{}))).catch((0,s.filteredCatch)(g.ServerStatusCodeError,(e=>{423===e.status||429===e.status?__LOG__(3)`ProfilePicThumbStore:resyncPictures blocked ${e.status}`:e.status>=400&&__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))).catch((function(e){__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))}findThumbnailWid(e){return e.find((e=>{var t;return null===(t=this.get(e))||void 0===t?void 0:t.img}))}getThumbnailWidFromVcard(e){if(!e)return null;const t=(0,m.vcardWids)(e);if(!t)return;const r=this.findThumbnailWid(t);return r||(t.length?t[0]:null)}}t.ProfilePicThumbCollectionImpl=S,S.model=_.ProfilePicThumb,S.staleCollection=!0,S.resumeOnAvailable=!0,S.cachePolicy={id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:o.CACHE_POLICY.LOAD,delay:5e3};const v=new S;t.ProfilePicThumbCollection=v},31592:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsSendersCollection=t.ReactionsSenders=t.Reactions=t.AggReactionsCollection=t.AggReactions=void 0;var i=n(r(94654)),a=r(11290),s=n(r(31727)),o=r(19380),l=n(r(32219)),c=r(57793),d=r(58021);class u extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.msgKey=(0,a.prop)(),this.parentMsgKey=(0,a.prop)(),this.reactionText=(0,a.prop)(),this.timestamp=(0,a.prop)(),this.senderUserJid=(0,a.prop)(),this.read=(0,a.prop)(),this.orphan=(0,a.prop)(),this.senderObj=(0,a.session)(),this.parentMsg=(0,a.derived)(this._getParentMsg)}_getParentMsg(){return this._getMsgCollection().get(this.parentMsgKey)}initialize(){super.initialize(),this.addChild("senderObj",o.ContactCollection.gadd((0,d.createUserWid)(this.senderUserJid)))}_getMsgCollection(){return r(59871).MsgCollection}isEqual(e){return this.id.equals(e.id)}}u.Proxy="reactionsSenders",u.idClass=l.default;const p=(0,a.defineModel)(u);t.ReactionsSenders=p;class h extends s.default{}t.ReactionsSendersCollection=h,h.model=p,h.comparator=(e,t)=>(0,c.isReactionByMe)(e.senderUserJid)?-1:(0,c.isReactionByMe)(t.senderUserJid)?1:t.timestamp-e.timestamp;class f extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.aggregateEmoji=(0,a.prop)(),this.hasReactionByMe=(0,a.prop)(),this.senders=(0,a.collection)(h)}}f.Proxy="aggReactions";const _=(0,a.defineModel)(f);t.AggReactions=_;class m extends s.default{}t.AggReactionsCollection=m,m.model=_,m.comparator=(e,t)=>{const r=t.senders.length-e.senders.length;if(e.hasReactionByMe)return-1;if(t.hasReactionByMe)return 1;if(0===r){const r=t.senders.at(0),n=e.senders.at(0);if(r&&n)return r.timestamp-n.timestamp}return r};class g extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.reactionByMe=(0,a.prop)(),this.reactions=(0,a.collection)(m)}unreadSenders(){return(0,i.default)(this.reactions.toArray(),(e=>e.senders.filter((e=>!e.read&&!(0,c.isReactionByMe)(e.senderUserJid))))).map((e=>{let{id:t,parentMsgKey:r,reactionText:n,senderUserJid:i}=e;return{msgKey:t,parentMsgKey:l.default.fromString(r),reactionText:n,senderUserJid:i}}))}getCollection(){return r(31464).ReactionsCollection}}g.Proxy="reactions",g.idClass=l.default;const y=(0,a.defineModel)(g);t.Reactions=y},31464:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsCollectionImpl=t.ReactionsCollection=void 0;var i=n(r(81109)),a=r(1255),s=n(r(69618)),o=r(70449),l=n(r(32219)),c=r(31592),d=r(75250),u=r(57793);class p extends a.BaseCollection{_find(e){const t=r(59871).MsgCollection.get(e);return t?(0,d.sendQueryReactions)(t):Promise.reject(new a.CollectionSilentQueryError(`No message found for id: ${e}`))}addOrUpdateReaction(e){if(e.reactionText===s.default.REVOKED_REACTION_TEXT)return this.removeReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionSenderModel:r,reactionAggregateWithSender:n}=this.getAggregateEmojiAndSender(t,e.senderUserJid);if(n&&r){if(!(e.timestamp>r.timestamp))return;(0,u.isReactionByMe)(e.senderUserJid)&&this._removeSelfReaction(e),this._removeAggregateEmojiAndSender(t,r,n)}this._addNewReactionToAggregate(e,t)}}removeReaction(e){if((0,u.isReactionByMe)(e.senderUserJid))return this._removeSelfReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionAggregateWithSender:r,reactionSenderModel:n}=this.getAggregateEmojiAndSender(t,e.senderUserJid);r&&n&&(this._removeAggregateEmojiAndSender(t,n,r),n.trigger("revoked"))}else __LOG__(3)`reactions_collection:removeReaction no reactions model found`}_addNewReactionToAggregate(e,t){const r=o.EmojiUtil.getEmojiAggregate(e.reactionText),n=t.reactions.get(r),a=l.default.fromString(e.msgKey),s=(0,i.default)((0,i.default)({},e),{},{id:a}),c=(0,u.isReactionByMe)(e.senderUserJid);n?(c&&(n.set({hasReactionByMe:!0}),t.set({reactionByMe:e})),n.senders.add(s),t.reactions.sort(),n.trigger("change:senders")):(c&&t.set({reactionByMe:e}),t.reactions.add({aggregateEmoji:r,hasReactionByMe:c,id:r,senders:[s]}))}_removeAggregateEmojiAndSender(e,t,r){r.senders.remove(t.id),0===r.senders.length?e.reactions.remove(r.id):e.reactions.sort(),r.trigger("change:senders")}getAggregateEmojiAndSender(e,t){let r=null,n=null;for(let i=0;i<e.reactions.length;i++){const a=e.reactions.at(i),s=null==a?void 0:a.senders.findFirst((e=>e.senderUserJid===t));if(s){r=s,n=a;break}}return{reactionSenderModel:r,reactionAggregateWithSender:n}}_removeSelfReaction(e){const t=this.get(e.parentMsgKey);if(null==t||t.set({reactionByMe:null}),t){const{reactionAggregateWithSender:r,reactionSenderModel:n}=this.getAggregateEmojiAndSender(t,e.senderUserJid);null==r||r.set({hasReactionByMe:!1}),r&&n&&(this._removeAggregateEmojiAndSender(t,n,r),n.trigger("revoked"))}}markReactionsAsRead(e){e.forEach((e=>{const{parentMsgKey:t,msgKey:r,reactionText:n}=e,a=o.EmojiUtil.getEmojiAggregate(n),s=this.get(t);if(s){const e=s.reactions.get(a),t=null==e?void 0:e.senders.get(r);t?t.set((0,i.default)((0,i.default)({},t),{},{read:!0})):__LOG__(3)`reactions_collection:markReactionsAsRead Reaction sender model not found`}}))}deleteReactionsByParentMessageKey(e){this.remove(e)}}t.ReactionsCollectionImpl=p,p.model=c.Reactions;const h=new p;t.ReactionsCollection=h},53988:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return a.default.MEDIA_TYPE.NONE;switch(e){case i.default.SHOPS_STOREFRONT:return a.default.MEDIA_TYPE.SHOP_STOREFRONT;case i.default.NATIVE_FLOW:return a.default.MEDIA_TYPE.INTERACTIVE_NFM}};var i=n(r(84064)),a=n(r(11339))},26287:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getNativeFlowNameByButtonName=function(e){switch(e){case"review_and_pay":return i.default.ORDER_DETAILS;case"review_order":return i.default.ORDER_STATUS}},t.isValidNativeFlowMessage=void 0;var i=n(r(5165)),a=r(34841),s=r(88998);t.isValidNativeFlowMessage=e=>{if(null==e.nativeFlowName)return!1;switch(e.nativeFlowName){case i.default.ORDER_DETAILS:return null!=(0,a.getOrderInfo)(e);case i.default.ORDER_STATUS:return null!=(0,s.getOrderStatusInfo)(e)}}},34841:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderInfo=t.getOrderInfo=void 0;var a=i(r(69618)),s=i(r(84064)),o=i(r(5165)),l=n(r(69340));function c(e){var t;const r=null==e?void 0:e.value;if(null==r)return;const n=null!==(t=null==e?void 0:e.offset)&&void 0!==t?t:1;return parseFloat(null!=r?r:0)/parseInt(n,10)}const d=(e,t)=>{var r,n;if("review_and_pay"!==e||null==t)return null;const i=l.parse(t),{order:a,currency:s,reference_id:o}=i,d=c(i.total_amount),u=null!==(r=null==a?void 0:a.items)&&void 0!==r?r:[],p=u.map((e=>{var t,r,n,i;return{id:null!==(t=null!==(r=null==e?void 0:e.product_id)&&void 0!==r?r:null==e?void 0:e.retailer_id)&&void 0!==t?t:"",name:null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"",amount:c(null==e?void 0:e.amount),quantity:parseInt(null!==(i=null==e?void 0:e.quantity)&&void 0!==i?i:0,10)}})),h=p.reduce(((e,t)=>e+t.quantity),0),f=null===(n=u[0])||void 0===n?void 0:n.name;if(null==f||null==o||null==s||null==d)return null;return{title:f,referenceId:o,currency:s,quantity:h,shipping:c(null==a?void 0:a.shipping),tax:c(null==a?void 0:a.tax),discount:c(null==a?void 0:a.discount),subtotal:c(null==a?void 0:a.subtotal),totalAmount:d,items:p}};t.paramsJsonToOrderInfo=d;t.getOrderInfo=e=>{var t;if(e.nativeFlowName!==o.default.ORDER_DETAILS)return null;if(e.type===a.default.MSG_TYPE.INTERACTIVE&&e.interactiveType===s.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:r}=e.interactivePayload.buttons[0];return d(t,r)}if(e.type===a.default.MSG_TYPE.NATIVE_FLOW){var r;const{nativeFlowInfo:t}=(null!==(r=e.nativeFlowButtons)&&void 0!==r?r:[])[0];return d(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}}},88998:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderStatusInfo=t.getOrderStatusInfo=t.getOrderMessage=t.findOrderStatusMessage=t.findOrderDetailsMessage=t.OrderStatus=void 0;var i=n(r(30988)),a=n(r(69618)),s=n(r(84064)),o=n(r(5165)),l=r(34841);const c=r(54302)({Pending:"pending",Processing:"processing",Shipped:"shipped",Complete:"completed",Canceled:"canceled"});t.OrderStatus=c;const d=(e,t)=>{if("review_order"!==e||null==t)return null;const{order:r,reference_id:n}=JSON.parse(t),i=c.cast(null==r?void 0:r.status);return null==i||null==n?null:{refId:n,status:i}};t.paramsJsonToOrderStatusInfo=d;const u=e=>{var t;if(e.nativeFlowName!==o.default.ORDER_STATUS)return null;if(e.type===a.default.MSG_TYPE.INTERACTIVE&&e.interactiveType===s.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:r}=e.interactivePayload.buttons[0];return d(t,r)}if(e.type===a.default.MSG_TYPE.NATIVE_FLOW){var r;const{nativeFlowInfo:t}=(null!==(r=e.nativeFlowButtons)&&void 0!==r?r:[])[0];return d(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}};t.getOrderStatusInfo=u;const p=(e,t)=>{var r;const n=e.msgs.getModelsArray().slice(-1e3);return null===(r=(0,i.default)(n,(e=>{var r;return e.nativeFlowName===o.default.ORDER_DETAILS&&(null===(r=(0,l.getOrderInfo)(e))||void 0===r?void 0:r.referenceId)===t})))||void 0===r?void 0:r.safe()};t.findOrderDetailsMessage=p;t.getOrderMessage=e=>{var t;const r=null===(t=u(e))||void 0===t?void 0:t.refId;return null==r?null:p(e.chat,r)};t.findOrderStatusMessage=(e,t)=>{var r;const n=e.msgs.getModelsArray().slice(-1e3);return null===(r=(0,i.default)(n,(e=>{var r;return e.nativeFlowName===o.default.ORDER_STATUS&&(null===(r=u(e))||void 0===r?void 0:r.refId)===t})))||void 0===r?void 0:r.safe()}},84728:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VIEW_ONCE_EXPIRE_AFTER=void 0,t.isExpired=d,t.isUnviewed=function(e){return!c(e)&&!d(e)},t.isViewed=c,t.setViewOnceTestExpire_INTERNAL=function(){};var i=r(22683),a=n(r(69618)),s=r(31019);let o=1209600;function l(e){const t=(0,s.unproxy)(e);return null!=t?t.asViewOnce:null}function c(e){var t;return(null===(t=l(e))||void 0===t?void 0:t.ack)===a.default.ACK.PLAYED}function d(e){const t=l(e);if(null==t)return!1;const r=i.Clock.globalUnixTime()-(0,s.unproxy)(t).t;return!c(t)&&r>=o}t.VIEW_ONCE_EXPIRE_AFTER=o},64551:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ServerPropsImpl=t.ServerProps=void 0,t.getMaxFilesSizeServerProp=function(){return g.maxFileSize};var i=r(11290),a=r(7293),s=n(r(11339)),o=r(40264),l=n(r(23082));const c={imageMaxKBytes:function(e){if("number"==typeof e&&e>0)return 1024*e},pttConversationWaveform:function(e){return Boolean(e)},pttOotPlayback:function(e){return Boolean(e)},pttRememberPlayPosition:function(e){return Boolean(e)},pttWaveformSend:function(e){return!!a.GK.supportsFeature(a.GK.F.PTT_WAVEFORM_SEND)&&Boolean(e)},pttPausableEnabled:function(e){return Boolean(e)},pttForwardedFeaturesEnabled:function(e){return Boolean(e)},maxParticipants:function(e){if("number"==typeof e&&e>0)return e-1},media:h,maxElectronFileSize:p,maxFileSize:p,groupDescLength:f,statusVideoMaxDuration:f,muteAlways:_,viewOnceRead:_,viewOnceWrite:_,ctwaContextRender:_,serverPropsVersion:f,wallpapersV2:_,hfmStringChanges:_,webServerStickerPanel:_,shopsProductGrid:_,stickerMaker:function(e){return Boolean(e)},downloadHostSwitchingEnabled:function(e){return!!a.GK.supportsFeature(a.GK.F.DOWNLOAD_MEDIA_CACHE)&&(!!a.GK.supportsFeature(a.GK.F.DOWNLOAD_HOST_SWITCHING_ENABLED)&&Boolean(e))},uploadHostSwitchingEnabled:function(e){return!!a.GK.supportsFeature(a.GK.F.UPLOAD_HOST_SWITCHING_ENABLED)&&Boolean(e)},webUploadDocumentThumbMmsEnabled:m,webDownloadDocumentThumbMmsEnabled:m,webDownloadStatusThumbMmsEnabled:function(e){return!!a.GK.supportsFeature(a.GK.F.DOWNLOAD_STATUS_THUMB_MMS)&&Boolean(e)}},d=604800;class u extends i.BaseModel{constructor(){super(...arguments),this.serverPropsVersion=(0,i.prop)(),this.gifSearch=(0,i.prop)(!1),this.imageMaxEdge=(0,i.prop)(1600),this.imageMaxKBytes=(0,i.prop)(1048576),this.maxParticipants=(0,i.prop)(101),this.maxSubject=(0,i.prop)(25),this.media=(0,i.prop)(16777216),this.maxElectronFileSize=(0,i.prop)(104857600),this.maxFileSize=(0,i.prop)(104857600),this.groupDescLength=(0,i.prop)(0),this.multicastLimitGlobal=(0,i.prop)(5),this.frequentlyForwardedThreshold=(0,i.prop)(5),this.frequentlyForwardedMax=(0,i.prop)(1),this.ephemeralMessagesAllowedValues=(0,i.prop)("604800"),this.productMediaAttachments=(0,i.prop)(!1),this.muteAlways=(0,i.prop)(!1),this.viewOnceRead=(0,i.prop)(!1),this.viewOnceWrite=(0,i.prop)(!1),this.wallpapersV2=(0,i.prop)(!1),this.hfmStringChanges=(0,i.prop)(!1),this.mmsVCacheAggregationEnabled=(0,i.prop)(!1),this.mmsHotContentTimespan=(0,i.prop)(0),this.mmsCatV1ForwardHotOverrideEnabled=(0,i.prop)(!1),this.pttConversationWaveform=(0,i.prop)(!1),this.pttOotPlayback=(0,i.prop)(!1),this.pttPausableEnabled=(0,i.prop)(!1),this.pttPlaybackSpeedEnabled=(0,i.prop)(!1),this.pttPlaybackSpeedHideDelay=(0,i.prop)(1500),this.pttWaveformSend=(0,i.prop)(!1),this.pttRememberPlayPosition=(0,i.prop)(!1),this.pttForwardedFeaturesEnabled=(0,i.prop)(!1),this.templateDocMimeTypes=(0,i.prop)(1),this.mmsMediaKeyTTL=(0,i.prop)(1/0),this.vcardAsDocumentSizeKb=(0,i.prop)(0),this.vcardMaxSizeKb=(0,i.prop)(1e3),this.mmsVcardAutodownloadSizeKb=(0,i.prop)(1024),this.webUploadDocumentThumbMmsEnabled=(0,i.prop)(!1),this.webDownloadDocumentThumbMmsEnabled=(0,i.prop)(!1),this.webSendDocumentThumbInMessageDisabled=(0,i.prop)(!1),this.webDownloadStatusThumbMmsEnabled=(0,i.prop)(!1),this.statusVideoMaxDuration=(0,i.prop)(30),this.groupCallMaxParticipants=(0,i.prop)(0),this.webVoipMacOsMinVersion=(0,i.prop)(""),this.webVoipWindowsOsMinVersion=(0,i.prop)(""),this.ctwaContextRender=(0,i.prop)(!1),this.ctwaContextCompose=(0,i.prop)(!1),this.syncdInlineMutationsMaxCount=(0,i.prop)(1e3),this.syncdPatchProtobufMaxSize=(0,i.prop)(100),this.syncdKeyMaxUseDays=(0,i.prop)(30),this.syncdWaitForKeyTimeoutDays=(0,i.prop)(7),this.syncdAdditionalMutations=(0,i.prop)(1),this.syncdSentinelTimeoutSeconds=(0,i.prop)(3),this.syncdPatchDeviceIndexIncluded=(0,i.prop)(!1),this.syncdClearChatDeleteChatEnabled=(0,i.prop)(!1),this.syncdPinChatEnabled=(0,i.prop)(!1),this.webBizProfileOptions=(0,i.prop)(3),this.webBizProfileEdit=(0,i.prop)(!1),this.webBizProfileV3Enabled=(0,i.prop)(!1),this.webBizProfileV3M2=(0,i.prop)(!1),this.mdBlocklistV2=(0,i.prop)(!1),this.webShopsChatHeaderButtonEnabled=(0,i.prop)(!1),this.shopsHideCatalogAttachmentEntrypoint=(0,i.prop)(!1),this.shopsHeaderDropdownMenuItem=(0,i.prop)(!1),this.shopsProductGrid=(0,i.prop)(!1),this.bspSystemMessageEnabled=(0,i.prop)(!1),this.webListMessage=(0,i.prop)(!1),this.webCart=(0,i.prop)(!1),this.webCartV11OrderMessageChanges=(0,i.prop)(!1),this.webButtonsMessage=(0,i.prop)(!1),this.greenAlertBannerDuration=(0,i.prop)(0),this.webSMBUpsellInBizProfile=(0,i.prop)(!1),this.webProductListMessageFallback=(0,i.prop)(!1),this.webProductListMessage=(0,i.prop)(!1),this.webProductListMessageRenderKillSwitch=(0,i.prop)(!1),this.webProductListMessagePageSize=(0,i.prop)(o.PRODUCT_PAGE_SIZE),this.webMediaAutoDownloadEnabled=(0,i.prop)(!1),this.webYouTubePlayerEnhancements=(0,i.prop)(!1),this.webServerStickerPanel=(0,i.prop)(!1),this.webCollectionsDisplay=(0,i.prop)(!1),this.webCollectionsManagement=(0,i.prop)(!1),this.webCollectionsAppealEnabled=(0,i.prop)(!1),this.webCartOnOffToggle=(0,i.prop)(!1),this.downloadHostSwitchingEnabled=(0,i.prop)(!1),this.uploadHostSwitchingEnabled=(0,i.prop)(!1),this.isDirectConnectionForPLMTransparent=(0,i.prop)(!0),this.webPipRedesign=(0,i.prop)(!1),this.blockCatalogCreationEcommerceComplianceIndia=(0,i.prop)(!1),this.ecommerceComplianceIndia=(0,i.prop)(!1),this.editEcommerceComplianceIndia=(0,i.prop)(!1),this.smbEcommerceComplianceIndiaM4=(0,i.prop)(!1),this.smbEcommerceComplianceIndiaM4_5=(0,i.prop)(!1),this.webMdMigrationExperience=(0,i.prop)(!1),this.stickerMaker=(0,i.prop)(!1),this.webLogUploadDownloadCrashes=(0,i.prop)(!1),this.webLargeFilesUi=(0,i.prop)(!1),this.webMdMmsSyncDeletionRequest=(0,i.prop)(!0)}delete(){super.delete(),this.updateProps({})}initialize(){super.initialize()}updateProps(e){let t=e;s.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let r=t[e];void 0===r?r="serverPropsVersion"===e?this.serverPropsVersion:this.getDefault(e):c[e]&&(r=c[e](r),void 0===r&&(r=this.getDefault(e))),this.set(e,r)}));for(const e in a.GK.F)void 0!==t[e]&&a.GK.setFeature(e,t[e])}updateSelectiveProps(e){let t=e;s.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let r=t[e];void 0!==r&&(c[e]&&(r=c[e](r),void 0===r&&(r=this.getDefault(e))),this.set(e,r))}));for(const r in a.GK.F)void 0!==t[r]&&a.GK.setFeature(r,e[r])}extendAndOverrideFromURLParams(e){const t=new l.default(window.location.search),r=e;return this.__props.forEach((e=>{if(!0===t.has(e)){const n=t.get(e);if(null==n)return;"true"===n||"false"===n?r[e]="true"===n:isNaN(n)||isNaN(parseFloat(n))?r[e]=n:r[e]=parseFloat(n)}})),r}handlePayload(e){"number"==typeof e.status&&e.status>=400||this.updateProps(e)}handle(e){const t=e.shift();this.handlePayload(t)}getGroupCallMaxParticipants(){return this.groupCallMaxParticipants}getEphemeralMessagesAllowedValues(){try{return this.ephemeralMessagesAllowedValues.split(",").map((e=>parseInt(e,10)))}catch(e){return __LOG__(4,void 0,new Error,!0)`[ephemeral] incorrect type for ephemeralMessagesAllowedValues`,SEND_LOGS("ephemeral"),[d]}}}function p(e){return h(e)}function h(e){if("number"==typeof e&&e>0)return 1024*e*1024}function f(e){if("number"==typeof e&&e>0)return e}function _(e){if("number"==typeof e)return!!e}function m(e){return Boolean(e)}t.ServerPropsImpl=u,u.Proxy="serverProps";const g=new((0,i.defineModel)(u))({id:"1"});t.ServerProps=g},68132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(50796),i=r(11290),a=r(57701),s=r(80208),o=r(77591);const l={classic:!1,enabled:!1},c={timestamp:0};class d extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.archive=(0,i.prop)(),this.disappearingMode=(0,i.prop)(),this.mdOptInDeadline=(0,i.prop)(),this.showArchiveV2=(0,i.derived)(this._showArchiveV2,["archive","enabled"])}delete(){this.set({archive:l,disappearingMode:l,mdOptInDeadline:c}),super.delete()}_showArchiveV2(){return!!this.archive.enabled&&!this.archive.classic}handleResponse(e){e.length?e.forEach((e=>{switch(__LOG__(2)`Settings: received setting type: ${e.type}`,e.type){case s.ARCHIVE_SETTINGS_KEY:var t;if(!(0,a.archiveV2Supported)()){__LOG__(4,void 0,new Error,!0)`Settings:handleResponse archive settings response is unsupported`,SEND_LOGS("archive-setting-unsupported");break}this.set({archive:{classic:e.value.classic,enabled:null!==(t=e.value.enabled)&&void 0!==t?t:this.archive.enabled}});break;case s.DISAPPEARING_MODE_SETTINGS_KEY:this.set({disappearingMode:{duration:e.value.duration,settingTimestamp:e.value.settingTimestamp}});break;case s.MD_OPT_IN_DEADLINE_SETTINGS_KEY:this.set({mdOptInDeadline:{timestamp:e.value.timestamp}})}})):__LOG__(2)`Settings: received empty settings`,r(96876).default.processMdOptInDeadline()}sync(e){const t="Settings:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,r(56891).default.querySettings)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.settings)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,n.filteredCatch)(o.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("settings-query-failed")}))}}d.Proxy="settings";var u=new((0,i.defineModel)(d))({id:"default_settings_id",archive:l,disappearingMode:{duration:0,settingTimestamp:0},mdOptInDeadline:c});t.default=u},11810:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(33856)),a=n(r(29521)),s=n(r(63105)),o=r(1255),l=r(7293),c=r(17304),d=r(59871),u=r(65044);class p extends o.BaseCollection{constructor(){super(),this.syncPromise=null,this.isSynced=!1,this.listenTo(u.Socket,"change:stream",(()=>{u.Socket.stream===u.STREAM.DISCONNECTED&&(this.isSynced=!1)}))}onResume(){this.isSynced=!1,this.sync()}maySync(){return l.GK.supportsFeature(l.GK.F.STARRED_GIFS)}sync(){return this.isSynced?Promise.resolve():this.syncPromise?this.syncPromise:this.maySync()?(this.syncPromise=d.MsgCollection.getStarred(void 0,void 0,void 0,!0).then((e=>{let t=[];(null==e?void 0:e.length)&&(t=(0,s.default)(e,(e=>(null==e?void 0:e.isGif)&&!e.isUnsentMedia))),this.set(t)})).catch((e=>{499!==e&&__LOG__(3)`starred gif msgs sync error: `})).finally((()=>{this.syncPromise=null,this.isSynced=!0})),this.syncPromise):Promise.resolve()}add(e,t){if(!e||!this.maySync()||!this.isSynced)return[];let r=this.isModel(e)?[e]:e;return r=(0,a.default)((0,s.default)(r,(e=>e.isGif)),this.toArray(),((e,t)=>e.body===t.body)),super.add(r,t)}remove(e,t){if(!e||!this.maySync()||!this.isSynced)return[];let r=this.isModel(e)?[e]:e;return r=(0,i.default)((0,s.default)(r,(e=>e.isGif)),this.toArray(),((e,t)=>e.body===t.body)),super.remove(r,t)}}p.model=c.Msg,p.comparator=function(e,t){return t.t-e.t};var h=new p;t.default=h},19011:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredMsgCollection=t.AllStarredMsgsCollection=void 0,t.addStarredMsgs=function(e){p.add(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)})),c.default.add(e)},t.removeStarredMsgs=h;var i=n(r(45095)),a=r(1255),s=n(r(69618)),o=r(17304),l=r(59871),c=n(r(11810)),d=r(65044);class u extends a.BaseCollection{constructor(){super(),this.syncPromise=null,this.isSynced=!1,this.listenTo(d.Socket,"change:stream",(()=>{d.Socket.stream===d.STREAM.DISCONNECTED?this.isSynced=!1:d.Socket.stream===d.STREAM.CONNECTED&&this.delete()}))}process(e,t,r,n){n?this.delete():this.updateMsgs(e,t,r)}sync(e){if(this.isSynced)return Promise.resolve();if(null!=this.syncPromise)return this.syncPromise;const t=this;let r;const n=this.last();return n&&(r=n.id),this.syncPromise=l.MsgCollection.getStarred(e,s.default.PAGE_SIZE,r).then((function(e){e.length&&t.add(e,{silent:!0}),e.length<s.default.PAGE_SIZE&&(t.isSynced=!0)})).catch((function(){__LOG__(3)`starred msg sync error: `})).finally((()=>{t.syncPromise=null,t.trigger("sync")})),this.trigger("sync"),(0,i.default)(this.syncPromise,"syncPromise can not be null")}updateMsgs(e,t,r){const n=this.syncPromise||Promise.resolve();this.syncPromise=n.then((()=>{if(e){return(t.length>0?l.MsgCollection.incrementalStarredUpdate(t):Promise.resolve([])).then((e=>{const t=e.concat(r);this.isSynced&&(this.add(t,{silent:!0}),c.default.add(e)),t.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)})),this.trigger("sync")})).catch((()=>{__LOG__(3)`models:starred:update:error: `}))}h(t.concat(r).filter((e=>!e.star)))})).finally((()=>{this.syncPromise=null}))}delete(){this.isSynced=!1,super.delete()}}let p;function h(e){p.remove(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}))}t.StarredMsgCollection=u,u.model=o.Msg,u.comparator=(e,t)=>t.t-e.t,t.AllStarredMsgsCollection=p,t.AllStarredMsgsCollection=p=new u},67234:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(11290),a=n(r(39546));class s extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.status=(0,i.prop)(),this.stale=(0,i.session)(!0)}getCollection(){return r(46133).StatusCollection}}s.Proxy="status",s.idClass=a.default;var o=(0,i.defineModel)(s);t.default=o},46133:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCollectionImpl=t.StatusCollection=void 0;var i=r(50796),a=r(1255),s=n(r(67234)),o=r(82350),l=r(77591),c=n(r(39546)),d=r(58021);class u extends a.BaseCollection{onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,i.filteredCatch)(l.WebdDrop,(()=>{})))}))}_find(e){const t=e instanceof c.default?e:(0,d.createWid)(e);return(0,o.getStatus)(t)}handle(e){let[t]=e;const r=this.get(t.id);r&&(r.status=t.status,r.stale=!1)}}t.StatusCollectionImpl=u,u.model=s.default,u.idClass=c.default,u.staleCollection=!0,u.resumeOnAvailable=!0;const p=new u;t.StatusCollection=p},47896:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(15421)),s=r(11290),o=r(22683),l=n(r(69618)),c=r(19380),d=r(51316),u=r(30631),p=n(r(58492)),h=n(r(39546));const f=86400;class _ extends p.default{constructor(){super(...arguments),this.id=(0,s.prop)(),this.t=(0,s.prop)(),this.unreadCount=(0,s.prop)(0),this.totalCount=(0,s.prop)(0),this.pic=(0,s.prop)(),this._msgs=(0,s.prop)((()=>[])),this.readKeys=(0,s.session)((()=>({}))),this.contact=(0,s.session)(),this.expireTimer=(0,s.session)(),this.expireTs=(0,s.session)(),this.hasUnread=(0,s.derived)(this._hasUnread,["unreadCount"]),this.readCount=(0,s.derived)(this._readCount,["unreadCount","totalCount"]),this.lastStatus=(0,s.derived)(this._lastStatus,["msgsChanged","totalCount"])}_hasUnread(){return this.unreadCount>0}_readCount(){const e=this.totalCount-this.unreadCount;return Number.isFinite(e)?e:(__LOG__(3)`Bad status v3 read count, ${this.totalCount}, ${this.unreadCount}`,0)}_lastStatus(){return this.msgs.last()}initialize(){super.initialize(),this.addChild("contact",c.ContactCollection.gadd(this.id)),this.listenTo(this.msgs,"add bulk_add",(()=>{window.setTimeout((()=>{this.setupStatusExpiration()}))})),this.listenTo(this,"change:lastStatus",(()=>{this.lastStatus&&(this.t=this.lastStatus.t)}))}isExpired(){return this.id.isPSA()?(0,u.isExpiredStatusPSA)(this.msgs.toArray(),f):o.Clock.globalUnixTime()-this.t>f}setupStatusExpiration(){const e=this.msgs.at(0);if(!e)return;if("number"==typeof this.expireTs&&this.expireTs<=e.t)return;const t=e.t+f+1;t<o.Clock.globalUnixTime()?window.setTimeout((()=>{this.expireMsg()})):(this.expireTimer=a.default.setGlobalTimeout(this.expireMsg.bind(this),1e3*t,this.expireTimer),this.expireTs=e.t)}_removeSingleMsg(e){const t=this.msgs;this.unreadCount>this.totalCount-1&&this.unreadCount--,this.totalCount--,t.remove(e),e.delete()}expireMsg(){if(this.id.isPSA())return void this.expirePSAMsg();const e=this.msgs;for(;e.length>0;){const t=e.at(0);if(!t)break;if(t.t+f>o.Clock.globalUnixTime())break;this._removeSingleMsg(t)}this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}expirePSAMsg(){const e=(0,u.getPSACampaigns)(this.msgs.toArray());this.msgs.forEach((t=>{const{campaignId:r}=t;if(null==r)return;(0,u.isCampaignExpired)(e[r],f)&&this._removeSingleMsg(t)})),this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}revokeMsgs(e){this.msgs.forEach((t=>{e.includes(t.id)&&this._removeSingleMsg(t)})),0===this.totalCount&&(this.expireTs=void 0,this.expireTimer=void 0)}delete(){__LOG__(2)`Status v3 deleted with total count: ${this.totalCount}`,super.delete(),this.expireTimer&&a.default.clearTimeout(this.expireTimer),null!=this.expireTs&&(this.expireTs=void 0),this.getCollection().remove(this.id)}onEmptyMRM(){__LOG__(2)`Status V3 onEmptyMRM with total count: ${this.totalCount}, noEarlierMsgs: ${this.msgs.msgLoadState.noEarlierMsgs?"true":"false"}`,this.msgs.msgLoadState.noEarlierMsgs&&0===this.totalCount?this.delete():this.totalCount>0&&this.loadMore().catch((()=>{})).finally((()=>{this.msgs.length||this.delete()}))}loadMore(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.default.PAGE_SIZE;return(0,i.default)((function*(){if(e.msgs.msgLoadState.noEarlierMsgs)return Promise.resolve();if(e.msgs.msgLoadState.isLoadingEarlierMsgs)return e.msgs.loadEarlierPromise;const r=0!==t?t:l.default.PAGE_SIZE,n=e.getCollection();try{const t=yield n.loadMore(e.id,r,e.msgs.last());return Array.isArray(t)&&t.length<r&&(e.msgs.msgLoadState.noEarlierMsgs=!0),t}catch(t){return 404===t&&e.delete(),Promise.reject(t)}}))()}handleReadStatus(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0&&this.unreadCount--)}sendReadStatus(e,t,r){var n=this;return(0,i.default)((function*(){(yield(0,d.sendReadStatus)(e,t,r))&&n.handleReadStatus(e)}))()}getCollection(){return r(59387).StatusV3Collection}}_.Proxy="statusV3",_.idClass=h.default;var m=(0,s.defineModel)(_);t.default=m},59387:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3CollectionImpl=t.StatusV3Collection=void 0;var i=n(r(48926)),a=n(r(41609)),s=n(r(63105)),o=n(r(35161)),l=n(r(12297)),c=r(50796),d=r(86945),u=r(1255),p=r(22683),h=n(r(69618)),f=r(99234),_=r(7293),m=n(r(11339)),g=r(59871),y=n(r(34949)),E=r(51316),S=n(r(47896)),v=r(77591),T=r(58021);class A extends u.BaseCollection{delete(){super.delete(),delete this.checksum}_find(e){return Promise.resolve({id:e})}findQuery(e,t){var r=()=>super.findQuery,n=this;return(0,i.default)((function*(){const i=(yield r().call(n,e,t))||[];return yield Promise.all(i.map((e=>{if(!e)return;let t=0;return e.msgs.forEach((r=>{t<e._msgs.length&&e._msgs[t].id.toString()===r.id.toString()?++t:r.delete()})),e._msgs.length>0?n.addStatusMessages(e.id,e._msgs):Promise.resolve()}))),i}))()}_findQuery(){var e=this;return(0,i.default)((function*(){const t=yield(0,E.queryStatusAll)();return e.checksum=t.checksum,Promise.all(t.statuses.map((e=>{e.totalCount!==e._msgs.length&&e.totalCount<=20&&__LOG__(3)`Received ${e._msgs.length} status V3 messages when total count is ${e.totalCount} for ${e.id}`;const t=e.pic;return t?y.default.createFromData(t,"image/jpeg").then((t=>(e.pic=t,e))):e})))}))()}loadMore(e,t,r){return(0,i.default)((function*(){const n=yield(0,E.queryStatusUpdate)(e,t,null==r?void 0:r.id);return n.status>=400?(__LOG__(3)`model:statusv3:findQuery error ${n.status}`,Promise.reject(n.status)):(n.forEach((function(e){e.invis=!0})),__LOG__(2)`model:statusv3:loadMore:${n.length}`,g.MsgCollection.processMultipleMessages((0,T.createWid)(h.default.STATUS_WID),n,{add:"after",isHistory:!0}))}))()}sync(e){const t=window.performance.now();return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()}).catch((0,c.filteredCatch)(v.WebdDrop,(()=>{}))).finally((()=>{this.trigger("sync")})).then((e=>{const r=window.performance.now(),n=Math.round(r-t);return this.logMetrics({type:"sync",syncTime:n}),this.forEach((e=>{e.msgs.length>e.totalCount&&__LOG__(2)`Total count: ${e.totalCount}, msgs length: ${e.msgs.length}`})),e})):Promise.resolve(void 0)}logMetrics(e){let t;t="sync"===e.type?new m.default.WebcStatusSync({webcStatusSyncT:e.syncTime}):new m.default.WebcStatusSession({webcStatusSessionId:e.sessionId});const r=this.filter((e=>!e.contact.isMe)),n=r.filter((e=>!e.contact.statusMute)),i=n.filter((e=>e.hasUnread)),a=n.filter((e=>!e.hasUnread)),s=r.filter((e=>e.contact.statusMute)),o=(0,l.default)(n.map((e=>e.unreadCount))),c=(0,l.default)(n.map((e=>e.readCount))),d=(0,l.default)(s.map((e=>e.totalCount)));t.webcStatusRecentItemCount=o,t.webcStatusRecentRowCount=i.length,t.webcStatusViewedItemCount=c,t.webcStatusViewedRowCount=a.length,t.webcStatusMutedItemCount=d,t.webcStatusMutedRowCount=s.length,t.commit()}hasSynced(){return!!_.GK.supportsFeature(_.GK.F.MD_BACKEND)||!!this.checksum}handleUpdate(e,t,r){const n=e.id.fromMe?(0,f.getMaybeMeUser)():e.author;if(this.updateChecksum(t),this.hasSynced()){if(r)return!0;const t=this.get(n);if(t){const r=_.GK.supportsFeature(_.GK.F.MD_BACKEND)||t.totalCount===t.msgs.length;if("sender_revoke"===e.subtype){const r=t.msgs.toArray().slice(0,t.totalCount-t.unreadCount),n=(0,o.default)(r,(e=>e.id.toString())),i={totalCount:t.totalCount-1};n.find((t=>t===e.protocolMessageKey.toString()))||t.readKeys[e.protocolMessageKey.toString()]||(i.unreadCount=t.unreadCount-1),t.set(i)}else{const r={totalCount:t.totalCount+1};e.invis||(r.unreadCount=t.unreadCount+1),r.t=e.t,t.set(r)}return!r&&e.body&&y.default.createFromBase64Jpeg(e.body).then((e=>{t.pic=e})),r}return this.add({id:n,t:e.t,unreadCount:e.invis?0:1,totalCount:1}),!0}return!1}updateChecksum(e){e?this.hasSynced()&&(this.checksum=e):__LOG__(2)`models:statusV3:no_checksum`}handle(e){const t=e.shift();if(Array.isArray(t))__LOG__(3)`models:statusV3:unexpected update`;else switch(t.type){case"read":this.updateChecksum(t.checksum);const e=this.get(t.chat);e?e.handleReadStatus(t.key):__LOG__(2)`models:statusV3:read:no_status:${[t.chat,t.key].join()}`;break;default:__LOG__(3)`models:statusV3:unknown:${t.type}`}}addStatusMessages(e,t){return g.MsgCollection.processMultipleMessages((0,T.createWid)(h.default.STATUS_WID),t,{add:"after",isHistory:!0})}getUnexpired(e){let t=!1;_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&(t=(0,d.getABPropConfigValue)("web_status_psa"));const r=this.filter((e=>!(e.totalCount<=0)&&(!e.isExpired()&&(!e.contact.isMe&&(!!e.contact.isMyContact||!!e.contact.isPSA&&t)))));if(t&&r.sort(((e,t)=>e.contact.isPSA===t.contact.isPSA?0:e.contact.isPSA?-1:1)),e){return(0,s.default)(r,(e=>e.unreadCount>0))}return(0,s.default)(r,(e=>0===e.unreadCount))}getMyStatus(){const e=this.filter((e=>e.contact.isMe));if((0,a.default)(e));else if(!(p.Clock.globalUnixTime()-e[0].t>86400))return e[0]}getPSAStatus(){const e=this.filter((e=>e.contact.isPSA));if(0!==e.length)return e[0]}}t.StatusV3CollectionImpl=A,A.model=S.default,A.comparator=(e,t)=>t.t-e.t;const C=new A;t.StatusV3Collection=C},77040:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.sticker=(0,n.prop)(),this.timestamp=(0,n.prop)(),this.stickerHashWithoutMeta=(0,n.prop)()}}i.Proxy="favoriteSticker";var a=(0,n.defineModel)(i);t.default=a},70723:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(1255),s=n(r(57905)),o=r(22683),l=n(r(77040)),c=r(50338),d=r(55975),u=r(76214),p=r(89867);class h extends a.BaseCollection{_addSaveTask(){this._idleTaskId&&c.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=c.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=[];e.toArray().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,sticker:e.sticker.toDbData(),stickerHashWithoutMeta:e.stickerHashWithoutMeta};t.push(r)}));try{const e=(0,u.getFavoriteStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`FavoriteStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}_dbDataToModel(e){return new l.default({id:e.id,timestamp:e.timestamp,stickerHashWithoutMeta:e.stickerHashWithoutMeta,sticker:new p.StickerModel(e.sticker)})}_getStickerHashWithoutMeta(e){return(0,i.default)((function*(){const t=yield d.LruMediaStore.get(e);return null==t?e:(0,s.default)(t)}))()}addNewSticker(e){var t=this;return(0,i.default)((function*(){if(t.get(e.filehash))return;const r=new l.default({id:e.filehash,sticker:e,stickerHashWithoutMeta:yield t._getStickerHashWithoutMeta(e.filehash),timestamp:o.Clock.globalUnixTime()});t.add(r),t._addSaveTask()}))()}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.remove(e,t);return r.length&&this._addSaveTask(),r}initializeFromCache(e){const t=e.map((e=>this._dbDataToModel(e)));this.add(t),this._addSaveTask()}}h.model=l.default;var f=new h;t.default=f},14048:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,n.getABPropConfigValue)("web_sticker_store")};var n=r(86945)},20238:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.sticker=(0,n.prop)(),this.timestamp=(0,n.prop)(),this.msgId=(0,n.prop)()}}i.Proxy="recentSticker";var a=(0,n.defineModel)(i);t.default=a},91692:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionImpl=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=n(r(48926)),a=n(r(81109)),s=n(r(6479)),o=n(r(45095)),l=r(1255),c=r(17239),d=r(7293),u=n(r(75642)),p=r(89867),h=n(r(56891));const f=["weight"],_=32;t.RECENT_STICKERS_LIMIT=_;class m extends l.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._weightMap=new Map,this._sortTrimScale=()=>{const e=this.length;if(!e)return;if(this.sort(),e>_){for(let t=_;t<e;t++)this._weightMap.delete((0,o.default)(this.at(t),"this.at(i)").id);this.remove(this.models.slice(_))}const t=this.head(),r=this.last();t&&r&&this._getWeight(t)<10&&this._getWeight(r)>.01||this.forEach(((t,r)=>{this._weightMap.set(t.id,1+(e-r)/e*3)}))}}_comparator(e,t){return c.Conn.platform===c.PLATFORMS.ANDROID?this._getWeight(t)-this._getWeight(e):e.index>t.index?1:-1}_getWeight(e){return(0,o.default)(this._weightMap.get(e.id),"this._weightMap.get(sticker.id)")}_findQuery(){return d.GK.isRecentStickersEnabled()?d.GK.supportsFeature(d.GK.F.MD_BACKEND)?Promise.reject(new Error("This call is only supported in non-MD mode")):h.default.queryRecentStickers().then((e=>{let{checksum:t,stickers:r}=e;return this.setChecksum(t),c.Conn.platform===c.PLATFORMS.ANDROID&&(this._weightMap.clear(),r.forEach((e=>{let{id:t,weight:r}=e;this._weightMap.set(t,r)}))),r.map(((e,t)=>{let{weight:r}=e,n=(0,s.default)(e,f);return(0,a.default)((0,a.default)({},n),{},{mediaKey:(0,u.default)(n.mediaKey),index:t})}))})):Promise.reject(new Error("gk recent sticker sync unsupported"))}enqueue(e){d.GK.isRecentStickersEnabled()&&0!==e.length&&(c.Conn.platform===c.PLATFORMS.ANDROID?this._enqueueAndroid(e):this._enqueueiOS(e))}addStickerWithMediaData(e){const t=new p.StickerModel(e);t.id||(t.id=t.filehash),this.enqueue([t])}_enqueueAndroid(e){e.forEach((e=>{this.get(e.id)||(this._weightMap.set(e.id,0),this.add(e)),this.forEach((t=>{let r=this._getWeight(t);t.id===e.id?r+=1:r*=.9,this._weightMap.set(t.id,Math.round(1e3*r)/1e3)}))})),this._sortTrimScale()}_enqueueiOS(e){this.forEach(((e,t)=>{e.index=_+t}));const t=new Set(e.map((e=>e.id)));e.reduce(((e,r)=>t.has(r.id)?(t.delete(r.id),[r].concat(e)):e),[]).slice(0,_).forEach(((e,t)=>{const r=this.get(e.id);r?r.index=t:this.add({id:e.id,deprecatedMms3Url:e.deprecatedMms3Url,directPath:e.directPath,filehash:e.filehash,encFilehash:e.encFilehash,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,width:e.width,height:e.height,size:e.size,mimetype:e.mimetype,type:e.type,index:t})})),this.sort(),this.remove(this.slice(_))}setChecksum(e){this._checksum=e}sync(e){var t=this;return(0,i.default)((function*(){d.GK.isRecentStickersEnabled()&&(null!=e&&e===t._checksum||(yield t._sync()))}))()}_sync(){var e=this;return(0,i.default)((function*(){if("INPROGRESS"!==e._syncStatus){e._syncStatus="INPROGRESS";try{yield e.findQuery({},{set:!0}),e.sort(),e._syncStatus="SUCCESS"}catch(t){__LOG__(3)`collection:recent_sticker:_sync error `,e._syncStatus="FAILURE"}}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}reset(){return this._syncStatus="NONE",this._weightMap.clear(),super.reset()}}t.RecentStickerCollectionImpl=m,m.model=p.StickerModel;const g=new m;t.RecentStickerCollection=g},49264:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionMd=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=n(r(48926)),a=r(1255),s=r(22683),o=r(50338),l=r(88297),c=r(76214),d=r(59871),u=n(r(20238)),p=r(89867);t.RECENT_STICKERS_LIMIT=32;class h extends a.BaseCollection{constructor(){super(...arguments),this._hasInitializedFromCache=!1}_comparator(e,t){return e.timestamp<t.timestamp?1:-1}_dbDataToModel(e){return new u.default({id:e.id,timestamp:e.timestamp,msgId:e.msgId,sticker:new p.StickerModel(e.sticker)})}_addSaveTask(){this._idleTaskId&&o.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=o.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=[];e.toArray().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,sticker:e.sticker.toDbData(),msgId:e.msgId};t.push(r)}));try{const e=(0,c.getRecentStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`RecentStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}addStickerWithMediaData(e,t){this.addNewSticker(new p.StickerModel(e),t)}addNewSticker(e,t){e.id||(e.id=e.filehash),this.enqueue([[e,s.Clock.globalUnixTime(),t]])}enqueue(e){if(0===e.length)return;const t=new Set(e.map((e=>e[0].id))),r=e.reduce(((e,r)=>{let[n,i,a]=r;return t.has(n.id)?(t.delete(n.id),[[n,i,a]].concat(e)):e}),[]),n=[];let i=!1;r.forEach((e=>{let[t,r,a]=e;const s=this.get(t.id);if(s)s.timestamp<=r&&(s.timestamp=r,i=!0);else{const e=this._dbDataToModel({id:t.id,timestamp:r,sticker:t,msgId:a});n.push(e),i=!0}})),i&&(this.addAndSort(n),this._hasInitializedFromCache&&this._addSaveTask())}updateDirectPath(e,t){const r=this.get(e);(null==r?void 0:r.sticker)?(r.sticker.directPath=t,this.set([r],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask()):__LOG__(4,void 0,new Error)`updateDirectPaths called with a stickerId that doesn't match any in the collection`}updateStickerMediaData(e,t){const r=this.get(e);null!=t&&null!=r&&(t.directPath&&(r.sticker.directPath=t.directPath),t.encFilehash&&(r.sticker.encFilehash=t.encFilehash),t.mediaKey&&(r.sticker.mediaKey=t.mediaKey),t.mediaKeyTimestamp&&(r.sticker.mediaKeyTimestamp=t.mediaKeyTimestamp),this.set([r],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask())}stickersMissingDirerctPath(e){return e.filter((e=>null==e.sticker.directPath))}associateStickerWithMsg(e,t){return(0,i.default)((function*(){var r;const{messages:n}=yield d.MsgCollection.getMessagesById([t]),i=(null===(r=e.mediaObject)||void 0===r?void 0:r.associatedMsgs())||[];!e.mediaObject||0!==i.length&&n.some((e=>i.includes(e)))||(0,l.associateMediaWithMsg)(e.mediaObject,n[n.length-1])}))()}initializeFromCache(e){const t=e.map((e=>{const t=this._dbDataToModel(e);return this.associateStickerWithMsg(t.sticker,t.msgId),t})),r=this.toArray();if(this.addAndSort(t),r.length){const e=new Set(t.map((e=>e.id)));r.some((t=>e.has(t)))&&this._addSaveTask()}this._hasInitializedFromCache=!0}addAndSort(e){this.add(e),this.sort(),this.length>32&&this.set(this.toArray().slice(0,32))}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.remove(e,t);return r.length&&this._addSaveTask(),r}delete(){super.delete()}}t.RecentStickerCollection=h,h.model=u.default;const f=new h;t.RecentStickerCollectionMd=f},16774:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredStickerCollectionImpl=t.StarredStickerCollection=t.STARRED_STICKERS_PAGE_SIZE=void 0;var i=n(r(48926)),a=n(r(81109)),s=r(1255),o=r(7293),l=n(r(75642)),c=r(89867),d=n(r(56891));t.STARRED_STICKERS_PAGE_SIZE=24;class u extends s.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._currentPage=0,this._total=0}_findQuery(){return o.GK.isStarredStickersEnabled()?o.GK.supportsFeature(o.GK.F.MD_BACKEND)?Promise.reject(new Error("This call is only supported in non-MD mode")):d.default.queryStarredStickers(this._currentPage+1,24).then((e=>{let{checksum:t,total:r,stickers:n}=e;return this._checksum=t,this._currentPage+=1,this._total=r,n.map(((e,t)=>(0,a.default)((0,a.default)({},e),{},{mediaKey:(0,l.default)(e.mediaKey),index:this.length+t})))})):Promise.reject(new Error("gk starred sticker sync unsupported"))}add(e,t,r){return r&&(this._total+=1),super.add(e,t)}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._total-=1,super.remove(e,t)}syncNextPage(){return this.canLoadMore()?this._sync(!1).then((()=>{this.trigger("next_page_sync")})):Promise.resolve()}sync(e){return o.GK.isStarredStickersEnabled()&&(null==e||e!==this._checksum)?(this.reset(),this._sync(!0).then((()=>{this.trigger("sync")}))):Promise.resolve()}_sync(e){var t=this;return(0,i.default)((function*(){if("INPROGRESS"===t._syncStatus)return Promise.resolve();t._syncStatus="INPROGRESS";try{yield t.findQuery({},{set:e}),t._syncStatus="SUCCESS"}catch(e){__LOG__(3)`collection:starred_sticker:_sync error `,t._syncStatus="FAILURE"}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}canLoadMore(){return 0!==this._total&&this.length<this._total}getRemaining(){return this._total-this.length}reset(){return this._syncStatus="NONE",this._currentPage=0,this._checksum="",this._total=0,super.reset()}}t.StarredStickerCollectionImpl=u,u.model=c.StickerModel,u.comparator=(e,t)=>e.index>=t.index?1:-1;const p=new u;t.StarredStickerCollection=p},89867:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerModel=t.Sticker=void 0;var a=i(r(51463)),s=r(11290),o=r(22683),l=n(r(78986)),c=i(r(2320)),d=r(58668);const u=(0,a.default)((()=>new f({id:"placeholder",isPlaceholder:!0}))),p=(0,a.default)((()=>new f({id:"createButton",isCreateButton:!0})));class h extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.mediaData=(0,s.session)(),this.mediaObject=(0,s.prop)(),this.deprecatedMms3Url=(0,s.prop)(),this.directPath=(0,s.prop)(),this.filehash=(0,s.prop)(),this.height=(0,s.prop)(),this.index=(0,s.prop)(),this.mediaKey=(0,s.prop)(),this.mediaKeyTimestamp=(0,s.prop)(),this.mimetype=(0,s.prop)(),this.size=(0,s.prop)(),this.type=(0,s.prop)(d.OUTWARD_TYPES.STICKER),this.encFilehash=(0,s.prop)(),this.width=(0,s.prop)(),this.stickerPackId=(0,s.prop)(),this.stickerPackName=(0,s.prop)(),this.stickerPackPublisher=(0,s.prop)(),this.isPlaceholder=(0,s.prop)(),this.isCreateButton=(0,s.prop)()}initialize(){super.initialize(),this.addChild("mediaData",new c.default),this.isPlaceholder||this.isCreateButton||l.registerSticker(this)}downloadMedia(){return l.downloadStickerOrStickerPackIcon(this,"STICKER").catch((e=>{__LOG__(4,void 0,new Error,!0)`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker download failed")}))}toDbData(){return{id:this.id||this.filehash,index:this.index||0,width:this.width,height:this.height,size:this.size,mimetype:this.mimetype,filehash:this.filehash,directPath:this.directPath,mediaKey:this.mediaKey,mediaKeyTimestamp:null!=this.mediaKeyTimestamp?this.mediaKeyTimestamp:o.Clock.globalUnixTime(),encFilehash:this.encFilehash,deprecatedMms3Url:this.deprecatedMms3Url,type:d.OUTWARD_TYPES.STICKER}}delete(){super.delete(),l.deregisterSticker(this)}}t.Sticker=h,h.Proxy="sticker",h.getPlaceholder=u,h.getCreateButton=p;const f=(0,s.defineModel)(h);t.StickerModel=f,f.getPlaceholder=u},67963:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickerCollectionImpl=t.StickerCollection=t.FETCH_STATE=void 0;var n=r(1255),i=r(89867);t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};class a extends n.BaseCollection{fetch(){throw new Error(`${this.constructor.name}.fetch is not implemented`)}}t.StickerCollectionImpl=a,a.model=i.StickerModel;const s=new a;t.StickerCollection=s},74470:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackModel=t.StickerPack=t.PRE_PLACEHOLDER_ID=void 0;var i=r(11290),a=n(r(2320)),s=r(58668),o=r(63488);const l="placeholder:";t.PRE_PLACEHOLDER_ID=l;const c=e=>{let{index:t,page:r}=e;return new u({id:`placeholder:${t}`,index:t,page:r})};class d extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.index=(0,i.prop)(),this.name=(0,i.prop)(),this.page=(0,i.prop)(),this.url=(0,i.prop)(),this.mimetype=(0,i.prop)("image/png"),this.mediaData=(0,i.session)(),this.mediaObject=(0,i.prop)(),this.directPath=(0,i.prop)(),this.filehash=(0,i.prop)(),this.mediaKey=(0,i.prop)(),this.mediaKeyTimestamp=(0,i.prop)(),this.size=(0,i.prop)(),this.type=(0,i.prop)(s.OUTWARD_TYPES.IMAGE),this.encFilehash=(0,i.prop)(),this.deprecatedMms3Url=(0,i.derived)(this._deprecatedMms3Url,["url","isFirstParty"]),this.stickers=(0,i.derived)(this._getStickersCollection,["id"]),this.isPlaceholder=(0,i.derived)(this._isPlaceholder,["id"]),this.isFirstParty=(0,i.derived)(this._isFirstParty,["url","mediaKey"])}_deprecatedMms3Url(){return this.isFirstParty?"":this.url}_isPlaceholder(){return d.isPlaceholderId(this.id)}_isFirstParty(){return Boolean(this.url)&&!this.mediaKey}_getStickersCollection(){return this._stickers=this._stickers||new o.StickerPackStickerCollection(this.id.split("#")[0],this.isFirstParty),this._stickers}initialize(){super.initialize(),this.isPlaceholder||this.isFirstParty||(this.addChild("mediaData",new a.default({renderableUrl:""})),r(78986).registerStickerPackIcon(this))}downloadMedia(){return this.isPlaceholder||this.isFirstParty?Promise.resolve():r(78986).downloadStickerOrStickerPackIcon(this,"STICKER_PACK").catch((e=>{__LOG__(4,void 0,new Error,!0)`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker-pack download failed")}))}delete(){super.delete(),r(78986).deregisterStickerPackIcon(this)}}t.StickerPack=d,d.Proxy="stickerPack",d.createPlaceholder=c,d.isPlaceholderId=e=>new RegExp("^placeholder:").test(e);const u=(0,i.defineModel)(d);t.StickerPackModel=u,u.createPlaceholder=c,u.isPlaceholderId=d.isPlaceholderId},66299:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackCollectionImpl=t.StickerPackCollection=t.PAGE_SIZE_POPUP=t.PAGE_SIZE_COMPOSE_BOX=t.PAGE_FETCH_STATE=void 0;var i=n(r(81109)),a=n(r(48926)),s=n(r(98913)),o=n(r(78718)),l=r(89385),c=n(r(70714)),d=r(1255),u=n(r(84644)),p=r(74470),h=n(r(56891));t.PAGE_SIZE_COMPOSE_BOX=9;t.PAGE_SIZE_POPUP=6;const f={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};t.PAGE_FETCH_STATE=f;class _ extends d.BaseCollection{constructor(){super(),this.checksum=null,this._pageFetchRequests={},this.pageFetchStates={},this._handleChecksumChange=()=>{Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),this._resetRangeWithPlaceholders(0,this.length),this.fetchAt(0,!1,!0)},this.listenTo(this,"change:checksum",this._handleChecksumChange)}createPlaceholder(e){return _.createPlaceholder(e)}preFetch(){var e=this;return(0,a.default)((function*(){yield e.fetchAt(0).then((()=>Promise.all(e.filter((e=>e.isFirstParty)).map((e=>e.stickers.fetch())))))}))()}fetchAt(e,t,r){return this._fetchPageWithIndex(e,Boolean(t),Boolean(r))}hasFetchedData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===f.SUCCESS))}isFetchingData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===f.PENDING))}pageWithIndex(e){return _.pageWithIndex(e)}reset(){return this.setChecksum(null,{silent:!0}),Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),super.reset()}sync(e){this.setChecksum(e)}setChecksum(e,t){if(this.checksum!==e){this.checksum=e;return(null==t?void 0:t.silent)||this.trigger("change:checksum",e),!0}return!1}_fetchPageWithIndex(e,t,r){const n=this.pageWithIndex(e);return this._fetchPage(n,t,r)}_fetchPage(e,t,r){const n=this.pageFetchStates[e];if(t&&n!==f.PENDING){const t=this._pageFetchRequests[e];t&&(t.controller.abort(),delete this._pageFetchRequests[e])}if(this._pageFetchRequests[e])return this._pageFetchRequests[e].promise;const i=this.length;this._insertPagePlaceholders(e),this._setFetchPageState(e,f.PENDING);const a=new c.default,s=a.signal,o=(0,u.default)(h.default.queryStickerPacks(e,9),s).then((t=>{if(s.aborted)throw new l.AbortError;const n=this._parseStickerPacksRes(e,t),a=r||this.setChecksum(t.checksum,{silent:!0}),o=9*(e-1),c=9*(e+0);this._resetRange(o,c,n),a&&(this._resetRangeWithPlaceholders(0,o),this._resetRangeWithPlaceholders(Math.min(o+n.length,c),t.count));const d=this.length;i!==d&&this.trigger("change:length",d),this._setFetchPageState(e,f.SUCCESS)})).catch((t=>{if(t.name===l.ABORT_ERROR)return __LOG__(2)`StickerPack page fetch promise cancelled: ${e}`,void this._unsetFetchPageStateAndPromise(e);this._setFetchPageState(e,f.ERROR)}));return this._pageFetchRequests[e]={promise:o,controller:a},o}_insertPagePlaceholders(e){const t=e-1;this._resetRangeWithPlaceholders(9*t,9*(t+1))}_parseStickerPacksRes(e,t){if(200!==t.status||!t.data)throw new Error("sticker packs query error");return t.data.map(((t,r)=>(0,i.default)((0,i.default)({},(0,o.default)(t,["id","mimetype","name","url","mediaKey","filehash","directPath"])),{},{encFilehash:t.encFilehash,page:e,index:9*(e-1)+r})))}_resetRangeWithPlaceholders(e,t){this._resetRange(e,t,(0,s.default)(t-e,(t=>_.createPlaceholder(e+t))))}_resetRange(e,t,r){this._forEachInRange(e,t,((t,n)=>{const i=r[n-e];if(t)if(i)t.id===i.id?(this.remove(t,{silent:!0}),this.add(i)):(this.remove(t),this.add(i));else{let e=t;for(;e;)this.remove(e),e=this.at(n)}else i&&this.add(i)}))}_forEachInRange(e,t,r){for(let n=e;n<t;n++){r(this.at(n),n)}}_resetFetchPageStateAndPromise(e){if(e in this.pageFetchStates){var t;if(this.pageFetchStates[e]===f.PENDING)null===(t=this._pageFetchRequests[e])||void 0===t||t.controller.abort();else this._unsetFetchPageStateAndPromise(e)}}_setFetchPageState(e,t){this.pageFetchStates[e]!==t&&(this.pageFetchStates[e]=t,this.trigger("change:pageFetchStates",e,t))}_unsetFetchPageState(e){e in this.pageFetchStates&&(delete this.pageFetchStates[e],this.trigger("change:pageFetchStates",e))}_unsetFetchPageStateAndPromise(e){delete this._pageFetchRequests[e],this._unsetFetchPageState(e)}}t.StickerPackCollectionImpl=_,_.model=p.StickerPackModel,_.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},_.createPlaceholder=function(e){return p.StickerPackModel.createPlaceholder({index:e,page:this.pageWithIndex(e)})},_.pageWithIndex=function(e){return Math.floor(e/9)+1};const m=new _;t.StickerPackCollection=m},63488:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"FETCH_STATE",{enumerable:!0,get:function(){return h.FETCH_STATE}}),t.StickerPackStickerCollection=void 0;var i=n(r(81109)),a=n(r(78718)),s=r(22683),o=n(r(69618)),l=r(77905),c=r(7293),d=n(r(14048)),u=r(67963),p=n(r(56891)),h=r(67963);class f extends u.StickerCollectionImpl{constructor(e,t){super(),this._parseStickersRes=e=>{if(200!==e.status||!e.data)throw new Error("sticker pack stickers query error");return e.data.map(((e,t)=>(0,i.default)((0,i.default)({},(0,a.default)(e,["directPath","mimetype","mediaKey","filehash","width","height"])),{},{index:t,id:e.filehash,deprecatedMms3Url:e.url,encFilehash:e.encFilehash,mediaKeyTimestamp:0})))},this.stickerPackId=e,this.isFirstParty=t,this._firstPartyFetchTimestamp=null;const r=f._cache[this.stickerPackId];if(r)return r;let n;const s=this;Object.defineProperty(this,"fetchState",{get:()=>n,set(e){n!==e&&(n=e,s.trigger("change:fetchState",e))}})}fetch(e){var t;const n=c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&(0,d.default)()&&this.isFirstParty&&s.Clock.globalUnixTime()-(null!==(t=this._firstPartyFetchTimestamp)&&void 0!==t?t:0)>=o.default.STICKER_PACK_FETCH_TIMEOUT;if((e||n)&&this.fetchState!==u.FETCH_STATE.PENDING&&delete this._fetchPromise,this._fetchPromise)return this._fetchPromise;this.fetchState=u.FETCH_STATE.PENDING;if(r(74470).StickerPackModel.isPlaceholderId(this.stickerPackId))return this._fetchPromise=new Promise((()=>{})),this._fetchPromise;let i;return this.isFirstParty?(c.GK.supportsFeature(c.GK.F.MD_BACKEND)&&(0,d.default)()&&(this._firstPartyFetchTimestamp=s.Clock.globalUnixTime()),i=(0,l.fetchFirstPartyStickers)(this.stickerPackId)):i=p.default.queryStickersInStickerPack(this.stickerPackId).then(this._parseStickersRes),this._fetchPromise=i.then((e=>{const t=Math.max(this.length||e.length);this._resetRange(0,t,e),this.fetchState=u.FETCH_STATE.SUCCESS})).catch((()=>{this.fetchState=u.FETCH_STATE.ERROR})),this._fetchPromise}_resetRange(e,t,r){this._forEachInRange(e,t,((t,n)=>{const i=r[n-e];t?i?t.id===i.id?t.set(i):(this.remove(t),this.add(i)):this.remove(t):i&&this.add(i)}))}_forEachInRange(e,t,r){for(let n=e;n<t;n++){r(this.at(n),n)}}}t.StickerPackStickerCollection=f,f._cache={},f.comparator=(e,t)=>e.index<t.index?-1:e.index>t.index?1:0},8080:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StreamMode=t.StreamInfo=t.Stream=t.Obscurity=void 0;var a=i(r(23279)),s=r(57319),o=r(11290),l=r(88102),c=i(r(69618)),d=r(99234),u=r(7293),p=i(r(11339)),h=r(58052),f=i(r(57220)),_=r(71119),m=n(r(6604)),g=r(371),y=r(29898),E=r(25906),S=r(65044);const v=r(54302).Mirrored(["OFFLINE","OPENING","PAIRING","SYNCING","RESUMING","CONNECTING","NORMAL","TIMEOUT"]);t.StreamInfo=v;const T=r(54302).Mirrored(["QR","MAIN","SYNCING","OFFLINE","CONFLICT","PROXYBLOCK","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION"]);t.StreamMode=T;const A=r(54302).Mirrored(["SHOW","OBSCURE","HIDE"]);t.Obscurity=A;class C extends o.BaseModel{constructor(){super(...arguments),this.info=(0,o.session)(v.NORMAL),this.mode=(0,o.session)(T.SYNCING),this.obscurity=(0,o.session)(A.HIDE),this.needsUpdate=(0,o.session)(),this.clientExpired=(0,o.session)(!1),this.hardExpired=(0,o.session)(!1),this.lastSyncStart=(0,o.session)(M()),this.needsManualDownload=(0,o.session)(),this.couldForce=(0,o.session)(),this.uiActive=(0,o.session)(),this.available=(0,o.session)(!0),this.unavailableShiftTimer=(0,o.session)(),this.unavailableLogoutTimer=(0,o.session)(),this.unobscureShiftTimer=(0,o.session)(),this.timeoutEvent=(0,o.session)(),this.resumeCount=(0,o.session)(0),this.phoneAuthed=(0,o.session)(!1),this._activeModeMeasure=(0,o.session)(),this.displayInfo=(0,o.derived)(this._displayInfo,["info","obscurity"])}_displayInfo(){return function(e,t){switch(t){case A.SHOW:return e;case A.HIDE:return S.Socket.hasSynced?v.NORMAL:v.CONNECTING;case A.OBSCURE:switch(e){case v.OPENING:case v.PAIRING:case v.SYNCING:case v.RESUMING:return v.CONNECTING;default:return e}}return __LOG__(3)`Stream:unknown obscure level:`,e}(this.info,this.obscurity)}initialize(){super.initialize(),u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!(0,h.isRegistered)()&&(this.mode=T.QR),this._activeModeMeasure=m.startMeasure(`Stream.mode: ${this.mode}`),__LOG__(2)`Stream:rememberMe: ${String((0,d.getRememberMe)())}`,this.unavailableShiftTimer=new s.ShiftTimer((()=>this.markUnavailable())),this.unobscureShiftTimer=new s.ShiftTimer((()=>this.unobscure())),this.unavailableLogoutTimer=new s.ShiftTimer((function(){(0,d.getRememberMe)()||(__LOG__(2)`Stream:unavailableLogoutTimer logout due to inactivity`,S.Socket.logout())})),this.listenTo(S.Socket,"change:state change:stream change:hasSynced",this.onSocketUpdate),this.listenTo(f.default,"change:online",this.onSocketUpdate),this.listenTo(this,"change:available",this.onAvailableUpdate),this.listenTo(this,"change:phoneAuthed",this.onPhoneAuthedUpdate),this.listenTo(this,"change:info change:displayInfo change:mode",(0,a.default)(this.onSelfUpdate)),this.listenTo(this,"change:info",this.logPageResume),this.listenTo(this,"change:info",this.updateWamLog),this.listenTo(this,"change:mode",this.logModeChange),this.listenTo(this,"change:available change:uiActive",this.updateCouldForce),this.listenTo(l.Cmd,"midnight",this.updateHardExpire.bind(this)),u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&this.listenTo(l.Cmd,"socket_stream_disconnected",(()=>{r(68315).PresenceCollection.clearAllPresence()})),window.document&&document.addEventListener("visibilitychange",this.updateCouldForce),this.updateCouldForce(),this.updateHardExpire()}delete(){}markAvailable(){this.unavailableShiftTimer.cancel(),this.available=!0}markUnavailable(e){null!=e&&0!==e?this.unavailableShiftTimer.onOrBefore(e):(this.unavailableShiftTimer.cancel(),this.available=!1)}onSelfUpdate(){__LOG__(2)`Stream:onSelfUpdate mode:${this.mode} info:${this.info} view:${this.displayInfo}`;let e=this.timeoutEvent;if(this.info===v.TIMEOUT)e||(this.timeoutEvent=e=new p.default.WebcPhoneDisconnected),this.displayInfo===v.TIMEOUT&&null==this._bbarTime&&(this._bbarTime=Date.now());else if(e){e.markWebcPhoneDisconnectedT();const t=this._bbarTime;null!=t&&(e.webcPhoneBbarShownT=Date.now()-t),e.commit(),this.timeoutEvent=null,this._bbarTime=null}this.mode===T.MAIN&&l.Cmd.readyForMainStreamModeLegacy()}onSocketUpdate(){const e={},t=function(){switch(S.Socket.state){case S.STATE.TIMEOUT:return v.TIMEOUT;case S.STATE.OPENING:return f.default.online?v.OPENING:v.OFFLINE;case S.STATE.PAIRING:return S.Socket.hasSynced?v.RESUMING:v.PAIRING;case S.STATE.CONNECTED:return S.Socket.stream!==S.STREAM.CONNECTED?S.Socket.hasSynced?v.NORMAL:v.SYNCING:v.NORMAL;case S.STATE.UNLAUNCHED:case S.STATE.PROXYBLOCK:default:return v.NORMAL}}();if(e.info=t,e.mode=function(){let e=!1;e=u.GK.supportsFeature(u.GK.F.MD_BACKEND)?(0,h.isRegistered)():(0,d.knowsPhone)();if(!e&&S.Socket.state!==S.STATE.PROXYBLOCK)return T.QR;const t=S.Socket.hasSynced;switch(S.Socket.state){case S.STATE.PROXYBLOCK:return T.PROXYBLOCK;case S.STATE.CONFLICT:return T.CONFLICT;case S.STATE.TOS_BLOCK:return T.TOS_BLOCK;case S.STATE.SMB_TOS_BLOCK:return T.SMB_TOS_BLOCK;case S.STATE.DEPRECATED_VERSION:return T.DEPRECATED_VERSION;case S.STATE.UNLAUNCHED:return T.SYNCING;case S.STATE.UNPAIRED_IDLE:case S.STATE.UNPAIRED:return T.QR;case S.STATE.OPENING:if(!f.default.online&&!S.Socket.hasSynced)return T.OFFLINE;default:return t||S.Socket.stream===S.STREAM.CONNECTED?T.MAIN:T.SYNCING}}(),e.phoneAuthed=S.Socket.stream!==S.STREAM.DISCONNECTED,t===v.NORMAL)this.unobscureShiftTimer.cancel(),e.obscurity=A.HIDE;else if(t===v.OFFLINE)this.unobscureShiftTimer.cancel(),e.obscurity=A.OBSCURE;else switch(this.obscurity){case A.HIDE:this.unobscureShiftTimer.onOrBefore(c.default.DIAGNOSTIC_DELAY);break;case A.OBSCURE:this.unobscureShiftTimer.onOrBefore(3e3);break;case A.SHOW:}this.set(e)}unobscure(){this.obscurity=A.SHOW}onPhoneAuthedUpdate(){if(this.phoneAuthed){this.sendAvailability(!0);r(92671).RecentEmojiCollection.sync()}}onAvailableUpdate(){const e=this.available;if(__LOG__(2)`Stream:onAvailableUpdate user ${e?"available":"unavailable"}`,e||(0,d.getRememberMe)()?this.unavailableLogoutTimer.cancel():this.unavailableLogoutTimer.onOrBefore(c.default.IDLE_TIMEOUT_WAIT),this.sendAvailability(!1),u.GK.supportsFeature(u.GK.F.MD_BACKEND))if(e){const{sendDeliveryReceiptsAfterPresence:e}=r(7992);e()}else{r(68315).PresenceCollection.clearAllPresence()}}sendAvailability(e){(e||this.uiActive)&&(this.available?(0,g.sendPresenceAvailable)():(0,g.sendPresenceUnavailable)())}updateCouldForce(){this.couldForce=!this.uiActive||!this.available&&document.hidden}updateHardExpire(){y.Updater.isExpired()&&(this.hardExpired=!0,y.Updater.restart(!0))}logPageResume(){this.info===v.RESUMING&&(this.resumeCount++,new p.default.WebcPageResume({webcResumeCount:this.resumeCount}).commit())}updateWamLog(){const e=this.info===v.NORMAL;(0,_.streamInfoChange)(this.info,E.WatchedSocketModel.numSocketsAttempted,e),e&&this.stopListening(this,"change:info",this.updateWamLog)}logModeChange(){this._activeModeMeasure&&this._activeModeMeasure.end(),this.mode===T.SYNCING&&(this.lastSyncStart=M()),this._activeModeMeasure=m.startMeasure(`Stream.mode: ${this.mode}`),new p.default.WebcStreamModeChange({webcStreamMode:b(this.mode)}).commit()}}function b(e){switch(e){case T.QR:return p.default.WEBC_STREAM_MODE_CODE.QR;case T.MAIN:return p.default.WEBC_STREAM_MODE_CODE.MAIN;case T.SYNCING:return p.default.WEBC_STREAM_MODE_CODE.SYNCING;case T.OFFLINE:return p.default.WEBC_STREAM_MODE_CODE.OFFLINE;case T.CONFLICT:return p.default.WEBC_STREAM_MODE_CODE.CONFLICT;case T.PROXYBLOCK:return p.default.WEBC_STREAM_MODE_CODE.PROXYBLOCK;case T.DEPRECATED_VERSION:return p.default.WEBC_STREAM_MODE_CODE.DEPRECATED_VERSION;case T.TOS_BLOCK:case T.SMB_TOS_BLOCK:return p.default.WEBC_STREAM_MODE_CODE.TOS_BLOCK}}C.Proxy="stream";const P=new((0,o.defineModel)(C));function M(){return Math.floor(window.performance.now())}t.Stream=P},58492:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(82569)),a=n(r(85564)),s=r(11290),o=r(51612);class l extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.pendingMsgs=(0,s.prop)(),this.labels=(0,s.prop)(),this.msgChunks=(0,s.session)((()=>[])),this.lastReceivedKey=(0,s.session)(),this.unreadMsgAnchor=(0,s.session)(),this.disableUnreadAnchor=(0,s.session)(),this.msgsLength=(0,s.session)(),this.msgsChanged=(0,s.session)(0),this.msgs=(0,s.collection)(o.ChatMsgsCollection)}initialize(){super.initialize(),this.listenTo(this.msgs,"change:last",(()=>{this.msgsChanged++})),this.listenTo(this.msgs,"add remove bulk_add",(()=>{this.msgsChanged++,this.msgsLength=this.msgs.length}))}onEmptyMRM(){throw new Error("onEmptyMRM not implemented")}delete(){super.delete(),this.getAllCMCs().forEach((e=>{e.forEach((e=>{e.delete()})),e.delete()}))}removeMsg(e){const t=e.msgChunk;if(!t)return;t.indexOf(e)<0||(__LOG__(2)`models:Chat:removeMsg ${e.get("id")}`,t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}getAllCMCs(){return this.msgChunks.concat([this.msgs])}getAllMsgs(){return(0,a.default)(this.getAllCMCs().map((e=>e.getModelsArray())))}replaceMsgsCollection(e){__LOG__(2)`model:Chat:replaceMsgsCollection:${this.id.toString()}`;const t={msg:e.last()};this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs,t),this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}removeMsgsCollection(e){this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}notifyMsgCollectionMerge(e,t,r,n){this.trigger("change:cmc:merge",e,t,r,n)}}t.default=l},11897:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.displayText=(0,n.prop)(),this.subtype=(0,n.prop)(),this.url=(0,n.prop)(),this.phoneNumber=(0,n.prop)(),this.selectionId=(0,n.prop)(),this.selected=(0,n.session)(!1)}}i.Proxy="templateButton";var a=(0,n.defineModel)(i);t.default=a},82988:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateButtonCollection=void 0;var i=r(1255),a=n(r(11897));class s extends i.BaseCollection{}t.TemplateButtonCollection=s,s.model=a.default,s.comparator=(e,t)=>e.id<t.id?-1:e.id>t.id?1:0},86500:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1255),i=r(17304);class a extends n.BaseCollection{}t.default=a,a.model=i.Msg,a.comparator=function(e,t){return t.t-e.t}},41809:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290);class i extends n.BaseModel{constructor(){super(...arguments),this.id=(0,n.prop)(),this.timestamp=(0,n.prop)()}}i.Proxy="unreadMention";var a=(0,n.defineModel)(i);t.default=a},91036:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateDisappearingMode=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(19380),s=r(10435),o=r(27211),l=r(58021);function c(){return(c=(0,i.default)((function*(e,t,r){if(!(0,s.isDisappearingModeEnabled)())return Promise.resolve();const n=(0,l.createUserWid)(e.user),i=a.ContactCollection.get(n);if(i){const{disappearingModeSettingTimestamp:e}=i;if(null==e&&0!==r||null!=e&&e<r){const e={disappearingModeDuration:t,disappearingModeSettingTimestamp:r};yield(0,o.updateLocal)(n,e),i.set(e),__LOG__(2)`updateDisappearingMode: Contact=${n.toString()} updated, new duration=${t} t=${r}.`}}}))).apply(this,arguments)}},91932:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(11290),i=r(49835);class a extends n.BaseModel{constructor(){super(...arguments),this.callId=(0,n.prop)(),this.peerJid=(0,n.prop)(),this.pc=(0,n.prop)(),this.answer=(0,n.prop)(),this.localStream=(0,n.prop)(),this.remoteAudioStream=(0,n.prop)(),this.remoteVideoStream=(0,n.prop)(),this._state=(0,n.prop)(i.WEB_CALL_STATES.NONE)}getState(){return this._state}setState(e){const t=e;(function(e,t){const r=e||i.WEB_CALL_STATES.NONE;return t in o[r]})(this._state,t)&&(this._state=t)}}a.Proxy="webCall";var s=(0,n.defineModel)(a);t.default=s;const o={NONE:{[i.WEB_CALL_STATES.OUTGOING_CALLING]:!0,[i.WEB_CALL_STATES.INCOMING_CALLING]:!0},OUTGOING_CALLING:{[i.WEB_CALL_STATES.ACTIVE]:!0,[i.WEB_CALL_STATES.NONE]:!0},INCOMING_CALLING:{[i.WEB_CALL_STATES.ACTIVE]:!0,[i.WEB_CALL_STATES.NONE]:!0},ACTIVE:{[i.WEB_CALL_STATES.NONE]:!0}}},19037:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={cache:{},delete(){this.cache={}}};t.default=r},65044:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=t.STREAM=t.STATE=void 0;var a=i(r(48926)),s=i(r(6410)),o=i(r(82569)),l=i(r(63105)),c=i(r(2525)),d=i(r(91966)),u=i(r(13218)),p=i(r(78718)),h=i(r(35161)),f=i(r(41609)),_=r(89385),m=r(15688),g=r(8584),y=r(40265),E=r(50796),S=r(13959),v=r(4352),T=r(38284),A=i(r(38469)),C=i(r(30381)),b=r(86945),P=r(67146),M=r(11290),O=i(r(87045)),I=n(r(85965)),w=i(r(4550)),R=i(r(69048)),D=r(22683),N=r(88102),L=r(24747),k=r(17239),G=i(r(66405)),U=i(r(69618)),F=r(10786),x=n(r(64103)),B=r(27086),K=r(99234),Y=r(7293),j=r(57701),W=r(77303),H=r(16703),V=i(r(92417)),$=r(83578),z=r(46582),q=r(76214),J=r(58052),Q=i(r(51783)),X=r(85417),Z=n(r(49603)),ee=i(r(7353)),te=n(r(17117)),re=r(64551),ne=i(r(68132)),ie=i(r(26445)),ae=r(318),se=i(r(39142)),oe=r(24439),le=i(r(59402)),ce=n(r(22906)),de=r(14892),ue=r(29898),pe=i(r(47221)),he=i(r(15078)),fe=r(24465),_e=r(25906),me=r(77591);const{FLAVOR_TAGS:ge,VERSION:ye,LOGOUT_URL:Ee,SOCKET_STATE:Se,SOCKET_STREAM:ve,SPEEDY_RESUME_MAX_CHATS:Te}=U.default;t.STREAM=ve,t.STATE=Se;class Ae extends((0,y.customError)("ExternalPoke")){}class Ce extends((0,y.customError)("MustExitLoop")){}class be extends((0,y.customError)("Denied401Failed")){}class Pe extends((0,y.customError)("Denied409Conflict")){}class Me extends((0,y.customError)("DeniedTOS")){}class Oe extends((0,y.customError)("DeniedTOSGDPR",!0,Me)){}class Ie extends((0,y.customError)("DeniedTOSSMB",!0,Me)){}class we extends((0,y.customError)("DeniedUnknown")){}class Re extends((0,y.customError)("ForcedRefresh")){}class De extends((0,y.customError)("TooManyRefRequest")){}class Ne extends((0,y.customError)("UILogout")){}class Le extends((0,y.customError)("WindowOffline")){}class ke extends((0,y.customError)("PhoneFailedPing")){}class Ge extends((0,y.customError)("AssertionFailed")){}class Ue extends((0,y.customError)("TakeoverRequested")){}class Fe extends((0,y.customError)("PhoneReplacedClient")){}class xe extends((0,y.customError)("NoSecretBundle")){}class Be extends((0,y.customError)("PhoneKickedClient")){}class Ke extends((0,y.customError)("TempServerError")){}const Ye={SYNC_INFO:["Conn",ie.default.OBJECT],CHALLENGE:["Cmd",{type:"challenge",challenge:ie.default.STRING}],DISCONNECT:["Cmd",{type:"disconnect",kind:void 0}],HARD_REFRESH:["Cmd",{type:"update"}],UPGRADE_MD_FOR_INTERNAL_USER:["Cmd",{type:"upgrade_md"}],UPGRADE_MD_FOR_PROD:["Cmd",{type:"upgrade_md_prod",version:void 0}],PONG:["Pong",ie.default.BOOLEAN]},je={TAG:e=>new ie.default({tag:e,data:ie.default.ANY,binarySize:ie.default.ANY}),SYNC_INFO:new ie.default({tag:ie.default.ANY,data:Ye.SYNC_INFO,binarySize:ie.default.ANY}),CHALLENGE:new ie.default({tag:ie.default.ANY,data:Ye.CHALLENGE,binarySize:ie.default.ANY}),DISCONNECT:new ie.default({tag:ie.default.ANY,data:Ye.DISCONNECT,binarySize:ie.default.ANY}),HARD_REFRESH:new ie.default({tag:ie.default.ANY,data:Ye.HARD_REFRESH,binarySize:ie.default.ANY}),UPGRADE_MD_FOR_INTERNAL_USER:new ie.default({tag:ie.default.ANY,data:Ye.UPGRADE_MD_FOR_INTERNAL_USER,binarySize:ie.default.ANY}),UPGRADE_MD_FOR_PROD:new ie.default({tag:ie.default.ANY,data:Ye.UPGRADE_MD_FOR_PROD,binarySize:ie.default.ANY}),PONG:new ie.default({tag:ie.default.ANY,data:Ye.PONG,binarySize:ie.default.ANY})},We=new ie.default({status:e=>"number"==typeof e&&e>=500,_:void 0}),He=new ie.default({status:e=>"number"==typeof e&&499===e,_:void 0}),Ve=new ie.default({status:e=>"number"==typeof e,_:void 0});class $e extends M.BaseModel{constructor(){super(...arguments),this.socketPreload=(0,M.session)(),this.socket=(0,M.session)(),this.launchGeneration=(0,M.session)(0),this.backoffGeneration=(0,M.session)(0),this.hasSynced=(0,M.session)(),this.state=(0,M.session)(Se.UNLAUNCHED),this.stream=(0,M.session)(ve.DISCONNECTED),this.canSend=(0,M.session)(),this.sendQueue=(0,M.session)(),this.sendHash=(0,M.session)(),this.cancelHash=(0,M.session)(),this.doubleAckHash=(0,M.session)(),this.sequence=(0,M.session)(0),this.shortTagBase=(0,M.session)(),this.socketWatcher=(0,M.session)(),this.refWatcher=(0,M.session)(),this.phoneWatchdog=(0,M.session)(),this.pendingPhoneReqs=(0,M.session)(0),this.isIncognito=(0,M.session)(),this.runPromise=(0,M.session)(),this.streamPromise=(0,M.session)(),this.conflictPromise=(0,M.session)(),this.resumePromise=(0,M.session)(),this.logoutMutex=(0,M.session)(0),this.retryTimestamp=(0,M.session)(),this.pokeable=(0,M.session)(),this.launched=(0,M.session)(),this.mustExitLoop=(0,M.session)(),this.syncTag=(0,M.session)(),this.lastPhoneMessage=(0,M.session)(),this.shouldForceReconnect=(0,M.session)(!1),this.shouldUpgradeToMDIntern=(0,M.session)(!1),this.shouldUpgradeToMDPord=(0,M.session)(!1)}initialize(){Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)||(this.sendQueue=[],this.sendHash={},this.cancelHash={},this.doubleAckHash={},this.phoneWatchdog=new fe.Watchdog({waitAlgorithm:(0,fe.fibonacci)(3e3,3e3,36e5),onTimeout:this.phoneTimedOut.bind(this),onActivated:this.onPhoneWatchdogActivated.bind(this),onFed:this.onPhoneWatchdogFed.bind(this),onDeactivated:this.onPhoneWatchdogDeactivated.bind(this)})),this.listenTo(this,"change:state",this.onStateChange.bind(this)),this.listenTo(this,"change:stream",this.onStreamChange.bind(this)),(0,S.delayMs)(0).then(Z.determineIncognito).then((e=>{this.isIncognito=e})),this.listenTo(N.Cmd,"log_socket_summary",this.summary),this.listenTo(N.Cmd,"set_socket_state",(e=>{this.state=e})),this.listenTo(N.Cmd,"open_socket_stream",(()=>{this.openStream(),this.hasSynced&&this.set({stream:ve.CONNECTED})})),this.listenTo(N.Cmd,"socket_stream_disconnected",(()=>{this.set({stream:ve.DISCONNECTED})})),this.listenTo(N.Cmd,"on_critical_sync_done",(()=>{__LOG__(2)`[ws2] observed on_critical_sync_done`,this.onCriticalSyncDone()})),this.listenTo(N.Cmd,"main_stream_mode_ready",(()=>{__LOG__(2)`[ws2] observed main_stream_mode_ready`,!Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)||(0,J.getAllCriticalDataSynced)()||Y.GK.supportsFeature(Y.GK.F.MD_E2E)?(__LOG__(2)`[ws2] moving to main screen from main_stream_mode_ready`,this.set({hasSynced:!0,stream:ve.CONNECTED})):__LOG__(2)`[ws2] did not meet conditions to move to main screen`})),this.listenTo(N.Cmd,"socket_stream_disconnected",(()=>{this.stream=ve.DISCONNECTED}))}preload(){Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)||(this.socketPreload=new se.default)}send(e){const t=new ee.default(e);this.sendQueue.push(t),this.flushQueue()}send2(e){return new Promise(((t,r)=>{const n=new ee.default(e);n.onSend=t,n.onDrop=r,this.sendQueue.push(n),this.flushQueue()}))}shortTag(){return this.shortTagBase||(this.shortTagBase=((0,C.default)().unix()%1e3).toString()),`${this.shortTagBase}.--${this.sequence++}`}tag(e){const t=`${(0,C.default)().unix()}.--${this.sequence++}`;return e&&ge?t+"-"+e:t}launch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;__LOG__(2)`ws2:Launch gen${this.launchGeneration} (backoff gen${this.backoffGeneration})`;const r=300*ce.expBackoff(this.backoffGeneration,100),n=Date.now()+r;if(this.launched)return __LOG__(4,void 0,new Error,!0)`ws2:launch redundantly called!`,void SEND_LOGS("redundant-launch");function i(){__LOG__(2)`ws2:socket loop closed`,this.socketPreload&&this.socketPreload.deactivate(),this.clearState(),this.set({state:Se.UNLAUNCHED,mustExitLoop:!1,launched:!1,socketPreload:null})}this.mustExitLoop?i.call(this):(this.launched=!0,this.run(t,e).then((function(e){return[e,!1]})).catch((0,E.filteredCatch)(Ce,(()=>(this.mustExitLoop=!0,[!1,!1])))).catch((0,E.filteredCatch)(Ue,(function(){return[!1,!0]}))).catch((e=>(__LOG__(3,!0,void 0,!0)`ws2:run error unknown!\n${e.stack}`,SEND_LOGS("unknown-error-in-ws-loop"),this.clearState(),[!0,!1]))).then((e=>{let[t,a]=e;if(this.mustExitLoop)i.call(this);else{const e=Date.now();this.launchGeneration++,this.backoffGeneration=t&&e<n+6e4?this.backoffGeneration+1:0;const i=e<n?Math.min(n-e,r):0;this.launched=!1,this.launch(a,i)}})))}poke(){this.pokeable?this.pokeable.poke():this.phoneWatchdog.forceTimeout()}takeover(){if(!this.conflictPromise)throw"Takeover called without conflict!";this.conflictPromise.cancel(new Ue)}exitLoop(e){this.mustExitLoop=!0,this.runPromise&&this.runPromise.cancel(e||new Ce)}_setLogoutDirtyBit(){V.default&&V.default.setItem(U.default.KEY_LOGOUT_DIRTY_BIT,"1")}_removeLogoutDirtyBit(){V.default&&V.default.removeItem(U.default.KEY_LOGOUT_DIRTY_BIT)}_hasDirtyBitSet(){V.default&&V.default.getItem(U.default.KEY_LOGOUT_DIRTY_BIT)}clearCredentialsAndStoredData(e){var t=this;return(0,a.default)((function*(){let r=!1;e===$.LogoutReason.ClientFatalError&&(r=!0),t._setLogoutDirtyBit(),r=yield t.clearCredentials(),t._hasDirtyBitSet()&&(r=!0),t._setLogoutDirtyBit();try{yield t.destroyStorage()}catch(e){r=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`destroyStorage: failed with error ${e}`}Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)&&(0,b.clearABPropConfigs)(),r||t._removeLogoutDirtyBit(),r&&"Firefox"!==O.default.info().name?window.location.href=`${window.location.pathname}?post_logout=1`:window.location.reload()}))()}destroyStorage(){return(0,a.default)((function*(){const e=[(0,q.destroy)(),(0,oe.destroyStorage)()];Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)&&(e.push((0,B.destroy)()),e.push((0,X.destroy)()),e.push((0,H.destroy)()),e.push(R.default.clearInitializationPromises())),yield Promise.all(e)}))()}logout(){var e=this;let t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$.LogoutReason.UserInitiated;V.default&&Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)&&(V.default.removeItem("WebEncKeySalt"),V.default.removeItem("WANoiseInfo")),(0,W.get)().setLogoutState(!0),Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)?N.Cmd.onStartingLogout():t=this.runPromise,__LOG__(2)`ws2:user logged out`;let s=Promise.resolve();if(Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)){const e=Math.min(20,Math.max(0,re.ServerProps.syncdSentinelTimeoutSeconds));s=(0,T.promiseTimeout)(r(37933).Z(),1e3*e).catch((()=>__LOG__(3)`ws2: multi-device logout did not manage to send sentinel patch`))}(0,T.promiseTimeout)(s.then((()=>{this.stream===ve.DISCONNECTED||n?this.sendCurrentLogout(null,i):this.sendCurrentLogout(this.socket,i)})).catch(function(){var t=(0,a.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sendCurrentLogoutPromise errored with ${t}`,yield e.clearCredentialsAndStoredData(i),N.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()),3e3,"network request took more than 3 seconds").then((0,a.default)((function*(){Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)||(N.Cmd.onStartingLogout(),yield new Promise((e=>setTimeout(e,100)))),yield e.clearCredentialsAndStoredData(i),t&&t.cancel(new Ne),e.state===Se.OPENING&&e.trigger("change:state"),N.Cmd.logout()}))).catch(function(){var t=(0,a.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sentinelPromise or sendCurrentLogoutPromise timed out with ${t}`,yield e.clearCredentialsAndStoredData(i),N.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()).finally((()=>{(0,W.get)().setLogoutState(!1)}))}summary(){__LOG__(2)`ws:summary --------------------------------`,__LOG__(2)`ws state           ${this.state}`,__LOG__(2)`wd online:         ${String(navigator.onLine)}`,__LOG__(2)`ws socket id:      ${this.socket?this.socket.id:"n/a"}`,__LOG__(2)`ws queue:`,(0,f.default)(this.sendQueue)||A.default.print((0,h.default)(this.sendQueue,(function(e){const t=(0,p.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`})),__LOG__(2)`ws hash:`,(0,f.default)(this.sendHash)||A.default.print((0,h.default)(this.sendHash,(function(e){const t=(0,p.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`}))}registerHandler(e){Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)||(this.handler&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ws2: attempting to register handler multiple times")),this.handler=e)}onStateChange(){__LOG__(2)`ws2:state change: ${this.state}`}onStreamChange(){__LOG__(2)`ws2:stream change: ${this.stream}`,this.stream===ve.DISCONNECTED&&(Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)?he.default.clear():this.onRefCycle(),this.unset("resumePromise"))}onRefCycle(){__LOG__(2)`ws2:onRefCycle`,this.sendQueue.forEach((function(e){e.state=ee.default.STATE.NEW,e.age=0})),this.clearSendHash()}onActivity(e){if(e){const t=e.data;if(je.UPGRADE_MD_FOR_INTERNAL_USER.test(e))__LOG__(2)`ws2: can upgrade to md! (flow for internal users)`,this.shouldUpgradeToMDIntern=!0,this.exitLoop();else if(je.UPGRADE_MD_FOR_PROD.test(e)){if(__LOG__(2)`ws2: upgrade to md! (flow for external users)`,Array.isArray(t)&&2===(null==t?void 0:t.length)&&t[1]&&t[1].type&&t[1].version){const e="string"==typeof t[1].version&&t[1].version,r=e&&new pe.default(e),n=U.default.VERSION_STR.replace(/\.[di]$/,""),i=new pe.default(n);if(r&&i.lt(r))return(0,K.setMdOptedIn)(!0),ue.Updater.restart(!0),void this.exitLoop()}this.shouldUpgradeToMDPord=!0,this.exitLoop()}else if(je.HARD_REFRESH.test(e))__LOG__(2)`ws2:hard refresh!`,ue.Updater.restart(!0);else if(t){const r=Array.isArray(t)?` [${String(t[0])}, ...]`:"",n=(0,u.default)(t)&&"number"==typeof t.status?t.status:null;he.default.logRecv(e.tag,e.binarySize,n);const i=null!=n?`,{status:${n}}`:"";__LOG__(2)`    recv: ${e.tag}${r}${i}`}else he.default.logAck(e.tag),__LOG__(2)`     ack: ${e.tag}`}else D.Clock.setSkew(this.socket.timeSkew||0);this.sendRemainingLogouts()}onPhoneWatchdogActivated(){}onPhoneWatchdogFed(){this.state=Se.CONNECTED}onPhoneWatchdogDeactivated(){}flushQueue(){if(!this.sendQueue.length)return;const e=this.sendQueue.filter((e=>e.state===ee.default.STATE.NEW&&this.canRequestBeSent(e))),t=D.Clock.localUnixTime(),r=[],n=[];e.forEach((e=>{!function(e,t){return!(!e.resendGuard||e.resendGuard())||!(!e.binaryOpts||null==e.binaryOpts.expires||0===e.binaryOpts.expires)&&t-e.binaryOpts.expires>120}(e,t)?n.push(e):r.push(e)})),this.sendQueue=(0,d.default)(this.sendQueue,r),r.forEach((e=>{delete this.sendHash[e.tag],delete this.doubleAckHash[e.tag],he.default.delete(e.tag),e.onSend({status:408})})),n.length&&n.forEach((e=>{this._send(e)}))}phoneTimedOut(){const e=this.phoneWatchdog.failGeneration;if(1===e){__LOG__(3)`ws2:Phone timed out`;const e=(0,h.default)(this.sendHash,"tag");__LOG__(3)`ws2:Outstanding Reqs: ${e.join(",")}`}N.Cmd.sentPing(e);const t=this.phoneWatchdog.waitAlgorithm(this.phoneWatchdog);return this.set({state:Se.TIMEOUT,retryTimestamp:Date.now()+t}),this._basicSend({tag:this.tag("ping"),data:["admin","test"]},"ping"),!0}clearSendHash(e){if(e)(0,c.default)(this.sendHash,(function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new me.LogoutDrop(e.toString()))}));else{const e=(0,l.default)(this.sendHash,"ephemeral");__LOG__(3)`Ephemeral Drop: ${(0,h.default)(e,"tag").join(",")}`,e.forEach((function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new me.EphemeralDrop(e.toString()))}))}this.sendHash={},this.doubleAckHash={},this.pendingPhoneReqs=0,this.phoneWatchdog&&this.phoneWatchdog.deactivate(),he.default.clear()}_basicSend(e,t){__LOG__(2)`low-send: ${t} ${String(e.tag)}`,he.default.logBasicSend(e.tag,e.data),this.socket.cast(`${String(e.tag)},${String(JSON.stringify(e.data))}`)}_send(e){e.tag=e.getTag()||this.shortTag(),e.onTag&&e.onTag(e.tag),this.sendHash[e.tag]=e,e.tagToCancel&&(this.cancelHash[e.tag]=e.tagToCancel),(e.isCallOffer||e.isWap4Bridge)&&(this.doubleAckHash[e.tag]=e),e.binaryOpts?e.binaryOpts.debugObj:e.data,he.default.logSend(e),__LOG__(2)`    send: ${String(e.tag)}, ${e.toString()}`,this.socket.send(e.serialize()),e.isToPhone&&this.pendingPhoneReqs++,e.state=ee.default.STATE.SENT}sendBasic(e){return this.socket?(e.tag=this.tag(),this._basicSend(e,"external"),this.socket.nextMessage(je.TAG(e.tag))):Promise.reject("socket not open")}sendEphemeral(e){e.ephemeral=!0;const t=new ee.default(e);this.canRequestBeSent(t)?this._send(t):t.onDrop(new me.EphemeralDrop(t.toString()))}sendEphemeral2(e){return new Promise(((t,r)=>{const n=new ee.default(e);n.ephemeral=!0,this.canRequestBeSent(n)?(n.onSend=t,n.onDrop=e=>{__LOG__(4,void 0,new Error)`ws2:sendEphemeral2:request.onDrop`,r(e)},this._send(n)):r(new me.EphemeralDrop(n.toString()))}))}sendEphemeralIgnore(e){e.ephemeral=!0,e.ignore=!0,e.tag=this.tag();const t=new ee.default(e);if(this.canRequestBeSent(t)){const e=t.serialize();this.socket.send(e),__LOG__(2)`sending: ${String(t.tag)}, ${t.toString()}`}else t.onDrop(new me.EphemeralDrop(t.toString()))}on5xx(e){__LOG__(3)`ws2:onMessage 5xx error ${String(e.tag)}`,e.on5xx&&e.on5xx(),e.resends>=5?(__LOG__(3)`ws2:onMessage dropping ${String(e.tag)}`,e.onDrop(new me.Server5xxDrop),delete this.sendHash[e.tag],he.default.delete(e.tag),this.sendQueue=(0,o.default)(this.sendQueue,e)):this.maybeResendRequestEventually(e)}onMessage(e){const t=e.tag,n=e.data,i=e.binarySize;if(ze(n)&&(this.lastPhoneMessage=(0,C.default)().unix()),je.PONG.test(e)){if(n[1]){let e=0,t=!1;(0,c.default)(this.sendHash,(function(n){if(!n.isToPhone)return;const i=++n.age;40===i?(t=!0,__LOG__(4,void 0,new Error)`${n.tag+" likely dead: "+n.toString()}`,N.Cmd.cannotReachPhone("("+n.tag+") "+n.toString()),r(56891).default.cannotReachPhone()):i<40&&e++})),this.pendingPhoneReqs=e,this.phoneWatchdog.feed(),0===e&&this.phoneWatchdog.deactivate(),t&&__LOG__(3)`ws2:error-cannot-reach-phone`}else this.state!==Se.TIMEOUT?__LOG__(3)`ws2:Pang while not timed-out`:this.runPromise.cancel(new ke);return}const a=this.sendHash[t];if(a)if(n){if(a.retryOn5xx&&We.test(n))this.on5xx(a,n);else{let r=!0;if(this.doubleAckHash[t]&&(delete this.doubleAckHash[t],!a.isCallOffer&&!a.isWap4Bridge||200!==n.status||n.payload||(r=!1)),r){let r;try{a.logOnSend&&a.logOnSend(e),r=a.onSend(n)}catch(e){if(e instanceof me.E401)return void this.logout();__LOG__(3)`ws2:onMessage error`,a.onDrop(e)}if(We.test(r)?this.on5xx(a,r):(delete this.sendHash[t],this.sendQueue=(0,o.default)(this.sendQueue,a)),He.test(n)){const e=this.cancelHash[t];if(e){const r=this.sendHash[e];delete this.cancelHash[t],delete this.sendHash[e],this.sendQueue=(0,o.default)(this.sendQueue,r)}}}}a.isToPhone&&(a.age<40&&this.pendingPhoneReqs--,this.phoneWatchdog.feed(),0===this.pendingPhoneReqs&&this.phoneWatchdog.deactivate())}else a.state=ee.default.STATE.WEBDACKED,a.isToPhone&&this.phoneWatchdog.activate();else if(n){if(Ve.test(n))__LOG__(3)`ws2: unexpected response status`;else if(n instanceof ArrayBuffer)r(56891).default.handle(n,this,t,i).catch((0,E.filteredCatch)(me.WebdDrop,(()=>{})));else try{this.handler?this.handler(n):__LOG__(3)`ws2: received message, but no handler is registered`}catch(e){if(e instanceof x.UpdateImmediately)this.exitLoop(e);else{if(!(e instanceof x.DeprecatedProtocolVersion))throw e;this.runPromise&&this.runPromise.cancel(e)}}ze(n)&&this.phoneWatchdog.feed()}}run(e,t){var r=this;return this.runPromise=le.default.resolve(e).cancellable().then((e=>{if(this.state=Se.OPENING,N.Cmd.incrementProgress(),e>0){__LOG__(2)`ws2:Run Backoff ${e}ms`;const t=(0,S.delayMs)(e).cancellable().catch((0,E.filteredCatch)(Ae,(()=>{})));return this.setPokeable(t,Date.now()+e),t}})).finally((()=>{this.unset("pokeable"),this.unset("retryTimestamp")})).then((()=>(N.Cmd.incrementProgress(),__LOG__(2)`ws2:Running`,this.openSocket()))).then((e=>{if(N.Cmd.incrementProgress(),e.onactivity=this.onActivity.bind(this),this.socket=e,this.socketWatcher=Z.attachWatcher(this.runPromise,this.throwOnClose()),this.state=Se.PAIRING,void 0===this.isIncognito)return Z.waitForBBEvent(this,"change:isIncognito")})).then((()=>{N.Cmd.incrementProgress(),this.shortTagBase=((0,C.default)().unix()%1e3).toString();const e=this.initConn();if((0,K.knowsPhone)()){const r=this.requestSync(t),n=Promise.all([e,r]).finally((function(){e.cancel(),r.cancel()})),i=(0,z.requireChatCollection)().then((e=>{this.hasSynced&&e.length<=Te&&!Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)&&(this.resumePromise=this.runResume(!0))}));return Promise.all([n,i])}return e.then((()=>{this.set({state:Se.UNPAIRED,refWatcher:Z.attachWatcher(this.runPromise,this.manageRef())})}))})).then((()=>this.waitForSyncInfo())).finally((()=>{this.refWatcher&&(this.refWatcher.cancel(),this.unset("refWatcher"))})).then(function(){var e=(0,a.default)((function*(e){return N.Cmd.incrementProgress(),__LOG__(2)`ws2:completed ${r.hasSynced?"re-auth":"auth"}`,r.state=Se.CONNECTED,k.Conn.blockStoreAdds=!1,k.Conn.platform=e.platform,yield Z.waitForMain(),e}));return function(){return e.apply(this,arguments)}}()).then((function(e){return __LOG__(2)`ws2:main loaded`,e.initial=!0,(0,G.default)([e])})).then((()=>(0,q.initialize)().catch((e=>{__LOG__(3)`Error initializing database during sync: ${e}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error initializing database during sync")})))).then((()=>{const e=this.openStream();return this.streamPromise=e,e})).then((function(){return new le.default})).catch((0,E.filteredCatch)(x.SocketClosed,(function(e){throw e.event instanceof Ne?e.event:e}))).catch((e=>{__LOG__(3)`ws2:run loop interrupt: ${e}`,this.set({canSend:!1,stream:ve.DISCONNECTED,runPromise:null}),this.phoneWatchdog.deactivate(),this.streamPromise&&(this.streamPromise.cancel(),this.unset("streamPromise")),this.socketWatcher&&(this.socketWatcher.cancel(),this.unset("socketWatcher"));const t=this.socket;if(t&&t.state!==_e.STATE.CLOSED&&(t.detachCallbacks(),t.close(!0,e)),this.unset("socket"),this.shouldUpgradeToMDIntern)return N.Cmd.upgradeToMDInternal(),!1;if(this.shouldUpgradeToMDPord)return N.Cmd.upgradeToMDProd(),!1;throw e})).catch((0,E.filteredCatch)(x.UpdateImmediately,(e=>{throw this.updateImmediately(e.message),new Ce}))).catch((0,E.filteredCatch)(x.DeprecatedProtocolVersion,(()=>this.deprecatedVersion()))).catch((0,E.filteredCatch)([me.E401,ke],(function(){return!1}))).catch((0,E.filteredCatch)(Re,(()=>(this.clearState(),!1)))).catch((0,E.filteredCatch)([x.SocketClosed,x.SocketError,Ke],(()=>!0))).catch((0,E.filteredCatch)(we,function(){var e=(0,a.default)((function*(){return __LOG__(3)`ws2:sync rejected, logging out`,yield r.sendCurrentLogout(null,$.LogoutReason.UnknownCompanion),yield r.clearCredentialsAndStoredData(),N.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,E.filteredCatch)([be,Be],function(){var e=(0,a.default)((function*(e){return __LOG__(2)`ws2:phone disassociated via ${String(e)}`,yield r.clearCredentialsAndStoredData(),N.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,E.filteredCatch)(xe,(0,a.default)((function*(){return __LOG__(3,void 0,void 0,!0)`ws2:No secret bundle!`,SEND_LOGS("no-secret-bundle"),yield r.clearCredentialsAndStoredData(),N.Cmd.logout(),!1})))).catch((0,E.filteredCatch)(De,(()=>(this.state=Se.UNPAIRED_IDLE,this.setPokeable(Z.waitForOfflineNaive().then((()=>{throw new Le})).catch((0,E.filteredCatch)(Ae,(()=>!1)))))))).catch((0,E.filteredCatch)(x.BlockedByProxy,(()=>(O.default.promptUnloadGuards++,this.state=Se.PROXYBLOCK,this.setPokeable((new le.default).catch((0,E.filteredCatch)(Ae,(()=>!1))).finally((function(){O.default.promptUnloadGuards--}))))))).catch((0,E.filteredCatch)(Me,(e=>{__LOG__(2)`ws2:denied tos`;const t=this.setPokeable((new le.default).cancellable().catch((0,E.filteredCatch)(Ae,(()=>!1)))).cancellable(),r=e instanceof Oe?Se.TOS_BLOCK:Se.SMB_TOS_BLOCK;return this.clearState(),this.set({state:r,runPromise:t}),t}))).catch((0,E.filteredCatch)([Pe,Fe],(e=>{e instanceof Pe?__LOG__(2)`ws2:phone denied (conflict)`:__LOG__(2)`ws2:phone replaced`;const t=(new le.default).cancellable();return this.set({state:Se.CONFLICT,conflictPromise:t,runPromise:t}),this.clearState(),t}))).finally((()=>{this.conflictPromise&&this.conflictPromise.cancel()})).catch((0,E.filteredCatch)([Ne,Le],(function(){return!1})))}openSocket(){const e=this.socketPreload;if(this.socketPreload=null,(null==e?void 0:e.socket)&&e.socket.state===_e.STATE.OPEN)return Promise.resolve(e.socket);const t=e&&e.active?e:new se.default,r=()=>{this.retryTimestamp=t.retryTimestamp};t.on("change:retryTimestamp",r),this.pokeable=t;const n=Z.waitForBBEvent(t,"change:socket").cancellable().then((()=>t.socket)).finally((()=>{t.off("change:retryTimestamp",r),t.onerror=null,t.deactivate(),this.pokeable=null}));return t.onerror=e=>{n.cancel(e)},n}initConn(){var e=this;return(0,a.default)((function*(){const t=ye,r=e.tag("init"),n=O.default.info();e._basicSend({tag:r,data:["admin","init",[t.p,t.s,t.t],[n.os||"Unknown",n.name||"Unknown",n.version||"Unknown"],O.default.id(),!e.isIncognito&&!!(0,K.getRememberMe)()]},"init");const i=yield e.socket.nextMessage(je.TAG(r)).get("data");D.Clock.setSkew(Date.now()-i.time),(0,G.default)([{id:"1",ref:i.ref,refTTL:i.ttl}])}))()}manageRef(){var e=this;return(0,v.promiseLoop)(function(){var t=(0,a.default)((function*(t,r,n){const i=k.Conn.refExpiry-Date.now()-500,a=(yield(0,S.delayMs)(Math.max(i,0)).cancellable().then((()=>{if(n>=5)throw new De;__LOG__(2)`ws2:Requesting Ref Update`;const t=e.tag("qr"+n);return e._basicSend({tag:t,data:["admin","Conn","reref"]},"reref"),e.socket.nextMessage(je.TAG(t))}))).data;switch(a.status){case 200:return __LOG__(2)`ws2:Updating Ref`,void(0,G.default)([{ref:a.ref,refTTL:a.ttl}]);case 304:return __LOG__(2)`ws2:Keeping Ref`,void t();case 429:throw __LOG__(2)`ws2:Server denied new ref`,new De;default:throw __LOG__(3)`ws2:Bad Ref Response!`,new Ge("unrecognized ref request status ("+a.status+")")}}));return function(){return t.apply(this,arguments)}}()).cancellable()}requestSync(e){if(this.syncTag=this.tag("sync"),!te.load())return Promise.reject(new xe);const{client:t,server:r}=(0,K.getLoginTokens)(),n=["admin","login",t,r,O.default.id()];e?n.push("takeover"):this.hasSynced&&(n.push(this.shouldForceReconnect?"force_reconnect":"reconnect"),n.push((0,K.getMaybeMeUser)()));const i=()=>(this._basicSend({tag:this.syncTag,data:n},"sync"),!0),a=new fe.Watchdog({waitAlgorithm:(0,fe.fibonacci)(0,8500,6e4),onTimeout:i});a.on("change:ts",(()=>{this.retryTimestamp=a.ts})),this.pokeable=a,a.activate(),i();const s=this.socket.nextMessage(je.TAG(this.syncTag)),o=this.lookForAndHandleChallenge().catch((0,_.catchAbort)((()=>{}))).catch(s.cancel.bind(s));return s.then((e=>{__LOG__(2)`ws2:login`;const t=e.data;switch(t.status){case 200:return e;case 401:throw new be;case 403:throw t.tos>=2?new Oe:t.smbTos?new Ie:new we;case 405:throw __LOG__(3,void 0,void 0,!0)`ws2:Already authorized!`,SEND_LOGS("already-authorized"),new Re;case 409:throw new Pe;case 500:throw new Ke;default:throw __LOG__(3)`ws2:unknown error! status:${t.status}`,new we}})).finally((()=>{o.cancel(),a.deactivate(),this.unset("pokeable"),this.unset("retryTimestamp")}))}waitForSyncInfo(){var e=this;return(0,a.default)((function*(){return(yield e.socket.nextMessage(je.SYNC_INFO)).data[1]}))()}lookForAndHandleChallenge(){var e=this;return(0,a.default)((function*(){const t=yield e.socket.nextMessage(je.CHALLENGE).then((function(e){__LOG__(2)`ws2:challenged!`;const t=(0,m.decodeB64)(e.data[1].challenge);return te.getSecurityToken(t)})).then((t=>{const r=(0,K.getLoginTokens)(),n=r?r.server:void 0;if(!n)throw __LOG__(3)`ws2:handleChallenge no server token!`,new Error("Handle challenge no server token");const i=e.tag("challenge");return e._basicSend({tag:i,data:["admin","challenge",t,n,O.default.id()]},"challenge"),e.socket.nextMessage(je.TAG(i))}));return t.data.status>=500?Promise.reject(new Ke):t.data.status>=400?(__LOG__(3)`ws2:handleChallenge failed challenge!`,Promise.reject(new be)):void __LOG__(2)`ws2:handleChallenge passed challenge`}))()}throwOnClose(){return this.socket.nextMessage(je.DISCONNECT).then((function(e){throw"replaced"===e.data[1].kind?new Fe:new Be}))}onCriticalSyncDone(){Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)&&(__LOG__(2)`[ws2] moving to main screen from onCriticalSyncDone`,this.set({hasSynced:!0,stream:ve.CONNECTED}))}openStream(){var e=this;return(0,a.default)((function*(){if(Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)){return(0,K.getMeUser)()&&(k.Conn.blockStoreAdds=!1,k.Conn.id="1",k.Conn.trigger("me_ready")),void(yield(0,P.addMeToContacts)())}let t;if(e.canSend=!0,e.hasSynced)e.resumePromise||(e.resumePromise=e.runResume(!1)),t=e.resumePromise.finally((()=>{e.unset("resumePromise")}));else{const n=(0,z.requireContactCollection)().then((e=>e.sync()));if(t=(0,z.requireChatCollection)().then((e=>e.sync())).cancellable().then((()=>(e.set({hasSynced:!0,stream:ve.CONNECTED}),(0,z.requireStickerPackCollection)().then((e=>{e.preFetch()})).catch((e=>{__LOG__(3)`Error: prefetch StickerPacks\n${e.stack}`})),Y.GK.supportsFeature(Y.GK.F.USER_NOTICE)&&Q.default.sync(),Y.GK.supportsFeature(Y.GK.F.SETTINGS_SYNC)&&ne.default.sync(),n))).catch((t=>{throw e.set({hasSynced:!1,stream:ve.DISCONNECTED}),t})).catch((0,_.catchAbort)((()=>{}))),(0,z.requireStatusV3Collection)().then((e=>{e.sync()})),k.Conn.isSMB){if(Y.GK.supportsFeature(Y.GK.F.QUICK_REPLIES_QUERY)){r(99662).QuickReplyCollection.sync()}(0,j.canDisplayLabel)()&&(0,z.requireLabelCollection)().then((e=>{e.sync()}))}}try{return yield(0,z.requireMsgCollection)().cancellable().then((e=>{e.markAllAsStale()})),e.stream=e.hasSynced?ve.RESUMING:ve.SYNCING,e.socket.onmessage=e.onMessage.bind(e),e.socket.releaseMessages(),t}catch(e){return(0,_.catchAbort)((function(){t.cancel()}))(e)}}))()}queryReceivedActions(){const e=this,t=(0,l.default)(this.sendQueue,"clientCacheable"),n=(0,h.default)(t,"tag").filter((function(e){return e}));return __LOG__(2)`ws2:queryReceivedActions`,0===n.length?Promise.resolve():r(56891).default.queryReceivedActions(n).then((function(r){Array.isArray(r)?r.forEach((function(t){const r=function(e,t){for(let r=t;r<e.length;r++){const t=e[r];if(t.tag)return t}}(e.sendQueue,parseInt(t.id,10)||0);if(r)if(__LOG__(2)`ws2:queryReceivedActions found dup: ${t.id},${t.code}`,delete e.sendHash[t.id],he.default.delete(t.id),e.sendQueue=(0,o.default)(e.sendQueue,r),r.onSend){const e=r.onSend({status:t.code,_duplicate:!0});We.test(e)&&r.onDrop(new me.Server5xxDrop)}else __LOG__(3)`ws2:queryReceivedActions onSendDup undefined; should be defined: ${t.id}`,r.onDrop(new me.ConventionViolationDrop);else __LOG__(3)`ws2:queryReceivedActions unknown tag in response: ${t.id}`})):"replaced"===r?(t.forEach((function(e){e.onDrop(new me.BrowserReplacedDrop)})),e.sendQueue=(0,d.default)(e.sendQueue,t)):__LOG__(3)`ws2:queryReceivedActions error`}))}runResume(e){return Promise.all([this.queryReceivedActions(),(0,z.requireChatCollection)().then((e=>e.resyncMessages())),(0,z.requireMsgCollection)().then((e=>e.resyncReceipts()))]).then((()=>{this.trigger("didResume"),this.flushQueue(),this.stream=ve.CONNECTED})).catch((0,E.filteredCatch)(me.WebdDrop,(()=>{this.stream=ve.DISCONNECTED}))).catch((0,_.catchAbort)((()=>{this.stream=ve.DISCONNECTED}))).catch((t=>{if(!e)throw __LOG__(3,!0,void 0,!0)`ws2:error during resume, resyncing: ${String(t)}\n${t.stack}`,SEND_LOGS("error-on-resume"),this.stream=ve.DISCONNECTED,new Re;if(this.canSend)return this.runResume(!1);this.unset("resumePromise")}))}setPokeable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.retryTimestamp;return this.set({pokeable:{poke(){e.cancel(new Ae)}},retryTimestamp:t}),e}clearCredentials(){var e=this;return(0,a.default)((function*(){(0,K.updatePreservedUserKeys)();let t=!1;try{t=yield e.clearState()}catch(e){t=!0}try{(0,K.setBrowserId)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearState error ${e}`}try{(0,K.setUnknownId)()}catch(e){__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setUnknownId error ${e}`}try{(0,K.setMe)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setMe error ${e}`}if(Y.GK.supportsFeature(Y.GK.F.MD_BACKEND)){try{(0,J.clearRegistrationInfo)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearRegistrationInfo error ${e}`}try{yield(0,ae.destroy)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:destroySignal error ${e}`}try{yield(0,F.deleteEncKeysAndCache)();(0,r(73368).cn)()}catch(e){t=!0}}else{try{(0,K.clearTokens)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearTokens error ${e}`}try{te.clear()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:SecretBundle clear error ${e}`}}try{yield(0,K.clearAllLocalState)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearAllLocalState error ${e}`}return t}))()}clearState(){var e=this;return(0,a.default)((function*(){__LOG__(2)`ws2:clearState`;let t=!1;e.sendQueue=[],e.clearSendHash(!0),e.unset("hasSynced");try{(yield(0,z.requireClearAppStates)())()}catch(e){t=!0,e instanceof x.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_session_app_state"))}try{yield(0,w.default)()}catch(e){t=!0,e instanceof x.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_persistent_app_state"))}return t}))()}maybeResendRequestEventually(e){const t=300*ce.expBackoff(e.resends,100);__LOG__(2)`ws2:Resending ${e.toString()} in ${t}ms`,e.state=ee.default.STATE.WILL_RETRY,e.resendTimer=setTimeout((()=>{e.resends++,e.resendTimer=void 0,this.sendHash[e.tag]===e&&(!e.resendGuard||e.resendGuard()?this._send(e):e.onSend({status:408}))}),t)}sendCurrentLogout(e,t){let n;if(Y.GK.supportsFeature(Y.GK.F.MD_BACKEND))n=(0,de.unpairDevice)(t).then((e=>{200!==e.status&&__LOG__(3)`ws2:multi-device logout failed with error code ${e.status}`,(0,L.stopComms)()})).catch((e=>{__LOG__(4,!0,new Error)`[CRITICAL] unpairDevice failed with error, preoceed with local logout \n${e.stack}`})),n||(n=Promise.reject(new Error("sendCurrentLogout: should not reach")));else{let t;t=te.load()?r(56891).default.logoutToken().then((e=>{const t={t:(0,K.getLogoutToken)(),m:e},r=(0,K.getOldLogoutCreds)();return r.push(t),(0,K.setOldLogoutCreds)(r),t})):Promise.resolve({}),n=t.then((t=>{if(e&&e.state===_e.STATE.OPEN){let r=this.logoutMutex;this.logoutMutex=r<=0?r=1:++r,__LOG__(2)`ws2:logout through socket`,e.partingSend(new Ne,'goodbye,,["admin","Conn","disconnect"]',(e=>0===e.indexOf("goodbye,"))).then((function(e){e?(__LOG__(2)`ws2:logout through socket success`,qe(t)):__LOG__(3)`ws2:logout through socket failure, will POST`})).finally((()=>{this.logoutMutex===r&&(this.logoutMutex=0)}))}else this.logoutMutex<0&&(this.logoutMutex=0),this.sendRemainingLogouts()}))}return n}sendRemainingLogouts(){let e=this.logoutMutex;if(0!==e)return;const t=r(64386).default,n=(0,K.getOldLogoutCreds)();0!==n.length?(this.logoutMutex=e=1,Promise.all((0,h.default)(n,function(){var e=(0,a.default)((function*(e){__LOG__(2)`ws2:POST logout`;try{yield t.post(Ee,e),qe(e)}catch(e){__LOG__(3)`ws2:POST logout failure`}}));return function(){return e.apply(this,arguments)}}())).finally((()=>{e===this.logoutMutex&&(this.logoutMutex=0)}))):this.logoutMutex=-1}updateImmediately(e){I.upload({reason:e,immediate:!0}).finally((()=>{ue.Updater.restart(!0)}))}deprecatedVersion(){__LOG__(2)`ws2:deprecated version`,I.upload({reason:"ws2:deprecated version",immediate:!0});const e=this.setPokeable((new le.default).cancellable().catch((0,E.filteredCatch)(Ae,(()=>!1)))).cancellable();return this.clearState(),this.set({state:Se.DEPRECATED_VERSION,runPromise:e}),e}canRequestBeSent(e){return!!this.canSend||Boolean(this.socket)&&(0,K.knowsPhone)()&&e.serverCacheable}}function ze(e){return e instanceof g.Binary}function qe(e){const t=(0,K.getOldLogoutCreds)(),r=(0,s.default)(e);(0,K.setOldLogoutCreds)((0,l.default)(t,(e=>!r(e))))}const Je=new((0,M.defineModel)($e));t.Socket=Je},27086:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){h=null},t.destroy=function(){return(0,o.destroyStorage)().catch((()=>p.resolve(new i.default(o.DATABASE_NAME).delete()))).finally((()=>(h=null,p.resolve(new i.default("fts-storage-dogfooding").delete()))))},Object.defineProperty(t,"getIndexV1Table",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getIndexV2Table",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getIndexV3Table",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getManifestTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getPurgeRangeQueueTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getV2TokenToPrefixMappingTable",{enumerable:!0,get:function(){return d.getTable}}),t.initialize=function(){null==h&&((0,o.createStorage)(),(0,a.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,d.addTable)(),(0,s.addTable)(),(0,u.addTable)(),h=(0,o.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize fts storage"),e})));return h};var i=n(r(86128)),a=r(66991),s=r(69508),o=r(36376),l=r(94831),c=r(57810),d=r(80277),u=r(22812);const p=r(74121).Z;let h},66991:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=t.ManifestKeys=void 0,t.addTable=function(){(0,a.getStorage)().add(l).version((0,o.manifestCreateTable)(),[new s.default("key"),new i.default("tokenizerVersion"),new i.default("schemaVersion"),new i.default("isCurrent"),new i.default("lastMsgKeyViaFullIndexer"),new i.default("isFullIndexingComplete")]).view((e=>e||null))},t.getTable=function(){return(0,a.getStorage)().table(l)};var i=n(r(79051)),a=r(36376),s=n(r(89362)),o=r(43809);const l="manifest";t.TABLE_NAME=l;const c=Object.freeze({PREV_VERSION:"prev.version",CURR_VERSION:"curr.version",NEXT_VERSION:"next.version"});t.ManifestKeys=c},69508:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,s.getStorage)().add(l).version((0,o.purgeRangeQueueCreateTable)(),[new a.default(["chatId","tsOfLastMessage","startRowId","endRowId"]),new i.default("offset")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table(l)};var i=n(r(79051)),a=n(r(54180)),s=r(36376),o=r(43809);const l="fts-purge-range-queue";t.TABLE_NAME=l},94831:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,o.getStorage)().add(d).version((0,c.ftsV1IndexCreateTable)(),[new l.default("token"),new s.default("ids"),new a.default("ids"),new s.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildEntry)(e.prefixes,e.ids):null))},t.getTable=function(){return(0,o.getStorage)().table(d)};var i=r(96573),a=n(r(92061)),s=n(r(79051)),o=r(36376),l=n(r(89362)),c=r(43809);const d="fts-v1-index";t.TABLE_NAME=d},57810:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(u).version((0,d.ftsV2IndexCreateTable)(),[new l.default(["id","chatId","token"]),new o.default("id"),new o.default("chatId"),new o.default("token"),new s.default(["chatId","token"]),new a.default("timestamp"),new s.default(["id","token"])]).view((e=>e?(0,i.buildEntry)(e.id,e.chatId,e.token,e.timestamp):null))},t.getTable=function(){return(0,c.getStorage)().table(u)};var i=r(44152),a=n(r(79051)),s=n(r(34654)),o=n(r(19570)),l=n(r(54180)),c=r(36376),d=r(43809);const u="fts-v2-index";t.TABLE_NAME=u},80277:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,s.getStorage)().add(c).version((0,l.ftsV2TokenToPrefixesCreateTable)(),[new o.default("token"),new a.default("prefixes"),new i.default("prefixes")]).view((e=>e||null))},t.getTable=function(){return(0,s.getStorage)().table(c)};var i=n(r(92061)),a=n(r(79051)),s=r(36376),o=n(r(89362)),l=r(43809);const c="fts-v2-token-prefixes";t.TABLE_NAME=c},22812:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(u).version((0,d.ftsV3IndexCreateTable)(),[new l.default("ftsRowId"),new s.default("id"),new o.default("id"),new s.default("chatId"),new o.default("chatId"),new s.default("timestamp"),new s.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildDBEntry)(e.ftsRowId,e.id,e.chatId,e.timestamp,e.prefixes):null))},t.getTable=function(){return(0,c.getStorage)().table(u)};var i=r(14056),a=n(r(92061)),s=n(r(79051)),o=n(r(19570)),l=n(r(81674)),c=r(36376),d=r(43809);const u="fts-v3-index";t.TABLE_NAME=u},36376:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new s.default(c);d=new o.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[fts-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[fts-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),s=n(r(98883)),o=r(37521),l=r(23283);const c="fts-storage";t.DATABASE_NAME=c;let d=null},43809:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ftsV1IndexCreateTable=function(){return(0,n.getStorage)().versions.version(0)},t.ftsV2IndexCreateTable=function(){return(0,n.getStorage)().versions.version(3)},t.ftsV2TokenToPrefixesCreateTable=function(){return(0,n.getStorage)().versions.version(4)},t.ftsV3IndexCreateTable=function(){return(0,n.getStorage)().versions.version(5)},t.manifestCreateTable=function(){return(0,n.getStorage)().versions.version(1)},t.purgeRangeQueueCreateTable=function(){return(0,n.getStorage)().versions.version(2)};var n=r(36376)},16703:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,s.destroyStorage)().catch((()=>o.resolve(new i.default(s.DATABASE_NAME).delete()))).finally((()=>{l=null}))},Object.defineProperty(t,"getJobsTable",{enumerable:!0,get:function(){return a.getTable}}),t.initialize=function(){null==l&&((0,s.createStorage)(),(0,a.addTable)(),l=(0,s.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize jobs storage"),e})));return l};var i=n(r(86128)),a=r(57267),s=r(87758);const o=r(74121).Z;let l},57267:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("jobs-store").version((0,c.jobsCreateV1Table)(),[new s.default("jobId"),new i.default("type"),new i.default("uniqKey"),new a.default("uniqKey"),new i.default("original"),new i.default("current"),new i.default("step"),new i.default("startTime"),new i.default("endTime"),new i.default("stepHardStartCountAfterTimeout"),new i.default("stepFirstStartTime"),new i.default("waitUntil"),new i.default("backedOffCount"),new i.default("version")]).version((0,c.jobsCreateV2Table)(),[new i.default("stepUnexpectedErrorCount"),new o.default("endTime")]).view((e=>({jobId:e.jobId,type:e.type,uniqKey:e.uniqKey,original:e.original,current:e.current,step:e.step,startTime:e.startTime,stepHardStartCountAfterTimeout:e.stepHardStartCountAfterTimeout,stepFirstStartTime:e.stepFirstStartTime,waitUntil:e.waitUntil,backedOffCount:e.backedOffCount,version:e.version,stepUnexpectedErrorCount:e.stepUnexpectedErrorCount})))},t.getTable=function(){return(0,l.getStorage)().table("jobs-store")};var i=n(r(79051)),a=n(r(19570)),s=n(r(81674)),o=n(r(23263)),l=r(87758),c=r(93695)},87758:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new s.default(c);d=new o.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[jobs-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[jobs-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),s=n(r(98883)),o=r(37521),l=r(23283);const c="jobs-storage";t.DATABASE_NAME=c;let d=null},93695:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobsCreateV1Table=function(){return(0,n.getStorage)().versions.version(0)},t.jobsCreateV2Table=function(){return(0,n.getStorage)().versions.version(1)};var n=r(87758)},98883:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),s=r(66751),o=n(r(86128)),l=n(r(41143)),c=r(86445),d=r(15998),u=r(78585);o.default.Promise.PSD.onunhandled=()=>{};const p=r(74121).Z;function h(){return(h=(0,i.default)((function*(e,t,r,n){if(!d.DbEncKeyStore)throw new Error("feature is not yet implemented");const i=n?d.DbEncKeyStore.dbMsgEncKeys[d.DbEncKeyStore.dbMsgEncKeys.length-1]:d.DbEncKeyStore.encKeys[d.DbEncKeyStore.encKeys.length-1],a=new Uint8Array(16);self.crypto.getRandomValues(a);const s=r===c.ENCRYPTED_VALUE_TYPE.STRING?(new TextEncoder).encode(e):e;try{const e=self.crypto.subtle.encrypt({iv:a,name:d.DB_ENCRYPTION_CIPHER},i.key,s),t=null==o.default.currentTransaction?e:o.default.waitFor(e);return{_data:yield p.resolve(t),iv:a,_keyId:i.id}}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r,n){if(!d.DbEncKeyStore)throw new Error("feature is not yet implemented");const{_data:i,iv:a,_keyId:s}=e,u=n?d.DbEncKeyStore.dbMsgEncKeys.filter((e=>e.id===s))[0]:d.DbEncKeyStore.encKeys.filter((e=>e.id===s))[0];if((0,l.default)(null!=u,"Encryption key id not found"),null==i)return i;try{const e=self.crypto.subtle.decrypt({iv:a,name:d.DB_ENCRYPTION_CIPHER},u.key,i),t=null==o.default.currentTransaction?e:o.default.waitFor(e),n=yield p.resolve(t);return r===c.ENCRYPTED_VALUE_TYPE.STRING?new TextDecoder("utf-8").decode(n):n}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}class _{constructor(e,t,r,n,i,a){this.table=e,this.view=r,this.db=t,this.propFilter=n,this.tableEncryptedColumns=new Map(Object.keys(i).map((e=>[e,i[e]]))),this.shouldUseDbMsgEncKeyForEncryptedCol=a}asyncView(e){var t=this;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,i.default)((function*(){if(!t._hasEncryptedColumn()||!r)return t.view(e);const n=yield t._decryptColumns(e);return t.view(n)}))()}_decryptColumns(e){var t=this;return(0,i.default)((function*(){(0,l.default)("object"==typeof e,"Called `_decryptColumns` with primitive value");const r=Array.from(t.tableEncryptedColumns.entries()).map((r=>{let[n,i]=r;const a=e[n];return(null==a?void 0:a._data)&&(null==a?void 0:a.iv)?function(){return f.apply(this,arguments)}(a,n,i,t.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[n]=t})):a}));return yield Promise.all(r),e}))()}_encryptColumns(e){const t=Array.from(this.tableEncryptedColumns.entries()).map((t=>{let[r,n]=t;const i=e[r];return null==i?i:function(){return h.apply(this,arguments)}(i,r,n,this.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[r]=t}))}));return Promise.all(t).then((()=>e))}_addAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.add(e);const r=yield t._encryptSingleUpdate(e);return t.table.add(r)}))()}_putAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.put(e);const r=yield t._encryptColumns(e);return t.table.put(r)}))()}_bulkAddAndEncrypt(e){return this._hasEncryptedColumn()?this._encryptBulkUpdates(e).then((e=>this.table.bulkAdd(e))):this.table.bulkAdd(e)}_bulkPutAndEncrypt(e){return this._hasEncryptedColumn()?o.default.waitFor(this._encryptBulkUpdates(e)).then((e=>this.table.bulkPut(e))):this.table.bulkPut(e)}_encryptBulkUpdates(e){if(!this._hasEncryptedColumn())return p.resolve(e);const t=[],r=e.map(((e,r)=>this._encryptColumns(e).then((e=>{t[r]=e}))));return Promise.all(r).then((()=>t))}_encryptSingleUpdate(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return e;return yield t._encryptColumns(e)}))()}asyncViewMap(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._hasEncryptedColumn()||!t)return Promise.resolve(e.map((e=>e?this.view(e):null)));const r=e.map((e=>null!=e?this.asyncView(e):p.resolve(null)));return p.resolve(null==o.default.currentTransaction?Promise.all(r):o.default.waitFor(Promise.all(r)))}preflightEncryptSingleRecord(e){return this.tableEncryptedColumns,Object.keys(e).forEach((t=>{this.tableEncryptedColumns.has(t)||delete e[t]})),this._encryptColumns(e)}postflightDecryptSingleRecord(e){var t=this;return(0,i.default)((function*(){const r=yield t._decryptColumns(e);return t.view(r)}))()}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return T(e,this.tableEncryptedColumns),p.resolve(this.table.bulkAdd(e)).catch((e=>{throw v(e,"bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY",this.table.name),e}))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return T(e,this.tableEncryptedColumns),p.resolve(this.table.bulkPut(e)).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e}))}create(e){const t=this.propFilter(e);return p.resolve(this._addAndEncrypt(t)).catch((e=>{throw v(e,"create",this.table.name),e}))}createOrReplace(e){const t=this.propFilter(e);return p.resolve(this._putAndEncrypt(t)).catch((e=>{throw v(e,"createOrReplace",this.table.name),e}))}createOrMerge(e,t){var r=this;return(0,i.default)((function*(){const n=r.propFilter(t),i=yield r._encryptColumns(n);return p.resolve(r.db.transaction("rw",r.table,(()=>r.table.where(":id").equals(e).modify((e=>{Object.assign(e,i)})).then((e=>{if(1!==e)return r.table.add(i)})))).then((()=>{}))).catch((e=>{throw v(e,"createOrMerge",r.table.name),e}))}))()}get(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return p.resolve(this.table.get(e)).then((e=>e?this.asyncView(e,t):null)).catch((e=>{throw v(e,"get",this.table.name),e}))}merge(e,t){var r=this;return(0,i.default)((function*(){const n=r.propFilter(t),i=yield r._encryptSingleUpdate(n);return p.resolve(r.table.update(e,i)).catch((e=>{throw v(e,"merge",r.table.name),e}))}))()}remove(e){return p.resolve(this.table.delete(e)).catch((e=>{throw v(e,"remove",this.table.name),e}))}bulkCreate(e){const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?p.resolve(this.db.transaction("rw",this.table,(()=>this._bulkAddAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreate",this.table.name),e})):p.resolve(this.table.bulkAdd(t))}bulkCreateOrReplace(e){const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?p.resolve(this.db.transaction("rw",this.table,(()=>this._bulkPutAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e})):p.resolve(this.table.bulkPut(t))}bulkCreateOrMerge(e){var t=this;return(0,i.default)((function*(){const r=new Map,n=t._primaryKey();function a(){return(a=(0,i.default)((function*(e){const r=t.table.where(":id").anyOf(Array.from(e.keys()));yield r.modify((t=>{Object.assign(t,e.get(t[n])),e.delete(t[n])}));return Array.from(e.values())}))).apply(this,arguments)}return(yield t._encryptBulkUpdates(e)).forEach((e=>{const i=t.propFilter(e);(0,l.default)(n in i,"Called `bulkCreateOrMerge` with item(s) not including the primary key"),r.set(i[n],i)})),p.resolve(t.db.transaction("rw",t.table,(()=>function(){return a.apply(this,arguments)}(r).then((e=>0===e.length?p.resolve():t.table.bulkPut(e)))))).catch((e=>{throw v(e,"bulkCreateOrMerge",t.table.name),e}))}))()}bulkGet(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return 0===e.length?p.resolve([]):p.resolve(this.db.transaction("r",this.table,(()=>{const t=e.map((e=>this.table.get(e)));return o.default.Promise.all(t)}))).then((e=>this.asyncViewMap(e,t))).catch((e=>{throw v(e,"bulkGet",this.table.name),e}))}bulkRemove(e){return 0===e.length?p.resolve():p.resolve(this.db.transaction("rw",this.table,(()=>this.table.bulkDelete(e)))).catch((e=>{throw v(e,"bulkRemove",this.table.name),e}))}bulkRemoveByIndex(e,t){return 0===t.length?p.resolve():p.resolve(E(this.table.where(y(e)).anyOf(t)).delete()).catch((e=>{throw v(e,"bulkRemoveByIndex",this.table.name),e}))}all(e,t){let r=E(this.table.orderBy((null==e?void 0:e.index)?y(e.index):":id"),e);t&&(r=r.until(t));let n=null;switch(null==e?void 0:e.returnKeyType){case"keys":n=p.resolve(r.keys());break;case"primary_key":n=p.resolve(r.primaryKeys());break;default:n=p.resolve(r.toArray()).then((t=>this.asyncViewMap(t,null==e?void 0:e.shouldDecrypt)))}return n.catch((e=>{throw v(e,"all",this.table.name),e}))}count(){return p.resolve(this.table.count()).catch((e=>{throw v(e,"count",this.table.name),e}))}bulkDeleteRange(e,t,r,n){return E(this.table.where(y(e)).between(t,r,!!(null==n?void 0:n.lowerInclusive),!!(null==n?void 0:n.upperInclusive)),n).delete().catch((e=>{throw v(e,"bulkDeleteRange",this.table.name),e}))}equals(e,t,r){return p.resolve(E(this.table.where(y(e)).equals(t),r).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"equals",this.table.name),e}))}anyOf(e,t,r){return 0===t.length?p.resolve([]):p.resolve(E(this.table.where(y(e)).anyOf(t),r).distinct().toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"anyOf",this.table.name),e}))}startsWithAnyOf(e,t,r){return 0===t.length?p.resolve([]):p.resolve(E(this.table.where(y(e)).startsWithAnyOf(t),r).distinct().toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"startsWithAnyOf",this.table.name),e}))}greaterThan(e,t,r){const n=(null==r?void 0:r.inclusive)?this.table.where(y(e)).aboveOrEqual(t):this.table.where(y(e)).above(t);return p.resolve(E(n,r).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"greaterThan",this.table.name),e}))}lessThan(e,t,r){const n=(null==r?void 0:r.inclusive)?this.table.where(y(e)).belowOrEqual(t):this.table.where(y(e)).below(t);return p.resolve(E(n,r).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))).catch((e=>{throw v(e,"lessThan",this.table.name),e}))}between(e,t,r,n,i){const a=E(this.table.where(y(e)).between(t,r,!!(null==n?void 0:n.lowerInclusive),!!(null==n?void 0:n.upperInclusive)),n);let s=null;switch(null==n?void 0:n.returnKeyType){case"keys":s=p.resolve(a.keys());break;case"primary_key":s=p.resolve(a.primaryKeys());break;default:s=i?p.resolve(a.until(i).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))):p.resolve(a.toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt)))}return s.catch((e=>{throw v(e,"between",this.table.name),e}))}forEachSortedBy(e,t){var r=this;return this.table.orderBy(e).each(function(){var e=(0,i.default)((function*(e){const n=yield r._decryptColumns(e);return t(n)}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEachSortedBy",this.table.name),e}))}forEach(e){var t=this;return this.table.each(function(){var r=(0,i.default)((function*(r){const n=yield t._decryptColumns(r);return e(n)}));return function(){return r.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEach",this.table.name),e}))}clear(){return p.resolve(this.table.clear()).catch((e=>{throw v(e,"clear",this.table.name),e}))}_primaryKey(){return this.table.schema.primKey.name}_hasEncryptedColumn(){return this.tableEncryptedColumns.size>0}}function m(e){if(e.length>1)return e.forEach((e=>{(0,l.default)(e.primaryKey&&e.primaryKey===u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`")})),`[${e.map((e=>e.name)).join("+")}]`;{const t=e[0];return(0,l.default)(t.primaryKey&&t.primaryKey!==u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`"),t.primaryKey===u.PRIMARY_KEY_TYPE.AUTO_INCREMENT?`${t.name}++`:t.name}}function g(e){switch(e.type){case u.INDEX_TYPE.SIMPLE:return e.column;case u.INDEX_TYPE.COMPOSITE:return`[${e.columns.join("+")}]`;case u.INDEX_TYPE.ARRAY:return`*${e.column}`;case u.INDEX_TYPE.UNIQUE:return`&${e.column}`}throw new Error(`Cannot format index of type "${e.type}"`)}function y(e){return 1===e.length?e[0]:`[${e.join("+")}]`}function E(e,t){let r=e;return(null==t?void 0:t.reverse)&&(r=r.reverse()),t&&null!=t.offset&&(r=r.offset(t.offset)),t&&null!=t.limit&&0!==t.limit&&(r=r.limit(t.limit)),r}function S(e){return p.resolve(e)}function v(e,t,r){__LOG__(3,!0)`idb faild to do Operation: ${t} on Table: ${r}. Failed with error ${e}`}function T(e,t){const r=Array.from(t.entries());e.forEach((()=>{r.forEach((t=>{let[r,n]=t;if(e[r]&&!(e[r]._keyId&&e[r]._data&&e[r].iv))throw new Error("[CRITICAL] Records contain unencrypted field")}))}))}t.default=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;this.tableNames=new Map,this.tableColumns=new Map,this.tableEncryptedColumns=new Map,this.errorHandlers=new Map,this.name=e,this.db=new o.default(this.name),this.transformSchema=t}initialize(e,t,r,n){return n&&(this.errorHandlers=n),function(e,t,r,n,i){return(0,s.promiseReduce)(e,((e,a)=>i((0,u.cloneSchema)(a)).then((i=>{if((0,l.default)(!(i.name in e),"Multiple tables resulted in the same transformed name"),i.deleted)return e[i.name]=null,e;t.set(a.name,i.name),r.set(a.name,i.columns.map((e=>e.name))),n.set(a.name,i.encryptedColumns||{});const s=i.columns.filter((e=>e.primaryKey));(0,l.default)(s.length>=1,`No primary key was defined for "${a.name}"`);const o=[m(s)].concat(i.indexes.map(g)).join(", ");return e[i.name]=o,e}))),{})}(t,this.tableNames,this.tableColumns,this.tableEncryptedColumns,this.transformSchema).then((t=>{this.db.version(e+1).stores(t).upgrade((e=>{var t;if(r)return null===(t=e[r.name])||void 0===t?void 0:t.toCollection().modify(r.callback)}))}))}open(){return p.resolve(this.db.open())}transact(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rw";return p.resolve(this.db.transaction(r,e,(()=>t()))).catch((e=>{const t=this.errorHandlers.get(e.name);if(!t)throw e;t(e)}))}close(){return this.db.close(),p.resolve()}view(e,t,r,n){(0,l.default)(this.tableNames.has(e),`Attemped to get view for uninitialized table "${e}"`),(0,l.default)(this.tableColumns.has(e),`Attemped to get columns for uninitialized table "${e}"`);const i=r?function(e){if(!e)return e=>e;return t=>{const r={};return e.forEach((e=>{t.hasOwnProperty(e)&&(r[e]=t[e])})),r}}(this.tableColumns.get(e)):e=>e;return new _(this.db.table(this.tableNames.get(e)),this.db,t,i,(0,a.default)(this.tableEncryptedColumns.get(e),"this.tableEncryptedColumns.get(table)"),n)}available(){return p.resolve(!0)}reset(){return this.tableNames=new Map,p.resolve(this.db.delete())}}},76140:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(64103),a=n(r(52991));t.default=class{constructor(e,t){this.errorHandlers=new Map,this._view=e,t&&(this.errorHandlers=t)}_maybeHandleError(e){const t=this.errorHandlers.get(e.name);t&&t(e)}_read(e){if(a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db read operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}_write(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db write operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}create(e){return this._write((t=>t.create(e)))}preflightEncryptSingleRecord(e){return this._write((t=>t.preflightEncryptSingleRecord(e)))}postflightDecryptSingleRecord(e){return this._write((t=>t.postflightDecryptSingleRecord(e)))}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}createOrReplace(e){return this._write((t=>t.createOrReplace(e)))}createOrMerge(e,t){return this._write((r=>r.createOrMerge(e,t)))}get(e){return this._read((t=>t.get(e)))}merge(e,t){return this._write((r=>r.merge(e,t)))}remove(e){return this._write((t=>t.remove(e)))}bulkCreate(e){return this._write((t=>t.bulkCreate(e)))}bulkCreateOrReplace(e){return this._write((t=>t.bulkCreateOrReplace(e)))}bulkCreateOrMerge(e){return this._write((t=>t.bulkCreateOrMerge(e)))}bulkGet(e,t){return this._read((r=>r.bulkGet(e,t)))}bulkRemoveByIndex(e,t){return this._write((r=>r.bulkRemoveByIndex(e,t)))}bulkRemove(e){return this._write((t=>t.bulkRemove(e)))}bulkDeleteRange(e,t,r){return this._write((n=>n.bulkDeleteRange(e,t,r)))}all(e,t){return this._read((r=>r.all(e,t)))}count(){return this._read((e=>e.count()))}equals(e,t,r){return this._read((n=>n.equals(e,t,r)))}anyOf(e,t,r){return this._read((n=>n.anyOf(e,t,r)))}startsWithAnyOf(e,t,r){return this._read((n=>n.startsWithAnyOf(e,t,r)))}greaterThan(e,t,r){return this._read((n=>n.greaterThan(e,t,r)))}lessThan(e,t,r){return this._read((n=>n.lessThan(e,t,r)))}between(e,t,r,n,i){return this._read((a=>a.between(e,t,r,n,i)))}forEachSortedBy(e,t){return this._read((r=>r.forEachSortedBy(e,t)))}forEach(e){return this._read((t=>t.forEach(e)))}clear(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._write((e=>e.clear()),e)}}},67204:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212));class s extends a.default{constructor(e){super(),(0,i.default)("AbstractPrimaryKey"!==this.constructor.name,"Cannot instantiate abstract class AbstractPrimaryKey"),Array.isArray(e)?this.columns=[...e]:this.columns=[e]}validate(e){(0,i.default)(0===e.columns.length,"Attempted to add primary key after other columns")}apply(){throw new Error("Subclass of `AbstractPrimaryKey` must implement `apply` method")}}t.default=s},92061:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===s.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===s.INDEX_TYPE.ARRAY||e.type===s.INDEX_TYPE.SIMPLE||e.type===s.INDEX_TYPE.UNIQUE)&&(0,s.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,s.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:s.INDEX_TYPE.ARRAY,column:this.column}}}t.default=o},79051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.name=e}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,s.cloneSchema)(e);return t.columns.push({name:this.name}),t}}t.default=o},34654:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.columns=[...e]}validate(e){this.columns.forEach((t=>{(0,i.default)(e.columns.find((e=>e.name===t)),`Attempted to add index on non-existent column "${t}" in "${e.name}"`)})),(0,i.default)(this.columns.length>1,"Attempted to add composite index for only 1 column"),(0,i.default)(-1===(0,s.findIndex)(e,this._getIndex()),`Attempted to add index [${String(this.columns)}], which already exists in "${e.name}"`);const t=e.columns.filter((e=>e.primaryKey&&e.primaryKey===s.PRIMARY_KEY_TYPE.COMPOSITE)).map((e=>e.name));(0,i.default)(t.length!==this.columns.length||t.some((e=>!this.columns.includes(e))),`Attempted to add index [${String(this.columns)}], which already is the primary key in "${e.name}"`)}apply(e){const t=(0,s.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:s.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=o},86445:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENCRYPTED_VALUE_TYPE=t.AddEncryptedColumn=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);const o=Object.freeze({STRING:"String",ARRAY_BUFFER:"ArrayBuffer"});t.ENCRYPTED_VALUE_TYPE=o;class l extends a.default{constructor(e,t){super(),this.name=e,this.dataType=t}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add encrypted column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,s.cloneSchema)(e);return t.columns.push({name:this.name}),t.encryptedColumns[this.name]=this.dataType,t}}t.AddEncryptedColumn=l},19570:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.keyPath=e,this.column=e.split(".")[0]}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===s.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===s.INDEX_TYPE.ARRAY||e.type===s.INDEX_TYPE.SIMPLE||e.type===s.INDEX_TYPE.UNIQUE)&&(0,s.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,s.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:s.INDEX_TYPE.SIMPLE,column:this.keyPath}}}t.default=o},39043:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===s.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===s.INDEX_TYPE.ARRAY||e.type===s.INDEX_TYPE.SIMPLE||e.type===s.INDEX_TYPE.UNIQUE)&&(0,s.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,s.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:s.INDEX_TYPE.UNIQUE,column:this.column}}}t.default=o},81674:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(67204)),s=r(78585);class o extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,s.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:s.PRIMARY_KEY_TYPE.AUTO_INCREMENT}),t}}t.default=o},54180:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(67204)),s=r(78585);class o extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&this.columns.length>1,"Attempted to add composite primary key for only 1 column")}apply(e){const t=(0,s.cloneSchema)(e);return this.columns.forEach((e=>{t.columns.push({name:e,primaryKey:s.PRIMARY_KEY_TYPE.COMPOSITE})})),t}}t.default=o},73212:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143));t.default=class{constructor(){(0,i.default)("Mutation"!==this.constructor.name,"Cannot instantiate abstract class Mutation")}validate(){throw new Error("Subclasses of Mutaton must implement `validate`")}apply(){throw new Error("Subclasses of Mutaton must implement `apply`")}}},45441:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,s.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,s.cloneSchema)(e),r=(0,s.findIndex)(e,this._getIndex());return t.indexes.splice(r,1),t}_getIndex(){return{type:s.INDEX_TYPE.ARRAY,column:this.column}}}t.default=o},23263:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.name=e}validate(e){const t=e.columns.find((e=>e.name===this.name));(0,i.default)(t,`Attempted to remove column "${this.name}" from "${e.name}" but it doesn't exist`),(0,i.default)(!t.primaryKey,`Attempted to remove primary key column "${this.name}". Removing primary keys is not supported.`),(0,i.default)(!e.indexes.some((e=>(0,s.indexContainsColumn)(e,this.name))),`Attempted to remove column "${this.name}" from "${e.name}" but an index exists with the column`)}apply(e){const t=(0,s.cloneSchema)(e);return t.columns.splice(t.columns.findIndex((e=>e.name===this.name)),1),t}}t.default=o},79913:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.columns=[...e].sort()}validate(e){(0,i.default)(-1!==(0,s.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index [${String(this.columns)}] on "${e.name}"`)}apply(e){const t=(0,s.cloneSchema)(e),r=(0,s.findIndex)(e,this._getIndex());return t.indexes.splice(r,1),t}_getIndex(){return{type:s.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=o},42062:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(73212)),s=r(78585);class o extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,s.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,s.cloneSchema)(e),r=(0,s.findIndex)(e,this._getIndex());return t.indexes.splice(r,1),t}_getIndex(){return{type:s.INDEX_TYPE.SIMPLE,column:this.column}}}t.default=o},89362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41143)),a=n(r(67204)),s=r(78585);class o extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,s.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:s.PRIMARY_KEY_TYPE.USER_DEFINED}),t}}t.default=o},5183:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sortMutations=function(e){return[...e].sort(E)};var i=n(r(41143)),a=n(r(92061)),s=n(r(79051)),o=n(r(34654)),l=r(86445),c=n(r(19570)),d=n(r(39043)),u=n(r(81674)),p=n(r(54180)),h=n(r(45441)),f=n(r(23263)),_=n(r(79913)),m=n(r(42062)),g=n(r(89362));const y=[_.default,h.default,m.default,f.default,u.default,g.default,p.default,s.default,c.default,a.default,o.default,d.default,l.AddEncryptedColumn];function E(e,t){const r=y.indexOf(e.constructor),n=y.indexOf(t.constructor);return(0,i.default)(-1!==r,`Mutation ${e.constructor.name} is not a known mutation type`),(0,i.default)(-1!==n,`Mutation ${e.constructor.name} is not a known mutation type`),r-n}},78585:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PRIMARY_KEY_TYPE=t.INDEX_TYPE=void 0,t.cloneSchema=function(e){return{name:e.name,columns:e.columns.map((e=>(0,i.default)({},e))),indexes:e.indexes.map(c),encryptedColumns:(0,i.default)({},e.encryptedColumns||{}),deleted:e.deleted}},t.emptySchema=function(e){return{name:e,columns:[],indexes:[],encryptedColumns:{}}},t.findIndex=function(e,t){return e.indexes.findIndex((e=>function(e,t){if(e.type!==t.type)return!1;switch(e.type){case o.SIMPLE:case o.ARRAY:case o.UNIQUE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.column===t.column;case o.COMPOSITE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.columns.length===t.columns.length&&!e.columns.some((e=>!t.columns.includes(e)))}throw new Error(`cannot compare unknown indexes of types: ${e.type}, ${t.type}`)}(t,e)))},t.freezeSchema=function(e){return Object.freeze({name:e.name,columns:Object.freeze(e.columns.map(Object.freeze)),indexes:Object.freeze(e.indexes.map(l)),encryptedColumns:Object.freeze((0,i.default)({},e.encryptedColumns||{})),deleted:e.deleted})},t.indexContainsColumn=function(e,t){switch(e.type){case o.SIMPLE:case o.ARRAY:case o.UNIQUE:return e.column===t;case o.COMPOSITE:return!!e.columns.find((e=>e===t))}throw new Error(`cannot check indexes of unknown index type: ${e.type}`)};var i=n(r(81109)),a=n(r(41143));const s=Object.freeze({AUTO_INCREMENT:"auto-increment",USER_DEFINED:"user-defined",COMPOSITE:"composite"});t.PRIMARY_KEY_TYPE=s;const o=Object.freeze({SIMPLE:"simple",COMPOSITE:"composite",ARRAY:"array",UNIQUE:"unique"});function l(e){switch(e.type){case o.SIMPLE:return Object.freeze({type:o.SIMPLE,column:e.column});case o.ARRAY:return Object.freeze({type:o.ARRAY,column:e.column});case o.COMPOSITE:return Object.freeze({type:o.COMPOSITE,columns:Object.freeze(e.columns.map(Object.freeze))});case o.UNIQUE:return Object.freeze({type:o.UNIQUE,column:e.column})}throw new Error(`cannot freeze index of unknown type: ${e.type}`)}function c(e){switch(e.type){case o.SIMPLE:return{type:o.SIMPLE,column:e.column};case o.UNIQUE:return{type:o.UNIQUE,column:e.column};case o.COMPOSITE:return{type:o.COMPOSITE,columns:e.columns.map((e=>e))};case o.ARRAY:return{type:o.ARRAY,column:e.column}}throw new Error(`cannot clone unknown index type: ${e.type}`)}t.INDEX_TYPE=o},90288:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageVersionManager=t.MissingVersionError=t.InvalidVersionError=t.DuplicateVersionError=void 0;class r extends Error{constructor(){super(...arguments),this.name="DuplicateVersionError"}}t.DuplicateVersionError=r;class n extends Error{constructor(){super(...arguments),this.name="InvalidVersionError"}}t.InvalidVersionError=n;class i extends Error{constructor(){super(...arguments),this.name="MissingVersionError"}}t.MissingVersionError=i;t.StorageVersionManager=class{constructor(){this.versions=new Set,this._max=-1}claim(e){if(e<0)throw new n("Versions must by greater than or equal to zero!");if(this.versions.has(e))throw new r(`Version #${e} has already been claimed!`);this.versions.add(e),this._max=Math.max(this.max,e)}version(e){if(e<0)throw new n("Versions must by greater than or equal to zero!");return e}validate(){for(let e=0;e<=this.max;++e)if(!this.versions.has(e))throw new i(`Schema version #${e} is missing!`)}get max(){return this._max}}},37521:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.NotInitializedError=t.NoSuchTableError=t.NoSuchDatabaseError=t.NoFallbackError=t.DuplicateTableError=t.DuplicateDatabaseError=t.AlreadyInitializedError=void 0;var i=n(r(48926)),a=n(r(76140)),s=r(90288),o=n(r(26196));class l extends Error{constructor(){super(...arguments),this.name="AlreadyInitializedError"}}t.AlreadyInitializedError=l;class c extends Error{constructor(){super(...arguments),this.name="DuplicateDatabaseError"}}t.DuplicateDatabaseError=c;class d extends Error{constructor(){super(...arguments),this.name="DuplicateTableError"}}t.DuplicateTableError=d;class u extends Error{constructor(){super(...arguments),this.name="NoFallbackError"}}t.NoFallbackError=u;class p extends Error{constructor(){super(...arguments),this.name="NoSuchDatabaseError"}}t.NoSuchDatabaseError=p;class h extends Error{constructor(){super(...arguments),this.name="NoSuchTableError"}}t.NoSuchTableError=h;class f extends Error{constructor(){super(...arguments),this.name="NotInitializedError"}}t.NotInitializedError=f;t.Storage=class{constructor(e){this.tables=new Map,this.views=new Map,this.state=1,this.versions=new s.StorageVersionManager,this.errorHandlers=new Map,this._database=e}addErrorHandler(e,t){const r=(new e).name;this.errorHandlers.set(r,t)}add(e){if(this.tables.has(e))throw new d(`Table "${e}" already added. Reuse the definition.`);const t=new o.default(e,this.versions);return this.tables.set(e,t),t}_getBackingDB(){return this._database}_unsafeGetOrCreateView(e){if(this.views.has(e))return this.views.get(e);const t=this._database.view(e.name,e.rowview,e.shouldEnablePropFilter,e.shouldUseDbMsgEncKeyForEncryptedCol);return this.views.set(e,t),t}_guardInitializedThunk(e){return()=>{if(3&this.state)throw new f("Storage must be initialized before accessing a table!");return e()}}table(e){const t=this.tables.get(e);if(!t)throw new h(`Unknown table ${e} requested, ensure table is defined!`);if(!this._getBackingDB())throw new p(`Unable to find associated database with table "${e}"`);return new a.default(this._guardInitializedThunk((()=>this._unsafeGetOrCreateView(t))),this.errorHandlers)}lock(e,t){if(3&this.state)return Promise.reject(new f("Initialize storage before attempting to lock tables!"));for(let t=0;t<e.length;++t)if(!this.tables.has(e[t]))return Promise.reject(new h(`Requested lock of unknown table "${e[t]}"`));const r=e.map((e=>{const t=this.tables.get(e);if(t)return t;throw new h(`Requested lock of unknown table "${e}"`)})).map((e=>this._unsafeGetOrCreateView(e)));return this._getBackingDB().transact(e,(0,i.default)((function*(){return t(r)}))).finally((()=>{}))}_getUpgraderForCurrentVersion(e,t){for(let r=0;r<e.length;r++)if(e[r].maxVersion===t){const n=e[r].upgraders.get(t);if(n)return{name:e[r].name,callback:n}}}_applyDatabaseVersion(e,t,r){const n=t,i=r.map((e=>e.schema(n))).filter(Boolean);return e.initialize(t,i,this._getUpgraderForCurrentVersion(r,n),this.errorHandlers)}initialize(){var e=this;return(0,i.default)((function*(){if(4&e.state)throw new l("Storage instance has already been initialized");if(e.versions.validate(),!e._database)throw new p(`"${e._database.constructor.name}" failed availability check!`);yield e._database.available();const t=Array.from(e.tables.values()),r=e._getBackingDB();if(t&&r){for(let n=0;n<=e.versions.max;n++)yield e._applyDatabaseVersion(r,n,t);yield r.open(),e.state=4}}))()}purge(){return this.state=2,this.views=new Map,this._getBackingDB().reset().then((()=>{}))}}},26196:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(41143)),s=r(78585),o=r(5183);function l(e){return e}t.default=class{constructor(e,t){this.maxVersion=-1,this.versions=new Map,this.upgraders=new Map,this.shouldEnablePropFilter=!0,this.shouldUseDbMsgEncKeyForEncryptedCol=!1,this.name=e,this.versionManager=t}version(e,t,r){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,a.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const n=this.schema(e)||(0,s.emptySchema)(this.name),i=(0,o.sortMutations)(t).reduce(((e,t)=>(t.validate(e),t.apply(e))),(0,s.cloneSchema)(n));return this.versions.set(e,(0,s.freezeSchema)(i)),this.upgraders.set(e,r),this}delete(e){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,a.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const t=this.schema(e)||(0,s.emptySchema)(this.name),r=(0,i.default)((0,i.default)({},t),{},{deleted:!0});return this.versions.set(e,(0,s.freezeSchema)(r)),this}view(e){return this.rowview=e,this}enablePropFilter(e){return this.shouldEnablePropFilter=e,this}useDbMsgEncKeyForEncryptedCol(e){return this.shouldUseDbMsgEncKeyForEncryptedCol=e,this}schema(e){const t=this.versions.get(e);if(t)return t;const r=Array.from(this.versions.keys()).map(l).sort(((e,t)=>e-t)).filter((t=>t<e)).pop();return r||0===r?this.versions.get(r)||(0,s.emptySchema)(this.name):null}}},29830:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"IdbArrayBufferTable",{enumerable:!0,get:function(){return o.IdbArrayBufferTable}}),Object.defineProperty(t,"IdbMetaInfoTable",{enumerable:!0,get:function(){return s.IdbMetaInfoTable}}),t.initialize=void 0,Object.defineProperty(t,"metaInfoDateIndex",{enumerable:!0,get:function(){return s.metaInfoDateIndex}}),Object.defineProperty(t,"metaInfoPrimaryIndex",{enumerable:!0,get:function(){return s.metaInfoPrimaryIndex}}),Object.defineProperty(t,"metaInfoSizeIndex",{enumerable:!0,get:function(){return s.metaInfoSizeIndex}}),Object.defineProperty(t,"storeDataIndex",{enumerable:!0,get:function(){return o.storeDataIndex}}),Object.defineProperty(t,"storePrimaryIndex",{enumerable:!0,get:function(){return o.storePrimaryIndex}});var i=n(r(51463)),a=r(24439),s=r(9362),o=r(3971);const l=(0,i.default)((()=>(0,a.getStorage)().initialize()));t.initialize=l},3971:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePrimaryIndex=t.storeDataIndex=t.IdbArrayBufferTable=void 0;var i=n(r(79051)),a=r(24439),s=n(r(89362));const o="id";t.storePrimaryIndex=o;const l="data";t.storeDataIndex=l;const c="lru-media-array-buffer";(0,a.getStorage)().add(c).version((0,a.getStorage)().versions.version(0),[new s.default(o),new i.default(l)]).view((e=>({id:e.id,data:e.data})));const d=(0,a.getStorage)().table(c);t.IdbArrayBufferTable=d},9362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.metaInfoSizeIndex=t.metaInfoPrimaryIndex=t.metaInfoDateIndex=t.IdbMetaInfoTable=void 0;var i=n(r(79051)),a=n(r(19570)),s=r(24439),o=n(r(89362));t.metaInfoPrimaryIndex="id";const l="timestamp";t.metaInfoDateIndex=l;const c="size";t.metaInfoSizeIndex=c;const d="lru-media-meta-info";(0,s.getStorage)().add(d).version((0,s.getStorage)().versions.version(1),[new o.default("id"),new i.default(l),new a.default(l)]).version((0,s.getStorage)().versions.version(2),[new i.default(c)]).view((e=>({id:e.id,timestamp:e.timestamp,size:e.size||0})));const u=(0,s.getStorage)().table(d);t.IdbMetaInfoTable=u},24439:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=p,t.destroyStorage=function(){return h.apply(this,arguments)},t.getStorage=function(){return(0,s.default)(null!=u,"[lru-media-storage-idb] Storage should be created first before being accessed"),u};var i=n(r(48926)),a=n(r(86128)),s=n(r(41143)),o=n(r(98883)),l=r(37521),c=r(23283);const d="lru-media-storage-idb";t.DATABASE_NAME=d;let u=null;function p(){const e=new o.default(d);u=new l.Storage(e),u.addErrorHandler(a.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&c.StorageCmd.trigger("storage_not_enough_space")}))}function h(){return(h=(0,i.default)((function*(){if(null==u)throw new Error("[lru-media-storage-idb] Storage should be created first before being destroyed");try{yield u.purge()}finally{u=null}}))).apply(this,arguments)}p()},34541:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABPropConfigs=function(){return(0,l.initializeWithoutGKs)().then((()=>(0,a.getTable)().all().then((e=>e))))},t.getConfigValue=function(e){const t=s.ABPropConfigs[e];if(null==t)return __LOG__(4,!0,new Error,!0)`invalid ABProps config name`,SEND_LOGS("invalid ABProps config name: "+e),Promise.reject(new Error("invalid ABProps config name"));const[r,n,i]=t;return(0,l.initializeWithoutGKs)().then((()=>(0,a.getTable)().get(String(r)).then((e=>e?d(e.configValue,n,i):i))))},t.parseConfigValue=d,t.setConfigAccessed=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield r.get(String(e));null==n||!0===(null==n?void 0:n.hasAccessed)||(yield r.merge(String(e),{hasAccessed:!0}))}));return function(){return t.apply(this,arguments)}}())},t.updateABPropConfigs=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield r.all(),i=new Map;n.forEach((e=>{null!=e.configExpoKey&&i.set(e.configCode,{configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})}));let a=!1;const s=[];e.forEach(((e,t)=>{let r=!1;const n=i.get(String(t));if(n){const i=n.configExpoKey;null!=i&&e.configExpoKey!==i?(o.exposureKeys.delete(i),a=!0,o.accessedConfigs.delete(t)):null!=i&&(r=n.hasAccessed)}s.push({configCode:String(t),configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:r})})),a&&(0,o.updateGlobalExpoKey)(),yield r.clear(),yield r.bulkCreate(s)}));return function(){return t.apply(this,arguments)}}())};var i=n(r(48926)),a=r(32446),s=r(56042),o=r(80024),l=r(23356),c=r(99069);function d(e,t,r){return null==e||null==t?r:"bool"===t?"1"===e||"True"===e||"true"===e:"int"===t?parseInt(e,10):"float"===t?parseFloat(e):e}},38342:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._cache=void 0,t.addActiveMessageRange=function(){return _.apply(this,arguments)},t.bulkUpdateActiveMessageRanges=function(e){return h.bulkCreateOrReplaceRanges(e)},t.getActiveMessageRanges=function(e){return h.getRangesForChat(e)},t.getActiveRangeAction=function(e,t){switch(e){case"archive":return l.ActiveRangeAction.Archive;case"markChatAsRead":return l.ActiveRangeAction.MarkChatAsRead;case"clearChat":return(null==t?void 0:t.deleteStarred)&&t.deleteMedia?l.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:(null==t?void 0:t.deleteStarred)&&!t.deleteMedia?l.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:(null==t?void 0:t.deleteMedia)&&!t.deleteStarred?l.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:l.ActiveRangeAction.ClearChatKeepStarredKeepMedia;case"deleteChat":return(null==t?void 0:t.deleteMedia)?l.ActiveRangeAction.DeleteChatDeleteMedia:l.ActiveRangeAction.DeleteChatKeepMedia;default:throw new Error("unsupported active message range action")}},t.removeActiveMessageRange=function(e,t){return h.removeRange(e,t)},t.updateActiveMessageRange=function(e){return h.createOrReplaceRange(e)};var i=n(r(81109)),a=n(r(48926)),s=n(r(45095)),o=r(84902),l=r(69702),c=r(23356),d=r(30986),u=r(22701);let p=new Map;const h={reset:()=>{p=new Map},removeRange(e,t){var r;return null===(r=p.get(e))||void 0===r||r.delete(t),(0,c.getActiveMessageRangesTable)().remove([e,t])},createOrReplaceRange(e){let t=p.get(e.chatId);return null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e),(0,c.getActiveMessageRangesTable)().createOrReplace(e)},bulkCreateOrReplaceRanges:e=>(e.forEach((e=>{let t=p.get(e.chatId);null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e)})),(0,c.getActiveMessageRangesTable)().bulkCreateOrReplace(e)),getRangesForChat:e=>(0,a.default)((function*(){let t=p.get(e);if(null==t){const r=yield(0,c.getActiveMessageRangesTable)().anyOf(["chatId"],[e]);t=new Map(r.map((e=>[e.action,e]))),p.set(e,t)}return[...t.values()]}))()};function f(e,t){switch(e){case l.ActiveRangeAction.Archive:return{action:l.ActiveRangeAction.Archive,actionValue:(0,s.default)(t.archiveChatAction,"syncActionValue.archiveChatAction")};case l.ActiveRangeAction.MarkChatAsRead:return{action:l.ActiveRangeAction.MarkChatAsRead,actionValue:(0,s.default)(t.markChatAsReadAction,"syncActionValue.markChatAsReadAction")};case l.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return{action:l.ActiveRangeAction.ClearChatKeepStarredKeepMedia,actionValue:(0,s.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case l.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:return{action:l.ActiveRangeAction.ClearChatKeepStarredDeleteMedia,actionValue:(0,s.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case l.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return{action:l.ActiveRangeAction.ClearChatDeleteStarredKeepMedia,actionValue:(0,s.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case l.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:return{action:l.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia,actionValue:(0,s.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case l.ActiveRangeAction.DeleteChatDeleteMedia:return{action:l.ActiveRangeAction.DeleteChatDeleteMedia,actionValue:(0,s.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};case l.ActiveRangeAction.DeleteChatKeepMedia:return{action:l.ActiveRangeAction.DeleteChatKeepMedia,actionValue:(0,s.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};default:throw new Error(`unsupported action for message ranges: ${String(e)}`)}}function _(){return(_=(0,a.default)((function*(e,t,r){var n;const a=(0,o.decodeProtobuf)(u.SyncActionValueSpec,r),{actionValue:s}=f(t,a),l=(null===(n=s.messageRange)||void 0===n?void 0:n.messages)||[],c=yield(0,d.filterReceivedMessagesInRange)(e,l),p=Math.max(0,l.length-c.length);return h.createOrReplaceRange((0,i.default)((0,i.default)({chatId:e},f(t,a)),{},{remainingMessages:p}))}))).apply(this,arguments)}t._cache=h},4548:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(0,n.getTable)().all().then((e=>e.map((e=>(0,s.createUserWid)(e.id))))):Promise.resolve([])},t.updateBlocklist=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)&&e){const t=e.map((e=>({id:e.toString()})));return(0,a.getStorage)().lock(["blocklist"],(e=>{let[r]=e;return r.clear().then((()=>r.bulkCreate(t).then((()=>!0))))}))}return Promise.resolve(!1)};var n=r(89426),i=r(7293),a=r(99069),s=r(58021)},60112:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateChatEvent=function(){return s.apply(this,arguments)},t.deleteBeforeInclusive=function(){return o.apply(this,arguments)},t.getBeforeInclusive=function(e){return(0,a.getTable)().lessThan(["startTs"],e,{inclusive:!0})},t.getChatEvent=function(e,t){return(0,a.getTable)().get([e,t])};var i=n(r(48926)),a=r(91314);function s(){return(s=(0,i.default)((function*(e,t,r){const n=yield(0,a.getTable)().get([e,t]),i=null!=n?n:{chatId:e,startTs:t,msgsSent:0,msgsReceived:0};return null!=r.addMsgsSent&&(i.msgsSent+=r.addMsgsSent),null!=r.addMsgsReceived&&(i.msgsReceived+=r.addMsgsReceived),(0,a.getTable)().createOrReplace(i)}))).apply(this,arguments)}function o(){return(o=(0,i.default)((function*(e){return yield(0,a.getTable)().bulkDeleteRange(["startTs"],0,e+1)}))).apply(this,arguments)}},48285:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUnreadMentionChat=function(e,t){return(0,_.getStorage)().lock(["chat"],function(){var r=(0,i.default)((function*(r){let[n]=r;const i=Array.from(e.keys());if(0===i.length)return;const a=yield(0,o.getTable)().bulkGet(i);if(!a||0===a.length)return void __LOG__(4,void 0,new Error)`addUnreadMentionChat: could not find chats`;const s=[];return a.forEach((r=>{if(r){var n;const a=r.id.toString();let o=null!==(n=r.unreadMentionsOfMe)&&void 0!==n?n:[];const l=e.get(a);l&&(o=o.concat(l));let c={id:a,unreadMentionsOfMe:o};if(t){var i;c={id:a,unreadMentionsOfMe:o,unreadMentionCount:null!==(i=t.get(a))&&void 0!==i?i:0}}s.push(c)}})),(0,o.getTable)().bulkCreateOrMerge(s)}));return function(){return r.apply(this,arguments)}}())},t.createChat=function(e,t){return(0,o.getTable)().create((0,a.default)({id:e.toString()},t)).catch((e=>{if(e instanceof d.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when create local"),new Error("update chat table failed")}))},t.getChatMeta=function(){return m.apply(this,arguments)},t.markMessageAndChatAsRead=function(e,t,r){return(0,_.getStorage)().lock(["message","chat"],function(){var n=(0,i.default)((function*(n){let[i,a]=n;const s=yield(0,h.getTable)().equals(["from","pendingReadReceipt"],[t,1],{shouldDecrypt:!1}),o=[];let l=0;const d=[];s.forEach((t=>{if(null==e||null!=t.rowId&&t.rowId>e){if(l++,(0,p.isGroupCatchUpEnabled)()&&(0,f.isImportantMessage)(t)){const e={id:t.id,timestamp:t.t};d.push(e)}}else o.push({id:t.id,ack:Math.max(t.ack,c.default.ACK.READ),pendingReadReceipt:null})}));const u=0===l&&r?-1:l,_=[a.createOrMerge(t,{id:t,unreadCount:u,unreadMentionsOfMe:d,unreadMentionCount:0})];o.length>0&&_.push((0,h.getTable)().bulkCreateOrMerge(o)),yield Promise.all(_)}));return function(){return n.apply(this,arguments)}}())},t.pruneExpiredTcTokens=function(){return g.apply(this,arguments)},t.removeUnreadMentionChat=function(e){return(0,_.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=Array.from(e.keys());if(0===n.length)return;const i=yield(0,o.getTable)().bulkGet(n);if(!i||0===i.length)return void __LOG__(4,void 0,new Error)`removeUnreadMentionChat: could not find chats`;const a=[];return i.forEach((t=>{if(t){var r;let n=null!==(r=t.unreadMentionsOfMe)&&void 0!==r?r:[];const i=e.get(t.id.toString());i&&(n=n.filter((e=>!i.includes(e.id)))),a.push({id:t.id.toString(),unreadMentionsOfMe:n})}})),(0,o.getTable)().bulkCreateOrMerge(a)}));return function(){return t.apply(this,arguments)}}())},t.updateChatArchiveDrawer=function(e){return(0,_.getStorage)().lock(["chat"],(t=>{let[r]=t;const n=Array.from(e.keys());if(0===n.length)return Promise.resolve();const i=n.map((t=>{var r;return{id:t,archiveAtMentionViewedInDrawer:null!==(r=e.get(t))&&void 0!==r&&r}}));return r.bulkCreateOrMerge(i)}))},t.updateChatForMarkAsReadSync=function(e){return(0,_.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield r.get(e);if(null!=n)return-1===n.unreadCount?r.createOrMerge(e,{id:e,unreadCount:0,unreadMentionsOfMe:[],unreadMentionCount:0}):void 0;__LOG__(4,void 0,new Error)`updateMarkChatAsReadSync: could not find chat with id ${e}`}));return function(){return t.apply(this,arguments)}}())};var i=n(r(48926)),a=n(r(81109)),s=r(86945),o=r(68638),l=r(4484),c=n(r(69618)),d=r(64103),u=r(7293),p=r(10435),h=r(90981),f=r(54676),_=r(99069);function m(){return(m=(0,i.default)((function*(e){const t=yield(0,o.getTable)().get(e.toString());return t?{unreadCount:t.unreadCount,timestamp:t.t}:Promise.reject(new Error("Failed to find row in chat table with id:"+e.toString()))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND)||!(0,s.getABPropConfigValue)("trusted_contacts"))return;const e=(0,l.tokenExpirationCutoff)(l.TcTokenMode.Receiver),t=yield(0,o.getTable)().lessThan(["tcTokenTimestamp"],e);if(!t||0===t.length)return;const r=t.map((e=>({id:e.id,tcToken:null,tcTokenTimestamp:null})));yield(0,o.getTable)().bulkCreateOrMerge(r)}))).apply(this,arguments)}},35673:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setNotAddressBookContacts=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))return(0,a.getStorage)().lock(["contact"],(()=>{const t=e.map((e=>({id:e,isAddressBookContact:0,name:void 0})));return(0,i.getContactTable)().bulkCreateOrMerge(t)}));return Promise.resolve()};var n=r(7293),i=r(76214),a=r(99069)},9108:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkCreateOrReplaceDeviceRecord=function(){return E.apply(this,arguments)},t.bulkGetDeviceRecord=m,t.createOrReplaceDeviceRecord=function(){return y.apply(this,arguments)},t.doesDeviceHashMatch=function(){return C.apply(this,arguments)},t.getAllDeviceLists=function(){return(0,l.getTable)().all()},t.getDeviceIds=S,t.getDeviceInfoForSync=function(){return A.apply(this,arguments)},t.getDeviceRecord=f,t.getMyDeviceList=function(){return b.apply(this,arguments)},t.hasDevice=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=n(r(94654)),s=r(42430),o=n(r(69618)),l=r(60996),c=r(99234),d=r(7293),u=r(53686),p=r(58021);const h=new s.LruCache({sizeLimit:2e3,getSize:()=>1});function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){if(!h.has(e)){const t=yield(0,l.getTable)().get(e);h.put(e,t)}return h.get(e)}return Promise.reject(new Error("getDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){const t=[];e.forEach((e=>{h.has(e)||t.push(e)}));return(yield(0,l.getTable)().bulkGet(t)).forEach(((e,r)=>{h.put(t[r],e)})),e.map((e=>h.get(e)))}return Promise.reject(new Error("bulkGetDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){return d.GK.supportsFeature(d.GK.F.MD_BACKEND)?(yield(0,l.getTable)().createOrReplace(e),void h.put(e.id,e)):Promise.reject(new Error("createOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){return d.GK.supportsFeature(d.GK.F.MD_BACKEND)?(yield(0,l.getTable)().bulkCreateOrReplace(e),void e.forEach((e=>{h.put(e.id,e)}))):Promise.reject(new Error("bulkCreateOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){return(yield m(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){if(t===o.default.DEVICE.PRIMARY_DEVICE)return!0;const[r]=yield S([e.user]);return!!r&&!!r.devices.includes(t)}return!1}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){return(yield m(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t,timestamp:e.timestamp,expectedTs:e.expectedTs}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND)){if(null==t)return!0;const r=(yield S([e.user])).map((e=>e?e.devices.map((t=>(0,p.createDeviceWidFromUserAndDevice)(e.id,t))):[])),n=(0,a.default)(r,(e=>e));return(yield(0,u.phashV2)(n))!==t}return!1}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(){const e=(0,c.assertGetMe)(),t=yield f(e.user);if(!t||t.deleted)throw new Error("syncd: cannot find my device list");return t}))).apply(this,arguments)}},36993:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateDirectConnectionKeys=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,n.getTable)().createOrMerge(e.id,e);return Promise.resolve()},t.fetchDirectConnectionKeys=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,n.getTable)().get(e);return Promise.resolve()};var n=r(68259),i=r(7293)},62415:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.persistGroupInviteV4Msg=function(e,t){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,c.getTable)().createOrMerge(e,t);return Promise.resolve()},t.revokeGroupInvites=function(){return u.apply(this,arguments)},t.updatePendingParticipants=function(){return p.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(22683),o=r(99234),l=r(7293),c=r(35884),d=r(58021);function u(){return(u=(0,a.default)((function*(e,t,r,n){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const a=yield(0,c.getTable)().equals(["from","to","groupId"],[e,t,r]).then((e=>e.filter((e=>!e.expired&&e.expiration<=n))));return(0,c.getTable)().bulkCreateOrReplace(a.map((e=>(0,i.default)((0,i.default)({},e),{},{expired:!0})))),a}return Promise.resolve(null)}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){var t;const n=null===(t=(0,o.getMaybeMeUser)())||void 0===t?void 0:t.toString(),i=r(63928).default.gadd(e);yield(0,c.getTable)().equals(["from","groupId"],[n,e.toString()]).then((e=>e.filter((e=>!e.expired&&s.Clock.globalUnixTime()<=e.expiration)))).then((e=>{e.forEach((e=>{i.pendingParticipants.add({id:(0,d.createUserWid)(e.to)})}))}))}return Promise.resolve()}))).apply(this,arguments)}},90101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupMetadataFromStorage=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,l.getStorage)().lock(["group-metadata","participant"],function(){var t=(0,i.default)((function*(t){let[r,n]=t;const i=yield r.get(e.toString());if(i){const t=yield n.get(e.toString());if(null==t?void 0:t.deviceSyncComplete){var a;__LOG__(2,void 0,void 0,void 0,["groups"])`found groupMetadata in storage for group id ${e.toString()}`;const r=new Set(t.admins);return{id:e,owner:i.owner&&(0,c.createWid)(i.owner),creation:i.creation,desc:i.desc,descId:i.descId,descOwner:i.descOwner&&(0,c.createWid)(i.descOwner),descTime:i.descTime,restrict:i.restrict||!1,announce:i.announce||!1,noFrequentlyForwarded:i.noFrequentlyForwarded||!1,ephemeralDuration:i.ephemeralDuration||0,participants:null===(a=t.participants)||void 0===a?void 0:a.map((e=>({id:(0,c.createWid)(e),isAdmin:r.has(e),isSuperAdmin:!1}))),subject:i.subject,support:!0===i.support,notAddedByContact:i.notAddedByContact||!1,addedBy:i.addedBy&&(0,c.createWid)(i.addedBy)}}}return __LOG__(2,void 0,void 0,void 0,["groups"])`did not find groupMetadata in storage for group id ${e.toString()}`,null}));return function(){return t.apply(this,arguments)}}());return Promise.resolve(null)},t.persistGroupMetadata=function(e,t){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,o.getTable)().createOrMerge(e.toString(),(0,a.default)({id:e.toString()},t));return Promise.resolve()};var i=n(r(48926)),a=n(r(81109)),s=r(7293),o=r(64632),l=r(99069),c=r(58021)},41037:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addNotification=h,t.enqueueNotification=function(){return f.apply(this,arguments)},t.fetchNextHitorySyncChunkForProcessing=function(){return _.apply(this,arguments)},t.getByChunkOrderNumber=function(e,t){let r;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(r=(0,o.getTable)().equals(["chunkOrder","syncType"],[e,t]),!r)return Promise.reject(new Error("getNotificationForChunk history sync notification: not supported for non MD"))}else r=Promise.reject(new Error("getNotificationForChunk for history sync notification: not supported without md backend"));return r},t.getNextUnProcessedNotification=u,t.markChunkForReuploadPending=function(e){return c.delete(e),(0,o.getTable)().merge(e,{reuploadPending:!0})},t.removeLocalFailureFromInFlightChunk=function(e){c.delete(e)},t.updateCurrentlyProcessed=p;var i=n(r(81109)),a=n(r(48926)),s=r(7293),o=r(15118),l=r(58052);const c=new Set;function d(){return(d=(0,a.default)((function*(e,t,r){const n=(0,l.getLastHistorySycnedChunk)();if(4===e)return!0;if([2,3].includes(e)&&1===t){if(3===e){return!!(0,l.getInitialHistorySyncComplete)()}{const e=(0,l.getHistorySyncStatus)();return!!(null==e?void 0:e.recentCompleted)}}if(null==n)return!1;const[i,a]=n.split("_");return i===`${e}`&&a===""+(t-1)||(i===`${e}`&&a===`${t}`?(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed: next chunk already processed ${e}_${t}, last processed: ${n} `,yield p(r),!1):(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed returned false for ${e}_${t}, last processed: ${n} `,!1))}))).apply(this,arguments)}function u(){let e;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(e=(0,o.getTable)().equals(["processed"],0,{shouldDecrypt:!1}).then(function(){var e=(0,a.default)((function*(e){var t;const r=e.filter((e=>!c.has(e.msgKey)&&!e.reuploadPending)).sort(((e,t)=>e.syncType<t.syncType?1:e.syncType>t.syncType?-1:e.syncType===t.syncType&&null!=e.chunkOrder&&null!=t.chunkOrder?e.chunkOrder-t.chunkOrder:0));let n=r.length>0?r[0]:void 0;if(null!=(null===(t=n)||void 0===t?void 0:t.chunkOrder)){if(n){if(!(yield function(){return d.apply(this,arguments)}(n.syncType,n.chunkOrder,n.msgKey)))return;n=yield(0,o.getTable)().postflightDecryptSingleRecord(n)}return n}var i;__LOG__(2,void 0,void 0,void 0,["History sync"])`getNextUnProcessedNotification chunkOrder is null, ${null===(i=n)||void 0===i?void 0:i.msgKey}`}));return function(){return e.apply(this,arguments)}}()),!e)return Promise.reject(new Error("getNextUnProcessed history sync notification: not supported for non MD"))}else e=Promise.reject(new Error("getNextUnProcessed for history sync notification: not supported without md backend"));return e}function p(e){let t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){if(c.delete(e),t=(0,o.getTable)().remove(e),!t)return Promise.reject(new Error("updateCurrentProcessed history sync notification: not supported for non MD"))}else t=Promise.reject(new Error("updateCurrentProcessed for history sync notification: not supported without md backend"));return t.catch((e=>{__LOG__(2,void 0,void 0,void 0,["History sync"])`updateCurrentlyProcessed failed with error ${e}`}))}function h(e){let t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const r=e.downloadOptions.mediaKey,n=e.downloadOptions.directPath,a=e.downloadOptions.filehash,s=e.downloadOptions.encFilehash;e.downloadOptions.mediaKey="",e.downloadOptions.directPath="",e.downloadOptions.filehash="",e.downloadOptions.encFilehash="";const l=(0,i.default)((0,i.default)({},e),{},{chunkEncryptionKey:r,directPath:n,filehash:a,encFilehash:s});if(e.processed=0,t=(0,o.getTable)().createOrMerge(e.msgKey,l),!t)return Promise.reject(new Error("add history sync notification: not supported for non MD"))}else t=Promise.reject(new Error("add history sync notification: not supported without md backend"));return t}function f(){return(f=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];yield h(e),t&&c.add(e.msgKey)}))).apply(this,arguments)}function _(){return(_=(0,a.default)((function*(){if(c.size>0)return null;const e=yield u();return e&&(e.downloadOptions.mediaKey=e.chunkEncryptionKey,delete e.chunkEncryptionKey,e.downloadOptions.directPath=e.directPath||e.downloadOptions.directPath,delete e.directPath,e.downloadOptions.filehash=""===e.downloadOptions.filehash?e.filehash:e.downloadOptions.filehash,delete e.filehash,e.downloadOptions.encFilehash=e.encFilehash,delete e.encFilehash,c.add(e.msgKey)),e}))).apply(this,arguments)}},54598:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndRemoveLocalLabelAssociation=function(){return o.apply(this,arguments)},t.queryLocalLabelAssociation=s;var i=n(r(48926)),a=r(82663);function s(e){return(0,a.getTable)().anyOf(["associationId","type"],e.map((e=>{let{associationId:t,type:r}=e;return[t,r]})))}function o(){return(o=(0,i.default)((function*(e){const t=yield s(e);yield(0,a.getTable)().bulkRemove(t.map((e=>{let{labelId:t,associationId:r,type:n}=e;return[t,r,n]})))}))).apply(this,arguments)}},14748:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceUpdateLock=function(e,t){if(!n.GK.supportsFeature(n.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in MD mode"));let r=["participant","device-list"];t&&(r=[...r,"message"]);return(0,i.getStorage)().lock(r,(t=>e(t)))};var n=r(7293),i=r(99069)},47124:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RetryEligibilityResult=void 0,t.createOrMergeReceiptRecords=function(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const t=new Map;return e.forEach((e=>{var r;const{msgKey:n,receiverId:i}=e,a=(0,h.toUserWid)(i).toString(),o=n.toString(),l=`${o},${a}`,c=null!==(r=i.device)&&void 0!==r?r:s.default.DEVICE.PRIMARY_DEVICE,d=t.get(l);d?d.deviceNotDelivered.push(c):t.set(l,{msgKey:o,receiverUserJid:a,deviceDelivered:[],deviceNotDelivered:[c]})})),(0,p.getStorage)().lock(["message-info"],function(){var e=(0,a.default)((function*(e){let[r]=e;const n=Array.from(t.values()).map((e=>[e.msgKey,e.receiverUserJid]));return(yield r.anyOf(["msgKey","receiverUserJid"],n)).forEach((e=>{const r=`${e.msgKey},${e.receiverUserJid}`,n=t.get(r);n&&t.set(r,(0,i.default)((0,i.default)({},e),{},{deviceNotDelivered:[...e.deviceNotDelivered,...n.deviceNotDelivered]}))})),(0,d.getTable)().bulkCreateOrReplace(Array.from(t.values()))}));return function(){return e.apply(this,arguments)}}())}return Promise.reject(new Error("createOrMergeReceiptRecords: not supported for non MD"))},t.isRetryEligible=function(e,t,r,n){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const i=(0,h.toUserWid)(t).toString(),a=t.device||0;return(0,d.getTable)().get([e.toString(),i]).then((o=>o?o.deviceNotDelivered.includes(a)?null!=r&&n>=r?y.ELIGIBLE:null!=t.device&&t.device!==s.default.DEVICE.PRIMARY_DEVICE||null!=o.delivery?y.INELIGIBLE_CHANGED_IDENTITY:y.ELIGIBLE:(__LOG__(2)`MessageInfoStore: ${e.toString()},${i}:${a} has been delivered`,y.INELIGIBLE_ALREADY_DELIVERED):(__LOG__(2)`MessageInfoStore: missing record for ${e.toString()},${i}`,y.INELIGIBLE_RECORD_MISSING)))}return Promise.resolve(y.INELIGIBLE_NOT_MD)},t.queryMsgInfo=function(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const t=String(e);return(0,c.getTable)().get(t).then((t=>{const r=t?t.count:null;return(0,d.getTable)().equals(["msgKey"],e.toString()).then((t=>{const n={delivery:[],deliveryRemaining:0,played:[],playedRemaining:0,read:[],readRemaining:0};let i=0;t.forEach((e=>{const t=(0,h.createWid)(e.receiverUserJid);if(!(0,o.getMeUser)().equals(t)){!function(e){const t=e.read;null!=t&&(null==e.delivery||e.delivery>t)&&(e.delivery=t)}(e);for(let r=0;r<g.length;r++){const i=g[r],a=e[i];if(null!=a){n[i].push({id:t,t:a});break}}u.ServerProps.bspSystemMessageEnabled&&null!=e.delivery&&null!=e.deliveryPrivacyMode&&(n.deliveryPrivacyMode=e.deliveryPrivacyMode),i+=1}}));const a=null!=r&&0!==r?r:i;return __LOG__(2)`queryMsgInfo: ${e}, ack count: ${r}, receiver: ${a},
played: ${n.played.length}, read: ${n.read.length}, delivery: ${n.delivery.length}`,n.playedRemaining=a-n.played.length,n.readRemaining=n.playedRemaining-n.read.length,n.deliveryRemaining=n.readRemaining-n.delivery.length,n}))}))}return Promise.reject(new Error("queryMsgInfo: not supported without model storage"))},t.updateReceiptRecords=function(e,t,r,n,i){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const a=m[e],s=(0,h.toUserWid)(r).toString(),o=r.device||0;return a?function(e,t,r,n,i,a){if(0===i.length)return Promise.resolve();return(0,p.getStorage)().lock(["message-info"],(s=>{let[o]=s;const l=i.map((e=>[e,r]));return o.bulkGet(l).then((s=>{const l=[];return i.forEach(((i,o)=>{const c=s[o];if(!c){__LOG__(2)`updateReceiptRecords: got receipt for peer msg ${i},${r}`;const n={msgKey:i,receiverUserJid:r,[e]:t,deviceDelivered:[],deviceNotDelivered:[]};return u.ServerProps.bspSystemMessageEnabled&&e===_.DELIVERY&&null!=a&&(n.deliveryPrivacyMode=a),void l.push(n)}if(e!==m[f.INACTIVE]){const r=c[e];(null==c[e]||r>t)&&(c[e]=t),u.ServerProps.bspSystemMessageEnabled&&e===_.DELIVERY&&null!=a&&(c.deliveryPrivacyMode=a)}c.deviceNotDelivered.length>0&&(c.deviceDelivered.push(n),c.deviceDelivered=c.deviceDelivered.filter(((e,t,r)=>r.indexOf(e)===t)),c.deviceNotDelivered=c.deviceNotDelivered.filter((e=>e!==n))),l.push(c)})),o.bulkCreateOrReplace(l)}))}))}(a,t,s,o,n,i):Promise.reject(new Error(`updateReceiptRecords: not supported ack type ${e}`))}return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))};var i=n(r(81109)),a=n(r(48926)),s=n(r(69618)),o=r(99234),l=r(7293),c=r(90981),d=r(52489),u=r(64551),p=r(99069),h=(n(r(39546)),r(58021));const{ACK:f,ACK_STRING:_}=s.default,m={[f.RECEIVED]:_.DELIVERY,[f.READ]:_.READ,[f.PLAYED]:_.PLAYED,[f.INACTIVE]:_.INACTIVE},g=[_.PLAYED,_.READ,_.DELIVERY],y=Object.freeze({ELIGIBLE:"ELGIBLE",INELIGIBLE_RECORD_MISSING:"INELIGIBLE_RECORD_MISSING",INELIGIBLE_ALREADY_DELIVERED:"INELIGIBLE_ALREADY_DELIVERED",INELIGIBLE_NOT_MD:"INELIGIBLE_NOT_MD",INELIGIBLE_CHANGED_IDENTITY:"INELIGIBLE_CHANGED_IDENTITY"});t.RetryEligibilityResult=y},86868:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.removeMessagesFromHistory=function(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)){const t=[];return(0,s.initializeWithoutGKs)().then((()=>{if(e.length>0)return(0,l.getTable)().bulkGet(e).then((e=>{e.forEach((e=>{null!=(null==e?void 0:e.rowId)&&t.push(String(e.rowId))}))}))})).then((()=>(0,d.getStorage)().lock(["message","label-association"],(()=>{const t=(0,c.queryAndRemoveLocalLabelAssociation)(e.map((e=>({associationId:e,type:o.LabelAssociationType.Message}))));return Promise.all([(0,l.getTable)().bulkRemove(e),t])})))).then((()=>{t.length>0&&i.default.purge(t)})).then((()=>{})).catch((e=>{throw __LOG__(4,void 0,new Error)`removeMessagesFromHistory: error ${e}`,e}))}return Promise.resolve()};var i=n(r(69048)),a=r(7293),s=r(23356),o=r(82663),l=r(90981),c=r(54598);r(79038);var d=r(99069)},60324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pruneExpiredMessages=function(){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return __LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages started`,(0,s.getTable)().lessThan(["expiredTimestamp"],n.Clock.globalUnixTime(),{shouldDecrypt:!1}).then((e=>(0,i.removeMessagesFromHistory)(e.map((e=>e.id.toString()))).then((()=>(__LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages completed`,e.length)))));return Promise.resolve(0)},t.removeExpiredMessagesFromHistory=function(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,i.removeMessagesFromHistory)(e.map((e=>e.id.toString())));return Promise.resolve()};var n=r(22683),i=r(86868),a=r(7293),s=r(90981)},35588:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgByMsgKey=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){let t;return t=e instanceof c.default?e.toString():e,(0,l.getTable)().get(t).then((e=>e?(0,d.hydrateMessage)(e):null))}return Promise.resolve(null)},t.getMsgsByMsgKey=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,l.getTable)().bulkGet(e).then((e=>e.filter(Boolean).map(d.hydrateMessage)));return Promise.resolve([])},t.msgFindQuery=function(e,t){if(null!=t.label)return Promise.resolve([]);if("before"===e)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e instanceof c.default){const r=e.remote.toString();return(0,l.getTable)().equals(["id"],e.toString()).then((n=>{if(0===n.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new p;const a=n[0],s=(0,d.getInChatMsgId)(a.internalId||""),l=Math.max(0,s-t),c=(0,d.craftInternalId)(r,s);let u=(0,d.craftInternalId)(r,l);const h={lowerInclusive:!0,upperInclusive:!1};return(0,o.receiveReactionsEnabled)()?(u=(0,d.beginningOfChat)(e.remote),(0,d.queryChatVisibleMessageHelper)(u,c,(0,i.default)((0,i.default)({},h),{},{reverse:!0}),t).then((e=>e.reverse().map(d.hydrateMessage)))):(0,d.queryChatMessageHelper)(u,c,h).then((e=>e.map(d.hydrateMessage)))}))}return Promise.resolve([])}(t,t.count);if("after"===e)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e instanceof c.default){const r=e.remote.toString();return(0,l.getTable)().equals(["id"],e.toString()).then((n=>{if(0===n.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new p;const i=n[0],a=(0,d.getInChatMsgId)(i.internalId||""),s=(0,d.craftInternalId)(r,a);let l=(0,d.craftInternalId)(r,a+t);const c={lowerInclusive:!1,upperInclusive:!0};return(0,o.receiveReactionsEnabled)()?(l=(0,d.endOfChat)(e.remote),(0,d.queryChatVisibleMessageHelper)(s,l,c,t).then((e=>e.map(d.hydrateMessage)))):(0,d.queryChatMessageHelper)(s,l,c).then((e=>e.map(d.hydrateMessage)))}))}return Promise.resolve([])}(t,t.count).catch((0,a.filteredCatch)(p,(()=>({status:404}))));if("star"===e){const e=null==t.id?void 0:new c.default(t);return null!=t.chat?function(e,t,r){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.resolve().then((()=>{if(null!=r)return(0,l.getTable)().get(r.toString())})).then((r=>{const n=null==r?[(0,d.endOfChat)(e),1/0]:[r.internalId,r.isStarred],i=[(0,d.beginningOfChat)(e),0];return(0,l.getTable)().between(["internalId","isStarred"],i,n,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:t}).then((e=>e.map(d.hydrateMessage)))}));return Promise.resolve([])}(t.chat,t.count,e):function(e,t){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.resolve().then((()=>{if(null!=t)return(0,l.getTable)().get(t.toString())})).then((t=>{const r=null==t?1/0:t.isStarred;return(0,l.getTable)().between(["isStarred"],0,r,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:e}).then((e=>e.map(d.hydrateMessage)))}));return Promise.resolve([])}(t.count,e)}if("search"===e){const e={};t.remote&&(e.remote=t.remote.toString()),t.count&&t.page>=0&&(e.limit=t.count,e.page=t.page);const{default:n}=r(69048);return n.search(t.searchTerm,e)}if("media"===e){const e=t.remote,r=null==t.id?void 0:new c.default(t);return"document"===t.media?h(e,t.count,t.direction,"isDocMsg",r).then((e=>e.map(d.hydrateMessage))):"url"===t.media?h(e,t.count,t.direction,"hasLink",r).then((e=>e.map(d.hydrateMessage))):Promise.all(["isMediaMsg","isDocMsg","hasLink"].map((n=>h(e,t.count,t.direction,n,r).then((e=>e.map(d.hydrateMessage)))))).then((e=>{let[t,r,n]=e;const i=[t,n,r].flat();return{docCount:r.length,linkCount:n.length,mediaCount:t.length,messages:i}}))}return __LOG__(3)`Message query type ${e} not implemented.`,Promise.reject(new Error(`Message query type ${e} not implemented.`))},t.queryVcard=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,l.getTable)().equals(["vcardWAids"],e.toString()).then((e=>e.map(d.hydrateMessage)));return Promise.resolve()};var i=n(r(81109)),a=r(50796),s=r(7293),o=r(57701),l=r(90981),c=n(r(32219)),d=r(12896);const u=20;class p extends Error{constructor(){super(...arguments),this.name="NoAnchorMessageError"}}function h(e,t,r,n,i){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){return(null==i?Promise.resolve(void 0):(0,l.getTable)().equals(["id"],i.toString())).then((a=>{if(i&&null!=a&&0===a.length)throw __LOG__(3)`Anchor message ${i&&i.toString()} does not exist in message table`,new p;const s=null==a?void 0:a[0];let o,c;return"before"===r?(o=(0,d.beginningOfChat)(e),c=null==s?(0,d.endOfChat)(e):(0,d.craftInternalId)(e.toString(),(0,d.getInChatMsgId)(s.internalId||""))):(o=null==s?(0,d.beginningOfChat)(e):(0,d.craftInternalId)(e.toString(),(0,d.getInChatMsgId)(s.internalId||"")),c=(0,d.endOfChat)(e)),(0,l.getTable)().between(["internalId",n],[o,0],[c,1/0],{lowerInclusive:!1,upperInclusive:!1,limit:t})}))}return Promise.resolve([])}},84886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DuplicateMessageError",{enumerable:!0,get:function(){return n.DuplicateMessageError}}),Object.defineProperty(t,"getMsgByMsgKey",{enumerable:!0,get:function(){return i.getMsgByMsgKey}}),Object.defineProperty(t,"getMsgsByMsgKey",{enumerable:!0,get:function(){return i.getMsgsByMsgKey}}),Object.defineProperty(t,"msgFindQuery",{enumerable:!0,get:function(){return i.msgFindQuery}}),Object.defineProperty(t,"processPaymentMessages",{enumerable:!0,get:function(){return n.processPaymentMessages}}),Object.defineProperty(t,"processRevokeMsgs",{enumerable:!0,get:function(){return n.processRevokeMsgs}}),Object.defineProperty(t,"queryVcard",{enumerable:!0,get:function(){return i.queryVcard}}),Object.defineProperty(t,"removeMessagesFromHistory",{enumerable:!0,get:function(){return a.removeMessagesFromHistory}}),Object.defineProperty(t,"starMessages",{enumerable:!0,get:function(){return n.starMessages}}),Object.defineProperty(t,"storeInitialSyncMessages",{enumerable:!0,get:function(){return n.storeInitialSyncMessages}}),Object.defineProperty(t,"storeMessages",{enumerable:!0,get:function(){return n.storeMessages}}),Object.defineProperty(t,"storeRecentAndFullHistSyncMessages",{enumerable:!0,get:function(){return n.storeRecentAndFullHistSyncMessages}}),Object.defineProperty(t,"unstarMessages",{enumerable:!0,get:function(){return n.unstarMessages}}),Object.defineProperty(t,"updateExistingMessages",{enumerable:!0,get:function(){return n.updateExistingMessages}}),Object.defineProperty(t,"updateMessage",{enumerable:!0,get:function(){return n.updateMessage}});var n=r(90641),i=r(35588),a=r(86868)},30986:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._test=void 0,t.deleteMessagesInMessageRange=function(e,t,r){const{lastMessageTimestamp:n,lastSystemMessageTimestamp:a,messages:s}=t;return(0,p.getStorage)().lock(["message"],function(){var t=(0,i.default)((function*(t){let[i]=t,o=[];const l=[];null!=n&&(l.push(v(e,n,f.MessagePropertyType.IncomingChatMessage,r)),l.push(v(e,n,f.MessagePropertyType.Outgoing,r)));const c=null!=a?a:n;null!=c&&l.push(v(e,c,f.MessagePropertyType.SystemMessage,r)),l.push(function(){return A.apply(this,arguments)}(s,r));const d=yield Promise.all(l);o=o.concat(...d);const u=null==r?void 0:r.skipMessages;return u&&(o=o.filter((e=>!u.has(e)))),yield i.bulkRemove(o),o}));return function(){return t.apply(this,arguments)}}())},t.filterReceivedMessagesInRange=function(){return y.apply(this,arguments)},t.fixMessageRange=function(e){var t,r;const n=e.messages,i={messages:n,lastMessageTimestamp:e.lastMessageTimestamp};if(n.length>_){const{messages:e,newLastMessageTimestamp:t}=E(n,_);null!=t&&(i.lastMessageTimestamp=t),i.messages=e}(0,a.numberOrThrowIfTooLarge)(null!==(t=e.lastSystemMessageTimestamp)&&void 0!==t?t:0)>(0,a.numberOrThrowIfTooLarge)(null!==(r=i.lastMessageTimestamp)&&void 0!==r?r:0)&&(i.lastSystemMessageTimestamp=e.lastSystemMessageTimestamp);return i},t.getAdditionalMessages=function(){return g.apply(this,arguments)},t.getFirstSystemMessageTimestamp=function(e){return(0,d.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,f.MessagePropertyType.SystemMessage),(0,f.endOfMessageRange)(e,f.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!1,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,f.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastMessageTimestamp=function(e){return(0,d.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,f.MessagePropertyType.IncomingChatMessage),(0,f.endOfMessageRange)(e,f.MessagePropertyType.IncomingChatMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,f.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastSystemMessageTimestamp=function(e){return(0,d.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,f.MessagePropertyType.SystemMessage),(0,f.endOfMessageRange)(e,f.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,f.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.timestampComparison=S;var i=n(r(48926)),a=r(8243),s=n(r(45095)),o=r(92844),l=r(22683),c=n(r(69618)),d=r(90981),u=n(r(32219)),p=r(99069),h=r(93650),f=r(12896);const _=1e3,{MSG_TYPE:m}=c.default;function g(){return(g=(0,i.default)((function*(e,t,r){const n=(0,d.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,f.MessagePropertyType.Outgoing,t),(0,f.endOfMessageRange)(e,f.MessagePropertyType.Outgoing),{reverse:!0,shouldDecrypt:!1}),i=(0,d.getTable)().anyOf(["messageRangeIndex"],[(0,f.beginningOfMessageRange)(e,f.MessagePropertyType.IncomingChatMessage,t),(0,f.beginningOfMessageRange)(e,f.MessagePropertyType.Outgoing,t),(0,f.beginningOfMessageRange)(e,f.MessagePropertyType.Outgoing)],{reverse:!0,shouldDecrypt:!1}),a=yield Promise.all([n,i]).then((e=>{let[t,n]=e;return t.concat(n).filter((e=>-1!==e.ack&&!e.isSendFailure&&!e.mdDowngrade)).filter((e=>!((null==r?void 0:r.excludeStarred)&&e.isStarred))).map((e=>{var t;const r=u.default.fromString(e.id),n=null!==(t=(0,f.extractC2STimestampFromMessageRangeIndex)(e.messageRangeIndex))&&void 0!==t?t:void 0;return{key:(0,h.msgKeyToProtobuf)(r),timestamp:n}}))})),{messages:s,newLastMessageTimestamp:o}=E(a,(null==r?void 0:r.limit)||_);return{messages:s,newLastMessageTimestamp:o}}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){if(0===t.length)return t;const r=t.map((e=>(0,h.protobufToMsgKey)((0,s.default)(e.key,"syncActionMessage.key")).toString())),n=yield(0,d.getTable)().bulkGet(r,!1);return t.filter(((e,t)=>null!=n[t]))}))).apply(this,arguments)}function E(e,t){const r=[],n=[];if(e.forEach((e=>{null!=e.timestamp?r.push(e):n.push(e)})),r.length<t)return{messages:e};const i=r.sort(S).slice(0,t),o=i[i.length-1];return{messages:i.concat(n),newLastMessageTimestamp:(0,a.numberOrThrowIfTooLarge)((0,s.default)(o.timestamp,"smallestTimestampMessage.timestamp"))}}function S(e,t){const[r,n]=[e,t].map((e=>(0,a.numberOrThrowIfTooLarge)((0,s.default)(e.timestamp,"syncActionMessage.timestamp"))));return n-r}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n){let i=yield(0,d.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,r),(0,f.beginningOfMessageRange)(e,r,(0,a.numberOrThrowIfTooLarge)(t)),{lowerInclusive:!0,upperInclusive:!0,shouldDecrypt:!1});return r===f.MessagePropertyType.SystemMessage&&!1!==(null==n?void 0:n.skipRecentSystemMessages)&&(i=i.filter((e=>!((0,f.isSecuritySensitiveMessage)(e)&&e.t>l.Clock.globalUnixTime()-o.DAY_SECONDS)))),(null==n?void 0:n.skipStarred)&&(i=i.filter((e=>void 0===e.isStarred))),r===f.MessagePropertyType.SystemMessage&&(i=i.filter((e=>!(e.type===m.E2E_NOTIFICATION&&"encrypt"===e.subtype)))),i.map((e=>e.id))}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t){const r=e.map((e=>(0,h.protobufToMsgKey)((0,s.default)(e.key,"syncActionMessage.key")).toString())),n=yield(0,d.getTable)().bulkGet(r),i=[];return n.forEach((e=>{null!=e&&((null==t?void 0:t.skipStarred)&&null!=e.isStarred||i.push(e.id))})),i}))).apply(this,arguments)}const C={limitAdditionalMessages:E};t._test=C},90641:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PreviousMsgNotPlaceholderError=t.DuplicateMessageError=void 0,t.encryptMultipleMsgs=Q,t.processPaymentMessages=function(){return z.apply(this,arguments)},t.processRevokeMsgs=function(){return $.apply(this,arguments)},t.starMessages=function(e){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND))return(0,b.getTable)().bulkGet(e).then((e=>{const t=e.filter(Boolean).map((e=>({id:e.id,isStarred:e.rowId})));return(0,b.getTable)().bulkCreateOrMerge(t)}));return Promise.resolve()},t.storeEncryptedMessage=Z,t.storeInitialSyncMessages=function(){return W.apply(this,arguments)},t.storeMessageInTransaction=ee,t.storeMessages=function(){return V.apply(this,arguments)},t.storeRecentAndFullHistSyncMessages=function(){return H.apply(this,arguments)},t.unstarMessages=function(e){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND))return(0,b.getTable)().bulkCreateOrMerge(e.map((e=>({id:e,isStarred:void 0}))));return Promise.resolve()},t.updateExistingMessages=function(e,t){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND)){var r;const n=null==t?null===(r=e[0])||void 0===r?void 0:r.id.remote:t;if(n){const t=e.map((e=>ae((0,L.convertToMessageRowType)(e),n.toString(),!!(0,C.findLink)(e.body,!0))));return Promise.resolve((0,b.getTable)().bulkCreateOrMerge(t)).then((()=>{u.default.index()})).catch((e=>{throw __LOG__(3)`Error storing messages`,e}))}}return Promise.resolve()},t.updateMessage=function(e){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND))return(0,R.getStorage)().lock(["message"],function(){var t=(0,a.default)((function*(t){let[r]=t;const n=yield r.get(e.id.toString());if(!n)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, Failed to find previous message row in message table`);if(!function(e){if(null==e?void 0:e.type){if(e.type===h.default.MSG_TYPE.CIPHERTEXT)return!0;if(e.type===h.default.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype)return!0}return!1}(n))throw __LOG__(2,void 0,void 0,void 0,["messaging"])`updateMessage: msgId::${e.id.toString()}, Previous row in message table is not a placeholder`,new Y;null!=n.t&&(e.t=n.t),n.ack>e.ack&&(e.ack=n.ack);const i=ae((0,L.convertToMessageRowType)(e),e.from.toString(),!!(0,C.findLink)(e.body,!0),void 0,void 0,n.pendingReadReceipt);if(i.rowId=n.rowId,i.internalId=n.internalId,null==i.rowId||null==i.internalId)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, missing rowId or internalId`);yield r.createOrReplace(i),(0,P.populatePlaceHolderAction)(n),u.default.index()}));return function(){return t.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(81109)),a=n(r(48926)),s=n(r(2525)),o=r(52230),l=n(r(86128)),c=r(97401),d=r(48285),u=n(r(69048)),p=r(22683),h=n(r(69618)),f=r(15998),_=r(35588),m=r(44936),g=r(99234),y=r(82142),E=r(7293),S=r(57701),v=n(r(52991)),T=r(62415),A=r(10435),C=r(86688),b=r(90981),P=r(63728),M=r(76214),O=n(r(32219)),I=r(54676),w=r(49831),R=r(99069),D=n(r(41809)),N=r(43323),L=r(12896),k=r(78521),G=r(21224),U=n(r(39546)),F=r(58021),x=r(65044);const B=1e9;class K extends Error{constructor(){super(...arguments),this.name="DuplicateMessageError"}}t.DuplicateMessageError=K;class Y extends Error{constructor(){super(...arguments),this.name="PreviousMsgNotPlaceholderError"}}t.PreviousMsgNotPlaceholderError=Y;class j extends Error{constructor(){super(...arguments),this.name="DroppingMsgRowDueToLogout"}}function W(){return(W=(0,a.default)((function*(e){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND)){yield f.DbEncKeyStore.waitForFinalDbMsgEncKey();let t=0;(0,s.default)(e,(e=>{let{msgs:r}=e;return t+=r.length}));const n=new Map,i=new Map,a=Object.keys(e).reduce(((t,r)=>{let i=t.nextRowId,a=B-e[r].msgs.length;const{pendingUnreadIds:s,unreadMentions:o}=re(e[r].chatInfo.unreadCount||0,e[r].msgs);(0,A.isGroupCatchUpEnabled)()&&o.length&&n.set(r,o);const l=[];return e[r].msgs.forEach((e=>{try{i++,a++,e.isMdHistoryMsg=!0;const t=ae((0,L.convertToMessageRowType)(e),(0,F.createWid)(r).toString(),!!(0,C.findLink)(e.body,!0),i,a,s.has(String(e.id)));l.push(t)}catch(e){if(e instanceof j)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`storeInitialSyncMessages failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}})),{nextRowId:i,messages:t.messages.concat(l)}}),{nextRowId:B-t,messages:[]});return a.messages.forEach((e=>{e.type===h.default.MSG_TYPE.GROUPS_V4_INVITE&&(0,T.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:p.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)})})),(0,A.isGroupCatchUpEnabled)()&&n.size&&(n.forEach(((e,t)=>{var n,a;const s=r(69951).ChatCollection.get((0,F.createWid)(t)),o=e.map((e=>{let{id:t,timestamp:r}=e;return new D.default({id:t,timestamp:r})})),l=null==s||null===(n=s.groupMetadata)||void 0===n?void 0:n.unreadMentionMetadata,c=null!==(a=null==l?void 0:l.pendingUnreadMentionCount)&&void 0!==a?a:0;(null==l?void 0:l.pendingUnreadMentionCount)&&(l.pendingUnreadMentionCount=Math.max(c-o.length,0),i.set(t,l.pendingUnreadMentionCount)),null==l||l.addUnreadMentions(o,N.UnreadMessageType.HISTORYC_SYNC_CHUNK)})),(0,d.addUnreadMentionChat)(n,i)),(0,R.getStorage)().lock(["message"],(e=>{let[t]=e;return t.bulkCreate(a.messages).catch((e=>{if(__LOG__(3)`Error storing MD initial sync messages with error ${e}`,e instanceof l.default.BulkError||e instanceof l.default.ConstraintError)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Retrying initial sync bulk add on error`,t.bulkCreateOrMerge(a.messages);throw e}))})).then((()=>{l.default.ignoreTransaction((()=>{(0,m.getTable)().bulkCreateOrReplace(a.messages.map((e=>({id:String(e.rowId)})))).then((()=>{u.default.index()}))}))})).catch((e=>{__LOG__(3)`Error storing MD initial sync messages with error ${e} after retry`}))}return Promise.resolve()}))).apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(E.GK.supportsFeature(E.GK.F.MD_BACKEND)){let a=e;const s=r(69951).ChatCollection,o=new Map,l=new Map;try{a=yield(0,w.applyOrphanRevoke)(e)}catch(e){__LOG__(4,void 0,new Error,void 0,["History Sync"])`applyOrphanRevoke failed with error ${e}`}a.forEach((e=>{if(e.type===h.default.MSG_TYPE.GROUPS_V4_INVITE&&(0,T.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:p.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)}),(0,A.isGroupCatchUpEnabled)()&&(0,I.isImportantMessage)(e)){const a=e.id.remote.toString();let c=0;if(l.has(a)){var t;c=null!==(t=l.get(a))&&void 0!==t?t:0}else{var r,n;const e=s.get(a);c=null!==(r=null==e||null===(n=e.groupMetadata)||void 0===n?void 0:n.unreadMentionMetadata.pendingUnreadMentionCount)&&void 0!==r?r:0,l.set(a,c)}if(c>0){l.set(a,c-1);const t={id:e.id.toString(),timestamp:e.t};var i;if(o.has(a))null===(i=o.get(a))||void 0===i||i.push(t);else o.set(a,[t])}}}));return Z(yield Q(a,n),t,i).then((()=>{(0,A.isGroupCatchUpEnabled)()&&o.size>0&&(o.forEach(((e,t)=>{var r,n;const i=s.get(t),a=null!==(r=l.get(t))&&void 0!==r?r:0,c=null==i||null===(n=i.groupMetadata)||void 0===n?void 0:n.unreadMentionMetadata;if(0===(null==c?void 0:c.pendingUnreadMentionCount)||(null==i?void 0:i.hasChatBeenOpened))o.delete(t);else if(c&&c.pendingUnreadMentionCount>0){c.pendingUnreadMentionCount=a;const t=e.map((e=>new D.default({id:e.id.toString(),timestamp:e.timestamp})));c.addUnreadMentions(t,N.UnreadMessageType.HISTORYC_SYNC_CHUNK)}})),o.size>0&&(0,d.addUnreadMentionChat)(o,l))})).catch((()=>{__LOG__(3)`Error storing MD recent or full sync messages`}))}return Promise.resolve()}))).apply(this,arguments)}function V(){return(V=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return E.GK.supportsFeature(E.GK.F.MD_BACKEND)?(yield f.DbEncKeyStore.waitForFinalDbMsgEncKey(),Promise.resolve(ee(e,t,r)).then((()=>{u.default.index()})).catch((e=>{throw e instanceof l.default.BulkError||e instanceof l.default.ConstraintError?new K:(__LOG__(3)`Error storing messages`,e)}))):Promise.resolve()}))).apply(this,arguments)}function $(){return($=(0,a.default)((function*(e){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND)){const t=[],r=[],n=[],i=new Map,s=e.filter((e=>{const{revokeMsgKey:t,newMsgKey:r,subtype:n}=e;let i=!0;return"admin_revoke"===n?(0,S.adminRevokeReceiverEnabled)()?U.default.isGroup(t.remote)?U.default.equals(t.remote,r.remote)||(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke came for the different group than the original message was in`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke was sent to a non-group chat`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: admin revoke feature is disabled, ${String(t)} has not been revoked`):(i=U.default.equals(t.remote,r.remote)&&U.default.equals(t.participant,r.participant)&&t.fromMe===r.fromMe,i||__LOG__(2)`processRevokeMsgs: invalid revoke request ${String(t)}, ${String(r)}`),i}));s.forEach((e=>{r.push(e.revokeMsgKey.toString()),n.push(e.newMsgKey.toString())}));const o=s.length;yield(0,R.getStorage)().lock(["message","orphan-revoke"],function(){var e=(0,a.default)((function*(e){let[a,l]=e;const c=yield(0,M.getMessageTable)().bulkGet(r.concat(n),!1),d=c.slice(0,o),u=c.slice(o),p=[],f=[];d.forEach(((e,a)=>{var o,l;if(null==e)return __LOG__(2)`processRevokeMsg: orphan revoke message key ${d[a]}`,void f.push({msgKey:r[a],sender:s[a].sender,timestamp:s[a].timestamp,subtype:null!==(l=s[a].subtype)&&void 0!==l?l:"sender_revoke"});if(p.push({id:n[a],to:e.to,author:e.author,type:h.default.MSG_TYPE.REVOKED,subtype:"admin_revoke"===s[a].subtype?"admin":"sender",revokeSender:s[a].sender,protocolMessageKey:r[a],protocolMessageRowId:null===(o=u[a])||void 0===o?void 0:o.rowId,from:e.from,t:e.t,rowId:e.rowId,internalId:e.internalId,messageRangeIndex:e.messageRangeIndex}),t.push(String(e.rowId)),(0,A.isGroupCatchUpEnabled)()&&(0,I.isImportantMessage)(e)){const t=O.default.fromString(e.id).remote.toString();if(i.has(t)){var c;const r=null!==(c=i.get(t))&&void 0!==c?c:[];i.set(t,[...r,e.id])}else i.set(t,[e.id])}}));const _=[(0,M.getMessageTable)().bulkRemove(r),(0,M.getMessageTable)().bulkCreateOrReplace(p)];f.length>0&&_.push((0,M.getOrphanRevokeTable)().bulkCreateOrReplace(f)),yield Promise.all(_)}));return function(){return e.apply(this,arguments)}}()),u.default.purge(t),(0,A.isGroupCatchUpEnabled)()&&(0,d.removeUnreadMentionChat)(i)}return Promise.resolve()}))).apply(this,arguments)}function z(){return(z=(0,a.default)((function*(e){if(E.GK.supportsFeature(E.GK.F.MD_BACKEND)){const t=[],r=[],n=e.map((e=>e.paymentRequestMessageKey?e.paymentRequestMessageKey.toString():"")).filter((e=>""!==e)),i=e.filter((e=>"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype)).map((e=>e.id.toString()));return(0,R.getStorage)().lock(["message"],function(){var s=(0,a.default)((function*(a){let[s]=a;const o=yield(0,_.getMsgsByMsgKey)(n.concat(i)),l=new Map;return o.forEach((e=>{null!=e&&l.set(e.id.toString(),e)})),e.forEach((e=>{var n;const i=null===(n=e.paymentRequestMessageKey)||void 0===n?void 0:n.toString(),a=l.get(i||"");if(a)if("send"===e.subtype&&null!=e.paymentTxnStatus)t.push({id:i,paymentTxnStatus:e.paymentTxnStatus});else{const r=a.from.isGroup()?a.author:a.from,n=a.paymentMessageReceiverJid.equals((0,g.getMeUser)())?r:a.paymentMessageReceiverJid;"payment_action_request_declined"===e.subtype?t.push({id:i,paymentStatus:G.PaymentInfoStatus.REJECTED,paymentTxnStatus:G.PaymentInfoTxnStatus.COLLECT_REJECTED}):"payment_transaction_request_cancelled"===e.subtype&&t.push({id:i,paymentStatus:G.PaymentInfoStatus.CANCELLED,paymentTxnStatus:G.PaymentInfoTxnStatus.COLLECT_CANCELED}),t.push({id:e.id.toString(),type:h.default.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[n,a.paymentCurrency,String(a.paymentAmount1000)]})}else l.get(e.id.toString())&&!e.isMdHistoryMsg&&r.push(e.id.toString())})),yield(0,M.getMessageTable)().bulkRemove(r),yield(0,M.getMessageTable)().bulkCreateOrMerge(t),t}));return function(){return s.apply(this,arguments)}}())}return null}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t){if(v.default.isLogoutInProgress)return Promise.reject(new j);null!=t&&(yield(0,c.asyncSleepAfterGivenLoopIteration)(t,35,100));const r=(0,M.getMessageTable)(),n=se(e),a=(0,L.convertToMessageRowType)(e),s=yield r.preflightEncryptSingleRecord((0,i.default)({},a));return[(0,i.default)((0,i.default)((0,i.default)({},a),s),{},{vcardWAids:n}),!!(0,C.findLink)(e.body,!0)]}))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,a.default)((function*(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(yield f.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield new Promise((e=>setTimeout(e,0))),r){t=[];for(let r=0;r<e.length;r++)try{const n=e[r],i=yield q(n,r);t.push(i)}catch(e){if(e instanceof j)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`processAndEncryptSingleMsgRow with throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}}else t=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return yield q(e).catch((e=>{if(e instanceof j)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`processAndEncryptSingleMsgRow without throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`})).finally((()=>{}))}));return function(){return e.apply(this,arguments)}}())),t=t.filter(Boolean);return t}))).apply(this,arguments)}function Z(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,R.getStorage)().lock(["message"],function(){var n=(0,a.default)((function*(n){let[i]=n;const a=yield i.all({reverse:!r,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?B:e[0])),s={};yield Promise.all(t.map((e=>{const t=(0,F.createWid)(e),n=(0,L.beginningOfChat)(t),a=(0,L.endOfChat)(t);return i.between(["internalId"],n,a,{limit:1,reverse:!r,returnKeyType:"keys"}).then((e=>s[t.toString()]=0===e.length?B:(0,L.getInChatMsgId)(e[0])))})));const o=r?-1:1,c=e.map(((e,t)=>{let[n,i]=e;r&&(n.isMdHistoryMsg=!0);const l=O.default.fromString(n.id),c=l.remote.toString(),d=s[c]+1*o;s[c]=d;const u=!r&&te(l,n);return ae(n,c,i,a+o*(t+1),d,u)}));return i.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(c).catch((e=>{if(r&&e instanceof l.default.BulkError)return __LOG__(4,void 0,new Error)`[storeEncryptedMessage] BulkError in bulkCreate, retrying with bulk create or replace`,i.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(c);throw e})).then((()=>c))}));return function(){return n.apply(this,arguments)}}()).then((e=>{l.default.ignoreTransaction((()=>{(0,m.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)})))).then((()=>{u.default.index()}))}))}))}function ee(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=null==t?e[0].id.remote:t,i=(0,L.beginningOfChat)(n),s=(0,L.endOfChat)(n);return(0,R.getStorage)().lock(["chat","message"],function(){var t=(0,a.default)((function*(t){let[a,o]=t;const l=yield a.get(n.toString());if(!n.isStatusV3()&&(null!=l||(0,L.shouldCreateChatWithMsgs)(e))){const t=yield ne(l,e,n);yield a.createOrMerge(n.toString(),t)}const c=o.all({reverse:!r,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?B:e[0])),d=o.between(["internalId"],i,s,{limit:1,reverse:!r,returnKeyType:"keys"}).then((e=>0===e.length?B:(0,L.getInChatMsgId)(e[0]))),[u,p]=yield Promise.all([c,d]),h=r?u-e.length:u+1,f=r?p-e.length:p+1,_=e.map(((e,t)=>{const i=(0,L.convertToMessageRowType)(e),a=!r&&te(e.id,e);return ae(i,n.toString(),!!(0,C.findLink)(e.body,!0),h+t,f+t,a)}));return o.bulkCreate(_).then((()=>_))}));return function(){return t.apply(this,arguments)}}()).then((e=>{l.default.ignoreTransaction((()=>{(0,m.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)}))))}))}))}function te(e,t){if(e.fromMe||e.remote.isStatusV3())return!1;const r=(0,I.eventTypeFromMsgType)(t);return"a"===r||"d"===r}function re(e,t){let r=e;const n=new Set,i=[];for(let e=t.length-1;e>=0&&!(r<=0);e--){const a=t[e];if(te(a.id,a)&&(r--,n.add(String(a.id)),(0,A.isGroupCatchUpEnabled)()&&(0,I.isImportantMessage)(a))){const e={id:String(a.id),timestamp:a.t};i.push(e)}}return{pendingUnreadIds:n,unreadMentions:i}}function ne(){return ie.apply(this,arguments)}function ie(){return(ie=(0,a.default)((function*(e,t,r){var n;let i,a=Math.max(0,e?e.unreadCount:0);const s=null!==(n=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==n?n:[];return t.forEach((e=>{const t=(0,I.eventTypeFromMsgType)(e);if("i"!==t&&(e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),"a"!==t&&"d"!==t||e.id.fromMe||(a+=1),(0,A.isGroupCatchUpEnabled)())){if(te(e.id,e)&&(0,I.isImportantMessage)(e)){const t={id:e.id.toString(),timestamp:e.t};s.push(t)}}})),e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),{id:r.toString(),unreadCount:a,t:i,unreadMentionsOfMe:s}}))).apply(this,arguments)}function ae(e,t,r,n,a,s){const l=[h.default.MSG_TYPE.IMAGE,h.default.MSG_TYPE.VIDEO,h.default.MSG_TYPE.AUDIO].includes(e.type),c=(0,i.default)((0,i.default)({},e),{},{vcardWAids:e.vcardWAids||se(e),id:e.id.toString(),isStarred:e.star?n:void 0,hasLink:"chat"===e.type&&r?n:void 0,isMediaMsg:l?n:void 0,isDocMsg:e.type===h.default.MSG_TYPE.DOCUMENT?n:void 0,expiredTimestamp:oe(e)});null!=n&&(c.rowId=n),null!=a&&(c.internalId=(0,L.craftInternalId)(t,a)),s&&t!==o.STATUS_JID&&(c.pendingReadReceipt=1);let d=e.c2sTimestamp;var u;e.id.fromMe&&!x.Socket.hasSynced?d=null!==(u=e.c2sTimestamp)&&void 0!==u?u:e.t:d=e.t;try{c.messageRangeIndex=(0,L.craftMessageRangeIndex)(t,!O.default.fromString(e.id).fromMe,h.default.SYSTEM_MESSAGE_TYPES.includes(e.type),d)}catch(e){__LOG__(4,void 0,new Error)`[process-msg] craftMessageRangeIndex failed with error ${e}`}return c}function se(e){let t=[];if("vcard"===e.type)t=[e.body];else{if("multi_vcard"!==e.type)return;t=e.vcardList.map((e=>e.vcard))}return t.filter(Boolean).reduce(((e,t)=>{const r=(0,k.vcardWids)((0,k.parseVcard)(t));return e.concat(r.map((e=>e.toString())))}),[])}function oe(e){const{ephemeralDuration:t,ephemeralStartTimestamp:r,t:n,subtype:i,id:{fromMe:a}}=e,s=(0,y.getEphemeralExpirationTimestamp)(t,r,n,i,a);return null!=s?s:void 0}},13946:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundsForChat=function(){return c.apply(this,arguments)},t.queryAndRemoveMessageHistory=function(){return u.apply(this,arguments)},t.queryAndRemoveMessagesInMessageRange=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=n(r(69048)),s=r(90981),o=r(30986),l=r(12896);function c(){return(c=(0,i.default)((function*(e){const t=(0,l.beginningOfChat)(e),r=(0,l.endOfChat)(e),n=yield(0,s.getTable)().between(["internalId"],t,r,{lowerInclusive:!1,upperInclusive:!1,limit:1});if(0===n.length)return null;const i=n[0].rowId,a=yield(0,s.getTable)().between(["internalId"],t,r,{lowerInclusive:!1,upperInclusive:!1,limit:1,reverse:!0});if(0===a.length)return null;const o=a[0].rowId,c=a[0].t;return null==i||null==o?null:{startRowId:i,endRowId:o,tsOfLastMessage:c}}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t,r){const n=yield(0,o.deleteMessagesInMessageRange)(e,t,r);return a.default.purge(n),n}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){const t=(0,l.beginningOfChat)(e),r=(0,l.endOfChat)(e),n=yield(0,s.getTable)().between(["internalId"],t,r,{lowerInclusive:!1,upperInclusive:!1,returnKeyType:"primary_key"});yield(0,s.getTable)().bulkRemove(n)}))).apply(this,arguments)}},12896:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePropertyType=t.MSG_OPAQUE_DATA_KEYS=void 0,t.beginningOfChat=function(e){return`${e.toString()}_/`},t.beginningOfMessageRange=function(e,t,r){const n=null!=r?b(r):"";return`${e.toString()}_${t}_${n}`},t.convertToMessageRowType=function(e){var t;let r=(0,s.default)({},e);e.quotedMsg&&(r.quotedMsg=(0,s.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(r.quotedMsg.paymentNoteMsg=(0,s.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(r.paymentNoteMsg=(0,s.default)({},e.paymentNoteMsg));r.id=e.id.toString(),e.from&&(r.from=e.from.toString());e.protocolMessageKey&&(r.protocolMessageKey=e.protocolMessageKey.toString());e.paymentRequestMessageKey&&(r.paymentRequestMessageKey=e.paymentRequestMessageKey.toString());return delete r.notifyName,delete r.local,delete r.isNewMsg,delete r.clearMedia,delete r.multicast,delete r.urlNumber,delete r.urlText,delete r.linkPreview,delete r.star,delete r.forwardedFromWeb,r=function(e){var t,r,n;const i={currentMsg:{},quotedMsg:{}};if(null===(t=e.paymentNoteMsg)||void 0===t?void 0:t.body){var a;i.currentMsg.paymentNoteMsgBody=e.paymentNoteMsg.body,null===(a=e.paymentNoteMsg)||void 0===a||delete a.body}(null===(r=e.quotedMsg)||void 0===r||null===(n=r.paymentNoteMsg)||void 0===n?void 0:n.body)&&(i.quotedMsg.paymentNoteMsgBody=e.quotedMsg.paymentNoteMsg.body,delete e.quotedMsg.paymentNoteMsg.body);A.forEach((t=>{i.currentMsg[t]=e[t],delete e[t]})),e.quotedMsg&&A.forEach((t=>{i.quotedMsg[t]=e.quotedMsg[t],delete e.quotedMsg[t]}));const s=(0,l.encodeProtobuf)(_.MsgRowOpaqueDataSpec,i);return e.msgRowOpaqueData=s.readBuffer(),e}(r),r},t.craftInternalId=function(e,t){const r=b(t);return`${e}_${r}_m`},t.craftMessageRangeIndex=function(e,t,r,n){let i;i=r?C.SystemMessage:t?C.IncomingChatMessage:C.Outgoing;return`${e}_${i}_${null!=n?b(n):""}`},t.endOfChat=function(e){return`${e.toString()}_g`},t.endOfMessageRange=function(e,t){return`${e.toString()}_${t}_g`},t.extractC2STimestampFromMessageRangeIndex=function(e){if(e){const t=e.split("_")[2];return t?P(t):null}return null},t.getInChatMsgId=function(e){return P(e.split("_")[1])},t.getKeyMsgsFromChatHistory=function(e,t){if(p.GK.supportsFeature(p.GK.F.MD_BACKEND)){performance.now();const n=(0,c.getABPropConfigValue)("web_init_chat_max_unread_message_count");let i,a,s,o,l=e.unreadCount,u=0;const p=[],f=r=>(u++,r.type!==d.default.MSG_TYPE.PROTOCOL&&(r.type!==d.default.MSG_TYPE.REACTION&&((0,h.receiveReactionsEnabled)()&&w(r)?0!==n&&p.length>=n?(o||(o=r.id),s||(__LOG__(3)`[init-from-storage] getKeyMsgsFromChatHistory: Exceeded limit ${n} to find a non futureproof reaction message`,s=r),!0):(p.push(r),!1):(o||(o=r.id),s||(s=r),a||[d.default.MSG_TYPE.E2E_NOTIFICATION,d.default.MSG_TYPE.PROTOCOL,d.default.MSG_TYPE.REACTION].includes(r.type)||(a=r),!t&&(null!=a||u>10)||(!(!(0===l||0!==n&&e.unreadCount>=n)||!a)||!!(l>0&&I(r)&&(l-=1,0===l))&&(i=r.id.toString(),!0))))));return(0,m.getTable)().between(["internalId"],`${e.id}_/`,`${e.id}_g`,{reverse:!0},f).then((()=>{if(p.length){(0,r(8765).o0)(p)}return{anchor:i,previewMsg:a||s,lastReceivedKey:o}}))}return Promise.resolve({anchor:void 0,previewMsg:void 0,lastReceivedKey:void 0})},t.hydrateMessage=function(e){var t;let r=(0,s.default)({},e);e.quotedMsg&&(r.quotedMsg=(0,s.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(r.quotedMsg.paymentNoteMsg=(0,s.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(r.paymentNoteMsg=(0,s.default)({},e.paymentNoteMsg));e.paymentBackground&&(r.paymentBackground=(0,s.default)({},e.paymentBackground));const n=y.default.fromString(r.id),i=r.protocolMessageKey?y.default.fromString(r.protocolMessageKey):void 0,a=r.paymentRequestMessageKey?y.default.fromString(r.paymentRequestMessageKey):void 0,l=(0,E.hydrateWids)(r);l.id=n,i&&(l.protocolMessageKey=i);a&&(l.paymentRequestMessageKey=a);return r.star=void 0!==r.isStarred,r.isMdHistoryMsg=r.rowId<T,delete r.internalId,delete r.isStarred,delete r.count,delete r.hasLink,delete r.isMediaMsg,delete r.isDocMsg,delete r.expiredTimestamp,delete r.pendingReadReceipt,r=function(e){const t=(0,o.decodeProtobuf)(_.MsgRowOpaqueDataSpec,e.msgRowOpaqueData);if(t.currentMsg){var r;if(t.currentMsg.paymentNoteMsgBody&&e.paymentNoteMsg)e.paymentNoteMsg.body=null===(r=t.currentMsg)||void 0===r?void 0:r.paymentNoteMsgBody;A.forEach((r=>{var n;e[r]=null===(n=t.currentMsg)||void 0===n?void 0:n[r]}))}e.quotedMsg&&t.quotedMsg&&(t.quotedMsg.paymentNoteMsgBody&&(e.quotedMsg.paymentNoteMsg.body=t.quotedMsg.paymentNoteMsgBody),A.forEach((r=>{var n;e.quotedMsg[r]=null===(n=t.quotedMsg)||void 0===n?void 0:n[r]})));return e}(r),r=function(e){I(e)&&e.id.fromMe&&null!=e.ack&&e.ack===d.default.ACK.CLOCK&&(e.isSendFailure=!0);return e}(r),r},t.isSecuritySensitiveMessage=function(e){var t;const r=new Map([[d.default.MSG_TYPE.GP2,["remove","add","ephemeral","invite","leave"]],[d.default.MSG_TYPE.E2E_NOTIFICATION,["encrypt","encrypt_now","e2e_identity_unavailable","identity","device"]],[d.default.MSG_TYPE.NOTIFICATION_TEMPLATE,["change_number","verified_initial_unknown","verified_initial_low","verified_initial_high","verified_transition_any_to_none","verified_transition_any_to_high","verified_transition_high_to_low","verified_transition_high_to_unknown","verified_transition_unknown_to_low","verified_transition_low_to_unknown","verified_transition_none_to_low","verified_transition_none_to_unknown","payment_transaction_status_update_failed","payment_transaction_status_update_refunded","payment_transaction_status_update_refund_failed","payment_transaction_status_receiver_pending_setup","payment_transaction_status_receiver_success_after_hiccup","payment_transaction_request_cancelled","payment_action_account_setup_reminder","payment_action_send_payment_reminder","payment_action_send_payment_invitation","payment_action_request_declined","payment_action_request_expired"]]]);return(null===(t=r.get(e.type))||void 0===t?void 0:t.includes(e.subtype))||!1},t.isUnreadTypeMsg=I,t.queryChatMessageHelper=function(){return M.apply(this,arguments)},t.queryChatVisibleMessageHelper=function(){return O.apply(this,arguments)},t.shouldCreateChatWithMsgs=function(e){return e.some((e=>e.type!==d.default.MSG_TYPE.NOTIFICATION_TEMPLATE))};var i=n(r(6479)),a=n(r(48926)),s=n(r(81109)),o=r(84902),l=r(60980),c=r(86945),d=n(r(69618)),u=r(99234),p=r(7293),h=r(57701),f=r(10435),_=r(60946),m=r(90981),g=r(52489),y=n(r(32219)),E=r(64448),S=r(58021);const v=["limit"],T=1e9,A=["body","caption","clientUrl","loc","lng","lat","paymentAmount1000","canonicalUrl","matchedText","title","description","futureproofBuffer"];t.MSG_OPAQUE_DATA_KEYS=A;const C=r(54302)({IncomingChatMessage:"1",Outgoing:"2",SystemMessage:"3"});function b(e){const t=e.toString(16);return(t.length-1).toString(16)+t}function P(e){return parseInt(e.substring(1),16)}function M(){return(M=(0,a.default)((function*(e,t,r){if(p.GK.supportsFeature(p.GK.F.MD_BACKEND)){const n=D(yield(0,m.getTable)().between(["internalId"],e,t,r));return yield N(n),n}return Promise.resolve([])}))).apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e,t,n,a){const{limit:s}=n,o=(0,i.default)(n,v);if(p.GK.supportsFeature(p.GK.F.MD_BACKEND)){const n=[];let i=0;const s=e=>i===a||!!R(e)&&((0,h.receiveReactionsEnabled)()&&w(e)||i++,!1),l=(yield(0,m.getTable)().between(["internalId"],e,t,o,s)).filter((e=>(0,h.receiveReactionsEnabled)()&&w(e)?(n.push(e),!1):!!R(e)));if(n.length){(0,r(8765).o0)(n)}return yield N(l),l}return Promise.resolve([])}))).apply(this,arguments)}function I(e){if(e.type===d.default.MSG_TYPE.UNKNOWN&&"reaction"===e.subtype)return!1;const t=[d.default.MSG_TYPE.CHAT,d.default.MSG_TYPE.IMAGE,d.default.MSG_TYPE.VIDEO,d.default.MSG_TYPE.AUDIO,d.default.MSG_TYPE.PTT,d.default.MSG_TYPE.DOCUMENT,d.default.MSG_TYPE.VCARD,d.default.MSG_TYPE.LOCATION,d.default.MSG_TYPE.CIPHERTEXT,d.default.MSG_TYPE.OVERSIZED,d.default.MSG_TYPE.MULTI_VCARD,d.default.MSG_TYPE.STICKER,d.default.MSG_TYPE.PRODUCT,d.default.MSG_TYPE.GROUPS_V4_INVITE];return(0,f.isNoDeleteMessageTimeLimitEnabled)()||t.push(d.default.MSG_TYPE.REVOKED),t.includes(e.type)}function w(e){return e.type===d.default.MSG_TYPE.UNKNOWN&&e.subtype===d.default.MSG_TYPE.REACTION}function R(e){return e.type!==d.default.MSG_TYPE.REACTION&&e.type!==d.default.MSG_TYPE.DEBUG}function D(e){return e.filter((e=>R(e)))}function N(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e){const t=k(e);if(0===t.length)return;const r=yield(0,g.getTable)().anyOf(["msgKey"],t.map((e=>e.id))),n=new Map,i=[];r.forEach((e=>{const t=(0,S.createWid)(e.receiverUserJid);if((0,u.getMeUser)().equals(t))return;const r=n.get(e.msgKey)||{played:0,read:0,delivery:0};null!=e.played?r.played++:null!=e.read?r.read++:null!=e.delivery&&r.delivery++,n.set(e.msgKey,r)})),t.forEach((e=>{const{ack:t,id:r}=e,a=n.get(r);if(!a)return;let s=null,o=e.count||1;0==(o-=a.played)?s=d.default.ACK.PLAYED:0==(o-=a.read)?s=d.default.ACK.READ:0==(o-=a.delivery)&&(s=d.default.ACK.RECEIVED),null!=s&&s>t&&(e.ack=s,i.push({id:r,ack:s})),i.length>0&&(__LOG__(2,void 0,void 0,void 0,["message-store"])`maybeUpdateMsgAck: storing ack updates ${JSON.stringify(i)}`,(0,m.getTable)().bulkCreateOrMerge(i))}))}))).apply(this,arguments)}function k(e){return e.filter((e=>{if(!I(e))return!1;if(e.type===d.default.MSG_TYPE.CIPHERTEXT||e.type===d.default.MSG_TYPE.UNKNOWN||e.ack<=d.default.ACK.CLOCK)return!1;const t=y.default.fromString(e.id);if(!t.fromMe)return!1;if(t.remote.isGroup()&&(null!=e.rowId&&e.rowId<T||null==e.count))return __LOG__(2,void 0,void 0,void 0,["message-store"])`getMsgMayNeedAckUpdate: skip update for history group message ${e.id}`,!1;if(e.type===d.default.MSG_TYPE.PTT){if(e.ack===d.default.ACK.PLAYED)return!1}else if(e.ack===d.default.ACK.READ)return!1;return!0}))}t.MessagePropertyType=C},40221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateOrphanReceipt=function(e,t,r){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))return(0,a.getStorage)().lock(["orphan-receipt"],(n=>{let[i]=n;return i.bulkGet(r).then((n=>{const a=r.reduce(((r,i,a)=>{let s=n[a];s||(s={msgKey:i});const o=s[e];return(null==o||o>t)&&(s[e]=t,r.push(s)),r}),[]);return i.bulkCreateOrReplace(a)}))}));return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))},t.getOrphanReceipt=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))return(0,i.getTable)().get(e);return Promise.reject(new Error("getOrphanReceipt: not supported for non MD"))},t.removeOrphanReceipt=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))return(0,i.getTable)().remove(e);return Promise.reject(new Error("removeOrphanReceipt: not supported for non MD"))};var n=r(7293),i=r(56161),a=r(99069)},49831:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyOrphanRevoke=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=n(r(69618)),s=r(7293),o=r(88851),l=n(r(39546)),c=r(58021);function d(){return(d=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const t=yield(0,o.getTable)().bulkGet(e.map((e=>String(e.id)))),r=[],n=[];return t.forEach(((t,i)=>{const s=e[i];if(null==t)n.push(s);else{var o;if(__LOG__(2)`applyOrphanRevoke: find orphan revoke for message ${s.id.toString()}`,!l.default.isStatusV3(s.id.remote))n.push({id:s.id,to:s.to,author:s.author,revokeSender:(0,c.createWidFromWidLike)(null!==(o=t.sender)&&void 0!==o?o:s.sender),type:a.default.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",protocolMessageKey:s.id,from:s.from,t:s.t,broadcast:s.broadcast});r.push(t.msgKey)}})),(0,o.getTable)().bulkRemove(r),n}return Promise.reject(new Error("applyOrphanRevoke: called in non-md mode"))}))).apply(this,arguments)}},43201:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PARTICIPANT_OPERATION=t.GroupUnSyncedError=void 0,t.getGroupSenderKeyList=function(e){let t;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const n=e.toString();if(t=(0,l.getTable)().get(n).then((t=>{const n=[],i=[];if(!t)return{skDistribList:n,skList:i,rotateKey:!1};const{senderKey:a,rotateKey:s}=t;return Array.from(a.keys()).forEach((e=>{a.get(e)?i.push((0,d.createWid)(e)):n.push((0,d.createWid)(e))})),function(e,t){const n=r(63928).default.get(e);null!=n&&(n.cachedDeviceCount=t,n.cachedDeviceSizeBucket=(0,o.default)(t))}(e,n.length+i.length),s?{skDistribList:n.concat(i),skList:[],rotateKey:s}:{skDistribList:n,skList:i,rotateKey:s}})),!t)return Promise.reject(new Error("getGroupSenderKeyList: not supported"))}else t=Promise.reject(new Error("getGroupSenderKeyList: not supported without model storage and md backend"));return t},t.markForgetSenderKey=function(e,t){let r;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const n=e.toString();if(r=(0,c.getStorage)().lock(["participant"],(e=>{let[r]=e;return r.get(n).then((e=>{if(e)return r.createOrReplace(f(e,t,!1));__LOG__(2)`markForgetSenderKey: group participant info missing for group ${n}`}))})),!r)return Promise.reject(new Error("markForgetSenderKey: not supported"))}else r=Promise.reject(new Error("markForgetSenderKey: not supported without model storage and md backend"));return r},t.markHasSenderKey=function(e,t){let r;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const n=e.toString();if(r=(0,c.getStorage)().lock(["participant"],(e=>{let[r]=e;return r.get(n).then((e=>{if(e)return r.createOrReplace(f(e,t,!0));__LOG__(2)`markHasSenderKey: group participant info missing for group ${n}`}))})),!r)return Promise.reject(new Error("markHasSenderKey: not supported"))}else r=Promise.reject(new Error("markHasSenderKey: not supported without model storage and md backend"));return r},t.updateParticipants=function(e,t){let r;if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const{participants:n,version:s,prevVersion:o}=t,l=e.toString();if(r=(0,c.getStorage)().lock(["participant"],function(){var e=(0,i.default)((function*(e){let[r]=e;const i=yield r.get(l);if(!i)throw new u(`updateParticipants: group participant info missing for group ${l}, action ${t.action}`);if(i.version&&(null==o||o!==i.version))throw new u(`updateParticipants: prevVersion info missing for group ${l}, action ${t.action}`);switch(t.action){case p.ADD:return r.createOrReplace(function(e,t,r,n){const i=new Map(e.senderKey);return r.forEach((e=>{if(e.equals((0,a.assertGetMe)()))return;const t=String(e);i.set(t,!1)})),{groupId:e.groupId,senderKey:i,participants:e.participants.concat(t.map(String)),admins:e.admins,rotateKey:e.rotateKey,version:n,deviceSyncComplete:e.deviceSyncComplete}}(i,n,t.deviceIds,s));case p.REMOVE:return r.createOrReplace(function(e,t,r){const n=new Map(e.senderKey);Array.from(n.keys()).forEach((e=>{const r=(0,d.createWid)(e).user;t.some((e=>e.user===r))?n.delete(e):n.set(e,!1)}));const i=t.map(String);return{groupId:e.groupId,senderKey:n,participants:e.participants.filter((e=>!i.includes(e))),admins:e.admins.filter((e=>!i.includes(e))),rotateKey:!0,version:r,deviceSyncComplete:e.deviceSyncComplete}}(i,n,s));case p.DEMOTE:return r.createOrReplace(h(i,n,s,p.DEMOTE));case p.PROMOTE:return r.createOrReplace(h(i,n,s,p.PROMOTE));default:throw new Error(`updateParticipants: failed with unknown action ${t.action}`)}}));return function(){return e.apply(this,arguments)}}()),!r)return Promise.reject(new Error("addParticipantRecord: not supported"))}else r=Promise.reject(new Error("updateParticipants: not supported without model storage and md backend"));return r};var i=n(r(48926)),a=r(99234),s=r(7293),o=n(r(16786)),l=r(96826),c=r(99069),d=r(58021);class u extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}t.GroupUnSyncedError=u;const p=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote"});function h(e,t,r,n){let i=e.admins;const a=t.map(String);return n===p.DEMOTE?i=e.admins.filter((e=>!a.includes(e))):n===p.PROMOTE&&(i=e.admins.concat(a)),{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,admins:i,rotateKey:e.rotateKey,version:r,deviceSyncComplete:e.deviceSyncComplete}}function f(e,t,r){const n=new Map(e.senderKey);let i=!1;return t.forEach((e=>{if(e.equals((0,a.assertGetMe)()))return;const t=String(e);n.has(t)?n.set(t,r):i=!0})),{groupId:e.groupId,senderKey:n,participants:e.participants,admins:e.admins,rotateKey:i,deviceSyncComplete:e.deviceSyncComplete}}t.PARTICIPANT_OPERATION=p},238:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePeerMessages=function(e){const t=e.map((e=>(0,i.default)((0,i.default)({},e.toJSON()),{},{id:String(e.id),to:String(e.to)})));(0,a.getTable)().bulkCreate(t)};var i=n(r(81109)),a=r(98136)},75861:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.disallowedRowsToLists=o,t.queryDisallowedLists=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(61319);function s(){return(s=(0,i.default)((function*(){try{return o(yield(0,a.getTable)().all())}catch(e){return __LOG__(4,!0,new Error,!0)`privacy_settings_drawer: get all privacy disallowed lists failed`,SEND_LOGS("privacy_settings_drawer: get all privacy disallowed lists failed"),{status:null,groupadd:null,last:null,profile:null}}}))).apply(this,arguments)}function o(e){const t={status:null,groupadd:null,last:null,profile:null};return e.forEach((e=>{switch(e.id){case a.PrivacyDisallowedListType.About:return void(t.status=e);case a.PrivacyDisallowedListType.GroupAdd:return void(t.groupadd=e);case a.PrivacyDisallowedListType.LastSeen:return void(t.last=e);case a.PrivacyDisallowedListType.ProfilePicture:t.profile=e}})),t}},63374:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.changeOrphanStateReactions=function(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,p.getStorage)().lock(["reactions"],function(){var t=(0,a.default)((function*(t){let[r]=t;const n=e.map((e=>[e,1])),i=yield(0,d.getTable)().anyOf(["parentMsgKey","orphan"],n);return i.forEach((e=>{e.orphan=0})),yield r.bulkCreateOrReplace(i),i}));return function(){return t.apply(this,arguments)}}());return Promise.reject(new Error("changeOrphanStateReactions: not supported for non MD"))},t.createOrUpdateReactions=function(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const t=new Map;return e.forEach((e=>{const{parentMsgKey:r,senderUserJid:n}=e;(0,u.isReactionByMe)(n)&&(e.read=!0);const i=`${r},${n}`,a=t.get(i);a?a.timestamp<=e.timestamp&&t.set(i,e):t.set(i,e)})),(0,p.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[r]=e;const n=Array.from(t.values()).map((e=>[e.parentMsgKey,e.senderUserJid]));return(yield r.anyOf(["parentMsgKey","senderUserJid"],n)).forEach((e=>{const r=`${e.parentMsgKey},${e.senderUserJid}`,n=t.get(r);n&&n.timestamp<=e.timestamp&&t.delete(r)})),yield r.bulkCreateOrReplace(Array.from(t.values())),Array.from(t.values())}));return function(){return e.apply(this,arguments)}}())}return Promise.reject(new Error("createOrUpdateReactions: not supported for non MD"))},t.deleteReactionsByParentMessageKey=function(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const t=[];return(0,p.getStorage)().lock(["reactions"],function(){var r=(0,a.default)((function*(r){let[n]=r;return(yield n.equals(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),n.bulkRemove(t)}));return function(){return r.apply(this,arguments)}}())}return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"))},t.getReactions=function(){return h.apply(this,arguments)},t.markReactionRowsAsRead=function(e){return f({reactions:e,read:!0})},t.markReactionsAsReadByMessageKeysInStore=function(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))return(0,p.getStorage)().lock(["reactions"],function(){var t=(0,a.default)((function*(t){let[r]=t;const n=(yield r.anyOf(["msgKey"],e.map((e=>e.toString())))).map((e=>(0,i.default)((0,i.default)({},e),{},{read:!0})));return yield r.bulkCreateOrReplace(n),n}));return function(){return t.apply(this,arguments)}}());return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"))},t.markReactionsAsReadOrOrphan=f;var i=n(r(81109)),a=n(r(48926)),s=n(r(69618)),o=r(70449),l=r(7293),c=n(r(88382)),d=r(72821),u=r(57793),p=r(99069);function h(){return(h=(0,a.default)((function*(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const t=yield(0,d.getTable)().equals(["parentMsgKey"],e),r={reactions:[],reactionByMe:null},n=new Map;t.forEach((e=>{const{reactionText:t,orphan:i}=e;if(t!==s.default.REVOKED_REACTION_TEXT&&1!==i){var a;const i=o.EmojiUtil.getEmojiAggregate(t),s=null!==(a=n.get(i))&&void 0!==a?a:[];n.set(i,[...s,e]);(0,c.default)(e.msgKey).fromMe&&(r.reactionByMe=e)}}));const i=r.reactionByMe?o.EmojiUtil.getEmojiAggregate(r.reactionByMe.reactionText):"";return n.forEach(((e,t)=>{let n=!1;t===i&&(n=!0),r.reactions.push({aggregateEmoji:t,senders:e,hasReactionByMe:n})})),r}return Promise.reject(new Error("getReactions: not supported for non MD"))}))).apply(this,arguments)}function f(e){let{reactions:t,read:r,orphan:n}=e;return 0===t.length?Promise.resolve():l.GK.supportsFeature(l.GK.F.MD_BACKEND)?(0,p.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[a]=e;const s=t.map((e=>[e.parentMsgKey,e.senderUserJid])),o=yield a.anyOf(["parentMsgKey","senderUserJid"],s),l={};r&&(l.read=r),void 0!==n&&(l.orphan=n);const c=o.map((e=>(0,i.default)((0,i.default)({},e),l)));return a.bulkCreateOrReplace(c)}));return function(){return e.apply(this,arguments)}}()):Promise.reject(new Error("markReactionsAsReadOrOrphan: not supported for non MD"))}},6331:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryStatusAllMD=function(){const e=(0,d.createWid)(s.default.STATUS_WID);return o.DbEncKeyStore.waitForFinalDbMsgEncKey().then((()=>(0,c.queryChatMessageHelper)((0,c.beginningOfChat)(e),(0,c.endOfChat)(e),{lowerInclusive:!1,upperInclusive:!1}).then((e=>{const t=[],r=[];e.forEach((e=>{e.author?(0,a.happenedWithin)((0,a.castToUnixTime)(e.t),a.DAY_SECONDS)&&e.type!==s.default.MSG_TYPE.REVOKED?r.push((0,c.hydrateMessage)(e)):t.push(e.id):__LOG__(3)`Author is null for status v3 message`})),(0,l.getTable)().bulkRemove(t);const n=(0,i.default)(r,(e=>e.author.toString())),o=[];for(const e in n){const t=n[e],r=t.filter((e=>e.ack<s.default.ACK.READ)).length,i=t[t.length-1].t;o.push({id:(0,d.createWid)(e),unreadCount:r,totalCount:t.length,t:i,_msgs:t})}return{statuses:o}}))))};var i=n(r(7739)),a=r(92844),s=n(r(69618)),o=r(15998),l=r(90981),c=r(12896),d=r(58021)},60998:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTaskScheduledTime=function(e){return(0,i.getTable)().get(e).then((e=>null==e?void 0:e.time))},t.updateTaskScheduledTime=function(e,t){return(0,n.getStorage)().lock(["tasks-scheduled-time"],(r=>{let[n]=r;return n.createOrReplace({taskName:e,time:t})}))};var n=r(99069),i=r(33850)},64448:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.hydrateWids=function e(t){if(Array.isArray(t))return t.map(((t,r)=>e((0,i.default)(r,t,a.isWidlike,a.createWidFromWidLike))));if(t&&"object"==typeof t){const r=Object.keys(t);for(let n=0;n<r.length;n++){const s=r[n];t[s]=e((0,i.default)(s,t[s],a.isWidlike,a.createWidFromWidLike))}return t}return t};var i=n(r(78144)),a=r(58021)},68708:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedBusinessNameUpdateType=void 0,t.createOrUpdateVerifiedBusinessName=function(){return l.apply(this,arguments)},t.getAllVerifiedNames=function(){let e=Promise.resolve([]);e=a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(0,s.getTable)().all():Promise.reject(new Error("getAllVerifiedNames: not supported without md backend"));return e},t.hasBusinessNameVerificationChanged=function(e,t,r){return a.GK.supportsFeature(a.GK.F.MD_BACKEND)?(0,s.getTable)().get(e.user).then((e=>!e||e.serial!==r||e.level!==t)):Promise.reject(new Error("hasBusinessNameVerificationChanged: not supported without md backend"))};var i=n(r(48926)),a=r(7293),s=r(85808);const o=r(54302).Mirrored(["Replace","Merge"]);function l(){return(l=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Replace;if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND))throw new Error("createOrUpdateVerifiedBusinessName: not supported without md backend");{const r=(0,s.getTable)();t===o.Replace?yield r.createOrReplace(e):yield r.createOrMerge(e.id,e)}}))).apply(this,arguments)}t.VerifiedBusinessNameUpdateType=o},76214:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={initialize:!0};t.initialize=function(){if(!i.GK.supportsFeature(i.GK.F.MD_BACKEND))return Promise.resolve();return(0,a.initializeWithoutGKs)()};var i=r(7293),a=r(23356);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},23356:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){W=null},t.destroy=function(){return(0,F.destroyStorage)().catch((()=>j.resolve(new i.default(F.DATABASE_NAME).delete()))).finally((()=>{W=null}))},Object.defineProperty(t,"getABPropConfigsTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getActiveMessageRangesTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getBlocklistTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getCartTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getChatTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getCollectionVersionTable",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getContactTable",{enumerable:!0,get:function(){return p.getTable}}),Object.defineProperty(t,"getDeviceListTable",{enumerable:!0,get:function(){return h.getTable}}),Object.defineProperty(t,"getDirectConnectionKeysTable",{enumerable:!0,get:function(){return f.getTable}}),Object.defineProperty(t,"getEncryptedMutationsTable",{enumerable:!0,get:function(){return _.getTable}}),Object.defineProperty(t,"getFavoriteStickersTable",{enumerable:!0,get:function(){return m.getTable}}),Object.defineProperty(t,"getFtsIndexingQueueTable",{enumerable:!0,get:function(){return g.getTable}}),Object.defineProperty(t,"getGroupInviteV4Table",{enumerable:!0,get:function(){return y.getTable}}),Object.defineProperty(t,"getGroupMetadataTable",{enumerable:!0,get:function(){return E.getTable}}),Object.defineProperty(t,"getHistorySyncNotificationTable",{enumerable:!0,get:function(){return S.getTable}}),Object.defineProperty(t,"getInactiveReceiptTable",{enumerable:!0,get:function(){return v.getTable}}),Object.defineProperty(t,"getLabelAssociationTable",{enumerable:!0,get:function(){return A.getTable}}),Object.defineProperty(t,"getLabelTable",{enumerable:!0,get:function(){return T.getTable}}),Object.defineProperty(t,"getMessageTable",{enumerable:!0,get:function(){return C.getTable}}),Object.defineProperty(t,"getMissingKeysTable",{enumerable:!0,get:function(){return P.getTable}}),Object.defineProperty(t,"getMsgInfoTable",{enumerable:!0,get:function(){return b.getTable}}),Object.defineProperty(t,"getOrphanPaymentNotificationTable",{enumerable:!0,get:function(){return M.getTable}}),Object.defineProperty(t,"getOrphanReceiptTable",{enumerable:!0,get:function(){return O.getTable}}),Object.defineProperty(t,"getOrphanRevokeTable",{enumerable:!0,get:function(){return I.getTable}}),Object.defineProperty(t,"getParticipantTable",{enumerable:!0,get:function(){return w.getTable}}),Object.defineProperty(t,"getPeerMessageTable",{enumerable:!0,get:function(){return R.getTable}}),Object.defineProperty(t,"getPendingMutationsTable",{enumerable:!0,get:function(){return D.getTable}}),Object.defineProperty(t,"getPrivacyDisallowedListTable",{enumerable:!0,get:function(){return N.getTable}}),Object.defineProperty(t,"getProfilePicThumbTable",{enumerable:!0,get:function(){return L.getTable}}),Object.defineProperty(t,"getQuickReplyTable",{enumerable:!0,get:function(){return k.getTable}}),Object.defineProperty(t,"getReactionsTable",{enumerable:!0,get:function(){return G.getTable}}),Object.defineProperty(t,"getRecentStickersTable",{enumerable:!0,get:function(){return U.getTable}}),Object.defineProperty(t,"getSyncActionsTable",{enumerable:!0,get:function(){return x.getTable}}),Object.defineProperty(t,"getSyncKeysTable",{enumerable:!0,get:function(){return B.getTable}}),Object.defineProperty(t,"getTasksScheduledTimeTable",{enumerable:!0,get:function(){return K.getTable}}),Object.defineProperty(t,"getVerifiedBusinessNameTable",{enumerable:!0,get:function(){return Y.getTable}}),t.initializeWithoutGKs=function(){null==W&&((0,F.createStorage)(),(0,a.addTable)(),(0,K.addTable)(),(0,p.addTable)(),(0,o.addTable)(),(0,L.addTable)(),(0,c.addTable)(),(0,C.addTable)(),(0,b.addTable)(),(0,G.addTable)(),(0,w.addTable)(),(0,O.addTable)(),(0,h.addTable)(),(0,T.addTable)(),(0,A.addTable)(),(0,v.addTable)(),(0,Y.addTable)(),(0,S.addTable)(),(0,_.addTable)(),(0,k.addTable)(),(0,E.addTable)(),(0,B.addTable)(),(0,s.addTable)(),(0,g.addTable)(),(0,l.addTable)(),(0,P.addTable)(),(0,U.addTable)(),(0,m.addTable)(),(0,y.addTable)(),(0,M.addTable)(),(0,R.addTable)(),(0,I.addTable)(),(0,D.addTable)(),(0,u.addTable)(),(0,x.addTable)(),(0,N.addTable)(),(0,f.addTable)(),(0,d.addTable)(),W=(0,F.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize model storage"),e})));return W};var i=n(r(86128)),a=r(32446),s=r(69702),o=r(89426),l=r(44786),c=r(68638),d=r(91314),u=r(94771),p=r(4233),h=r(60996),f=r(68259),_=r(5198),m=r(51722),g=r(44936),y=r(35884),E=r(64632),S=r(15118),v=r(71720),T=r(94337),A=r(82663),C=r(90981),b=r(52489),P=r(47274),M=r(45377),O=r(56161),I=r(88851),w=r(96826),R=r(98136),D=r(87125),N=r(61319),L=r(96189),k=r(73821),G=r(72821),U=r(29953),F=r(99069),x=r(34296),B=r(63776),K=r(33850),Y=r(85808);const j=r(74121).Z;let W},32446:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("abpropConfigs").version((0,o.abpropsConfigCreateTable)(),[new s.default("configCode"),new i.default("configValue"),new i.default("configExpoKey")]).version((0,o.addHasAccessedToAbpropsConfigTable)(),[new i.default("hasAccessed")]).view((e=>({configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})))},t.getTable=function(){return(0,a.getStorage)().table("abpropConfigs")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},69702:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeAction=void 0,t.addTable=function(){(0,o.getStorage)().add("active-message-ranges").version((0,l.activeMessageRangesCreateTable)(),[new s.default(["chatId","action"]),new a.default("chatId"),new i.default("actionValue"),new i.default("remainingMessages")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("active-message-ranges")};var i=n(r(79051)),a=n(r(19570)),s=n(r(54180)),o=r(99069),l=r(406);const c=Object.freeze({Unknown:"unknown",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChatKeepStarredKeepMedia:"clearChat_0_0",ClearChatKeepStarredDeleteMedia:"clearChat_0_1",ClearChatDeleteStarredKeepMedia:"clearChat_1_0",ClearChatDeleteStarredDeleteMedia:"clearChat_1_1",DeleteChatDeleteMedia:"deleteChat_1",DeleteChatKeepMedia:"deleteChat_0"});t.ActiveRangeAction=c},89426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("blocklist").version((0,s.blocklistCreateTable)(),[new a.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,i.getStorage)().table("blocklist")};var i=r(99069),a=n(r(89362)),s=r(406)},44786:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("cart").version((0,o.cartCreateTable)(),[new s.default("id"),new i.default("products"),new i.default("message"),new i.default("total"),new i.default("currency"),new i.default("itemCount")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("cart")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},91314:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add(c).version((0,l.addChatThreadLoggingTable)(),[new s.default(["chatId","startTs"]),new a.default("chatId"),new a.default("startTs"),new i.default("msgsSent"),new i.default("msgsReceived")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table(c)};var i=n(r(79051)),a=n(r(19570)),s=n(r(54180)),o=r(99069),l=r(406);const c="chat-thread-logging-pending-events"},68638:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("chat").version((0,c.chatCreateTable)(),[new l.default("id"),new i.default("t"),new i.default("unreadCount"),new i.default("archive"),new i.default("isReadOnly"),new i.default("isAnnounceGrpRestrict"),new i.default("modifyTag"),new i.default("muteExpiration"),new i.default("name"),new i.default("notSpam"),new i.default("pin"),new i.default("changeNumberOldJid"),new i.default("changeNumberNewJid"),new i.default("ephemeralDuration"),new i.default("ephemeralSettingTimestamp"),new i.default("unreadMsgAnchorId"),new i.default("endOfHistoryTransferType")]).version((0,c.chatAddDisappearingModeInitiator)(),[new i.default("disappearingModeInitiator")]).version((0,c.addUnreadMentionToChatTable)(),[new i.default("unreadMentionsOfMe")]).version((0,c.addUnreadMentionCountToChatTable)(),[new i.default("unreadMentionCount")]).version((0,c.addTcTokenToChatTable)(),[new a.AddEncryptedColumn("tcToken",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER)]).version((0,c.addTcTokenTimestampToChatTable)(),[new i.default("tcTokenTimestamp"),new s.default("tcTokenTimestamp")]).version((0,c.addArchiveAtMentionViewedInDrawer)(),[new i.default("archiveAtMentionViewedInDrawer")]).version((0,c.addTcTokenSenderTimestampToChatTable)(),[new i.default("tcTokenSenderTimestamp")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("chat")};var i=n(r(79051)),a=r(86445),s=n(r(19570)),o=r(99069),l=n(r(89362)),c=r(406)},94771:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("collection-version").version((0,o.collectionVersionCreateTable)(),[new s.default("collection"),new i.default("version"),new i.default("state"),new i.default("finiteFailureStartTime"),new i.default("ltHash")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("collection-version")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},4233:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("contact").version((0,l.contactCreateTable)(),[new o.default("id"),new i.default("name"),new i.default("shortName"),new i.default("pushname"),new i.default("type"),new i.default("verifiedName"),new i.default("isBusiness"),new i.default("isEnterprise"),new i.default("verifiedLevel"),new i.default("statusMute"),new i.default("sectionHeader"),new i.default("isAddressBookContact"),new a.default("isAddressBookContact")]).version((0,l.contactAddIsContactSyncCompleted)(),[new i.default("isContactSyncCompleted"),new a.default("isContactSyncCompleted")]).version((0,l.contactAddDisappearingModeProperties)(),[new i.default("disappearingModeDuration"),new i.default("disappearingModeSettingTimestamp")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("contact")};var i=n(r(79051)),a=n(r(19570)),s=r(99069),o=n(r(89362)),l=r(406)},60996:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("device-list").version((0,o.deviceListCreateTable)(),[new s.default("id"),new i.default("devices"),new i.default("nextVersion"),new i.default("rawId"),new i.default("timestamp"),new i.default("validIndexes"),new i.default("currentIndex")]).version((0,o.deviceListAddDelete)(),[new i.default("deleted")]).version((0,o.deviceListAddV2Fields)(),[new i.default("expectedTs"),new i.default("expectedTsLastDeviceJobTs"),new i.default("expectedTsUpdateTs")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("device-list")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},68259:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("direct-connection-keys").version((0,o.directConnectionKeysCreateTable)(),[new s.default("id"),new i.default("certificateChain"),new i.default("cypher"),new i.default("cypherExpirationTimestamp")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("direct-connection-keys")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},5198:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("encrypted-mutations").version((0,o.encryptedMutationsCreateTable)(),[new a.default("id"),new i.default("collectionName"),new i.default("keyId"),new i.default("indexMac"),new i.default("operation"),new i.default("indexAndValueCipherText")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("encrypted-mutations")};var i=n(r(79051)),a=n(r(81674)),s=r(99069),o=r(406)},51722:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("favorite-stickers").version((0,o.favoriteStickersCreateTable)(),[new s.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("stickerHashWithoutMeta")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("favorite-stickers")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},44936:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("fts-indexing-queue").version((0,s.ftsIndexingQueueCreateTable)(),[new a.default("id")]).view((e=>e))},t.getTable=function(){return(0,i.getStorage)().table("fts-indexing-queue")};var i=r(99069),a=n(r(89362)),s=r(406)},35884:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("group-invite-v4").version((0,l.groupInviteV4CreateTable)(),[new o.default("id"),new i.default("from"),new i.default("to"),new i.default("groupId"),new i.default("expiration"),new i.default("expired"),new a.default(["from","to","groupId"])]).version((0,l.addGroupFromKeyToGroupInviteV4)(),[new a.default(["from","groupId"])]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("group-invite-v4")};var i=n(r(79051)),a=n(r(34654)),s=r(99069),o=n(r(89362)),l=r(406)},64632:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("group-metadata").version((0,o.groupMetadataCreateTable)(),[new s.default("id"),new i.default("subject"),new i.default("subjectTime"),new i.default("creation"),new i.default("owner"),new i.default("desc"),new i.default("descId"),new i.default("descTime"),new i.default("descOwner"),new i.default("restrict"),new i.default("announce"),new i.default("a_v_id"),new i.default("noFrequentlyForwarded"),new i.default("ephemeralDuration"),new i.default("size"),new i.default("support"),new i.default("suspended"),new i.default("notAddedByContact"),new i.default("addedBy"),new i.default("parentGroup"),new i.default("subgroups"),new i.default("isParentGroup"),new i.default("growthLockExpiration"),new i.default("growthLockType")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("group-metadata")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},15118:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("history-sync-notification").version((0,c.historySyncNotificationsCreateTable)(),[new l.default("msgKey"),new i.default("downloadOptions"),new i.default("syncType"),new a.AddEncryptedColumn("chunkEncryptionKey",a.ENCRYPTED_VALUE_TYPE.STRING),new i.default("chunkOrder"),new i.default("processed"),new s.default("syncType"),new s.default("chunkOrder"),new s.default("processed"),new i.default("isReupload"),new i.default("historySyncStepStartedTs"),new i.default("historySyncPayloadSize"),new i.default("reuploadPending")]).version((0,c.encryptHistorySyncDirectPath)(),[new a.AddEncryptedColumn("directPath",a.ENCRYPTED_VALUE_TYPE.STRING)]).version((0,c.encryptHistorySyncFilehash)(),[new a.AddEncryptedColumn("filehash",a.ENCRYPTED_VALUE_TYPE.STRING),new a.AddEncryptedColumn("encFilehash",a.ENCRYPTED_VALUE_TYPE.STRING)]).view((e=>e)).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,o.getStorage)().table("history-sync-notification")};var i=n(r(79051)),a=r(86445),s=n(r(19570)),o=r(99069),l=n(r(89362)),c=r(406)},71720:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("inactive-receipt").version((0,o.inactiveReceiptCreateTable)(),[new s.default("msgId"),new i.default("chatId"),new i.default("participantId")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("inactive-receipt")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},82663:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelAssociationType=void 0,t.addTable=function(){(0,o.getStorage)().add("label-association").version((0,l.labelAssociationCreateTable)(),[new s.default(["labelId","associationId","type"]),new a.default("labelId"),new i.default(["associationId","type"])]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("label-association")};var i=n(r(34654)),a=n(r(19570)),s=n(r(54180)),o=r(99069),l=r(406);const c=r(54302)({Jid:"jid",Message:"message"});t.LabelAssociationType=c},94337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("label").version((0,o.labelCreateTable)(),[new s.default("id"),new i.default("name"),new i.default("colorIndex"),new i.default("predefinedId")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("label")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},52489:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("message-info").version((0,l.messageInfoCreateTable)(),[new s.default(["msgKey","receiverUserJid"]),new i.default("delivery"),new i.default("read"),new i.default("played"),new i.default("deviceDelivered"),new i.default("deviceNotDelivered"),new a.default("msgKey")]).version((0,l.messageInfoAddDeliveryPrivacyMode)(),[new i.default("deliveryPrivacyMode")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("message-info")};var i=n(r(79051)),a=n(r(19570)),s=n(r(54180)),o=r(99069),l=r(406)},90981:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,u.getStorage)().add("message").version((0,h.messageCreateTable)(),[new p.default("id"),new a.default("internalId"),new c.default("internalId"),new a.default("rowId"),new c.default("rowId"),new a.default("type"),new a.default("subtype"),new a.default("t"),new a.default("notifyName"),new a.default("from"),new a.default("to"),new a.default("author"),new a.default("self"),new a.default("ack"),new a.default("invis"),new a.default("isStarred"),new l.default("isStarred"),new a.default("mentionedJidList"),new a.default("count"),new a.default("devicesAdded"),new a.default("devicesRemoved"),new a.default("isThisDeviceAdded"),new a.default("recipients"),new a.default("protocolMessageKey"),new a.default("protocolMessageRowId"),new a.default("templateParams"),new s.default(["internalId","isStarred"]),new a.default("vcardWAids"),new i.default("vcardWAids"),new a.default("hasLink"),new a.default("isMediaMsg"),new a.default("isDocMsg"),new s.default(["internalId","isMediaMsg"]),new s.default(["internalId","isDocMsg"]),new s.default(["internalId","hasLink"]),new a.default("ephemeralStartTimestamp"),new a.default("ephemeralDuration"),new a.default("ephemeralSettingTimestamp"),new a.default("ephemeralOutOfSync"),new a.default("expiredTimestamp"),new l.default("expiredTimestamp"),new a.default("directPath"),new a.default("mimetype"),new a.default("duration"),new a.default("filehash"),new a.default("uploadhash"),new a.default("size"),new a.default("filename"),new a.default("streamingSidecar"),new a.default("mediaKey"),new a.default("mediaKeyTimestamp"),new a.default("pageCount"),new a.default("isGif"),new a.default("gifAttribution"),new a.default("isViewOnce"),new a.default("width"),new a.default("height"),new a.default("scanLengths"),new a.default("scansSidecar"),new a.default("interactiveAnnotations"),new a.default("firstFrameLength"),new a.default("firstFrameSidecar"),new a.default("isAnimated"),new a.default("thumbnail"),new a.default("richPreviewType"),new a.default("doNotPlayInline"),new a.default("broadcast"),new a.default("broadcastParticipants"),new a.default("broadcastId"),new a.default("quotedMsg"),new a.default("quotedStanzaID"),new a.default("quotedRemoteJid"),new a.default("quotedParticipant"),new a.default("footer"),new a.default("hydratedButtons"),new a.default("selectedId"),new a.default("selectedIndex"),new a.default("vcardFormattedName"),new a.default("isVcardOverMmsDocument"),new a.default("businessOwnerJid"),new a.default("productId"),new a.default("currencyCode"),new a.default("priceAmount1000"),new a.default("retailerId"),new a.default("url"),new a.default("productImageCount"),new a.default("paymentCurrency"),new a.default("paymentMessageReceiverJid"),new a.default("paymentTransactionTimestamp"),new a.default("paymentStatus"),new a.default("paymentNoteMsg"),new a.default("paymentRequestMessageKey"),new a.default("paymentExpiryTimestamp"),new a.default("message"),new a.default("orderTitle"),new a.default("itemCount"),new a.default("orderId"),new a.default("surface"),new a.default("status"),new a.default("token"),new a.default("textColor"),new a.default("backgroundColor"),new a.default("font"),new a.default("isForwarded"),new a.default("forwardingScore"),new a.default("ctwaContext"),new a.default("mdDowngrade"),new a.default("messageRangeIndex"),new l.default("messageRangeIndex"),new a.default("vcardList"),new a.default("totalAmount1000"),new a.default("totalCurrencyCode"),new a.default("list"),new a.default("listResponse"),new a.default("isDynamicReplyButtonsMsg"),new a.default("dynamicReplyButtons"),new a.default("selectedButtonId"),new a.default("sellerJid"),new a.default("deprecatedMms3Url"),new a.default("encFilehash"),new o.AddEncryptedColumn("msgRowOpaqueData",o.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new a.default("thumbnailDirectPath"),new a.default("thumbnailSha256"),new a.default("thumbnailEncSha256"),new a.default("thumbnailHeight"),new a.default("thumbnailWidth"),new a.default("revokeSender"),new a.default("pendingReadReceipt"),new s.default(["from","pendingReadReceipt"]),new a.default("inviteGrpType"),new a.default("quotedGroupSubject"),new a.default("quotedParentGroupJid"),new a.default("reactionParentKey"),new a.default("reactionTimestamp"),new a.default("reactionText"),new a.default("lastPlaybackProgress"),new a.default("hasReaction")]).version((0,h.messageAddIsSendFailureProperties)(),[new a.default("isSendFailure")]).version((0,h.messageAddPaymentTxnStatus)(),[new a.default("paymentTxnStatus")]).version((0,h.messageAddProductListPreviewInfo)(),[new a.default("productListItemCount")]).version((0,h.messageAddPrivacyModeFields)(),[new a.default("privacyModeWhenSent"),new a.default("bizPrivacyStatus")]).version((0,h.messageAddProductListPreviewHeaderImage)(),[new a.default("productHeaderImageRejected")]).version((0,h.messageAddDisappearingModeInitiator)(),[new a.default("disappearingModeInitiator")]).version((0,h.messageAddGroupInviteV4)(),[new a.default("inviteGrp"),new a.default("inviteGrpName"),new a.default("comment"),new a.default("inviteCode"),new a.default("inviteCodeExp")]).version((0,h.addSupportForHSMButtons)(),[new a.default("isFromTemplate")]).version((0,h.messageAddPaymentRequestNFMFields)(),[new a.default("nativeFlowButtons"),new a.default("paymentRequestHeader")]).version((0,h.addWaveformToAudioMessages)(),[new a.default("waveform")]).version((0,h.messageRemovePaymentRequestHeaderField)(),[new d.default("paymentRequestHeader")]).version((0,h.messageAddNativeFlowNameField)(),[new a.default("nativeFlowName")]).version((0,h.addStaticURLToImageVideoMessages)(),[new a.default("staticUrl")]).version((0,h.addRequiresDirectConnection)(),[new a.default("requiresDirectConnection")]).version((0,h.messageAddPaymentInviteServiceType)(),[new a.default("paymentInviteServiceType")]).version((0,h.addStatusPSACampaignFields)(),[new a.default("campaignId"),new a.default("campaignDuration")]).version((0,h.messageAddPaymentBackground)(),[new a.default("paymentBackground")]).version((0,h.messageAddInteractiveMessageFields)(),[new a.default("interactiveHeader"),new a.default("interactiveType"),new a.default("interactivePayload")]).version((0,h.messageAddActionLink)(),[new a.default("actionLink")]).version((0,h.messageAddHeaderType)(),[new a.default("headerType")]).version((0,h.messageStatusPSAReadTimestamp)(),[new a.default("statusPSAReadTimestamp")]).view((e=>e)).enablePropFilter(!0).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,u.getStorage)().table("message")};var i=n(r(92061)),a=n(r(79051)),s=n(r(34654)),o=r(86445),l=n(r(19570)),c=n(r(39043)),d=n(r(23263)),u=r(99069),p=n(r(89362)),h=r(406)},47274:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("missing-keys").version((0,o.missingKeysCreateTable)(),[new s.default("keyHex"),new i.default("keyId"),new i.default("timestamp"),new i.default("deviceResponses")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("missing-keys")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},45377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-payment-notification").version((0,o.orphanPaymentNotificationCreateTable)(),[new s.default("msgKey"),new i.default("receiver"),new i.default("currency"),new i.default("amount1000"),new i.default("type"),new i.default("status"),new i.default("ts")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-payment-notification")};var i=n(r(79051)),a=(r(52586),r(99069)),s=n(r(89362)),o=r(406)},56161:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-receipt").version((0,o.orphanReceiptCreateTable)(),[new s.default("msgKey"),new i.default("delivery"),new i.default("read"),new i.default("played")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-receipt")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},88851:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-revoke").version((0,o.orphanRevokeCreateTable)(),[new s.default("msgKey"),new i.default("sender"),new i.default("timestamp"),new i.default("subtype")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-revoke")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},96826:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("participant").version((0,l.participantCreateTable)(),[new o.default("groupId"),new a.default("senderKey"),new a.default("participants"),new a.default("admins"),new a.default("rotateKey"),new a.default("version"),new i.default("participants"),new a.default("deviceSyncComplete")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("participant")};var i=n(r(92061)),a=n(r(79051)),s=r(99069),o=n(r(89362)),l=r(406)},98136:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("peer-message").version((0,o.peerMessageCreateTable)(),[new s.default("id"),new i.default("to"),new i.default("type"),new i.default("subtype"),new i.default("appStateSyncKeyShare"),new i.default("appStateSyncKeyRequest"),new i.default("appStateFatalExceptionNotification")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("peer-message")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},87125:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("pending-mutations").version((0,l.pendingMutationsCreateTable)(),[new s.default("id"),new i.default("collection"),new i.default("index"),new a.default("index"),new i.default("timestamp"),new a.default("collection"),new i.default("version"),new i.default("operation"),new i.default("binarySyncAction")]).version((0,l.addActionToPendingMutations)(),[new i.default("action"),new a.default("action")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("pending-mutations")};var i=n(r(79051)),a=n(r(19570)),s=n(r(81674)),o=r(99069),l=r(406)},61319:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PrivacyDisallowedListType=void 0,t.addTable=function(){(0,a.getStorage)().add("privacy-disallowed-list").version((0,o.privacyDisallowedListCreateTable)(),[new s.default("id"),new i.default("disallowedList")]).version((0,o.privacyDisallowedListAddDhashField)(),[new i.default("dhash")]).view((e=>({id:e.id,disallowedList:e.disallowedList,dhash:e.dhash})))},t.getTable=function(){return(0,a.getStorage)().table("privacy-disallowed-list")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406);const l=r(54302)({About:"status",GroupAdd:"groupadd",LastSeen:"last",ProfilePicture:"profile"});t.PrivacyDisallowedListType=l},96189:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("profile-pic-thumb").version((0,o.profilePicThumbCreateTable)(),[new s.default("id"),new i.default("tag"),new i.default("raw"),new i.default("eurl"),new i.default("previewEurl")]).view((e=>({id:e.id,tag:e.tag,raw:e.raw,eurl:e.eurl,previewEurl:e.previewEurl})))},t.getTable=function(){return(0,a.getStorage)().table("profile-pic-thumb")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},73821:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("quick-reply").version((0,o.quickReplyCreateTable)(),[new s.default("id"),new i.default("shortcut"),new i.default("message"),new i.default("count"),new i.default("keywords")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("quick-reply")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},72821:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("reactions").version((0,c.reactionsCreateTable)(),[new o.default(["parentMsgKey","senderUserJid"]),new i.default("msgKey"),new i.default("reactionText"),new i.default("timestamp"),new i.default("orphan"),new i.default("read"),new s.default("parentMsgKey"),new s.default("orphan")]).version((0,c.addReactionTableOrphanIndex)(),[new a.default(["parentMsgKey","orphan"])]).version((0,c.addReactionTableMsgKeyIndex)(),[new s.default("msgKey")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("reactions")};var i=n(r(79051)),a=n(r(34654)),s=n(r(19570)),o=n(r(54180)),l=r(99069),c=r(406)},29953:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("recent-stickers").version((0,o.recentStickersCreateTable)(),[new s.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("msgId"),new i.default("weight")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("recent-stickers")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},34296:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("sync-actions").version((0,c.syncActionsCreateTable)(),[new l.default("index"),new i.default("keyId"),new i.default("version"),new i.default("actionState"),new s.default("actionState"),new i.default("modelId"),new i.default("modelType"),new a.default(["modelId","modelType","actionState"]),new i.default("valueMac"),new i.default("indexMac"),new s.default("indexMac"),new i.default("collection"),new s.default("collection"),new i.default("timestamp"),new i.default("action"),new s.default("action"),new i.default("binarySyncAction"),new i.default("binarySyncData")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("sync-actions")};var i=n(r(79051)),a=n(r(34654)),s=n(r(19570)),o=r(99069),l=n(r(89362)),c=r(406)},63776:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("sync-keys").version((0,c.syncKeysCreateTable)(),[new l.default("keyId"),new i.default("timestamp"),new i.default("fingerprint"),new a.AddEncryptedColumn("keyData",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new i.default("keyEpoch"),new s.default("keyEpoch")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("sync-keys")};var i=n(r(79051)),a=r(86445),s=n(r(19570)),o=r(99069),l=n(r(89362)),c=r(406)},33850:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("tasks-scheduled-time").version((0,o.tasksScheduledTimeCreateTable)(),[new s.default("taskName"),new i.default("time")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("tasks-scheduled-time")};var i=n(r(79051)),a=r(99069),s=n(r(89362)),o=r(406)},85808:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("verified-business-name").version((0,l.verifiedBusinessNameCreateTable)(),[new o.default("id"),new i.default("serial"),new i.default("name"),new i.default("isApi"),new i.default("level"),new i.default("actualActors"),new i.default("hostStorage"),new i.default("privacyModeTs")]).version((0,l.verifiedBusinessNameAddPrivacyMode)(),[new i.default("privacyMode"),new a.default("actualActors"),new a.default("hostStorage"),new a.default("privacyModeTs")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("verified-business-name")};var i=n(r(79051)),a=n(r(23263)),s=r(99069),o=n(r(89362)),l=r(406)},99069:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new s.default(c);d=new o.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[model-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[model-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),s=n(r(98883)),o=r(37521),l=r(23283);const c="model-storage";t.DATABASE_NAME=c;let d=null},36163:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.restoreArchiveV2Settings=function(){if((0,P.archiveV2Supported)()){const e=(0,F.getArchiveV2EnabledSetting)(),t=(0,F.getUnarchiveChatsSetting)();null!=e&&(q.default.archive=(0,a.default)((0,a.default)({},q.default.archive),{},{enabled:e})),null!=t&&(q.default.archive=(0,a.default)((0,a.default)({},q.default.archive),{},{classic:t}))}},t.restoreBlocklist=function(){return(0,c.getTable)().all().then((e=>{d.BlocklistCollection.initializeFromCache(e.map(X.hydrateWids))}))},t.restoreCarts=function(){if((0,P.cartPropEnabled)())return(0,u.getTable)().all().then((e=>{p.CartCollection.initializeFromCache(e.map(X.hydrateWids))}));return Promise.resolve()},t.restoreChatsAndMessages=function(){return oe.apply(this,arguments)},t.restoreFavoriteStickers=function(){if(b.GK.supportsFeature(b.GK.F.MD_BACKEND)&&(0,l.getABPropConfigValue)("sticker_md_favorite_stickers_enabled"))return(0,T.getTable)().all().then((e=>A.default.initializeFromCache(e)));return Promise.resolve()},t.restoreGroupsContactsAndProfilePics=function(){return(0,w.initializeWithoutGKs)().then((()=>{performance.now();const e=(0,y.getTable)().all().then((e=>{E.ContactCollection.checksum=(0,k.getContactChecksum)()||"",E.ContactCollection.add(e.map(X.hydrateWids),{silent:!0,merge:!0})})),t=(0,O.getTable)().all().then((e=>{I.default.add(e.map(X.hydrateWids),{silent:!0}),e.forEach((e=>{(0,j.updateSubject)((0,ee.createWidFromWidLike)(e.id),e.subject),(0,M.updatePendingParticipants)((0,ee.createWidFromWidLike)(e.id))}))})),r=(0,K.getTable)().all().then((e=>{Y.ProfilePicThumbCollection.add(e.map(X.hydrateWids),{silent:!0})}));return Promise.all([e,t,r])})).then((()=>{}))},t.restoreImportantMetaData=function(){__LOG__(2)`[InitFromStorage] will attempt to initialize metadata from storage`,m.Conn.trigger("me_ready");const e=(0,C.getPushname)(),t=(0,C.getLastMobilePlatform)();if(null==t)throw new Error("platform not found in UserPrefs.");m.Conn.pushname=e,m.Conn.platform=t,__LOG__(2)`[InitFromStorage] important metadata loaded`},t.restoreLabelAssociations=function(){if((0,P.canDisplayLabel)())return(0,D.getTable)().all().then((e=>{N.LabelCollection.initializeAssociationsFromCache(e)}));return Promise.resolve()},t.restoreLabels=function(){if((0,P.canDisplayLabel)())return(0,R.getTable)().all().then((e=>{N.LabelCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreQuickReplies=function(){if((0,P.canSendQuickReply)())return(0,W.getTable)().all().then((e=>{H.QuickReplyCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreRecentStickers=function(){if(b.GK.supportsFeature(b.GK.F.MD_BACKEND)&&z.ServerProps.webServerStickerPanel)return(0,V.getTable)().all().then((e=>$.RecentStickerCollectionMd.initializeFromCache(e)));return Promise.resolve()},t.updateGKFeatures=function(){b.GK.supportsFeature(b.GK.F.MD_BACKEND)&&((0,k.setGKProto)(b.GK.proto),(0,k.setGKFeatures)(b.GK.features))};var i=n(r(48926)),a=n(r(81109)),s=r(27870),o=r(92844),l=r(86945),c=r(89426),d=r(32826),u=r(44786),p=r(12392),h=r(68638),f=r(69951),_=r(51612),m=r(17239),g=n(r(69618)),y=r(4233),E=r(19380),S=r(15998),v=r(1973),T=r(51722),A=n(r(70723)),C=r(99234),b=r(7293),P=r(57701),M=r(62415),O=r(64632),I=n(r(63928)),w=r(23356),R=r(94337),D=r(82663),N=r(16770),L=r(90981),k=r(50313),G=r(59871),U=n(r(32219)),F=r(58052),x=r(29731),B=r(97480),K=r(96189),Y=r(82039),j=r(10790),W=r(73821),H=r(99662),V=r(29953),$=r(49264),z=r(64551),q=n(r(68132));r(79038);var J=r(12896),Q=r(134),X=r(64448),Z=r(85808),ee=r(58021);function te(e){return null!=e.t&&(0,o.happenedWithin)((0,o.castToUnixTime)(e.t),o.DAY_SECONDS)||null!=e.pin&&e.pin>0}function re(e){return Promise.all(e.map((e=>{const t=te(e);return(0,J.getKeyMsgsFromChatHistory)(e,t).then((r=>{let{anchor:n,previewMsg:i,lastReceivedKey:s}=r;return{chat:(0,a.default)((0,a.default)({},e),{},{unreadMsgAnchorId:t?n:void 0}),previewMsg:i,lastReceivedKey:s}}))})))}function ne(e){const{tasks:t,lastMessageKeys:r}=function(e){const t=[],r=[];return e.forEach((e=>{let{chat:n,previewMsg:i,lastReceivedKey:a}=e;te(n)||i&&i.id!==a?(performance.now(),t.push(function(e,t){return te(e)?e.unreadCount>=20?ie(e,t).then((()=>function(e){if(!e.unreadMsgAnchorId)return __LOG__(3)`unreadMsgAnchorId is not defined`,Promise.resolve();return(0,L.getTable)().equals(["id"],e.unreadMsgAnchorId).then((t=>{if(0===t.length)return void __LOG__(3)`Unread anchor message does not exist in message table`;const r=(0,J.getInChatMsgId)(t[0].internalId||""),n=Math.max(0,r-5);return(0,J.queryChatMessageHelper)((0,J.craftInternalId)(e.id,n),(0,J.craftInternalId)(e.id,r+5),{lowerInclusive:!0,upperInclusive:!1}).then((t=>{if(t.length-5<0)return;const r=t[t.length-5].id,n=t.map((e=>{const t=(0,J.hydrateMessage)(e);return t.invis=!0,t}));return G.MsgCollection.processMultipleMessages((0,ee.createWidFromWidLike)(e.id),n,{pendingMsgsDone:!0,resume:!1,add:"unread",isHistory:!0,firstUnreadKey:U.default.fromString(r)},new _.ChatMsgsCollection)})).then()}))}(e))):0===e.unreadCount?ie(e,t):(__LOG__(2)`restoreMessagesForChat: restoring last ${e.unreadCount+5} messages.`,(0,J.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:e.unreadCount+5}).then((t=>G.MsgCollection.processMultipleMessages((0,ee.createWidFromWidLike)(e.id),t.map(J.hydrateMessage).reverse(),{pendingMsgsDone:!0,resume:!1,add:"last",isHistory:!0}))).then()):ie(e,t)}(n,i).then((()=>{if(n.unreadMsgAnchorId){const e=U.default.fromString(n.unreadMsgAnchorId),t=G.MsgCollection.get(e);if(!t)return void __LOG__(3)`Unread anchor message is not in message collection.`;const r=f.ChatCollection.get((0,ee.createWidFromWidLike)(n.id));r&&(r.unreadMsgAnchor=t)}})))):r.push(String(a))})),{tasks:t,lastMessageKeys:r}}(e);return t.push(function(e){return performance.now(),(0,L.getTable)().bulkGet(e).then(function(){var e=(0,i.default)((function*(e){yield Promise.all(e.map((e=>{if(!e)return Promise.resolve();const t=(0,J.hydrateMessage)(e);return t.invis=!0,G.MsgCollection.processMultipleMessages(t.id.remote,[t],{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})})))}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw __LOG__(4,void 0,new Error)`loadLastMessagesFromDB: failed with error: ${e}`,e}))}(r)),Promise.all(t)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,i.default)((function*(e,t){let r;r=(null==t?void 0:t.internalId)?yield(0,J.queryChatMessageHelper)(t.internalId,`${e.id}_g`,{lowerInclusive:!0}):yield(0,J.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:1}),__LOG__(2)`processPreviewMessageInChat: restoring ${r.length} message.`,G.MsgCollection.processMultipleMessages((0,ee.createWidFromWidLike)(e.id),r.map((e=>{const t=(0,J.hydrateMessage)(e);return t.invis=!0,t})),{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})}))).apply(this,arguments)}function se(e){switch(e){case"unknown":return g.default.VERIFIED_LEVEL.UNKNOWN;case"low":return g.default.VERIFIED_LEVEL.LOW;case"high":return g.default.VERIFIED_LEVEL.HIGH;default:return g.default.VERIFIED_LEVEL.UNKNOWN}}function oe(){return(oe=(0,i.default)((function*(){return yield S.DbEncKeyStore.waitForFinalDbMsgEncKey(),(0,w.initializeWithoutGKs)().then(Q.updatePeerReceipts).then((0,i.default)((function*(){const e=yield(0,h.getTable)().all();b.GK.supportsFeature(b.GK.F.MD_BACKEND)&&B.OfflineResumeReporter.logOfflineChatThreadCount(e.length),e.sort(((e,t)=>{var r,n;return-((null!==(r=e.t)&&void 0!==r?r:0)-(null!==(n=t.t)&&void 0!==n?n:0))})),f.ChatCollection.add(e.map((e=>(0,X.hydrateWids)((0,a.default)((0,a.default)({},e),{},{pendingInitialLoading:!0})))),{merge:!0});const t=(0,l.getABPropConfigValue)("web_init_chat_batch_size")||100;return yield le(e,t)}))).then(ce).catch((e=>{throw __LOG__(4,void 0,new Error)`restoreChatsAndMessages: failed with error: ${e}`,e}))}))).apply(this,arguments)}function le(e,t){let r=Promise.resolve();const n=new s.PromiseQueue;for(let a=0;a<e.length;a+=t){const s=e.slice(a,a+t),o=function(){var e=(0,i.default)((function*(){performance.now();const e=yield re(s);yield ne(e),e.forEach((e=>{let{chat:t}=e;const r=f.ChatCollection.get(t.id);r&&r.set({pendingInitialLoading:!1})}))}));return function(){return e.apply(this,arguments)}}();0===a?r=n.enqueue((()=>new x.NonPersistJob("initialChatLoad",o,{priority:v.JOB_PRIORITY.SKIP}).waitUntilCompleted())):n.enqueue((()=>new x.NonPersistJob("initialChatLoad",o).waitUntilCompleted()))}return r}function ce(){return de.apply(this,arguments)}function de(){return(de=(0,i.default)((function*(){(yield(0,Z.getTable)().all()).forEach((e=>{let t;try{t=(0,ee.createUserWid)(e.id)}catch(e){return __LOG__(4,void 0,new Error,!0)`restore-business-info: invalid wid`,void SEND_LOGS("restore-business-info: invalid wid")}const r=f.ChatCollection.get(t);if(r){const t={isBusiness:!0,isEnterprise:e.isApi,verifiedName:e.name,verifiedLevel:se(e.level||"unknown"),privacyMode:e.privacyMode};r.contact.set(t),"high"===e.level&&e.name&&!r.contact.name&&r.contact.set({name:e.name})}}))}))).apply(this,arguments)}},406:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abpropsConfigCreateTable=function(){return(0,n.getStorage)().versions.version(19)},t.activeMessageRangesCreateTable=function(){return(0,n.getStorage)().versions.version(23)},t.addActionToPendingMutations=function(){return(0,n.getStorage)().versions.version(48)},t.addArchiveAtMentionViewedInDrawer=function(){return(0,n.getStorage)().versions.version(61)},t.addChatThreadLoggingTable=function(){return(0,n.getStorage)().versions.version(78)},t.addGroupFromKeyToGroupInviteV4=function(){return(0,n.getStorage)().versions.version(55)},t.addHasAccessedToAbpropsConfigTable=function(){return(0,n.getStorage)().versions.version(77)},t.addReactionTableMsgKeyIndex=function(){return(0,n.getStorage)().versions.version(75)},t.addReactionTableOrphanIndex=function(){return(0,n.getStorage)().versions.version(71)},t.addRequiresDirectConnection=function(){return(0,n.getStorage)().versions.version(63)},t.addStaticURLToImageVideoMessages=function(){return(0,n.getStorage)().versions.version(60)},t.addStatusPSACampaignFields=function(){return(0,n.getStorage)().versions.version(65)},t.addSupportForHSMButtons=function(){return(0,n.getStorage)().versions.version(46)},t.addTcTokenSenderTimestampToChatTable=function(){return(0,n.getStorage)().versions.version(62)},t.addTcTokenTimestampToChatTable=function(){return(0,n.getStorage)().versions.version(57)},t.addTcTokenToChatTable=function(){return(0,n.getStorage)().versions.version(56)},t.addUnreadMentionCountToChatTable=function(){return(0,n.getStorage)().versions.version(51)},t.addUnreadMentionToChatTable=function(){return(0,n.getStorage)().versions.version(44)},t.addWaveformToAudioMessages=function(){return(0,n.getStorage)().versions.version(50)},t.blocklistCreateTable=function(){return(0,n.getStorage)().versions.version(4)},t.cartCreateTable=function(){return(0,n.getStorage)().versions.version(25)},t.chatAddDisappearingModeInitiator=function(){return(0,n.getStorage)().versions.version(36)},t.chatCreateTable=function(){return(0,n.getStorage)().versions.version(6)},t.collectionVersionCreateTable=function(){return(0,n.getStorage)().versions.version(1)},t.contactAddDisappearingModeProperties=function(){return(0,n.getStorage)().versions.version(35)},t.contactAddIsContactSyncCompleted=function(){return(0,n.getStorage)().versions.version(28)},t.contactCreateTable=function(){return(0,n.getStorage)().versions.version(3)},t.deviceListAddDelete=function(){return(0,n.getStorage)().versions.version(41)},t.deviceListAddV2Fields=function(){return(0,n.getStorage)().versions.version(59)},t.deviceListCreateTable=function(){return(0,n.getStorage)().versions.version(11)},t.directConnectionKeysCreateTable=function(){return(0,n.getStorage)().versions.version(70)},t.encryptHistorySyncDirectPath=function(){return(0,n.getStorage)().versions.version(42)},t.encryptHistorySyncFilehash=function(){return(0,n.getStorage)().versions.version(45)},t.encryptedMutationsCreateTable=function(){return(0,n.getStorage)().versions.version(15)},t.favoriteStickersCreateTable=function(){return(0,n.getStorage)().versions.version(73)},t.ftsIndexingQueueCreateTable=function(){return(0,n.getStorage)().versions.version(24)},t.groupInviteV4CreateTable=function(){return(0,n.getStorage)().versions.version(39)},t.groupMetadataCreateTable=function(){return(0,n.getStorage)().versions.version(20)},t.historySyncNotificationsCreateTable=function(){return(0,n.getStorage)().versions.version(14)},t.inactiveReceiptCreateTable=function(){return(0,n.getStorage)().versions.version(12)},t.labelAssociationCreateTable=function(){return(0,n.getStorage)().versions.version(17)},t.labelCreateTable=function(){return(0,n.getStorage)().versions.version(16)},t.messageAddActionLink=function(){return(0,n.getStorage)().versions.version(72)},t.messageAddDisappearingModeInitiator=function(){return(0,n.getStorage)().versions.version(37)},t.messageAddGroupInviteV4=function(){return(0,n.getStorage)().versions.version(38)},t.messageAddHeaderType=function(){return(0,n.getStorage)().versions.version(74)},t.messageAddInteractiveMessageFields=function(){return(0,n.getStorage)().versions.version(69)},t.messageAddIsSendFailureProperties=function(){return(0,n.getStorage)().versions.version(27)},t.messageAddNativeFlowNameField=function(){return(0,n.getStorage)().versions.version(54)},t.messageAddPaymentBackground=function(){return(0,n.getStorage)().versions.version(68)},t.messageAddPaymentInviteServiceType=function(){return(0,n.getStorage)().versions.version(64)},t.messageAddPaymentRequestNFMFields=function(){return(0,n.getStorage)().versions.version(49)},t.messageAddPaymentTxnStatus=function(){return(0,n.getStorage)().versions.version(29)},t.messageAddPrivacyModeFields=function(){return(0,n.getStorage)().versions.version(32)},t.messageAddProductListPreviewHeaderImage=function(){return(0,n.getStorage)().versions.version(34)},t.messageAddProductListPreviewInfo=function(){return(0,n.getStorage)().versions.version(30)},t.messageCreateTable=function(){return(0,n.getStorage)().versions.version(7)},t.messageInfoAddDeliveryPrivacyMode=function(){return(0,n.getStorage)().versions.version(33)},t.messageInfoCreateTable=function(){return(0,n.getStorage)().versions.version(8)},t.messageRemovePaymentRequestHeaderField=function(){return(0,n.getStorage)().versions.version(52)},t.messageStatusPSAReadTimestamp=function(){return(0,n.getStorage)().versions.version(76)},t.missingKeysCreateTable=function(){return(0,n.getStorage)().versions.version(26)},t.orphanPaymentNotificationCreateTable=function(){return(0,n.getStorage)().versions.version(40)},t.orphanReceiptCreateTable=function(){return(0,n.getStorage)().versions.version(10)},t.orphanRevokeCreateTable=function(){return(0,n.getStorage)().versions.version(47)},t.participantCreateTable=function(){return(0,n.getStorage)().versions.version(9)},t.peerMessageCreateTable=function(){return(0,n.getStorage)().versions.version(43)},t.pendingMutationsCreateTable=function(){return(0,n.getStorage)().versions.version(0)},t.privacyDisallowedListAddDhashField=function(){return(0,n.getStorage)().versions.version(67)},t.privacyDisallowedListCreateTable=function(){return(0,n.getStorage)().versions.version(58)},t.profilePicThumbCreateTable=function(){return(0,n.getStorage)().versions.version(5)},t.quickReplyCreateTable=function(){return(0,n.getStorage)().versions.version(18)},t.reactionsCreateTable=function(){return(0,n.getStorage)().versions.version(66)},t.recentStickersCreateTable=function(){return(0,n.getStorage)().versions.version(53)},t.syncActionsCreateTable=function(){return(0,n.getStorage)().versions.version(2)},t.syncKeysCreateTable=function(){return(0,n.getStorage)().versions.version(21)},t.tasksScheduledTimeCreateTable=function(){return(0,n.getStorage)().versions.version(22)},t.verifiedBusinessNameAddPrivacyMode=function(){return(0,n.getStorage)().versions.version(31)},t.verifiedBusinessNameCreateTable=function(){return(0,n.getStorage)().versions.version(13)};var n=r(99069)},46308:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUserToPendingDeviceSync=function(e){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))return(0,s.getTable)().bulkCreateOrMerge(e.map((e=>({id:e}))));return Promise.resolve()},t.doPendingDeviceSync=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(7293),s=r(12071),o=r(58021);function l(){return(l=(0,i.default)((function*(){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND))try{const e=yield(0,s.getTable)().all(),t=r(10823).syncDeviceListJob;yield t(e.map((e=>(0,o.createWid)(e.id))),null,null),yield(0,s.getTable)().bulkRemove(e.map((e=>e.id)))}catch(e){__LOG__(4,!0,new Error)`doPendingDeviceSync failed during RESUME_WITH_OPEN_TAB`}yield Promise.resolve()}))).apply(this,arguments)}},85417:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,c.destroyStorage)().catch((()=>d.resolve(new i.default(c.DATABASE_NAME).delete()))).finally((()=>{u=null}))},t.initialize=function(){null==u&&((0,c.createStorage)(),(0,l.addTable)(),(0,a.addTable)(),(0,s.addTable)(),(0,o.addTable)(),u=(0,c.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize offd storage"),e})));return u};var i=n(r(86128)),a=r(93771),s=r(78956),o=r(12071),l=r(33235),c=r(43950);const d=r(74121).Z;let u},93771:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("dangling-receipt").version((0,s.getStorage)().versions.version(1),[new a.default("id"),new i.default("receipts")]).view((e=>({id:e.id,receipts:e.receipts})))},t.getTable=function(){return(0,s.getStorage)().table("dangling-receipt")};var i=n(r(79051)),a=n(r(81674)),s=r(43950)},78956:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("peer-read-receipt").version((0,s.getStorage)().versions.version(2),[new a.default("id"),new i.default("msgKeys"),new i.default("ts"),new i.default("ack")]).view((e=>({id:e.id,ts:e.ts,msgKeys:e.msgKeys,ack:e.ack})))},t.getTable=function(){return(0,s.getStorage)().table("peer-read-receipt")};var i=n(r(79051)),a=n(r(81674)),s=r(43950)},12071:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("pending-device-sync").version((0,i.getStorage)().versions.version(4),[new a.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,i.getStorage)().table("pending-device-sync")};var i=r(43950),a=n(r(89362))},33235:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("read-receipt").version((0,a.getStorage)().versions.version(0),[new s.default("id"),new i.default("externalIds")]).delete((0,a.getStorage)().versions.version(3)).view((e=>({id:e.id,externalIds:e.externalIds})))},t.getTable=function(){return(0,a.getStorage)().table("read-receipt")};var i=n(r(79051)),a=r(43950),s=n(r(89362))},43950:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new s.default(c);d=new o.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[offd-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[offd-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),s=n(r(98883)),o=r(37521),l=r(23283);const c="offd-storage";t.DATABASE_NAME=c;let d=null},134:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updatePeerReceipts=function(){return f.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=n(r(69618)),o=r(7293),l=r(10435),c=r(90981),d=n(r(32219)),u=r(54676),p=r(78956),h=r(99069);function f(){return(f=(0,a.default)((function*(){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const e=yield(0,p.getTable)().all(),t=[],r=[];e.forEach((e=>{e.ack===s.default.ACK.READ?t.push(e):e.ack===s.default.ACK.PLAYED?r.push(e):__LOG__(3)`updatePeerReceipts: unknown ack type: ${e.ack}`}));const{chatUpdates:n,ackUpdates:a}=yield _(t),o=new Map(a.map((e=>[e.id,e])));g(r).forEach((e=>{const t=o.get(e.id);null==t?o.set(e.id,e):o.set(e.id,(0,i.default)((0,i.default)({},t),{},{ack:e.ack}))}));const l=[...o.values()];return yield(0,h.getStorage)().lock(["message","chat"],(e=>{let[t,r]=e;return Promise.all([t.bulkCreateOrMerge(l),r.bulkCreateOrMerge(n)])})),(0,p.getTable)().clear()}return Promise.resolve()}))).apply(this,arguments)}function _(){return m.apply(this,arguments)}function m(){return(m=(0,a.default)((function*(e){const t=[],r=[],n=new Map,i=new Set;e.forEach((e=>{e.msgKeys.forEach((e=>{const t=d.default.fromString(e).remote.toString();t!==s.default.STATUS_WID&&(n.set(t,{unreadCount:0,lastUnreadMsgRowId:void 0,unreadMentionsOfMe:[],unreadMentionCount:0}),i.add(e))}))}));const a=Array.from(n.keys()),o=yield(0,c.getTable)().anyOf(["from","pendingReadReceipt"],a.map((e=>[e,1])),{shouldDecrypt:!1});return o.forEach((e=>{const t=n.get(e.from),{rowId:r,id:a}=e;null!=t&&null!=r&&i.has(a)&&(null==t.lastUnreadMsgRowId||r>t.lastUnreadMsgRowId)&&(t.lastUnreadMsgRowId=r)})),o.forEach((e=>{const r=n.get(e.from),{rowId:i}=e;if(null!=r&&null!=i&&null!=r.lastUnreadMsgRowId)if(i<=r.lastUnreadMsgRowId)t.push({id:e.id,ack:s.default.ACK.READ,pendingReadReceipt:null});else if(r.unreadCount+=1,(0,l.isGroupCatchUpEnabled)()&&(0,u.isImportantMessage)(e)){const t={id:e.id,timestamp:e.t};r.unreadMentionsOfMe.push(t)}})),a.forEach((e=>{const t=n.get(e);null!=t&&null!=t.lastUnreadMsgRowId&&r.push({id:e,unreadCount:t.unreadCount,unreadMentionsOfMe:t.unreadMentionsOfMe})})),{chatUpdates:r,ackUpdates:t}}))).apply(this,arguments)}function g(e){const t=new Set;return e.forEach((e=>{e.ack===s.default.ACK.PLAYED&&e.msgKeys.forEach((e=>t.add(e)))})),Array.from(t).map((e=>({id:e,ack:s.default.ACK.PLAYED,pendingReadReceipt:null})))}},63719:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.add=function(e){d=d.concat(e.map(p)),u()},t.deleteRange=E,t.getFromBottom=_,t.rowCount=g;var i=n(r(48926)),a=n(r(23493)),s=r(94398),o=r(30433),l=r(94398);const c=1e5;let d=[];const u=(0,a.default)((()=>T()),200);function p(e){return{marker_id:e.marker_id,method:e.method,action_id:e.action_id,duration_ns:e.duration_ns,marker_type:e.marker_type,sample_rate:e.sample_rate,points:e.points,instance_id:e.instance_id,metadata:e.metadata||{application_analytics:{time_since_qpl_module_init:0}},flags:e.flags,annotations_bool_array:e.annotations_bool_array,annotations_bool:e.annotations_bool,annotations_double_array:e.annotations_double_array,annotations_double:e.annotations_double,annotations_int_array:e.annotations_int_array,annotations_int:e.annotations_int,annotations_string_array:e.annotations_string_array,annotations:e.annotations}}function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){try{yield(0,s.initialize)()}catch(e){throw __LOG__(4,!0,new Error,!0)`QPL Storage, error calling initializeQplStorage, error ${e}`,SEND_LOGS("QPL Storage init error"),e}}))).apply(this,arguments)}function _(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){return yield h(),(0,l.getQplEventsTable)().all({limit:e,offset:0})}))).apply(this,arguments)}function g(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){return yield h(),(0,l.getQplEventsTable)().count()}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){return yield h(),(0,l.getQplEventsTable)().bulkDeleteRange(["id"],e-1,t+1).then((()=>{}))}))).apply(this,arguments)}let v=null;function T(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(){if(yield h(),v)v.then(T);else if(d.length>0){const e=d;d=[];try{const t=yield g();if(t+e.length>c){(0,o.maxStorageEventCountReached)();const r=t+e.length-c;yield C(r)}}catch(e){return __LOG__(4,!0,new Error,!0)`QPL Storage, error during checking for excessive events ${e}`,void SEND_LOGS("QPL Storage, error saving events")}v=(0,l.getQplEventsTable)().bulkCreate(e).then((()=>{v=null})).catch((e=>{__LOG__(4,!0,new Error,!0)`QPL Storage, error saving events ${e}`,SEND_LOGS("QPL Storage, error saving events"),v=null}))}}))).apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=yield _(e),r=t[0].id||0,n=t[t.length-1].id||0;yield E(r,n)}))).apply(this,arguments)}},94398:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,s.destroyStorage)().catch((()=>o.resolve(new i.default(s.DATABASE_NAME).delete()))).finally((()=>{l=null}))},Object.defineProperty(t,"getQplEventsTable",{enumerable:!0,get:function(){return a.getTable}}),t.initialize=function(){null==l&&((0,s.createStorage)(),(0,a.addTable)(),l=(0,s.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize qpl storage"),e})));return l};var i=n(r(86128)),a=r(4882),s=r(96367);const o=r(74121).Z;let l},4882:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("qpl-events").version((0,o.qplEventsCreateTable)(),[new a.default("id"),new i.default("marker_id"),new i.default("instance_id"),new i.default("action_id"),new i.default("sample_rate"),new i.default("method"),new i.default("duration_ns"),new i.default("points"),new i.default("metadata"),new i.default("marker_type"),new i.default("flags"),new i.default("annotations"),new i.default("annotations_double"),new i.default("annotations_int"),new i.default("annotations_bool"),new i.default("annotations_string_array"),new i.default("annotations_double_array"),new i.default("annotations_int_array"),new i.default("annotations_bool_array")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("qpl-events")};var i=n(r(79051)),a=n(r(81674)),s=r(96367),o=r(51542)},96367:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new s.default(c);d=new o.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[qpl-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[qpl-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),s=n(r(98883)),o=r(37521),l=r(23283);const c="qpl-storage";t.DATABASE_NAME=c;let d=null},51542:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplEventsCreateTable=function(){return(0,n.getStorage)().versions.version(0)};var n=r(96367)},318:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,p.destroyStorage)().catch((()=>h.resolve(new i.default(p.DATABASE_NAME).delete()))).finally((()=>{f=null}))},Object.defineProperty(t,"getBaseKeyTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getIdentityTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getMetaTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getPreKeyTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getSenderKeyTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getSessionTable",{enumerable:!0,get:function(){return d.getTable}}),Object.defineProperty(t,"getSignedPreKeyTable",{enumerable:!0,get:function(){return u.getTable}}),t.initialize=function(){null==f&&((0,p.createStorage)(),(0,a.addTable)(),(0,s.addTable)(),(0,o.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,d.addTable)(),(0,u.addTable)(),f=(0,p.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize signal storage"),e})));return f};var i=n(r(86128)),a=r(50930),s=r(35523),o=r(80919),l=r(64415),c=r(6259),d=r(1777),u=r(45726),p=r(77246);const h=r(74121).Z;let f},50930:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("baseKey-store").version((0,l.baseKeyCreateTable)(),[new s.default("id"),new i.default("address"),new i.default("originalMsgId"),new i.default("baseKey"),new a.default(["address","originalMsgId"])]).view((e=>({id:e.id,address:e.address,originalMsgId:e.originalMsgId,baseKey:e.baseKey})))},t.getTable=function(){return(0,o.getStorage)().table("baseKey-store")};var i=n(r(79051)),a=n(r(34654)),s=n(r(81674)),o=r(77246),l=r(12126)},35523:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("identity-store").version((0,o.identityCreateTable)(),[new s.default("identifier"),new i.default("identityKey"),new i.default("rowId")]).view((e=>({identifier:e.identifier,identityKey:e.identityKey,rowId:e.rowId})))},t.getTable=function(){return(0,a.getStorage)().table("identity-store")};var i=n(r(79051)),a=r(77246),s=n(r(89362)),o=r(12126)},80919:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("signal-meta-store").version((0,o.metaCreateTable)(),[new s.default("key"),new i.default("value")]).view((e=>({key:e.key,value:e.value})))},t.getTable=function(){return(0,a.getStorage)().table("signal-meta-store")};var i=n(r(79051)),a=r(77246),s=n(r(89362)),o=r(12126)},64415:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("prekey-store").version((0,o.preKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("isDirectDistribution")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,isDirectDistribution:e.isDirectDistribution})))},t.getTable=function(){return(0,s.getStorage)().table("prekey-store")};var i=n(r(79051)),a=n(r(81674)),s=r(77246),o=r(12126)},6259:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("senderkey-store").version((0,l.senderKeyCreateTable)(),[new o.default("senderKeyName"),new i.default("senderKey"),new i.default("senderId"),new a.default("senderId")]).view((e=>({senderKeyName:e.senderKeyName,senderKey:e.senderKey,senderId:e.senderId})))},t.getTable=function(){return(0,s.getStorage)().table("senderkey-store")};var i=n(r(79051)),a=n(r(19570)),s=r(77246),o=n(r(89362)),l=r(12126)},1777:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("session-store").version((0,o.sessionCreateTable)(),[new s.default("address"),new i.default("session")]).view((e=>({address:e.address,session:e.session})))},t.getTable=function(){return(0,a.getStorage)().table("session-store")};var i=n(r(79051)),a=r(77246),s=n(r(89362)),o=r(12126)},45726:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("signed-prekey-store").version((0,o.signedPreKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("signature")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,signature:e.signature})))},t.getTable=function(){return(0,s.getStorage)().table("signed-prekey-store")};var i=n(r(79051)),a=n(r(81674)),s=r(77246),o=r(12126)},77246:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new s.default(c);d=new o.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[signal-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[signal-storage] Storage should be created first before being accessed"),d};var i=n(r(86128)),a=n(r(41143)),s=n(r(98883)),o=r(37521),l=r(23283);const c="signal-storage";t.DATABASE_NAME=c;let d=null},12126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseKeyCreateTable=function(){return(0,n.getStorage)().versions.version(5)},t.identityCreateTable=function(){return(0,n.getStorage)().versions.version(0)},t.metaCreateTable=function(){return(0,n.getStorage)().versions.version(1)},t.preKeyCreateTable=function(){return(0,n.getStorage)().versions.version(2)},t.senderKeyCreateTable=function(){return(0,n.getStorage)().versions.version(6)},t.sessionCreateTable=function(){return(0,n.getStorage)().versions.version(3)},t.signedPreKeyCreateTable=function(){return(0,n.getStorage)().versions.version(4)};var n=r(77246)},44558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=n(r(48926));function a(){return(a=(0,i.default)((function*(){const e=window.caches;if(null==e)return;const t=yield e.keys();yield Promise.all(t.map((t=>e.delete(t))))}))).apply(this,arguments)}},23283:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StorageCmdImpl=t.StorageCmd=void 0;var i=n(r(34342));class a extends i.default{}t.StorageCmdImpl=a;const s=new a;t.StorageCmd=s},37362:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={REQUEST_STREAMING_INFO:"GET_STREAMING_INFO",REQUEST_RMR:"REQUEST_RMR",SEND_STREAMING_CHUNK:"SEND_STREAMING_CHUNK",EXP_BACKOFF:"EXP_BACKOFF",LOG:"LOG",UPLOAD_LOGS:"UPLOAD_LOGS",REQUEST_DOCUMENT_DOWNLOAD:"REQUEST_DOCUMENT_DOWNLOAD",SET_L10N:"SET_L10N",STREAMING_SUPPORTED:"STREAMING_SUPPORTED",REMOVE_PP:"REMOVE_PP",LOGOUT:"LOGOUT",CLEAN_ASSETS:"CLEAN_ASSETS",PRELOAD_LAZY_LOADED_BUNDLES:"PRELOAD_LAZY_LOADED_BUNDLES",ACTIVE_TAB:"ACTIVE_TAB"};t.default=r},79485:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926));class a{constructor(e){this.onMessage=e=>{if(!e.data||!e.data.action)return;const t=e.data;if(!e.ports||0===e.ports.length)return;const r=e.ports;if(!a.isSW()&&window.navigator.serviceWorker&&e.source!==window.navigator.serviceWorker.controller)return;("function"==typeof e.waitUntil?t=>e.waitUntil(t):()=>{})(Promise.resolve(this.requestHandler(t)).then((e=>{r[0].postMessage(e)})).catch((e=>{r[0].postMessage({error:e&&e.toString()})})))},this.requestHandler=e}init(){const e=a.isSW()?self:window.navigator.serviceWorker;try{if(!e)return;e.addEventListener("message",this.onMessage)}catch(e){}}static isSW(){return"undefined"==typeof window}static getRequestor(e){return a.isSW()?"string"==typeof e?self.clients.get(e):Promise.resolve(e):window.navigator.serviceWorker?window.navigator.serviceWorker.ready.then((()=>window.navigator.serviceWorker?window.navigator.serviceWorker.controller:null)):Promise.resolve(null)}static broadcast(e,t){return(0,i.default)((function*(){if(!a.isSW())throw new Error("Broadcast called from non-serviceworker.");const r=yield self.clients.matchAll();return 0===r.length?Promise.reject(new Error("No clients available.")):Promise.all(r.map((r=>a.request(r,e,t))))}))()}static request(e,t,r){const n=new MessageChannel;return new Promise(((i,s)=>(n.port1.onmessage=e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.error)?s(e.data.error):i(e.data)},a.getRequestor(e).then((e=>{if(!e)return s(new Error("No ServiceWorker controlling this client."));e.postMessage({action:t,message:r,version:"2.2204.13"},[n.port2])})))))}}t.default=a},58586:(e,t,r)=>{"use strict";var n=r(95318),i=n(r(37362)),a=r(88102),s=r(70818),o=r(46582),l=r(27838),c=n(r(79485)),d=r(8080),u=n(r(5882)),p=r(65044);if(u.default.supported){const e=function(){try{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&e.controller.addEventListener("error",(e=>{p.Socket.state!==p.STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker controller error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker, error: ${e}`}};try{const t=navigator.serviceWorker;t&&t.addEventListener("controllerchange",(()=>{e(),p.Socket.state===p.STATE.UNLAUNCHED&&(d.Stream.needsUpdate=!0)}))}catch(e){__LOG__(3)`Unable to add "controllerchange" event listener to service worker container, error: ${e}`}try{const e=navigator.serviceWorker;e&&e.addEventListener("error",(e=>{p.Socket.state!==p.STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker container error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker container, error: ${e}`}e();const t=function(e,t){e.buffer.forEach((e=>{var r;const n=null!==(r=e.message[0])&&void 0!==r?r:"",i=function(e){switch(e){case"info":return 1;case"log":return 2;case"warn":return 3;case"error":return 4}throw new Error(`Invalid level: ${e}`)}(e.level.match(/^(.*?)(?:Verbose)?$/i)[1]);s.Logger.logImpl(i,`ServiceWorker (${t}): ${n}`,e.error,e.attachedToSendLogs,e.extraTags)}))};new c.default((e=>{let{action:n,message:a,version:s}=e;switch(n){case i.default.REQUEST_STREAMING_INFO:case i.default.EXP_BACKOFF:case i.default.REQUEST_RMR:case i.default.SEND_STREAMING_CHUNK:return(0,o.requireHandleVideoStreamingRequest)().then((e=>e({action:n,message:a})));case i.default.LOG:if(p.Socket.state===p.STATE.UNLAUNCHED)return;return a&&t(a,s),{test:!0};case i.default.UPLOAD_LOGS:a&&t(a,s);return r(85965).upload({reason:"Requested by Service Worker"}).then((()=>{}));case i.default.ACTIVE_TAB:return{isActive:(0,l.getIsTabActive)()};default:return Promise.reject(new Error(`Invalid Action: ${n}`))}})).init(),a.Cmd.on("logout",(()=>{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&c.default.request(e.controller,i.default.LOGOUT).catch((()=>{}))}))}},62918:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926));t.default=class{open(){return this._openPromise?this._openPromise:this._closePromise?(this._openPromise=this._closePromise.catch((e=>{throw this._openPromise=null,e})).then((()=>(this._openPromise=null,this.open()))),this._openPromise):(this._openPromise=this.doOpen().catch((e=>{throw this._openPromise=null,e})).then((()=>{this._openPromise=null})),this._openPromise)}close(){return this._closePromise?this._closePromise:this._openPromise?(this._closePromise=this._openPromise.catch((e=>{throw this._closePromise=null,e})).then((()=>(this._closePromise=null,this.close()))),this._closePromise):(this._closePromise=this.doClose().catch((e=>{throw this._closePromise=null,e})).then((()=>{this._closePromise=null})),this._closePromise)}get(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doGet(e)}))()}queryByIndex(e,t){var r=this;return(0,i.default)((function*(){return yield r.open(),r.doQueryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doGetAll()}))()}put(e,t){var r=this;return(0,i.default)((function*(){return yield r.open(),r.doPut(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doDel(e)}))()}count(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doCount()}))()}clear(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doClear()}))()}doGet(){throw new Error("Not implemented")}doQueryByIndex(){throw new Error("Not implemented")}doGetAll(){throw new Error("Not implemented")}doPut(){throw new Error("Not implemented")}doDel(){throw new Error("Not implemented")}doCount(){throw new Error("Not implemented")}doClear(){throw new Error("Not implemented")}doOpen(){throw new Error("Not implemented")}doClose(){throw new Error("Not implemented")}}},5882:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(38284),a=n(r(37362)),s=n(r(34342)),o=n(r(79485)),l=r(65127);const c="Modernizr"in window;class d extends s.default{constructor(){super(),this.supported=c?Modernizr.serviceworker:"serviceWorker"in navigator,this._checkAlive=()=>{var e;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;return Boolean(t)},this._checkStreamingSupport=()=>{var e;if(!this.supported||!this.alive||l.UA.isSafari)return void(this._streamingSupported=!1);if(this._streamingSupportedPromise)return this._streamingSupported;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;t&&(this._streamingSupportedPromise=(0,i.promiseTimeout)(o.default.request(t,a.default.STREAMING_SUPPORTED),100).catch((()=>!1)).then((e=>(delete this._streamingSupportedPromise,this.streamingSupported=e,e))))},this._setSupported=e=>{this.supported=e},c&&Modernizr.on("serviceworker",this._setSupported);const e=this;Object.defineProperty(this,"streamingSupported",{get:()=>(e._checkStreamingSupport(),e._streamingSupported),set(t){t!==e._streamingSupported&&e.trigger("change:streamingSupported",t),e._streamingSupported=t}}),Object.defineProperty(this,"alive",{get:()=>e._checkAlive()})}}var u=new d;t.default=u},56042:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigs=void 0;t.ABPropConfigs={in_app_support_v2_enabled:[233,"bool",!1],in_app_support_v2_locale_langs:[379,"string",""],in_app_support_v2_numbers:[390,"string",""],in_app_support_v2_number_prefixes:[1031,"string","15517868"],in_app_support_v2_jump_to_group:[819,"bool",!1],in_app_support_v2_jump_to_group_wait_time_in_ms:[974,"int",5e3],groups_dogfooding_ui:[308,"bool",!1],md_icdc_enabled:[309,"bool",!1],md_icdc_hash_length:[310,"int",10],played_self_enabled:[361,"bool",!1],ephemeral_24h_duration:[407,"bool",!1],disappearing_mode:[536,"bool",!1],payments_expressive_backgrounds_enabled:[605,"bool",!1],ephemeral_allow_group_members:[432,"bool",!1],business_profile_refresh_m1_enabled:[470,"bool",!1],num_days_key_index_list_expiration:[730,"int",35],num_days_before_device_expiry_check:[731,"int",7],media_reupload_limit_mb:[1098,"int",100],native_shop_preview_enabled:[636,"bool",!1],sync_archive_v2_setting:[736,"bool",!1],ptt_conversation_waveform:[637,"bool",!1],ptt_waveform_send:[746,"bool",!1],adv_v2_m4_m5:[753,"bool",!1],adv_v2_m6:[903,"bool",!1],ptt_draft_enabled:[777,"bool",!1],ptt_pausable_enabled:[871,"bool",!1],tos_3_client_gating_biz_initiated_enabled:[953,"bool",!1],tos_3_client_gating_enabled:[791,"bool",!1],tos_3_client_force_fetch_enabled:[792,"bool",!1],tos_client_state_fetch_enabled:[877,"bool",!1],tos_client_state_force_fetch_enabled:[878,"bool",!1],tos_client_state_fetch_iteration:[908,"int",0],country_client_gating_enabled:[1105,"bool",!1],system_msg_numbers_fb_branded:[1035,"string","16505434800,16503130062,16507885324,16508620604,16504228206,447710173736,16315551023,16505361212,16508129150,16315555102,16315558723,16505212669,16507885280,19032707825,0"],system_msg_numbers_fb_inc:[1036,"string",""],log_clock_skew:[1190,"bool",!1],trusted_contacts:[794,"bool",!1],trusted_contacts_sender:[995,"bool",!1],trusted_contacts_ti:[922,"bool",!1],tctoken_duration:[865,"int",604800],tctoken_num_buckets:[909,"int",4],tctoken_duration_sender:[996,"int",604800],tctoken_num_buckets_sender:[997,"int",4],reactions_receive:[827,"bool",!1],reactions_send:[828,"bool",!1],reactions_announcement_only:[1150,"bool",!1],reaction_cleanup_days:[987,"int",31],md_migration_experience:[861,"int",0],web_abprop_direct_connection_md:[869,"bool",!1],media_upload_prekeys_fetch_enabled:[907,"bool",!1],ptt_remember_play_position:[952,"bool",!1],banned_shops_ux_enabled:[957,"bool",!1],group_suspend_v0_enabled:[973,"bool",!1],parent_group_view_enabled:[982,"bool",!1],parent_group_create_enabled:[1173,"bool",!1],parent_group_query_ts:[1228,"int",0],parent_group_link_limit:[1238,"int",0],cadmin_self_demote:[1286,"bool",!1],forwarded_ptt_ui_enabled:[1040,"bool",!1],shops_storefront_url_format:[1054,"string","https://www.facebook.com/%s/shop/"],message_count_logging_md_enabled:[1135,"bool",!1],dev_prop_string:[1064,"string",""],dev_prop_boolean:[1065,"bool",!1],dev_prop_int:[1066,"int",0],dev_prop_float:[1067,"float",0],order_details_from_cart_enabled:[1107,"bool",!1],order_details_custom_item_enabled:[1176,"bool",!1],order_details_from_catalog_enabled:[1212,"bool",!1],md_app_state_critical_data_processing_logging:[1187,"bool",!1],md_app_state_report_md_sync_mutation_stats:[1221,"bool",!1],order_management_enabled:[1188,"bool",!1],growth_lock_v0_enabled:[1204,"bool",!1],smart_filters_enabled_consumer:[1287,"bool",!1],smb_collections_enabled:[451,"bool",!1],consumer_collections_enabled:[582,"bool",!1],smb_collections_appeal_flow_enabled:[724,"bool",!1],smb_multi_device_awareness:[1074,"bool",!1],smb_quick_replies_v2_enabled:[875,"bool",!1],smb_ecommerce_compliance_india_m4:[1003,"bool",!1],smb_ecommerce_compliance_india_m4_5:[1192,"bool",!1],smart_filters_enabled:[1015,"bool",!1],btm_threads_logging_enabled:[1022,"bool",!1],native_commerce_threads_logging_enabled:[1034,"bool",!1],threads_logging_observe_list_enabled:[1168,"bool",!1],smb_hide_unsupported_currency_price:[1203,"bool",!1],hyperlinked_phone_numbers_enabled:[1215,"bool",!1],smb_catkit_query_version:[1229,"int",1],smb_phase_out_not_a_business:[1263,"bool",!1],smb_threads_logging_enabled:[1251,"bool",!1],smb_click_to_chat_logging_enabled:[1252,"bool",!1],smb_broadcast_logging_enabled:[1253,"bool",!1],smb_status_logging_enabled:[1254,"bool",!1],smb_biz_profile_logging_enabled:[1255,"bool",!1],smb_registration_flow_logging_enabled:[1256,"bool",!1],qpl_enabled:[212,"bool",!1],qpl_upload_delay:[215,"int",1440],qpl_sampling_as_string:[466,"string",'json:{"sampling":[]}'],qpl_initial_upload_delay:[1223,"int",5],should_deregister_on_syncd_fatal:[383,"bool",!0],group_catch_up:[559,"bool",!1],web_abprop_ctwa_context_compose_enabled:[591,"bool",!1],web_abprop_group_description_length:[592,"int",0],web_abprop_ephemeral_messages_allowed_values:[593,"string","604800"],web_abprop_collections_display:[584,"bool",!1],web_abprop_collections_management:[585,"bool",!1],web_abprop_drop_full_history_sync:[600,"bool",!1],web_abprop_business_profile_incomplete_nux_banner:[710,"bool",!1],web_abprop_product_catalog_nux_banner:[711,"bool",!1],web_abprop_click_nux_banner_migration:[712,"bool",!1],web_abprop_ecommerce_compliance_india:[717,"bool",!1],web_abprop_edit_ecommerce_compliance_india:[826,"bool",!1],drop_last_name:[726,"bool",!1],web_abprop_catalog_icon_on_top_bar:[734,"bool",!1],web_abprop_collections_nux_banner:[741,"bool",!1],nfm_rendering_enabled:[760,"bool",!1],web_abprop_nux_cart_interstitial:[761,"bool",!1],web_abprop_business_profile_refresh_status_enabled:[763,"bool",!1],web_abprop_business_profile_refresh_linked_account_enabled:[764,"bool",!1],web_abprop_business_profile_refresh_edit_cover_photo_enabled:[765,"bool",!1],web_abprop_business_profile_refresh_cover_photo_view_enabled:[766,"bool",!1],elevated_important_msg:[809,"bool",!1],web_privacy_settings:[837,"bool",!1],web_privacy_settings_v2:[1226,"bool",!1],web_status_psa:[873,"bool",!1],web_status_psa_history_sync:[1095,"bool",!1],web_2fa:[1195,"bool",!1],web_abprop_stateful_enumeration_enabled:[887,"bool",!1],web_abprop_block_catalog_creation_ecommerce_compliance_india:[894,"bool",!1],web_sticker_store:[930,"bool",!1],web_proactive_prekeys_fetch_group_size_limit:[937,"int",0],web_favorite_stickers:[962,"bool",!1],web_orchestrator_enabled_version:[984,"string","default"],web_wam_v5_enabled:[1033,"bool",!1],web_ps_v3_enabled:[1114,"bool",!1],web_shop_storefront_message:[1053,"bool",!1],web_identity_store_cache:[1078,"bool",!1],web_abprop_large_files_encryption_optimization:[1086,"bool",!1],web_send_invisible_msg_to_new_groups:[1099,"bool",!1],web_send_invisible_msg_min_group_size:[1100,"int",128],web_init_chat_batch_size:[1171,"int",100],web_init_chat_max_unread_message_count:[1172,"int",0],web_abprop_skip_file_copy_on_attach:[1174,"bool",!1],reaction_history_sync:[1179,"bool",!1],web_abprop_screen_sharing_enabled:[1189,"bool",!1],web_graphql_for_catalog_m1:[1205,"bool",!1],web_abprop_config_experiment_test:[1217,"bool",!1],web_adaptive_offline_resume_enabled:[1224,"bool",!1],web_wa_signal_enabled:[1225,"bool",!1],web_gdpr_request_account_info_enabled:[1232,"bool",!1],web_new_compose_box_input:[1243,"bool",!1],web_abprop_document_resume_upload:[1247,"bool",!1],stop_abprops_traffic_in_serverprops_response:[315,"bool",!1],enable_biz_activity_report_request:[455,"bool",!1],plm_products_max_batch_fetch_size:[464,"int",18],enable_granular_reject_reasons:[550,"bool",!1],elevating_profile_names_enabled:[604,"bool",!1],enable_group_profile_editor:[689,"bool",!1],csat_message_rating:[690,"bool",!1],facebook_link_preview_use_thumbnail:[810,"bool",!1],tam_attachment_cache_compaction_enabled:[838,"bool",!1],business_threads_logging_enabled:[853,"bool",!1],private_stats_biz_view_logging_enabled:[904,"bool",!1],no_delete_message_time_limit:[1011,"bool",!1],admin_revoke_receiver:[1177,"bool",!1],admin_revoke_sender:[1292,"bool",!1],admin_revoke_history_sync_consumer:[1245,"bool",!1],admin_hfm_toggle:[1021,"bool",!1],csat_message_trigger:[1082,"bool",!1],graphql_privacy_imp_m1:[1096,"bool",!1],lthash_check_hours:[1104,"int",0],interactive_message_native_flow_killswitch:[1133,"bool",!1],sender_key_expired_logging_enabled:[1185,"bool",!1],client_group_participants_limit:[618,"int",257],payment_stickers_render_enabled:[812,"bool",!1],privacy_allow_contacts_except:[808,"bool",!1],primary_feature_sync:[1063,"bool",!1],privacy_narrative_v1:[1071,"bool",!1],sticker_md_favorite_stickers_enabled:[864,"bool",!1]}},18018:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.compareServerPropsAndABProps=function(){new Map([["web_abprop_ctwa_context_compose_enabled",["ctwaContextCompose",s.ServerProps.ctwaContextCompose]],["web_abprop_group_description_length",["groupDescLength",s.ServerProps.groupDescLength]],["web_abprop_ephemeral_messages_allowed_values",["ephemeralMessagesAllowedValues",s.ServerProps.ephemeralMessagesAllowedValues]]]).forEach(((e,t)=>{const r=(0,i.getABPropConfigValue)(t);new a.default.WebcAbpropsValidation({abpropName:t,abpropValue:String(r),serverPropName:String(e[0]),serverPropValue:String(e[1])}).commit()}))};var i=r(86945),a=n(r(11339)),s=r(64551)},64971:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABKey=function(){const e=l();return null==e?void 0:e.abKey},t.getHash=function(){const e=l();return null==e?void 0:e.hash},t.getLastSyncTime=function(){const e=l(),t=null==e?void 0:e.lastSyncTime;if(null==t)return null;return parseInt(t,10)},t.getRefresh=function(){var e;const t=l();return parseInt(null!==(e=null==t?void 0:t.refresh)&&void 0!==e?e:86400,10)},t.isABPropsAfterFirstSync=function(){return null!=l()},t.updateAttributesLocalStorage=function(e,t,r,n){var c,d;let u=null;null!=r&&(u=r,u<600?u=600:u>o&&(u=o));const p=l()||{},h={abKey:null!=e?e:p.abKey,hash:null!=t?t:p.hash,refresh:null!==(c=null===(d=u)||void 0===d?void 0:d.toString())&&void 0!==c?c:p.refresh,lastSyncTime:n};(0,i.default)(a.default,"localStorage").setItem(s.default.KEY_ABPROPS,JSON.stringify(h))};var i=n(r(45095)),a=n(r(92417)),s=n(r(75509));const o=604800;function l(){const e=(0,i.default)(a.default,"localStorage").getItem(s.default.KEY_ABPROPS);return null==e?null:JSON.parse(e)}},80024:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exposureKeys=t.accessedConfigs=void 0,t.updateGlobalExpoKey=function(){i.default.Global.set({expoKey:Array.from(s).join(",")})};var i=n(r(11339));const a=new Set;t.accessedConfigs=a;const s=new Set;t.exposureKeys=s},86945:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigCodeToName=void 0,t.clearABPropConfigs=function(){return p.reset()},t.getABPropConfigValue=h,t.getAllABPropConfigs=function(){return p.getAllConfigs()},t.updateABPropsFromStorage=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(34541),s=r(56042),o=r(7293),l=r(80024);const c=new Map;let d=!1;const u={};t.ABPropConfigCodeToName=u,Object.keys(s.ABPropConfigs).forEach((e=>{const[t]=s.ABPropConfigs[e];u[t]=e})),Object.freeze(u);const p={reset:()=>{c.clear(),l.accessedConfigs.clear(),l.exposureKeys.clear(),d=!1},bulkCreateOrReplace(e){let t=!1;e.forEach((e=>{c.set(e.configCode,e),!0===e.hasAccessed&&(l.accessedConfigs.add(e.configCode),null!=e.configExpoKey&&(l.exposureKeys.add(e.configExpoKey),t=!0))})),t&&(0,l.updateGlobalExpoKey)(),d=!0,h("web_abprop_config_experiment_test")},getConfigValue(e){var t;if(!d)return __LOG__(3)`[ABProps] configs need to be initialized before its first access, config code: ${e}`,null;if(c.get(e)&&!l.accessedConfigs.has(e)){var r;const t=null===(r=c.get(e))||void 0===r?void 0:r.configExpoKey;null==t||l.exposureKeys.has(t)||(l.exposureKeys.add(t),(0,l.updateGlobalExpoKey)()),l.accessedConfigs.add(e),(0,a.setConfigAccessed)(e)}return null===(t=c.get(e))||void 0===t?void 0:t.configValue},getAllConfigs:()=>Array.from(c.values())};function h(e){var t;o.GK.supportsFeature(o.GK.F.MD_BACKEND)||(__LOG__(4,!0,new Error,!0)`[ABProps] getABPropConfigValue() should not be called by non-MD build, config name: ${e}`,SEND_LOGS(`[ABProps] getABPropConfigValue() should not be called by non-MD build, config name: ${e}`));const r=s.ABPropConfigs[e],[n,i,a]=r;return null!==(t=p.getConfigValue(n))&&void 0!==t?t:a}function f(){return(f=(0,i.default)((function*(){try{const e=(yield(0,a.getABPropConfigs)()).map((e=>{const t=u[Number(e.configCode)];if(null!=t){const r=s.ABPropConfigs[t],[n,i,o]=r;return{configCode:n,configValue:(0,a.parseConfigValue)(e.configValue,i,o),configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed}}__LOG__(3)`[ABProps] ABProp (code: ${e.configCode}) exists in storage but no longer available for this client version`})).filter((e=>!!e));p.bulkCreateOrReplace(e)}catch(e){__LOG__(4,!0,new Error,!0)`[ABProps] Failed to update ABProps configs cache from storage`,SEND_LOGS("[ABProps] Failed to update ABProps configs cache from storage: "+e)}__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps Start ---`,c.forEach(((e,t)=>{__LOG__(2,void 0,void 0,void 0,["abprops"])`code: ${t}, name: ${u[e.configCode]}, value: ${e.configValue}, type: ${typeof e.configValue}`})),__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps End ---`}))).apply(this,arguments)}},10435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdminHfmToggleEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("admin_hfm_toggle"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.FREQUENTLY_FORWARDED_SETTING)},t.isDefaultDisappearingMessagesEnabled=function(){return i.GK.supportsFeature(i.GK.F.MD_BACKEND)&&(0,a.getABPropConfigValue)("web_privacy_settings_v2")},t.isDisappearingModeEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("disappearing_mode"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.DISAPPEARING_MODE)},t.isDropLastNameEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("drop_last_name"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.DROP_LAST_NAME_MENTIONS)},t.isElevatedImportantMessageEnabled=function(){var e;return!(!i.GK.supportsFeature(i.GK.F.MD_BACKEND)||!s())&&(null!==(e=(0,a.getABPropConfigValue)("elevated_important_msg"))&&void 0!==e&&e)},t.isEphemeral24HDurationEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("ephemeral_24h_duration"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.EPHEMERAL_24_H_DURATION)},t.isGroupCatchUpEnabled=s,t.isInAppSupportEnabled=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){if(!(0,a.getABPropConfigValue)("in_app_support_v2_enabled"))return!1;const e=(0,a.getABPropConfigValue)("in_app_support_v2_locale_langs");if(""===e)return!0;const t=new Set(e.split(",")),n=r(43725).default;return t.has(n.getLocale())}return i.GK.supportsFeature(i.GK.F.SUPPORT)},t.isNoDeleteMessageTimeLimitEnabled=function(){var e;return i.GK.supportsFeature(i.GK.F.MD_BACKEND)?null!==(e=(0,a.getABPropConfigValue)("no_delete_message_time_limit"))&&void 0!==e&&e:i.GK.supportsFeature(i.GK.F.NO_DELETE_MESSAGE_TIME_LIMIT)};var n=r(99234),i=r(7293),a=r(86945);function s(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){var e,t;const r=null!==(e=(0,n.getUnreadMentionCountEnabled)())&&void 0!==e&&e;return null!==(t=(0,a.getABPropConfigValue)("group_catch_up"))&&void 0!==t&&t&&r}return!1}},87845:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RangeContain=void 0,t.checkAndRemoveActiveMessageRanges=function(e,t){(0,i.getActiveMessageRanges)(e.remote.toString()).then((r=>{r.forEach((r=>{if([a.ActiveRangeAction.Archive,a.ActiveRangeAction.MarkChatAsRead].includes(r.action)&&o(r.actionValue.messageRange,{id:e,t})===s.DOES_NOT_CONTAIN)return(0,i.removeActiveMessageRange)(e.remote.toString(),r.action)}))}))},t.rangeContainsMessage=o;var n=r(8243),i=r(38342),a=r(69702);const s=r(54302).Mirrored(["DOES_NOT_CONTAIN","CONTAINS_BY_TIMESTAMP","CONTAINS_BY_ADDITIONAL"]);function o(e,t){if(null==e)return __LOG__(3)`syncd: missing message range from row.`,s.DOES_NOT_CONTAIN;const{messages:r,lastMessageTimestamp:i}=e;if(null!=t.t&&null!=i&&t.t<(0,n.numberOrThrowIfTooLarge)(i))return s.CONTAINS_BY_TIMESTAMP;const a=t.id;for(const{key:e}of r)if(null!=e&&null!=a&&e.id===a.id)return s.CONTAINS_BY_ADDITIONAL;return s.DOES_NOT_CONTAIN}t.RangeContain=s},15421:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(73955)),a=r(22683),s=r(64457);var o=new class{constructor(){this._alarms=new Map;const e=()=>{this._alarms.size>0&&this._validateTimeouts()};s.jsHaltDetector.on(s.JS_HALT_EVENT,e),s.jsHaltDetector.on(s.CLOCK_CHANGE_BACKWARDS_EVENT,e),a.Clock.on(a.SKEW_CHANGE_EVENT,this._resetGlobalTimeouts.bind(this))}setLocalTimeout(e,t,r){return this._setTimeout(!1,e,t,r)}setGlobalTimeout(e,t,r){return this._setTimeout(!0,e,t,r)}clearTimeout(e){if(!e)return;const t=this._alarms.get(e);t&&(window.clearTimeout(t.timeoutId),this._alarms.delete(e))}_setTimeout(e,t,r,n){n&&this.clearTimeout(n);const a=n||(0,i.default)("alarm_timer_"),o=r-this._getTimeInMS(e),l=Math.min(o,2147483647);if(o<0)return __LOG__(2)`Alarm:setTimeout:Cannot set alarm in the past.`,t(),a;const c=window.setTimeout((()=>{r-this._getTimeInMS(e)<s.DEFAULT_THRESHOLD?(this._alarms.delete(a),t()):this._setTimeout(e,t,r,a)}),l);return this._alarms.set(a,{isGlobal:e,fn:t,expiration:r,timeoutId:c}),a}_validateTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:r,fn:n,expiration:i}=e;i<this._getTimeInMS(r)?(this.clearTimeout(t),n()):this._setTimeout(r,n,i,t)}))}_resetGlobalTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:r,fn:n,expiration:i}=e;r&&this._setTimeout(r,n,i,t)}))}_getTimeInMS(){return 1e3*(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?a.Clock.globalUnixTime():a.Clock.localUnixTime())}};t.default=o},65351:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=void 0;t.URL="https://web.whatsapp.com/"},88711:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APICmd=void 0,t.isWAURL=function(e){return r.test(e)};t.APICmd={GROUP_INVITE:"GROUP_INVITE",MSG_SEND:"MSG_SEND",INVALID:"INVALID",CATALOG:"CATALOG",PRODUCT:"PRODUCT"};const r=/^whatsapp:\/\/.*/i},7111:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.matchProductUrl=t.matchCatalogUrl=void 0,t.parseAPICmd=function(e){if("string"!=typeof e)return{resultType:o.APICmd.INVALID,data:void 0};const t=(e=>{let t=e.match(u);if(t)return{code:t[2],url:t[1]||"/"};if(t=e.match(p),t)return{code:t[1]};if(t=e.match(h),t)return{code:t[1]};if(t=e.match(f),t)return{code:t[1]}})(e);if(t)return{resultType:o.APICmd.GROUP_INVITE,data:t};const r=function(e){let t=e.match(O)||e.match(I);if(t)return R(t);if(t=e.match(w),t)return(0,i.default)((0,i.default)({},R(t)),{},{url:"/"})}(e);if(r)return{resultType:o.APICmd.CATALOG,data:r};const n=function(e){let t=M(e,C);if(t)return D(t);if(t=M(e,b),t)return(0,i.default)((0,i.default)({},D(t)),{},{url:"/"})}(e);if(n)return{resultType:o.APICmd.PRODUCT,data:n};const a=(e=>{let t=e.match(y);if(t){const e=g(t[2]);if(e)return e.url=t[1]||"/",e}if(t=e.match(E),t)return g(t[1]);if(t=e.match(S),t)return g(t[1]);if(t=e.match(v),t){let e;if(t[1]&&(e={phone:`${t[1]}@c.us`}),t[2]){const r=g(t[2]);r&&(e=(0,i.default)((0,i.default)({},e),r))}return e}})(e);if(a)return{resultType:o.APICmd.MSG_SEND,data:a};return{resultType:o.APICmd.INVALID,data:void 0}},t.parseConversionData=m;var i=n(r(81109)),a=r(8584),s=r(65351),o=r(88711),l=n(r(23082));const c=(d=s.URL,d.replace(/\/+$/,"")).replace(/[\/\.]/g,"\\$&");var d;const u=new RegExp(`^${c}((?:/\\w+)*)/accept/?\\?code=(\\w+)$`,"i"),p=/^https?:\/\/chat\.whatsapp\.com\/invite\/(\w+)$/i,h=/^https?:\/\/chat\.whatsapp\.com\/(\w+)$/i,f=/^whatsapp:\/\/chat\/?\?code=(\w+)$/i,_={text:"text",phone:"phone",data:"data",source:"source",context:"context",icebreaker:"icebreaker",source_url:"source_url"};function m(e){if(!e||"string"!=typeof e)return;const t=a.Binary.build(e);return t.size()>512?void 0:t.readBuffer()}function g(e){const t={};if(new l.default(e).forEach(((e,r)=>{const n=r.toLowerCase();if(n===_.data){const r=m(e);if(!r)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionData=r}else if(n===_.source){const r=e;if((0,a.numUtf8Bytes)(r)>32)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionSource=r}else n===_.source_url?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.sourceUrl=e):n===_.context?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.context=e):n===_.icebreaker?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.icebreaker=e):_[n]&&(t[n]=e)})),t.phone&&(t.phone=t.phone.replace(/\D/g,"")+"@c.us",t.ctwaContextLinkData&&(t.ctwaContextLinkData.phone=t.phone)),t.phone||t.text)return t}const y=new RegExp(`^${c}((?:/\\w+)*)/send/?\\?(.+)$`,"i"),E=/^https?:\/\/api\.whatsapp\.com\/send\/?\?(.+)$/i,S=/^whatsapp:\/\/send\/?\?(.*)$/i,v=/^https?:\/\/wa\.me\/?([0-9]{0,20})?\/?\??(.+)?$/i,T=new RegExp(`^${c}(?:(?:/\\w+)*)/product/([0-9]{0,20})/([0-9]{0,20})$`,"i"),A=new RegExp(`^${c}(?:(?:/\\w+)*)/product/([^/]{0,200})/([0-9]{0,20})$`,"i"),C=[/^https?:\/\/wa\.me\/p\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^https?:\/\/wa\.me\/p\/([^\/]{0,200})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([^\/]{0,200})\/([0-9]{0,20})$/i],b=[T,A],P=[...C,...b];function M(e,t){for(let r=0;r<t.length;r++){const n=e.match(t[r]);if(n)return n}}t.matchProductUrl=e=>null!=M(e,P);const O=/^https?:\/\/wa\.me\/c\/([0-9]{0,20})$/i,I=/^whatsapp:\/\/catalog\/([0-9]{0,20})$/i,w=new RegExp(`^${c}(?:(?:/\\w+)*)/catalog/([0-9]{0,20})$`,"i");t.matchCatalogUrl=e=>[O,I,w].some((t=>e.match(t)));function R(e){return{catalogOwnerJid:`${e[1]}@s.whatsapp.net`}}function D(e){return{productId:e[1],businessOwnerJid:`${e[2]}@s.whatsapp.net`}}},63064:(e,t,r)=>{"use strict";var n=r(95318);t.Z=void 0;var i=n(r(48926)),a=r(40265),s=r(50796),o=r(38284),l=n(r(15421)),c=r(99234),d=n(r(73289)),u=r(65044);const p=r(49036).default,h=6e5,f="init",_="ping",m="pong",g="local-takeover";var y=new class{init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,i.default)((function*(){const r=t+1;if(r>3)return!0;const n=(0,c.getNoTakeover)();(0,c.setNoTakeover)(),u.Socket.preload();if(yield e._pingForOtherLocalSession())return e._updateMutex(),yield(0,d.default)(!n),!1;if(n)return!0;throw r}))()}takeoverLocal(e){return(0,c.getMutex)()?((0,c.setMutex)(g),(0,o.promiseTimeout)(p(window,"storage",c.takeoverFilter),3e4,"takeoverLocalTimeout").then((t=>{const r=(0,c.parseTakeover)(t.newValue);return(0,c.getRememberMe)()||(0,c._setAllKeyValues)(r),u.Socket.mustExitLoop=!1,(0,c.removeMutex)(),this.init(e)})).catch((0,s.filteredCatch)(a.TimeoutError,(()=>(__LOG__(3)`app:takeoverLocal timeout`,u.Socket.mustExitLoop=!1,(0,c.removeMutex)(),this.init(e)))))):this.init(e)}unloadMutex(){const e=(0,c.getMutex)();e&&this._ourMutex&&e.includes(this._ourMutex)&&(0,c.removeMutex)()}storagePong(e){if(!(0,c.mutexFilter)(e))return;const t=(0,c.parseMutex)(e.newValue);return t?t===g?(this._clearMutexTimer(),u.Socket.exitLoop(),(0,c.localTakeoverSuccess)(),!0):void(0===t.indexOf(_)&&(0,c.setMutex)(m+Math.random())):void 0}_clearMutexTimer(){this._updateMutexTimerID&&l.default.clearTimeout(this._updateMutexTimerID)}_updateMutex(){this._clearMutexTimer();const e=Date.now();(0,c.setMutex)(this._ourMutex=f+"_"+e),this._updateMutexTimerID=l.default.setLocalTimeout(this._updateMutex.bind(this),e+h)}_pingForOtherLocalSession(){let e=(0,c.getMutex)();if(e){e+="";let t=1e4;if(e.indexOf("_")>0){const r=e.split("."),n=parseInt(r[r.length-1],10);if(Number.isFinite(n)){n<Date.now()-9e5&&(__LOG__(2)`app:_pingForOtherLocalSession stale mutex`,t=1e3)}}const r=(0,o.promiseTimeout)(p(window,"storage",c.mutexFilter),t,"waitForOtherLocalSessionTimeout").then((()=>!1)).catch((0,s.filteredCatch)(a.TimeoutError,(function(){return __LOG__(3)`app:_pingForOtherLocalSession mutex timeout`,!0})));return(0,c.setMutex)(_+Math.random()),r}return Promise.resolve(!0)}};t.Z=y},54958:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldEnableArchiveV2=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return!1;const e=r(69951).ChatCollection.filter((e=>e.archive));return(0,a.archiveV2Supported)()&&!o.default.archive.enabled&&1===e.length},t.shouldUnarchiveChat=function(e){if((0,a.archiveV2Supported)()){if(o.default.showArchiveV2)return!1;if(!i.GK.supportsFeature(i.GK.F.MD_BACKEND)&&!o.default.archive.enabled&&!e)return(0,s.setArchiveEnabledSetting)(!0),!1}return!0},t.shouldUnarchiveChatOnReaction=function(e,t,r){if(e&&!t&&""!==r)return!(0,a.archiveV2Supported)()||!o.default.showArchiveV2;return!1};var i=r(7293),a=r(57701),s=r(92052),o=n(r(68132))},97401:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.asyncSleep=s,t.asyncSleepAfterGivenLoopIteration=function(){return a.apply(this,arguments)};var i=n(r(48926));function a(){return(a=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;e>0&&e%t==0&&(yield s(r))}))).apply(this,arguments)}function s(e){return new Promise((t=>setTimeout(t,e)))}},76716:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MainAudioChannel=void 0;var i=n(r(34342));class a extends i.default{registerMedia(e){let t=null;const r=()=>{t=this.claim(e,(()=>{e.pause()}))},n=()=>{var e;null===(e=t)||void 0===e||e()};return e.addEventListener("play",r),e.addEventListener("pause",n),()=>{var i;null===(i=t)||void 0===i||i(),e.removeEventListener("play",r),e.removeEventListener("pause",n)}}claim(e,t){const r=this._active;return null!=r&&e!==r.key&&(r.pause(),this.trigger("paused_DEPRECATED_DO_NOT_USE",r.key)),this._active={key:e,pause:t},()=>{var t;e===(null===(t=this._active)||void 0===t?void 0:t.key)&&(this._active=null)}}}const s=new a;t.MainAudioChannel=s},71386:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OUTPUT_DEVICES=t.AudioSessionManager=t.AudioSession=t.AUDIO_EVENTS=void 0;var i=n(r(34342));t.AUDIO_EVENTS={OUTPUT_ROUTES_CHANGED:"OUTPUT_ROUTES_CHANGED"};t.OUTPUT_DEVICES={UNKNOWN:0,LINE_OUT:1,HEADPHONES:2,BLUETOOTH:3,INTERNAL_RECEIVER:4,INTERAL_SPEAKER:5,HDMI:6,REMOTE:7,BLUETOOTH_LE:8,BLUETOOTH_HANDS_FREE:9,USB:10,CAR:11};t.AudioSession=class{startUse(){}endUse(){}};class a extends i.default{startAudioSession(){}isRoutingToOutput(){return!1}get isRoutingToSpeaker(){return null}get outputRoutes(){return[]}get isBluetoothInputAvailable(){return null}overrideOutputRoute(){return Promise.resolve()}}const s=new a;t.AudioSessionManager=s},44933:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.b64Equal=function(e,t){const r=e.length,n=t.length;switch(r-n){case-2:return 61===t.charCodeAt(r)&&61===t.charCodeAt(r+1)&&t.substr(0,r)===e;case-1:return 61===t.charCodeAt(r)&&t.substr(0,r)===e;case 0:return e===t;case 1:return 61===e.charCodeAt(n)&&e.substr(0,n)===t;case 2:return 61===e.charCodeAt(n)&&61===e.charCodeAt(n+1)&&e.substr(0,n)===t;default:return!1}}},16870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=atob(e);let n=0;for(let e=0;e<r.length;e++){const i=r.charCodeAt(e);n=((n<<4)+(i>>4))%t,n=((n<<4)+(15&i))%t}return n}},75642:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e)return null;const t=e.replace(/\s+$/,"");e!==t&&Math.random()<.001&&(__LOG__(3,void 0,void 0,!0)`base64 sanitized due to extra whitespace`,SEND_LOGS("media-key-sanitize"));return t}},19027:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}},63454:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JS_HALT_EVENT=t.CLOCK_CHANGE_BACKWARDS_EVENT=t.BaseJsHaltDetector=void 0;var i=n(r(34342));const a="js_halt";t.JS_HALT_EVENT=a;const s="clock_change_backwards";t.CLOCK_CHANGE_BACKWARDS_EVENT=s;class o extends i.default{constructor(e,t){super(),this._interval=e,this._threshold=t}startDetection(){if(this._intervalId)return;let e=Date.now();this._intervalId=setInterval((()=>{const t=Date.now(),r=t-e-this._interval;r>this._threshold?this.trigger(a,r):r<-this._threshold&&this.trigger(s,r),e=t}),this._interval),__LOG__(2)`JsHaltDetector:detection started`}stopDetection(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null,__LOG__(2)`JsHaltDetector:detection stopped`)}restartDetection(){this.stopDetection(),this.startDetection(),__LOG__(2)`JsHaltDetector:detection restarted`}}t.BaseJsHaltDetector=o},15001:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){if(e<=0)throw new RangeError("BitArray:numBits should be positive");this._numBits=e,this._array=new Uint8Array(Math.ceil(this._numBits/8))}get(e){const[t,r]=this._getArrayIndexOffset(e);return Boolean(this._array[t]>>r&1)}set(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]|=1<<r}unset(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]&=~(1<<r)}toggle(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]^=1<<r}clear(){this._array=new Uint8Array(Math.ceil(this._numBits/8))}toArray(){const e=[];for(let t=0;t<this._numBits;t++)e.push(this.get(t));return e}toString(){return this.toArray().map((e=>e?"1":"0")).join("")}get length(){return this._numBits}_getArrayIndexOffset(e){if(e<0||e>=this._numBits)throw new RangeError("BitArray:index out of bounds");const t=Math.floor(e/8);return[t,e-8*t]}}},92115:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=t.BIZ_SYSTEM_MSG_SUBTYPES_V2=t.BIZ_SYSTEM_MSG_SUBTYPES=void 0;t.BIZ_SYSTEM_MSG_SUBTYPES=["blue_msg_bsp_fb_to_bsp_premise","blue_msg_bsp_fb_to_self_fb","blue_msg_bsp_fb_to_self_premise","blue_msg_bsp_fb_unverified","blue_msg_bsp_fb_unverified_to_bsp_premise_verified","blue_msg_bsp_fb_unverified_to_self_fb_verified","blue_msg_bsp_fb_unverified_to_self_premise_verified","blue_msg_bsp_fb_verified","blue_msg_bsp_fb_verified_to_bsp_premise_unverified","blue_msg_bsp_fb_verified_to_self_fb_unverified","blue_msg_bsp_fb_verified_to_self_premise_unverified","blue_msg_bsp_premise_to_self_premise","blue_msg_bsp_premise_unverified","blue_msg_bsp_premise_unverified_to_self_premise_verified","blue_msg_bsp_premise_verified","blue_msg_bsp_premise_verified_to_self_premise_unverified","blue_msg_consumer_to_bsp_fb_unverified","blue_msg_consumer_to_bsp_premise_unverified","blue_msg_consumer_to_self_fb_unverified","blue_msg_consumer_to_self_premise_unverified","blue_msg_self_fb_to_bsp_premise","blue_msg_self_fb_to_self_premise","blue_msg_self_fb_unverified","blue_msg_self_fb_unverified_to_bsp_premise_verified","blue_msg_self_fb_unverified_to_self_premise_verified","blue_msg_self_fb_verified","blue_msg_self_fb_verified_to_bsp_premise_unverified","blue_msg_self_fb_verified_to_self_premise_unverified","blue_msg_self_premise_to_bsp_premise","blue_msg_self_premise_unverified","blue_msg_self_premise_verified","blue_msg_to_bsp_fb","blue_msg_to_consumer","blue_msg_to_self_fb","blue_msg_unverified_to_bsp_fb_verified","blue_msg_unverified_to_bsp_premise_verified","blue_msg_unverified_to_self_fb_verified","blue_msg_unverified_to_verified","blue_msg_verified_to_bsp_fb_unverified","blue_msg_verified_to_bsp_premise_unverified","blue_msg_verified_to_self_fb_unverified","blue_msg_verified_to_unverified"];const r=["biz_privacy_mode_init_fb","biz_privacy_mode_init_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=r;const n=[...r,"biz_privacy_mode_to_fb","biz_privacy_mode_to_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2=n},31912:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemParentType=void 0;const n=r(54302).Mirrored(["Chat","Contact","Msg"]);t.LabelItemParentType=n},905:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addToLabelCollection=a,t.createLabelItemId=o,t.getParentCollection=function(e){switch(e){case i.LabelItemParentType.Chat:return r(69951).ChatCollection;case i.LabelItemParentType.Contact:return r(19380).ContactCollection;case i.LabelItemParentType.Msg:return r(59871).MsgCollection}},t.getParentTypeFromModel=s,t.initializeLabels=function(e){const t=s(e);if(n.GK.supportsFeature(n.GK.F.MD_BACKEND))e.labels=r(16770).LabelCollection.getLabelsForModel(e.id.toString(),t);else{const r=()=>{a(e.id.toString(),e.labels,t)};r(),e.listenTo(e,"change:labels",r)}},t.removeLabelFromCollection=function(e,t,a){const s=r(16770).LabelCollection.get(t),l=null==s?void 0:s.labelItemCollection;if(!l)return void __LOG__(3)`labelItemCollection does not exist for lableId ${t}`;l.remove(o(e,t,a)),n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&a===i.LabelItemParentType.Chat&&l.remove(o(e,t,i.LabelItemParentType.Contact))};var n=r(7293),i=r(31912);function a(e,t,a){if(t&&t.length>0){const s=r(16770).LabelCollection;t.forEach((t=>{const r=s.gadd({id:t});r.labelItemCollection.gadd({id:o(e,t,a),labelId:t,parentId:e,parentType:a}),n.GK.supportsFeature(n.GK.F.MD_BACKEND)&&a===i.LabelItemParentType.Chat&&r.labelItemCollection.gadd({id:o(e,t,i.LabelItemParentType.Contact),labelId:t,parentId:e,parentType:i.LabelItemParentType.Contact})}))}}function s(e){if(e instanceof r(63183).Chat)return i.LabelItemParentType.Chat;if(e instanceof r(121).default)return i.LabelItemParentType.Contact;if(e instanceof r(17304).Msg)return i.LabelItemParentType.Msg;throw new Error("getParentTypeFromModel: model is invalid")}function o(e,t,r){return`${e}_${t}_${r}`}},69340:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){return JSON.parse(e)},t.stringify=function(e){return JSON.stringify(e)}},43390:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.businessHoursFromConfig=d,t.dayToWeekday=c,t.getBusinessHours=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{config:r}=e,n=(new Date).getDay(),i=s.DAYS_OF_WEEK.map(((e,i)=>{const a=(n+i)%s.DAYS_OF_WEEK.length,o=s.DAYS_OF_WEEK[a];return{day:c(a),hours:d(r[o],t).toString(),first:0===i}}));return i},t.getBusinessHoursForEdit=function(e){const t=null==e?{}:e.config,{note:r,timezone:n}=e||{};let i;const o=s.DAYS_OF_WEEK.map(((e,r)=>{const n=t[e],s=a.default.weekdays(r);let o;return n&&(i=n.mode,n.hours&&(o=n.hours.map((e=>{let[t,r]=e;return[(0,l.minutesToTime)(t),(0,l.minutesToTime)(r)]})))),{dayName:s,dayKey:e,closed:!n,hours:o}})),c=a.default.weekdays(!0,0),d=a.default.weekdays().indexOf(c),u=o.splice(d);return{mode:i,days:[...u,...o],timezone:n,note:r}},t.getWebsiteLink=function(e){return`https://l.wl.co/l?u=${encodeURIComponent(e)}`},Object.defineProperty(t,"minutesToTime",{enumerable:!0,get:function(){return l.minutesToTime}}),Object.defineProperty(t,"timeStringToMinutes",{enumerable:!0,get:function(){return l.timeStringToMinutes}});var i=n(r(48360)),a=n(r(30381)),s=r(93170),o=n(r(43725)),l=r(84918);function c(e){return a.default.weekdays(e)}function d(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(null==e?void 0:e.mode){case s.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:return t?p(null==e?void 0:e.hours):u(null==e?void 0:e.hours);case s.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:return i.default._("By appointment only",null,{hk:"e1vew"});case s.BUSINESS_HOUR_MODES.OPEN_24H:return i.default._("Open 24 hours",null,{hk:"1AlfF5"});default:return i.default._("Closed",null,{hk:"3IRgct"})}}function u(e){return e?e.map((e=>e.map(l.minutesToTime).join(" - "))).join("\n"):""}function p(e){if(1===(null==e?void 0:e.length))return e[0].map(l.minutesToTime).join(" - ");if(2===(null==e?void 0:e.length)){const t=(0,l.minutesToTime)(e[0][0]),r=(0,l.minutesToTime)(e[0][1]),n=(0,l.minutesToTime)(e[1][0]),i=(0,l.minutesToTime)(e[1][1]);return o.default.t(250,{openTime:t,closeTime:r,additionalOpenTime:n,additionalCloseTime:i})}return""}},84918:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.minutesToTime=function(e){return i.default.utc().startOf("day").add(e,"minutes").format(a.Clock.timestampStrFormat())},t.timeStringToMinutes=void 0;var i=n(r(30381)),a=r(22683);const s=["h:mm A","h:mmA","HH:mm","HH.mm","H:mm","H.mm"];t.timeStringToMinutes=e=>{let t;const r=e.trim();if(!r)return;for(const e of s){const n=(0,i.default)(r,e,!0);if(n.isValid()){t=n;break}}if(!t)return;const n=t,a=(0,i.default)().startOf("day"),o=n.diff(a);return i.default.duration(o).asMinutes()}},48277:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(81109)),s=r(13959),o=r(92844),l=r(41075),c=r(10823),d=n(r(87045)),u=r(88102),p=r(17186),h=r(45606),f=r(10058),_=n(r(73407)),m=r(15998),g=n(r(52991)),y=r(40126),E=r(41037),S=r(83578),v=r(49801),T=n(r(11339)),A=r(58052),C=r(24872),b=r(74028),P=r(38804),M=r(89751),O=r(15772),I=r(65044);const w=r(54302).Mirrored(["NotStarted","InProcess","Completed"]),R={initialChatHistory:!1,readReceipts:!1,syncdCritical:!1},D={initialChatHistoryTotalMsg:-1,initialChatHistoryTotalChats:-1};const N=new class{constructor(){this._criticalState={},this._debugOnlyState={},this._progressiveHistorySyncRemainingIteration=25,this._progressiveHistorySyncInFlight=!1,this._allCriticalDataSynced=!1,this._syncDCriticalDataTimeout=null,this.initState()}initState(){this._criticalState=(0,a.default)({},R),this._debugOnlyState=(0,a.default)({},D),this._syncDCritcalDataState=w.NotStarted}_isCriticalSyncDoneThisSession(){for(const e in this._criticalState)if(!this._criticalState[e])return!1;return!0}_setSynced(e){__LOG__(2)`[bootstrap] completed sync for ${e}`,this._criticalState[e]=!0,this._isCriticalSyncDoneThisSession()&&(__LOG__(2)`[bootstrap] critical sync done`,(0,A.setAllCriticalDataSynced)(),u.Cmd.criticalSyncDone(),g.default.initOrUpdateTracking(T.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),this.syncNonCriticalData())}_syncContactsInChunks(e,t){return(0,i.default)((function*(){__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${e?t.length+1:0} chunks of contacts during the inital sync`,null!=e&&(yield(0,f.syncContactListJob)(Array.from(e),!1));for(let e=0;e<t.length;e++){const r=Array.from(t[e]);yield(0,s.delayMs)(2e4),yield(0,f.syncContactListJob)(r)}__LOG__(2,void 0,void 0,void 0,["contact-sync"])`inital contact sync completes`}))()}_syncDeviceList(e){if(null==e)return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`syncMostRecentDevices has no contact to sync during bootstrap`,Promise.resolve();__LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync ${e.size} contacts for device info during the initial sync`;const t=Array.from(e);return(0,c.syncDeviceListJob)(t,null,null).catch((e=>{__LOG__(4,!0,new Error,!0)`Sync device failed`,SEND_LOGS("Sync device failed: "+e)}))}setReadReceiptsSynced(){this._setSynced("readReceipts")}setInitialChatHistorySynced(){this._setSynced("initialChatHistory")}setSyncDCriticalSynced(){this._criticalState.syncdCritical||this._setSynced("syncdCritical")}syncNonCriticalData(){let e=[];(0,b.queryAndUpdateAllGroupMetadata)().then((()=>{e=(0,C.getAllContactsFromChatCollectionIntoChunks)(),this._syncDeviceList(e[0]),(0,C.getAndUpdateNonAddressBookContacts)()})).then((()=>{setTimeout(function(){this._syncContactsInChunks(e[0],e.slice(1,e.length))}.bind(this),4e4)})),(0,y.getAndUpdateStatus)(),(0,l.getAndUpdateProfilePicture)(),(0,l.updateBlocklist)(),(0,P.markCollectionsForSync)([h.CollectionName.Regular,h.CollectionName.RegularLow,h.CollectionName.RegularHigh])}markInitialHistorySyncCountDebugStats(e,t){this._debugOnlyState={initialChatHistoryTotalMsg:e,initialChatHistoryTotalChats:t}}isSyncDCriticalDataSyncInProcess(){return this._syncDCritcalDataState===w.InProcess}_initCriticalDataTimeoutIfNeeded(){var e=this;null==this._syncDCriticalDataTimeout&&(__LOG__(2)`[bootstrap] setting critical data syncd timeout (${180})`,this._syncDCriticalDataTimeout=setTimeout((0,i.default)((function*(){(yield e._isSyncDCriticalDataComplete())||(__LOG__(2)`[bootstrap] syncd critical data timeout exceeded, logging out`,yield(0,O.forceFlushAllWamBuffers)(),(0,p.triggerCriticalSyncLogout)()),(0,A.getInitialHistorySyncComplete)()||(__LOG__(2)`[bootstrap] history sync critical data timeout exceeded, logging out`,yield(0,O.forceFlushAllWamBuffers)(),(0,p.triggerCriticalSyncLogout)()),__LOG__(2)`[bootstrap] all critical data synced within timeout period`})),18e4))}_isSyncDCriticalDataComplete(){return(0,i.default)((function*(){const e=yield _.default.getSyncActionsRows(["action"],[h.Actions.SettingPushName]);return e.length>0&&null!=e.find((e=>e.actionState===h.SyncActionState.Success))}))()}setSyncDCriticalDataSyncCompleted(){var e=this;return(0,i.default)((function*(){null!=e._syncDCriticalDataTimeout&&(yield new T.default.MdBootstrapDataApplied({mdBootstrapPayloadType:T.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL,mdBootstrapSource:T.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield v.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,o.unixTimeMs)()}).commit(!0)),e._syncDCritcalDataState=w.Completed}))()}getCriticialSyncDebugSummary(){return(0,A.getAllCriticalDataSynced)()?"-------\nAll critical data synced\n-------\n\n":`-------\n Initial history sync complete: ${(0,A.getHistorySyncStatus)()?"true":this._criticalState.initialChatHistory.toString()}\n Initial msgs: ${this._debugOnlyState.initialChatHistoryTotalMsg}, initial chats: ${this._debugOnlyState.initialChatHistoryTotalChats}\n Receipt sync complete: ${this._criticalState.readReceipts.toString()} \n Critical collection sync complete: ${this._criticalState.syncdCritical.toString()} \n-------\n`}syncCriticalDataIfNeeded(){var e=this;return(0,i.default)((function*(){if(e._allCriticalDataSynced=(0,A.getAllCriticalDataSynced)(),e._allCriticalDataSynced)__LOG__(2)`[bootstrap] need to sync critical data: false`;else{g.default.initOrUpdateTracking(T.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),__LOG__(2)`[bootstrap] need to sync critical data: true`,__LOG__(2)`[bootstrap] ${e.getCriticialSyncDebugSummary()}`,__LOG__(2)`[bootstrap] syncing my device list`;const t=(0,c.syncMyDeviceListJob)(),r=(0,l.updatePrivacySettings)().then((()=>{e.setReadReceiptsSynced()})).catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync privacy settings ${e.stack}`,SEND_LOGS("failed to update privacy settings from privacy request to webd"),I.Socket.logout(!1,S.LogoutReason.AccountSyncError)}));(0,M.updateSyncdDisabledDueToFatalFlag)(!1),e._initCriticalDataTimeoutIfNeeded(),e._syncDCritcalDataState=w.InProcess;const n=t.then((()=>(0,P.markCollectionsForSync)([h.CollectionName.CriticalBlock,h.CollectionName.CriticalUnblockLow]))).then((0,i.default)((function*(){e._criticalState.syncdCritical||(yield e._isSyncDCriticalDataComplete())&&(e.setSyncDCriticalSynced(),yield e.setSyncDCriticalDataSyncCompleted())})));(0,A.getInitialHistorySyncComplete)()&&e.setInitialChatHistorySynced();const a=(0,l.updateDefaultDisappearingMode)().catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync default disappearing mode ${e.stack}`,SEND_LOGS("failed initial sync of default disappearing mode")}));yield Promise.all([r,n,a])}}))()}continueProgressiveHistorySyncProcessing(){__LOG__(2)`[history sync] continueProgressiveHistorySyncProcessing`;const e="Safari"!==d.default.info().name;this._initNextProgressiveHistorySyncRunLoop(e)}_progressiveHistorySyncRun(){var e=this;return(0,i.default)((function*(){if(!e._allCriticalDataSynced&&!0!==e._criticalState.initialChatHistory)return __LOG__(2)`[history sync] Skip processLoop, until initial sync is complete`,void e._progressiveHistorySyncRemainingIteration++;if(!u.Cmd.isMainStreamReadyMd)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Skip processLoop, until main is loaded`,void e._progressiveHistorySyncRemainingIteration++;const t=yield(0,E.fetchNextHitorySyncChunkForProcessing)();if(!t)return;__LOG__(2)`[history sync] processLoop picked up chunk`,e._progressiveHistorySyncRemainingIteration++;const n=r(19655).handleHistorySyncChunk;yield n(t)}))()}_initNextProgressiveHistorySyncRunLoop(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,i.default)((function*(){if(t&&e._progressiveHistorySyncRemainingIteration++,!e._progressiveHistorySyncInFlight&&e._progressiveHistorySyncRemainingIteration>0){e._progressiveHistorySyncRemainingIteration--,e._progressiveHistorySyncInFlight=!0;try{yield m.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield e._progressiveHistorySyncRun()}catch(e){__LOG__(4,void 0,new Error)`[History sync] _progressiveHistorySyncRun failed with ${null==e?void 0:e.message}, stack: ${null==e?void 0:e.stack}`}e._progressiveHistorySyncInFlight=!1,yield new Promise((e=>setTimeout(e,2e4))),e._initNextProgressiveHistorySyncRunLoop()}}))()}};u.Cmd.on("on_initial_chat_synced",(()=>{N.setInitialChatHistorySynced()})),u.Cmd.on("logout",(()=>{N.initState()}));var L=N;t.default=L},87045:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(23279)),a=r(15688),s=r(65127);let o=!1;const l=(0,i.default)((()=>o=!1),500);var c={id(){const e=r(99234);let t=e.getBrowserId();if(t)return t;const n=new Uint8Array(16);return self.crypto.getRandomValues(n),t=(0,a.encodeB64)(n),e.setBrowserId(t),t},info(){const e=s.UA.parser.getResult();return{os:e.os.name,version:e.os.version,name:e.browser.name,ua:e.browser.name+" "+e.browser.version}},hardRefresh(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.promptUnloadGuards++,e){r(99234).setNoTakeover(!0)}location.reload(t)},startDownloading(){o=!0,l()},clearDownloading(){o=!1},isDownloading:()=>o,promptUnloadGuards:0,open(e){window.open(e,"_blank","noopener,noreferrer")}};t.default=c},11365:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intToBytes=function(e,t){let r=t;const n=new Uint8Array(e);for(let t=e-1;t>=0;t--)n[t]=255&r,r>>>=8;return n},t.uint8ArrayToBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}},92589:()=>{!function(e){var t;const r=null===(t=e.HTMLCanvasElement)||void 0===t?void 0:t.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,s=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){let t,r,s,o,l,c,d,u,p;if(t=e.match(/^data:((.*?)(;charset=.*?)?)(;base64)?,/),!t)throw new Error("invalid data URI");for(r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),s=!!t[4],o=e.slice(t[0].length),l=s?atob(o):decodeURIComponent(o),c=new ArrayBuffer(l.length),d=new Uint8Array(c),u=0;u<l.length;u+=1)d[u]=l.charCodeAt(u);return n?new Blob([i?d:c],{type:r}):(p=new a,p.append(c),p.getBlob(r))};e.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(e,t,n){n&&r.toDataURL&&s?e(s(this.toDataURL(t,n))):e(this.mozGetAsFile("blob",t))}:r.toDataURL&&s&&(r.toBlob=function(e,t,r){e(s(this.toDataURL(t,r)))})),e.dataURLtoBlob=s}(window)},35718:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addBorder=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";const n=document.createElement("canvas"),i=n.getContext("2d"),a=document.createElement("canvas"),s=a.getContext("2d"),o=2*t;n.width=a.width=e.width+2*o,n.height=a.height=e.height+2*o,i.drawImage(e,o,o),s.shadowColor=r,s.shadowBlur=1;for(let e=0;e<o;e++)s.drawImage(n,0,0),i.drawImage(a,0,0);return s.shadowColor="rgba(0,0,0,0)",s.drawImage(e,o,o),a},t.canvasToBlob=l,t.canvasToWebp=function(e){{const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return(0,o.default)(t.data,e.width,e.height,{ensureExtendedFormat:!0})}},t.contain=function(e,t){const{width:r,height:n}=(0,a.boundHeightWidth)(e.height,e.width,t);if(r>e.width&&n>e.height)return e;{const t=document.createElement("canvas"),i=t.getContext("2d");return t.width=r,t.height=n,i.drawImage(e,0,0,r,n),t}},t.copy=u,t.createCanvas=d,t.fillBackgroundWithGray=function(e){const t=e.getContext("2d");t.fillStyle="rgb(247,247,247)",t.fillRect(0,0,e.width,e.height)},t.generateMicroThumb=function(){return c.apply(this,arguments)},t.getResizedDataUrl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",r=arguments.length>2?arguments[2]:void 0;const n=e.toDataURL(t),i=window.dataURLtoBlob(n);if(i.size<=r)return e.toDataURL(t);for(let n=.9;n>=.1;n-=.1){const i=e.toDataURL(t,n);if(window.dataURLtoBlob(i).size<=r)return i}return null},t.resize=function(e,t,r){const n=e.getContext("2d"),i=n.getImageData(0,0,t,r);e.width=t,e.height=r,n.putImageData(i,0,0)},t.rotate=function(e,t){const r=t.x||0,n=t.y||0;t.degrees&&(t.radians=t.degrees*(Math.PI/180));e.translate(r,n),e.rotate(t.radians),e.translate(-r,-n)},t.scale=function(e,t){const r=e.getContext("2d"),n=u(e),{width:i,height:s}=(0,a.aspectRatioScaled)(e.width/e.height,t);e.width=i,e.height=s,r.drawImage(n,0,0,i,s)},t.square=function(e){const t=e.getContext("2d"),r=e.width,n=e.height,i=t.getImageData(0,0,r,n),a=Math.max(r,n);e.width=a,e.height=a,t.clearRect(0,0,r,n),t.putImageData(i,(a-r)/2,(a-n)/2,0,0,r,n)},t.trim=function(e){if(function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),r=t.data.length/4;let n;for(n=0;n<r;n++){if(0!==t.data[4*n+3])return!1}return!0}(e))return;const{left:t,top:r,right:n,bottom:i}=function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),r=t.data.length/4;let n,i=1/0,a=1/0,s=0,o=0;for(n=0;n<r;n++){if(0===t.data[4*n+3])continue;const r=n%e.width,l=Math.floor(n/e.width);r<i&&(i=r),r>s&&(s=r),l<a&&(a=l),l>o&&(o=l)}return{left:i,top:a,right:s,bottom:o}}(e),a=i-r,s=n-t,o=e.getContext("2d").getImageData(t,r,s,a),l=d(s,a);return l.getContext("2d").putImageData(o,0,0),l};var i=n(r(48926)),a=r(38034),s=n(r(34949)),o=n(r(7030));function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg";return e.toBlob?new Promise((function(r){e.toBlob(r,t)})):Promise.resolve(window.dataURLtoBlob(e.toDataURL(t)))}function c(){return(c=(0,i.default)((function*(e,t,r){var n,i;const a=r||{},o=null!==(n=a.mimetype)&&void 0!==n?n:"image/jpeg",c=null!==(i=a.maxAttempts)&&void 0!==i?i:10;let u=.5,p=e,h=yield l(p,o);for(let r=0;r<c&&!(h.size<=t);r++){const t=Math.floor(e.width*u),r=Math.floor(e.height*u);p=d(t,r);p.getContext("2d").drawImage(e,0,0,t,r),h=yield l(p,o),u*=.5}return{opaqueData:yield s.default.createFromData(h,o),width:p.width,height:p.height,dataUrl:p.toDataURL("image/jpeg")}}))).apply(this,arguments)}function d(e,t){const r=document.createElement("canvas");return r.width=e,r.height=t,r}function u(e){const t=d(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t}},4484:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TcTokenMode=void 0,t.getTcTokenDuration=o,t.isTokenExpired=function(e,t){return e<l(t)},t.shouldSendNewToken=function(e){if(null==e)return!0;const t=(0,i.getABPropConfigValue)("tctoken_duration_sender"),r=Math.floor(a.Clock.globalUnixTime()/t),n=Math.floor(e/t);return r>n},t.tokenExpirationCutoff=l;var n=r(92844),i=r(86945),a=r(22683);const s=r(54302)({Sender:"sender",Receiver:"receiver"});function o(e){const t=e===s.Receiver?"tctoken_duration":"tctoken_duration_sender";return(0,n.castToUnixTime)(Math.min((0,i.getABPropConfigValue)(t),15552e3))}function l(e){const t=e===s.Receiver?"tctoken_num_buckets":"tctoken_num_buckets_sender",r=(0,i.getABPropConfigValue)(t),l=o(e),c=Math.floor(a.Clock.globalUnixTime()/l);return(0,n.castToUnixTime)((c-(r-1))*l)}t.TcTokenMode=s},85965:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_REQUESTED=void 0,t.sendLogs=function(){return F.apply(this,arguments)},t.upload=w,t.uploadUserReport=function(){return k.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=n(r(23493)),o=r(88102),l=r(17239),c=n(r(69618)),d=r(99234),u=r(82867),p=r(7293),h=n(r(52991)),f=r(70818),_=r(82449),m=n(r(11339)),g=r(89618),y=r(2541),E=r(77959),S=n(r(64386));const v=e=>new Promise((t=>setTimeout(t,e))),T=r(54302)({CRASHLOG:"crashlog",SUPPORT:"support"}),A=r(54302)({ONLY_EXCEPTION:"only_exception"}),C={shouldHitCheckEndpoint:()=>!1,expectedCodes:[],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},b={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},P={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:e=>{e.append("support_exception_only_upload","true")},appendToFormDataForUpload:(e,t)=>{t&&t.upload===A.ONLY_EXCEPTION&&e.append("exception_only_upload","true")},shouldUseLightWeightLogs:e=>!!e&&e.upload===A.ONLY_EXCEPTION};function M(e,t,r){return r?C:t?P:b}const O="server-requested";t.SERVER_REQUESTED=O;const I=(0,s.default)(D,c.default.LOG_UPLOAD_INTERVAL);function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e){let{reason:t,immediate:r=!1,force:n=!1,persist:i=!1,isHighPri:a=!1,nativeCrash:s,voipLog:d,skipSampling:f=!1,hasTaggedMessage:m=!1,ticketId:y}=e;if(h.default.isLogoutInProgress)return Promise.resolve();let E=i?T.SUPPORT:T.CRASHLOG;o.Cmd.logSocketSummary(),__LOG__(2)`Focus at time of upload:`;try{g.UIM.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}__LOG__(2)`==================================================`,__LOG__(2)`wa:uploadLogs ref: ${l.Conn.ref||"no conn"}`,__LOG__(2)`wa:uploadLogs hash: ${c.default.LATEST_HASH}`,__LOG__(2)`wa:uploadLogs version: ${c.default.VERSION_BASE}`,__LOG__(2)`wa:uploadLogs userAgent: ${navigator.userAgent}`,__LOG__(2)`wa:uploadLogs platform: ${l.Conn.platform||"no platform"}`,__LOG__(2)`wa:uploadLogs webPlatform: ${c.default.FLB_PLATFORM||"web"}`,__LOG__(2)`wa:uploadLogs appId: ${c.default.APP_ID}`,__LOG__(2)`wa:uploadLogs url: ${location.href}`,__LOG__(2)`wa:uploadLogs distribution: ${(0,u.getDistribution)()}`,__LOG__(2)`wa:uploadLogs buildId: ${c.default.BUILD_ID||"0"}`,__LOG__(2)`wa:uploadLogs mdOptIn: ${p.GK.supportsFeature(p.GK.F.MD_BACKEND)}`,m&&__LOG__(2)`wa:uploadLogs hasTaggedMessage`;let S=null;if(void 0===t)E=T.SUPPORT,__LOG__(2)`reason for logs: manual-upload`,S=!0;else if(t){let e=t;p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&(e=`[MD] ${t}`),__LOG__(2)`reason for logs: ${e}`}__LOG__(2)`${_.END_OF_UPLOAD}`;let v=D;if(!S&&!n){if(!(Math.random()<c.default.UPLOAD_TO_CLB))return void __LOG__(2)`wa:uploadLogs squelched logs`;v=I}const A=M(0,m,t===O);try{return yield v({isHighPri:a,immediate:r,logType:E,nativeCrash:s,voipLog:d,skipSampling:f,ticketId:y,getFullLogs:t===O,uploadStrategy:A})}catch(e){__LOG__(2)`wa:uploadLogs error uploading: ${e}`}}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e){let t,{isHighPri:r,immediate:n,logType:i,nativeCrash:a,voipLog:s,skipSampling:o=!1,ticketId:l,getFullLogs:d=!1,uploadStrategy:u}=e;if(yield v(n?0:500),u.shouldHitCheckEndpoint()){const e=L({isHighPri:r});if(u.appendToFormDataForCheck(e),t=yield S.default.post(G(i),e),!u.expectedCodes.includes(t.status))throw new Error(`Status code of ${t.status} from ${c.default.FB_CLB_CHECK_URL} was unexpected, expected values are: ${u.expectedCodes.toString()}`);if(403===t.status)throw new Error("Aborting CLB upload due to 403 response")}else __LOG__(2)`CLB:doUpload skipping sampling check`;let p=null;if(t)try{p=JSON.parse(t.responseText)}catch(e){__LOG__(2)`CLB:failed to parse response from upload check ${String(e)}, will perform default upload`}const h=L({isHighPri:r});u.appendToFormDataForUpload(h,p);const _=(yield f.Logger.getLogs(d,u.shouldUseLightWeightLogs(p))).join("\n"),m=new Blob([_],{type:"text/plain"});h.append("file",m,"logs.txt"),l&&h.append("ticket_id",l),a&&(h.append("attachment",new Blob([a.contents],{type:"application/octet-stream"}),a.filename),h.set("agent",a.agent),h.append("tags","electron_native"),s&&h.append("voip_log",new Blob([s.contents],{type:"text/plain"}),s.filename));const g=U(i),y=yield S.default.post(g,h);if(200!==y.status)throw new Error(`Status code of ${y.status} from ${g} was unexpected, expected 200`);return y.getResponseHeader("X-Uploaded-File-Id")}))).apply(this,arguments)}function L(e){let{isHighPri:t}=e;const n=new FormData;t&&n.append("forced","true");const i=(0,d.getMe)();i&&n.append("from_jid",i.toString());const a=r(87045).default.info(),s=(0,u.getLogUserAgent)({device:a.os,browser:a.ua,appVersion:c.default.VERSION_BASE});return n.append("agent",s),n.append("app_id",c.default.APP_ID),n.append("build_id",c.default.BUILD_ID),p.GK.supportsFeature(p.GK.F.MD_BACKEND)&&n.append("md_opt_in","true"),n}function k(){return(k=(0,a.default)((function*(e,t,r,n,a,s){try{__LOG__(2)`CLB:uploadUserReport uploading`,__LOG__(2,!0)`CLB:uploadUserReport description: ${n}`;const o=yield w({reason:"user-report",immediate:!0,force:!0,persist:!0}),u=(0,d.getLoginTokens)().server,p=new FormData;u&&p.append("tok",u),null!=e&&p.append("user",String(e)),p.append("email",t),o&&p.append("crashlog",o),p.append("desc",n),a.map(((e,t)=>{p.append(`screenshot-${t}`,e)})),E.Wam.initialize();const h=(0,i.default)((0,i.default)({subject:r},m.default.Global.all),{},{webcWebPlatform:c.default.FLB_PLATFORM,webcPhonePlatform:l.Conn.platform,webcProtoVersion:String(l.Conn.protoVersion)}),f=(0,d.getMe)();f&&(h.deviceID=f.toString()),s&&(h.context=s);const _={};for(const e in h){const t=h[e];null!=t&&(_[e]=t)}p.append("info",JSON.stringify(_)),__LOG__(2)`CLB:uploadUserReport submitting`,yield S.default.post(c.default.TICKET_URL,p),__LOG__(2)`CLB:uploadUserReport succeeded`}catch(e){__LOG__(2)`CLB:uploadUserReport failed ${String(e)}`}}))).apply(this,arguments)}function G(e){return y.URL.build(c.default.FB_CLB_CHECK_URL,{type:String(e),access_token:c.default.FB_CLB_TOKEN})}function U(e){return y.URL.build(c.default.FB_CLB_URL,{type:String(e),access_token:c.default.FB_CLB_TOKEN})}function F(){return(F=(0,a.default)((function*(e){yield w({reason:e,hasTaggedMessage:!0})}))).apply(this,arguments)}},22683:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SKEW_CHANGE_EVENT=t.HOUR24_FORMAT_CHANGE_EVENT=t.Clock=void 0;var i=n(r(81109)),a=r(92844),s=n(r(48360)),o=n(r(30381)),l=n(r(69618)),c=n(r(34342)),d=n(r(43725)),u=r(53558);const p=["fi","id","ms","ms-my"],h="skew_change";t.SKEW_CHANGE_EVENT=h;const f="hour24_format_change";t.HOUR24_FORMAT_CHANGE_EVENT=f;class _ extends c.default{constructor(){if(super(),this.is24h=!1,this.skewMS=0,this.skew=0,Intl.DateTimeFormat&&Intl.DateTimeFormat().resolvedOptions){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;switch(e?__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone is ${e}`:__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone does not exist`,e){case"America/Sao_Paulo":this.timeZoneHardCode="America/Belem";break;case"America/Campo_Grande":case"America/Cuiaba":this.timeZoneHardCode="America/Porto_Velho"}}}getIs24Hour(){return this.is24h}setIs24Hour(e){e!==this.is24h&&(this.is24h=e,this.trigger(f))}setIs24HourBasedOnLocale(){this.setIs24Hour(u.LOCALES_THAT_PREFER_24HOUR_TIME.has(d.default.getLocale()))}setSkew(e){Math.abs(e)>6e4&&__LOG__(2)`Setting large clockskew: ${e}ms`;const t=this.skewMS;this.skewMS=e,this.skew=Math.round(e/1e3),Math.abs(t-this.skewMS)>1e3&&this.trigger(h)}getSkew(){return this.skew}localUnixTime(e){return void 0!==e?e+this.skew:Math.floor(Date.now()/1e3)}globalUnixTime(e){return void 0!==e?e-this.skew:Math.floor((Date.now()-this.skewMS)/1e3)}globalUnixTimeMilliseconds(){return Math.floor(Date.now()-this.skewMS)}relativeStr(e){const t=e+this.skew;return t>=(0,o.default)().startOf("day").unix()?this._timestampStr(t):this._dateRelativeStr(t,!1)}relativeDateStr(e){return this._dateRelativeStr(e+this.skew,!1)}relativeDateAndTimeStr(e){return this._dateRelativeStr(e+this.skew,!0)}monthStr(e){const t=e+this.skew,r=1e3*t;return t>=(0,o.default)().startOf("month").unix()&&t<=(0,o.default)().endOf("month").unix()?d.default.t(1350):t>=(0,o.default)().startOf("year").unix()&&t<=(0,o.default)().endOf("year").unix()?Intl.DateTimeFormat(o.default.locale(),{month:"long"}).format(r):Intl.DateTimeFormat(o.default.locale(),{month:"long",year:"numeric"}).format(r)}timeStr(e){if(this.shouldUseIntlDateTimeFormat()){const t=1e3*(e+this.skew);let r={hour12:!this.is24h,hour:"numeric",minute:"numeric"},n={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(r=(0,i.default)((0,i.default)({},r),{},{timeZone:this.timeZoneHardCode}),n=(0,i.default)((0,i.default)({},n),{},{timeZone:this.timeZoneHardCode}));return`${Intl.DateTimeFormat(o.default.locale(),r).format(t)}, ${Intl.DateTimeFormat(o.default.locale(),n).format(t)}`}return o.default.unix(e+this.skew).format(this.is24h?`HH${this._hmsSeparator()}mm, l`:"LT, l")}timestampStr(e){return this._timestampStr(e+this.skew)}timestampStrFormat(){return this.is24h?`HH${this._hmsSeparator()}mm`:"LT"}timestampHour(e){const t=e+this.skew,r=o.default.unix(t).hour();return this.is24h?r:r%12}createdStr(e,t){const r=this.daysDelta(e),n=e+this.skew,i=this._timestampStr(n);if(0===r)return t?d.default.t(1643,{time:i}):d.default.t(1642,{time:i});if(1===r)return t?d.default.t(1649,{time:i}):d.default.t(1648,{time:i});if(r<7){const e=this._dateRelativeStr(n,!1);return t?d.default.t(1647,{day:e,time:i}):d.default.t(1646,{day:e,time:i})}const a=this._dateRelativeStr(n,!1);return t?d.default.t(1639,{date:a,time:i}):d.default.t(1638,{date:a,time:i})}createdByStr(e,t,r){const n=this.daysDelta(e),i=e+this.skew,a=this._timestampStr(i);if(0===n)return r?d.default.t(1645,{time:a}):d.default.t(1644,{name:t,time:a});if(1===n)return r?d.default.t(1651,{time:a}):d.default.t(1650,{name:t,time:a});if(n<7){const n=this._dayNameStr(e);return r?s.default._("Group created by you, {on_day} at {time}",[s.default._param("on_day",n),s.default._param("time",a)],{hk:"2dwUQV"}):s.default._("Group created by {name}, {on_day} at {time}",[s.default._param("name",t),s.default._param("on_day",n),s.default._param("time",a)],{hk:"34crrC"})}const o=this._dateRelativeStr(i,!1);return r?d.default.t(1641,{date:o,time:a}):d.default.t(1640,{name:t,date:o,time:a})}_dayNameStr(e){const t=e+this.skew;switch(o.default.unix(t).day()){case 0:return s.default._("on Sunday",null,{hk:"3hQdLv"});case 1:return s.default._("on Monday",null,{hk:"4uZn7B"});case 2:return s.default._("on Tuesday",null,{hk:"4llPGV"});case 3:return s.default._("on Wednesday",null,{hk:"4afKlR"});case 4:return s.default._("on Thursday",null,{hk:"49dOXK"});case 5:return s.default._("on Friday",null,{hk:"3P0f1f"});case 6:return s.default._("on Saturday",null,{hk:"1I5myq"});default:throw new Error("Unexpected day number")}}untilStr(e){if(e===l.default.MUTE_ALWAYS_EXPIRATION_SENTINEL)return d.default.t(879);const t=this.daysDelta(e),r=e+this.skew,n=this._timestampStr(r);if(0===t)return d.default.t(1388,{time:n});if(1===t)return d.default.t(1389,{time:n});if(t<7){const e=this._dateRelativeStr(r,!1);return d.default.t(1390,{day:e,time:n})}const i=this._dateRelativeStr(r,!1);return d.default.t(1387,{date:i,time:n})}lastSeenStr(e){const t=this.daysDelta(e),r=e+this.skew,n=this._timestampStr(r);if(0===t)return d.default.t(1598,{time:n});if(1===t)return d.default.t(1600,{time:n});if(t<7){const e=this._dateRelativeStr(r,!1);return d.default.t(1599,{date:e,time:n})}const i=this._dateRelativeStr(r,!1);return d.default.t(1597,{date:i,time:n})}daysDelta(e,t){const r=o.default.unix(e).startOf("day"),n=(void 0===t?(0,o.default)().startOf("day"):o.default.unix(t).startOf("day")).diff(r,"days");return Math.abs(n)}durationStr(e){const t="string"==typeof e?parseInt(e,10):e,r=o.default.utc(1e3*t);if(r.isValid()){const e=t<a.HOUR_SECONDS?"m:ss":"H:mm:ss";return r.format(e)}return""}_getShortTimeLeftStr(e){const t=Math.floor(e/86400);if(t>0)return{time:d.default.t(1260,{days:t,_plural:t}),_plural:t};const r=Math.floor(e/3600);if(r>0)return{time:d.default.t(1261,{hours:r,_plural:r}),_plural:r};const n=Math.floor(e/60);return n>0?{time:d.default.t(1262,{minutes:n,_plural:n}),_plural:n}:{time:d.default.t(1263,{seconds:e,_plural:e}),_plural:e}}timeLeftStr(e){return d.default.t(1351,this._getShortTimeLeftStr(e))}paymentTimestampStr(e){const t=e+this.skew,r=o.default.unix(t),n=r.startOf("day"),i=(0,o.default)().startOf("day").diff(n,"days");if(0===i)return d.default.t(1880);if(1===i)return d.default.t(1909);if(!(i<7)){const e=r.format("MMMM d");return d.default.t(1810,{date:e})}switch(r.day()){case 0:default:return d.default.t(1811);case 1:return d.default.t(1808);case 2:return d.default.t(1813);case 3:return d.default.t(1814);case 4:return d.default.t(1812);case 5:return d.default.t(1807);case 6:return d.default.t(1809)}}liveLocationLastUpdatedStr(e){const t=e+this.skew,r=this._timestampStr(t),n=o.default.unix(t).startOf("day"),i=(0,o.default)().startOf("day").diff(n,"days");if(0===i)return d.default.t(701,{time:r});if(1===i)return d.default.t(703,{time:r});if(i<6){const e=this._dateRelativeStr(t,!1);return d.default.t(702,{date:e,time:r})}{const e=this._dateRelativeStr(t,!1);return d.default.t(700,{date:e,time:r})}}_timestampStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={hour12:!this.is24h,hour:"numeric",minute:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));const r=Intl.DateTimeFormat(o.default.locale(),t).format(1e3*e);return this.is24h?r.replace(/^24/,"00"):r.replace(/^0/,"12")}return o.default.unix(e).format(this.timestampStrFormat())}_dateStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));return Intl.DateTimeFormat(o.default.locale(),t).format(1e3*e)}return o.default.unix(e).format("l")}_dateRelativeStr(e,t){const r=(0,o.default)().startOf("day"),n=o.default.unix(e).startOf("day"),i=r.diff(n,"days"),a=this._timestampStr(e);if(0===i)return t?d.default.t(1881,{time:a}):d.default.t(1880);if(1===i)return t?d.default.t(1910,{time:a}):d.default.t(1909);if(!t&&Math.abs(i)<7)return o.default.unix(e).format("dddd");const s=this._dateStr(e);return t?d.default.t(1879,{date:s,time:a}):s}_hmsSeparator(){const e=o.default.locale();return p.includes(e)?".":":"}shouldUseIntlDateTimeFormat(){return Intl.DateTimeFormat&&!u.LOCALE_DATE_TIME_CUSTOMIZATIONS[o.default.locale()]&&!u.SHOULD_USE_MOMENT_LOCALE_FORMAT.has(o.default.locale())}}const m=new _;t.Clock=m},17186:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logoutAfterValidationFail=function(){new a.ShiftTimer((()=>{m()})).onOrAfter(1e3)},t.resetCompanionReg=function(){h=!1,f=!1},t.startInitialHistorySyncTimeout=function(){if(null==y){y=setTimeout(_,18e4);(new c.default).listenTo(o.Cmd,"on_initial_chat_synced",(()=>{clearTimeout(y)}))}},t.startLogin=function(){if(h||f)return;(0,l.setDeviceLinkPairStage)(u.default.MD_LINK_DEVICE_COMPANION_STAGE.FIRST_CONNECT),h=!0,(0,s.clearADVSecretKey)(),o.Cmd.restartBackend()},t.startLogout=m,t.triggerCriticalSyncLogout=_;var i=n(r(48926)),a=r(57319),s=r(24863),o=r(88102),l=r(91214),c=n(r(34342)),d=r(83578),u=n(r(11339)),p=r(65044);let h=!1,f=!1;function _(){__LOG__(4,void 0,new Error)`logout due to no critical data`,p.Socket.logout(!1,d.LogoutReason.CriticalSyncTimeout)}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){h||f||(f=!0,yield p.Socket.clearCredentialsAndStoredData(),(0,s.clearADVSecretKey)(),o.Cmd.restartBackend())}))).apply(this,arguments)}let y},11241:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r="animation",n="transition";var i={_normalize(e,t,r){const n=e.toLowerCase().indexOf(t),i=e.slice(0,n).toLowerCase();return 0===e.indexOf(t)?i+e.slice(n)+r.toLowerCase():i+e.slice(n)+r},prefix(e,t){let i;if(0===e.indexOf(r)){i=e.substring(r.length);const t=window.Modernizr?window.Modernizr.prefixed(r):r;return this._normalize(t,r,i)}if(0===e.indexOf(n)){i=e.substring(n.length);const t=window.Modernizr?window.Modernizr.prefixed(n):n;return this._normalize(t,n,i)}return window.Modernizr.prefixed(e,t,!1)||e}};t.default=i},89520:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("ContactBlocked")){constructor(e,t){super(e),this.contact=t}}t.default=i},11698:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},t.getCookie=function(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:void 0},t.setCookie=function(e){e.session&&delete e.expirationDate;const t=[];["name","value","domain","path","secure","session","expirationDate"].forEach((r=>{const n=e[r];if(void 0!==n&&"value"!==r)switch(r){case"expirationDate":const i=new Date(e.expirationDate);t.push(`expires=${i.toUTCString()}`);break;case"secure":t.push("secure");break;case"name":const a=e.value||"";t.push(`${String(n)}=${a}`);break;default:t.push(`${r}=${String(n)}`)}})),document.cookie=t.join(";")}},69830:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndMac=function(e,t,r){return(0,o.aesCbcEncrypt)(e,new Uint8Array(r)).then((e=>new l.default(t).sign(e).then((t=>s.Binary.build(t,e).readBuffer()))))},t.macAndDecrypt=function(e,t,r){return Promise.resolve(new Uint8Array(r)).then((r=>{const n=(0,a.encodeB64)(r.subarray(0,32)),i=r.subarray(32);return new l.default(t).sign(i).then((t=>{const r=(0,a.encodeB64)(t);if(n!==r)throw __LOG__(3)`crypto:macAndDecrypt HMAC don't match ${n} vs. ${r}`,new Error("macAndDecrypt HMAC mismatch");return(0,o.aesCbcDecrypt)(e,i)}))}))},t.removeEncryptedPadding=function(e,t){const r=e.slice(-t.byteLength);if((0,i.arrayBuffersDeepEqual)(r,t))return e.slice(0,e.byteLength-t.byteLength);return e};var i=r(95024),a=r(15688),s=r(8584),o=r(89626),l=n(r(39827))},89626:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.aesCbcDecrypt=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.resolve().then((()=>{let n,a;if(r){const e=(0,i.castTypedArrays)(Uint8Array,t);n=e.subarray(0,o),a=e.subarray(o)}else n=t.slice(0,o),a=t.slice(o);return c(e,n,a)}))},t.aesCbcDecryptWithIv=c,t.aesCbcEncrypt=function(e,t,r){return Promise.resolve().then((()=>{let n;r?n=(0,i.castTypedArrays)(Uint8Array,r):(n=new Uint8Array(o),self.crypto.getRandomValues(n));const c=l(n);return Promise.resolve(s.default.importKey("raw",(0,i.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["encrypt"])).then((e=>s.default.encrypt(c,e,t))).then((e=>(0,a.concatTypedArrays)(Uint8Array,[n,new Uint8Array(e)]).buffer))}))};var i=r(46269),a=r(60977),s=n(r(42810));const o=16;function l(e){return{name:"AES-CBC",iv:(0,i.castTypedArrays)(Uint8Array,e)}}function c(e,t,r){const n=l(t);return Promise.resolve(s.default.importKey("raw",(0,i.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["decrypt"])).then((e=>s.default.decrypt(n,e,r)))}},92342:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(46269),a=n(r(42810));t.default=class{constructor(e,t){this._algo=e,this._key=(0,i.castTypedArrays)(Uint8Array,t)}sign(e,t){return Promise.resolve(a.default.importKey("raw",this._key,this._algo,!1,["sign"])).then((t=>a.default.sign(this._algo,t,e))).then((e=>null!=t&&0!==t?e.slice(0,t):e))}}},71208:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(92342));const a={name:"HMAC",hash:{name:"SHA-1"}};class s extends i.default{constructor(e){super(a,e)}}t.default=s},39827:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(92342));const a={name:"HMAC",hash:{name:"SHA-256"}};class s extends i.default{constructor(e){super(a,e)}}t.default=s},32318:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(92342));const a={name:"HMAC",hash:{name:"SHA-512"}};class s extends i.default{constructor(e){super(a,e)}}t.default=s},89016:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LtHash16=t.LT_HASH_ANTI_TAMPERING=t.KEY_LENGTH_BYTES=t.EMPTY_LT_HASH=void 0;var a=i(r(48926)),s=n(r(12206));const o=128;t.KEY_LENGTH_BYTES=o;const l=new ArrayBuffer(o);t.EMPTY_LT_HASH=l;class c{constructor(e){this.salt=e}add(e,t){var r=this;return t.reduce(function(){var e=(0,a.default)((function*(e,t){return r._addSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtract(e,t){var r=this;return t.reduce(function(){var e=(0,a.default)((function*(e,t){return r._subtractSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtractThenAdd(e,t,r){var n=this;return(0,a.default)((function*(){return n.add(yield n.subtract(e,r),t)}))()}_addSingle(e,t){var r=this;return(0,a.default)((function*(){const n=yield s.extractAndExpand(t,r.salt,o);return r.performPointwiseWithOverflow(e,n,((e,t)=>e+t))}))()}_subtractSingle(e,t){var r=this;return(0,a.default)((function*(){const n=yield s.extractAndExpand(t,r.salt,o);return r.performPointwiseWithOverflow(e,n,((e,t)=>e-t))}))()}performPointwiseWithOverflow(e,t,r){const n=new DataView(e),i=new DataView(t),a=new ArrayBuffer(n.byteLength),s=new DataView(a);for(let e=0;e<n.byteLength;e+=2)s.setUint16(e,r(n.getUint16(e,!0),i.getUint16(e,!0)),!0);return a}}t.LtHash16=c;const d=new c("WhatsApp Patch Integrity");t.LT_HASH_ANTI_TAMPERING=d},68138:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Promise.resolve(a.default.digest({name:"SHA-256"},e).then(i.encodeB64))};var i=r(15688),a=n(r(42810))},94e3:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r="whatsapp is da best",n=new Uint8Array(r.split("").map((e=>e.charCodeAt(0))));const i={name:"HMAC",hash:"SHA-256"},a={name:"AES-CBC",length:256},s={name:"ECDH",namedCurve:"P-256"};function o(){return Promise.resolve().then((()=>self.crypto.subtle||self.crypto.webkitSubtle))}var l={supportsHmacSha256:()=>o().then((e=>e.generateKey(i,!1,["sign","verify"]).then((t=>e.sign(i,t,n).then((r=>e.verify(i,t,r,n.buffer))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 signing failed: ${e}`,!1))).then((e=>e?(__LOG__(2)`CryptoSupport:HMAC-SHA256 is verified`,!0):(__LOG__(2)`CryptoSupport:HMAC-SHA256 is not verified`,!1))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 verification failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256: ${e}`,!1))),supportsAesCbc:()=>o().then((e=>e.generateKey(a,!1,["encrypt","decrypt"]).then((t=>Promise.resolve(self.crypto).then((e=>({name:"AES-CBC",iv:e.getRandomValues(new Uint8Array(16))}))).then((i=>e.encrypt(i,t,n).then((r=>e.decrypt(i,t,r))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC encryption failed: ${e}`,!1))).then((e=>{const t=new Uint8Array(e);return n=t,Array.prototype.slice.call(n).map((e=>String.fromCharCode(e))).join("")===r?(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is correct`,!0):(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is incorrect`,!1);var n})).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC decryption failed: ${e}`,!1))))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC: ${e}`,!1))),supportsEcdh:()=>o().then((e=>e.generateKey(s,!1,["deriveKey"]).then((t=>e.generateKey(s,!1,["deriveKey"]).then((r=>{const n={name:"ECDH",namedCurve:"P-256",public:r.publicKey};return e.deriveKey(n,t.privateKey,a,!1,["encrypt","decrypt"]).then((()=>(__LOG__(2)`CryptoSupport:ECDH key derivation succeeded`,!0))).catch((e=>(__LOG__(2)`CryptoSupport:ECDH key derivation failed: ${e}`,!1)))})).catch((e=>(__LOG__(2)`CryptoSupport:ECDH key generation #2 failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:ECDH key generation #1 failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:ECDH: ${e}`,!1)))};t.default=l},5087:(e,t,r)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.keyPair=function(e){let t;void 0===e?(t=new Uint8Array(32),self.crypto.getRandomValues(t)):t=new Uint8Array(e);return t[0]&=248,t[31]&=127,t[31]|=64,l({pubKey:32,privKey:t,basepoint:i},(function(e){const r=n._curve25519_donna(e.pubKey,e.privKey,e.basepoint);if(r)throw new Error(`Curve25519:keyPair Error Code ${r}`);return{pubKey:o(e.pubKey,32),privKey:t.buffer}}))},t.sharedSecret=function(e,t){return Promise.resolve().then((()=>l({sharedKey:32,pubKey:e,privKey:t},(function(e){const t=n._curve25519_donna(e.sharedKey,e.privKey,e.pubKey);if(t)throw new Error(`Curve25519:sharedSecret Error Code ${t}`);return o(e.sharedKey,32)}))))},t.toCurveKeyPair=function(e){if(33!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=new Uint8Array(32),r=new Uint8Array(32);return t.set(new Uint8Array(e.pubKey).subarray(1)),r.set(new Uint8Array(e.privKey)),{pubKey:t.buffer,privKey:r.buffer}},t.toCurveKeyPubKey=function(e){if(33!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(32);return t.set(new Uint8Array(e).subarray(1)),t.buffer},t.toSignalCurveKeyPair=function(e){if(32!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=a(e.pubKey),r=new Uint8Array(32);return r.set(new Uint8Array(e.privKey)),{pubKey:t,privKey:r.buffer}},t.toSignalCurvePubKey=a,t.verifySignature=function(e,t,r){if(32!==e.byteLength)throw new Error(`Invalid public key length: ${e.byteLength}`);const n=new Uint8Array(33);n[0]=5,n.set(e,1);return!1===window.libsignal.Curve.verifySignature(n,t,r)};const i=new Uint8Array(32);i[0]=9;function a(e){if(32!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(33);return t[0]=5,t.set(new Uint8Array(e),1),t.buffer}function s(e){if("number"==typeof e)return n._malloc(e);{const t=new Uint8Array(e.buffer||e),r=n._malloc(t.length);return n.HEAPU8.set(t,r),r}}function o(e,t){const r=new Uint8Array(t);return r.set(n.HEAPU8.subarray(e,e+t)),r.buffer}function l(e,t){n||(n=r(23098));const i={};try{for(const t in e)i[t]=s(e[t]);return t(i)}finally{for(const e in i)n._free(i[e])}}},19197:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(40265),a=r(50796),s=r(38284),o=n(r(86128)),l=n(r(30381)),c=n(r(69618)),d=n(r(11339)),u=r(65127);const p={ERROR:"error",OPENING:"opening",BLOCKED:"blocked",OPEN:"open",CLOSED:"closed",FAILED:"failed"};let h=!1,f=null;function _(){this._dbName=c.default.WEB_IDB_DB_NAMES.wawc,this._db=new o.default(this._dbName),this._db.on("versionchange",(e=>{this._db.close(),e&&null!=e.newVersion&&e.newVersion!==e.oldVersion&&(h=!0,f&&f())})),this._db.version(1).stores({logs:"line,log"}),this._db.version(2).stores({logs:"line,log",assets:"key,hash,data"}),this._db.version(3).stores({logs:"line,log",assets:"key,hash,data",wam:",buffer,prevValues,lastSend"}),this._db.version(4).stores({logs:"line,log",assets:"key,hash,data",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((function(e){e.wam.toCollection().modify((function(e){e.key=e.lastSend,delete e.prevValues,delete e.lastSend}))})),this._db.version(5).stores({logs:"line,log",assets:null,wam:",key,buffer",l10n:"key,hash,t"}),this._db.version(6).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((e=>{e.logs.toCollection().count().then((()=>{e.logs.toCollection().modify((e=>{const{log:t}=e;e.timestamp=1e3*(0,l.default)(t.slice(5,28),"YYYY-MM-DD HH:mm:ss.SSS").unix()}))}))})),this._db.version(7).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t",user:"key"}),this._db.version(8).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",l10n:"key,hash,t",user:"key"}).upgrade((e=>{e.wam.toCollection().modify((e=>{e.channel="regular"}))})),this._db.version(9).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",l10n:"key,hash,t",user:"key"}),this._db.version(10).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",ps_meta:"key, value, rotateInDays, lastRotationTimeUtc",ps_tokens:"key",l10n:"key,hash,t",user:"key"}),this.openAttempt=0,this.openDB().catch((e=>{__LOG__(3)`openDB failed: ${e}`})),this._dbState=p.OPENING}_.prototype.loadUserIdb=function(){return this.idb().then((e=>e.transaction("rw",e.user,(()=>e.user.toArray().then((e=>e.forEach((e=>{this.permanentStorage.dataStore[e.key]=e.value})))))))).catch((e=>{__LOG__(3)`db:loadUserIdb:Error ${e}`}))},_.prototype.openDB=function(){this._db.isOpen()&&this._db.close();const e=(0,s.promiseTimeout)(Promise.resolve(this._db.open()),1e4).then((()=>{__LOG__(2)`db: Successfully opened db`;return new d.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!0,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.OPEN,p.OPEN})).catch((0,a.filteredCatch)(i.TimeoutError,(()=>{__LOG__(2)`db:openDB blocked`;return new d.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.BLOCKED,p.BLOCKED}))).catch((e=>{if(__LOG__(3)`db:openDB:Error ${e}`,this.openAttempt>1||u.UA.isSafari){this.opening=void 0,this._dbState=p.ERROR;throw new d.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),p.ERROR}return this.openAttempt+=1,this._db.delete().catch((e=>{throw __LOG__(3)`db:deleteDB:Error ${e}`,this.opening=void 0,this._dbState=p.ERROR,p.ERROR})).then((()=>this.openDB()))})).then((e=>{if(this.opening=void 0,e===p.BLOCKED)throw p.BLOCKED;return this._db}));return this.opening||(this.opening=e),e},_.prototype.idb=function(){return this._db.isOpen()?Promise.resolve(this._db):this._db.hasFailed()?(__LOG__(3)`Dexie: database failed to open`,Promise.reject(new Error(p.FAILED))):this._dbState===p.BLOCKED?(__LOG__(3)`Dexie: database is blocked`,Promise.reject(new Error(p.BLOCKED))):this.opening?this.opening:(__LOG__(3)`Dexie: database is closed`,Promise.reject(new Error(p.CLOSED)))},_.prototype.onVersionChange=function(e){f=e,h&&f()},_.prototype.State=p;var m=new _;t.default=m},15998:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_KEY_TTL=t.ENC_KEY_TABLE_NAME=t.ENC_KEY_DB_NAME=t.DbEncKeyStore=t.DB_ENCRYPTION_CIPHER=void 0;var a=i(r(81109)),s=i(r(48926)),o=r(15688),l=r(88156),c=r(92844),d=i(r(86128)),u=i(r(41143)),p=n(r(64103));const h=r(74121).Z,f="wawc_db_enc";t.ENC_KEY_DB_NAME=f;const _="keys";t.ENC_KEY_TABLE_NAME=_;const m={name:"HKDF"},g={hash:"SHA-256"},y=4*c.WEEK_MILLISECONDS*24;t.ENC_KEY_TTL=y;const E="fts_hmac_keys",S="AES-CBC";t.DB_ENCRYPTION_CIPHER=S;function v(){const e=new Uint8Array(128);return self.crypto.getRandomValues(e),self.crypto.subtle.importKey("raw",e,m,!1,["deriveKey"])}const T=new class{constructor(){var e=this;this._waitUntilFinalDbEncKeyReady=new l.Resolvable,this._waitUntilEncKeyReady=new l.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new l.Resolvable,this._getOrUpdateEncKeys=e=>this._getDbOrThrow().keys.orderBy("id").toArray().then((t=>{if(!t||0===t.length)return this._addNewEncKey(e);const r=t[t.length-1]._expiration;if(null!=r&&r<=(new Date).getTime())return this._addNewEncKey(e);this._ephemeralLocalEncSalt=e;const n=t.map(function(){var t=(0,s.default)((function*(t){const r=yield self.crypto.subtle.deriveKey((0,a.default)((0,a.default)((0,a.default)({},m),g),{},{salt:e,info:new Uint8Array(1)}),t.key,{name:S,length:128},!1,["encrypt","decrypt"]);return(0,a.default)((0,a.default)({},t),{},{key:r})}));return function(){return t.apply(this,arguments)}}());return Promise.all(n).then((e=>{this._keys=e,this._waitUntilEncKeyReady.resolve()}))})),this._getOrUpdateFtsKey=()=>this._getDbOrThrow().fts_hmac_keys.orderBy("id").toArray().then((e=>{if(!e||0===e.length)return this._addNewFtsHMACKey();if(e.length>1)throw new p.DBInvalidFtsHMACKey;this._ftsHMACKey=e[e.length-1]})),this._addNewEncKey=e=>v().then((t=>this._getDbOrThrow().keys.add({key:t,_expiration:(new Date).getTime()+y}).then((()=>this._getOrUpdateEncKeys(e))))),this._addNewFtsHMACKey=()=>v().then((e=>this._getDbOrThrow().fts_hmac_keys.add({key:e}).then((()=>this._getOrUpdateFtsKey())))),this.generateFinalDbEncryptionAndFtsKey=e=>{if(null!=this._finalDbMsgEncKeys||null==this._ephemeralLocalEncSalt)return Promise.resolve();const t=(0,o.decodeB64)(e);return this._generateFinalFtsHmacKey(t),this._generateFinalDbMsgEncryptionKey(t),Promise.resolve()},this._generateFinalDbMsgEncryptionKey=t=>this._getDbOrThrow().keys.orderBy("id").toArray().then((r=>{const n=r.map(function(){var r=(0,s.default)((function*(r){let n;(0,u.default)(null!=e._ephemeralLocalEncSalt,"local salt is undefined");try{n=yield self.crypto.subtle.deriveKey((0,a.default)((0,a.default)((0,a.default)({},m),g),{},{salt:t,info:new Uint8Array(e._ephemeralLocalEncSalt||0)}),r.key,{name:S,length:128},!1,["encrypt","decrypt"])}catch(t){throw e._ephemeralLocalEncSalt=null,t}return(0,a.default)((0,a.default)({},r),{},{key:n})}));return function(){return r.apply(this,arguments)}}());return Promise.all(n).then((e=>{this._ephemeralLocalEncSalt=null,this._finalDbMsgEncKeys=e,this._waitUntilFinalDbEncKeyReady.resolve()}))})).finally((()=>{this._ephemeralLocalEncSalt=null})),this._generateFinalFtsHmacKey=function(){var t=(0,s.default)((function*(t){if(!e._ftsHMACKey||null==e._ftsHMACKey.key||null==e._ftsHMACKey.id)throw __LOG__(2)`Base ftsHMACKey is null in _generateFinalFtsHmacKey`,new p.DBInvalidFtsHMACKey;const[r,n]=[e._ftsHMACKey.id,e._ftsHMACKey.key],i=yield self.crypto.subtle.deriveKey((0,a.default)((0,a.default)((0,a.default)({},m),g),{},{salt:t,info:new Uint8Array(0)}),n,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);e._finalFtsHmacKey={id:r,key:i},e._waitUntilFinalFtsHmacKeyReady.resolve()}));return function(){return t.apply(this,arguments)}}()}init(e){if(this._db)return h.resolve();this._db=new d.default(f),this._getDbOrThrow().version(1).stores({[_]:"++id, _expirtation",[E]:"++id"}),this._getDbOrThrow().version(2).stores({[_]:"++id",[E]:"++id"});const t=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);return h.resolve(this._getDbOrThrow().open()).then((()=>Promise.all([this._getOrUpdateEncKeys(t),this._getOrUpdateFtsKey()])))}_getDbOrThrow(){if(null==this._db)throw new Error("[db_encryption_key] db is not initialized");return this._db}deleteKeys(){return Promise.all([this._getDbOrThrow().table(_).clear(),this._getDbOrThrow().table(E).clear()]).then((()=>{})).finally((()=>(this._db=null,h.resolve(d.default.delete(f)).catch((()=>d.default.delete(f))))))}deleteKeyCache(){this._keys=null,this._ftsHMACKey=null,this._finalDbMsgEncKeys=null,this._waitUntilFinalDbEncKeyReady=new l.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new l.Resolvable,this._waitUntilEncKeyReady=new l.Resolvable,this._finalFtsHmacKey=null,this._ephemeralLocalEncSalt=null}waitForEncKey(){return this._waitUntilEncKeyReady.promise}waitForFinalDbMsgEncKey(){return this._waitUntilFinalDbEncKeyReady.promise}waitForFinalFtsHmacKey(){return this._waitUntilFinalFtsHmacKeyReady.promise}get encKeys(){if(!this._keys)throw new p.DbEncKeyNotLoaded(_);return this._keys}get dbMsgEncKeys(){if(!this._finalDbMsgEncKeys)throw new p.DbMsgEncKeyNotLoaded(_);return this._finalDbMsgEncKeys}get ftsHMACKey(){if(!this._finalFtsHmacKey)throw new p.DbEncKeyNotLoaded(E);return this._finalFtsHmacKey}};t.DbEncKeyStore=T},62054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r,n){r(t).forEach((t=>e(t,r,n))),n(t)}},50229:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cypherStringToString=function(e){return e},t.genCypher=function(){return s.apply(this,arguments)},t.stringToCypherString=function(e){return e};var i=n(r(48926)),a=r(47114);function s(){return(s=(0,i.default)((function*(e,t,r){try{const{subtle:n}=yield(0,a.getEngine)(),i=yield n.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),s=(0,a.arrayBufferToBase64)(yield n.encrypt({name:"AES-GCM",iv:new Uint8Array((0,a.base64ToArrayBuffer)(t)),tagLength:128},i,(0,a.stringToArrayBuffer)(JSON.stringify(r)))),o=yield n.exportKey("raw",i);return`AesKey=${yield(0,a.encryptWithPublicKey)(e,o)};IV=${t};Data=${s}`}catch(e){return __LOG__(3)`[direct-connection] cypher creation failed with ${e.toString()}`,null}}))).apply(this,arguments)}},76059:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enablePostcodeInCatalog=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return(0,a.getABPropConfigValue)("web_abprop_direct_connection_md");return!1},t.genDirectConnectionMessageModifiers=function(){return y.apply(this,arguments)},t.supportsDirectConnection=_;var i=n(r(48926)),a=r(86945),s=r(56149),o=n(r(69618)),l=r(24808),c=r(7293),d=r(64551),u=r(58021);function p(){return((0,s.getBusinessProfileQueryVersion)()&s.DIRECT_CONNECTION_FLAG)>0}function h(){return d.ServerProps.isDirectConnectionForPLMTransparent&&(!c.GK.supportsFeature(c.GK.F.MD_BACKEND)||!(0,a.getABPropConfigValue)("web_abprop_direct_connection_md"))}function f(e,t){return e===o.default.MSG_TYPE.LIST&&t===l.ListMessageListType.PRODUCT_LIST}function _(){return c.GK.supportsFeature(c.GK.F.MD_BACKEND)?(0,a.getABPropConfigValue)("web_abprop_direct_connection_md"):h()}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t,n){var i;if(h()||!f(e,t)||!n)return!1;if(!p())return __LOG__(3)`[direct-connection] This web client cannot detect if the product list message recevied is coming from a direct connection business`,"unknown";const a=(0,u.createWid)(n),{BusinessProfileCollection:s}=r(93581);let o=s.get(a);return o&&o.profileOptions||(o=yield s.find(a)),(null===(i=o.profileOptions)||void 0===i?void 0:i.directConnection)||!1}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r){const n=yield m(e,t,r);return!0!==n||_()?{requiresDirectConnection:n}:{requiresDirectConnection:n,type:o.default.MSG_TYPE.UNKNOWN,subtype:"phone_only_feature"}}))).apply(this,arguments)}},47114:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToBase64=h,t.arrayBufferToString=_,t.base64ToArrayBuffer=p,t.certificateStringToString=function(e){return e},t.encodeToString=function(e){return e.map((e=>{const t=h(e.toSchema(!0).toBER(!1)).split(/(.{0,64})/g).filter((e=>""!==e)).join("\n");return`${o}\n${t}\n${l}`})).join("\n")},t.encryptWithPublicKey=function(){return O.apply(this,arguments)},t.extractCertificates=S,t.fetchFromCABundle=function(){return E.apply(this,arguments)},t.genRootIssuers=function(){return A.apply(this,arguments)},t.getCommonName=C,t.getEngine=b,t.getRandomValues=function(){return M.apply(this,arguments)},t.stringToArrayBuffer=f,t.stringToCertificateString=function(e){return e},t.validateCertificates=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=n(r(57291)),s=r(29595);const o="-----BEGIN CERTIFICATE-----",l="-----END CERTIFICATE-----",c=`(?:${o})((?:.|\n)*?)(?:${l})`;function d(){return r.e(6352).then(r.bind(r,14231))}function u(){return r.e(6352).then(r.bind(r,65267))}function p(e){let t="";try{t=atob(e)}catch(e){__LOG__(3)`[direct-connection] base64 decoding failed with ${e.toString()}`}return f(t)}function h(e){return btoa(_(e))}function f(e){const t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}function _(e){return String.fromCharCode(...new Uint8Array(e))}function m(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const{CertificateChainValidationEngine:r}=yield d();return new r({trustedCerts:t,certs:e})}))).apply(this,arguments)}function y(e,t){return e.flat().reduce(((e,r)=>e.every((e=>!(0,s.isEqualBuffer)(e.tbs,r.tbs)))&&t.includes(r)?[...e,r]:e),[])}function E(){return(E=(0,i.default)((function*(){const{CA_BUNDLE:e}=yield r.e(239).then(r.bind(r,44993));return S(e)}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{Certificate:t}=yield d(),{fromBER:r}=yield u();return(0,a.default)(Array.from(e.matchAll(new RegExp(c,"gm"))).map((e=>{let[n,i]=e;const{result:a}=r(p(i));let s;try{s=a.error?null:new t({schema:a})}catch(e){__LOG__(3)`[direct-connection] certificate chain parsing from Get Public Key IQ failed with ${e.toString()}`}return s})))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){return(yield m(e,t)).verify()}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t){const r=yield m(e,t),n=y(yield Promise.all(e.map((e=>r.findIssuer(e,r)))),t);return 0===n.length?(__LOG__(3)`[direct-connection] no trusted root certificates could be found for ${C(e[0])}`,null):n}))).apply(this,arguments)}function C(e){var t;return null===(t=e.issuer.typesAndValues.find((e=>{let{type:t}=e;return"2.5.4.3"===t})))||void 0===t?void 0:t.value.valueBlock.value}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(){const{getEngine:e}=yield d();return e()}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){const{getRandomValues:t}=yield d();return t(e)}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){const r=yield e.getPublicKey({algorithm:{algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]}}),n=yield b();return h(yield n.subtle.encrypt({name:"RSA-OAEP"},r,t))}))).apply(this,arguments)}},92200:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.documentFlushed=function(e){var t;const r=null!==(t=null==e?void 0:e.signal)&&void 0!==t?t:l();return new Promise(((e,t)=>{if(r.aborted)return void t(new a.AbortError);let n;function i(){r.removeEventListener("abort",l);const e=o.indexOf(s);-1!==e&&o.splice(e,1),0===o.length&&null!=n&&(n(),n=null)}function s(){i(),e()}function l(){i(),t(new a.AbortError)}o.push(s),r.addEventListener("abort",l),1===o.length&&(n=function(){let e;const t=requestAnimationFrame((()=>{e=setTimeout((()=>{c()}),0)}));return()=>{cancelAnimationFrame(t),clearTimeout(e)}}())}))},t.resolveAllForTestingOnly=void 0;var i=n(r(51463)),a=r(89385),s=n(r(70714));const o=[],l=(0,i.default)((()=>(new s.default).signal));function c(){for(;o.length>0;){o.shift()()}}t.resolveAllForTestingOnly=()=>(c(),Promise.resolve())},55216:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enrich=function(e,t){let r;switch((0,s.previewType)(t)){case"pdf":r=l(e);break;case"msoffice":r=function(){return c.apply(this,arguments)}(e);break;default:r=Promise.resolve()}return(0,a.promiseTimeout)(r,3e3,"Document enrichment timeout").catch((()=>null))},t.enrichPdf=l;var i=n(r(48926)),a=r(38284),s=r(43257),o=n(r(38906));function l(e){let t;return o.default.fileToPdf(e).then((e=>(t=e,o.default.pdfToImg(e,1)))).catch((()=>(__LOG__(2)`pdf preview generation failed`,null))).finally((()=>{t&&o.default.releasePdf(t)}))}function c(){return(c=(0,i.default)((function*(e){if("win32"===process.platform)try{yield DocUtils.genPreview(e)}catch(e){__LOG__(2)`document preview generation failed`}}))).apply(this,arguments)}},90935:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e.replace(/^data-/,""))};var i=n(r(68929))},95697:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e instanceof HTMLElement&&e.tagName.toLowerCase()===t.toLowerCase()}},3815:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(e instanceof HTMLElement))return!1;return r.call(e,t)};const r=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector},6589:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Boolean(e&&3===e.nodeType)}},65930:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e.collapsed)return[];if(e.startContainer===e.endContainer)return(0,a.default)(e.startContainer)?[e.startContainer]:Array.prototype.slice.call(e.startContainer.childNodes,e.startOffset,e.endOffset);const t=e.commonAncestorContainer.childNodes;let r,n;r=e.commonAncestorContainer===e.startContainer?t[0]:s(e.commonAncestorContainer,e.startContainer);(0,i.default)(r,"range is invalid: start missing"),n=e.commonAncestorContainer===e.endContainer?t[t.length-1]:s(e.commonAncestorContainer,e.endContainer);(0,i.default)(n,"range is invalid: end missing");const o=n,l=e=>null==e?void 0:e.nextSibling,c=[];let d=r;for(;d&&d!==o;)c.push(d),d=l(d)||l(d.parentNode);return c.push(o),c};var i=n(r(41143)),a=n(r(6589));function s(e,t){let r=t;for(;r.parentNode!==e;){if(!r.parentNode)return null;r=r.parentNode}return r}},3309:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r={LOW:"low",HIGH:"high"},n=window.matchMedia("\n    only screen and (-webkit-min-device-pixel-ratio: 2),\n    only screen and (min-device-pixel-ratio: 2),\n    only screen and (min-resolution: 2dppx)\n"),i={RES:r,currentRes:n.matches?r.HIGH:r.LOW};n.addListener((function(e){const t=e.matches?r.HIGH:r.LOW;if(t===i.currentRes)return;i.currentRes=t;const n=document.createEvent("Event");n.initEvent("dpichange",!0,!0),window.dispatchEvent(n)}));var a=i;t.default=a},75538:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(68929)),a=n(r(2525)),s=n(r(35161)),o=n(r(73955));t.default=class{constructor(e){this.rules={},this.styleSheet=this.createStyleSheet(e)}createStyleSheet(e){const t=e||(0,o.default)("dynamic-style-");let r=document.createElement("style");return r.id=t,r.type="text/css",document.head&&document.head.appendChild(r),r=r.sheet,r}addRule(e,t){const r=this.styleSheet.cssRules.length,n=(0,s.default)(t,((e,t)=>`${t}: ${e};`)).join(" ");return this.styleSheet.insertRule(`${e} { ${n} }`,r),this.rules[e]=this.styleSheet.cssRules[r],this.rules[e]}updateRule(e,t){const r=this.rules[e];return(0,a.default)(t,((e,t)=>{r.style[(0,i.default)(t)]=e})),r}setRule(e,t){return this.rules[e]?this.updateRule(e,t):this.addRule(e,t)}}},30600:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return s(null,a.default.fromForwardsStrings(e.sort(((e,t)=>t.length-e.length)).map((e=>`${e}${o}`))),null,0)};var i=n(r(3522)),a=n(r(55205));function s(e,t,r,n,a){const c=[];let d=!1,u=a;if(null==u)if(e&&1===n){l.has(e)&&(u=!0)}else e&&r&&2===n&&(u=l.has(r+e));t.getChildren().forEach((t=>{t.prefix!==o?c.push(s(t.prefix,t.node,e,n+1,u)):d=!0}));const p="️"!==e||null==r||u?(0,i.default)(e||""):"️?";let h=0===c.length?"":`(?:${c.join("|")})`;return h&&d&&(h+="?"),`${p}${h}`}const o="\n",l=new Set(["©","®","™","♟","♾","〰"])},25647:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VARIATION_CATEGORY=t.LARGE_EMOJI_SIZE=t.HEART_EMOJIS=t.EMOJI_WIDTH=t.EMOJI_TYPE=t.CATEGORY_ORDERING=void 0;var i=n(r(69618));const{EMOJI:{ORDERED_CATEGORY_IDS:a}}=i.default;t.EMOJI_TYPE={APPLE:"APPLE",WHATSAPP:"WHATSAPP"};t.EMOJI_WIDTH={small:20,large:32};const s=r(54302).Mirrored(["MEDIUM","LARGE","XLARGE"]);t.LARGE_EMOJI_SIZE=s;const o=[...a,"VARIATION"];t.CATEGORY_ORDERING=o;const l=o.indexOf("VARIATION");t.VARIATION_CATEGORY=l;t.HEART_EMOJIS=["❤️","♥️","🤎","💖","🖤","💚","💜","💗","💓","💙","🤍","💛","💕","🧡","❤️‍🔥"]},46063:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={APPLE:["1d5e731","ba8bdec","2face08","a545008","8874004","c042b58","c3dc945","819bb22","f919b04","f142326","6342703","db8af96","254c6ee","9459d66","b757de6","c5531c6","eee0808","f44302b","0997ed3","5ab9f55","b7a4ec9","9fe8c9b","7934132","c5bfe3a","d9fe696","180bdeb","c65b738","1687c2a","2364fb1","2dac913","0e7766c","ca7e73b","7692c5e","7c4d80d","8cd6ca7","5ad1ddc","9f877c8","27c5d08","3099209","efd3a70","cf951db","2dcac8b","f61ea23","d1aa9c1","a220a6a","af6a7cf","69c3949","52aae5d","fa896fa","e057afe","f610f34","0a28f77","c8c4335","5b8e2f7","8431d9f","bc2093e","41cd719","7ad8d55","56d4834","c12380b","2d91dc3","334914c","3d9393f","4d871e0","24f0539","d55fc7d","38b3000","62ab315","531b804","3ed3a1e","7e1babf","d9c9192","3076c3a","ddf36af","da748cb","3ebbc9f","a33f9a6","bd66159","6df0912","1d628c1","724ef42","08d827e","05a67b6","7816bb1","42974a4","6525db2","aeb25f3","3bed38e","87ef56d","88fbe9c","a843e57","d042204","748969e","c624bfc","f99b5a3","a15a462","6db790b","8f595b1","ed170c1","28caf36","1ec6250","1f54af3","7f43cd3","979a532","9b0ac77","13b8ceb","6639e79","d0b8ff7","e6296a8","42437ce","d59625c","620ec44","5130c11","3745318","1b38856","937b1d8","098fd51","b67d38a","ccea594","80472df","f45a839","c267e9b","6134a43","e3ddadf","217cb2e","27794e6","ce1bca0","2ec6308","dca927a","5099652","8606b5c","ff70a07","99acb30","d0ad76f","10378f5","d69be1f","cd9e3d0","a5ba00a","dc7c828","55c6310","c8df73e"],WHATSAPP:["275ab2d","2daeeb8","2224eba","0b9fe45","17c7395","a55d276","72434c2","1dd3846","270a5f3","7a609af","4bc31db","a662a91","1a6e349","5d916f5","893eec6","6bd244c","d41b50c","1390219","1e2bb45","6fda0bc","5da7428","2a928c7","d0de61a","951eaf0","abf067b","7d8ffef","c3f1765","63c4caa","57db7e9","a5c7aae","3f057f6","3e451ea","8e8748b","9674031","6a75fe0","c5081c9","1b3d484","87ac96a","8af6206","3e4cd80","dea012c","0bfd00d","ac92df9","5988695","7fc1fef","f064985","ffefa9d","35d35a9","c4e922a","7a7637f","bec2fdf","5543365","b434947","59fdfea","3dbba43","9a04fc9","c8efe85","858b6bb","bc37e7d","0df49c7","7e953c6","a99489e","620104d","4775444","838a358","36f0702","73011a9","8830247","4b471be","e607bf5","e4f5f3f","d7e8913","f80d26f","efbc9b8","e8a7519","ec05a92","ad38c5f","33a2551","5e1660c","1395194","c585594","37ebc47","c1eba8a","78e2b60","929560c","fae06f3","4e858e5","428370e","21fa232","8189c09","c7cdfc4","52d7641","10d01ec","251748f","e15b9d8","76c46c9","05bd55e","d321ca5","6fb5d64","6b996dd","1d332e2","d5334af","e41e707","bef85df","87d3d34","db6d4e3","98dee68","03e68f5","338835d","a6b0372","968722c","1d7689c","d50117f","dba5f1b","e030c5c","d4ba921","f4a2a06","1cd377e","21622a3","13dd7ff","fb69465","16c51db","67a21f5","b8dc46e","f501f99","21b8cd1","18851e7","77c853f","0276720","9573645","a609d4f"]}},80439:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEmojiSpritesPath=function(e,t,r,n){const i=(0,o.default)(s.default[e][t],"emojiSpriteHashes[emojiType][bucketId]");return`${c}/emoji-${t}-${r}_${i}.${n}`},t.getGlyphPath=function(e,t,r){return{low:p(`${t}-${"large"===r?"40":"64"}.png`,e.toLowerCase()),high:p(`${t}-64.png`,e.toLowerCase())}};var i=n(r(69618)),a=r(62129),s=n(r(46063)),o=n(r(45095));const{LARGE_EMOJI_BASE_PATH:l,EMOJI_SPRITES_BASE_PATH:c,LARGE_EMOJI_ELECTRON_BASE_PATH:d,EMOJI_SPRITES_ELECTRON_BASE_PATH:u}=i.default;function p(e,t){let r=null;return r=l,`${r}/${a.prefixHash}_${t.slice(0,1)}_${e}`}},70449:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPermutations=t.OPEN_BOX_CHAR=t.EmojiUtil=void 0,t.isBaseCoupleEmoji=function(e){return E.includes(e)};var i=n(r(42905)),a=n(r(88306)),s=n(r(45095)),o=n(r(94184)),l=n(r(41143)),c=n(r(15001)),d=n(r(30600)),u=n(r(69618)),p=r(25647),h=r(80439),f=n(r(97835)),_=n(r(89580));t.OPEN_BOX_CHAR="□";const m=["🏻","🏼","🏽","🏾","🏿"],g=new RegExp(m.join("|"),"g"),y=u.default.EMOJI.BUCKET_SIZE,E=["🧑‍🤝‍🧑","👭","👬","👫","👩‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👨‍❤️‍💋‍👨","💏","👩‍❤️‍👨","👩‍❤️‍👩","👨‍❤️‍👨","💑"],S=p.HEART_EMOJIS.map((e=>e)),v=new Set(["︀","︁","︂","︃","︄","︅","︆","︇","︈","︉","︊","︋","︌","︍","︎","️"]),T=e=>e.replace(/\uFE0F/g,""),A=(0,a.default)(((e,t)=>function r(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(n.length===t)return[n];let i=[];for(let t=0;t<e.length;t++){const a=[...n];a.push(e[t]),i=i.concat(r(a))}return i}()),((e,t)=>e.toString()+t));t.getPermutations=A;function C(e){return e.every((t=>t===e[0]))?e[0]:e.join("")}const b=new class{constructor(){var e=this;this.skinToneVariations=m,this._specialEmojiRegex=null,this.emojiRegex=()=>{const e=this._createEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createEmojiRegexIfNeeded=(0,f.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("("+e+")","g")})),this.onlyEmojiRegex=()=>{const e=this._createOnlyEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createOnlyEmojiRegexIfNeeded=(0,f.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("^("+e+")+$","g")})),this.convertToTextWithoutSpecialEmojis=e=>{if(!this._specialEmojiRegex){const e=(0,d.default)(Object.keys(_.default));this._specialEmojiRegex=new RegExp(`(${e})`,"g")}return this._specialEmojiRegex.lastIndex=0,e.replace(this._specialEmojiRegex,(e=>_.default[e]))},this.splitEmojis=e=>!1===this.containsOnlyEmoji(e)?null:e.split(this.emojiRegex()).filter(Boolean),this.containsEmoji=e=>this.emojiRegex().test(e),this.containsOnlyEmoji=e=>this.onlyEmojiRegex().test(e),this.matchLargeEmojiPattern=e=>{if(e.length>50||e.includes(" "))return null;const t=this._getLargeEmojisRegex().exec(e);return t?t.filter(Boolean).slice(1):null},this.normalizeEmojiFromString=e=>this.normalizeEmoji(e),this.normalizeEmoji=e=>{const t=T(e),{unqualifiedToNormalizedEmoji:r}=this._getDerivedMaps();return r.get(t)},this.normalizeAllEmojis=(0,a.default)((e=>e?e.replace(this.emojiRegex(),((e,t)=>{var r;return v.has(t)?"":null!==(r=this.normalizeEmoji(t))&&void 0!==r?r:"□"})):"")),this.getSkinToneVariant=(e,t)=>{const r=this._getBaseToSkinToneEmojis().get(e);if(null==r)return null;const n=C(t);return r.get(n)},this._getDerivedMaps=(0,f.default)((()=>{const{orderedEmojis:e,legacyToEmoji:t}=this._getConfig(),r=new Map,n=new Map,a=new Map;let s=0;return e.forEach(((e,t)=>{if(""===e||null==e)return;(Array.isArray(e)?e:[e]).forEach((e=>{n.set(e,t);const r=T(e);a.set(r,e)})),r.set(t,s),s++})),(0,i.default)(t).forEach((e=>{let[t,r]=e;n.set(t,r);const i=T(t);a.set(i,t)})),{emojiToGlyphId:n,glyphIdToIndex:r,unqualifiedToNormalizedEmoji:a}})),this._getBaseToSkinToneEmojis=(0,f.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps(),t=new Map;for(const r of e.keys()){let e;const n=r.replace(g,(t=>(null==e&&(e=[]),e.push(t),"")));if(null==e)continue;const i=e;let a;a="👩‍🤝‍👩"===n?"👭":"👨‍🤝‍👨"===n?"👬":"👩‍🤝‍👨"===n?"👫":"🧑‍❤️‍🧑"===n?"💑":"🧑‍❤️‍💋‍🧑"===n?"💏":n;const s=this.normalizeEmoji(a);if(null==s)continue;let o=t.get(s);null==o&&(o=new Map,o.set("",s),t.set(s,o));const l=C(i);o.set(l,r)}return t})),this._getSkinToneEmojisToBase=(0,f.default)((()=>{const e=new Map;for(const[t,r]of this._getBaseToSkinToneEmojis().entries())for(const n of r.values())e.set(n,t);return e})),this._getEmojiRegexSource=(0,f.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps();return(0,d.default)([...e.keys(),...v].filter(Boolean))})),this._createLargeEmojisRegexIfNeeded=(0,f.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp(`^(${e})(${e})?(${e})?$`)})),this.getEmojisInCategory=e=>{var t;return null!==(t=this._getConfig().categorizedEmojis[e])&&void 0!==t?t:[]},this._getEmojiToCategory=(0,f.default)((()=>{const{categorizedEmojis:e}=this._getConfig(),t=new Map;return Object.keys(e).forEach((r=>{const n=p.CATEGORY_ORDERING.indexOf(r);e[r].forEach((e=>{const r=this.normalizeEmoji(e);null!=r&&t.set(r,n)}))})),t})),this.getGlyphId=e=>{const t=this.normalizeEmoji(e);if(null==t)return null;const{emojiToGlyphId:r}=this._getDerivedMaps();return r.get(t)},this.getGlyphPath=(e,t)=>(0,h.getGlyphPath)(this._getConfig().emojiType,e,t),this.isGlyphCached=e=>{const t=this._getGlyphIndex(e);return this._getCachedGlyphs().get(t)},this.markGlyphCached=e=>{const t=this._getGlyphIndex(e);this._getCachedGlyphs().set(t)},this._getCachedGlyphs=(0,f.default)((()=>new c.default(this._getGlyphCount()))),this.getCssClasses=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";return(0,o.default)(`b${e.getBucket(t)}`,"small"===r?"emoji":"emojik",e._getConfig().emojiType===p.EMOJI_TYPE.APPLE?"apple":"wa")},this.getStyle=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";const{xpos:n,ypos:i}=e._getCoordinates(t,r);return{backgroundPosition:`-${n}px -${i}px`}},this.getBucket=e=>{const t=this._getGlyphIndex(e);return`${Math.floor(t/y)}`},this.getHeartEmojis=(0,f.default)((()=>S.map(this.normalizeEmoji).filter(Boolean))),this._getLastBucketId=(0,f.default)((()=>{const e=this._getGlyphCount();return e-e%y})),this._getLastBucketCols=(0,f.default)((()=>Math.floor(Math.sqrt(this._getGlyphCount()-this._getLastBucketId()))))}configure(e){e!==this._config&&(this._config=e,this.getHeartEmojis.reset(),this._specialEmojiRegex=null,this._createEmojiRegexIfNeeded.reset(),this._createLargeEmojisRegexIfNeeded.reset(),this._createOnlyEmojiRegexIfNeeded.reset(),this._getEmojiRegexSource.reset(),this._getCachedGlyphs.reset(),this._getSkinToneEmojisToBase.reset(),this._getBaseToSkinToneEmojis.reset(),this._getEmojiToCategory.reset(),this._getLastBucketId.reset(),this._getLastBucketCols.reset(),this._getDerivedMaps.reset())}_getConfig(){return(0,l.default)(null!=this._config,"Attempt to use EmojiUtil before it's been configured"),this._config}isEmoji(e){return null!=this.normalizeEmoji(e)}getSkinToneBase(e){var t;const r=this.normalizeEmoji(e);return null==r?null:null!==(t=this._getSkinToneEmojisToBase().get(r))&&void 0!==t?t:null}_getLargeEmojisRegex(){const e=this._createLargeEmojisRegexIfNeeded();return e.lastIndex=0,e}_getGlyphCount(){const{glyphIdToIndex:e}=this._getDerivedMaps();return e.size}_getCoordinates(e,t){const r=this._getGlyphIndex(e),n=r%y,i=r>=this._getLastBucketId()?this._getLastBucketCols():Math.floor(Math.sqrt(y)),a=p.EMOJI_WIDTH[t],s=Math.floor(n/i);return{xpos:Math.floor(n%i)*a,ypos:s*a,width:a}}_getGlyphIndex(e){const{glyphIdToIndex:t}=this._getDerivedMaps();return(0,s.default)(t.get(e),"glyphIdToIndex.get(glyphId)")}getEmojiAggregate(e){return this.removeSkinTone(this.getNormalizedOrTofu(e))}removeSkinTone(e){return e}getNormalizedOrTofu(e){return this.normalizeEmojiFromString(e)?e:"□"}};t.EmojiUtil=b},10786:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteEncKeysAndCache=function(){return u.apply(this,arguments)},t.generateFinalDbEncryptionAndFtsKeyForInvoker=function(e){return(0,s.get)().generateFinalDbEncryptionAndFtsKey(e)},t.initEncSalt=function(){return c.apply(this,arguments)},t.initEncSaltForInvoker=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(88102),s=r(77303);let o=null;o=r(15998).DbEncKeyStore;let l=null;function c(){return(c=(0,i.default)((function*(){var e;if(null==l){const e=r(73368).nx;l=e()}const t=yield l;if(t&&t.constructor===Uint8Array)return null===(e=o)||void 0===e?void 0:e.init(t)}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){if(null==l){const e=r(73368).nx;l=e()}const e=yield l;e&&e.constructor===Uint8Array&&(0,s.get)().initDatabaseEncnKey(e)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){var e;yield Promise.all([null===(e=o)||void 0===e?void 0:e.deleteKeys(),(0,s.get)().deleteDbEncKeyCache()])}))).apply(this,arguments)}a.Cmd.on("logout",(()=>{l=Promise.resolve(null)}))},73368:(e,t,r)=>{"use strict";t.cn=function(){(0,a.setWebEncSalt)(null)},t.nx=function(){const e=!!(0,n.getMaybeMeUser)();let t=null;e||(t=new Uint8Array(128),self.crypto.getRandomValues(t),t=btoa(String.fromCharCode(...new Uint8Array(t))),(0,a.setWebEncSalt)(t));t=(0,a.getWebEncSalt)(),null==t&&(__LOG__(4,void 0,new Error)`[DB ENC CRITICAL ERROR] null returned for local enc salt`,s.Socket.logout(!1,i.LogoutReason.ClientFatalError));return t=Uint8Array.from(atob(t),(e=>e.charCodeAt(0))),Promise.resolve(t)};var n=r(99234),i=r(83578),a=r(58052),s=r(65044)},95738:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeBroadcastEphemeralSetting=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(15688),s=r(8584),o=r(92844),l=r(84902),c=r(28286);const d=new Uint8Array(32);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const r=yield self.crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveKey"]),n=yield self.crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:d,info:t},r,{name:"HMAC",hash:"SHA-256"},!0,["verify"]);return self.crypto.subtle.exportKey("raw",n)}))).apply(this,arguments)}function h(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r){const n=e.slice(0,12),i=e.slice(12,44),a=yield self.crypto.subtle.importKey("raw",i,"AES-GCM",!1,["decrypt"]);return self.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(n),additionalData:r},a,t)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,r,n,i){const d=e.toString({legacy:!0}),p=t.toString({legacy:!0}),f=r.toString({legacy:!0}),_=s.Binary.build(`Ephemeral ${p} ${d}`).readByteArray(),m=new Uint8Array(i),g=(0,a.decodeB64)(n),y=s.Binary.build(f).readBuffer(),E=yield u(m,_),S=yield h(E,g,y),{duration:v,timestamp:T}=(0,l.decodeProtobuf)(c.EphemeralSettingSpec,S);if(null==v||null==T)throw new Error("ephSetting decoded into malformed proto");return{ephemeralDuration:v,ephemeralSettingTimestamp:(0,o.castLongIntToUnixTime)(T)}}))).apply(this,arguments)}},96751:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisappearingModeInitiator=void 0;const n=r(54302)({ChangedInChat:"chat",InitiatedByMe:"me",InitiatedByOther:"other"});t.DisappearingModeInitiator=n},40763:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEphemeralSystemMessage=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(22683),s=n(r(69618)),o=r(99234),l=r(7293),c=n(r(32219)),d=r(15860);function u(){return(u=(0,i.default)((function*(e,t){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const n=r(5819).handleSingleMsgMD,i={id:new c.default({id:(0,d.newTag)(),remote:e.id,fromMe:!1}),from:e.id,to:(0,o.getMaybeMeUser)(),t:a.Clock.globalUnixTime(),type:s.default.MSG_TYPE.PROTOCOL,subtype:"ephemeral_setting",ephemeralDuration:t,isNewMsg:!0};yield n(e.id,i,!1,!1)}}))).apply(this,arguments)}},242:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingModeSettingForChat=function(e){const t=c((0,s.getMaybeMeUser)()),r=c(e);if(!t&&!r)return null;if(t&&r)return r.duration<t.duration?r:t;return null!=r?r:t},t.getDisappearingModeSettingForUser=c,t.getDisappearingModeSettingFromMsg=function(e){var t;if(null==e)return null;const r=c((0,s.getMaybeMeUser)());let n=e.disappearingModeInitiator;if(null!=r&&null==e.disappearingModeInitiator)return r;if(null==r&&e.disappearingModeInitiator===a.DisappearingModeInitiator.InitiatedByMe)n=a.DisappearingModeInitiator.ChangedInChat;else if(null!=e.disappearingModeInitiator&&e.disappearingModeInitiator===a.DisappearingModeInitiator.ChangedInChat)return null;if(null==n)return null;const i=e.ephemeralDuration,o=null!==(t=e.ephemeralSettingTimestamp)&&void 0!==t?t:0;if(null==i||0===i)return null;if(null!=r&&r.settingTimestamp>o)return r;return{duration:i,settingTimestamp:o,initiator:n}};var i=r(19380),a=r(96751),s=r(99234),o=r(7293),l=n(r(68132));function c(e){var t;const r=(0,s.getMaybeMeUser)().toString()===e.toString(),n=i.ContactCollection.get(e);if(!n)return null;let c=n.disappearingModeDuration,d=n.disappearingModeSettingTimestamp;return!o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&r&&(c=l.default.disappearingMode.duration,d=l.default.disappearingMode.settingTimestamp),null==c||0===c?null:(__LOG__(2)`disappearing mode setting fetched for ${e.toString()}: duration=${c} settingTimestamp=${d}`,{duration:c,settingTimestamp:null!==(t=d)&&void 0!==t?t:0,initiator:r?a.DisappearingModeInitiator.InitiatedByMe:a.DisappearingModeInitiator.InitiatedByOther})}},82142:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEphemeralExpirationTimestamp=function(e,t,r,n,i){if("ephemeral_setting"===n)return null;if(null==e||0===e)return null;if(i&&null!=t)return t+e;return r+e}},4914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEphemeralDurationAllowed=function(e){return!(e<0)&&(0===e||n.ServerProps.getEphemeralMessagesAllowedValues().includes(e))};var n=r(64551)},31035:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUpdateEphemeralSetting=function(e){const{oldDuration:t,oldSettingTimestamp:r,newDuration:i,newSettingTimestamp:a,chatId:s}=e;return a>r||!(a<r)&&(t!==i&&!(0,n.getMaybeMeUser)().isLessThan(s))};var n=r(99234)},96222:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=n(r(48926));function a(){return(a=(0,i.default)((function*(){const e=navigator.storage;if(null==(null==e?void 0:e.estimate))return null;const t=yield e.estimate();let{usage:r,quota:n,usageDetails:i}=t;Number.isFinite(r)||(r=0),Number.isFinite(n)||(n=0);return{usage:r,quota:n,available:n-r,caches:null==i?void 0:i.caches}}))).apply(this,arguments)}},34342:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(73955)),a=n(r(41609)),s=n(r(51463));const o=/\s+/;t.default=class{on(e,t,r){if(!t)return this;if("function"!=typeof t)throw new Error("Callback parameter passed is not a function");return this._multiEvent(this.on,...arguments)||this._getOrCreateEvents(e).push({callback:t,context:r,ctx:r||this}),this}once(e,t,r){if(!t)return this;if(this._multiEvent(this.once,...arguments))return this;const n=this,i=(0,s.default)((function(){n.off(e,i),t.apply(this,arguments)}));return i._callback=t,this.on(e,i,r)}off(e,t,r){const n=this._events;if(!n)return this;if(this._multiEvent(this.off,...arguments))return this;if(!e&&!t&&!r)return this._events=void 0,this;const i=e?[e]:Object.keys(n);for(let e=0;e<i.length;e++){const a=i[e],s=n[a];if(s){if(n[a]=[],t||r)for(let e=0;e<s.length;e++){const i=s[e];(t&&t!==i.callback&&t!==i.callback._callback||r&&i.context!==r)&&n[a].push(i)}n[a].length||delete n[a]}}return this}trigger(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(!this._events)return this;if(this._multiEvent(this.trigger,...arguments))return this;const i=this._getEvents(e),a=this._getEvents("all");return i&&this._triggerEvents(i,r),a&&this._triggerEvents(a,arguments),this}stopListening(e,t,r){const n=this._listeningTo;if(!n)return this;const i=null==e?void 0:e._listenId,s=i?{[i]:e}:n;for(const e in s){const i=s[e];i.off(t,r,this),(!t&&!r||(0,a.default)(i._events))&&delete n[e]}return(0,a.default)(this._listeningTo)&&delete this._listeningTo,this}listenTo(e,t,r){return r?(this._addListeningTo(e),e.on(t,r,this),this):this}listenToOnce(e,t,r){return this._addListeningTo(e),e.once(t,r,this),this}listenToAndRun(e,t,r){return this.listenTo.apply(this,arguments),r.apply(this),this}isListening(e){const t=this._events;return!!t&&("string"==typeof e?!!t[e]:(0,a.default)(t))}_addListeningTo(e){(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=(0,i.default)("l"))]=e}_getOrCreateEvents(e){const t=this._events||(this._events={});return t[e]||(t[e]=[])}_getEvents(e){if(!e)return;const t=this._events;return t?t[e]:void 0}_multiEvent(e,t){if(o.test(t)){const a=t.split(o);for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];for(let t=0;t<a.length;t++)e.call(this,a[t],...n);return!0}return!1}_triggerEvents(e,t){let r,n=-1;const i=e.length,a=t[0],s=t[1],o=t[2];switch(t.length){case 0:for(;++n<i;)(r=e[n]).callback.call(r.ctx);return;case 1:for(;++n<i;)(r=e[n]).callback.call(r.ctx,a);return;case 2:for(;++n<i;)(r=e[n]).callback.call(r.ctx,a,s);return;case 3:for(;++n<i;)(r=e[n]).callback.call(r.ctx,a,s,o);return;default:for(;++n<i;)(r=e[n]).callback.apply(r.ctx,t)}}bind(){return this.on(...arguments)}unbind(){return this.off(...arguments)}removeListener(){return this.off(...arguments)}removeAllListeners(){return this.off()}emit(){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return this.trigger(arguments)}}},64103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateImmediately=t.Unmount=t.UnableToPlayVideoError=t.UnableToGetContentLengthError=t.TranscodeBlobTooLargeError=t.SourceUnavailableError=t.SocketNotOpen=t.SocketError=t.SocketClosed=t.ShouldLoop=t.ServerStatusError=t.QueryDrop=t.ProtoVersionUndefined=t.OverconstrainedError=t.Offline=t.NotSupportedError=t.NotFoundError=t.NotAllowedError=t.ModelError=t.ModelCreateError=t.MediaUnsupportedError=t.MediaNeedsReupload=t.MediaMissing=t.MediaLoadError=t.MediaFileFailedLoad=t.MediaFileError=t.MediaFileEmpty=t.MediaEncryptionError=t.MediaDragDropError=t.MediaDecryptionError=t.InvalidServerResponseError=t.InvalidMediaFileType=t.InvalidImageFileType=t.ImageError=t.GaveUpRetry=t.GUMError=t.GUM=t.FileNotReadableError=t.EncodeWebpError=t.Disconnected=t.DeprecatedProtocolVersion=t.DecodeWebpResultsError=t.DbOnLogoutAbort=t.DbMsgEncKeyNotLoaded=t.DbEncKeyNotLoaded=t.DBInvalidFtsHMACKey=t.ConstraintNotSatisfiedError=t.CatalogImageDownloadError=t.CapabilityUnknown=t.CapabilityInvalid=t.CapabilityError=t.CanNotSendUnencrypted=t.BlockedByProxy=t.BingServerError=t.ActiveChatChanged=t.ActionError=t.AbortError=void 0;var n=r(40265);class i extends((0,n.customError)("QueryDrop")){}t.QueryDrop=i;class a extends((0,n.customError)("Disconnected")){}t.Disconnected=a;class s extends((0,n.customError)("Offline")){}t.Offline=s;class o extends((0,n.customError)("ShouldLoop")){}t.ShouldLoop=o;class l extends((0,n.customError)("GaveUpRetry")){}t.GaveUpRetry=l;class c extends((0,n.customError)("CatalogImageDownloadError")){}t.CatalogImageDownloadError=c;class d extends((0,n.customError)("MediaFileError")){}t.MediaFileError=d;class u extends((0,n.customError)("InvalidImageFileType",!0,d)){}t.InvalidImageFileType=u;class p extends((0,n.customError)("InvalidMediaFileType",!0,d)){}t.InvalidMediaFileType=p;class h extends((0,n.customError)("MediaEncryptionError",!0,d)){}t.MediaEncryptionError=h;class f extends((0,n.customError)("MediaDecryptionError",!0,d)){}t.MediaDecryptionError=f;class _ extends((0,n.customError)("MediaFileFailedLoad",!0,d)){}t.MediaFileFailedLoad=_;class m extends((0,n.customError)("MediaFileEmpty",!0,d)){}function g(e){try{return JSON.stringify(e)}catch(t){return e.toString()}}t.MediaFileEmpty=m;class y extends((0,n.customError)("SocketError")){constructor(e){super("string"==typeof e?e:g(e)),this.event=e}}t.SocketError=y;class E extends((0,n.customError)("SocketClosed")){constructor(e){super("string"==typeof e?e:g(e)),this.event=e}}t.SocketClosed=E;class S extends((0,n.customError)("SocketNotOpen")){constructor(e){super(`socket not open, is ${e}`)}}t.SocketNotOpen=S;class v extends((0,n.customError)("BlockedByProxy")){}t.BlockedByProxy=v;class T extends((0,n.customError)("ImageError")){constructor(e,t){super("Image failed to load."),this.src=e,this.status=t,this.target={src:e,status:t}}}t.ImageError=T;class A extends((0,n.customError)("DecodeWebpResultsError")){constructor(e,t){super(e),this.event=t}}t.DecodeWebpResultsError=A;class C extends((0,n.customError)("DecodeWebpError")){constructor(e,t){super(e),this.event=t}}t.EncodeWebpError=C;class b extends((0,n.customError)("ServerStatusError")){constructor(e,t,r){super(`${e||"Server replied with a failed status code"}: ${r}`),this.url=t,this.status=r}}t.ServerStatusError=b;class P extends((0,n.customError)("InvalidServerResponseError")){constructor(e,t,r){let n=`Invalid response for ${e}, with status ${t}`;r&&(n=`${n}: ${r}`),super(n)}}t.InvalidServerResponseError=P;class M extends((0,n.customError)("BingServerError",!0,b)){constructor(e,t,r){super(`Error ${t} for ${e}: ${JSON.stringify(r)}`,e,t)}}t.BingServerError=M;class O extends((0,n.customError)("MediaNeedsReupload")){}t.MediaNeedsReupload=O;class I extends((0,n.customError)("MediaMissing")){}t.MediaMissing=I,I.message="Media is no longer available on your phone";class w extends((0,n.customError)("FileNotReadableError",!0,Error)){}t.FileNotReadableError=w;class R extends((0,n.customError)("MediaLoadError")){constructor(e){super(e),this.src=e}}t.MediaLoadError=R;class D extends((0,n.customError)("TranscodeBlobTooLargeError")){constructor(){super("Transcode blob too large")}}t.TranscodeBlobTooLargeError=D;class N extends((0,n.customError)("UnableToPlayVideoError")){constructor(e){super(`Unable to play video. Reason: ${String(e)}`)}}t.UnableToPlayVideoError=N;class L extends((0,n.customError)("MediaDragDropError",!0,R)){}t.MediaDragDropError=L;class k extends((0,n.customError)("MediaUnsupportedError")){}t.MediaUnsupportedError=k,k.message="Media format is unsupported";class G extends((0,n.customError)("ModelError")){}t.ModelError=G;class U extends((0,n.customError)("ModelCreateError")){constructor(e,t){super(e),this.model=t}}t.ModelCreateError=U;class F extends((0,n.customError)("DbEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseEncryptionKey.${e} was accessed before init`)}}t.DbEncKeyNotLoaded=F;class x extends((0,n.customError)("DbMsgEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseMessageEncryptionKey.${e} was accessed before init`)}}t.DbMsgEncKeyNotLoaded=x;class B extends((0,n.customError)("DbOnLogoutAbortError")){}t.DbOnLogoutAbort=B,B.message="DB operation was dropped due to logout activity";class K extends((0,n.customError)("DBExpiredFtsHMACKey")){}t.DBInvalidFtsHMACKey=K,K.message="MasterDatabaseEncryptionKey.fts_hmac_keys is in an invalid state";class Y extends((0,n.customError)("ProtoVersionUndefined")){}t.ProtoVersionUndefined=Y;class j extends((0,n.customError)("UpdateImmediately")){}t.UpdateImmediately=j;class W extends((0,n.customError)("DeprecatedProtocolVersion")){}t.DeprecatedProtocolVersion=W;class H extends((0,n.customError)("CapabilityError")){}t.CapabilityError=H;class V extends((0,n.customError)("CapabilityInvalid",!0,H)){}t.CapabilityInvalid=V;class $ extends((0,n.customError)("CapabilityUnknown",!0,H)){}t.CapabilityUnknown=$;class z extends((0,n.customError)("CanNotSendUnencrypted")){}t.CanNotSendUnencrypted=z;class q extends((0,n.customError)("ActionError")){}t.ActionError=q,q.message="Could not perform action.";class J extends((0,n.customError)("Unmount")){}t.Unmount=J;class Q extends((0,n.customError)("ActiveChatChanged")){}t.ActiveChatChanged=Q;class X extends((0,n.customError)("GUMError")){}t.GUMError=X;class Z extends((0,n.customError)("NotSupportedError",!0,X)){}t.NotSupportedError=Z,Z.message="The operation is not supported.";class ee extends((0,n.customError)("NotAllowedError",!0,X)){}t.NotAllowedError=ee,ee.message="The user did not grant permission for the operation";class te extends((0,n.customError)("ConstraintNotSatisfiedError",!0,X)){}t.ConstraintNotSatisfiedError=te,te.message="One of the mandatory Constraints could not be satisfied.";class re extends((0,n.customError)("OverconstrainedError",!0,X)){}t.OverconstrainedError=re,re.message="Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.";class ne extends((0,n.customError)("NotFoundError",!0,X)){}t.NotFoundError=ne,ne.message="The object can not be found here.";class ie extends((0,n.customError)("AbortError",!0,X)){}t.AbortError=ie,ie.message="The operation was aborted.";class ae extends((0,n.customError)("SourceUnavailableError",!0,X)){}t.SourceUnavailableError=ae,ae.message="The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process).";class se extends((0,n.customError)("UnableToGetContentLengthError")){}t.UnableToGetContentLengthError=se,se.message="Failed to get media contentLength from mms";const oe={GUMError:X,NotSupportedError:Z,NotAllowedError:ee,ConstraintNotSatisfiedError:te,OverconstrainedError:re,NotFoundError:ne,AbortError:ie,SourceUnavailableError:ae};t.GUM=oe},96384:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORM=t.FAQ_BASE_URL=void 0,t.getBusinessFaqUrl=function(){return o("general/chats/about-chatting-with-businesses")},t.getCannotConnectFaqUrl=function(){return o("web/troubleshooting/cant-connect-to-whatsapp-web-or-desktop")},t.getCatalogCartOnOffFaqUrl=function(){return o("general/account-and-profile/about-cart")},t.getCiphertextFaqUrl=function(){return o("general/security-and-privacy/seeing-waiting-for-this-message-this-may-take-a-while")},t.getCodeChangeFaqUrl=function(){return o("general/security-and-privacy/security-code-change-notification")},t.getE2EEnterpriseFaqUrl=function(){return o("general/security-and-privacy/end-to-end-encryption-for-business-messages")},t.getE2EFaqUrl=function(){return o("general/security-and-privacy/end-to-end-encryption")},t.getEphemeralFaqUrl=function(){return o("general/chats/about-disappearing-messages")},t.getFanoutPlaceholderFaqUrl=function(){return o("general/security-and-privacy/seeing-waiting-for-this-message-check-your-phone")},t.getFaqUrl=function(){return`${a}/web?lang=${i.default.getLocale()}`},t.getFrequentlyForwardedFaqUrl=function(){return o("general/chats/about-forwarding-limits")},t.getGroupInviteGrowthLockedFaqUrl=function(){return o("cxt/?entrypointid=invite-via-link-unavailable",!0)},t.getLoginFaqUrl=function(){return o("web/download-and-installation/how-to-log-in-or-out")},t.getMDCodeChangeFaqUrl=function(){return`${a}/${i.default.getLocale()}/web/26000361`},t.getMdOptInFaqUrl=function(){return o("general/download-and-installation/about-linked-devices")},t.getNonVerifiedTransitionFaqUrl=function(){return o("general/business-account-becomes-a-standard-account")},t.getNotificationChromeFaqUrl=function(){return o("web/troubleshooting/cant-receive-notifications-on-chrome")},t.getNotificationEdgeFaqUrl=function(){return o("web/troubleshooting/cant-receive-notifications-on-microsoft-edge")},t.getNotificationFirefoxFaqUrl=function(){return o("web/troubleshooting/cant-receive-notifications-on-firefox")},t.getNotificationOperaFaqUrl=function(){return o("web/troubleshooting/cant-receive-notifications-on-opera")},t.getNotificationSafariFaqUrl=function(){return o("web/troubleshooting/cant-receive-notifications-on-safari")},t.getRevokeFaqUrl=function(){return o("web/chats/how-to-delete-messages")},t.getSupportChatFaqUrl=function(){return o("general/what-information-does-whatsapp-collect-when-you-contact-support")},t.getSupportChatSafetyFaqUrl=function(){return o("general/about-safely-communicating-with-whatsapp-support")},t.getSuspiciousLinkFaqUrl=function(){return o("web/chats/suspicious-links")},t.getUnverifiedTransitionFaqUrl=function(){return o("general/business-account-becomes-unverified")},t.getVerifiedHighFaqUrl=function(){return o("general/verified-business-account")},t.getVerifiedLowUnknownFaqUrl=function(){return o("general/unverified-business-account")},t.getVerifiedTransitionFaqUrl=function(){return o("general/business-account-becomes-verified")},t.getViewOnceFaqUrl=function(){return o("general/chats/about-view-once")};var i=n(r(43725));const a="https://faq.whatsapp.com";t.FAQ_BASE_URL=a;const s="web";function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?`${a}/${e}&platform=web&lang=${i.default.getLocale()}`:`${a}/${e}?lang=${i.default.getLocale()}`}t.PLATFORM=s},44365:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.detectWebpSupport=function(){return o.apply(this,arguments)},t.getCachedWebpSupport=function(){return s};var i=n(r(48926));const a=(0,r(38284).promiseTimeout)(new Promise((e=>{Modernizr.on("webp",e)})).then((e=>!(!e||!e.valueOf()))),5e3).catch((()=>!1));let s=null;function o(){return(o=(0,i.default)((function*(){if(s)return Promise.resolve(s);const e=yield a;return s=e,e}))).apply(this,arguments)}},1063:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FILETYPE=void 0,t.blobToArrayBuffer=c,t.blobToText=function(){return h.apply(this,arguments)},t.copyFile=function(e){return c(e).then((t=>{const{lastModified:r,type:n,name:i}=e;return p([t],i,{lastModified:r,type:n})}))},t.createFile=p,t.getAudioDuration=function(e){let t,r;return new Promise(((n,i)=>{t=document.createElement("audio"),t.addEventListener("loadeddata",n),t.addEventListener("error",(()=>{i(new Error("getAudioDuration: error loading audio"))})),t.src=r=URL.createObjectURL(e)})).then((()=>~~t.seekable.end(0))).finally((()=>{r&&URL.revokeObjectURL(r)}))},t.getFileExtension=u,t.getMimeTypeForFilepath=function(e){const t=u(e),r=(0,s.isAllowedDocumentMimetype)(s.EXT_TO_MIME&&t&&s.EXT_TO_MIME[t],e,!1);if(r)return r},t.removeTrailingDots=d,t.typeFromMimetype=function(e){const t=e.split("/")[0];switch(t){case o.IMAGE:case o.VIDEO:case o.AUDIO:return t;default:return o.DOCUMENT}},t.validateBlob=function(e){return c(e.webkitSlice?e.webkitSlice(0,1):e.slice(0,1)).then((e=>1===e.byteLength)).catch((()=>!1))};var i=n(r(48926)),a=r(60363),s=r(43257);const o=Object.freeze({IMAGE:"image",VIDEO:"video",AUDIO:"audio",DOCUMENT:"document",STICKER:"sticker"});t.FILETYPE=o;const l=e=>{var t;return null!==(t=null==e?void 0:e.message)&&void 0!==t?t:""};function c(e){let t;return new Promise(((r,n)=>{t=new FileReader,t.onload=r,t.onerror=()=>{var e;n("NotReadableError"===(null===(e=t.error)||void 0===e?void 0:e.name)?new a.FileNotReadableError(`blobToArrayBuffer error: ${l(t.error)}`):new Error(`blobToArrayBuffer error: ${l(t.error)}`))},t.onabort=()=>{n(new Error(`blobToArrayBuffer abort: ${l(t.error)}`))},t.readAsArrayBuffer(e)})).then((()=>t.result))}function d(e){return e.replace(/\.+$/,"")}function u(e){const t=d(e.trimRight()).split(".");return t.length>1?t[t.length-1].toLowerCase():null}function p(e,t,r){const n=new Blob(e,r||{});return n.name=t,n}function h(){return(h=(0,i.default)((function*(e){if("function"==typeof e.text)return e.text();const t=new FileReader;if(yield new Promise(((r,n)=>{t.onload=r,t.onerror=e=>{n(new Error(`blobToText error: ${String(e)}`))},t.onabort=e=>{n(new Error(`blobToText abort: ${String(e)}`))},t.readAsText(e)})),t.result instanceof ArrayBuffer)throw new TypeError("blobToText error: Invalid result type: ArrayBuffer");if(null==t.result)throw new TypeError("blobToText: Invalid result type: null");return t.result}))).apply(this,arguments)}},21790:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Object.keys(e).reduce(((t,r)=>(null!=e[r]&&(t[r]=e[r]),t)),{})}},29498:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forbiddenAssertDOMNode=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.HTMLElement;const r=i(e,t);if(r)return r;throw new Error(`[ForbiddenAssertDOMNode] findDOMNode returned ${String(r)} with component ${String(e)}`)},t.forbiddenFindDOMNode=i;var n=r(73935);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.HTMLElement;const r=(0,n.findDOMNode)(e);if(r){if(r instanceof t)return r;throw new Error(`[forbiddenFindDOMNode] returned node not instance of ${String(t)}`)}return r}},71378:(e,t)=>{"use strict";function r(){let e={},t={},r={};const n={},i=Object.getOwnPropertyNames(window),a=Object.getOwnPropertyNames(document),s=Array.prototype.slice.call(window.document.documentElement.attributes);function o(e,t){const r={};return e.map((e=>{r[e]=!!t.includes(e)})),r}return t=o(["_phantom","__nightmare","_selenium","callPhantom","callSelenium","_Selenium_IDE_Recorder"],i),e=o(["__webdriver_evaluate","__selenium_evaluate","__webdriver_script_function","__webdriver_script_func","__webdriver_script_fn","__fxdriver_evaluate","__driver_unwrapped","__webdriver_unwrapped","__driver_evaluate","__selenium_unwrapped","__fxdriver_unwrapped"],a),r=o(["selenium","webdriver","driver"],s),t.wd=window.navigator.webdriver,n.wKeys=t,n.dKeys=e,n.dElKeys=r,n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={getAutoToolsProperties:()=>({data:r()})};t.default=n},74036:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{chat:t,undelivered:r,canForward:n,cannotForward:o}=e;const l=n.length-r.length,c=o.length+r.length,d=t.isUser?{contact:t.formattedTitle}:{};if(l>0)return r.length?o.length?s.default.t(267,(0,i.default)({count:c,_plural:c},d)):s.default.t(266,{count:c,_plural:c}):s.default.t(264,{count:c,_plural:c,contact:t.formattedTitle});if(r.length)return o.length?s.default.t(268,d):a.default._("No messages could be forwarded because the file is missing.",null,{hk:"1dn9Vk"});return s.default.t(265,d)};var i=n(r(81109)),a=n(r(48360)),s=n(r(43725))},76589:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:String,a=(0,i.default)(e,t.map(n)).join("");const s=r?4e3:Number.POSITIVE_INFINITY;a.length>s&&(a=a.slice(0,s).replace(/\s+$/," [truncated]"));return a};var i=n(r(30138))},70014:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatNFMText=function(e){return e.caption||""}},45126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("ForwardError")){constructor(e){super(),this.reasons=e}}t.default=i},38034:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aspectRatioScaled=function(e,t){return"number"!=typeof e||e<0||e!=e?{width:t,height:t}:e>1?{width:t,height:Math.max(t/e,1)}:{width:Math.max(t*e,1),height:t}},t.boundHeightWidth=function(e,t,r){let n=null!=t?t:r,i=null!=e?e:r;n>i?n>r&&(i*=r/n,n=r):i>r&&(n*=r/i,i=r);return{width:Math.max(n,1),height:Math.max(i,1)}},t.rotatePoint=function(e,t,r){const n=r*Math.PI/180;return{x:Math.cos(n)*e+Math.sin(n)*t,y:-Math.sin(n)*e+Math.cos(n)*t}}},32990:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFbBrandedNumber=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){return(0,n.getABPropConfigValue)("system_msg_numbers_fb_branded").split(",").includes(e)}return!1},t.getIsInternalNumber=function(e){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND)){const t=(0,n.getABPropConfigValue)("system_msg_numbers_fb_branded").split(","),r=(0,n.getABPropConfigValue)("system_msg_numbers_fb_inc").split(",");return t.includes(e)||r.includes(e)}return a.has(e)};var n=r(86945),i=r(7293);const a=new Set(["16505434800","16503130062","16507885324","16508620604","16504228206","16505212669","447710173736","16507885280","19032707825","16505361212","16508129150","16315555102","0"])},24238:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(n.GK.supportsFeature(n.GK.F.MD_BACKEND)){const t=(0,i.getABPropConfigValue)("in_app_support_v2_numbers");return null!=t&&""!==t&&t.split(",").includes(e)}return!1};var n=r(7293),i=r(86945)},39428:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n=document.getElementById("hard_expire_time");let i=null==n||null===(r=n.dataset)||void 0===r?void 0:r.time;i||(__LOG__(3)`hard expire time not found on dom, using fallback of 1572566400 (2019/11/1)`,i="1572566400");var a=i;t.default=a},12206:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_SALT=void 0,t.expand=l,t.extract=o,t.extractAndExpand=function(e,t,r){return o(e,s).then((e=>l(e,t,r)))};var i=r(8584),a=n(r(39827));const s=new Uint8Array(32).buffer;function o(e,t){return new a.default(new Uint8Array(t)).sign(new Uint8Array(e))}function l(e,t,r){if(r<0||r>8160)return Promise.reject(new Error(`HKDF::expand given bad length ${r}`));const n=Math.ceil(r/32),s=i.Binary.build(t).readByteArray(),o=new i.Binary,l=new a.default(e);let c=Promise.resolve(new Uint8Array(0));for(let e=1;e<=n;e++)c=c.then((t=>{const r=new Uint8Array(t.length+s.length+1);return r.set(t),r.set(s,t.length),r[t.length+s.length]=e,l.sign(r)})).then((e=>{const t=new Uint8Array(e);return o.writeByteArray(t),t}));return c.then((()=>o.readBuffer(r)))}t.DEFAULT_SALT=s},55414:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SpecialKeyMap=t.HotKeys=void 0;var i=n(r(81109)),a=n(r(6479)),s=n(r(52628)),o=r(67294),l=r(89618),c=r(85893);const d=["component","handlers","children","onRef"],u={alt:"Alt",ctrl:"Control",meta:"Meta",shift:"Shift"},p=(0,s.default)(u),h={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,meta:224};t.SpecialKeyMap=h;const f={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+"};class m extends o.Component{constructor(){super(...arguments),this._setRef=e=>{this._ref=e,this.props.onRef&&this.props.onRef(e)},this.getElement=()=>this._ref,this.focused=!1,this.onKeyDown=e=>{const{handlers:t}=this.props;t&&Object.keys(t).forEach((r=>{const n=t[r];if(null==n)return;const i=this.normalizeKM(r),[a]=i;f[a]&&this.matchHandler(i,e)&&n(e)}))},this.onKeyPress=e=>{const{handlers:t}=this.props;t&&Object.keys(t).forEach((r=>{const n=t[r];if(null==n)return;const i=this.normalizeKM(r),[a]=i;f[a]||this.matchHandler(i,e)&&n(e)}))},this.onFocus=e=>{this.focused=!0,this.props.onFocus(e)},this.onBlur=e=>{this.focused=!1,this.props.onBlur(e)}}matchHandler(e,t){let[r,n]=e;return r===t.which&&p.every((e=>n&&e===n?t.getModifierState(n):!t.getModifierState(e)))}normalizeKM(e){let[t,r]=e.toLowerCase().split("+");_[t]&&(t=_[t]),_[r]&&(r=_[r]);let n,i=t;return r?(i=r,n=u[t],void 0===n?__LOG__(3)`Invalid HotKey Modifier: ${t}`:void 0===i&&__LOG__(3)`Invalid HotKey Key: ${r}`):void 0===i&&__LOG__(3)`Invalid HotKey Key: ${t}`,[h[i]||i.charCodeAt(0),n]}componentDidMount(){this.focused=!1}componentWillUnmount(){if(!0===this.focused){const e=document.activeElement;this._ref===e&&l.UIM.Manager.refocusTopUie()}}render(){const e=this.props,{component:t,handlers:r,children:n,onRef:s}=e,o=(0,a.default)(e,d),l=r&&Object.keys(r).some((e=>null!=r[e]));return(0,c.jsx)(t,(0,i.default)((0,i.default)({ref:this._setRef,tabIndex:"-1",onKeyPress:l?this.onKeyPress:null,onKeyDown:l?this.onKeyDown:null},o),{},{onFocus:this.onFocus,onBlur:this.onBlur,children:n}))}}t.HotKeys=m,m.defaultProps={component:"div",onFocus:()=>{},onBlur:()=>{}},m.flashFocus=Date.now(),m.displayName="HotKeys"},73643:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MmsDownloadFilehashMismatchError=t.HttpInvalidResponseError=void 0;var n=r(40265);class i extends((0,n.customError)("HttpInvalidResponseError")){constructor(e,t){super(null!=t&&null!=t.url?`${e}: ${t.url}`:e)}}t.HttpInvalidResponseError=i;t.MmsDownloadFilehashMismatchError=class extends i{constructor(e){super("mmsDownload: filehash mismatch",e),this.name="MmsDownloadFilehashMismatchError"}}},49682:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("HttpNetworkError")){}t.default=i},13516:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("HttpStatusCodeError")){constructor(e,t,r){super(null!=r&&null!=r.url?`${t}: ${e} ${r.url}`:`${t}: ${e}`),this.status=e}}t.default=i},60988:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(49682));class a extends i.default{constructor(){super(...arguments),this.name="HttpTimedOutError"}}t.default=a},35118:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortError",{enumerable:!0,get:function(){return i.AbortError}}),Object.defineProperty(t,"HttpInvalidResponseError",{enumerable:!0,get:function(){return a.HttpInvalidResponseError}}),Object.defineProperty(t,"HttpNetworkError",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"HttpStatusCodeError",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"HttpTimedOutError",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"MmsDownloadFilehashMismatchError",{enumerable:!0,get:function(){return a.MmsDownloadFilehashMismatchError}});var i=r(89385),a=r(73643),s=n(r(49682)),o=n(r(13516)),l=n(r(60988))},43816:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.extendedFetch=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(e,t).catch((e=>{if(e.name===s.ABORT_ERROR)throw new s.AbortError;if(e instanceof c.HttpNetworkError)throw e;throw new c.HttpNetworkError(e.message)}))},t.sharedFetch=f;var i=n(r(48926)),a=n(r(81109)),s=r(89385),o=r(76100),l=n(r(27607)),c=r(35118),d=n(r(66335)),u=n(r(88882)),p=r(64551);const h=r(54302)({UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((r,n)=>{var s;if(null===(s=t.signal)||void 0===s?void 0:s.aborted)return void n(new l.default("AbortError"));const f=new XMLHttpRequest;if(t.signal){const e=t.signal;e.addEventListener("abort",(function t(){e.removeEventListener("abort",t),f.onreadystatechange=()=>{},f.abort(),n(new l.default("AbortError"))}))}const{onProgress:_,onResponseText:m}=t;var g;(null!=_||m)&&((p.ServerProps.webLargeFilesUi&&"post"===(null===(g=t.method)||void 0===g?void 0:g.toLowerCase())?f.upload:f).onprogress=e=>{m&&m(e,f.responseText),_&&_(e)});const{onHeadersReceived:y}=t;f.onreadystatechange=()=>{if(f.readyState===h.UNSENT)n(new Error("fetch error: not sent"));else if(f.readyState===h.HEADERS_RECEIVED&&null!=y)y(new d.default((0,u.default)(f.getAllResponseHeaders())));else if(f.readyState===h.DONE){if(null==f.status)return void n(new Error("fetch error: no status"));if(0===f.status||f.status>=12e3)return void n(new Error(`fetch error: unexpected status ${f.status}`));r(S())}},f.onerror=()=>n(new Error("fetch error: error")),f.ontimeout=()=>{n(new c.HttpTimedOutError("fetch error: timedout"))},f.withCredentials="include"===t.credentials,null!=t.timeout&&(f.timeout=t.timeout),f.open(t.method||"get",e.toString(),!0);const E=new d.default(t.headers||{});for(const e of E.keys()){const t=E.get(e);null!=t&&f.setRequestHeader(e,t)}function S(){const e=new d.default((0,u.default)(f.getAllResponseHeaders()));return(0,a.default)((0,a.default)({ok:200<=f.status&&f.status<300,statusText:f.statusText,status:f.status,url:f.responseURL},m?{text:()=>Promise.resolve(f.responseText),json:()=>Promise.resolve(JSON.parse(f.responseText)),arrayBuffer:()=>(0,o.largeStringToArrayBuffer)(f.responseText)}:{text:()=>v(),json:(t=(0,i.default)((function*(){const e=yield v();return JSON.parse(e)})),function(){return t.apply(this,arguments)}),arrayBuffer:()=>f.response}),{},{blob:()=>Promise.resolve(new Blob([f.response],{type:e.get("content-type")||""})),clone:S,headers:e});var t}function v(){return Promise.resolve(String.fromCharCode(...new Uint8Array(f.response)))}m?f.overrideMimeType("text/plain; charset=x-user-defined"):f.responseType="arraybuffer",f.send(t.body||null)}))}},88882:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(e||"").trim().toLowerCase().split("\n").reduce(((e,t)=>{if(!t.trim())return e;const r=t.indexOf(":"),n=t.substr(0,r).trim(),i=t.substr(r+1).trim().replace(/;$/,"");return e[n]?Array.isArray(e[n])?e[n].push(i):e[n]+=`, ${i}`:e[n]=i,e}),{})}},69551:(e,t,r)=>{"use strict";var n=r(95318);t.d=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(54084);function s(){return(s=(0,i.default)((function*(e){try{yield Promise.all([(0,a.deleteRemoteInfo)(e),(0,a.deleteDeviceSenderKey)(e)])}catch(t){__LOG__(2)`handleDevicesNotification: failed to clean the signal info for ${e.user}`}}))).apply(this,arguments)}},24863:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearADVSecretKey=function(){(0,u.setADVSecretKey)(void 0)},t.generateADVSecretKey=function(){const e=new Uint8Array(32);self.crypto.getRandomValues(e);const t=(0,a.encodeB64)(e);return(0,u.setADVSecretKey)(t),t},t.generateDeviceSignature=function(e,t,r){const n=e.details,i=s.Binary.build(f,n,t.pubKey,r).readByteArray().buffer;return window.libsignal.Curve.calculateSignature(t.privKey,i)},t.getADVEncodedIdentity=function(){return m.apply(this,arguments)},t.getADVSecretKey=function(){const e=(0,u.getADVSecretKey)();if(null==e)throw new Error("MD secretKey is null or undefined");return e},t.setADVSignedIdentity=function(e){if(null==e)return Promise.reject(new Error("MD advSignedDeviceIdentity is null or undefined"));if(null==e.deviceSignature)return Promise.reject(new Error("MD advSignedDeviceIdentity is missing deviceSignature"));return p.waSignalStore.putADVSignedIdentity(e)},t.verifyDeviceIdentityAccountSignature=function(e,t,r){const n=e.details,i=e.accountSignatureKey||r;(0,l.default)(null!=i,"accountSignatureKey should not be null");const a=e.accountSignature;(0,l.default)(null!=a,"accountSignature should not be null");const o=s.Binary.build(h,n,t).readByteArray();return(0,d.verifySignature)(new Uint8Array(i),o,new Uint8Array(a))},t.verifyDeviceSignature=function(e,t,r){const n=e.details,i=e.deviceSignature;(0,l.default)(null!=i,"deviceSignature should not be null");const a=e.accountSignatureKey||r;(0,l.default)(null!=a,"accountSignatureKey should not be null");const o=s.Binary.build(f,n,t,a).readByteArray();return(0,d.verifySignature)(new Uint8Array(t),o,new Uint8Array(i))},t.verifyKeyIndexListAccountSignature=function(e,t){const r=e.details,n=e.accountSignature;(0,l.default)(null!=n,"accountSignature should not be null");const i=s.Binary.build(_,r).readByteArray();return(0,d.verifySignature)(new Uint8Array(t),i,new Uint8Array(n))};var i=n(r(48926)),a=r(15688),s=r(8584),o=r(60980),l=n(r(41143)),c=r(61438),d=r(5087),u=(r(54181),r(58052)),p=r(11849);const h=new Uint8Array([6,0]),f=new Uint8Array([6,1]),_=new Uint8Array([6,2]);function m(){return(m=(0,i.default)((function*(){const e=yield p.waSignalStore.getADVSignedIdentity();if(null==e)throw new Error("MD advSignedDeviceIdentity is null or undefined");if(null==e.deviceSignature)throw new Error("MD advSignedDeviceIdentity is missing deviceSignature");return(0,o.encodeProtobuf)(c.ADVSignedDeviceIdentitySpec,e).readByteArray()}))).apply(this,arguments)}},50338:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIBusyTasks=t.IdleEnum=t.IdleCallbackTasks=void 0;var n=r(57319),i=r(53485);const a=r(54302).Mirrored(["IDLE_CALLBACK","UI_BUSY"]);t.IdleEnum=a;class s{constructor(e){this.busyMap=new Map,this.busyId=0,this._clearBusyMap=()=>{this.busyMap.clear()},this._taskMap=new Map,this.taskId=0,this.runIdleLoop=()=>{this.idleType===a.IDLE_CALLBACK?this.idleCallbackId=(0,i.requestIdleCallback)(this._ricOnIdle):this.isIdle()&&this._uiBusyOnIdle()},this._ricOnIdle=e=>{let t;const r=this._taskMap.entries();for(;(t=r.next())&&!t.done;){const[r,n]=t.value;if(n(),this._taskMap.delete(r),e.timeRemaining()<=0)break}this._taskMap.size>0&&this.runIdleLoop()},this.idleType=e}setBusy(e){let t=e;return null!=t&&this.busyMap.has(t)?this.busyMap.set(t,this.busyMap.get(t)+1):(t=++this.busyId,this.busyMap.set(t,1)),this.busyTimer||(this.busyTimer=new n.ShiftTimer(this._clearBusyMap)),this.busyTimer.debounce(1e3),t}decBusy(e){if(null==e)return;const t=this.busyMap.get(e);null!=t&&0!==t&&(1===t?this.clearBusy(e):this.busyMap.set(e,t-1))}clearBusy(e){null!=this.busyMap.get(e)&&this.busyMap.delete(e),this.isIdle()&&(this.busyTimer.cancel(),this._taskMap.size>0&&window.setTimeout(this.runIdleLoop,0))}isIdle(){return 0===this.busyMap.size}isBusy(){return this.busyMap.size>0}cancelIdleLoop(){this.idleType===a.IDLE_CALLBACK&&null!=this.idleCallbackId&&(0,i.cancelIdleCallback)(this.idleCallbackId)}_uiBusyOnIdle(){let e;const t=this._taskMap.entries();for(;(e=t.next())&&!e.done;){const[t,r]=e.value;if(r(),this._taskMap.delete(t),this.isBusy())break}}enqueue(e){return this._taskMap.set(++this.taskId,e),1===this._taskMap.size&&this.runIdleLoop(),this.taskId}dequeue(e){const t=this._taskMap.delete(e);return t&&0===this._taskMap.size&&this.cancelIdleLoop(),t}isInQueue(e){return this._taskMap.has(e)}}const o=new s(a.UI_BUSY);t.UIBusyTasks=o;const l=new s(a.IDLE_CALLBACK);t.IdleCallbackTasks=l},36638:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_URL=t.CANVAS=t.BlackVideoThumbnailError=t.BLOB=void 0,t.base64ImageToCanvas=function(){return U.apply(this,arguments)},t.crop=function(){return O.apply(this,arguments)},t.generateLinkPreview=function(){return w.apply(this,arguments)},t.generateVideoThumbsAndDuration=function(){return M.apply(this,arguments)},t.isCached=function(e){if(!e)return!1;const t=new Image;return t.src=e,!!t.complete},t.rotateAndResize=function(e,t,r,n){const{transparency:i=!1,fitToSquare:a=!1,minDimension:s=0}=null!=n?n:{},c=new ArrayBuffer(0);let d,p,h;e instanceof HTMLCanvasElement?(p=Promise.resolve(e),h=Promise.resolve(c)):(d=window.URL.createObjectURL(e),p=y.loadImage(d),h=(0,_.blobToArrayBuffer)(e).catch((e=>(__LOG__(3)`ImageUtils::rotateAndResize error: ${e}`,c))));return(0,o.promiseProps)({buffer:h,image:p}).then((e=>{let{buffer:n,image:c}=e,d={};try{d=(0,l.default)(n)}catch(e){}let p=0;switch(d.orientation||"UNKNOWN"){case"right-top":p=1;break;case"left-bottom":p=-1;break;case"bottom-right":p=2}const h=document.createElement("canvas"),f=c.naturalWidth||c.width,_=c.naturalHeight||c.height,y=Math.max(f,_),E=h.getContext("2d"),S={};if(!p){const e=(0,m.boundHeightWidth)(_,f,t);let l,d,p=r&A;if(n&&p&&f===e.width&&_===e.height)try{const e=(0,g.cleanJPEG)(n);S.blob=e,p=!1,l=f,d=_}catch(e){__LOG__(2)`Could not parse JPEG: ${e.message}`}return(p||r&~A)&&(h.width=e.width,h.height=e.height,i||(0,u.fillBackgroundWithGray)(h),E.drawImage(c,0,0,h.width,h.height),a&&((0,u.square)(h),S.blob=void 0),y<s&&((0,u.scale)(h,s),S.blob=void 0),l=h.width,d=h.height,G(S,h,r,i)),(0,o.promiseProps)(S).then((e=>({width:l,height:d,images:e})))}switch(p){case 1:case-1:const e=Math.max(f,_),n=e/2;h.width=h.height=e,i||(0,u.fillBackgroundWithGray)(h),(0,u.rotate)(E,{x:n,y:n,degrees:90*p}),1===p?E.drawImage(c,0,e-_):E.drawImage(c,e-f,0),(0,u.rotate)(E,{x:n,y:n,degrees:-90*p}),(0,u.resize)(h,_,f),a&&(0,u.square)(h),y<s&&(0,u.scale)(h,s);const l=(0,u.contain)(h,t);return G(S,l,r,i),(0,o.promiseProps)(S).then((e=>({width:l.width,height:l.height,images:e})));case 2:const d=(0,m.boundHeightWidth)(_,f,t),g=h.width=d.width,v=h.height=d.height;return i||(0,u.fillBackgroundWithGray)(h),(0,u.rotate)(E,{x:g/2,y:v/2,degrees:90*p}),E.drawImage(c,0,0,g,v),(0,u.rotate)(E,{x:g/2,y:v/2,degrees:-90*p}),a&&(0,u.square)(h),y<s&&(0,u.scale)(h,s),G(S,h,r,i),(0,o.promiseProps)(S).then((e=>({width:h.width,height:h.height,images:e})))}})).finally((()=>{}))},t.toDataUrl=function(){return R.apply(this,arguments)},t.toDataUrlWithRoundedCorners=function(){return I.apply(this,arguments)},t.toWebpSticker=function(){return L.apply(this,arguments)},t.urlToFile=function(){return k.apply(this,arguments)};var a=i(r(48926)),s=r(40265),o=r(67602),l=i(r(26642)),c=i(r(70714)),d=r(45044),u=r(35718),p=i(r(69618)),h=n(r(64103)),f=r(91903),_=r(1063),m=r(38034),g=r(45987),y=n(r(97692)),E=r(65127);const S=2,v=4,T=1;t.DATA_URL=T;const A=S;t.BLOB=A;const C=v;t.CANVAS=C;class b extends((0,s.customError)("BlackVideoThumbnailError")){}t.BlackVideoThumbnailError=b,b.message="Generated video thumbnail is black";const P=e=>{let{video:t,fullWidth:r,fullHeight:n,maxDimension:i}=e;const a=document.createElement("canvas"),{width:s,height:o}=(0,m.boundHeightWidth)(n,r,i);a.width=s,a.height=o;const l=a.getContext("2d");l.drawImage(t,0,0,s,o);const c=l.getImageData(0,0,s,o);return{thumb:{url:a.toDataURL("image/jpeg"),width:s,height:o,fullWidth:r,fullHeight:n},imageData:c}};function M(){return(M=(0,a.default)((function*(e){const{file:t,maxDimensions:r,debugHint:n,throwOnBlack:i=!1}=e,{video:a,fullWidth:s,fullHeight:o}=yield y.loadVideo(t),l=e=>{const t=e.width*e.height/4;for(let r=0;r<=1;r+=.25){const n=4*Math.round(t*r);if(0!==e.data[n])return!1;if(0!==e.data[n+1])return!1;if(0!==e.data[n+2])return!1;const i=e.data[n+3];if(0!==i&&255!==i)return!1}return!0};if(E.UA.isBuggyVideoLoad){const e=50,t=5e3/e;return(0,f.exponentialBackoff)({minTimeout:e,maxTimeout:e,retries:t,signal:(new c.default).signal,factor:1},((e,c)=>{const d=[];let u;for(u of r){const{thumb:r,imageData:p}=P({video:a,fullHeight:o,fullWidth:s,maxDimension:u});if(l(p)){if(c<t)return 0===c&&__LOG__(2)`generateVideoThumbsAndDuration: Setting video.currentTime to 0 to attempt to unblock the video`,a.currentTime=0,e(new Error("retry"));if(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${n}`,SEND_LOGS(`thumbnail-generation-failed-${n}`)),i)throw new b}d.push(r)}const p={duration:~~a.seekable.end(0),thumbs:d};return y.disposeVideo(a),Promise.resolve(p)}))}try{const e=r.map((e=>{const{thumb:t,imageData:r}=P({video:a,fullHeight:o,fullWidth:s,maxDimension:e});if(l(r)&&(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${n}`,SEND_LOGS(`thumbnail-generation-failed-${n}`)),i))throw new b;return t}));return{duration:~~a.seekable.end(0),thumbs:e}}finally{y.disposeVideo(a)}}))).apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e,t,r,n,i,a,s){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:T;const c=e instanceof HTMLCanvasElement?e:yield y.loadImage(e),d=document.createElement("canvas"),u=d.getContext("2d");null==a||null==s?(d.height=i,d.width=n,u.drawImage(c,t,r,n,i)):(d.height=s,d.width=a,u.drawImage(c,t,r,n,i,0,0,a,s));const p={};G(p,d,l);const h=yield(0,o.promiseProps)(p);return{images:h,width:n,height:i}}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e){const t=e instanceof HTMLCanvasElement?e:yield y.loadImage(e),r=document.createElement("canvas"),n=r.getContext("2d");r.height=t.height,r.width=t.width;const i=Math.min(t.width,t.height);return n.beginPath(),n.arc(t.width/2,t.height/2,i/2,0,2*Math.PI,!0),n.clip(),n.closePath(),n.drawImage(t,0,0),r.toDataURL("image/png")}))).apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){try{const t=yield y.loadImage(e),r=100,n=140;if(t.width<r||t.height<r)return __LOG__(2)`Image size too small for link preview`,null;const i=document.createElement("canvas"),a=i.getContext("2d");i.height=n,i.width=n;const s=Math.min(t.width,t.height),o=(t.width-s)/2,l=(t.height-s)/2;return a.drawImage(t,o,l,s,s,0,0,n,n),i.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`link preview image generation failed: `,null}}))).apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e){try{const t=yield y.loadImage(e),r=document.createElement("canvas"),n=r.getContext("2d");return r.height=t.height,r.width=t.width,n.drawImage(t,0,0),r.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`data URL conversion failed: `,null}}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t){try{const r=yield e.arrayBuffer(),n=(0,d.addWebpMetadata)(r,t),i=new Uint8Array(n);return new Blob([i],{type:"image/webp"})}catch(t){return __LOG__(4,void 0,new Error,!0)`addMetadataToSticker: Unable to add metadata to Sticker`,SEND_LOGS("unable-to-add-sticker-metadata"),e}}))).apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e){try{const t=window.URL.createObjectURL(e),r=yield y.loadImage(t);window.URL.revokeObjectURL(t);const n=p.default.STICKER_DIMENSION,i=(0,u.createCanvas)(n,n),a=i.getContext("2d"),{width:s,height:o}=(0,m.aspectRatioScaled)(r.width/r.height,n);a.drawImage(r,(n-s)/2,(n-o)/2,s,o);const l=yield(0,u.canvasToWebp)(i);return yield D(l,{isFirstParty:!1,isFromStickerMaker:!0,emojis:[],stickerPackPublisher:"WhatsApp Sticker Maker"})}catch(e){throw __LOG__(2)`Webp sticker file generation failed: `,e}}))).apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e){try{const t=yield y.loadImage(e),r=document.createElement("canvas");r.width=t.naturalWidth,r.height=t.naturalHeight;const n=r.getContext("2d");return(0,u.fillBackgroundWithGray)(r),n.drawImage(t,0,0),(0,u.canvasToBlob)(r)}catch(t){throw new h.MediaDragDropError("unable to render image",e)}}))).apply(this,arguments)}function G(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=n?"image/png":"image/jpeg";!e.blob&&r&A&&(e.blob=(0,u.canvasToBlob)(t,i)),!e.dataUrl&&r&T&&(e.dataUrl=Promise.resolve(t.toDataURL(i))),!e.canvas&&r&C&&(e.canvas=Promise.resolve(t))}function U(){return(U=(0,a.default)((function*(e){const t=yield y.loadImage(e),r=(0,u.createCanvas)(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),r}))).apply(this,arguments)}},89748:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(89385),a=n(r(70714)),s=n(r(84644));t.default=class{constructor(){this._lastPromise=Promise.resolve(),this._controller=new a.default,this._pending=[]}enqueue(e){e.catch((()=>{}));const t=()=>e,r=this._controller.signal;this._lastPromise=this._lastPromise.then(t,t);const n=(0,s.default)(this._lastPromise,r).catch((0,i.catchAbort)((e=>{var t;throw null!==(t=this._cancellationError)&&void 0!==t?t:e})));return this._pending.push(n),n.finally((()=>{this._pending.length>0&&this._pending[0]===n&&this._pending.shift()}))}cancelAll(e){this._cancellationError=e,this._pending=[],this._controller.abort(),this._controller=new a.default}}},2680:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{r=self.indexedDB}catch(e){}var n=r;t.default=n},14111:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.waNoiseInfo=t.deviceInfo=void 0;var i=n(r(48926)),a=r(15688),s=r(8584),o=n(r(43725)),l=r(58052);const{DbEncKeyStore:c}=r(15998);const d=new class{get(){return{osVersion:"0.1",osBuild:"0.1",hardware:"desktop",manufacturer:"",device:"Desktop",lg:o.default.getLanguage(),lc:o.default.getRegion()||"",mcc:"000",mnc:"000",sim_mnc:"000",sim_mcc:"000"}}};t.deviceInfo=d;const u=new class{get(){var e=this;return(0,i.default)((function*(){const t=(0,l.getNoiseInfo)(),r=e._getIv();return t&&r?(t.recoveryToken=yield e._decryptNoiseData(t.recoveryToken,r[0]),t.staticKeyPair.pubKey=yield e._decryptNoiseData(t.staticKeyPair.pubKey,r[1]),t.staticKeyPair.privKey=yield e._decryptNoiseData(t.staticKeyPair.privKey,r[2]),t):null}))()}set(e){var t=this;return(0,i.default)((function*(){const r=new Uint8Array(48);self.crypto.getRandomValues(r);const n=t._processIv(r);return t._setIv(n),e.recoveryToken=yield t._encryptNoiseData(e.recoveryToken,n[0]),e.staticKeyPair.pubKey=yield t._encryptNoiseData(e.staticKeyPair.pubKey,n[1]),e.staticKeyPair.privKey=yield t._encryptNoiseData(e.staticKeyPair.privKey,n[2]),(0,l.setNoiseInfo)(e)}))()}_setIv(e){return(0,l.setNoiseInfoIv)(e.map(a.encodeB64))}_getIv(){const e=(0,l.getNoiseInfoIv)();return e?e.map((e=>new Uint8Array((0,a.decodeB64)(e)))):null}_processIv(e){const t=new s.Binary(e);return[t.readByteArray(16),t.readByteArray(16),t.readByteArray(16)]}_encryptNoiseData(e,t){return(0,i.default)((function*(){const r=c.encKeys[0];return yield self.crypto.subtle.encrypt({iv:t,name:"AES-CBC"},r.key,e)}))()}_decryptNoiseData(e,t){return(0,i.default)((function*(){const r=c.encKeys[0];return yield self.crypto.subtle.decrypt({iv:t,name:"AES-CBC"},r.key,e)}))()}};t.waNoiseInfo=u},81654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=0;const r=e.charCode,n=e.keyCode;null!=r&&0!==r?t=r:null!=n&&0!==n&&(t=n);return i.has(t)};var n=r(55414);const i=new Set([n.SpecialKeyMap.enter,n.SpecialKeyMap.space])},7056:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return!!e&&e.includes(i.default.MIMETYPE_OGG)};var i=n(r(69618))},93235:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=void 0,t.exponentialBackoffIterator=function*(e){const{factor:t,jitter:r,maxTimeout:n,minTimeout:o,retries:l}=(0,i.default)((0,i.default)({},s),e);let c=0;for(const e of(0,a.default)(t)){if(c++,c>l)return;const t=Math.random()*r*2-r+1;yield Math.min(o*e*t,n)}};var i=n(r(81109)),a=n(r(76433));const s={factor:2,jitter:0,maxTimeout:1/0};t.defaults=s},76433:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function*(e){let t=1;for(;;)yield t,t*=e}},55892:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterIterator=function*(e,t){let r=0;for(const n of e)t(n,r)&&(yield n),r++},t.first=function(e){for(const t of e)return t;return},t.iteratorFromArray=function*(e){for(const t of e)yield t},t.mapIterator=function*(e,t){let r=0;for(const n of e)yield t(n,r),r++},t.rangeIterator=function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(0===r)throw new TypeError("Step can't be zero.");if(r>0){if(e>t)return;for(let n=e;n<t;n+=r)yield n}else{if(e<t)return;for(let n=e;n>t;n+=r)yield n}},t.takeIterator=function*(e,t){if(t<0)throw new TypeError("Count must be a positive integer");let r=0;for(const n of e){if(r>=t)return;yield n,r++}}},85553:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatJidToChatWid=function(e){return(0,i.toChatWid)((0,i.createWid)(e))},t.deviceJidToDeviceWid=function(e){return(0,i.createDeviceWid)(e)},t.deviceJidToUserWid=function(e){return(0,i.toUserWid)((0,i.createWid)(e))},t.groupJidToWid=function(e){return(0,i.createWid)(e)},t.jidWithTypeToWid=function(e){const t=(0,n.extractJidFromJidWithType)(e);return(0,i.createWid)(t)},t.userJidToUserWid=function(e){return(0,i.createUserWid)(e)};var n=r(19797),i=r(58021)},64457:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CLOCK_CHANGE_BACKWARDS_EVENT",{enumerable:!0,get:function(){return n.CLOCK_CHANGE_BACKWARDS_EVENT}}),t.DEFAULT_THRESHOLD=t.DEFAULT_INTERVAL=void 0,Object.defineProperty(t,"JS_HALT_EVENT",{enumerable:!0,get:function(){return n.JS_HALT_EVENT}}),t.jsHaltDetector=void 0;var n=r(63454);t.DEFAULT_THRESHOLD=3e3;t.DEFAULT_INTERVAL=1e4;const i=new n.BaseJsHaltDetector(1e4,3e3);t.jsHaltDetector=i,i.startDetection()},59891:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=r);return t}},63824:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,r(67294).createContext)(!1);t.default=n},29522:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.L10n=void 0;var i=n(r(42317)),a=n(r(97331)),s=n(r(30381)),o=n(r(69618)),l=n(r(34342)),c=r(30031),d=n(r(70210)),u=n(r(45180)),p=n(r(17588));const h=new Set(["⁦","‪"]),f=new Set(["ar","ar-XB","fa","ur","he","dv","ku"]),_=new Set(["ar","ar-XB","fa"]),m="٠١٢٣٤٥٦٧٨٩".split("");function g(e){return m[parseInt(e,10)]}const y=new Error("Unimplemented method");class E extends l.default{constructor(e,t,r){if(super(),!e||!t)throw y;this._locale=e,this.localeStrings={},this.localeStrings[o.default.L10N.DEFAULT]=t,this.fbtStrings={},this.fbtStrings[o.default.L10N.DEFAULT]={en:{}},this.markTranslations=r,this.customizeMoment()}getLocale(){throw y}getFbtTranslations(){throw y}setLocale(){throw y}normalizeLocale(e){const t=e.replace(/-/g,"_").toLowerCase(),r=this._getTranslationFilename(t);if(r)return r;let n=t;for(;n;){n=n.split("_").slice(0,-1).join("_");const e=n&&this._getTranslationFilename(n);if(e)return e}}isLocaleSupported(e){return!!e&&!!this.normalizeLocale(e)}_getTranslationFilename(e){const t=d.default[e]||e;return p.default[t]}isRTL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLocale();return f.has(e)}LR(e,t){return this.isRTL()?t:e}embedDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.embedRTL(e):this.embedLTR(e)}forceDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.forceRTL(e):this.forceLTR(e)}embedLTR(e){return"‪"+e+"‬"}embedRTL(e){return"‫"+e+"‬"}isolateLTR(e){return"⁦"+e+"⁩"}isolateRTL(e){return"⁧"+e+"⁩"}forceLTR(e){return"‎"+e}forceRTL(e){return"‏"+e}t(e,t,r){"number"!=typeof e&&__LOG__(3)`l10n.t was called with an unprocessed id (${e}). If you just added a string on local, restarting your build may address the issue.`;const n=e,i=null!=t?t._plural:null;let a=r||this.getLocale();this.localeStrings[a]||(a=o.default.L10N.DEFAULT);let s=this._getString(n,a,i);this.markTranslations&&(s?a===o.default.L10N.DEFAULT&&(s="["+s+"]"):(s="!!"+n+"!!",__LOG__(2)`l10n:t string key "${n}" not found`)),s||(s=this._getString(n,o.default.L10N.DEFAULT,i)),s||__LOG__(2)`l10n:t string key "${n}" fallback failed`;for(const e in t){if(!t.hasOwnProperty(e)||"_plural"===e)continue;const r=new RegExp("__"+e+"__","g");let n;n="string"==typeof t[e]&&h.has(t[e].slice(0,1))?t[e]:this.n(t[e],a),s=s.replace(r,n)}return s}_getString(e,t,r){const n=this.localeStrings[t]||this.localeStrings[o.default.L10N.DEFAULT];if(null==n)throw new Error(`Couldn't find translations for locale ${t} or default (${o.default.L10N.DEFAULT})`);if(!Array.isArray(n))throw new Error("Unexpected locale format.");const[i,a]=n,s=i[e]||"";if(null==r)return s;const l=u.default[t];if(null==l)return s;const c=l.numbers[l.plurals(r)];if(1===c)return s;return a[2===l.numbers.length&&2===c?e.toString():`${e}_${c}`]||s}useArabicScriptDigits(e){return _.has(e||this.getLocale())}isLatinAlphabetLanguage(e){return a.default.isLatin(this.removeAccents(e))}n(e,t){let r=e;return isNaN(r)||(r=r.toString()),this.useArabicScriptDigits(t)?r.toString().replace(/[0-9]/g,g):r}filesize(e){const t=this;return this.n((0,i.default)(e,{base:2,round:0,suffixes:{B:t.t(475),kB:t.t(477),MB:t.t(478),GB:t.t(476)}}))}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,c.normalizeForm)(e)}removeAccents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,c.removeAccents)(e)}accentFold(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.removeAccents(e).toLowerCase()}customizeMoment(){s.default.relativeTimeRounding(Math.floor),s.default.relativeTimeThreshold("s",60),s.default.relativeTimeThreshold("m",60),s.default.relativeTimeThreshold("h",24)}}t.L10n=E},79502:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCountryShortcodeByPhone=function(e){if(null==e||0===e.length)return"";const t=function(e,t){if(null!=e&&e.length>0&&null!=t){let r=t[e[0]],n=e;for(;n.length>0&&r;){if(r.c)return r.c;n=n.substr(1,n.length-1),r=r[n[0]]}}return""}(e,r);return""===t&&"1"===e[0]?"US":"RU"===t&&["6","7"].includes(e[1])?"KZ":t};const r={1:{2:{0:{4:{c:"CA"}},2:{6:{c:"CA"}},3:{6:{c:"CA"}},4:{2:{c:"BS"},9:{c:"CA"}},5:{0:{c:"CA"}},6:{4:{c:"AI"},8:{c:"AG"}},8:{4:{c:"VG"},9:{c:"CA"}}},3:{0:{6:{c:"CA"}},4:{0:{c:"VI"},3:{c:"CA"},5:{c:"KY"}},6:{5:{c:"CA"},7:{c:"CA"}}},4:{0:{3:{c:"CA"}},1:{6:{c:"CA"},8:{c:"CA"}},3:{1:{c:"CA"},7:{c:"CA"},8:{c:"CA"}},4:{1:{c:"BM"}},5:{0:{c:"CA"}},7:{3:{c:"GD"}}},5:{0:{6:{c:"CA"}},1:{4:{c:"CA"},9:{c:"CA"}},4:{8:{c:"CA"}},7:{9:{c:"CA"}},8:{1:{c:"CA"},7:{c:"CA"}}},6:{0:{4:{c:"CA"}},1:{3:{c:"CA"}},3:{9:{c:"CA"}},4:{7:{c:"CA"},9:{c:"TC"}},5:{8:{c:"JM"}},6:{4:{c:"MS"}},7:{0:{c:"MP"},1:{c:"GU"},2:{c:"CA"}},8:{4:{c:"AS"}}},7:{0:{5:{c:"CA"},9:{c:"CA"}},2:{1:{c:"MF"}},5:{8:{c:"LC"}},6:{7:{c:"DM"}},7:{8:{c:"CA"}},8:{0:{c:"CA"},2:{c:"CA"},4:{c:"VC"},7:{c:"PR"}}},8:{0:{7:{c:"CA"},9:{c:"DO"}},1:{9:{c:"CA"}},2:{5:{c:"CA"},9:{c:"DO"}},4:{9:{c:"DO"}},6:{7:{c:"CA"},8:{c:"TT"},9:{c:"KN"}},7:{3:{c:"CA"},6:{c:"JM"}}},9:{0:{2:{c:"CA"},5:{c:"CA"}},3:{9:{c:"PR"}}}},2:{0:{c:"EG"},1:{1:{c:"SS"},2:{c:"MA"},3:{c:"DZ"},6:{c:"TN"},8:{c:"LY"}},2:{0:{c:"GM"},1:{c:"SN"},2:{c:"MR"},3:{c:"ML"},4:{c:"GN"},5:{c:"CI"},6:{c:"BF"},7:{c:"NE"},8:{c:"TG"},9:{c:"BJ"}},3:{0:{c:"MU"},1:{c:"LR"},2:{c:"SL"},3:{c:"GH"},4:{c:"NG"},5:{c:"TD"},6:{c:"CF"},7:{c:"CM"},8:{c:"CV"},9:{c:"ST"}},4:{0:{c:"GQ"},1:{c:"GA"},2:{c:"CG"},3:{c:"CD"},4:{c:"AO"},5:{c:"GW"},6:{c:"IO"},7:{c:"AC"},8:{c:"SC"},9:{c:"SD"}},5:{0:{c:"RW"},1:{c:"ET"},2:{c:"SO"},3:{c:"DJ"},4:{c:"KE"},5:{c:"TZ"},6:{c:"UG"},7:{c:"BI"},8:{c:"MZ"}},6:{0:{c:"ZM"},1:{c:"MG"},2:{c:"RE"},3:{c:"ZW"},4:{c:"NA"},5:{c:"MW"},6:{c:"LS"},7:{c:"BW"},8:{c:"SZ"},9:{c:"KM"}},7:{c:"ZA"},9:{0:{c:"SH"},1:{c:"ER"},7:{c:"AW"},8:{c:"FO"},9:{c:"GL"}}},3:{0:{c:"GR"},1:{c:"NL"},2:{c:"BE"},3:{c:"FR"},4:{c:"ES"},5:{0:{c:"GI"},1:{c:"PT"},2:{c:"LU"},3:{c:"IE"},4:{c:"IS"},5:{c:"AL"},6:{c:"MT"},7:{c:"CY"},8:{c:"FI"},9:{c:"BG"}},6:{c:"HU"},7:{0:{c:"LT"},1:{c:"LV"},2:{c:"EE"},3:{c:"MD"},4:{c:"AM"},5:{c:"BY"},6:{c:"AD"},7:{c:"MC"},8:{c:"SM"}},8:{0:{c:"UA"},1:{c:"RS"},2:{c:"ME"},3:{c:"XK"},5:{c:"HR"},6:{c:"SI"},7:{c:"BA"},9:{c:"MK"}},9:{c:"IT"}},4:{0:{c:"RO"},1:{c:"CH"},2:{0:{c:"CZ"},1:{c:"SK"},3:{c:"LI"}},3:{c:"AT"},4:{c:"GB"},5:{c:"DK"},6:{c:"SE"},7:{c:"NO"},8:{c:"PL"},9:{c:"DE"}},5:{0:{0:{c:"FK"},1:{c:"BZ"},2:{c:"GT"},3:{c:"SV"},4:{c:"HN"},5:{c:"NI"},6:{c:"CR"},7:{c:"PA"},8:{c:"PM"},9:{c:"HT"}},1:{c:"PE"},2:{c:"MX"},3:{c:"CU"},4:{c:"AR"},5:{c:"BR"},6:{c:"CL"},7:{c:"CO"},8:{c:"VE"},9:{0:{c:"GP"},1:{c:"BO"},2:{c:"GY"},3:{c:"EC"},4:{c:"GF"},5:{c:"PY"},6:{c:"MQ"},7:{c:"SR"},8:{c:"UY"},9:{c:"CW"}}},6:{0:{c:"MY"},1:{c:"AU"},2:{c:"ID"},3:{c:"PH"},4:{c:"NZ"},5:{c:"SG"},6:{c:"TH"},7:{0:{c:"TL"},2:{c:"NF"},3:{c:"BN"},4:{c:"NR"},5:{c:"PG"},6:{c:"TO"},7:{c:"SB"},8:{c:"VU"},9:{c:"FJ"}},8:{0:{c:"PW"},1:{c:"WF"},2:{c:"CK"},3:{c:"NU"},5:{c:"WS"},6:{c:"KI"},7:{c:"NC"},8:{c:"TV"},9:{c:"PF"}},9:{0:{c:"TK"},1:{c:"FM"},2:{c:"MH"}}},7:{c:"RU"},8:{1:{c:"JP"},2:{c:"KR"},4:{c:"VN"},5:{0:{c:"KP"},2:{c:"HK"},3:{c:"MO"},5:{c:"KH"},6:{c:"LA"}},6:{c:"CN"},8:{0:{c:"BD"},6:{c:"TW"}}},9:{0:{c:"TR"},1:{c:"IN"},2:{c:"PK"},3:{c:"AF"},4:{c:"LK"},5:{c:"MM"},6:{0:{c:"MV"},1:{c:"LB"},2:{c:"JO"},3:{c:"SY"},4:{c:"IQ"},5:{c:"KW"},6:{c:"SA"},7:{c:"YE"},8:{c:"OM"}},7:{0:{c:"PS"},1:{c:"AE"},2:{c:"IL"},3:{c:"BH"},4:{c:"QA"},5:{c:"BT"},6:{c:"MN"},7:{c:"NP"}},8:{c:"IR"},9:{2:{c:"TJ"},3:{c:"TM"},4:{c:"AZ"},5:{c:"GE"},6:{c:"KG"},8:{c:"UZ"}}}}},30031:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getLanguageCodeFromLocale=function(e){return e.replace(/_/g,"-").split("-")[0].toLowerCase()},t.getRegionCodeFromLocale=function(e){const t=e.replace(/_/g,"-").split("-");if(t.length<=1)return null;return t[t.length-1].toUpperCase()},t.normalizeForm=a,t.removeAccents=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,i.default)(a(e).replace(/(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])/g,""))};var i=n(r(97331));function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.normalize("NFKD")}},43725:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(48926)),s=r(13959),o=r(4352),l=r(48360),c=i(r(30381)),d=r(29522),u=i(r(69618)),p=r(41796),h=r(30031),f=r(53558),_=i(r(68609)),m=n(r(22906)),g=r(65127);const y=self.location.href;y&&y.includes("/%F0%9F%8C%90/")&&Promise.resolve().then(r.bind(r,2541)).then((e=>{let{URL:t}=e;t.canMuckHistory()&&window.history.replaceState({},"","/")}));const E="en-GB",S={LTR:"LTR",RTL:"RTL"},v={LTR:"style",RTL:"style_rtl"},T=u.default.L10N_PRIORITY;class A extends d.L10n{constructor(){super({l:u.default.L10N.DEFAULT,priority:T.DEFAULT,loc:u.default.L10N.DEFAULT},r(43756).default,u.default.MARK_TRANSLATIONS);{const e=function(){if((0,p.isConnectedToPage)())return document.querySelector("html").getAttribute("loc")}(),t={};this._considerLocale(t,e,T.PREVIOUS)&&this.downloadAndSetTranslation(t)}}getLocale(){return this._locale.l}getFbtTranslations(){return this.fbtStrings[this._locale.l]}getFullLocale(){return this._locale.loc.replace("_","-")}getLanguage(){return(0,h.getLanguageCodeFromLocale)(this.getFullLocale())}getRegion(){return(0,h.getRegionCodeFromLocale)(this.getFullLocale())}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!g.UA.isTrident)return e.normalize("NFKD");try{return e.normalize("NFKD")}catch(t){return e}}setLocale(e,t){var r=this;return(0,a.default)((function*(){const n={l:r._locale.l,priority:r._locale.priority,loc:r._locale.l};return r._considerLocale(n,e,t)?r.downloadAndSetTranslation(n):Promise.resolve()}))()}isLocaleSupported(e){try{return super.isLocaleSupported(e)&&(!self.Intl||Array.isArray(self.Intl.Collator.supportedLocalesOf(e)))}catch(e){return!1}}init(e){var t;this._initFbt();const r={l:u.default.L10N.DEFAULT,priority:T.DEFAULT,loc:u.default.L10N.DEFAULT};if(this._considerLocale(r,e,T.PREVIOUS),this._considerLocale(r,function(){let e=(y||self.location.href||"").split("/%F0%9F%8C%90/");return e.length>1?e[1].split("/")[0]:void 0}(),T.URL),this._considerLocale(r,navigator.language,T.BROWSER),null===(t=navigator.languages)||void 0===t?void 0:t.length)for(let e=0;e<navigator.languages.length&&!this._considerLocale(r,navigator.languages[e],T.BROWSER);e++);return this.downloadAndSetTranslation(r)}_initFbt(){const e=u.default.MARK_TRANSLATIONS?e=>this.getLocale()===u.default.L10N.DEFAULT?new l.FbtResult(["{",...e.contents,"}"]):new l.FbtResult(e.contents):void 0;(0,l.init)({translations:this.getFbtTranslations(),hooks:{getViewerContext:()=>({locale:this.getLocale()}),getFbtResult:e}})}_considerLocale(e,t,r){if(null!=e.priority&&r<e.priority)return;if(null==t||t===this.getLocale())return;const n=this.normalizeLocale(t);return n?(e.l=n,e.priority=r,e.loc=t,e):void 0}downloadAppLocale(e){return this.localeStrings[e]?Promise.resolve(this.localeStrings[e]):(0,o.promiseLoop)(function(){var t=(0,a.default)((function*(t,n,i){const a=(0,s.delayMs)(m.expBackoff(i,12e4,1e3,.1)),o=yield r(26299)(`./${e}`);try{const[e]=yield o.default();return t(e)}catch(t){return 10===i&&(__LOG__(4,void 0,new Error,!0)`${i} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),a}}));return function(){return t.apply(this,arguments)}}())}downloadFbtLocaleAndSetCache(e){var t=this;return this.fbtStrings[e]?Promise.resolve(this.fbtStrings[e]):(0,o.promiseLoop)(function(){var n=(0,a.default)((function*(n,i,a){const o=(0,s.delayMs)(m.expBackoff(a,12e4,1e3,.1)),l=yield r(26299)(`./${e}`);try{const[,r]=yield l.default();return t.fbtStrings[e]=r,n(r)}catch(t){return 10===a&&(__LOG__(4,void 0,new Error,!0)`${a} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),o}}));return function(){return n.apply(this,arguments)}}())}_downloadMomentResourceFile(e){return(0,a.default)((function*(){try{return(yield r(19922)(`./${e}`)).default}catch(t){__LOG__(2)`l10n:_downloadMomentResourceFile failed to download resource ${e}`}}))()}downloadMomentLocale(e){var t=this;const{l:r,loc:n}=e;return c.default.locale()===n?Promise.resolve():(0,o.promiseLoop)(function(){var e=(0,a.default)((function*(e,i,a){const o=(0,s.delayMs)(m.expBackoff(a,12e4,1e3,.1)),l=n.replace(/_/g,"-");let c,d;if(l===u.default.L10N.MOMENT_DEFAULT)c=()=>Promise.resolve(),d=u.default.L10N.MOMENT_DEFAULT;else{const e=[];if(e.push(l),r===u.default.L10N.DEFAULT)e.push(E);else{const t=r.replace(/_/g,"-");e.push(t),null!=_.default[t]&&e.push(_.default[t])}e.push(E);for(let r=0;r<e.length;++r)if(c=yield t._downloadMomentResourceFile(e[r]),null!=c){d=e[r];break}null==c&&(__LOG__(3)`Could not fetch moment locales, using default en-US`,c=()=>Promise.resolve(),d=u.default.L10N.MOMENT_DEFAULT)}try{return yield c(),e(d)}catch(e){return 10===a&&(__LOG__(4,void 0,new Error,!0)`${a} times, locale is (${r}, ${n})`,SEND_LOGS("downloadMomentLocale failure")),o}}));return function(){return e.apply(this,arguments)}}())}updateFbtContext(e,t){l.FbtTranslations.registerTranslations(t)}downloadAndSetTranslation(e){const{l:t,loc:n}=this._locale,{l:i,loc:a}=e,s=this.isRTL(i),o=s?S.RTL:S.LTR;if((0,p.isConnectedToPage)()&&document.getElementById(v[o])&&a===n)return Promise.resolve();const l=self.performance.now();let d,h;return this._fetchPromise=Promise.all([this.downloadAppLocale(i),this.downloadFbtLocaleAndSetCache(i),this.downloadMomentLocale(e)]).then((t=>{let[r,n,s]=t;d=self.performance.now(),this.localeStrings[i]=r,this._locale=e,this.trigger("set_collator",i),s&&(c.default.locale(s),__LOG__(2)`l10n:moment locale updated to: ${s}`),this.customizeMomentLocale(c.default.locale()),(0,p.isConnectedToPage)()&&(document.documentElement&&document.documentElement.setAttribute("lang",e.l),document.documentElement&&document.documentElement.setAttribute("dir",o)),this.updateFbtContext(i,n),this.trigger("locale_change",{l:i,loc:a})})).then((()=>{h=self.performance.now(),__LOG__(2)`l10n:locale updated: (${t}, ${n}) > (${i}, ${a}), Fetch: ${d-l}ms, Apply: ${h-d}ms`;if(r(5882).default.supported){var e;const t=r(79485).default,n=r(37362).default;(null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)&&t.request(navigator.serviceWorker.controller,n.SET_L10N,{isRTL:s,locale:i}).catch((()=>{}))}})).catch((()=>(__LOG__(2)`l10n:locale update error: (${t}, ${n}) > (${i}, ${a})`,this.downloadAndSetTranslation({l:u.default.L10N.DEFAULT,priority:T.DEFAULT,loc:u.default.L10N.DEFAULT}))))}_updateSpellChecker(){}_updateElectronMain(){}customizeMomentLocale(e){const t=f.LOCALE_CUSTOMIZATIONS[e];t&&c.default.locale(e,t)}}A.Dir=S;var C=new A;t.default=C},53558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SHOULD_USE_MOMENT_LOCALE_FORMAT=t.LOCALE_DATE_TIME_CUSTOMIZATIONS=t.LOCALE_CUSTOMIZATIONS=t.LOCALES_THAT_PREFER_24HOUR_TIME=void 0;var i=n(r(81109));const a=new Set(["ur"]);t.SHOULD_USE_MOMENT_LOCALE_FORMAT=a;const s=new Set(["af","az","ca","cs","da","de","el","et","fi","fr","he","hr","hu","id","it","kk","lt","mk","nb","pl","pt","pt-BR","ro","ru","sk","sl","sr","sv","tr","uk"]);t.LOCALES_THAT_PREFER_24HOUR_TIME=s;const o={"zh-tw":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY年MMMD日",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"}},"zh-cn":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"}},ar:{longDateFormat:{LT:"h:mm A",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"}},ta:{longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY, h:mm A"},preparse:null,postformat:null,meridiem:null,meridiemHour:null},nl:{longDateFormat:{l:"DD-MM-YYYY",L:"DD-MM-YYYY"}},"en-ie":{longDateFormat:{l:"DD/MM/YYYY",L:"DD/MM/YYYY"}},hi:{preparse:null,postformat:null,longDateFormat:{LT:"A h:mm बजे",LTS:"A h:mm:ss बजे",LLL:"D MMMM YYYY A h:mm बजे",LLLL:"dddd, D MMMM YYYY, A h:mm बजे"},meridiem:(e,t)=>0===e&&0===t?"मध्यरात्रि":e>=20||e<4?"रात":e>=4&&e<12?"सुबह":e>=12&&e<16?"दोपहर":"शाम"}};t.LOCALE_DATE_TIME_CUSTOMIZATIONS=o;const l=(0,i.default)((0,i.default)({},o),{"pt-pt":{weekdays:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"]}});t.LOCALE_CUSTOMIZATIONS=l},45180:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={ach:{name:"Acholi",numbers:[1,2],plurals:e=>Number(e>1)},af:{name:"Afrikaans",numbers:[1,2],plurals:e=>Number(1!=e)},ak:{name:"Akan",numbers:[1,2],plurals:e=>Number(e>1)},am:{name:"Amharic",numbers:[1,2],plurals:e=>Number(e>1)},an:{name:"Aragonese",numbers:[1,2],plurals:e=>Number(1!=e)},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:e=>Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},arn:{name:"Mapudungun",numbers:[1,2],plurals:e=>Number(e>1)},ast:{name:"Asturian",numbers:[1,2],plurals:e=>Number(1!=e)},ay:{name:"Aymará",numbers:[1],plurals:()=>0},az:{name:"Azerbaijani",numbers:[1,2],plurals:e=>Number(1!=e)},be:{name:"Belarusian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},bg:{name:"Bulgarian",numbers:[1,2],plurals:e=>Number(1!=e)},bn:{name:"Bengali",numbers:[1,2],plurals:e=>Number(1!=e)},bo:{name:"Tibetan",numbers:[1],plurals:()=>0},br:{name:"Breton",numbers:[1,2],plurals:e=>Number(e>1)},bs:{name:"Bosnian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ca:{name:"Catalan",numbers:[1,2],plurals:e=>Number(1!=e)},cgg:{name:"Chiga",numbers:[1],plurals:()=>0},cs:{name:"Czech",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},csb:{name:"Kashubian",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},da:{name:"Danish",numbers:[1,2],plurals:e=>Number(1!=e)},de:{name:"German",numbers:[1,2],plurals:e=>Number(1!=e)},dz:{name:"Dzongkha",numbers:[1],plurals:()=>0},el:{name:"Greek",numbers:[1,2],plurals:e=>Number(1!=e)},en:{name:"English",numbers:[1,2],plurals:e=>Number(1!=e)},eo:{name:"Esperanto",numbers:[1,2],plurals:e=>Number(1!=e)},es:{name:"Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},et:{name:"Estonian",numbers:[1,2],plurals:e=>Number(1!=e)},eu:{name:"Basque",numbers:[1,2],plurals:e=>Number(1!=e)},fa:{name:"Persian",numbers:[1],plurals:()=>0},fi:{name:"Finnish",numbers:[1,2],plurals:e=>Number(1!=e)},fil:{name:"Filipino",numbers:[1,2],plurals:e=>Number(e>1)},fo:{name:"Faroese",numbers:[1,2],plurals:e=>Number(1!=e)},fr:{name:"French",numbers:[1,2],plurals:e=>Number(e>1)},fur:{name:"Friulian",numbers:[1,2],plurals:e=>Number(1!=e)},fy:{name:"Frisian",numbers:[1,2],plurals:e=>Number(1!=e)},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},gl:{name:"Galician",numbers:[1,2],plurals:e=>Number(1!=e)},gu:{name:"Gujarati",numbers:[1,2],plurals:e=>Number(1!=e)},gun:{name:"Gun",numbers:[1,2],plurals:e=>Number(e>1)},ha:{name:"Hausa",numbers:[1,2],plurals:e=>Number(1!=e)},he:{name:"Hebrew",numbers:[1,2],plurals:e=>Number(1!=e)},hi:{name:"Hindi",numbers:[1,2],plurals:e=>Number(1!=e)},hr:{name:"Croatian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},hu:{name:"Hungarian",numbers:[1,2],plurals:e=>Number(1!=e)},hy:{name:"Armenian",numbers:[1,2],plurals:e=>Number(1!=e)},ia:{name:"Interlingua",numbers:[1,2],plurals:e=>Number(1!=e)},id:{name:"Indonesian",numbers:[1],plurals:()=>0},is:{name:"Icelandic",numbers:[1,2],plurals:e=>Number(e%10!=1||e%100==11)},it:{name:"Italian",numbers:[1,2],plurals:e=>Number(1!=e)},ja:{name:"Japanese",numbers:[1],plurals:()=>0},jbo:{name:"Lojban",numbers:[1],plurals:()=>0},jv:{name:"Javanese",numbers:[0,1],plurals:e=>Number(0!==e)},ka:{name:"Georgian",numbers:[1],plurals:()=>0},kk:{name:"Kazakh",numbers:[1],plurals:()=>0},km:{name:"Khmer",numbers:[1],plurals:()=>0},kn:{name:"Kannada",numbers:[1,2],plurals:e=>Number(1!=e)},ko:{name:"Korean",numbers:[1],plurals:()=>0},ku:{name:"Kurdish",numbers:[1,2],plurals:e=>Number(1!=e)},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:e=>Number(1==e?0:2==e?1:3==e?2:3)},ky:{name:"Kyrgyz",numbers:[1],plurals:()=>0},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:e=>Number(1!=e)},ln:{name:"Lingala",numbers:[1,2],plurals:e=>Number(e>1)},lo:{name:"Lao",numbers:[1],plurals:()=>0},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},lv:{name:"Latvian",numbers:[0,1,2],plurals:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2)},mai:{name:"Maithili",numbers:[1,2],plurals:e=>Number(1!=e)},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:e=>Number(e>1)},mg:{name:"Malagasy",numbers:[1,2],plurals:e=>Number(e>1)},mi:{name:"Maori",numbers:[1,2],plurals:e=>Number(e>1)},mk:{name:"Macedonian",numbers:[1,2],plurals:e=>Number(1==e||e%10==1?0:1)},ml:{name:"Malayalam",numbers:[1,2],plurals:e=>Number(1!=e)},mn:{name:"Mongolian",numbers:[1,2],plurals:e=>Number(1!=e)},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:e=>Number(0===e?0:1==e?1:2)},mr:{name:"Marathi",numbers:[1,2],plurals:e=>Number(1!=e)},ms:{name:"Malay",numbers:[1],plurals:()=>0},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:e=>Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},nah:{name:"Nahuatl",numbers:[1,2],plurals:e=>Number(1!=e)},nap:{name:"Neapolitan",numbers:[1,2],plurals:e=>Number(1!=e)},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:e=>Number(1!=e)},ne:{name:"Nepali",numbers:[1,2],plurals:e=>Number(1!=e)},nl:{name:"Dutch",numbers:[1,2],plurals:e=>Number(1!=e)},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:e=>Number(1!=e)},no:{name:"Norwegian",numbers:[1,2],plurals:e=>Number(1!=e)},nso:{name:"Northern Sotho",numbers:[1,2],plurals:e=>Number(1!=e)},oc:{name:"Occitan",numbers:[1,2],plurals:e=>Number(e>1)},or:{name:"Oriya",numbers:[2,1],plurals:e=>Number(1!=e)},pa:{name:"Punjabi",numbers:[1,2],plurals:e=>Number(1!=e)},pap:{name:"Papiamento",numbers:[1,2],plurals:e=>Number(1!=e)},pl:{name:"Polish",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},pms:{name:"Piemontese",numbers:[1,2],plurals:e=>Number(1!=e)},ps:{name:"Pashto",numbers:[1,2],plurals:e=>Number(1!=e)},pt:{name:"Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},"pt-BR":{name:"Brazilian Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},rm:{name:"Romansh",numbers:[1,2],plurals:e=>Number(1!=e)},ro:{name:"Romanian",numbers:[1,2,20],plurals:e=>Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)},ru:{name:"Russian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},sah:{name:"Yakut",numbers:[1],plurals:()=>0},sco:{name:"Scots",numbers:[1,2],plurals:e=>Number(1!=e)},se:{name:"Northern Sami",numbers:[1,2],plurals:e=>Number(1!=e)},si:{name:"Sinhala",numbers:[1,2],plurals:e=>Number(1!=e)},sk:{name:"Slovak",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:e=>Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},so:{name:"Somali",numbers:[1,2],plurals:e=>Number(1!=e)},son:{name:"Songhay",numbers:[1,2],plurals:e=>Number(1!=e)},sq:{name:"Albanian",numbers:[1,2],plurals:e=>Number(1!=e)},sr:{name:"Serbian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},su:{name:"Sundanese",numbers:[1],plurals:()=>0},sv:{name:"Swedish",numbers:[1,2],plurals:e=>Number(1!=e)},sw:{name:"Swahili",numbers:[1,2],plurals:e=>Number(1!=e)},ta:{name:"Tamil",numbers:[1,2],plurals:e=>Number(1!=e)},te:{name:"Telugu",numbers:[1,2],plurals:e=>Number(1!=e)},tg:{name:"Tajik",numbers:[1,2],plurals:e=>Number(e>1)},th:{name:"Thai",numbers:[1],plurals:()=>0},ti:{name:"Tigrinya",numbers:[1,2],plurals:e=>Number(e>1)},tk:{name:"Turkmen",numbers:[1,2],plurals:e=>Number(1!=e)},tr:{name:"Turkish",numbers:[1,2],plurals:e=>Number(e>1)},tt:{name:"Tatar",numbers:[1],plurals:()=>0},ug:{name:"Uyghur",numbers:[1],plurals:()=>0},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ur:{name:"Urdu",numbers:[1,2],plurals:e=>Number(1!=e)},uz:{name:"Uzbek",numbers:[1,2],plurals:e=>Number(e>1)},vi:{name:"Vietnamese",numbers:[1],plurals:()=>0},wa:{name:"Walloon",numbers:[1,2],plurals:e=>Number(e>1)},wo:{name:"Wolof",numbers:[1],plurals:()=>0},yo:{name:"Yoruba",numbers:[1,2],plurals:e=>Number(1!=e)},zh:{name:"Chinese",numbers:[1],plurals:()=>0}};t.default=r},73289:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=O;var i=n(r(48926)),a=(r(70818),r(65044)),s=r(7293),o=r(79736),l=r(41796),c=r(46582),d=r(99234),u=r(58052),p=n(r(69618)),h=r(36163),f=r(97480),_=r(10786),m=r(76214),g=r(318),y=r(92613),E=n(r(18438)),S=r(29100),v=r(24747),T=r(24433),A=r(88102),C=n(r(67938)),b=n(r(52991));function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(){return(0,v.startComms)(E.default,S.sendPing),yield(0,v.waitForConnection)(),(0,v.startHandlingRequests)()}))).apply(this,arguments)}function O(e){const t=(0,o.makeBridge)();(0,l.setBridge)(t),(0,c.requireSetHandlers)().then((e=>e(t)));let r=Promise.resolve();return s.GK.supportsFeature(s.GK.F.MD_BACKEND)?r=(0,_.initEncSalt)().then((()=>(0,_.initEncSaltForInvoker)())).then((()=>(0,g.initialize)())).catch((e=>{__LOG__(4,void 0,new Error,void 0,["launch_socket"])`storageInitializationError triggered logout: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}.`,A.Cmd.storageInitializationError()})).then((()=>{if(b.default.isLogoutInProgress)throw new Error("aborting launchSocket due to logout");return(0,u.isRegistered)()?(__LOG__(2)`[launch socket] launch socket for loggin`,A.Cmd.initialLoadReady(),(0,m.initialize)().catch((()=>A.Cmd.storageInitializationError())).then((()=>{A.Cmd.incrementProgress(),(0,h.restoreImportantMetaData)()})).then((()=>(0,h.restoreBlocklist)())).then((()=>{A.Cmd.incrementProgress(),(0,y.startBackend)()}))):(__LOG__(2)`[launch socket] launch socket for registration`,A.Cmd.incrementProgress(),f.OfflineResumeReporter.setIsInitialSync(),Promise.all([(0,T.refreshNoiseCredentials)(),(0,T.refreshSignalCredentials)()]).then((()=>{A.Cmd.incrementProgress(),P()})))})):a.Socket.launch(e),r}A.Cmd.on("md_downgrade_webclient",(0,i.default)((function*(){(0,v.stopComms)(),yield(0,_.deleteEncKeysAndCache)(),a.Socket.set({launched:!1,stream:p.default.SOCKET_STREAM.DISCONNECTED,mustExitLoop:!1,shouldUpgradeToMD:!1}),(0,d.setMdOptedIn)(!1),s.GK.setFeature(s.GK.F.MD_BACKEND,!1),s.GK.setFeature(s.GK.F.MD_ADV,!1),s.GK.setFeature(s.GK.F.MD_VOIP_GROUP,!1),a.Socket.initialize(),a.Socket.handler||a.Socket.registerHandler(C.default),O(!0)}))),A.Cmd.on("upgrade_to_md",(()=>{s.GK.setFeature(s.GK.F.MD_BACKEND,!0),s.GK.setFeature(s.GK.F.MD_ADV,!0),s.GK.setFeature(s.GK.F.MD_VOIP_GROUP,!1),O(!0),(0,u.setUpgradeMdWamFlag)(!0)})),A.Cmd.on("upgrade_to_md_prod",(()=>{s.GK.setFeature(s.GK.F.MD_BACKEND,!0),s.GK.setFeature(s.GK.F.MD_ADV,!0),s.GK.setFeature(s.GK.F.MD_VOIP_GROUP,!1),O(!0),(0,u.setUpgradeMdWamFlag)(!0)})),A.Cmd.on("md_refresh_qr",(()=>{(0,v.stopComms)(),P()})),A.Cmd.on("logout",(()=>{s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&O(!0)}))},67826:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926));t.default=class{constructor(e){let{name:t,handler:r=null,interval:n=3600,restingInterval:i=18e3,sleepWhileResting:a=!1,randomIntervalExtension:s=0}=e;if(this._running=!1,this._slowDown=!1,this._name=t,this._interval=1e3*n,this._restingInterval=1e3*i,this._sleepWhileResting=a,this._randomIntervalExtension=1e3*s,this._rest(),"function"==typeof r)this.poll(r);else if(null!=r)throw new Error("Poll handler must be a function or null")}_getRandomExtension(){return Math.ceil(Math.random()*this._randomIntervalExtension)}_getInterval(){return(this._slowDown?this._restingInterval:this._interval)+this._getRandomExtension()}_rest(){document.addEventListener("visibilitychange",(()=>{this._lock||(document.hidden?this._sleepWhileResting?(__LOG__(2)`LazyPoll[${this._name}]: Inactive paused`,this._pause()):(__LOG__(2)`LazyPoll[${this._name}]: Inactive slowing down`,this._slowDown=!0):this._callback&&(__LOG__(2)`LazyPoll[${this._name}]: Active Resuming`,this._resume()))}),!1)}_isDue(){if(!this._lastPoll)return!0;return Date.now()-this._lastPoll>=this._getInterval()}_pause(){clearTimeout(this._timer),this._running=!1}_resume(){this._slowDown=!1,this._running=!0,this._cycle()}_cycle(){var e=this;return(0,i.default)((function*(){e._running&&(e._isDue()&&(__LOG__(2)`LazyPoll[${e._name}]: Polling...`,yield e._callback(),e._lastPoll=Date.now()),clearTimeout(e._timer),e._timer=setTimeout((()=>e._cycle()),e._getInterval()))}))()}poll(e){null==this._callback?(this._callback=e,this._running=!0,this._cycle()):this.resume()}pause(){__LOG__(2)`LazyPoll[${this._name}]: Manually Paused`,this._lock=!0,this._pause()}resume(){__LOG__(2)`LazyPoll[${this._name}]: Manually Resumed`,this._lock=!1,this._resume()}}},86688:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.findLink=M,t.findLinks=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(!b.test(e))return[];C.lastIndex=0;const n=[];let i;for(;i=P(e);){const e=O(i,t,r);e&&n.push(e)}return n},t.validateEmail=function(e){const t=M(e);return t&&t.url===e&&"mailto:"===t.scheme&&t.username&&!t.params&&!t.anchor?t:null};var i=r(19797),a=r(53659),s=n(r(3689)),o=r(17239),l=r(99234),c=r(16238);const d=[...c.TLD].join("|"),u=/^https?:\/\/$/gi,p="\\w|[^\\s\0-«»‘’“”]|%[0-9a-f][0-9a-f]",h=`${d}|xn--(?:${p})+`,f=`(?:${p})|(?:${p})(?:${p}|-)*(?:${p})`,_=`(?:${p}|[^\\s%])`,m=`[@!.?,(\\[{<«‘“:]*(?!${_}|#)`,g="0-9a-z!#$%&'*+/=?^_`{|}~\\-",y=`(^|\\W\\.|[^/\\w.]|_)((?:http|https)://|mailto:)?(${`\\b\\w[${g}]*(?:\\.[${g}]+)*`}@)?(${`(?!_)(?:(?:${f})\\.)+(${h})(?!\\.${f})`})(?:(?!${f})|(?=_))(?:(?=[^:/?#])|(:\\d{1,5})?(${`/${_}*?`})?(${`\\?(?!${m})${_}*?`})?(${`#${_}*?`})?(?=${m}))`,E=7,S=8,v=9,T=new Map([[34,34],[41,40],[62,60],[93,91],[125,123],[187,171],[8217,8216],[8221,8220]]),A=new Map([[34,34],[40,41],[60,62],[91,93],[123,125],[171,187],[8216,8217],[8220,8221]]),C=new RegExp(`${y}`,"ig"),b=new RegExp(`\\.(?:${h})`,"i");function P(e){try{return C.exec(e)}catch(t){return __LOG__(4,void 0,new Error,!0)`text size: ${e.length}, error: ${String(t)}`,SEND_LOGS("linkify-regex-error"),null}}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;return C.lastIndex=0,O(P(e),t,r)}function O(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(!e)return null;const n=e[1].length;let d=e[0];const p=e.index+n,{index:h}=e,f="_"===e[1];if(f&&h-1&&/\S/.test(e.input[h-1]))return null;const _=e[5];if(_&&_.startsWith("xn--")&&!c.TLD.has(s.default.toUnicode(_)))return null;if(e[6]){const t=parseInt(e[6].slice(1),10);if("0"===e[6][1]||!(0<t&&t<65536))return null}const m=[v,S,E].find((t=>null==e?void 0:e[t]))||0;if(m){const t=[];let r=e[m];"_"===r.slice(-1)&&"_"===d[p-1]&&(d=d.slice(0,-1),e[m]=r=r.slice(0,-1));let i=0,a=0;for(let e=0;e<r.length;e++){const n=r.charCodeAt(e);n===a?(a=t.pop()||0,0===a&&(i=e)):A.has(n)?(0!==a&&t.push(a),a=A.get(n)):T.has(n)||0===a&&(i=e)}if(i!==r.length-1){const t=e.slice(2,m);t.splice(3,1),d=t.filter((e=>e)).join("")+r.slice(0,i+1),C.lastIndex=p+d.length}else d=d.slice(n)}else d=d.slice(n);let g=d,y=e[2];const b=Boolean(y&&y.match(u));if(t&&!b)return null;y?y=y.toLowerCase():(y=0===g.toLowerCase().indexOf("irc.")?"irc://":0===g.toLowerCase().indexOf("ftp.")?"ftp://":e[3]?"mailto:":"http://",g=y+g);const P=e[4],M=(0,l.getMaybeMeUser)();return{href:g,url:d,index:p,input:e.input,scheme:y,username:e[3],domain:P,port:e[6],path:e[E],params:e[S],anchor:e[v],isHttp:b,suspiciousCharacters:r&&M?(0,a.findSuspiciousCharacters)(P,(0,i.toUserJid)(r.user),(0,i.toUserJid)(M.user),o.Conn.allLanguages):void 0}}},92417:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{r=window.localStorage}catch(e){}var n=r;t.default=n},70818:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0,t.cycleThroughLogLines=v,t.log=void 0;var i=n(r(48926)),a=n(r(35161)),s=r(57319),o=n(r(30381)),l=n(r(69618)),c=n(r(76589)),d=r(82449),u=n(r(98387)),p=r(97237),h=n(r(99304));let f=l.default.LOG_SIZE_WEB;const _=Date.now(),m="LTSXOo+_*-=.<^!#?".split("");function g(){return m[Math.round(Math.random()*(m.length-1))]}const y=g()+g()+g()+g(),E={};E[E.ALL=0]="all",E[E.INFO=1]="info",E[E.LOG=2]="log",E[E.WARN=3]="warn",E[E.ERROR=4]="error",E[E.OFF=5]="off";function S(e){switch(e){case E.INFO:case E.LOG:case E.WARN:case E.ERROR:return E[e];default:throw new Error(`Unexpected numeric log level: ${e}`)}}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n){yield A(e,t+1,r,n),yield A(0,e,r,n)}))).apply(this,arguments)}function A(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,r,n){for(let i=e;i<t;i+=r){const e=Math.min(i+r,t);yield n(i,e)}}))).apply(this,arguments)}const b=new class{constructor(){var e=this;this.logs=[],this.localCursor=0,this.pending=void 0,this.timer=new s.ShiftTimer((()=>this._persistIdb())),this.isTakeOver=!1,this.log=(0,u.default)((function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return function(s){for(var o=arguments.length,l=new Array(o>1?o-1:0),d=1;d<o;d++)l[d-1]=arguments[d];const u=(0,c.default)(s,l,!r);return e.logImpl(t,u,n,i,a),u}}),((e,t,r,n,i)=>r||i?null:String(e)+String(Boolean(t))+String(Boolean(n))))}logImpl(e,t,r,n,i){const a=(0,o.default)().locale("en").format("YYYY-MM-DD HH:mm:ss.SSS:"),s=r?`\n${(0,p.normalizeStack)(r,!0)}`:"",l=[S(e),n?"sendlogs":null,...null!=i?i:[]].filter(Boolean).map((e=>`[${e}]`)).join(""),c=`${y} ${a}`+(l?`${l} `:"")+t+s;this.logs.push(c),this.isTakeOver||(this.logs.length>f&&(this.logs.shift(),this.localCursor--),this.timer.debounceAndCap(250,1e3))}logUncaughtError(e,t){const r=e instanceof Error&&e.stack?e:void 0;let n;if(n=r?String(e):t?`Promise rejected: ${String(e)}`:`Error: ${String(e)}`,this.logImpl(E.ERROR,n,r,!0,["uncaught"]),null!=t){const e=String(t);this.logImpl(E.WARN,e)}}onTakeOver(){this.isTakeOver=!0}getLogs(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=r(19197).default,o=[];return this.pending&&o.push(this.pending),this.timer.isScheduled()&&(this.timer.forceRunNow(),this.pending&&o.push(this.pending)),Promise.all(o).then((()=>s.idb())).then(function(){var r=(0,i.default)((function*(r){return(0,d.getTimeboxedAndTrimmedLogs)(r,t?0:e._createTimeStamp()-6048e5,n)}));return function(){return r.apply(this,arguments)}}()).then((e=>(0,a.default)(e,"log"))).catch((()=>this.logs))}_clearLogsInBatches(){var e=this;return(0,i.default)((function*(){const t=r(19197).default,{asyncSleep:n}=r(97401),a=yield t.idb(),s=yield a.logs.toCollection().last();if(null==s)return;const o=s.line,l=e._getCursor(),c=function(){var e=(0,i.default)((function*(e,t){try{yield a.transaction("rw",a.logs,(0,i.default)((function*(){const r=yield a.logs.where("line").between(e,t).primaryKeys();yield a.logs.bulkDelete(r)})))}catch(e){__LOG__(2)`_clearLogsInBatches: error while deleting, ${e.stack}`}yield n(0)}));return function(){return e.apply(this,arguments)}}();yield v(l,o,1e3,c)}))()}_clearLogsInDB(){return(0,i.default)((function*(){const e=r(19197).default;yield e.idb().then((e=>e.logs.clear())).catch((()=>{}))}))()}clearLogs(){var e=this;return(0,i.default)((function*(){yield e._clearLogsInDB(),e._setCursor(0),e.localCursor=0,e.logs=[]}))()}clearLogsPreemptive(){var e=this;return(0,i.default)((function*(){{const{getShouldPreemptivelyCleanupLogs:t,setShouldPreemptivelyCleanupLogs:n}=r(99234);t()&&(yield e._clearLogsInDB(),n(!1))}}))()}_optimisticallyAdvanceCursor(e,t){this.localCursor+=t,this._setCursor((e+t)%f)}_persistIdb(){const e=r(19197).default,t=this.logs.slice(Math.max(this.localCursor,0),this.logs.length);t.length&&(this.pending=e.idb().then((e=>e.transaction("rw",e.logs,e.user,(()=>{let r=this._getCursor();this._optimisticallyAdvanceCursor(r,t.length),t.forEach((t=>{r=(r+1)%f,e.logs.put({line:r,log:t,timestamp:this._createTimeStamp()})}))})))).catch((()=>{})).finally((()=>{this.pending=void 0})))}_createTimeStamp(){return performance&&performance.now()+_||Date.now()}_getCursor(){try{return JSON.parse(h.default.getItem(l.default.KEY_LOG_CURSOR))||Math.max(this.localCursor,0)}catch(e){return Math.max(this.localCursor,0)}}_setCursor(e){return h.default.setItem(l.default.KEY_LOG_CURSOR,String(e))}};t.Logger=b;const P=b.log;t.log=P},82449:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TRIM_LENGTH=t.END_OF_UPLOAD=void 0,t.getTimeboxedAndTrimmedLogs=function(){return s.apply(this,arguments)};var i=n(r(48926));const a="==================================================EOU";t.END_OF_UPLOAD=a;function s(){return(s=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[];if(r){const r=yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).reverse().until((e=>e.log.includes("[sendlogs]")),!0).toArray();for(let e=r.length-1;e>=0&&(o(r[e],n),!r[e].log.includes(a));e--);}else yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).each((e=>{o(e,n)}));return n}))).apply(this,arguments)}function o(e,t){e.log=e.log.slice(0,2500),t.push(e)}t.TRIM_LENGTH=2500},64084:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(88306)),a=r(15688);function s(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function o(e,t,r,n,i,a){return s((o=s(s(t,e),s(n,a)))<<(l=i)|o>>>32-l,r);var o,l}function l(e,t,r,n,i,a,s){return o(t&r|~t&n,e,t,i,a,s)}function c(e,t,r,n,i,a,s){return o(t&n|r&~n,e,t,i,a,s)}function d(e,t,r,n,i,a,s){return o(t^r^n,e,t,i,a,s)}function u(e,t,r,n,i,a,s){return o(r^(t|~n),e,t,i,a,s)}function p(e){return function(e,t){let r,n,i,a;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let o=1732584193,p=-271733879,h=-1732584194,f=271733878;for(let t=0;t<e.length;t+=16)r=o,n=p,i=h,a=f,o=l(o,p,h,f,e[t],7,-680876936),f=l(f,o,p,h,e[t+1],12,-389564586),h=l(h,f,o,p,e[t+2],17,606105819),p=l(p,h,f,o,e[t+3],22,-1044525330),o=l(o,p,h,f,e[t+4],7,-176418897),f=l(f,o,p,h,e[t+5],12,1200080426),h=l(h,f,o,p,e[t+6],17,-1473231341),p=l(p,h,f,o,e[t+7],22,-45705983),o=l(o,p,h,f,e[t+8],7,1770035416),f=l(f,o,p,h,e[t+9],12,-1958414417),h=l(h,f,o,p,e[t+10],17,-42063),p=l(p,h,f,o,e[t+11],22,-1990404162),o=l(o,p,h,f,e[t+12],7,1804603682),f=l(f,o,p,h,e[t+13],12,-40341101),h=l(h,f,o,p,e[t+14],17,-1502002290),p=l(p,h,f,o,e[t+15],22,1236535329),o=c(o,p,h,f,e[t+1],5,-165796510),f=c(f,o,p,h,e[t+6],9,-1069501632),h=c(h,f,o,p,e[t+11],14,643717713),p=c(p,h,f,o,e[t],20,-373897302),o=c(o,p,h,f,e[t+5],5,-701558691),f=c(f,o,p,h,e[t+10],9,38016083),h=c(h,f,o,p,e[t+15],14,-660478335),p=c(p,h,f,o,e[t+4],20,-405537848),o=c(o,p,h,f,e[t+9],5,568446438),f=c(f,o,p,h,e[t+14],9,-1019803690),h=c(h,f,o,p,e[t+3],14,-187363961),p=c(p,h,f,o,e[t+8],20,1163531501),o=c(o,p,h,f,e[t+13],5,-1444681467),f=c(f,o,p,h,e[t+2],9,-51403784),h=c(h,f,o,p,e[t+7],14,1735328473),p=c(p,h,f,o,e[t+12],20,-1926607734),o=d(o,p,h,f,e[t+5],4,-378558),f=d(f,o,p,h,e[t+8],11,-2022574463),h=d(h,f,o,p,e[t+11],16,1839030562),p=d(p,h,f,o,e[t+14],23,-35309556),o=d(o,p,h,f,e[t+1],4,-1530992060),f=d(f,o,p,h,e[t+4],11,1272893353),h=d(h,f,o,p,e[t+7],16,-155497632),p=d(p,h,f,o,e[t+10],23,-1094730640),o=d(o,p,h,f,e[t+13],4,681279174),f=d(f,o,p,h,e[t],11,-358537222),h=d(h,f,o,p,e[t+3],16,-722521979),p=d(p,h,f,o,e[t+6],23,76029189),o=d(o,p,h,f,e[t+9],4,-640364487),f=d(f,o,p,h,e[t+12],11,-421815835),h=d(h,f,o,p,e[t+15],16,530742520),p=d(p,h,f,o,e[t+2],23,-995338651),o=u(o,p,h,f,e[t],6,-198630844),f=u(f,o,p,h,e[t+7],10,1126891415),h=u(h,f,o,p,e[t+14],15,-1416354905),p=u(p,h,f,o,e[t+5],21,-57434055),o=u(o,p,h,f,e[t+12],6,1700485571),f=u(f,o,p,h,e[t+3],10,-1894986606),h=u(h,f,o,p,e[t+10],15,-1051523),p=u(p,h,f,o,e[t+1],21,-2054922799),o=u(o,p,h,f,e[t+8],6,1873313359),f=u(f,o,p,h,e[t+15],10,-30611744),h=u(h,f,o,p,e[t+6],15,-1560198380),p=u(p,h,f,o,e[t+13],21,1309151649),o=u(o,p,h,f,e[t+4],6,-145523070),f=u(f,o,p,h,e[t+11],10,-1120210379),h=u(h,f,o,p,e[t+2],15,718787259),p=u(p,h,f,o,e[t+9],21,-343485551),o=s(o,r),p=s(p,n),h=s(h,i),f=s(f,a);return new Uint8Array([255&o,o>>>8&255,o>>>16&255,o>>>24&255,255&p,p>>>8&255,p>>>16&255,p>>>24&255,255&h,h>>>8&255,h>>>16&255,h>>>24&255,255&f,f>>>8&255,f>>>16&255,f>>>24&255])}(function(e){let t;const r=[];for(r[(e.length>>2)-1]=0,t=0;t<r.length;t+=1)r[t]=0;const n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}(e),8*e.length)}var h=(0,i.default)((e=>(0,a.encodeB64)(p(e))));t.default=h},35416:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genCurrentSessionId=function(){return h.apply(this,arguments)},t.genSessionId=f;var i=n(r(48926)),a=r(15688),s=r(8584),o=n(r(45095)),l=r(5087),c=r(99234),d=n(r(76128)),u=n(r(42810)),p=r(93832);function h(){return(h=(0,i.default)((function*(){const e=(0,p.createSignalAddress)((0,c.getMeUser)()).toString(),t=(0,o.default)(yield d.default.loadIdentityKey(e),"yield PersistSignalProtocolStore.loadIdentityKey(primaryDeviceIdentifier)"),r=(0,l.toCurveKeyPubKey)((0,p.strToBuffer)(t)),n=(0,o.default)(yield d.default.getIdentityKeyPair(),"yield SignalProtocolStore.getIdentityKeyPair()");return f(r,(0,l.toCurveKeyPubKey)(n.pubKey))}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){if(32!==e.byteLength)throw new Error(`genSessionId: primary identity public key is ${e.byteLength} bytes, should be 32!`);if(32!==t.byteLength)throw new Error(`genSessionId: companion identity public key is ${e.byteLength} bytes, should be 32!`);const r=new s.Binary;r.writeBuffer(e),r.write("_".charCodeAt(0)),r.writeBuffer(t);const n=r.readByteArray(),i=yield u.default.digest({name:"SHA-256"},n);return(0,a.encodeB64)(i)}))).apply(this,arguments)}},49801:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_QUOTA_UNAVAILABLE=t.MdSyncFieldStatsMeta=void 0;var i=n(r(48926)),a=n(r(96222)),s=r(35416);t.STORAGE_QUOTA_UNAVAILABLE=-1;const o=new class{constructor(){this._storageEstimation={mdStorageQuotaBytes:-2,mdStorageQuotaUsedBytes:-2},this._mdSessionId=null}getStorageEstimation(){var e=this;return(0,i.default)((function*(){if(-2!==e._storageEstimation.mdStorageQuotaBytes)return Promise.resolve(e._storageEstimation);const t=yield(0,a.default)();return e._storageEstimation={mdStorageQuotaBytes:t?t.quota:-1,mdStorageQuotaUsedBytes:t?t.usage:-1},e._storageEstimation}))()}getMdSessionId(){var e=this;return(0,i.default)((function*(){return null!=e._mdSessionId||(e._mdSessionId=yield(0,s.genCurrentSessionId)()),e._mdSessionId}))()}};t.MdSyncFieldStatsMeta=o},41933:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return(0,n.getABPropConfigValue)("web_abprop_skip_file_copy_on_attach");return!1};var n=r(86945),i=r(7293)},97390:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265),i=r(64103);class a extends((0,n.customError)("MediaFileTooLarge",!0,i.MediaFileError)){constructor(e){super(`File (${e.type()}) size = ${e.size()}`),this.opaqueData=e}}t.default=a},97692:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=void 0,t.disposeVideo=v,t.getMediaTagErrorReason=y,t.image=function(e){return E(e).then((e=>{if(e&&e.naturalWidth>0)return{img:e,fullWidth:e.naturalWidth,fullHeight:e.naturalHeight};throw new c.MediaLoadError("image loaded with zero width")})).catch((()=>{throw new c.MediaLoadError("unable to render image")}))},t.loadImage=E,t.loadVideo=S,t.transcode=function(e,t){const r=t||e.type;if((0,d.default)(r)&&!_){if(e.size<=3e5){return new h.default(e).generateBlob()}return Promise.reject(new c.TranscodeBlobTooLargeError)}return Promise.resolve(e)},t.videoWidthHeightDuration=function(e){return S(e).then((e=>{let{video:t,fullWidth:r,fullHeight:n,duration:i}=e;return v(t),{width:r,height:n,duration:i}}))};var a=r(40265),s=r(50796),o=r(13959),l=r(38284),c=i(r(64103)),d=n(r(7056)),u=n(r(26402)),p=n(r(11339)),h=n(r(69283)),f=r(65127);const _=(new Audio).canPlayType("audio/ogg");t.canPlayOgg=_;let m=0,g=Promise.resolve();function y(e){if(!e||!e.error)return null;const t=e.error;let r=Object.keys(u.default).find((e=>u.default[e]===t.code));r=r||`UNKNOWN CODE ${t.code}`;const n=t.message&&~t.message.indexOf(":")?t.message.split(":")[0]:"";return n?`${r}: ${n}`:r}function E(e){let t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(n,i){t=new Image;const a=/^(?:data|blob):/.test(e);r&&!a&&t.setAttribute("crossOrigin","anonymous"),t.onload=n,t.onabort=()=>{i(new Error("loadImage onabort"))},t.onerror=()=>{i(new c.InvalidImageFileType("Image tag load error"))},t.src=e})).then((()=>t))}function S(e){const t=g.then((()=>function(e){const t=new p.default.WebcMediaLoad;let r,n,i=null;const d=++m;function u(){r&&i&&(document.body&&document.body.removeChild(i),i=null)}let h=!0;const _=new Promise((function(t,a){__LOG__(2)`MediaLoad:video called (#${d})`;let s=!1,o=!1;r=document.createElement("video"),r.setAttribute("crossOrigin","anonymous"),r.volume=0,r.muted=!0,r.playsinline=!0;const l=()=>{o&&s&&t()};if(r.onloadedmetadata=()=>{__LOG__(2)`MediaLoad:video.onloadedmetadata #${d}. Video ready: ${o}. Video width: ${r.videoWidth}`,r.onloadedmetadata=null,s=!0,l()},r.oncanplaythrough=()=>{__LOG__(2)`MediaLoad:video.oncanplaythrough #${d}. Metadata loaded: ${s}. Video width: ${r.videoWidth}`,r.oncanplaythrough=null,r.onseeked=()=>{o=!0,r.onseeked=null,l()},r.currentTime=0},r.onerror=()=>{const t=r.error?r.error.message:"no error message";__LOG__(3)`MediaLoad:video.onerror #${d}: ${String(t)}\n Blob info -> size:${e.size}, type: ${e.type}`;const n=y(r);a(new c.UnableToPlayVideoError(n))},r.src=n=window.URL.createObjectURL(e),f.UA.isSafari){i=document.createElement("div");const e=i;e.style="opacity: 0.004",e.appendChild(r),document.body&&document.body.appendChild(e)}r.load(),r.currentTime=1})).finally((()=>{h=!1}));setTimeout((()=>{u(),h&&(__LOG__(3)`unable to load video #${d} (${e.size} bytes)`,new p.default.WebcMediaLoad({webcMediaLoadResult:p.default.WEBC_MEDIA_LOAD_RESULT_CODE.SILENCE}).commit())}),8e3);const g=(0,l.promiseTimeout)(_,2e4).then((()=>(0,o.delayMs)(10))).then((()=>{if(t.markWebcMediaLoadT(),__LOG__(2)`MediaLoad:video #${d} successful`,r.pause(),r.videoWidth>0)return t.webcMediaLoadResult=p.default.WEBC_MEDIA_LOAD_RESULT_CODE.SUCCESS,t.commit(),{video:r,fullWidth:r.videoWidth,fullHeight:r.videoHeight,duration:r.duration};throw r.duration>0?(__LOG__(3)`MediaLoad:video #${d} dimensions are not defined. Video readyState: ${r.readyState}. Video width: ${r.videoWidth}`,new c.MediaUnsupportedError("video loaded with duration but no dims")):(t.webcMediaLoadResult=p.default.WEBC_MEDIA_LOAD_RESULT_CODE.ZEROWIDTH,t.commit(),new c.MediaLoadError("video loaded with zero width"))})).catch((0,s.filteredCatch)(a.TimeoutError,(e=>{throw __LOG__(4,void 0,new Error,!0)`MediaLoad:video load error, currentTime=${r.currentTime}. duration=${r.duration}`,SEND_LOGS("video-load-timeout"),e}))).finally((()=>{u(),r&&(r.onloadedmetadata=null,r.onloadeddata=null,r.oncanplaythrough=null,r.ontimeupdate=null,r.onerror=null),n&&window.URL.revokeObjectURL(n)}));return g.catch((()=>{v(r)})),g}(e)));return g=(0,l.promiseTimeout)(t,1e3).then((()=>{}),(()=>{})),t}function v(e){try{e.pause(),e.src="",e.load()}catch(e){__LOG__(4,void 0,new Error,!0)`Error: ${String(e)}`,SEND_LOGS("dispose-video-error")}}},70634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoizeCache=void 0,t.clearAllMemoizeCache=function(){a.forEach((e=>e.clear()))},t.setupMemoizeCache=function(){i.default.Cache=s};var i=n(r(88306));const a=[];class s extends Map{constructor(){super(),a.push(this)}}t.MemoizeCache=s},98387:(e,t)=>{"use strict";function r(e,t){const n=function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];const s=t?t.apply(this,i):i[0];if(!s)return e.apply(this,i);const o=n.cache;if(o.has(s))return o.get(s);const l=e.apply(this,i);return n.cache=o.set(s,l)||o,l};return n.cache=new(r.Cache||Map),n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r.Cache=Map;var n=r;t.default=n},30071:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default,r=null;const n=function(n){return null!=r&&t(r.params,n)?r.params=n:r={params:n,result:e.call(this,n)},r.result};return n.clear=()=>{r=null},n};var i=n(r(96774))},32219:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(99234),a=r(7293),s=n(r(88382)),o=n(r(39546)),l=r(58021);class c{constructor(e){let t=e;if(!t)throw new Error("MsgKey error: obj is null/undefined");t.id instanceof c&&(t=t.id,__LOG__(3)`MsgKey error: id is already a MsgKey`);const r=t.from&&t.to&&t.id,n=void 0!==t.fromMe&&t.remote&&t.id;let s,l,d,u,p,h,f;const _=(0,i.getMaybeMeUser)();if(!_)throw new Error("MsgKey error: me is undefined");if(r&&n)throw __LOG__(3)`Unclear constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: unclear which constructor to use");if(!r&&!n)throw __LOG__(3)`No matching constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: don't have a matching constructor");if(r){if(({from:s,to:l,id:d,participant:u,selfDir:p}=t),!(s instanceof o.default)||!(l instanceof o.default)||u&&!(u instanceof o.default))throw __LOG__(3)`Incorrect Wid MsgKey: from:${String(s)} to:${String(l)} p:${String(u)}`,new Error("MsgKey error: something is not a wid");p=o.default.equals(s,l)?p:void 0,o.default.equals(s,l)&&o.default.equals(s,_)?(h="out"===p,f=_):o.default.equals(s,_)?(h=!0,f=l):o.default.equals(l,_)?(h=!1,f=s):o.default.equals(s,l)&&(o.default.isGroup(s)||o.default.isBroadcast(s))?(h=!0,f=s):__LOG__(3)`MsgKey case error: ${[s,l,d,_].join()}`,void 0!==h&&(this.fromMe=h),f&&(this.remote=f),d&&(this.id=d)}else if(n){if(({fromMe:h,remote:f,id:d,participant:u}=t),!(f instanceof o.default)||u&&!(u instanceof o.default))throw __LOG__(3)`Incorrect Wid MsgKey: remote:${String(f)} p:${String(u)}`,new Error("MsgKey error: something is not a wid");o.default.equals(_,f)&&(p=h?"out":"in"),void 0!==h&&(this.fromMe=h),f&&(this.remote=f),d&&(this.id=d)}const m=[this.fromMe,this.remote,this.id];void 0!==p&&(this.self=p,m.push(this.self));a.GK.supportsAnyFeature(a.GK.F.KEY_PARTICIPANT,a.GK.F.MD_BACKEND)&&void 0!==u&&(this.participant=u,m.push(this.participant)),this._serialized=m.join("_")}toString(){return this._serialized}clone(){return new c({fromMe:this.fromMe,remote:this.remote,id:this.id,participant:this.participant})}equals(e){return e instanceof c&&this.toString()===e.toString()}static fromString(e){const{fromMe:t,remote:r,id:n,participant:i}=(0,s.default)(e);return new c({fromMe:t,remote:(0,l.createWid)(r),id:n,participant:i?(0,l.createWid)(i):void 0})}}t.default=c},88382:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e||!(0,n.isString)(e))throw new Error("MsgKey fromString error: str is null or not a string");const t=e.split("_");let r;t.length<3?__LOG__(3)`MsgKey error: cannot create MsgKey from ${e}`:4===t.length?"out"!==t[3]&&"in"!==t[3]&&(r=t[3]):5===t.length&&(r=t[4]);return{fromMe:"true"===t[0],remote:t[1],id:t[2],participant:r}};var n=r(31515)},57220:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(11290),s=n(r(69618)),o=n(r(75203)),l=n(r(58596));class c extends a.BaseModel{constructor(){super(...arguments),this.online=(0,a.session)(!0),this.waitIfOffline=(0,l.default)((()=>"all"),(0,i.default)((function*(){this.online||(__LOG__(2)`waitIfOffline: Waiting...`,yield new Promise((e=>{this.listenToOnce(this,"change:online",(()=>{__LOG__(2)`waitIfOffline: Continuing...`,e()}))})))}))),this.checkOnline=(0,l.default)((()=>"all"),(0,i.default)((function*(){__LOG__(2)`NetworkStatus:checkOnline checking`;try{const e=yield(0,o.default)(s.default.STATUS_URL);this.online=!!e,__LOG__(2)`NetworkStatus:checkOnline response ${String(this.online)}`}catch(e){__LOG__(3)`NetworkStatus:checkOnline errored! ${String(e)}`}})))}initialize(){this.listenTo(this,"change:online",this._logOnlineOffline),this._logOnlineOffline()}_logOnlineOffline(){const e=this.online;__LOG__(2)`NetworkStatus ${e?"online":"offline"}`}}var d=new((0,a.defineModel)(c));t.default=d},47524:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEffectiveNetworkType=function(){return navigator.connection&&"string"==typeof navigator.connection.effectiveType?navigator.connection.effectiveType:null}},97237:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeError=o,t.normalizeStack=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{name:r,message:n,stack:i}=o(e),a=i.indexOf("\n"),l=i.slice(0,a),c=l.match(new RegExp(`(${(0,s.default)(r)}|Error)(:|$)`));if(null!=c){if(!t)return i;const e=c.index+c[0].length,r=null==n?-1:i.indexOf(n,e),s=null==n||-1===r?-1:r+n.length,o=Math.max(0,a,e,s);return i.slice(o).replace(/^\n+/,"")}if(t)return i;const d=""===i?"":`\n${i}`;return n?`${r}: ${n}${d}`:`${r}${d}`};var i=n(r(81109)),a=n(r(48403)),s=n(r(3522));function o(e){const t="object"==typeof e&&"string"==typeof(null==e?void 0:e.name)?e.name:`Thrown${(0,a.default)(typeof e)}Error`;let r,n;if(r=null!=e&&"string"==typeof e.message?e.message:void 0===e?"":String(e),null!=e&&"string"==typeof e.stack)n=e.stack;else{const e=new Error;e.name=t,e.message=r,n="string"==typeof e.stack?e.stack:""}const s="object"==typeof e?(0,i.default)({},e):null;return(0,i.default)((0,i.default)({},s),{},{name:t,message:r,stack:n})}},30010:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldNotifyReaction=function(e){const{orphan:t,read:r,senderUserJid:n,parentMsgKey:o,reactionText:l}=e;if(!(0,i.receiveReactionsEnabled)())return!1;if(1===t)return!1;if(r)return!1;if((0,s.isReactionByMe)(n))return!1;return!!a.default.fromString(o).fromMe&&""!==l};var i=r(57701),a=n(r(32219)),s=r(57793)},17506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDoNotDisturb=function(){try{var e,t;if("darwin"===process.platform)return(null===(e=window.Native.MacOSNotificationState)||void 0===e?void 0:e.getDoNotDisturb())||(null===(t=window.Native.MacOSNotificationState)||void 0===t?void 0:t.getNotificationState())===n.SESSION_SCREEN_IS_LOCKED;if("win32"===process.platform){var r,a,s,o,l;if((null===(r=window.Native.WindowsNotificationState)||void 0===r?void 0:r.getNotificationState())!==n.QUNS_ACCEPTS_NOTIFICATIONS)return!0;const e="win32"!==process.platform||process.windowsStore?null:"com.squirrel.WhatsApp.WhatsApp",t=e&&"YES"===(null===(a=window.Native.WindowsFocusAssist)||void 0===a||null===(s=a.isPriority(e))||void 0===s?void 0:s.name),c=null===(o=window.Native.WindowsFocusAssist)||void 0===o?void 0:o.getFocusAssist().name;return!!(t&&c===i.ALARMS_ONLY||!t&&[i.PRIORITY_ONLY,i.ALARMS_ONLY].includes(c))||!!(null===(l=window.Native.WindowsQuiteHours)||void 0===l?void 0:l.getIsQuietHours())}}catch(e){__LOG__(3)`getDoNotDisturb failed with error ${e}`}return!1};const n=r(54302).Mirrored(["UNKNOWN","SESSION_SCREEN_IS_LOCKED","SESSION_ON_CONSOLE_KEY","QUNS_NOT_PRESENT","QUNS_BUSY","QUNS_RUNNING_D3D_FULL_SCREEN","QUNS_PRESENTATION_MODE","QUNS_ACCEPTS_NOTIFICATIONS","QUNS_QUIET_TIME","QUNS_APP","UNKNOWN_ERROR"]),i=r(54302).Mirrored(["NOT_SUPPORTED","FAILED","OFF","PRIORITY_ONLY","ALARMS_ONLY"])},1933:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setIcon=u,t.setTitleAndIcon=function(e){let t=o.default.t(1927);e>0&&(t="("+o.default.n(e)+") "+o.default.t(1927));clearTimeout(c),document.title=document.title+" ",c=setTimeout((()=>{document.title=t}),0),u(e)};var i=r(89385),a=r(89721),s=n(r(89748)),o=n(r(43725)),l=r(65127);let c;const d=new s.default;function u(e){if(l.UA.isSafari)return;let t;t=-1===e?"favicon-error2":0===e?"favicon":e<10?"f0"+e:e<100?"f"+e:"f00";const n={id:t,low:{default:r(63509)(`./${t}.png`)},high:{default:r(76554)(`./${t}.png`)}};d.enqueue(a.AssetLoader.loadAsset(n,a.LOAD_PRIORITY.NOTIFICATION_ICON,!1)).then((e=>e)).then((e=>{const r=document.getElementById("favicon");var n;(null==(n=r)?void 0:n.parentNode)&&n.parentNode.removeChild(n);const i=document.createElement("link");i.setAttribute("id","favicon"),i.setAttribute("rel","shortcut icon"),i.setAttribute("type","image/png"),i.setAttribute("href",e),i.setAttribute("src",e);const a=document.getElementsByTagName("head");(null==a?void 0:a[0])&&a[0].appendChild(i),__LOG__(2)`Favicon updated: ${t}`})).catch((0,i.catchAbort)((()=>{})))}},62337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e,a)};var i=n(r(14176));const a=e=>null==e},97835:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=r;const n=function(){if(t===r){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];t=e.call(this,...i)}return t};return n.reset=()=>{t=r},n};const r={}},86212:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.openSocket=function(e){return new WebSocket(e)};n(r(45095)),n(r(69618)),n(r(92417))},69283:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(8584),a=r(1063),s=n(r(42372));let o,l=0;t.default=class{constructor(e){this.oggBlob=e}generateBlob(){return this.oggBlobToWAVBlob(this.oggBlob,1)}oggBlobToWAVBlob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new Promise((r=>{const n=new s.default,i=[],c=[],d=(l++,o||new window.AudioContext),u={outputBufferSampleRate:d.sampleRate,bufferLength:4096};n.onmessage=e=>{if(null==e.data){for(let e=0;e<t;e++)i.forEach((t=>{const r=t[e]||t[0];for(let e=0;e<r.length;e++)c.push(r[e])}));const e=this.encodeWAV(c,d,t),n=new Blob([e.readByteArray()],{type:"audio/wav"});l--,0===l&&o&&(o.close&&o.close(),o=void 0),r(n)}else i.push(e.data),t=i[0].length},n.postMessage({command:"decode-init",config:u}),(0,a.blobToArrayBuffer)(e).then((e=>{n.postMessage({command:"decode",pages:new Uint8Array(e)}),n.postMessage({command:"decode-done"})})).catch((e=>{__LOG__(3)`Player::oggBlobToWAVBlob error: ${e}`}))}))}encodeWAV(e,t,r){const n=new i.Binary(void 0,!0);n.ensureCapacity(44+2*e.length),n.writeString("RIFF"),n.writeUint32(36+2*e.length),n.writeString("WAVE"),n.writeString("fmt "),n.writeUint32(16),n.writeUint16(1),n.writeUint16(r),n.writeUint32(t.sampleRate),n.writeUint32(t.sampleRate*r*2),n.writeUint16(2*r),n.writeUint16(16),n.writeString("data"),n.writeUint32(2*e.length);for(let t=0;t<e.length;t++){let r=Math.max(-1,Math.min(e[t],1));r*=r>0?32767:32768,n.writeInt16(Math.floor(r))}return n}}},38906:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r(48926)),s=r(13959),o=r(4352),l=r(67602),c=i(r(44053)),d=r(35718),u=i(r(69618)),p=n(r(36638)),h=i(r(34949)),f=r(64551),_=n(r(22906));t.default=class{static fileToPdf(e){const t=URL.createObjectURL(e);return(0,o.promiseLoop)((function(e,t,n){const i=(0,s.delayMs)(_.expBackoff(n,12e4,0,0));return r.e(2974).then(r.t.bind(r,99299,23)).then((t=>{t.GlobalWorkerOptions.workerSrc=c.default,e(t.default)})).catch((()=>i))})).then((e=>e.getDocument(t).promise))}static releasePdf(e){return e.destroy()}static pdfToImg(e,t){const r=document.createElement("canvas");return e.getPage(t).then((e=>{const t=e.getViewport({scale:1}),n=r.getContext("2d");return r.height=t.height,r.width=t.width,e.render({canvasContext:n,viewport:t}).promise})).then((()=>(0,l.promiseProps)({blob:(0,d.canvasToBlob)(r),thumbnail:p.rotateAndResize(r,u.default.DOC_THUMB_MAX_EDGE,p.DATA_URL|p.CANVAS|p.BLOB),microThumbnail:f.ServerProps.webUploadDocumentThumbMmsEnabled?(0,d.generateMicroThumb)(r,1300,{mimetype:"image/jpeg",maxAttempts:10}):Promise.resolve(null)}))).then((e=>e)).then(function(){var t=(0,a.default)((function*(t){let{blob:r,thumbnail:n,microThumbnail:i}=t;return{url:URL.createObjectURL(r),thumbUrl:n.images.dataUrl,width:n.images.canvas.width,height:n.images.canvas.height,fullPreviewData:yield h.default.createFromData(n.images.blob,"image/jpeg"),fullPreviewSize:{width:n.images.canvas.width,height:n.images.canvas.height},pdfPages:e.numPages,microThumbnail:i}}));return function(){return t.apply(this,arguments)}}())}}},6604:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.formatMeasureLabel=function(e){return`💬 ${e}`},t.startMeasure=function(e){return n};const n={end(){}};(null===(r=performance)||void 0===r?void 0:r.mark)&&performance.measure,new Map},99304:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(2525)),s=n(r(19197)),o=n(r(92417));r(31515);var l=new class{constructor(){this.dataStore={}}setItem(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.dataStore[e]=t,null!=o.default&&o.default.setItem(e,t),r&&s.default.idb().then((r=>r.user.put({key:e,value:t}))).catch((e=>{__LOG__(3)`db:setItem:Error ${e}`}))}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===this.dataStore[e]||t){if(null!=o.default){const t=o.default.getItem(e);return null!=t&&this.setItem(e,t,!1),t}return null}return this.dataStore[e]}removeItem(e){delete this.dataStore[e],null!=o.default&&o.default.removeItem(e),s.default.idb().then((t=>t.user.delete(e))).catch((e=>{__LOG__(3)`db:removeItem:Error ${e}`}))}clear(e){var t=this;return(0,i.default)((function*(){t.dataStore={},null!=o.default&&(o.default.clear(),e&&(0,a.default)(e,(function(e,t){o.default.setItem(t,e)}))),yield s.default.idb().then((e=>e.user.clear())).catch((e=>{__LOG__(3)`db:clear:Error ${e}`}))}))()}};t.default=l},53686:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.phashV1=function(){return l.apply(this,arguments)},t.phashV2=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(15688),s=n(r(42810)),o=r(58021);function l(){return(l=(0,i.default)((function*(e){const t=e.map((e=>(0,o.toUserWid)(e).toString({legacy:!0}))).sort().join(""),r=[];for(let e=0;e<t.length;e++)r.push(t.charCodeAt(e));const n=new Uint8Array(r),i=yield s.default.digest({name:"SHA-1"},n);return`1:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){const t=e.map((e=>e.toString({legacy:!0,formatFull:!0}))).sort().join(""),r=[];for(let e=0;e<t.length;e++)r.push(t.charCodeAt(e));const n=new Uint8Array(r),i=yield s.default.digest({name:"SHA-256"},n);return`2:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}},70714:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(73382)),a=n(r(34725)),s="AbortController"in self?AbortController:class{constructor(){this.signal=new i.default}abort(){const e=new a.default("abort");this.signal.dispatchEvent(e)}};t.default=s},73382:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(96372)),a=class extends i.default{constructor(){super(),this.aborted=!1}dispatchEvent(e){return"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}toString(){return"[object AbortSignal]"}};t.default=a},27607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(25241),i="DomException"in window?DOMException:n.DOMException;t.default=i},34725:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=Event;t.default=r},96372:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(34342));t.default=class{constructor(){this._emitter=new i.default}addEventListener(e,t){this._emitter.on(e,t,this)}removeEventListener(e,t){this._emitter.off(e,t,this)}dispatchEvent(e){return this._emitter.trigger(e.type),!0}}},18561:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=r(43816);const s=()=>{};var o="fetch"in window?fetch:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.sharedFetch)(e,(0,i.default)((0,i.default)({},t),{},{onProgress:s}))};t.default=o},72451:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(65127);["webkitGetUserMedia"].forEach((function(e){const t=Object.getPrototypeOf(navigator)[e];t&&navigator[e]!==t&&(navigator[e]=t)}));var i=function(){var e;if(n.UA.isBrokenGetUserMedia)return null;const t=null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getUserMedia;if(t)return t.bind(navigator.mediaDevices);const r=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;return r?function(e){return new Promise((function(t,n){r.call(navigator,e,t,n)}))}:null}();t.default=i},66335:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(55892),a=n(r(34356));let s;var o="Headers"in window&&Headers?Headers:(s=a.default.iterator,class e{constructor(t){if(this._headers={},t instanceof e)for(const e of t.entries()){const[t,r]=e;r.split(", ").forEach((e=>{this.append(t,e)}))}else if("object"==typeof t)for(const e in t){t[e].split(", ").forEach((t=>{this.append(e,t)}))}}append(e,t){const r=e.toLowerCase();r in this._headers?this._headers[r].push(t):this._headers[r]=[t]}delete(e){const t=e.toLowerCase();delete this._headers[t]}entries(){const e=Object.keys(this._headers).map((e=>[e,this.get(e)||""]));return(0,i.iteratorFromArray)(e)}get(e){const t=e.toLowerCase();return t in this._headers?this._headers[t].join(", "):null}has(e){return e.toLowerCase()in this._headers}keys(){return(0,i.mapIterator)(this.entries(),(e=>{let[t]=e;return t}))}set(e,t){const r=e.toLowerCase();this._headers[r]=[t]}values(){return(0,i.mapIterator)(this.entries(),(e=>{let[t,r]=e;return r}))}[s](){return this.entries()}toString(){return"[Object Headers]"}});t.default=o},53485:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestIdleCallback=t.cancelIdleCallback=void 0;const r=window.requestIdleCallback,n=window.cancelIdleCallback,i="requestIdleCallback"in window?r:function(e){return setTimeout((()=>{const t=Date.now();e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})}),1)};t.requestIdleCallback=i;const a="cancelIdleCallback"in window?n:function(e){clearTimeout(e)};t.cancelIdleCallback=a},26402:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=window.MediaError||{MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4};t.default=r},42810:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r=self.crypto;var n=r&&(r.subtle||r.webkitSubtle||r.subtle);t.default=n},34356:(e,t)=>{"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i="Symbol"in window?Symbol:(n=r=class{},r.iterator="@@iterator",n);t.default=i},23082:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(35449);var n=URLSearchParams;t.default=n},82867:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDistribution=function(){let e="unknown";return e="prod","web_prod"},t.getLogUserAgent=function(e){let t,{appVersion:r,browser:n,device:i}=e;return t="Web/"+n,`WhatsApp/${r} ${t} Device/${i}`}},67643:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){return(0,s.default)(e,function(){var n=(0,i.default)((function*(n){if(n.signal.aborted)throw new a.AbortError;const i=e(n),s=yield t.get(i,n);if(n.signal.aborted)throw new a.AbortError;if(null!=s)return s;const o=yield r(n);if(n.signal.aborted)throw new a.AbortError;return yield t.set(i,o,n),o}));return function(){return n.apply(this,arguments)}}())};var i=n(r(48926)),a=r(89385),s=n(r(58596))},18876:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(e,t){const{signal:r,timeoutIterator:n,timeoutIncludesTaskDuration:l}=(0,i.default)((0,i.default)({},o),e);return(0,a.default)((e=>{let{retry:r,failCount:i}=e;return new Promise(((e,a)=>{const o=Date.now();try{t((function(e){return Promise.reject(new s.default(e))}),i).then(e).catch(c)}catch(e){return void c(e)}function c(e){if(!(e instanceof s.default))return void a(e);const t=n.next();if(t.done)return void a(e.source);const i=Date.now()-o,c=l?Math.max(t.value-i,0):t.value;r(c)}}))}),r)},t.defaults=void 0;var i=n(r(81109)),a=n(r(18586)),s=n(r(85494));const o=Object.freeze({timeoutIncludesTaskDuration:!0});t.defaults=o},77712:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(){return c.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),s=r(13959),o=n(r(85494));const l={retries:1/0};function c(){return(c=(0,a.default)((function*(e,t){const{delay:r,signal:n,retries:a}=(0,i.default)((0,i.default)({},l),e);let c=0,d=Date.now(),u=null;const p=e=>Promise.reject(new o.default(e));try{return d=Date.now(),yield t(p,c,n)}catch(h){if(c++,!(h instanceof o.default))throw h;u=h}for(;c<=a;){const e=r({iterationCount:c,taskDuration:Date.now()-d});yield(0,s.delayMs)(e,n);try{return d=Date.now(),yield t(p,c,n)}catch(h){if(c++,!(h instanceof o.default))throw h;u=h}}if(!u)throw new Error("assert: backoff completed without error or result");const h=undefined;throw u.source}))).apply(this,arguments)}},91903:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exponentialBackoff=function(e,t){const r=(0,a.default)((0,a.default)({},c),e),{signal:n,timeoutIncludesTaskDuration:d}=r,u=(0,i.default)(r,l),p=(0,o.exponentialBackoffIterator)(u);return(0,s.backoff)({signal:n,timeoutIterator:p,timeoutIncludesTaskDuration:d},t)};var i=n(r(6479)),a=n(r(81109)),s=r(18876),o=r(93235);const l=["signal","timeoutIncludesTaskDuration"],c=(0,a.default)((0,a.default)({},o.defaults),s.defaults)},58596:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=new Map;return function(n){if(n.signal.aborted)return Promise.reject(new a.AbortError);const c=e.call(this,n);let d=r.get(c);if(null==d||d.aggregator.signal.aborted){const e=new l.default,a=(0,i.default)((0,i.default)({},n),{},{signal:e.signal});d={aggregator:e,promise:t.call(this,a).finally((()=>{e.dispose(),r.delete(c)}))},r.set(c,d)}const u=n.signal||(new s.default).signal;return d.aggregator.add(u),(0,o.default)(d.promise,u)}};var i=n(r(81109)),a=r(89385),s=n(r(70714)),o=n(r(84644)),l=n(r(3889))},84644:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null==t)return e;let r;const i=t.aborted?Promise.reject(new n.AbortError):new Promise(((e,i)=>{const a=()=>{i(new n.AbortError)};t.addEventListener("abort",a),r=()=>{t.removeEventListener("abort",a)}}));return Promise.race([i,e]).finally((()=>{var e;null===(e=r)||void 0===e||e(),r=null}))};var n=r(89385)},86243:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r;const n=new i.default;if(e.some((e=>e.aborted)))n.abort();else{r=()=>{for(const r of e)r.removeEventListener("abort",t);r=null};const t=()=>{var e;null===(e=r)||void 0===e||e(),n.abort()};for(const r of e)r.addEventListener("abort",t)}return t(n.signal).finally((()=>{var e;null===(e=r)||void 0===e||e()}))};var i=n(r(70714))},18586:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(((r,i)=>{let a,s=0,o=!1;if(t){const e=()=>{t.removeEventListener("abort",e),o=!0,null!=a&&clearTimeout(a),i(new n.AbortError)};if(t.aborted)return void e();t.addEventListener("abort",e)}!function t(){let n=!1,l=!1;a=null;try{const c=e({retry:e=>{if(!o&&!l){if(n=!0,s++,null==e)return t();a=setTimeout(t,e)}},failCount:s});if(!(c instanceof Promise))throw new TypeError("task must return a promise");c.then((e=>{o||n||(l=!0,r(e))})).catch((e=>{o||n||(l=!0,i(e))}))}catch(e){if(o||n)return;i(e)}}()}))};var n=r(89385)},85494:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("RetryableError")){constructor(e){super("see error at this.source"),this.source=e}}t.default=i},3889:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(70714));t.default=class{constructor(){this._disposed=!1,this._controller=new i.default,this._signals=new Set,this.signal=this._controller.signal,this._handleAbort=e=>{this.delete(e.currentTarget),this._checkAborted()}}add(){this._throwIfDisposed();for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const e of t)e.aborted||(e.addEventListener("abort",this._handleAbort),this._signals.add(e));this._checkAborted()}_checkAborted(){if(this._disposed)return;[...this._signals].every((e=>e.aborted))&&(this.dispose(),this._controller.abort())}delete(){this._throwIfDisposed(),this._delete(...arguments)}_delete(){let e=!1;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const t of r)this._signals.delete(t)&&(e=!0,t.removeEventListener("abort",this._handleAbort));e&&this._checkAborted()}_throwIfDisposed(){if(this._disposed)throw new Error("Attempt to modify disposed SignalAggregator")}dispose(){if(!this._disposed){this._disposed=!0;for(const e of this._signals)this._delete(e)}}}},88064:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.catch((0,n.catchAbort)((()=>{}))).catch((function(t){e.cancel(t)})),t};var n=r(89385)},82705:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Promise((function(e){function t(){e(!1)}if(self.requestFileSystem)self.requestFileSystem(window.TEMPORARY,1,t,(function(t){e("SecurityError"===t.name)}));else if(o.default){const r=o.default.open("pb_detect");r?(r.onsuccess=t,r.onerror=function(t){t.preventDefault(),window.InvalidStateError?e(t instanceof window.InvalidStateError):e(!0)}):t()}else c.UA.isTrident?e(!0):t()})).then((function(e){if(e)return e;if(!l.default)return!1;try{return l.default.setItem("INCOG","0"),l.default.removeItem("INCOG"),!1}catch(e){if("QuotaExceededError"===e.name)return!0;throw e}}));return(0,s.promiseTimeout)(e,100,"detectIncognitoTimeout").catch((0,a.filteredCatch)(i.TimeoutError,(function(){return!1}))).catch((function(e){return __LOG__(3,void 0,void 0,!0)`promiseUtil:determineIncognito failed check: ${String(e)}`,SEND_LOGS("incog-throw"),!1}))};var i=r(40265),a=r(50796),s=r(38284),o=n(r(2680)),l=n(r(92417)),c=r(65127)},75203:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return i.default.request(e,t,r,a,n).then((e=>e.status&&e.status<12e3?e:null)).catch((()=>null))};var i=n(r(64386))},49603:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"attachWatcher",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"determineIncognito",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"getResponseIfOnline",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"waitForBBEvent",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"waitForEvent",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"waitForMain",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"waitForOfflineNaive",{enumerable:!0,get:function(){return s.default}});var i=n(r(88064)),a=n(r(75203)),s=n(r(14706)),o=n(r(49036)),l=n(r(17072)),c=n(r(82705)),d=n(r(37904))},17072:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){if(null==i?void 0:i.aborted)return Promise.reject(new n.AbortError);let a,s;const o=r;return new Promise((function(r,l){if(a=o?function(){o.apply(this,arguments)&&r(arguments)}:function(){r(arguments)},i){const e=()=>{var e;null===(e=s)||void 0===e||e(),l(new n.AbortError)};i.addEventListener("abort",e),s=()=>{i.removeEventListener("abort",e),s=null}}e.on(t,a)})).cancellable().finally((function(){var r;e.off(t,a),null===(r=s)||void 0===r||r()}))};var n=r(89385)},49036:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){if(null==i?void 0:i.aborted)return Promise.reject(new n.AbortError);let a,s;const o=r;return new Promise((function(r,l){var c;if(a=o?function(){o.apply(this,arguments)&&r.apply(this,arguments)}:r,i){const e=()=>{var e;null===(e=s)||void 0===e||e(),l(new n.AbortError)};i.addEventListener("abort",e),s=()=>{i.removeEventListener("abort",e),s=null}}null===(c=e.addEventListener)||void 0===c||c.call(e,t,a)})).cancellable().finally((function(){var r,n;null===(r=e.removeEventListener)||void 0===r||r.call(e,t,a),null===(n=s)||void 0===n||n()}))};var n=r(89385)},37904:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return i.Cmd.isMainLoaded?Promise.resolve():(0,a.default)(i.Cmd,"main_loaded")};var i=r(88102),a=n(r(17072))},14706:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)(window,"offline")};var i=n(r(49036))},35217:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(38284),s=n(r(86128)),o=n(r(69618));function l(){return(l=(0,i.default)((function*(){const e=Object.keys(o.default.WEB_IDB_DB_NAMES).map((e=>o.default.WEB_IDB_DB_NAMES[e]));let t=!1;const r=e.map(function(){var e=(0,i.default)((function*(e){if("__dbnames"!==e&&"sw"!==e)try{yield(0,a.promiseTimeout)(Promise.resolve(s.default.delete(e)),7e3)}catch(e){t=!0}}));return function(){return e.apply(this,arguments)}}());return yield Promise.all(r),t}))).apply(this,arguments)}},15860:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newTag=function(){const e=new Uint8Array(8);self.crypto.getRandomValues(e);const t=new Array(16);for(let n=0,i=0;n<e.length;n++,i+=2){const a=e[n];t[i]=r[a>>4],t[i+1]=r[15&a]}return"3EB0"+String.fromCharCode.apply(String,t)},t.randomId=function(){const e=new Uint8Array(16);self.crypto.getRandomValues(e);const t=new Array(32);for(let n=0,i=0;n<e.length;n++,i+=2){const a=e[n];t[i]=r[a>>4],t[i+1]=r[15&a]}return String.fromCharCode.apply(String,t)};const r=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70]},57793:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_REACTIONS_DISPLAY_AGGREGATES=void 0,t.canHaveReactions=y,t.canReactToMessage=function(e){var t;if(!(0,u.sendReactionsEnabled)())return!1;if(!y(e.type))return!1;if((null===(t=e.chat.groupMetadata)||void 0===t?void 0:t.announce)&&!(0,u.reactionsAnnouncementOnly)())return!1;return!0},t.canRevokeReaction=function(){return(0,u.sendReactionsEnabled)()},t.createReactionsRowFromOffline=function(){return E.apply(this,arguments)},t.getReactionAggregates=m,t.getReactionEmojisAndSum=function(e){let t=[],r=0;if(0===e.length)return{numberOfSenderReactions:r,reactionArrayEmojis:t};if(1!==e.length)return function(e){let t=[],r=0;const n=m(e),i=n.slice(0,3);return t=i.map((e=>e.reactionByMe?e.reactionByMe.reactionText:e.reactionAggregate)),r=n.reduce(((e,t)=>e+t.reactionSenders.length),0),{numberOfSenderReactions:r,reactionArrayEmojis:t}}(e);{const n=e[0],i=n.reactions.slice(0,3);t=i.map((e=>(e.hasReactionByMe&&n.reactionByMe,e.hasReactionByMe&&n.reactionByMe?n.reactionByMe.reactionText:e.aggregateEmoji))),r=n.reactions.reduce(((e,t)=>e+t.senders.length),0)}return{numberOfSenderReactions:r,reactionArrayEmojis:t}},t.isReactionByMe=g,t.lastMessageReactionChange=function(e){const t=r(59871).MsgCollection;e.forEach((e=>{const r=t.get(e);(null==r?void 0:r.isLastMessage())&&o.Cmd.reactionChangeLastMessage()}))},t.reactionBubbleAriaLabelOneReaction=function(e,t){return s.default._("{name} reacted with {reactionContent}",[s.default._param("name",e),s.default._param("reactionContent",t)],{hk:"2Vcjyz"})},t.reactionBubbleAriaLabelString=function(e,t){const r=t.join(p.default.t(420));if(1===e)return s.default._("reaction {reactions_content}",[s.default._param("reactions_content",r)],{hk:"2ksvWq"});return s.default._({"*":"Reactions {reactions_content} {num_sender_reactions} in total",_1:"Reactions {reactions_content} 1 in total"},[s.default._param("reactions_content",r),s.default._plural(e,"num_sender_reactions")],{hk:"3KYY1f"})},t.shouldShowReactionBubble=function(e,t){if(!(0,u.receiveReactionsEnabled)())return!1;if(!y(e.type))return!1;if(t===f.ReactionBubbleType.NON_CONVERSATION)return!1;if(t===f.ReactionBubbleType.MEDIA_ITEM&&e.type===l.default.MSG_TYPE.STICKER)return!1;return!0},t.webMsgInfoReactionTypeToReactionsRow=function(e){let{id:t,reactionTimestamp:r,reactionText:n,reactionParentKey:i,sender:a,unread:s}=e;const o=(0,_.toUserWid)(a);return{msgKey:t.toString(),parentMsgKey:i.toString(),senderUserJid:o.toString(),reactionText:null!=n?n:l.default.REVOKED_REACTION_TEXT,timestamp:r,orphan:0,read:!s}};var i=n(r(48926)),a=n(r(81109)),s=n(r(48360)),o=r(88102),l=n(r(69618)),c=r(70449),d=r(99234),u=r(57701),p=n(r(43725)),h=r(84886),f=r(94270),_=r(58021);function m(e){const t=new Map;e.forEach((e=>{let r=null;if(e.reactionByMe){const a=e.reactionByMe.reactionText;r=c.EmojiUtil.getEmojiAggregate(a);const s=t.get(r);if(s){var n,i;const t=(null===(n=s.reactionByMe)||void 0===n?void 0:n.timestamp)||0,r=(null===(i=e.reactionByMe)||void 0===i?void 0:i.timestamp)||0;(s.reactionByMe&&t<r||!s.reactionByMe)&&(s.reactionByMe=e.reactionByMe)}}e.reactions.forEach((r=>{const n=r.aggregateEmoji,i=r.senders.toArray(),a=t.get(n);if(a){const e=a.reactionSenders.concat(i);a.reactionSenders=e,t.set(n,a)}else{const a=r.hasReactionByMe?e.reactionByMe:null;t.set(n,{reactionByMe:a,reactionSenders:i,reactionAggregate:n})}}))}));return Array.from(t.values()).map((e=>{const t=e.reactionSenders.sort(((e,t)=>g(e.senderUserJid)&&!g(t.senderUserJid)?-1:g(t.senderUserJid)&&!g(e.senderUserJid)?1:t.timestamp-e.timestamp));return(0,a.default)((0,a.default)({},e),{},{reactionSenders:t})})).sort(((e,t)=>e.reactionByMe&&t.reactionByMe?t.reactionSenders.length===e.reactionSenders.length?t.reactionByMe.timestamp-e.reactionByMe.timestamp:t.reactionSenders.length-e.reactionSenders.length:e.reactionByMe?-1:t.reactionByMe?1:t.reactionSenders.length===e.reactionSenders.length?t.reactionSenders[0].timestamp-e.reactionSenders[0].timestamp:t.reactionSenders.length-e.reactionSenders.length))}function g(e){return e===(0,d.getMaybeMeUser)().toString()}function y(e){return!(!(0,u.receiveReactionsEnabled)()||e===l.default.MSG_TYPE.UNKNOWN||e===l.default.MSG_TYPE.CIPHERTEXT||e===l.default.MSG_TYPE.REVOKED||e===l.default.MSG_TYPE.DEBUG||e===l.default.MSG_TYPE.GP2||e===l.default.MSG_TYPE.NOTIFICATION||e===l.default.MSG_TYPE.NOTIFICATION_TEMPLATE||e===l.default.MSG_TYPE.E2E_NOTIFICATION||e===l.default.MSG_TYPE.CALL_LOG)}function E(){return(E=(0,i.default)((function*(e){const t=[],r=[];e.forEach((e=>{e.msg&&r.push(e.msg.reactionParentKey.toString())}));const n=yield(0,h.getMsgsByMsgKey)(r),i=new Map;return n.forEach((e=>{i.set(e.id.toString(),e)})),e.forEach((e=>{var r,n;const a=e.msg,s=null===(r=e.receiptInfo)||void 0===r?void 0:r.author;if(!s||!a)return void __LOG__(3)`createReactionsRowFromOffline: sender or reactionMsg are null`;const o=i.get(a.reactionParentKey.toString()),c=o?0:1;if(o&&!y(o.type))return void __LOG__(3)`createReactionsRowFromOffline: reactions not allowed for this message type ${o.type}`;const d=(0,_.toUserWid)(s),u={msgKey:a.id.toString(),parentMsgKey:a.reactionParentKey.toString(),senderUserJid:d.toString(),reactionText:null!==(n=a.reactionText)&&void 0!==n?n:l.default.REVOKED_REACTION_TEXT,timestamp:a.reactionTimestamp,orphan:c,read:!1};t.push(u)})),t}))).apply(this,arguments)}t.MAX_REACTIONS_DISPLAY_AGGREGATES=3},87826:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){if(o(a.default.REQUIRED_BROWSER_APIS))return!0;return(0,i.promiseProps)({cryptoSha256:s.default.supportsHmacSha256(),cryptoAesCbc:s.default.supportsAesCbc()}).then(o),!1};var i=r(67602),a=n(r(69618)),s=n(r(94e3));function o(e){const t=[];for(const r in e)e[r]||t.push(r);if(t.length>0){const e=`${a.default.CAPABILITY_URL}?missing=${t.join(",")}`;return window.location.replace?window.location.replace(e):window.location.href=e,!0}return!1}},24433:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildUrl=function(e,t,r){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw new Error(`buildUrl given invalid host "${e}"`);if(!t.startsWith("/"))throw new Error(`buildUrl given invalid path "${t}"`);const n=r,i=`${e}${t}`;if(!n)return i;const a=Object.keys(n).map((e=>{let t=n[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));const r=t instanceof Uint8Array?Array.prototype.slice.call(t).map((e=>`%${e.toString(16)}`)).join(""):encodeURIComponent(t);return`${encodeURIComponent(e)}=${r}`}));if(a.length>0){const e=a.join("&");return i.includes("?")?`${i}&${e}`:`${i}?${e}`}return i},t.refreshNoiseCredentials=function(){const e=(0,s.keyPair)(),t=new Uint8Array(24);return self.crypto.getRandomValues(t),Promise.resolve(o.waNoiseInfo.set({recoveryToken:t.buffer,staticKeyPair:e}))},t.refreshSignalCredentials=function(){return u.apply(this,arguments)},t.setRoutingInfo=function(e,t){const r={domain:e,edgeRouting:t?(0,a.decodeB64)(t):null};return __LOG__(2)`set routingInfo:`,Promise.resolve((0,c.setRoutingInfo)(r))};var i=n(r(48926)),a=r(15688),s=r(5087),o=r(14111),l=r(58425),c=r(58052),d=r(11849);function u(){return(u=(0,i.default)((function*(){const e=window.libsignal.KeyHelper.generateRegistrationId();yield d.waSignalStore.clearCredential();const t=yield(0,l.generateIdentityKeyPair)();yield Promise.all([d.waSignalStore.setRegistrationInfo({registrationId:e,identityKeyPair:t}),d.waSignalStore.rotateSignedPreKey((0,s.toSignalCurveKeyPair)(t),l.generateSignedKeyPair)])}))).apply(this,arguments)}},84426:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(8584),i=r(57319);const a=1e4;t.default=class{constructor(e){this.performSendStep=()=>{let e=!1,t=a;if(this.remainingChunk){const r=this.remainingChunk;if(r.length>=a){const i=n.Binary.build(210,128,r),s=i.readBuffer(a);this.remainingChunk=i.readByteArray(),e=!0,t=0,this._send(s)}else{const i=n.Binary.build(211,128,r);this.remainingChunk=null,e=!0,t-=i.size(),this._send(i.readBuffer())}}const r=this.queue;for(;r.length&&t>2;){const i=r.shift();if("string"==typeof i)i.length<=t||!e?(e=!0,t-=i.length,this._send(i)):(t=0,r.unshift(i));else if(i.byteLength<t)e=!0,t-=i.byteLength,this._send(i);else{const r=n.Binary.build(208,128,i),a=r.readBuffer(t);this.remainingChunk=r.readByteArray(),e=!0,t=0,this._send(a)}}this.isQueueing()&&this.timer.onOrBefore(250)},this.watchedSocket=e,this.queue=[],this.remainingChunk=null,this.timer=new i.ShiftTimer(this.performSendStep)}isQueueing(){return this.queue.length>0||!!this.remainingChunk}cancel(){this.timer.cancel()}_send(e){this.watchedSocket.socket.send(e)}send(e){this.isQueueing()?this.queue.push(e):function(e){return"string"==typeof e?e.length:e.byteLength}(e)<=a?this._send(e):(this.queue.push(e),this.timer.forceRunNow())}}},17117:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clear=function(){c=void 0},t.get=function(){return(0,s.default)(c,"BUNDLE")},t.getBundle=function(){return c},t.getSecurityToken=function(){return u.apply(this,arguments)},t.load=function(){const e=(0,o.getSecretBundle)();if(!e)return __LOG__(2)`secret_bundle:load: attempted to load non-existent secret bundle!`,null;return d(e),e},t.save=function(){if(!c)return void __LOG__(2)`secret_bundle:save: trying to save empty secret bundle!`;delete c.keyPair,(0,o.setSecretBundle)(c)},t.set=d,t.setSecretKeys=function(e,t,r){"0.1"===e?c&&t&&r?(c.encKey=t,c.macKey=r,c.key=r):__LOG__(3)`secret_bundle:setSecretKeys v${e} ${String(t)} ${String(r)}`:__LOG__(2)`secret_bundle:setSecretKeys unknown version: v${e}`};var i=n(r(48926)),a=r(15688),s=n(r(45095)),o=r(99234),l=n(r(39827));let c;function d(e){c=e}function u(){return(u=(0,i.default)((function*(e){if(!c)return __LOG__(3)`secret_bundle:getSecurityToken: no secret bundle`,Promise.reject(new Error("secret_bundle:getSecurityToken: no secret bundle"));const t=yield new l.default(c.key).sign(new Uint8Array(e));return(0,a.encodeB64)(t)}))).apply(this,arguments)}},16413:(e,t,r)=>{"use strict";var n=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.getOrGenerate=function(){const e=a.getBundle();if((null==e?void 0:e.key)&&e.keyPair)return(0,i.encodeB64)(e.key);const t=s.keyPair(),r=(0,i.encodeB64)(t.pubKey),n={key:t.pubKey,keyPair:t,encKey:void 0,macKey:void 0};return a.set(n),r};var i=r(15688),a=n(r(17117)),s=n(r(5087))},28245:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,a.normalizeError)(e),{name:r,message:n,stack:o}=t,l=(0,i.default)(t,s),c=(0,a.normalizeStack)(e,!0),d=0===Object.keys(l).length?"":" "+JSON.stringify(l,((e,t)=>e&&"object"==typeof t?String(t):t));return`${r} - ${n||""}${d}\n${c}`};var i=n(r(6479)),a=r(97237);const s=["name","message","stack"]},53962:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{r=window.sessionStorage}catch(e){}var n=r;t.default=n},59578:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){this.cache=new Map,this.howBig=0,this.fn=e}getKeyString(e){return"string"==typeof e?e:e.join("_")}getRefSetter(e){const t=this.getKeyString(e);let r=this.cache.get(t);return r||(r=r=>{this.fn(e,r),r||this.cache.delete(t)},this.cache.set(t,r),Math.floor(this.cache.size/500)>this.howBig&&(__LOG__(4,void 0,new Error)`[SetRefCache] Large cache detected with ${this.cache.size} entries`,this.howBig=Math.floor(this.cache.size/500))),r}}},26445:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(51584)),a=n(r(13218)),s=n(r(16579)),o=n(r(2525)),l=r(31515);function c(e){switch(typeof e){case"object":return null==e?e=>null===e:function(e){const t=[];let r=!1,n=0;(0,o.default)(e,(function(e,i){if(void 0===e)return void(r=!0);n++;const a=c(e);t.push((function(e){return e.hasOwnProperty(i)&&a&&a(e[i])}))}));const i=(0,s.default)(t,(function(e,t){return e?function(r){return t(r)&&e(r)}:t}));return function(e){if("object"!=typeof e||null==e)return!1;const t=Object.keys(e).length;return!(t<n)&&!(!r&&t>n)&&i(e)}}(e);case"function":return e;case"boolean":case"undefined":case"number":case"string":return function(t){return t===e};default:throw new TypeError("Unknown Template type: "+typeof e)}}class d{constructor(e){this.predicate=c(e)}test(e){return this.predicate(e)}}t.default=d,d.ANY=()=>!0,d.OBJECT=a.default,d.STRING=l.isString,d.BOOLEAN=i.default},70452:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCrypto=function(){return self.crypto.subtle||self.crypto.webkitSubtle}},87481:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(41609)),a=n(r(34342));class s extends a.default{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"next";super(),this.list=e,this.index=-1,this.value=void 0,this.getter=t,this.deleteDir=r}init(){let e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.list=r,null!=this.value)if((0,i.default)(r))this.unset();else{if(e=r.indexOf(this.value),e>-1){if(e===this.index)return;t=!0,n=!1}else if(!n||this.index<0)e=-1;else{const n="prev"===this.deleteDir?-1:0;e=this.index+n,e=Math.max(e,0),e=Math.min(e,r.length-1),t=e>-1}this.set(e,n,t)}}unset(){const e=this.value;this.value=void 0,this.index=-1,null!=e&&this.trigger(this.getter(e),!1)}reset(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.index<0||null!=this.value&&this.trigger(this.getter(this.value),"focus",e)}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.list.length)return;const n=Math.min(Math.max(e,-1),this.list.length-1),i=this.value,a=n>-1?this.list[n]:void 0;null!=a?(this.value=a,this.trigger(this.getter(a),!0===t?"focus":"select")):!0===r&&(this.value=void 0),!0===r&&null!=i&&i!==a&&this.trigger(this.getter(i),!1),this.index=n}getVal(){return this.value}setVal(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=this.list.indexOf(e);r>-1?this.set(r,t):(this.unset(),this.value=e)}setFirst(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(0,e,!0)}setLast(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.list.length-1,e,!0)}setPrev(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.prev(),e,!0)}setNext(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.next(),e,!0)}prev(){return(0,i.default)(this.list)||-1===this.index?-1:this.index-1}next(){return(0,i.default)(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}var o=s;t.default=o},39142:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(89385),a=r(8584),s=r(856),o=r(13959),l=n(r(70714)),c=r(11290),d=n(r(69618)),u=r(64457),p=n(r(78144)),h=n(r(57220)),f=n(r(17072)),_=r(7388),m=r(24465),g=r(25906);const y=3e5,E=18e4,S=(0,m.fibonacci)(8e3,4e3,3e5);class v extends c.BaseModel{constructor(){super(...arguments),this.active=(0,c.prop)(!0),this.socket=(0,c.prop)(),this.sockets=(0,c.prop)(),this.pendingSocketPromiseCount=(0,c.prop)(0),this.attempts=(0,c.prop)(0),this.startId=(0,c.prop)(0),this.controller=(0,c.prop)(),this.retryTimestamp=(0,c.prop)(),this.tsListener=(0,c.prop)(),this.onerror=(0,c.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpener set to socket ${e.id}`,this.set({active:!1,socket:e}),h.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpener closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,i.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpener deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(h.default,"change:online",this.onOnlineChange),this.listenTo(u.jsHaltDetector,u.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return __LOG__(2,void 0,void 0,!0)`attemptOpen called while not active!`,void SEND_LOGS("rogue-opener");const e=(0,g.open)({url:d.default.WEB_SOCKET_URL,msgParser:A});this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const r=function(){if(t)return Promise.resolve();t=!0;const e=(new l.default).signal;return h.default.checkOnline({signal:e})},n=new l.default;(0,o.delayMs)(6e3,n.signal).then((()=>r())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,n.abort()})).catch((0,i.catchAbort)((()=>{}))).catch((()=>r()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=h.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpener:onlineController activating`,new m.Watchdog({waitAlgorithm:S,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpener:offlineController activating`;let e,t=0;return new m.Watchdog({waitAlgorithm:n=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpener:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpener:offline... heuristic poll`,e=T(n,[(0,_.waitForOnlineNaive)(),(0,f.default)(u.jsHaltDetector,u.JS_HALT_EVENT),(0,f.default)(r(8080).Stream,"change:available")]),y):(__LOG__(2)`SocketOpener:offline... wait for navigator`,t=0,e=T(n,[(0,_.waitForOnlineNaive)()]),y)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new i.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>E&&(__LOG__(2)`js halt longer than ${E} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function T(e,t){return(0,s.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,i.catchAbort)((()=>{})))}function A(e){const t=e.data;let r,n,i;if(t instanceof ArrayBuffer){let e;const s=[],o=new a.Binary(t);for(;44!==(e=o.readUint8());)s.push(e);r=String.fromCharCode.apply(String,s),n=o.readBuffer(),i=t.byteLength}else{if("string"!=typeof t)throw new Error("Unexpected message event type");{const e=t.indexOf(",");r=t.slice(0,e),n=t.slice(e+1),n=n?JSON.parse(n,p.default):void 0,i=new Blob([t]).size}}return{tag:r,data:n,binarySize:i}}var C=(0,c.defineModel)(v);t.default=C},74976:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(89385),a=r(856),s=r(13959),o=n(r(70714)),l=r(11290),c=n(r(69618)),d=r(64457),u=n(r(57220)),p=n(r(17072)),h=r(7388),f=r(24465),_=r(84727);const m=3e5,g=18e4,y=(0,f.fibonacci)(8e3,4e3,3e5);class E extends l.BaseModel{constructor(){super(...arguments),this.active=(0,l.prop)(!0),this.socket=(0,l.prop)(),this.sockets=(0,l.prop)(),this.pendingSocketPromiseCount=(0,l.prop)(0),this.attempts=(0,l.prop)(0),this.controller=(0,l.prop)(),this.retryTimestamp=(0,l.prop)(),this.tsListener=(0,l.prop)(),this.onerror=(0,l.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpenerMD set to socket ${e.id}`,this.set({active:!1,socket:e}),u.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpenerMD closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,i.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpenerMD deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(u.default,"change:online",this.onOnlineChange),this.listenTo(d.jsHaltDetector,d.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return void __LOG__(2)`attemptOpen called while not active!`;const e=(0,_.open)(this.routingToken?`${c.default.CHATD_WEB_SOCKET_URL}?ED=${this.routingToken}`:c.default.CHATD_WEB_SOCKET_URL);this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const r=function(){if(t)return Promise.resolve();t=!0;const e=(new o.default).signal;return u.default.checkOnline({signal:e})},n=new o.default;(0,s.delayMs)(6e3,n.signal).then((()=>r())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,n.abort()})).catch((0,i.catchAbort)((()=>{}))).catch((()=>r()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=u.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpenerMD:onlineController activating`,new f.Watchdog({waitAlgorithm:y,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpenerMD:offlineController activating`;let e,t=0;return new f.Watchdog({waitAlgorithm:n=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpenerMD:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpenerMD:offline... heuristic poll`,e=S(n,[(0,h.waitForOnlineNaive)(),(0,p.default)(d.jsHaltDetector,d.JS_HALT_EVENT),(0,p.default)(r(8080).Stream,"change:available")]),m):(__LOG__(2)`SocketOpenerMD:offline... wait for navigator`,t=0,e=S(n,[(0,h.waitForOnlineNaive)()]),m)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new i.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>g&&(__LOG__(2)`js halt longer than ${g} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function S(e,t){return(0,a.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,i.catchAbort)((()=>{})))}var v=(0,l.defineModel)(E);t.default=v},30631:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPSACampaigns=a,t.getPsaCampaignIndex=function(e,t){if(0===t.length)return-1;let r=0,n=t[0].campaignId;for(let i=1;i<t.length;i++){const{id:a,campaignId:s}=t[i];if(n!==s?(n=s,r=0):r++,a.toString()===e.toString())return r}return-1},t.getPsaCampaignsString=function(e){const t=a(e),r=[];return Object.keys(t).forEach((e=>{const n=t[e],{numberOfStatus:i,numberOfReadStatus:a}=n;r.push(`${e}:${i-a}`)})),r.join(",")},t.isCampaignExpired=s,t.isExpiredStatusPSA=function(e,t){const r=a(e);return Object.keys(r).every((e=>s(r[e],t)))};var n=r(92844),i=r(22683);function a(e){const t={};return e.forEach((e=>{let{t:r,campaignId:n,campaignDuration:i,statusPSAReadTimestamp:a}=e;if(!n)return;t[n]||(t[n]={id:n,t:r,duration:i,firstReadTimestamp:null,numberOfStatus:0,numberOfReadStatus:0});const s=t[n];s.numberOfStatus++,null!=a&&(s.numberOfReadStatus++,(null==s.firstReadTimestamp||a<s.firstReadTimestamp)&&(s.firstReadTimestamp=a))})),t}function s(e,t){const r=e.firstReadTimestamp;if(null!=r)return(0,n.castToUnixTime)(i.Clock.globalUnixTime()-r)>t;const a=e.duration;return null!=a&&i.Clock.globalUnixTime()-e.t>a}},12209:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isWeb=t.isOSWin=t.isOSRTL=t.isOSMac=t.isOSLTR=t.isNative=t.hasSafariFix=t.hasFontFix=t.hasFirefoxFix=t.hasEdgeFix=void 0;var i=n(r(69618)),a=n(r(43725)),s=r(65127);null!=window.Native&&a.default.isRTL(window.Native.appGetLocale());t.isNative=!1;t.isWeb=!0;const o=s.UA.isSafari;t.hasSafariFix=o;const l=s.UA.isTrident;t.hasEdgeFix=l;const c=s.UA.isGecko;t.hasFirefoxFix=c;const d=s.UA.browser===i.default.BROWSER_TYPE.CHROME||s.UA.browser===i.default.BROWSER_TYPE.OPERA;t.hasFontFix=d;t.isOSLTR=!1;t.isOSRTL=!1;const u=s.UA.os===i.default.OS_TYPE.MAC;t.isOSMac=u;const p=s.UA.os===i.default.OS_TYPE.WINDOWS;t.isOSWin=p},28080:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=function(e,t,r,n,i,l){return Promise.resolve().then((()=>{if(!(10<=i.length&&i.length<=32))throw new o.MediaEncryptionError("Given bad expected hmac");const l=a.Binary.build(t,r).readByteArray();return new c.default(n).sign(l).then((t=>{const r=new Uint8Array(t,0,i.length);let n=!1;for(let e=0;e<r.length;e++)r[e]!==i[e]&&(n=!0);if(n)throw new o.MediaEncryptionError("hmac check failure");return(0,s.aesCbcDecrypt)(e,l)}))})).then((e=>{const t="string"==typeof l?l:l(new Uint8Array(e));return u.default.createFromData(e,t)}))},t.getHash=function(e){return(e instanceof u.default?(0,d.opaqueDataToArrayBuffer)(e):(0,l.blobToArrayBuffer)(e)).then((e=>(0,p.default)(e))).catch((t=>{const r={error:`${t}`,blobSize:e.size,isOpaqueData:e instanceof u.default};__LOG__(3,void 0,void 0,!0)`SubtleCrypto::getHash error. Debug:\n${JSON.stringify(r,null,2)}`,SEND_LOGS("subtle-crypto-get-hash-error")}))};var a=r(8584),s=r(89626),o=i(r(64103)),l=r(1063),c=n(r(39827)),d=r(56406),u=n(r(34949)),p=n(r(68138))},90257:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genDeviceNotificationMsg=function(e,t,r,n){const c=(0,a.assertGetMe)(),d=new s.default({fromMe:t.equals((0,l.toUserWid)(c)),remote:e,id:(0,o.newTag)()}),u=d.fromMe&&r.includes(c.getDeviceId());return{id:d,t:(0,i.unixTime)(),type:"e2e_notification",subtype:"device",from:e,to:(0,l.toUserWid)(c),body:t.toString(),devicesAdded:r.length,devicesRemoved:n.length,isThisDeviceAdded:u}},t.genDisappearingModeSystemMsg=function(e,t,r){const n=r?(0,a.getMeUser)():e,i=[String(t),n];return c(e,"notification_template","disappearing_mode",i)},t.genEncryptNotificationMsg=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"encrypt";return c(e,"e2e_notification",t,[])},t.genErrorInDeviceListNotificationMsg=function(e,t){const r=(0,a.assertGetMe)();return{id:new s.default({fromMe:!1,remote:e,id:(0,o.newTag)()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"error_in_device_list",from:e,to:(0,l.toUserWid)(r),templateParams:[t]}},t.genNotificationMsg=c,t.genSecurityCodeNotificationMsg=function(e,t){const r=(0,a.getMeUser)();return{id:new s.default({fromMe:t.equals(r),remote:e,id:(0,o.newTag)()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"identity",from:e,to:r,body:t.toString()}},t.genTealNotificationTemplateMsg=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return c(e,"notification_template",t,r)};var i=r(92844),a=r(99234),s=n(r(32219)),o=r(15860),l=r(58021);function c(e,t,r,n){const l=(0,a.getMeUser)();return{id:new s.default({fromMe:e.equals(l),remote:e,id:(0,o.newTag)()}),t:(0,i.unixTime)(),type:t,subtype:r,from:e,to:l,templateParams:n}}},25868:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!a.ServerProps.bspSystemMessageEnabled)return(0,n.genEncryptNotificationMsg)(e);switch((0,i.getReducedPrivacyMode)(t)){case i.ReducedPrivacyMode.E2EE:return(0,n.genEncryptNotificationMsg)(e);case i.ReducedPrivacyMode.BSP:return(0,n.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_bsp");case i.ReducedPrivacyMode.FB:return(0,n.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_fb")}};var n=r(90257),i=r(30849),a=r(64551)},43239:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)&&!e.isGroupMsg&&0===t.msgs.length)return(0,i.default)(t.id,t.contact.privacyMode);return null};var i=n(r(25868)),a=r(7293)},37654:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genGroupCreationMsg=function(e,t){var r,n,a;const{chatId:l}=e,c=null!==(r=null!==(n=t.owner)&&void 0!==n?n:e.author)&&void 0!==r?r:(0,i.getMaybeMeUser)(),d=t.subject;return{id:new s.default({remote:l,fromMe:!1,participant:c,id:(0,o.newTag)()}),author:c,body:d,from:l,recipients:[],self:"in",subtype:"create",t:null!==(a=t.creation)&&void 0!==a?a:e.ts,type:"gp2"}},t.genGroupEphemeralSettingMsg=function(e,t,r,n){return{id:new s.default({remote:e,fromMe:!1,participant:r,id:(0,o.newTag)()}),author:r,from:e,recipients:[],self:"in",subtype:"ephemeral",t,type:"gp2",templateParams:[`${n}`]}},t.genGroupNotificationMsg=function(e,t){const{chatId:r}=e,n=e.author&&(0,l.toUserWid)(e.author)||void 0;let i=null,c=[],d=n,u=t.action,p=null;switch(t.action){case a.GROUP_ACTIONS.SUBJECT:i=t.subject;break;case a.GROUP_ACTIONS.MODIFY:c=t.participants;break;case a.GROUP_ACTIONS.ADD:t.isInvite&&(u="invite");case a.GROUP_ACTIONS.PROMOTE:case a.GROUP_ACTIONS.DEMOTE:case a.GROUP_ACTIONS.REMOVE:c=t.participants,1===c.length&&(d=c[0]),t.action===a.GROUP_ACTIONS.REMOVE&&1===c.length&&n===d&&(u="leave");break;case a.GROUP_ACTIONS.INVITE_CODE:u="revoke_invite";break;case a.GROUP_ACTIONS.DESC_ADD:u="description",i=t.desc;break;case a.GROUP_ACTIONS.DESC_REMOVE:u="description";break;case a.GROUP_ACTIONS.RESTRICT:case a.GROUP_ACTIONS.ANNOUNCE:case a.GROUP_ACTIONS.NO_FORWARD:p=t.value?["on"]:["off"],i=p[0];break;case a.GROUP_ACTIONS.EPHEMERAL:n&&(p=[`${t.duration}`,n]);break;case a.GROUP_ACTIONS.GROWTH_LOCKED:p=[t.type],i=p[0]}const h={id:new s.default({remote:r,fromMe:!1,participant:d,id:(0,o.newTag)()}),author:n,from:r,recipients:c.map(l.toUserWid)||[],self:"in",subtype:u,t:e.ts,type:"gp2"};i&&(h.body=i);p&&(h.templateParams=p);return h},t.genGroupPicChangeNotificationMsg=function(e,t,r,n){return{type:"gp2",self:"in",subtype:"picture",t:r,author:n,body:t,recipients:[],from:e,id:new s.default({remote:e,fromMe:!1,id:(0,o.newTag)()})}},t.genIntialPhashMismatchMsg=function(e,t){return{id:new s.default({remote:e,fromMe:!1,id:(0,o.newTag)()}),from:e,recipients:[],self:"in",subtype:"initial_pHash_mismatch",t,type:"gp2"}};var i=r(99234),a=r(36098),s=n(r(32219)),o=r(15860),l=r(58021)},39577:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPaymentInviteAccoutSetupMsg=function(e,t){return{id:new a.default({remote:e,fromMe:!1,id:(0,s.newTag)()}),from:e,recipients:[],self:"in",subtype:"payment_invite_account_set_up",t,type:i.default.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[e]}};var i=n(r(69618)),a=n(r(32219)),s=r(15860)},30849:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReducedPrivacyMode=void 0,t.comparePrivacyMode=function(e,t){return null==e&&null==t?0:null==t?1:null==e?-1:e.privacyModeTs-t.privacyModeTs},t.getContactPrivacyMode=function(e){if(!a.default.isUser(e))return;const t=r(19380).ContactCollection.get(e);return null==t?void 0:t.privacyMode},t.getLatestPrivacyMode=function(e,t){return null==e?t:null==t||e.privacyModeTs>t.privacyModeTs?e:t},t.getPrivacyModeFromQueryExistResponse=function(e){var t;const r=null===(t=e.bizInfo)||void 0===t?void 0:t.verifiedName;return null==r?null:e.biz&&!0===r.isApi?r.privacyMode:null},t.getReducedPrivacyMode=function(e){return null==e||e.actualActors===i.ActualActorsEnumType.Self&&e.hostStorage===i.HostStorageEnumType.OnPremise?s.E2EE:e.hostStorage===i.HostStorageEnumType.Facebook?s.FB:s.BSP};var i=r(49714),a=n(r(39546));const s=r(54302).Mirrored(["E2EE","BSP","FB"]);t.ReducedPrivacyMode=s},10258:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(34342));class a extends i.default{constructor(){super(),this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.theme=this.currentTheme,this.handleThemeChange=()=>{const e=this.currentTheme;e!==this.theme&&(this.theme=e,this.trigger("system_theme_change",e))},this.mediaQuery.addListener(this.handleThemeChange)}get currentTheme(){return this.mediaQuery.matches?"dark":"light"}}var s=new a;t.default=s},97920:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(2525)),a=n(r(45095)),s=n(r(69618)),o=n(r(53962)),l=r(31515);var c=(()=>{try{const e=(0,a.default)(o.default,"sessionStorage");return e.setItem(s.default.KEY_STORAGE_TEST,s.default.KEY_STORAGE_TEST),(0,l.isFunction)(e.clear)}catch(e){return!1}})()?new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t,(0,a.default)(o.default,"sessionStorage").setItem(e,t)}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==this.dataStore[e]||t?(0,a.default)(o.default,"sessionStorage").getItem(e):this.dataStore[e]}removeItem(e){delete this.dataStore[e],(0,a.default)(o.default,"sessionStorage").removeItem(e)}clear(e){return this.dataStore={},(0,a.default)(o.default,"sessionStorage").clear(),e&&(0,i.default)(e,(function(e,t){(0,a.default)(o.default,"sessionStorage").setItem(t,e)})),Promise.resolve()}}:new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t}getItem(e){return void 0===this.dataStore[e]?null:this.dataStore[e]}removeItem(e){delete this.dataStore[e]}clear(){return this.dataStore={},Promise.resolve()}};t.default=c},59402:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r={ROOT:1,THENABLE:2,FINALLY:3,META:4},n={PENDING:1,FULFILLED:2,REJECTED:3};function i(){let e,t;switch(this._parent=null,this._subs=[],this._catchTypes=null,this._onResolve=null,this._onReject=null,this.type=r.ROOT,this.state=n.PENDING,this.value=void 0,this._forceable=!1,this._cancellable=!1,arguments.length){case 0:break;case 1:e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new Error("TightPromise constructor with "+arguments.length+" arguments")}if(this.context=t,arguments.length>0)try{e.call(t,s.bind(this),o.bind(this))}catch(e){o.call(this,e)}}function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const a=new i;return a.type=r.THENABLE,a._onReject=arguments[arguments.length-1],arguments.length>1&&(a._catchTypes=Array.prototype.slice.call(arguments,0,arguments.length-1),a._catchTypes.forEach((function(e){if("function"!=typeof e)throw new Error("expected type, got "+e)}))),this._addChild(a),a}function s(e){var t;this.state===n.PENDING&&("object"!=typeof(t=e)&&"function"!=typeof t||"function"!=typeof t.then?(this.value=e,this.state=n.FULFILLED,this._notifySubs()):e.then(s.bind(this),o.bind(this)))}function o(e){this.state===n.PENDING&&(this.value=e,this.state=n.REJECTED,this._notifySubs())}i.STATE=n,i.TYPE=r,i.prototype={isPending:function(){return this.state===n.PENDING},then:function(e,t){if(!e&&!t)return this;const n=new i;return n.type=r.THENABLE,n._onResolve=e||null,n._onReject=t||null,this._addChild(n),n},catch:a,catchType:a,catchTypes:a,catchTypes3:a,catchEqualTo:a,finally:function(e){const t=new i;return t.type=r.FINALLY,t._onResolve=e,this._addChild(t),t},bind:function(e){const t=new i;return t.type=r.META,this._addChild(t),t.context=e,t},spread:function(e){return this.then((function(t){e.apply(this,t)}))},get:function(e){return this.then((function(t){return t[e]}))},forceable:function(){const e=new i;return e.context=this.context,e.type=r.META,this._addChild(e),e._forceable=!0,e},cancellable:function(){const e=new i;return e.context=this.context,e.type=r.META,this._addChild(e),e._cancellable=!0,e},force:function(e){if(this._forceable){let t=this;for(;t.type===r.META;){const e=t._parent;if(!(null==e?void 0:e._forceable)||e.state!==n.PENDING)break;t=e}s.call(this,e)}},cancel:function(e){let t=e;if(this._cancellable){t=t||new Promise.CancellationError;let e=this,r=!1;do{const t=e._parent;(null==t?void 0:t._cancellable)&&t.state===n.PENDING?e=t:r=!0}while(!r);o.call(e,t)}},loosen:function(){return Promise.resolve(this)},_run:function(e,t){let r;try{r=e.call(this.context,t)}catch(e){return void o.call(this,e)}s.call(this,r)},_handle:function(){if(this.state!==n.PENDING)return;const e=this._parent;switch(this.type){case r.THENABLE:if(e.state===n.FULFILLED){const t=this._onResolve;t?this._run(t,e.value):s.call(this,e.value)}else if(this._onReject){const t=this._catchTypes,r=t?t.length:0,n=e.value;if(0===r)return void this._run(this._onReject,n);for(let e=0;e<r;e++)if(n instanceof t[e])return void this._run(this._onReject,n);o.call(this,n)}else o.call(this,e.value);return;case r.FINALLY:try{this._onResolve.call(this.context)}catch(e){!function(e){setTimeout((function(e){throw e}),0,e)}(e)}default:e.state===n.FULFILLED?s.call(this,e.value):o.call(this,e.value)}},_addChild:function(e){e._parent=this,e.context=this.context,e._cancellable=this._cancellable,e.type===r.META&&(e._forceable=this._forceable),this.state===n.PENDING?this._subs.push(e):e._handle()},_notifySubs:function(){this._subs.forEach((function(e){e._handle()}))}},i.delay=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n,a;switch(arguments.length){case 0:n=0;break;case 1:n=arguments[0];break;default:n=arguments[1],a=arguments[0]}return new i((function(e){setTimeout(e.bind(null,a),n)}))},i.resolve=function(e){const t=new i;return s.call(t,e),t},i.reject=function(e){const t=new i;return o.call(t,e),t};var l=i;t.default=l},22906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expBackoff=i,t.expDelaySec=function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return(0,n.delayMs)(Math.floor(1e3*i(e,t,r,a)))};var n=r(13959);function i(e,t,r){let n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return n=0===e?r||0:2**e,Number.isFinite(t)&&n>t&&(n=t),"number"==typeof r&&Number.isFinite(r)&&n<r&&(n=r),i&&(n*=1+i*Math.random()),n}},16238:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TLD=void 0;const r=new Set(["abb","abbott","abudhabi","ac","academy","accountant","actor","ad","adult","ae","aero","af","africa","ag","agency","ai","al","am","anz","ao","apartments","app","apple","ar","army","art","as","asia","associates","at","attorney","au","auction","audio","auspost","auto","aws","az","ba","baby","band","bank","bar","barcelona","barclays","basketball","bayern","bb","bd","be","beauty","beer","berlin","best","bet","bf","bg","bh","bi","bid","bike","bingo","bio","biz","bj","black","blog","blue","bn","bnpparibas","bo","bond","bot","boutique","box","br","bradesco","broker","brother","brussels","bs","bt","build","builders","business","buy","buzz","bw","by","bz","bzh","ca","cab","cafe","call","cam","camera","camp","canon","capital","cards","care","career","careers","cars","casa","cash","casino","cat","cba","cc","cd","center","ceo","cern","cf","cfd","cg","ch","charity","chat","cheap","chrome","church","ci","circle","city","cl","claims","cleaning","click","clinic","clothing","cloud","club","cm","cn","co","coach","codes","coffee","college","cologne","com","community","company","construction","consulting","cooking","cool","coop","corsica","country","coupon","coupons","courses","cr","credit","cricket","crs","cu","cv","cw","cx","cy","cymru","cyou","cz","dance","date","dating","de","deals","delivery","democrat","dental","desi","design","dev","dhl","diamonds","diet","digital","direct","directory","discount","dj","dk","dm","do","doctor","dog","domains","download","dz","earth","ec","eco","edu","education","ee","eg","email","energy","engineer","engineering","enterprises","equipment","es","estate","et","eu","eus","events","exchange","expert","exposed","express","fail","faith","family","fan","fans","farm","fashion","fi","film","finance","financial","fish","fit","fitness","fj","florist","flowers","fm","fo","football","forsale","foundation","fr","free","fun","fund","furniture","futbol","fyi","ga","gal","gallery","game","games","garden","gay","gd","gdn","ge","gent","gf","gg","gh","gi","gift","gifts","gives","gl","glass","gle","global","gmbh","gold","golf","goog","google","gop","got","gov","gp","gq","gr","graphics","gratis","green","group","gs","gt","gu","guide","guru","gw","gy","hamburg","haus","health","healthcare","help","hitachi","hk","hn","hockey","holdings","homes","honda","horse","hospital","host","hosting","hot","house","how","hr","ht","hu","icu","id","ie","il","im","immo","in","inc","industries","info","ink","institute","insure","int","international","investments","io","iq","ir","is","ist","istanbul","it","je","jewelry","jm","jo","jobs","joy","jp","ke","kg","kh","ki","kim","kitchen","kiwi","kn","koeln","komatsu","kp","kpmg","kr","krd","kred","kw","ky","kyoto","kz","la","land","lat","law","lawyer","lb","lc","leclerc","legal","lgbt","li","life","like","limited","limo","link","live","lk","llc","loan","loans","lol","london","love","lr","ls","lt","ltd","lu","luxe","lv","ly","ma","management","market","marketing","markets","mba","mc","md","me","media","men","menu","mg","miami","microsoft","mil","mk","ml","mm","mn","mo","mobi","moda","moe","moi","mom","monash","money","monster","mortgage","moscow","movie","mp","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","navy","nc","ne","net","network","neustar","new","news","nf","ng","ngo","ni","nico","ninja","nl","no","np","nr","ntt","nu","nyc","nz","okinawa","om","one","ong","onl","online","ooo","orange","org","organic","ovh","pa","page","paris","partners","parts","party","pay","pe","pet","pf","ph","pharmacy","photo","photography","photos","physio","pics","pictures","pin","pink","pizza","pk","pl","place","plus","pm","pn","poker","porn","post","pr","press","pro","promo","properties","property","ps","pt","pub","pw","py","qa","quebec","quest","racing","radio","re","read","realestate","realtor","recipes","red","ren","rent","rentals","repair","report","rest","restaurant","review","reviews","rip","ro","rocks","rodeo","rs","ru","rugby","run","rw","sa","safe","sale","salon","sandvik","sap","saxo","sb","sbi","sbs","sc","school","science","scot","sd","se","secure","security","services","sex","sexy","sg","sh","sharp","shiksha","shoes","shop","shopping","show","si","site","sk","ski","skin","sl","sm","smile","sn","sncf","so","social","softbank","software","solar","solutions","song","sony","soy","space","sport","spot","sr","st","statebank","storage","store","stream","studio","study","style","su","supply","support","surf","sv","swiss","sx","sy","sydney","systems","sz","tab","taipei","tatar","tax","taxi","tc","team","tech","technology","tel","temasek","tf","tg","th","theater","tickets","tips","tirol","tj","tk","tl","tm","tn","to","today","tokyo","tools","top","tours","town","toyota","tr","trade","trading","training","travel","tt","tube","tunes","tushu","tv","tw","tz","ua","ug","uk","university","uno","us","uy","uz","va","vc","ve","vegas","ventures","vet","vg","vi","video","villas","vin","vip","vision","vn","vote","vu","wales","wang","wanggou","watch","webcam","weber","website","wf","wiki","win","wine","work","works","world","ws","wtf","xyz","yandex","ye","yoga","youtube","yt","za","zero","zm","zone","zw","бел","дети","москва","онлайн","орг","рус","рф","сайт","укр","קום","مصر","भारत","இந்தியா","クラウド","ストア","ファッション","書籍","移动","食品","한국"]);t.TLD=r},25170:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(12641));const a=[.1,.82,.25,1],s=[.69,0,.79,.14],o=[.84,.07,.93,.46];i.default.RegisterEffect("attach.Up",{defaultDuration:300,calls:[[{opacity:[1,0],translateY:["0%","150%"],scaleX:[1,.3],scaleY:[1,.3]},1,{easing:[300,22]}]]}),i.default.RegisterEffect("attach.Down",{defaultDuration:200,easing:s,calls:[[{opacity:[0,1],translateY:["100%","0%"],scaleX:[.3,1],scaleY:[.3,1]},1,{easing:[.33,0,.39,.91]}]]}),i.default.RegisterEffect("dropdown.Down",{defaultDuration:200,easing:a,calls:[[{opacity:[1,0],translateY:["0%","-15px"]},1,{easing:a}]]});var l={pop:{duration:200,easing:o,enter:{props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]}},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]}}},slide:{duration:200,easing:a,enter:{props:"slideDown"},leave:{props:"slideUp"}},scaleY:{duration:200,easing:a,enter:{props:{scaleY:[1,0],transformOrigin:"center"}},leave:{props:{scaleY:[0,1],transformOrigin:"center"}}},scale:{duration:500,easing:a,enter:{props:{scaleX:[1,0],scaleY:[1,0]}},leave:{props:{scaleX:[0,1],scaleY:[0,1]}}},fade:{duration:200,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},messageComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0],translateX:[0,-100]}},leave:{props:{opacity:[0,1],translateX:[-100,0]}}},pttComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"fade-fast":{easing:"ease",enter:{props:{opacity:[1,0]},duration:150},leave:{props:{opacity:[0,1]},duration:100}},"ptt-out-of-chat":{enter:{props:{translateY:["-100%","0%"],opacity:[1,0]},duration:250,delay:150,easing:"ease"},leave:{props:{translateY:["0%","-100%"],opacity:[0,1]},duration:250,delay:150,easing:"ease"}},fade_sifo:{enter:{props:{opacity:[1,0]},duration:250},leave:{props:{opacity:[0,1]},duration:100}},capture:{enter:{props:{opacity:[1,0]},duration:350},leave:[{selector:"[data-animate-capture-snapshot]",props:"transition.bounceDownOut",duration:700},{selector:"[data-animate-capture-webcam]",props:{opacity:[0,1]},duration:100,easing:"ease"}]},butterbar:{enter:{props:"slideDown",easing:a,duration:700},leave:{props:"slideUp",easing:s,duration:350}},modal:{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,0]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:s,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:s,duration:200}]},"modal-flow":{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,1]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:s,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:s,duration:200}]},"flow-transition-modal-push":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-modal-pop":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-box-size-drawer-push":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["-100%","0%"]}}]},"flow-transition-box-size-drawer-pop":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","-100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["100%","0%"]}}]},"flow-transition-drawer-push":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"flow-transition-drawer-pop":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"drawer-left":{enter:[{props:{translateX:["0%","-100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,-50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["-100%","0%"]},duration:300,easing:s}]},"drawer-left-rtl":{enter:[{props:{translateX:["0%","100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["100%","0%"]},duration:300,easing:s}]},dropdown:{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:"dropdown.Down",delay:50,duration:375,stagger:25,drag:!0},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}},"dropdown-picker":{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},delay:50,duration:200},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0],rotateZ:["45deg"],translateY:["0%","-100%"]}},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},duration:100},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0]},duration:150},{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}]},"profile-viewer":{duration:500,easing:[.1,1.03,.28,.99],leave:[{delay:400,props:{opacity:[0,1]}},{selector:"[data-animate-profile-viewer]",props:{borderRadius:["50%","0%"]}}]},"media-viewer":{duration:300,easing:[.1,1.03,.28,.99],leave:{selector:"[data-animate-media-viewer]",props:{opacity:[0,1]}}},"status-v3-quoted-msg":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:200,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:s}},"status-v3-panel":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:300,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:s}},"status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[0,1]}}},"quoted-status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[0,1]}}},"status-v3-player":{easing:[.55,.085,.68,.53],enter:{duration:200,props:{opacity:[1,0]}},leave:{duration:200,props:{opacity:[0,1]}}},menu:{enter:{selector:"[data-animate-menu-icons-item]",props:"attach.Up",duration:700,stagger:30,drag:!1},leave:{selector:"[data-animate-menu-icons-item]",props:"attach.Down",duration:200,stagger:30}},emoji:{duration:300,easing:a,enter:{props:{height:[291,0]}},leave:{props:{height:[0,291]}}},ptt:{enter:[{selector:"[data-animate-btn-border]",easing:"easeInOut",props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]},duration:250,delay:100},{selector:"[data-animate-ptt-counter]",easing:"easeInOut",props:{scaleX:[1,.8],scaleY:[1,.8],opacity:[1,0]},duration:250,delay:100},{props:{opacity:[1,0]},duration:150,easing:a}],leave:[{selector:"[data-animate-btn-border]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{selector:"[data-animate-ptt-counter]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{props:{opacity:[0,1]},duration:300,easing:a}]},"slide-left":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["100%","0%"]}}},"slide-left-rtl":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"media-slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["-30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"media-slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","-30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"slide-down-date":{duration:300,enter:{props:{translateY:["0%","-130%"],opacity:[1,0]},easing:a},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]},easing:s}},"slide-down-test":{duration:300,easing:a,enter:{props:{height:["auto","0"],opacity:[1,0]}},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]}}},"pop-fast-reverse":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","-100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["-100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast-chat":{duration:75,easing:[.14,.62,.33,.9],enter:[{props:{width:["20px","5px"],opacity:[1,.5]}}],leave:[{props:{width:["5px","20px"],opacity:[0,1]}}]},"toast-transition":{duration:300,easing:a,cleanOnComplete:!0,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"slide-up-down":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-down-footer":{duration:200,easing:a,enter:[{props:{translateY:["0%","100%"]}},{selector:"[data-animate-btn]",props:{opacity:[1,0],scale:[1,0]},delay:200,duration:300}],leave:[{props:{translateY:["100%","0%"]},delay:200},{selector:"[data-animate-btn]",props:{opacity:[0,1],scale:[.6,1]},duration:200}]},"slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-fade-in-eta":{duration:100,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0],height:[20,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1],height:[0,20]}}},"slide-down":{duration:300,easing:a,enter:{props:{translateY:["0%","-100%"]}},leave:{props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away":{duration:300,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away-fast":{duration:80,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-panel-slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1]}}},none:{},btn:{duration:300,easing:a,enter:{props:{scale:[1,0],opacity:[1,0]}},leave:{props:{scale:[0,1],opacity:[0,1]}}},pop_delay:{duration:300,enter:[{props:{scale:[1,0],opacity:[1,0]},delay:500,easing:a}],leave:{props:"transition.expandOut",easing:s}},"delay-leave":{duration:1,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]},delay:300}},"media-caption":{enter:[{props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300}],leave:{props:{opacity:[0,1]},easing:"ease",duration:300}},"media-scale":{enter:[{selector:"[data-animate-media-caption]",props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{selector:"[data-animate-media-caption]",props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,0]},duration:200},{selector:"[data-animate-attach-media]",props:{opacity:[1,0],scale:[1,.625],display:"flex"},delay:200,duration:300,easing:a}],leave:[{selector:"[data-animate-media-caption]",props:{opacity:[0,1]},easing:"ease",duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,1],scale:[.5,1],display:"flex"},delay:0,duration:200,easing:s}]},"thumb-scale":{duration:400,easing:a,enter:{props:"transition.expandIn"},leave:{props:"transition.expandOut"}},"thumb-scale-flex":{duration:400,easing:a,enter:{props:{scale:[1,0],display:"flex"}},leave:{duration:200,props:{scale:[0,1],display:"flex"}}},default:{duration:300,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},noop:{duration:0},"noop-full-opacity":{duration:0,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]}}},pip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:o}},voip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:o}},"replace-fade":{enter:[{props:{opacity:[0,0]},duration:400},{props:{opacity:[1,0]},duration:400,delay:400}],leave:{props:{opacity:[0,1]},duration:400}}};t.default=l},31515:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=function(e){return"boolean"==typeof e},t.isFunction=function(e){return"function"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e}},65127:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UA=void 0,t.gteVersion=s,t.ltVersion=o,t.parseUA=l;var i=n(r(42238));function a(e,t){let r,n;const i=/(\.0)+[^\.]*$/,a=(e+"").replace(i,"").split("."),s=(t+"").replace(i,"").split("."),o=Math.min(a.length,s.length);for(r=0;r<o;r++)if(n=parseInt(a[r],10)-parseInt(s[r],10),0!==n)return n;return a.length-s.length}function s(e,t){return a(e,t)>=0}function o(e,t){return a(e,t)<0}function l(e){const t=new i.default;t.setUA(e||"");const r=(t.getBrowser().name||"").toUpperCase(),n=t.getBrowser().version||"0.0.0",a=(t.getEngine().name||"").toUpperCase(),l=(t.getOS().name||"").toUpperCase(),c=t.getOS().version||"0.0.0",d="SAFARI"===r,u="CHROME"===r,p="GECKO"===a,h="BLINK"===a;let f=!1;switch(l){case"MAC OS":u?f=s(c,"10.10")&&s(n,"41.0.0"):s(c,"10.7")&&(f=!0);break;case"WINDOWS":s(c,"8.1")&&(p||u&&s(n,"41.0.0"))&&(f=!0)}const _=d||u&&o(n,"76");return{isWebkit:!a||"WEBKIT"===a,isGecko:p,isTrident:"TRIDENT"===a||"EDGEHTML"===a,isSafari:d,isElectron:!1,isBlink:h,isBuggyVideoLoad:u&&s(n,"76")||h&&!u,hasEmoji:f,troublesWithLotsOfVideos:u,supportsEmojiEllipsification:!_,isBrokenGetUserMedia:u&&o(n,"50"),isLocalStorageBroken:d&&s(n,"14.1")&&o(n,"14.1.2"),os:l.toLowerCase(),osVersion:c,browser:r.toLowerCase(),browserVersion:n,parser:t,isChrome:u}}const c=l("undefined"!=typeof self?self.navigator.userAgent:null);t.UA=c},3940:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.codePointAt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.codePointAt)return e.codePointAt(t);let r=e.charCodeAt(t);if(r>=55296&&r<=56319){const n=e.charCodeAt(t+1);n>=56320&&n<=57343&&(r=65536+(r-55296<<10)+(n-56320))}return r},t.firstNCodepoints=function(e,t){return i(e||"",0,t)},t.firstNEncodedBytes=function(e,t){if(null==t)return e;if(encodeURI(e).length<=t)return e;let r=0;const n=a(e),s=n.length;for(let a=0;a<s;a++){const s=n[a],o=encodeURI(s).length;if(r+o>t)return i(e,0,a);r+=o}return e},t.numCodepoints=function(e){return(0,n.length)(e||"")},t.substring=i,t.toArray=a;var n=r(65023);function i(e,t,r){if(!e)return"";const i=t||0,a=null==r?1/0:r;return e.length,0===i&&a===1/0?e:e.length>=5e3&&a/e.length<=.5?function(e,t,r){const i=new RegExp(n.astralRange);let a,s="",o=0;do{a=i.exec(e),a&&(s+=a[0]),o++}while(a&&o<r);return s}(e,0,a):(0,n.substring)(e,i,a)}function a(e,t,r){const i=e||"",a=t||0,s=null==r?1/0:r;return i.length>=5e3&&s/i.length<=.5?function(e,t,r){const i=new RegExp(n.astralRange),a=[];let s;do{s=i.exec(e),s&&a.push(s[0])}while(s&&a.length<r);return a}(i,0,s):(0,n.toArray)(i).slice(a,s)}},83973:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=void 0,t.checkForUpdates=function(){return p.apply(this,arguments)},t.updatePoll=t.hasUpdate=void 0;var i=n(r(48926)),a=n(r(69618)),s=n(r(18561)),o=n(r(67826)),l=r(29898);const c={WEB:"web",DARWIN:"darwin",WIN32:"win32",MACSTORE:"darwin-store",WINSTORE:"win32-store",DARWIN_BETA:"darwin-beta",WIN32_BETA:"win32-beta"};t.PLATFORMS=c;const d=e=>[e.isBroken,e.isBelowSoft,e.isBelowHard,e.beta].some(Boolean);t.hasUpdate=d;const u=new o.default({name:"updater",interval:1800,restingInterval:3600,randomIntervalExtension:180});function p(){return(p=(0,i.default)((function*(){const e=c[a.default.WAM_PLATFORM],t=a.default.VERSION_STR.replace(/\.[di]$/,"");let n=null;if(!navigator.onLine)return __LOG__(2)`Update check skipped because user is offline.`,!1;try{const r=yield(0,s.default)(`${a.default.CHECK_UPDATE_URL}?version=${t}&platform=${e}`);if(!r.ok)throw Error(r.statusText);n=yield r.json();const i=(new Date).toISOString();__LOG__(2)`Updater: Checked at ${i} ${JSON.stringify({response:n,version:t})}`}catch(e){__LOG__(4,void 0,new Error)`Updater: Version check failed`}if(!n||!d(n))return!1;const{isBelowHard:i,isBelowSoft:o,hardUpdateTime:u,currentVersion:p,isBroken:h,beta:f}=n;__LOG__(2)`Updater: App will update. ${JSON.stringify({response:n,version:t})}`;const _=i?u:null;return"web"===e?l.Updater.update(p,o,_):h?r(8080).Stream.needsManualDownload=!0:l.Updater.update(void 0,o,_,f),!0}))).apply(this,arguments)}t.updatePoll=u},41629:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterBase=t.DownloadState=void 0;var i=r(40265),a=n(r(15421)),s=r(22683),o=n(r(69618)),l=n(r(19197)),c=n(r(34342)),d=n(r(39428)),u=n(r(47221));const p=r(54302).Mirrored(["UPDATE_DOWNLOADED","UPDATE_NOT_AVAILABLE","ERROR"]);t.DownloadState=p;class h extends c.default{constructor(){super(),this._forceUpdateOnTakeOver=!1,this.latestUpdateIteration=0,this.activeVersion=new u.default(o.default.VERSION_BASE),l.default.onVersionChange((()=>this.setForceUpdateOnTakeOver()))}setForceUpdateOnTakeOver(){this._forceUpdateOnTakeOver=!0}shouldForceUpdateOnTakeOver(){const e=this._forceUpdateOnTakeOver;return this._forceUpdateOnTakeOver=!1,!!e}isExpired(){return s.Clock.globalUnixTime()>Number(d.default)}clearHardExpiration(){this.hardExpirationTimer&&(a.default.clearTimeout(this.hardExpirationTimer),this.hardExpirationTimer=void 0),this.stopListening(r(8080).Stream,"change:couldForce")}update(){throw new i.UnimplementedMethod("Updater::update")}restart(){throw new i.UnimplementedMethod("Updater::restart")}manualDownload(){throw new i.UnimplementedMethod("Updater::manualDownload")}killServiceWorker(){throw new i.UnimplementedMethod("Updater::killServiceWorker")}}t.UpdaterBase=h},29898:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterImpl=t.Updater=void 0;var i=r(41629),a=n(r(47221)),s=n(r(15421)),o=n(r(87045)),l=n(r(5882));class c extends i.UpdaterBase{update(e,t,n){let o;__LOG__(2)`AppUpdate:update current: ${String(this.activeVersion)} latest: ${String(e)}`;const l=++this.latestUpdateIteration,c=e?new a.default(e):void 0;this.clearHardExpiration();const d=r(8080).Stream;return"number"==typeof n&&(this.hardExpirationTimer=s.default.setLocalTimeout((()=>(d.clientExpired=!0,this._update(c).then((e=>{e===i.DownloadState.UPDATE_DOWNLOADED&&this.restart()})))),Date.now()+n)),o=this.updateInProgress=Promise.resolve(this.updateInProgress).then((()=>this._update(c))).then((e=>{this.updateInProgress=void 0;const r=l!==this.latestUpdateIteration,a=e===i.DownloadState.ERROR,s=e===i.DownloadState.UPDATE_NOT_AVAILABLE;return r||a||s||((t||"number"==typeof n)&&(d.needsUpdate=!0),"number"==typeof n&&this.listenToAndRun(d,"change:couldForce",(()=>{d.couldForce&&this.restart()}))),e})),o}_update(e){if(!this.activeVersion.equals(e)&&l.default.alive)return this._swUpdate();const t=this.activeVersion.equals(e)?i.DownloadState.UPDATE_NOT_AVAILABLE:i.DownloadState.UPDATE_DOWNLOADED;return Promise.resolve(t)}killServiceWorker(){if(!l.default.alive)return Promise.resolve();const e=navigator.serviceWorker;return e?(__LOG__(2)`Killing service worker`,e.ready.then((e=>e.unregister())).then((e=>{__LOG__(2)`Service worker unregistration status: ${String(e)}`}))):Promise.resolve()}_swUpdate(){const e=navigator.serviceWorker;return e?e.ready.then((t=>new Promise((r=>{function n(e){s(),__LOG__(3)`Unable to update service worker to version. Error: ${String(e)}`}function a(){s(),r(i.DownloadState.UPDATE_DOWNLOADED)}function s(){e.removeEventListener("error",n),e.removeEventListener("controllerchange",a)}e.addEventListener("error",n),e.addEventListener("controllerchange",a),t.update().then((()=>{t.installing||r(i.DownloadState.UPDATE_NOT_AVAILABLE)})).catch((e=>{n(e),r(i.DownloadState.ERROR)}))})))).catch((e=>(__LOG__(3)`Unable to update serviceworker, error: ${e}`,i.DownloadState.ERROR))):Promise.resolve(i.DownloadState.ERROR)}restart(e){return e?this.update(void 0,!0,0):(o.default.hardRefresh(void 0,!1),Promise.resolve(i.DownloadState.UPDATE_DOWNLOADED))}}t.UpdaterImpl=c;const d=new c;t.Updater=d},47221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(40265);class i extends((0,n.customError)("InvalidVersion")){}class a{constructor(e){const t=e.split(".");if(3!==t.length)throw new i("Version format does not contain 3 numbers.");if(this.primary=Number.parseInt(t[0],10),this.secondary=Number.parseInt(t[1],10),this.tertiary=Number.parseInt(t[2],10),Number.isNaN(this.primary)||Number.isNaN(this.secondary)||Number.isNaN(this.tertiary))throw new i("Version contains a non-parseable string.")}lt(e){let t=e;return"string"==typeof t&&(t=new a(t)),this.primary<t.primary||this.primary===t.primary&&this.secondary<t.secondary||this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary<t.tertiary}equals(e){let t=e;return!!t&&("string"==typeof t&&(t=new a(t)),this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary===t.tertiary)}toString(){return`${this.primary}.${this.secondary}.${this.tertiary}`}}t.default=a},2541:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.URL_REGEX=t.URL=t.REDIRECT_URL=void 0;var i=n(r(88306)),a=n(r(2525)),s=r(15688),o=r(8584),l=n(r(8575)),c=r(1063),d=r(41796),u=n(r(71208)),p=r(31515),h=n(r(23082));let f;const _=/^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/;t.URL_REGEX=_;const m="https://l.wl.co/l";t.REDIRECT_URL=m;const g={build(e,t){const r=new h.default;return(0,a.default)(t||{},((e,t)=>{r.set(t,e)})),`${e}?${r.toString()}`},canMuckHistory(){var e;return!!((0,d.isConnectedToPage)()&&(null===(e=window.history)||void 0===e?void 0:e.pushState)&&self.location)},relToAbs:e=>(f||(f=document.createElement("a")),f.href=e,f.href),hostname:(0,i.default)((function(e){return f||(f=document.createElement("a")),f.href=this.isHttp(e)?e:"http://"+e,f.hostname})),withoutWww:function(e){return e.split("www.").join("")},isHttp:e=>e&&("https://"===e.toLowerCase().substring(0,8)||"http://"===e.toLowerCase().substring(0,7)),isHttps:e=>e&&"https://"===e.toLowerCase().substring(0,8),hasValidUrlScheme(e){const t=e.trim();return["irc://","ftp://","mailto:","http://","https://"].some((e=>0===t.toLowerCase().indexOf(e)))},isBlob:e=>(0,p.isString)(e)&&"blob:"===e.substring(0,5),isData:e=>(0,p.isString)(e)&&"data:"===e.substring(0,5),isEncryptedMedia:e=>e&&(0,p.isString)(e)&&e.endsWith(".enc"),parseDataURL(e){const t=e.indexOf(":"),r=e.indexOf(";"),n=e.indexOf(",");return{mimetype:e.substring(t+1,r),data:e.substring(n+1)}},dataURLtoFile(e){const t=this.parseDataURL(e).mimetype;return(0,c.createFile)([window.dataURLtoBlob(e)],"",{type:t})},GSM_NAME:"gme-whatsappinc",GSM_NUMS:"LM4NgcjF-X_EedaZ6MwPVSH0Sac=",gsmURL(e,t){const r=t.replace(/\-/g,"+").replace(/_/g,"/"),n=(0,s.decodeB64)(r),i=l.default.parse(e).path,a=o.Binary.build(i).readByteArray();return new u.default(n).sign(a).then((t=>`${e}&signature=${(0,s.encodeB64UrlSafe)(t)}`))},thumbToCSSURL(e){return`url("${this.isHttp(e)||e.startsWith("data:")?e:`data:image/jpeg;base64,${e}`}")`},thumbAsBackgroundImage(e){return e?{backgroundImage:this.thumbToCSSURL(e)}:{}},isValid:e=>_.test(e),toMaliciousSiteRedirect:e=>""===e||0===e.indexOf(m)?e:`${m}?u=${encodeURIComponent(e)}`};t.URL=g},84435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if((0,n.isConnectedToPage)()){return r(8080).Stream.available}return!1};var n=r(41796)},78521:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0,t.getNameString=O,t.getNameStringFromNames=I,t.mergeVcards=function(e){if(0===e.length)throw new Error("No vcards provided");return 1===e.length?e[0]:{displayName:O(e),vcard:e.map((e=>e.vcard)).join("\n"),isMultiVcard:!0}},t.parseMultiVcard=function(e){const t=e.match(/BEGIN:VCARD([\s\S]*?)END:VCARD/g);return t?t.map((e=>P(e))).filter(Boolean):[]},t.parseVcard=P,t.vcardFromContactModel=function(e){var t;const r=b((0,p.getMaybeMeUser)()?e.displayName:e.formattedName),n=["BEGIN:VCARD","VERSION:3.0",`N:${M(e)}`,`FN:${r}`,`TEL;type=CELL;waid=${String(e.userid)}:${(0,m.default)(e.userid)}`,e.isBusiness?`X-WA-BIZ-NAME:${r}`:null,(null===(t=e.businessProfile)||void 0===t?void 0:t.description)?`X-WA-BIZ-DESCRIPTION:${b(e.businessProfile.description)}`:null,"END:VCARD"].filter(Boolean);return{displayName:r,vcard:n.join("\n"),isMultiVcard:!1}},t.vcardGetDate=function(e){let t=e;return(0,o.default)([/-([^-]*)-([^-]*)-([^-]*)/,/([^-]*)-([^-]*)-([^-]*)/],(r=>{const n=e.match(r);if(n){const e=!n[1].length||"1604"===n[1],r=e?"0000":n[1];return t=(0,u.default)(`${r}-${n[2]}-${n[3]}`).format("l"),e&&(t=t.replace(/[.,-\/\s]*0000[.,-\/\s]*/,"")),!1}})),t},t.vcardGetName=M,t.vcardGetNameFromParsed=function(e){let t=null;const{FN:r,NICKNAME:n,TEL:i}=e;if(null==r?void 0:r[0])t=r[0].value;else if(null==n?void 0:n[0])t=n[0].value;else if(null==i?void 0:i[0]){var a;const e=i[0],r=null===(a=e.properties.waid)||void 0===a?void 0:a[0];t=r?(0,m.default)(r):e.value}return t},t.vcardGetOrganizationString=function(e){var t,r;const n=null===(t=e.ORG)||void 0===t?void 0:t[0],i=null===(r=e.TITLE)||void 0===r?void 0:r[0];if(n&&Array.isArray(n.value)&&n.value.length>0){var a;let e=null;(null==i?void 0:i.value)&&(e=`${i.value}`.trim());const[t,...r]=n.value;r.push(t);const s=r.map((e=>(0,f.isString)(e)?e.trim():"")).filter((e=>e.length)).join(h.default.t(420));return(e||"")+((null===(a=e)||void 0===a?void 0:a.length)&&s.length?" - ":"")+s}return""},t.vcardGetType=function(e){const t={jabber:h.default.t(1419),"skype-username":h.default.t(1424),skype:h.default.t(1424),msn:h.default.t(1421),aim:h.default.t(1409),yahoo:h.default.t(1427),icq:h.default.t(1417),"wa-biz-description":h.default.t(1411),[v]:h.default.t(1412)};let r=e.properties["X-ABLabel"]||t[e.type.toLowerCase()];if(r)return function(e){if(!e)return;return e.replace(/^_\$!<([^>]*)>!\$_$/,"$1").replace(/\\,/,",").replace(/\\;/,";").replace(/\\\\/,"\\")}(r);const n={TEL:[[["cell"],h.default.t(1413)],[["iphone"],h.default.t(1418)],[["main"],h.default.t(1420)],[["home","fax"],h.default.t(1416)],[["work","fax"],h.default.t(1426)],[["home"],h.default.t(1415)],[["work"],h.default.t(1425)],[["pager"],h.default.t(1423)],[[],h.default.t(1415)]],EMAIL:[[["home"],h.default.t(1415)],[["work"],h.default.t(1425)],[["internet"],h.default.t(1414)]],URL:[[["home"],h.default.t(1415)],[["work"],h.default.t(1425)]],ADR:[[["home"],h.default.t(1415)],[["work"],h.default.t(1425)]]};return r=e.type,(0,c.default)(n,(t=>{if(t){const[n,i]=t;if(0===(0,s.default)(n,(0,a.default)(e.properties.type,(e=>e.toLowerCase()))).length)return r=i,!1}})),r},t.vcardIsBiz=function(e){return(e.SERVICE||[]).some((e=>e.type.toLowerCase()===v&&e.value))},t.vcardSerialize=function(e){return e.map((function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")})).join("\n")},t.vcardThumbnail=function(e){if(!e)return;const{PHOTO:t}=e;if((null==t?void 0:t[0])&&_.URL.isData(t[0].value))return t[0].value},t.vcardWids=function(e){let t=[];(null==e?void 0:e.TEL)&&e.TEL.forEach((e=>{var r,n,i;(null!==(r=null===(n=e.properties)||void 0===n||null===(i=n.waid)||void 0===i?void 0:i.length)&&void 0!==r?r:0)>0&&(t=t.concat((0,a.default)(e.properties.waid,g.createUserWid)))}));return t};var i=n(r(63105)),a=n(r(35161)),s=n(r(91966)),o=n(r(84486)),l=n(r(89734)),c=n(r(2525)),d=n(r(45095)),u=n(r(30381)),p=r(99234),h=n(r(43725)),f=r(31515),_=r(2541),m=n(r(39938)),g=r(58021);const y=/X-([^;:]+)(?:;[^:]+)*:(.+)/,E={"X-ABLabel":[/X-ABLabel(?:;([^:]+))*:(.+)/,1],ADR:[/ADR(?:;([^:]+))*:;;(.*);(.*);(.*);(.*);(.*)/,5],"X-ABADR":[/X-ABADR(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.*)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1],TEL:[/TEL(?:;([^:]+))*:(.+)/,1]},S={N:[/N(?:;([^:]+))*:([^;]*);([^;]*);([^;]*);([^;]*);(.*)/,5],FN:[/FN(?:;([^:]+))*:(.*)/,1],NICKNAME:[/NICKNAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-FIRST-NAME":[/X-PHONETIC-FIRST-NAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-LAST-NAME":[/X-PHONETIC-LAST-NAME(?:;([^:]+))*:(.*)/,1],ORG:[/ORG(?:;([^:]+))*:([^;]*)(?:;(.*))*/,2],TITLE:[/TITLE(?:;([^:]+))*:(.*)/,1],TEL:[/TEL(?:;([^:]+))*:(.*)/,1],PHOTO:[/PHOTO(?:;([^:]+))*:(.*)/,1],BDAY:[/BDAY(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.+)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1]},v="wa-biz-name";class T{constructor(e,t,r,n){this.type=e,this.index=t,this.properties=r||{},this.value=n}}function A(e,t,r){e[t]||(e[t]=[]),e[t].push(r)}function C(e){const t={};return e?(e.split(";").forEach((e=>{const r=e.split(/=/);if(1===r.length){const e=r[0];A(t,e.toLowerCase(),!0)}else if(2===r.length){const[e,n]=r;A(t,e.toLowerCase(),n.toLowerCase())}})),t):t}function b(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,"):""}function P(e){const t=e.replace(/\r?\n|\r/g,"\n").replace(/\n^[ \t]/gm,"").split("\n").filter((e=>0!==e.trim().length)),r={},n={};if(t.length<3)return;const i=t[0].trim().toUpperCase(),a=t[1].trim().toUpperCase(),s=t[t.length-1].trim().toUpperCase(),o="VERSION:2.1"===a||"VERSION:3.0"===a||"VERSION:4.0"===a;if("BEGIN:VCARD"!==i||!o||"END:VCARD"!==s)return __LOG__(4,void 0,new Error,!0)`vcard:parse failed because the vCard is not formatted as expected:
Header as expected? ${String("BEGIN:VCARD"===i)}
Version as expected? ${String(o)}
Footer as expected? ${String("END:VCARD"===s)}
Lines: ${t.length}`,void SEND_LOGS("vcard-fault");for(let e=2;e<t.length-1;e++){const i=t[e],a=i.match(/item(\d+)\.(.*)/),s=a?a[2]:i,o=(0,d.default)(s.match(/([^:;]*)[:;].*/),"field.match(/([^:;]*)[:;].*/)")[1],l=a?E:S;let c,u,p=o,h=o;if(l[p]){const[e,t]=l[p],r=s.match(e);r&&(c=C(r[1]),u=1===t?u=r[2]:r.slice(2,2+t))}else{const e=s.match(y);e&&(h="SERVICE",p=e[1],u=e[2],c={})}if((Array.isArray(u)?u:[u]).some((e=>e&&(0,f.isString)(e)&&e.trim())))if(a){const t=a[1];n[t]?n[t].fields.push(new T(p,null,c,u)):n[t]={type:p,index:e,key:h,properties:c,value:u,fields:[]}}else A(r,h,new T(p,e,c,u))}return Object.keys(n).forEach((e=>{const{key:t,index:i,type:a,value:s,properties:o,fields:l}=n[e];l.forEach((e=>{o[e.type]=e.value})),A(r,t,new T(a,i,o,s))})),function(e){const t={};return(0,c.default)(e,((e,r)=>{t[r]=(0,l.default)(e,(e=>e.index))})),t}(r)}function M(e){const t=(0,i.default)(e.formattedName.split(e.formattedShortName)),r=t.length?t[0].trim():void 0,n=r?e.formattedShortName:e.formattedName;return`${b(r)};${b(n)};;;`}function O(e){return I(e.map((e=>e.displayName)))}function I(e){const t=e.find((e=>!!e));return e.length?t?1===e.length?t:h.default.t(869,{contactName:t,count:e.length-1,_plural:e.length-1}):h.default.t(871,{count:e.length,_plural:e.length}):h.default.t(870)}t.Field=T},75426:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var a=i(r(48926)),s=i(r(2525)),o=n(r(12641));const l="finish",c="stop",d=new Map;function u(){return(u=(0,a.default)((function*(e,t,r){if(!e)return;for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];if("string"==typeof t&&(t===l||t===c))return(0,o.default)(e,t,r,...i);p(e,(e=>{const t=d.get(e)||0;d.set(e,t+1)}));const s=t;if("object"==typeof r&&"object"==typeof s){let e;"function"==typeof r.begin&&(e=r.begin),r.begin=t=>{for(const e in s){const r=s[e];Array.isArray(r)&&(0,o.hook)(t,e,r[1])}e&&e(t)}}const u=yield(0,o.default)(e,t,r,...i);return p(u,(e=>{const t=(d.get(e)||1)-1;0===t?(d.delete(e),h(e)):d.set(e,t)})),u}))).apply(this,arguments)}function p(e,t){Array.isArray(e)?e.forEach((e=>{t(e)})):t(e)}function h(e){var t;const r=o.default.Utilities.data(e),{delayedElements:n}=o.default.State;(0,s.default)(n,((t,r)=>{"count"!==r&&(t!==e&&t||delete n[r])})),(null==r||null===(t=r.velocity)||void 0===t?void 0:t.tweensContainer)&&(r.velocity.tweensContainer.element=null),o.default.Utilities.removeData(e,["fxqueue","velocity"])}},41956:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(81109)),s=n(r(6479)),o=n(r(57557)),l=n(r(41609)),c=r(67294),d=r(53175),u=n(r(70714)),p=r(88102),h=(i(r(64103)),r(29498)),f=r(50338),_=n(r(25170)),m=r(31515),g=n(r(75426)),y=r(85893);const E=["selector"],S="enter",v="leave",T="appear";class A extends c.Component{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.setBusy=()=>{this.busyId=f.UIBusyTasks.setBusy(this.busyId),this.isBusy||(this.isBusy=!0,p.Cmd.setUiBusy(!0,"vtg"))},this.unsetBusy=()=>{null!=this.busyId&&(f.UIBusyTasks.clearBusy(this.busyId),delete this.busyId),this.isBusy&&(this.uiBusy=!1,p.Cmd.setUiBusy(!1,"vtg"))},this.componentWillAppear=e=>{this.animateIfEnabled(T,e)},this.componentWillEnter=e=>{this.animateIfEnabled(S,e)},this.componentWillLeave=e=>{this.animateIfEnabled(v,e)},this.getUnmountSignal=()=>(this._controller||(this._controller=new u.default,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort();const t=(0,h.forbiddenFindDOMNode)(this,window.Node);(0,g.default)(t,"finish")}_getTransition(){const{transitionName:e}=this.props;if(e&&!_.default[e])throw __LOG__(4,void 0,new Error,!0)` ${e} wasn't found in VelocityTransitionGroupChild transitions.`,SEND_LOGS("transition-name"),new Error("Invalid transitionName");return e?_.default[e]:_.default.default}getTransitionNodes(e,t){let r=t;Array.isArray(r)||(r=[r]);const n={};return r.map((t=>{const{selector:r}=t,i=(0,s.default)(t,E);let o;return o=r?r in n?n[r]:n[r]=e?Array.from(e.querySelectorAll(r)):void 0:e,(0,l.default)(o)?void 0:(0,a.default)({nodes:o},i)})).filter(Boolean)}blockAction(e){e.preventDefault(),e.stopPropagation()}animateTransitions(e){let t=e;const{delay:r=0,children:n,onAnimationComplete:i}=this.props,{staggerDelay:a}=c.Children.only(n);t===T&&(t=S);const s=this._getTransition(),l=s[t];if(!s||!l)return Promise.resolve();const d=(0,o.default)(s,v,S),u=(0,h.forbiddenFindDOMNode)(this,window.Node),p=this.getTransitionNodes(u,l);return t===v&&(null==u?void 0:u.setAttribute)&&u.addEventListener&&(u.setAttribute("pointerEvents","none",u),u.addEventListener("keypress",this.blockAction,!0),u.addEventListener("keydown",this.blockAction,!0)),Promise.all(p.map((e=>{const{nodes:t,props:n,easing:i,duration:s,delay:o,stagger:l,drag:c}=e;return(0,g.default)(t,n,{easing:i||d.easing||"easeInSine",duration:s||d.duration||0,delay:a||r||o||d.delay||0,queue:d.queue||!1,stagger:l||!1,drag:c||!1})}))).finally((()=>{d.cleanOnComplete&&t===S&&p.forEach((e=>{const t=e.nodes;(Array.isArray(t)?t:[t]).forEach((e=>e.removeAttribute("style")))})),t===v&&(null==u?void 0:u.removeEventListener)&&(u.removeEventListener("keypress",this.blockAction,!0),u.removeEventListener("keydown",this.blockAction,!0)),i&&i()}))}animateIfEnabled(e,t){let r=!1;switch(e){case S:r=this.props.transitionEnter;break;case v:r=this.props.transitionLeave;break;case T:r=this.props.transitionAppear}r?(this.setBusy(),this.animateTransitions(e).finally((()=>{this.unsetBusy()})).then((()=>{this.getUnmountSignal().aborted||(0,m.isFunction)(t)&&t()}))):t()}rejectOnUnmount(){return this._rejectPromise||(this._rejectPromise=new Promise(((e,t)=>{this._rejector=t})),this._rejectPromise.catch((()=>{}))),this._rejectPromise}render(){return c.Children.only(this.props.children)}}A.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},A.displayName="VelocityTransitionGroupChild";class C extends c.Component{constructor(){super(...arguments),this._wrapChild=e=>(0,y.jsx)(A,(0,a.default)((0,a.default)({},this.props),{},{children:e}))}render(){return(0,y.jsx)(d.TransitionGroup,{childFactory:this._wrapChild,className:this.props.className,transitionName:this.props.transitionName,component:this.props.component,children:this.props.children})}}t.default=C,C.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},C.displayName="VelocityTransitionGroup"},10911:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e){case i.default.VERIFIED_LEVEL.HIGH:return"high";case i.default.VERIFIED_LEVEL.LOW:return"low";case i.default.VERIFIED_LEVEL.UNKNOWN:default:return"unknown"}};var i=n(r(69618))},7388:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.waitForOnlineNaive=function(){return o.apply(this,arguments)};var i=n(r(48926)),a=r(13959),s=n(r(49036));function o(){return(o=(0,i.default)((function*(){return yield(0,s.default)(self,"online"),(0,a.delayMs)(100)}))).apply(this,arguments)}},96984:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.colorExistsInTheme=function(e,t){const r=p(t);return e===i.default.DEFAULT_CHAT_WALLPAPER||r.some((t=>t.toUpperCase()===e.toUpperCase()))},t.getDoodleAssetName=function(e,t){if(a.ServerProps.wallpapersV2&&"light"===t&&e!==i.default.DEFAULT_CHAT_WALLPAPER){const r=h(e,t,"doodle");if(r)return`data-asset-chat-background-${r}`}let r=`data-asset-chat-background-${t}`;"light"===t&&e===i.default.DEFAULT_CHAT_WALLPAPER&&(r="data-asset-chat-background-dark");return r},t.getDoodleOpacity=function(e,t){if(a.ServerProps.wallpapersV2){const r=h(e,t,"opacity");if(r)return r}if("light"===t&&e===i.default.DEFAULT_CHAT_WALLPAPER)return"0.4";return"0.06"},t.getWallpaperColorPropValue=h,t.getWallpaperColors=p,t.invertTransparentWallpaperColors=function(e,t){if(a.ServerProps.wallpapersV2)return"light"===e&&t!==i.default.DEFAULT_CHAT_WALLPAPER&&!!h(t,e,"invertTransparentWallpaperColors");{const r=o.includes(t);return!!p(e).includes(t)&&(r?"light"===e:"dark"===e)}},t.toggleWallpaperColor=function(e,t){const r=p(t);if(e===i.default.DEFAULT_CHAT_WALLPAPER)return i.default.DEFAULT_CHAT_WALLPAPER;if(a.ServerProps.wallpapersV2){const n=r.findIndex((t=>t.toUpperCase()===e.toUpperCase()));if(-1!==n)return"light"===t?u[n]:d[n]}return e};var i=n(r(69618)),a=r(64551);const s=["#ccebdc","#aed8c7","#7acba5","#c7e9eb","#a9dbd8","#68d5d9","#6ec3d4","#f2dad5","#f2d5e1","#fbcad2","#ffa7a8","#cbdaec","#d7d3eb","#e5c0eb","#d0deb1","#dee0b4","#e6dfa8","#f7e9a8","#ffd1a4","#ff8a8c","#ff5978","#f56056","#dc6e4f","#e6e365","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#dee3e9","#d9dade","#c0c1c4","#7e90a3","#55626f","#243640","#162127"],o=["#ff8a8c","#ff5978","#f56056","#dc6e4f","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#7e90a3","#55626f","#243640","#162127"],l={"#BBE4E5":{doodle:"dark",opacity:"0.42"},"#AED8C7":{doodle:"dark",opacity:"0.3"},"#7ACBA5":{doodle:"dark",opacity:"0.26"},"#CBDAEC":{doodle:"dark",opacity:"0.42"},"#66D2D5":{doodle:"dark",opacity:"0.26"},"#63BDCF":{doodle:"dark",opacity:"0.26"},"#D6D0F0":{doodle:"dark",opacity:"0.36"},"#CECECE":{doodle:"dark",opacity:"0.36"},"#D1DABE":{doodle:"dark",opacity:"0.36"},"#E6E1B1":{doodle:"dark",opacity:"0.42"},"#FEEFA9":{doodle:"light",opacity:"0.06"},"#FED297":{doodle:"dark",opacity:"0.42"},"#FD9A9B":{doodle:"dark",opacity:"0.26"},"#FD6769":{doodle:"dark",opacity:"0.26"},"#FB4668":{doodle:"dark",opacity:"0.26"},"#922040":{doodle:"dark",opacity:"0.17",invertTransparentWallpaperColors:!0},"#DC6E4F":{doodle:"dark",opacity:"0.2"},"#644D52":{doodle:"dark",opacity:"0.13",invertTransparentWallpaperColors:!0},"#517E7E":{doodle:"dark",opacity:"0.13"},"#3190BB":{doodle:"dark",opacity:"0.13"},"#35558A":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#55626F":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#1D2326":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#301E34":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#ECF0F1":{doodle:"light",opacity:"0.06"},"#FFFEA2":{doodle:"light",opacity:"0.06"},"#E7E8D2":{doodle:"light",opacity:"0.06"}},c={"#0F2424":{doodle:"dark",opacity:"0.05"},"#12261F":{doodle:"dark",opacity:"0.055"},"#11241C":{doodle:"dark",opacity:"0.055"},"#111E27":{doodle:"dark",opacity:"0.06"},"#0F2224":{doodle:"dark",opacity:"0.06"},"#0E2125":{doodle:"dark",opacity:"0.055"},"#1F1D25":{doodle:"dark",opacity:"0.06"},"#212121":{doodle:"dark",opacity:"0.055"},"#1F211C":{doodle:"dark",opacity:"0.055"},"#23231B":{doodle:"dark",opacity:"0.055"},"#262419":{doodle:"dark",opacity:"0.055"},"#261F17":{doodle:"dark",opacity:"0.055"},"#261717":{doodle:"dark",opacity:"0.055"},"#260F10":{doodle:"dark",opacity:"0.06"},"#260A10":{doodle:"dark",opacity:"0.07"},"#19050B":{doodle:"dark",opacity:"0.075"},"#21100C":{doodle:"dark",opacity:"0.07"},"#0F0C0C":{doodle:"dark",opacity:"0.065"},"#101919":{doodle:"dark",opacity:"0.06"},"#0A1D25":{doodle:"dark",opacity:"0.055"},"#0D1523":{doodle:"dark",opacity:"0.065"},"#0D0F11":{doodle:"dark",opacity:"0.07"},"#0A0C0D":{doodle:"dark",opacity:"0.07"},"#110B12":{doodle:"dark",opacity:"0.07"},"#1E1F1F":{doodle:"dark",opacity:"0.055"},"#262618":{doodle:"dark",opacity:"0.055"},"#23231F":{doodle:"dark",opacity:"0.055"}},d=Object.keys(l),u=Object.keys(c);function p(e){return a.ServerProps.wallpapersV2?"light"===e?d:u:s}function h(e,t,r){const n="light"===t?l:c;for(const t in n)if(t.toUpperCase()===e.toUpperCase())return n[t][r];return null}},24465:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Watchdog=void 0,t.fibonacci=function(e,t,r){if("number"==typeof r){const n=r;return function(r){switch(r.failGeneration){case 0:return Math.min(n,t);case 1:return Math.min(n,e+t);default:return Math.min(n,r.waitDuration+r.prevWaitDuration)}}}return function(r){switch(r.failGeneration){case 0:return t;case 1:return e+t;default:return r.waitDuration+r.prevWaitDuration}}};var n=r(57319),i=r(11290);class a extends i.BaseModel{constructor(){super(...arguments),this.failGeneration=(0,i.session)(0),this.ts=(0,i.session)(),this.waitDuration=(0,i.session)(0),this.prevWaitDuration=(0,i.session)(0),this.jitter=(0,i.session)(0),this.shiftTimer=(0,i.session)(),this.waitAlgorithm=(0,i.session)(),this.onActivated=(0,i.session)(),this.onDeactivated=(0,i.session)(),this.onFed=(0,i.session)(),this.onTimeout=(0,i.session)()}initialize(){this.shiftTimer=new n.ShiftTimer((()=>o.call(this)))}activate(){this.shiftTimer.isScheduled()||(this._run(!0),this.onActivated&&this.onActivated(this))}deactivate(){this.shiftTimer.isScheduled()&&(this.shiftTimer.cancel(),this.onDeactivated&&this.onDeactivated(this))}feed(){this.shiftTimer.isScheduled()&&(this._run(!0),this.onFed&&this.onFed(this))}forceTimeout(e){this.shiftTimer.isScheduled()?null!=e&&0!==e?(this.shiftTimer.onOrBefore(e),this.ts=this.shiftTimer.ts):this.shiftTimer.forceRunNow():__LOG__(3)`forced non-running watchdog!`}poke(){this.forceTimeout.apply(this,arguments)}resetGeneration(){this.failGeneration=0}_run(e){e&&this.resetGeneration();const t=this.waitAlgorithm(this),r=this.jitter*Math.random()*t;this.shiftTimer.debounce(t+r),this.set({ts:this.shiftTimer.ts,waitDuration:t,prevWaitDuration:this.waitDuration})}}const s=(0,i.defineModel)(a);function o(){const e=this.onTimeout;if(!e)return __LOG__(3,void 0,void 0,!0)`Watchdog timed-out without handler!`,void SEND_LOGS("watchdog-no-handler");this.failGeneration++,e(this)&&this._run(!1)}t.Watchdog=s},25906:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketModel=t.STATE=void 0,t.open=function(e){let t;try{t=new T(e)}catch(e){return __LOG__(3)`WatchedSocket error constructing: ${e}`,_.default.reject(e)}return new _.default(t,(function(e,t){this.id=(T.numSocketsAttempted++).toString(),__LOG__(2)`WatchedSocket opening socket ${this.id}`;const r=(0,p.openSocket)(this.url);r.binaryType="arraybuffer",r.onopen=e,r.onclose=r.onerror=function(e){t(new d.SocketError(e))},this.socket=r})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocket error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocket opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,g.default)().then(this.close.bind(this,!1,"offline")).catch((0,s.catchAbort)((()=>{}))),this._pingTimer.onOrAfter(A()),this.state=S.OPEN,this}))};var a=i(r(82569)),s=r(89385),o=r(38284),l=r(57319),c=r(11290),d=n(r(64103)),u=r(64457),p=r(86212),h=i(r(84426)),f=i(r(26445)),_=i(r(59402)),m=r(65127),g=i(r(14706));const y=18e4;function E(e,t){let r=-1;const n=e.find((e=>(r++,t(e))));return void 0===n?void 0:{index:r,value:n}}const S={OPEN:"OPEN",CLOSED:"CLOSED"};t.STATE=S;class v extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.session)(),this.url=(0,c.session)(),this.onmessage=(0,c.session)(),this.onactivity=(0,c.session)(),this.timeSkew=(0,c.session)(),this.msgParser=(0,c.session)(),this.state=(0,c.session)(),this.error=(0,c.session)(),this.socket=(0,c.session)(),this.isQueueing=(0,c.session)(!0),this.maxQueueSize=(0,c.session)(),this.messageQueue=(0,c.session)(),this._offlineListener=(0,c.session)(),this._msgListeners=(0,c.session)(),this._pingTimer=(0,c.session)(),this._killTimer=(0,c.session)()}initialize(){this._msgListeners=[],this.messageQueue=[],this.safariSplitter=m.UA.isSafari?new h.default(this):null,this._pingTimer=new l.ShiftTimer((()=>this._ping())),this._killTimer=new l.ShiftTimer((()=>this._killSocket())),u.jsHaltDetector.on(u.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>y&&(__LOG__(2)`js halt longer than ${y} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_ping(){this.send("?,,"),this._killTimer.onOrAfter(C())}_killSocket(){__LOG__(3)`WatchedSocket ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.set({onactivity:void 0,onmessage:void 0})}send(e){this.cast(e),this._pingTimer.cancel(),this._killTimer.onOrAfter(C())}cast(e){if(this.state!==S.OPEN)throw new d.SocketNotOpen(this.state);if("string"==typeof e&&/\[object ArrayBuffer\]/.test(e))throw new TypeError("converted ArrayBuffer to string prematurely");if(this.safariSplitter)this.safariSplitter.send(e);else try{this.socket.send(e)}catch(e){__LOG__(3,void 0,void 0,!0)`exception sending: ${e}\n${e.stack}`,SEND_LOGS("send-exception"),this.close(!0,e)}}partingSend(e,t,r){const n=this,i=this.socket,a=new Promise((function(a){function s(){a(void 0)}i.onclose=s,i.onerror=s,i.onmessage=function(e){const t=e.data;r&&!r(t)||a(t)},n.send(t),n._onCloseOrError(!1,e)}));return(0,o.promiseTimeout)(a,2e4,"paringSendTimeout").catch((()=>{})).finally((function(){i.onclose=void 0,i.onerror=void 0,i.onmessage=void 0,i.readyState===WebSocket.OPEN&&i.close()}))}close(e,t){const r=this.socket;let n;if(this._onCloseOrError(e,t||"unspecified"),r&&(n=r.readyState,n===WebSocket.CONNECTING||n===WebSocket.OPEN))try{r.close()}catch(e){__LOG__(3)`WatchedSocket:exception closing: ${e}\n${e.stack}`}}_onMessage(e){this._pingTimer.onOrAfter(A()),this._killTimer.cancel();const t=e.data;if("string"==typeof t&&"!"===t.charAt(0)){const e=parseInt(t.slice(1),10);return e==e&&(this.timeSkew=Date.now()-e),void(this.onactivity&&this.onactivity())}const r=this.msgParser(e);this.onactivity&&this.onactivity(r),this._onParsedMsg(r)}_onParsedMsg(e){const t=E(this._msgListeners,(function(t){return!t.filter||t.filter(e)}));t?(this._msgListeners.splice(t.index,1),t.value.removed=!0,t.value.promise.force(e)):this.isQueueing?(__LOG__(3)`watchedSocket:enqueued`,this.messageQueue.push(e),void 0!==this.maxQueueSize&&this.messageQueue.length>this.maxQueueSize&&this.close(!0,"Queue Overflow")):this.onmessage?this.onmessage(e):__LOG__(3)`watchedSocket:dropped!`}_onCloseOrError(e,t){if(this.state===S.CLOSED)return;this.safariSplitter&&this.safariSplitter.cancel(),this.socket&&(this.socket.onclose=void 0,this.socket.onerror=void 0,this.socket.onmessage=void 0),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,u.jsHaltDetector.off(u.JS_HALT_EVENT,this._onJsHalt,this),this._pingTimer.cancel(),this._killTimer.cancel(),this.set({state:S.CLOSED,error:e?t:void 0});const r=this._msgListeners,n=e?new d.SocketError(t):new d.SocketClosed(t);this._msgListeners=[],r.forEach((function(e){e.removed=!0,e.promise.cancel(n)}))}holdMessages(e){const t=this.isQueueing&&void 0!==e&&this.messageQueue>e;this.set({isQueueing:!0,messageQueue:this.messageQueue||[],maxQueueSize:e}),t&&this.close(!0,"Queue Overflow")}releaseMessages(e){if(!this.isQueueing)return void __LOG__(3)`WatchedSocket:releaseMessages not queued!`;const t=this.messageQueue;this.set({isQueueing:!1,messageQueue:[]}),e?t.length>0&&__LOG__(3)`WatchedSocket:releaseMessages dropping ${t.length} messages.`:t.forEach((e=>{this._onParsedMsg(e)}))}nextMessage(e){if(this.state!==S.OPEN)return _.default.reject(new d.SocketNotOpen(this.state)).cancellable();let t;if(t=e instanceof f.default?e.test.bind(e):e,this.isQueueing){let e;if(t){const r=E(this.messageQueue,t);r&&(e=r.value,this.messageQueue.splice(r.index,1))}else this.messageQueue.length>0&&(e=this.messageQueue.shift());if(e)return _.default.resolve(e).cancellable()}const r=(new _.default).cancellable().forceable(),n={removed:!1,filter:t,promise:r};return this._msgListeners.push(n),r.catch((()=>{n.removed||(this._msgListeners=(0,a.default)(this._msgListeners,n))})),r}}const T=(0,c.defineModel)(v);function A(){return 2e4*Math.random()+1e4}function C(){return 7e4*Math.random()+2e4}t.WatchedSocketModel=T,T.numSocketsAttempted=0},84727:(e,t,r)=>{"use strict";var n=r(95318),i=r(20862);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketMD=t.STATE=void 0,t.open=function(e){let t;try{t=new _(e)}catch(e){return __LOG__(3)`WatchedSocketMD error constructing: ${e}`,u.default.reject(e)}return new u.default(t,(function(e,t){_.numSocketsAttempted++,this.id=_.numSocketsAttempted,__LOG__(2)`WatchedSocketMD opening socket ${this.id}`;const r=(0,d.openSocket)(this.url);r.binaryType="arraybuffer",r.onopen=e,r.onclose=r.onerror=function(e){t(new l.SocketError(e))},this.socket=r})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocketMD error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocketMD opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,p.default)().then(this.close.bind(this,!1,"offline")).catch((0,a.catchAbort)((()=>{}))),this.state=f.OPEN,this}))};var a=r(89385),s=r(8584),o=r(57319),l=i(r(64103)),c=r(64457),d=r(86212),u=n(r(59402)),p=n(r(14706));const h=18e4,f={OPEN:"OPEN",CLOSED:"CLOSED"};t.STATE=f;class _{constructor(e){this.onError=null,this.dataToSend=new s.Binary,this.url=e,this._killTimer=new o.ShiftTimer((()=>this._killSocket())),c.jsHaltDetector.on(c.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>h&&(__LOG__(2)`js halt longer than ${h} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_killSocket(){__LOG__(3)`WatchedSocketMD ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.socket.onmessage=m}close(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;const r=this.socket;let n;if(this._onCloseOrError(e,t||"unspecified"),r&&(n=r.readyState,n===WebSocket.CONNECTING||n===WebSocket.OPEN))try{r.close()}catch(e){__LOG__(3)`WatchedSocketMD:exception closing: ${e}\n${e.stack}`}}requestSend(){if(this.state!==f.OPEN)throw new l.SocketNotOpen(this.state);if(this.dataToSend.size())try{this.socket.send(this.dataToSend.readByteArray())}catch(e){__LOG__(3)`exception sending: ${e}\n${e.stack}`,this.close(!0,e)}}_onMessage(e){if(!(e.data instanceof ArrayBuffer))throw new TypeError("expected ArrayBuffer from the socket");if(this.onData){(0,this.onData)(new Uint8Array(e.data))}}_onCloseOrError(e,t){this.state!==f.CLOSED&&(this.socket&&(this.socket.onclose=m,this.socket.onerror=m,this.socket.onmessage=m),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,c.jsHaltDetector.off(c.JS_HALT_EVENT,this._onJsHalt,this),this._killTimer.cancel(),this.state=f.CLOSED,this.error=e?t:void 0,null!=this.onClose&&this.onClose())}}function m(){}t.WatchedSocketMD=_,_.numSocketsAttempted=0},77591:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebdDrop=t.ServerStatusCodeError=t.Server5xxDrop=t.LogoutDrop=t.EphemeralDrop=t.E507=t.E499=t.E404=t.E401=t.ConventionViolationDrop=t.CatalogEditServerError=t.BrowserReplacedDrop=void 0,t.attachErrorLogger=function(e,t,r){return e.catch((e=>{throw __LOG__(4,!0,new Error,!0)`${r||t}, error: ${e}`,SEND_LOGS(t),e}))};var n=r(40265);class i extends((0,n.customError)("ServerStatusCodeError")){constructor(e,t){super(t),this.status=e,this.statusCode=e}}t.ServerStatusCodeError=i;class a extends((0,n.customError)("ServerStatusCodeError")){constructor(e,t,r){super(r),this.errors=t,this.status=e,this.statusCode=e}}t.CatalogEditServerError=a;class s extends((0,n.customError)("E401",!0,i)){constructor(e){super(401,e)}}t.E401=s;class o extends((0,n.customError)("E404",!0,i)){constructor(e){super(404,e)}}t.E404=o;class l extends((0,n.customError)("E499",!0,i)){constructor(e){super(499,e)}}t.E499=l;class c extends((0,n.customError)("E507",!0,i)){constructor(e,t){super(507,e),this.backoff=Number.isNaN(t)?null:t}}t.E507=c;class d extends((0,n.customError)("WebdDrop")){}t.WebdDrop=d;class u extends((0,n.customError)("BrowserReplacedDrop",!0,d)){}t.BrowserReplacedDrop=u;class p extends((0,n.customError)("ConventionViolationDrop",!0,d)){}t.ConventionViolationDrop=p;class h extends((0,n.customError)("Server5xxDrop",!0,d)){}t.Server5xxDrop=h;class f extends((0,n.customError)("LogoutDrop",!0,d)){}t.LogoutDrop=f;class _ extends((0,n.customError)("EphemeralDrop",!0,d)){}t.EphemeralDrop=_},45044:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addWebpMetadata=function(e,t){const r=new Uint8Array(e);if(!(0,i.isExtendedFile)(r))throw new Error("Not extended");const o=function(e){const t=new TextEncoder,r=JSON.stringify(e),a=t.encode(r),o=function(e){return(0,n.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)("II"),new Uint8Array([42,0]),(0,i.numberToLittleEndian)(8),new Uint8Array([1,0]),(0,i.stringToUint8)("AW"),new Uint8Array([7,0]),(0,i.numberToLittleEndian)(e.byteLength),(0,i.numberToLittleEndian)(22),e])}(a),l=[s(i.Chunk.EXIF,o.byteLength),o];a.byteLength%2!=0&&l.push(new Uint8Array([0]));return(0,n.concatTypedArrays)(Uint8Array,l)}((0,a.toRawWebpMetadata)(t)),l=(0,n.concatTypedArrays)(Uint8Array,[r,o]);l.set((0,i.numberToLittleEndian)(l.byteLength-8),4);return l.buffer};var n=r(60977),i=r(63800),a=r(19353);function s(e,t){return(0,n.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)(e),(0,i.numberToLittleEndian)(t)])}},57905:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const r=new Uint8Array(e),n=null!==(t=(0,a.findWebpChunk)(r,a.Chunk.EXIF))&&void 0!==t?t:(0,a.findWebpChunk)(r,a.Chunk.XMP);if(null==n)return(0,i.default)(e);const s=r.slice(0,n.position),o=s.byteLength-a.CHUNK_HEADER_SIZE;return s.set((0,a.numberToLittleEndian)(o),a.FOUR),(0,i.default)(s)};var i=n(r(68138)),a=r(63800)},16185:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise(((t,r)=>{const n=new a.default;n.onerror=function(e){n.terminate(),r(new s.DecodeWebpResultsError("worker error",e))},n.onmessageerror=function(e){n.terminate(),r(new s.DecodeWebpResultsError("worker message error",e))},n.onmessage=e=>{n.terminate();const r=e.data;t(r)},n.postMessage({webpBuffer:e},[e])}))};var a=i(r(71597)),s=n(r(64103))},7030:(e,t,r)=>{"use strict";var n=r(20862),i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n){const{quality:i=90,ensureExtendedFormat:o=!1}=null!=n?n:{};return new Promise(((n,l)=>{const c=new a.default;c.onerror=function(e){c.terminate(),l(new s.EncodeWebpError("worker error",e))},c.onmessageerror=function(e){c.terminate(),l(new s.EncodeWebpError("worker message error",e))},c.onmessage=e=>{c.terminate(),n(e.data.blob)},c.postMessage({rgbaData:e,width:t,height:r,quality:i,ensureExtendedFormat:o})}))};var a=i(r(47282)),s=n(r(64103))},32433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWebpMetadata=function(e){const t=function(e){const t=new Uint8Array(e),r=(0,n.findWebpMetadata)(t);if(!r)return{};const{position:i,size:a}=r,s=new TextDecoder,o=t.slice(i,i+a),l=s.decode(o);try{return JSON.parse(l)}catch(e){return __LOG__(2)`Failed to parse emojis out of sticker, returning empty object.`,{}}}(e);return(0,i.toWebpMetadata)(t)};var n=r(63800),i=r(19353)},92108:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_LOOPS=t.MAX_DURATION=void 0,t.getTotalAnimationDuration=l,t.parseWebp=function(e){const t=new Uint8Array(e);if(!(0,o.isExtendedFile)(t))return __LOG__(2)`Sticker file not extended format.`,c;const{emojis:r,isFirstParty:n,isFromStickerMaker:d,stickerPackId:u,stickerPackName:p,stickerPackPublisher:h}=(0,s.getWebpMetadata)(e),f=(0,i.default)((0,i.default)({},c),{},{emojis:r,isFirstParty:n,isFromStickerMaker:d,stickerPackId:u,stickerPackName:p,stickerPackPublisher:h});if(!(0,o.isAnimatedWebp)(t))return f;let _,m=0,g=44;for(;(0,a.default)(t.slice(g,g+4),(0,o.stringToUint8)(o.Chunk.ANMF));){const e=g+20,r=t.slice(e,e+3);if(3!==r.length)return f;m+=(0,o.littleEndianToNumber)(r);const n=g+4,i=t.slice(n,n+4);if(4!==i.length)return f;g+=8+(0,o.littleEndianToNumber)(i),null==_&&(_=g)}const y=l(m);return(0,i.default)((0,i.default)({},f),{},{animationDuration:y,firstFrameLength:_,singleLoopDuration:m})};var i=n(r(81109)),a=n(r(63438)),s=r(32433),o=r(63800);t.MAX_LOOPS=3;function l(e){if(0===e)return 0;const t=Math.min(Math.floor(5e3/e),3);return Math.max(t,1)*e}t.MAX_DURATION=5e3;const c={animationDuration:0,singleLoopDuration:0,emojis:[],isFirstParty:!1,isFromStickerMaker:!1,stickerPackId:null,stickerPackName:null,stickerPackPublisher:null}},63800:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WEBP_HEADER_SIZE=t.FOUR=t.Chunk=t.CHUNK_HEADER_SIZE=void 0,t.findWebpChunk=o,t.findWebpMetadata=function(e){if(!l(e))return __LOG__(2)`Sticker file not extended format.`,null;if(null==TextDecoder)return null;const t=o(e,s.EXIF);if(!t)return null;const r=String.fromCharCode(0),n=new TextDecoder,i=e.slice(t.position,t.position+t.size),a=n.decode(i);let c,d;for(let e=a.length;e>0;--e)if(null==d&&"}"===a[e])d=e;else if(null!=d&&a[e]===r){c=e+1;break}if(null==c||null==d)return __LOG__(3)`JSON not found in sticker file`,null;return{position:t.position+c,size:d-c+1}},t.isAnimatedWebp=function(e){const t=new Uint8Array(e);return l(t)&&0!=(2&t[20])},t.isExtendedFile=l,t.littleEndianToNumber=c,t.numberToLittleEndian=function(e){const t=new i.Binary;return t.writeUint32(e,!0),t.readByteArray()},t.stringToUint8=d;var i=r(8584),a=n(r(63438));const s=r(54302)({VP8X:"VP8X",ANMF:"ANMF",EXIF:"EXIF",XMP:"XMP "});t.Chunk=s;t.WEBP_HEADER_SIZE=12;t.CHUNK_HEADER_SIZE=8;t.FOUR=4;function o(e,t){const r=d(t);let n=0;for(n+=12;n<e.byteLength;){const t=e.slice(n,n+8),i=t.slice(0,4);let s=c(t.slice(4,8));if(s%2!=0&&(s+=1),(0,a.default)(i,r))return{position:n,size:s+4+4};n+=8+s}return null}function l(e){const t=e.slice(12,16);return(0,a.default)(t,d(s.VP8X))}function c(e){return e.reduce(((e,t,r)=>e+(t<<8*r)),0)}function d(e){const t=new i.Binary;return t.writeString(e),t.readByteArray()}},19353:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FIELDS=t.DEFAULT_METADATA=void 0,t.toRawWebpMetadata=function(e){const t={};null!=e.isFirstParty&&(t[a.isFirstParty]=e.isFirstParty?1:0);null!=e.isFromStickerMaker&&(t[a.isFromStickerMaker]=e.isFromStickerMaker?1:0);null!=e.emojis&&(t[a.emojis]=e.emojis);null!=e.stickerPackId&&(t[a.stickerPackId]=e.stickerPackId);null!=e.stickerPackName&&(t[a.stickerPackName]=e.stickerPackName);null!=e.stickerPackPublisher&&(t[a.stickerPackPublisher]=e.stickerPackPublisher);null!=e.stickerPackPlayStoreLink&&(t[a.stickerPackPlayStoreLink]=e.stickerPackPlayStoreLink);null!=e.stickerPackAppleStoreLink&&(t[a.stickerPackAppleStoreLink]=e.stickerPackAppleStoreLink);return t},t.toWebpMetadata=function(e){const t=e[a.isFirstParty],r=e[a.isFromStickerMaker],n=e[a.emojis],o=e[a.stickerPackId],l=e[a.stickerPackName],c=e[a.stickerPackPublisher],d=e[a.stickerPackPlayStoreLink],u=e[a.stickerPackAppleStoreLink],p=(0,i.default)({},s);null!=t&&(p.isFirstParty=1===t);null!=r&&(p.isFromStickerMaker=1===r);null!=n&&Array.isArray(n)&&(p.emojis=n);null!=o&&(p.stickerPackId=o);null!=l&&(p.stickerPackName=l);null!=c&&(p.stickerPackPublisher=c);null!=d&&(p.stickerPackPlayStoreLink=d);null!=u&&(p.stickerPackAppleStoreLink=u);return p};var i=n(r(81109));const a={isFirstParty:"is-first-party-sticker",isFromStickerMaker:"is-from-sticker-maker",emojis:"emojis",stickerPackId:"sticker-pack-id",stickerPackName:"sticker-pack-name",stickerPackPublisher:"sticker-pack-publisher",stickerPackPlayStoreLink:"android-app-store-link",stickerPackAppleStoreLink:"ios-app-store-link"};t.FIELDS=a;const s={isFirstParty:!1,isFromStickerMaker:!1,emojis:[],stickerPackId:null,stickerPackName:null,stickerPackPublisher:null,stickerPackPlayStoreLink:null,stickerPackAppleStoreLink:null};t.DEFAULT_METADATA=s},39546:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(69618)),a=r(31515);const s=/(?:^([^.:@]+))(?:\.([0-9]{1,2}))?(?:\:([0-9]{1,2}))?@(s\.whatsapp\.net|c\.us|g\.us|broadcast|call|b\.whatsapp\.net)$/i,o=/^([1-9][0-9]{14})(?:\.([0-9]{1,2}))?(?:\:([0-9]{1,2}))?@(lid)$/,l=["name","short","notify"];class c{constructor(e,t){var r;let{intentionallyUsePrivateConstructor:n}=t;if(!n)throw new Error("You should use WidFactory.createWid() instead of the Wid constructor. If you absolutely must use the constructor, pass {intentionallyUsePrivateConstructor: true} as a second parameter.");const i=null!==(r=e.match(s))&&void 0!==r?r:e.match(o);if(null==i)throw new Error(`wid error: invalid wid: ${e}`);const a=[],l=i[1],c=i[2],d=i[3],u=i[4].toLowerCase();let p;switch(u){case"s.whatsapp.net":p="c.us";break;default:p=u}if(this.server=p,this.user=l,a.push(this.user),null!=c&&""!==c){if("c.us"!==this.server)throw new Error(`wid error: wrong server for wid with agent present: ${e}`);const t=parseInt(c,10);if(isNaN(t))throw new Error(`wid error: NaN agent: ${c} wid: ${e}`);if(t>255)throw new Error(`wid error: agent>255 : ${t} wid: ${e}`);t&&(a.push("."),a.push(t),this.agent=t)}if(d){if("c.us"!==this.server&&"lid"!==this.server)throw new Error(`wid error: wrong server for wid with device present: ${e}`);const t=parseInt(d,10);if(isNaN(t))throw new Error(`wid error: NaN device: ${d} wid: ${e}`);if(t>255)throw new Error(`wid error: device>255 : ${t} wid: ${e}`);t&&(a.push(":"),a.push(t),this.device=t)}a.push("@"),a.push(this.server),this._serialized=a.join("")}getUserPartForLog(){if(this.isGroup()){const e=this.user.split("-");if(2===e.length){const[t,r]=e;return`${t.slice(-4)}-${r}`}}return this.user.slice(-4)}toString(e){if(e){let t,r;const n=e.legacy&&"c.us"===this.server?"s.whatsapp.net":this.server;e.formatFull?(t=`.${this.agent||0}`,r=`:${this.device||0}`):(t=null!=this.agent&&0!==this.agent?`.${this.agent}`:"",r=null!=this.device&&0!==this.device?`:${this.device}`:"");const i=e.forLog?this.getUserPartForLog():this.user;if(e.formatFull||e.legacy&&"c.us"===this.server||e.forLog)return[i,t,r,"@",n].join("")}return this._serialized}toLogString(){return this.toString({forLog:!0,legacy:!1})}toJid(){return this.toString({legacy:!0})}getSignalAddress(){const e=null!=this.agent&&0!==this.agent?`_${this.agent}`:"",t=null!=this.device&&0!==this.device?`:${this.device}`:"";return[this.user,e,t].join("")}getDeviceId(){const e=this.device;return null==e?0:e}equals(e){return e instanceof c&&this.toString()===e.toString()}isLessThan(e){return e instanceof c&&this.toString()<e.toString()}isGreaterThan(e){return e instanceof c&&this.toString()>e.toString()}isCompanion(){return null!=this.device&&this.device!==i.default.DEVICE.PRIMARY_DEVICE}isUser(){return"c.us"===this.server}isUserNotPSA(){return this.isUser()&&!this.isPSA()}isBroadcast(){return"broadcast"===this.server}isOfficialBizAccount(){return this.toString()===i.default.OFFICIAL_BIZ_WID}isGroup(){return"g.us"===this.server}isGroupCall(){return"call"===this.server}isServer(){return"server"===this.user.toLowerCase()&&"c.us"===this.server}isPSA(){return"0"===this.user&&"c.us"===this.server}isStatusV3(){return"status"===this.user.toLowerCase()&&"broadcast"===this.server}toJSON(){return this.toString()}static isXWid(e,t){return(0,a.isString)(t)?t.split("@")[1]===e:t instanceof c?t.server===e:(void 0!==t&&__LOG__(2)`wid:isXWid called on nonstring: + ${String(t)}`,!1)}static isUser(e){return c.isXWid("c.us",e)}static isBroadcast(e){return c.isXWid("broadcast",e)}static isGroup(e){return c.isXWid("g.us",e)}static isGroupCall(e){return c.isXWid("call",e)}static isWid(e){return(0,a.isString)(e)?s.test(e)||o.test(e):e instanceof c}static canBeWid(e){return!e||!l.includes(e)}static isServer(e){return(0,a.isString)(e)?e.toLowerCase()===i.default.SERVER_WID:e instanceof c&&e.isServer()}static isPSA(e){return(0,a.isString)(e)?e.toLowerCase()===i.default.PSA_WID:e instanceof c&&e.isPSA()}static isStatusV3(e){return(0,a.isString)(e)?e.toLowerCase()===i.default.STATUS_WID:e instanceof c&&e.isStatusV3()}static isOfficialBizAccount(e){return(0,a.isString)(e)?e.toLowerCase()===i.default.OFFICIAL_BIZ_WID:e instanceof c&&e.isOfficialBizAccount()}static user(e){return(0,a.isString)(e)?e.split("@")[0]:e instanceof c?e.user:void 0}static equals(e,t){return e instanceof c||t instanceof c?e instanceof c&&e.equals(t):e===t}static isLessThan(e,t){return e instanceof c&&t instanceof c&&e.toString()<t.toString()}static isGreaterThan(e,t){return e instanceof c&&t instanceof c&&e.toString()>t.toString()}}t.default=c},39938:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e){let t;if(e instanceof l.default?t=e.user:(0,o.isString)(e)&&(t=e.split("@")[0]),t){const e=t;return s.default.isRTL()?s.default.isolateLTR(c(e)):c(e)}}return""};var i=n(r(88306)),a=r(40277),s=n(r(43725)),o=r(31515),l=n(r(39546));const c=(0,i.default)((e=>"Server"===e?e:(0,a.formatPhone)(e)))},58021:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceWid=l,t.createDeviceWidFromUserAndDevice=function(e,t){return l(`${e}:${t}@c.us`)},t.createUserWid=c,t.createWid=o,t.createWidFromWidLike=function(e){return o("string"==typeof e?e:e._serialized)},t.isWidlike=function(e){return!!e&&(!!a.default.isWid(e)||!(!e||"object"!=typeof e||!a.default.isWid(e._serialized)))},t.toChatWid=function(e){if(e.isUser())return d(e);return e},t.toUserWid=d;var i=r(31515),a=n(r(39546)),s=n(r(19037));function o(e){let t;return(null===s.default||void 0===s.default?void 0:s.default.cache)?(t=s.default.cache[e],t||(t=new a.default(e,{intentionallyUsePrivateConstructor:!0}),s.default.cache[e]=t)):t=new a.default(e,{intentionallyUsePrivateConstructor:!0}),t}function l(e){return o(e)}function c(e,t){let r;if(r=(0,i.isString)(e)&&(e.endsWith("@c.us")||e.endsWith("@s.whatsapp.net"))?e:`${e}@${t||"c.us"}`,r=o(r),!(null!=r.device&&0!==r.device||null!=r.agent&&0!==r.agent))return r;throw __LOG__(4,void 0,new Error)`createUserWid: ${e} is not a valid user jid`,new Error("createUserWid is called with invalid user string")}function d(e){if(!e.isUser())throw new Error("asUserWid: wid is not a user wid");return null!=e.device&&0!==e.device||null!=e.agent&&0!==e.agent?c(e.user):e}},53967:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.widToDeviceJid=function(e){const t=i(e);if("device"===t.jidType)return t.deviceJid;if("user"===t.jidType)return(0,n.defaultDeviceJidForUser)(t.userJid);if("lidDevice"===t.jidType)return t.lidDeviceJid;if("lidUser"===t.jidType)return(0,n.defaultLidDeviceJidForLidUserJid)(t.lidUserJid);throw __LOG__(4,void 0,new Error)`widToDeviceJid: "${e.toString()}" is not a DeviceJid`,new Error("widToDeviceJid: can not convert wid to DeviceJid")},t.widToJidWithType=i;var n=r(19797);function i(e){const t=e.toJid(),r=(0,n.interpretAndValidateJid)(t);if("unknown"===r.jidType)throw __LOG__(4,void 0,new Error)`widToJidWithType: "${t}" is not a valid jid`,new Error("widToJidWithType: unknown jid type");return r}},64386:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(89385),a=n(r(84644)),s=r(2541);const o={GET:"GET",POST:"POST",HEAD:"HEAD",PUT:"PUT"};function l(e,t){for(const r in t)e.setRequestHeader(r,t[r])}function c(e,t,r,n,c,d,u){const p=new XMLHttpRequest,h=new Promise(((n,i)=>{if(p.onload=function(e){4===p.readyState?n(p):(__LOG__(4,void 0,new Error)`xhr.request:onload`,i(e))},p.onerror=e=>{__LOG__(4,void 0,new Error)`xhr.request:onerror`,i(e)},p.ontimeout=e=>{__LOG__(4,void 0,new Error)`xhr.request:ontimeout`,i(e)},d&&(p.onprogress=d),p.onabort=e=>{__LOG__(4,void 0,new Error)`xhr.request:onabort`,i(e)},r instanceof FormData)p.open(t||o.POST,e,!0),c&&(p.responseType=c),u&&l(p,u),p.send(r);else if(r instanceof Object){const n=s.URL.build(e,r);p.open(t||o.GET,n,!0),c&&(p.responseType=c),u&&l(p,u),p.send()}else p.open(t||o.GET,e,!0),c&&(p.responseType=c),u&&l(p,u),p.send()})),f=(0,a.default)(h,n).cancellable();return f.catch((0,i.catchAbort)((()=>{p.abort()}))).catch((()=>{})),f}var d={head:function(e,t){return c(e,o.HEAD,null,t)},get:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;return c(e,o.GET,null,n,t,void 0,r)},post:function(e,t,r){return c(e,o.POST,t,r)},request:c,VERB:o,RESP_TYPE:{ARRAY_BUFFER:"arraybuffer",BLOB:"blob",JSON:"json"}};t.default=d},57291:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[];for(const r of e)null!=r&&t.push(r);return t}},54057:(e,t,r)=>{e.exports=r.p+"img/bg-chat-tile-dark_a4be512e7195b6b733d9110b408f075d.png"},17498:(e,t,r)=>{e.exports=r.p+"img/bg-chat-tile-light_04fcacde539c58cca6745483d4858c52.png"},92256:(e,t,r)=>{e.exports=r.p+"img/f00_50f7c47f611e65a746f1d8328172af4c.png"},7151:(e,t,r)=>{e.exports=r.p+"img/f01_3d1e81d38917ed4427168024350d8df6.png"},29449:(e,t,r)=>{e.exports=r.p+"img/f02_c83a3786caa656cdcea06396bbc6c1fc.png"},94719:(e,t,r)=>{e.exports=r.p+"img/f03_dc76f32180586199d7e1872dd004832c.png"},83004:(e,t,r)=>{e.exports=r.p+"img/f04_f13406e16c2b6a8dda89763cf005b02b.png"},99381:(e,t,r)=>{e.exports=r.p+"img/f05_566b33dfb23660bf5fa83125a9dd8218.png"},4893:(e,t,r)=>{e.exports=r.p+"img/f06_f564cba48589a560af4b6e8408ae1718.png"},61353:(e,t,r)=>{e.exports=r.p+"img/f07_ae76e3caeb9dde2ad18eab0ce141d223.png"},45598:(e,t,r)=>{e.exports=r.p+"img/f08_59c98baa006f5eac6629be0957fd73f2.png"},79575:(e,t,r)=>{e.exports=r.p+"img/f09_1a7f295d0fa98fa1d2a63f8dc4600341.png"},5211:(e,t,r)=>{e.exports=r.p+"img/f10_53c9084de35f9f003ed395e1d120d9b6.png"},19751:(e,t,r)=>{e.exports=r.p+"img/f11_c129c05bc58cad686e0934357d6194fb.png"},61294:(e,t,r)=>{e.exports=r.p+"img/f12_bf90fa5257d34005ad5b75ffebb9b74c.png"},70938:(e,t,r)=>{e.exports=r.p+"img/f13_156bc51d4150b9b257fa4e2e774ce985.png"},81790:(e,t,r)=>{e.exports=r.p+"img/f14_95fa7d926a8cf1638985d3cd551fac31.png"},8669:(e,t,r)=>{e.exports=r.p+"img/f15_454f1add82fcb11fbb4086c8be3b1bd9.png"},30047:(e,t,r)=>{e.exports=r.p+"img/f16_9ca6324f98317f9d73084696719d2b9b.png"},61022:(e,t,r)=>{e.exports=r.p+"img/f17_9376c16fcd9b554de8a081973bebe9aa.png"},33295:(e,t,r)=>{e.exports=r.p+"img/f18_cc883fb28c32b1652826de5dc16feee0.png"},99635:(e,t,r)=>{e.exports=r.p+"img/f19_c448ba8ef94abcf763e25003aa15d27d.png"},82645:(e,t,r)=>{e.exports=r.p+"img/f20_4ebcff229b29e651b73640d0cd8eccb2.png"},67083:(e,t,r)=>{e.exports=r.p+"img/f21_54d02a1f6ad665760923ecfae9c9ff25.png"},55359:(e,t,r)=>{e.exports=r.p+"img/f22_ca38cbb571fbddb6900518455b8a20b9.png"},30003:(e,t,r)=>{e.exports=r.p+"img/f23_851a6d2ec552319ddaac7ff8ff37263e.png"},77659:(e,t,r)=>{e.exports=r.p+"img/f24_7806bc8ea69d9441ff27032fbaf52907.png"},81024:(e,t,r)=>{e.exports=r.p+"img/f25_68d927d9d12aef33387b683be6341340.png"},64195:(e,t,r)=>{e.exports=r.p+"img/f26_eb28a47950f61dc80827a74063d8786a.png"},37704:(e,t,r)=>{e.exports=r.p+"img/f27_d53f3b6cf583d7a41f3434d18fe4456e.png"},15626:(e,t,r)=>{e.exports=r.p+"img/f28_245f3d8d8dae33bdc04373918922c5a8.png"},12282:(e,t,r)=>{e.exports=r.p+"img/f29_31c6170329c4cf5808fe773488b5d143.png"},57894:(e,t,r)=>{e.exports=r.p+"img/f30_105e340803065abb74841ce2fff42b4b.png"},53320:(e,t,r)=>{e.exports=r.p+"img/f31_db46b1350eb553583212866aa44e2ac0.png"},18234:(e,t,r)=>{e.exports=r.p+"img/f32_4c358e4136bab81e06b7fd7171a7908c.png"},37426:(e,t,r)=>{e.exports=r.p+"img/f33_5a8f246313db052d67853a40f77a6427.png"},37382:(e,t,r)=>{e.exports=r.p+"img/f34_8588016a836bc826824d0656c8b7b0bc.png"},80904:(e,t,r)=>{e.exports=r.p+"img/f35_8aefe3b46c378109f0f780b6954e18db.png"},5193:(e,t,r)=>{e.exports=r.p+"img/f36_793fc72fadaf963507fc6802a9470970.png"},38324:(e,t,r)=>{e.exports=r.p+"img/f37_8d8f6653cbe1f6dd3783174a8af618da.png"},83149:(e,t,r)=>{e.exports=r.p+"img/f38_54b8f37e9f1251bfe9a2a2ef88a31912.png"},68480:(e,t,r)=>{e.exports=r.p+"img/f39_23a6e90aa9166a2fb981cc171abe8513.png"},35741:(e,t,r)=>{e.exports=r.p+"img/f40_923f39f07df4b8ad006e1115dcb206ec.png"},24081:(e,t,r)=>{e.exports=r.p+"img/f41_87448793e4bcea7fae3cfa7532e45033.png"},9062:(e,t,r)=>{e.exports=r.p+"img/f42_cd0e42183cff2e75bdde0c139bbb641a.png"},51839:(e,t,r)=>{e.exports=r.p+"img/f43_9f44150edcf010967cf272c80bd4ff14.png"},77271:(e,t,r)=>{e.exports=r.p+"img/f44_7f5d4a3e29f21bd5d5572a1543448949.png"},39622:(e,t,r)=>{e.exports=r.p+"img/f45_04c55805346c4afbc7f8084570a2cd48.png"},48373:(e,t,r)=>{e.exports=r.p+"img/f46_1e9f9b05193093b5d0d80d9c936bcb36.png"},51400:(e,t,r)=>{e.exports=r.p+"img/f47_152a85c5e9ff12d5f85050ecad1d4313.png"},42720:(e,t,r)=>{e.exports=r.p+"img/f48_bd6d89500662b8605997f54027b2e650.png"},43805:(e,t,r)=>{e.exports=r.p+"img/f49_42185158c0bfff92c70f417c74297ce7.png"},56995:(e,t,r)=>{e.exports=r.p+"img/f50_d825d156222c0d93428f4ecd78564c75.png"},75688:(e,t,r)=>{e.exports=r.p+"img/f51_51e116016636d309962001419e70d5f1.png"},31796:(e,t,r)=>{e.exports=r.p+"img/f52_5296e30be9bec98ccf173a9be6e711a9.png"},73785:(e,t,r)=>{e.exports=r.p+"img/f53_f81b7a3702779e190aeefb7e2183e636.png"},62521:(e,t,r)=>{e.exports=r.p+"img/f54_37b3eb612da7ad6c0b20b65e4fdae582.png"},71449:(e,t,r)=>{e.exports=r.p+"img/f55_0c3d912e971e18d6fe8946550262d0e6.png"},98224:(e,t,r)=>{e.exports=r.p+"img/f56_97a65c1c44dced234e0fbb5f78cb277f.png"},10601:(e,t,r)=>{e.exports=r.p+"img/f57_88b41898da1ce86274ee318e1713f437.png"},72870:(e,t,r)=>{e.exports=r.p+"img/f58_56649fe103006ec4fc5bdea5c69f7828.png"},93224:(e,t,r)=>{e.exports=r.p+"img/f59_1dd065a271b58e1ecb9bb3b6c261107f.png"},21564:(e,t,r)=>{e.exports=r.p+"img/f60_4b277b056575663ee9dbf81fecce989e.png"},93169:(e,t,r)=>{e.exports=r.p+"img/f61_ef3fba8c7e6d895afacfb334e7a746ff.png"},54423:(e,t,r)=>{e.exports=r.p+"img/f62_edecb61bfd5cd13895dd8134898d4402.png"},3491:(e,t,r)=>{e.exports=r.p+"img/f63_245e85a3728d5fed6ff9acf1182f4797.png"},86262:(e,t,r)=>{e.exports=r.p+"img/f64_48df8c352924ef1153bb8fd56f5af198.png"},37806:(e,t,r)=>{e.exports=r.p+"img/f65_162b82a8adaf7d2815129f38f265bfb6.png"},35049:(e,t,r)=>{e.exports=r.p+"img/f66_c626c592461087351ad719fa3118959d.png"},4971:(e,t,r)=>{e.exports=r.p+"img/f67_daa263ddff773a14e3ababc4b485a7c9.png"},32845:(e,t,r)=>{e.exports=r.p+"img/f68_ec21f5c8c90ec3bbf634290d6e6025c0.png"},29664:(e,t,r)=>{e.exports=r.p+"img/f69_549a880f1517135abf8914b4cb31fa92.png"},29469:(e,t,r)=>{e.exports=r.p+"img/f70_a69c6599124e3c33d7fac368b07c0249.png"},60540:(e,t,r)=>{e.exports=r.p+"img/f71_4aceb1dc5eaeb5f9cdddf4975e45a841.png"},14364:(e,t,r)=>{e.exports=r.p+"img/f72_f4ed6835609bf3831a20437e8e47d2dc.png"},34476:(e,t,r)=>{e.exports=r.p+"img/f73_94b8b5d2760e6afd967fd74a008cfae0.png"},80952:(e,t,r)=>{e.exports=r.p+"img/f74_2cd31cfe47f05fabb12f9b9f76fc2b6b.png"},47236:(e,t,r)=>{e.exports=r.p+"img/f75_25366bc618fe77d5dfd9db90133f2766.png"},91385:(e,t,r)=>{e.exports=r.p+"img/f76_1347ad29de86f3d0ceb3bf329b06a0a7.png"},86342:(e,t,r)=>{e.exports=r.p+"img/f77_6749eab5d350640476c8ec39ebc3e4db.png"},93828:(e,t,r)=>{e.exports=r.p+"img/f78_9effc679939e4458adafae48294a5db5.png"},7026:(e,t,r)=>{e.exports=r.p+"img/f79_36df3d2cd225fa6b3a6c84c69b72bed1.png"},59076:(e,t,r)=>{e.exports=r.p+"img/f80_f94a52bb981c25a9f8643a55d023be59.png"},86555:(e,t,r)=>{e.exports=r.p+"img/f81_fb74d3d4cc5a27e62e93586c7d09e47e.png"},15330:(e,t,r)=>{e.exports=r.p+"img/f82_2741f2d09772f3e9e836f2c50fb0bf99.png"},51331:(e,t,r)=>{e.exports=r.p+"img/f83_f8586167f3fde3b1e0c7dbb479e5c0ab.png"},44780:(e,t,r)=>{e.exports=r.p+"img/f84_f5b79393aa7e2979b376c76f46d39b52.png"},2506:(e,t,r)=>{e.exports=r.p+"img/f85_7ea40f8452fb838a747fb0881ffd5980.png"},27300:(e,t,r)=>{e.exports=r.p+"img/f86_486fdf332fda50c1cd7c4b9bd8a3f993.png"},30619:(e,t,r)=>{e.exports=r.p+"img/f87_91e88bfc16e4baddaf2fc4f881c3efc5.png"},83020:(e,t,r)=>{e.exports=r.p+"img/f88_286401f05def8a122db7f4686e383691.png"},58516:(e,t,r)=>{e.exports=r.p+"img/f89_658f39d559719b5b6208346f6a7753b9.png"},15707:(e,t,r)=>{e.exports=r.p+"img/f90_d5612bad79e603d92135c3bbfbcd14d1.png"},71247:(e,t,r)=>{e.exports=r.p+"img/f91_58bb429f953c740a98bcab0c032e8e25.png"},54647:(e,t,r)=>{e.exports=r.p+"img/f92_970e0969177b051897bdd55bf12ee3ae.png"},67517:(e,t,r)=>{e.exports=r.p+"img/f93_4776ec98a5d48ae85b24621ad1eac6eb.png"},83439:(e,t,r)=>{e.exports=r.p+"img/f94_296c4ae16a836cf0903cc5ef0476333c.png"},38404:(e,t,r)=>{e.exports=r.p+"img/f95_888ec2f78b312aed756a8d7008dc979b.png"},50273:(e,t,r)=>{e.exports=r.p+"img/f96_5b97286be655dbd4f5aa79f5f008c5ce.png"},44848:(e,t,r)=>{e.exports=r.p+"img/f97_b4ff99d92592c44b5d8a5b501fc24da6.png"},79144:(e,t,r)=>{e.exports=r.p+"img/f98_0922d228059acde80cc489a2879fe864.png"},40594:(e,t,r)=>{e.exports=r.p+"img/f99_c608e2edac2f741a5a39b814ba36c287.png"},72654:(e,t,r)=>{e.exports=r.p+"img/favicon-error_ac2b4ac0b3a8a9d2256d517e69a3e272.png"},19528:(e,t,r)=>{e.exports=r.p+"img/favicon-error2_fb2afa4bfd23495c7bd2555bb080bb35.png"},29242:(e,t,r)=>{e.exports=r.p+"img/favicon_c5088e888c97ad440a61d247596f88e5.png"},11372:(e,t,r)=>{e.exports=r.p+"img/f00_81a748c30861e19178cb90ab8b31c9e4.png"},48039:(e,t,r)=>{e.exports=r.p+"img/f01_78cd893586564a736b94f919cd2851f7.png"},49519:(e,t,r)=>{e.exports=r.p+"img/f02_4bfcfe058a11109e81b7e9cbdfdeb02a.png"},98446:(e,t,r)=>{e.exports=r.p+"img/f03_577fd59324f5db48af17efcba0a23ea5.png"},68917:(e,t,r)=>{e.exports=r.p+"img/f04_841c20c722f90620ba13762ae73f6143.png"},46454:(e,t,r)=>{e.exports=r.p+"img/f05_c1bde74d642126370c5da5fb0de680c6.png"},80841:(e,t,r)=>{e.exports=r.p+"img/f06_eb85be6945aa4a51c3e05d97ecb1c290.png"},41038:(e,t,r)=>{e.exports=r.p+"img/f07_4d1031e781a9619d0579571eb2049ee6.png"},57522:(e,t,r)=>{e.exports=r.p+"img/f08_4d61c3d691066fa829ad43af1d6063ca.png"},4754:(e,t,r)=>{e.exports=r.p+"img/f09_f9d4e1b3266f81e8952251520de80711.png"},44183:(e,t,r)=>{e.exports=r.p+"img/f10_1f2eeb1340d4c4b4d423117d47d5f56e.png"},99233:(e,t,r)=>{e.exports=r.p+"img/f11_699424412fed1628d27e04957a284d2e.png"},347:(e,t,r)=>{e.exports=r.p+"img/f12_ef4dd9b4bc88503d33fde312a57af7f9.png"},52761:(e,t,r)=>{e.exports=r.p+"img/f13_0bf1895a611a2187f9758ac305e87d2e.png"},19754:(e,t,r)=>{e.exports=r.p+"img/f14_df2ad83835b022116ce26f030de1a13d.png"},18613:(e,t,r)=>{e.exports=r.p+"img/f15_cffc8769d0c2ef7f8f8d5fc16e339cab.png"},17613:(e,t,r)=>{e.exports=r.p+"img/f16_8b958a65cb9dbf5c7716f1c865391473.png"},70322:(e,t,r)=>{e.exports=r.p+"img/f17_83147bc30e9d1cfe9ae417bf4afc2f77.png"},55928:(e,t,r)=>{e.exports=r.p+"img/f18_9595be739a769411763ad68c24cb245f.png"},98442:(e,t,r)=>{e.exports=r.p+"img/f19_2b465cf764fb53292292e003e070268a.png"},32677:(e,t,r)=>{e.exports=r.p+"img/f20_a781e4e7a5b4d97c226843b0f2d1472d.png"},64770:(e,t,r)=>{e.exports=r.p+"img/f21_b03a1e45532edd017ebbda6b8e2566bb.png"},43426:(e,t,r)=>{e.exports=r.p+"img/f22_809ee1be83cf9aba76ecde6bf3e65e58.png"},31644:(e,t,r)=>{e.exports=r.p+"img/f23_e2c0fa78795ee79b68fdbdca50a960ae.png"},6597:(e,t,r)=>{e.exports=r.p+"img/f24_3832927a08d4eec1867a7d7c4ba2fcd7.png"},7210:(e,t,r)=>{e.exports=r.p+"img/f25_0ade03b46b6e8819de9523bc8ff6a7cd.png"},61890:(e,t,r)=>{e.exports=r.p+"img/f26_e38c0e2c62dae55d9cdf26d8c22b6b9d.png"},58229:(e,t,r)=>{e.exports=r.p+"img/f27_b4871a7570313a9f599b1911f339413d.png"},81250:(e,t,r)=>{e.exports=r.p+"img/f28_1b3971aa7b75218570c3d9940aa4a73d.png"},41431:(e,t,r)=>{e.exports=r.p+"img/f29_f2c7a605126e29e8885601cdc65e6aa0.png"},60853:(e,t,r)=>{e.exports=r.p+"img/f30_712d71bfb048818a771a9d144b40d9aa.png"},75920:(e,t,r)=>{e.exports=r.p+"img/f31_1d19e90516ce464192bd7016d05a2dba.png"},21202:(e,t,r)=>{e.exports=r.p+"img/f32_9a70dc1de944f622b350752076a6310d.png"},23022:(e,t,r)=>{e.exports=r.p+"img/f33_1f3382e82a8abe7cdce46f789f7c4ede.png"},46622:(e,t,r)=>{e.exports=r.p+"img/f34_29dc69ea8e91117dae46fcf7e7f58417.png"},13683:(e,t,r)=>{e.exports=r.p+"img/f35_fa478612d2487e2fead293b7005566ea.png"},45274:(e,t,r)=>{e.exports=r.p+"img/f36_bb827e69f0979553e18c0fd1cb192b02.png"},74507:(e,t,r)=>{e.exports=r.p+"img/f37_b06f5850d2c8eda0c51ad5491779af6c.png"},36466:(e,t,r)=>{e.exports=r.p+"img/f38_0b370e976457b876910c4a638ac302e2.png"},55254:(e,t,r)=>{e.exports=r.p+"img/f39_a09d7dfecc70b04ec35edc2967c60a30.png"},95725:(e,t,r)=>{e.exports=r.p+"img/f40_ed134cdcd59bb430218f2be2cdd20aa1.png"},97585:(e,t,r)=>{e.exports=r.p+"img/f41_a785dbfd120b89c2e8616357b9722163.png"},75218:(e,t,r)=>{e.exports=r.p+"img/f42_4149402ff16c6de0b1b06eff01619455.png"},81303:(e,t,r)=>{e.exports=r.p+"img/f43_d543d1bc6a09014ac24d7189b0ced761.png"},49465:(e,t,r)=>{e.exports=r.p+"img/f44_9ffa8beb4bd1c21f328fdd822cba19a7.png"},55625:(e,t,r)=>{e.exports=r.p+"img/f45_0c3cea68945b437380dacd15cbe90ded.png"},48475:(e,t,r)=>{e.exports=r.p+"img/f46_58320ab4676a6287d9dec0790f0d88fc.png"},67848:(e,t,r)=>{e.exports=r.p+"img/f47_5f2ac6f7a9fe79dc3d9a701872c0d0f8.png"},58139:(e,t,r)=>{e.exports=r.p+"img/f48_5fdbdf26d5c581f2a84ebfa50355bd2d.png"},97019:(e,t,r)=>{e.exports=r.p+"img/f49_7bd9cdf5a225ef778b0abd7c9b5310ba.png"},63744:(e,t,r)=>{e.exports=r.p+"img/f50_f4b49b8b3eb729c1fd7c991958aa67b7.png"},14517:(e,t,r)=>{e.exports=r.p+"img/f51_cccd95bad4c9b8e03d05f634e91d2cc8.png"},2181:(e,t,r)=>{e.exports=r.p+"img/f52_8cc8a9757166f53c59a5a1c5e2ebeb00.png"},65405:(e,t,r)=>{e.exports=r.p+"img/f53_623900497390a42269ea6c7ffd812ecc.png"},61605:(e,t,r)=>{e.exports=r.p+"img/f54_c114021c7945464df273df92403987cb.png"},90866:(e,t,r)=>{e.exports=r.p+"img/f55_bcfef9ad8bf26d250613af9b04c918cf.png"},71888:(e,t,r)=>{e.exports=r.p+"img/f56_76dd317a660aa4927e72484ef9d903fb.png"},35515:(e,t,r)=>{e.exports=r.p+"img/f57_72ed0f17ab92bb06761245cb5a7fd73b.png"},18457:(e,t,r)=>{e.exports=r.p+"img/f58_8b9aa917870bcfabc296989c8a810446.png"},20009:(e,t,r)=>{e.exports=r.p+"img/f59_1a64de23c9ec094314b18a18108319ce.png"},63163:(e,t,r)=>{e.exports=r.p+"img/f60_4926d3e8b53f38a3c792cb7b3e07d48d.png"},20930:(e,t,r)=>{e.exports=r.p+"img/f61_08509dff37749613925fe8b16a84ba56.png"},69341:(e,t,r)=>{e.exports=r.p+"img/f62_0869c06452d4ebecdc99f7192ebc702f.png"},8373:(e,t,r)=>{e.exports=r.p+"img/f63_6083f333c2239cba7bbde44e7607a67c.png"},99910:(e,t,r)=>{e.exports=r.p+"img/f64_5d2e1af055fb2cb08326de8e4a844eab.png"},10127:(e,t,r)=>{e.exports=r.p+"img/f65_c863d05c20e4ff179c46170a5311afaf.png"},34843:(e,t,r)=>{e.exports=r.p+"img/f66_1971ad2c6440b2fc909759d8614ef901.png"},68683:(e,t,r)=>{e.exports=r.p+"img/f67_8817a536067dadbc7dc0b1ce0c7cca51.png"},79587:(e,t,r)=>{e.exports=r.p+"img/f68_11393ba2b52ac23a884f923672858aa3.png"},81265:(e,t,r)=>{e.exports=r.p+"img/f69_6a31bf9a0987d546a53d7e8e148d9fa3.png"},29761:(e,t,r)=>{e.exports=r.p+"img/f70_6a12b8c8cf306de335b3174c92c7d63d.png"},67156:(e,t,r)=>{e.exports=r.p+"img/f71_363e1241dbcac22f3bebce9bb5e03e85.png"},14427:(e,t,r)=>{e.exports=r.p+"img/f72_ae6ac1146134ea79656c595a1a2d0e8b.png"},18241:(e,t,r)=>{e.exports=r.p+"img/f73_c9b6d05e598e5adf69ceab85f5db96ac.png"},55948:(e,t,r)=>{e.exports=r.p+"img/f74_67c9ceb4623d37c005ae86e28e4e9fbe.png"},20439:(e,t,r)=>{e.exports=r.p+"img/f75_62cbd93e646a20f624123b595584f2a2.png"},85044:(e,t,r)=>{e.exports=r.p+"img/f76_6862123772ba72af8d1f307c0d2b4895.png"},56746:(e,t,r)=>{e.exports=r.p+"img/f77_78710dcf8b6d89f3951e7887f95408bf.png"},73675:(e,t,r)=>{e.exports=r.p+"img/f78_59e408dc54ae0bd33f3617f7ee9bb2e0.png"},63159:(e,t,r)=>{e.exports=r.p+"img/f79_6682dcc8dd4b1c197e7ec7b9b3deb601.png"},37160:(e,t,r)=>{e.exports=r.p+"img/f80_0d13bdc19570b4c3577062fd0a3a1428.png"},31456:(e,t,r)=>{e.exports=r.p+"img/f81_bfb32e248b9a30d62e32a1f7ea4e7e98.png"},58193:(e,t,r)=>{e.exports=r.p+"img/f82_286f2cdea929dc7b1565aad502aaf165.png"},68436:(e,t,r)=>{e.exports=r.p+"img/f83_4984ad9c5348e8717965f575ac7ea534.png"},15188:(e,t,r)=>{e.exports=r.p+"img/f84_4d4303666006c977553c896dd850fc1b.png"},35444:(e,t,r)=>{e.exports=r.p+"img/f85_10cbc8d1444126f654a032456a74a72c.png"},61218:(e,t,r)=>{e.exports=r.p+"img/f86_03d43f57ad876d0367274524fd27b4ec.png"},12535:(e,t,r)=>{e.exports=r.p+"img/f87_610b9a8f68249032da365af5a664fc41.png"},56277:(e,t,r)=>{e.exports=r.p+"img/f88_5ad6ef9e65165c4bb4c670ce875a5fb5.png"},11847:(e,t,r)=>{e.exports=r.p+"img/f89_e049c6b076ab9212a901406939d7274e.png"},83242:(e,t,r)=>{e.exports=r.p+"img/f90_88c16bdd2fd8228ad1ec89ce3f0cb118.png"},97168:(e,t,r)=>{e.exports=r.p+"img/f91_78d445d5baae7479cac968c11f6724dc.png"},6763:(e,t,r)=>{e.exports=r.p+"img/f92_34f845f9fa2a3667d8d747453f63ad68.png"},69685:(e,t,r)=>{e.exports=r.p+"img/f93_2f324509fe48d002f5a944b003cd180d.png"},34887:(e,t,r)=>{e.exports=r.p+"img/f94_c406ffa6170c14bcbe3158ab7879ce16.png"},24111:(e,t,r)=>{e.exports=r.p+"img/f95_7ce72143c371f981d394ab9b3391f5ea.png"},71972:(e,t,r)=>{e.exports=r.p+"img/f96_bc32095dc9dab040674f58592e10451b.png"},39920:(e,t,r)=>{e.exports=r.p+"img/f97_eedf5849b413d903c4cc72cca6ce0576.png"},94784:(e,t,r)=>{e.exports=r.p+"img/f98_8d47ec83349711222b6d9346049676f1.png"},60795:(e,t,r)=>{e.exports=r.p+"img/f99_d27a48329dde7e88d3d7cd348d745f91.png"},6769:(e,t,r)=>{e.exports=r.p+"img/favicon-error_ef91873fcda4eda22679f675ebf6ed24.png"},77238:(e,t,r)=>{e.exports=r.p+"img/favicon-error2_7ce1b67dbef23e87862b3c12b9b32676.png"},56216:(e,t,r)=>{e.exports=r.p+"img/favicon_94e99ab189284094867d2e1220e42e9f.png"},37849:(e,t,r)=>{e.exports=r.p+"img/icon-group-default_92b8a80d57227e2f342bd57ccf6382d8.png"},52026:(e,t,r)=>{e.exports=r.p+"img/icon-user-default_bfb4ec026499f5b2d80e673a1a3a5bd7.png"},18714:(e,t,r)=>{e.exports=r.p+"img/intro-connection-dark_0ee01153183b5ebd9b296399cc2104b0.jpg"},30046:(e,t,r)=>{e.exports=r.p+"img/intro-connection-hq-dark_f8cb12a6fc73afaf9d5903b7849bebd6.jpg"},20733:(e,t,r)=>{e.exports=r.p+"img/intro-connection-hq-light_9466a20e6d2921a21ac7ab82419be157.jpg"},20005:(e,t,r)=>{e.exports=r.p+"img/intro-connection-light_c98cc75f2aa905314d74375a975d2cf2.jpg"},77152:(e,t,r)=>{e.exports=r.p+"img/qr-video-hq_c001ebd6ddb0ba5fc7de491dfb556024.png"},15767:(e,t,r)=>{e.exports=r.p+"img/qr-video_0c6ec69b054fdeb31cf3e5e10290fd8e.png"},57895:(e,t,r)=>{e.exports=r.p+"notification_2a485d84012c106acef03b527bb54635.mp3"},32657:(e,t,r)=>{e.exports=r.p+"send_message_98602e277c84944aafc41098fa4dd8d8.m4a"},63320:(e,t,r)=>{e.exports=r.p+"sequential-ptt-end_62ed28be622237546fd39f9468a76a49.mp3"},16663:(e,t,r)=>{e.exports=r.p+"sequential-ptt-middle_7fa161964e93db72b8d00ae22189d75f.mp3"},26252:(e,t,r)=>{e.exports=r.p+"whatsapp-webclient-login-hq_0e0caf2391158ebc09fe32edd1022d03.mp4"},15109:(e,t,r)=>{e.exports=r.p+"whatsapp-webclient-login_c09223f0813e7c3adc16476cba2a5d0d.mp4"},2300:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={wrapper:"_1ADa8",isQR:"nMnIl",isQr:"nMnIl",draggableHeader:"_2jOS3",isMain:"_3Nsgw"}},95747:(e,t,r)=>{"use strict";r.r(t)},3010:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={button:"_20C5O",plainWhite:"GObVX",primary:"_2Zdgs",secondary:"_1zOyO",solidWarning:"_3opZY",strongPrimary:"pNwLD",warning:"_1XvHd",itemFocused:"_2yKMT",disabled:"_3fyVm",nowrap:"_1gUOr",simplified:"_1RguK",strong:"SEZ8N"}},12783:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={noop:"tm2tP"}},52204:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={noop:"i0jNr"}},70284:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={"-emoji-picker-width":"388px",emojiPickerWidth:"388px","-reaction-details-width":"375px",reactionDetailsWidth:"375px",container:"o--vV",reactionDetails:"_3HjyJ",right:"wGJyi",picker:"_3nQGi",tooltip:"_3t1CR",items:"_1HnQz",nib:"_2hkxa",inverse:"QLmve",colorPicker:"fe-ue",emoji:"_3IU7z",sticker:"_1166F",inverseVertical:"_24No0",text:"_3h2j_",icons:"_1lPfJ"}},41523:(e,t,r)=>{"use strict";r.r(t)},64312:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={container:"_1N4rE"}},95642:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={container:"_209uk"}},22074:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={progress:"_35Zb2"}},73176:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={video:"_3-soo",container:"_1hsvr",player:"_1WD62",poster:"kqpxs",hidden:"_2XlyB",overlay:"_1E40b",button:"_2wAIt",play:"_11Jja"}},3306:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={qrWrapper:"_1N3oL",text:"_2WuPw",qr:"_25pwu",headline:"_3-XoE",list:"_2A31C",listItem:"QtrYx",hint:"_3aF8K",toggle:"_2lolS",tip:"_2jR6Q",rememberMeTip:"w2rV5",codeCopy:"_3YgA3",qrcode:"_2UwZ_",codeLogo:"b77wc",idle:"n4LVt",qrButton:"_2znac",qrButtonIcon:"_1pFa_",groupInviteTip:"_3Egqg",icon:"_30yMe"}},25171:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={"weight-light":"_7qtH8",weightLight:"_7qtH8","weight-normal":"_1lF7t",weightNormal:"_1lF7t","weight-medium":"_3EVTz",weightMedium:"_3EVTz","weight-semibold":"_3VDu5",weightSemibold:"_3VDu5","weight-bold":"_2I4o9",weightBold:"_2I4o9","size-8":"_2Le-W",size8:"_2Le-W","size-9":"_2lMoY",size9:"_2lMoY","size-10":"_3QN-O",size10:"_3QN-O","size-11":"_1uSon",size11:"_1uSon","size-12":"_1MfDb",size12:"_1MfDb","size-13":"_2xTZM",size13:"_2xTZM","size-14":"VWPRY",size14:"VWPRY","size-15":"_3SFxP",size15:"_3SFxP","size-16":"_1FXE6",size16:"_1FXE6","size-17":"_2LoZ-",size17:"_2LoZ-","size-18":"ioBp1",size18:"ioBp1","size-19":"oUgLo",size19:"oUgLo","size-20":"_1ioN3",size20:"_1ioN3","size-22":"Urfuj",size22:"Urfuj","size-24":"_3rp2W",size24:"_3rp2W","size-26":"_1651n",size26:"_1651n","size-28":"_1o3ni",size28:"_1o3ni","size-30":"_3jq2u",size30:"_3jq2u","size-32":"_1Zkh5",size32:"_1Zkh5","size-36":"_2gaDs",size36:"_2gaDs","size-48":"i_P7s",size48:"i_P7s","size-60":"_116zp",size60:"_116zp",title:"_3NUK1",large:"_3WYXy","section-title":"_2MNpf",sectionTitle:"_2MNpf","section-title-larger":"_24CNZ",sectionTitleLarger:"_24CNZ",small:"TWzFz",muted:"_3Bg5b","muted-small":"_2gdKz",mutedSmall:"_2gdKz",plain:"_26jM1","popup-title":"wMe6l",popupTitle:"wMe6l","color-accent":"_35orJ",colorAccent:"_35orJ","color-danger":"_2Hpjf",colorDanger:"_2Hpjf","color-dark":"PoW1D",colorDark:"PoW1D","color-primary":"_2cf_G",colorPrimary:"_2cf_G","color-secondary":"AjtLy",colorSecondary:"AjtLy","color-muted":"_2P9Q7",colorMuted:"_2P9Q7","color-success":"_3Vwf8",colorSuccess:"_3Vwf8"}},43760:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={pending:"_3zTDv"}},54186:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={mask:"_25anU"}},49959:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={container:"_1INL_",web:"_1UG2S",containerFixed:"_1iyey",graphic:"_26aja",logo:"_35GDA",dots:"_2pp-n",laptop:"_1JPfm",shimmering:"_1dEQH",shimmer:"_3vobx",initialLoad:"_2FX6G",didYouKnow:"WD35o",logout:"_3iu7m",organizing:"A_WMk",progress:"_30oB1",main:"_2dfCc",secondary:"_2e4Ei",warning:"QgIWN",showWarning:"_3dIM5",dot:"behLh",connecting:"_2VJL-",downloading:"ygjbp"}},31230:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={background:"_2c_rw",mainWrapper:"_5XBCY",logoutTitle:"_329-Z"}},74196:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={backdrop:"_2B4d4",popupContainer:"_3ev9-",popup:"_3J6wB",popupBody:"nne8e",popupTitle:"_1bpDE",backdropCover:"_1QH2G",popupContents:"_2Nr6U",popupBox:"_2DOJ8",popupFlex:"_2EOHJ",popupAuto:"_1PdSy",popupControls:"_2i3w0",popupFlexInvite:"_3cUTm",popupFlexUpgrade:"_1jalA",popupTower:"_2ctZG",popupGuide:"_1hMip",popupColumnButtons:"_1Nf9C",popupMultiline:"_37AQP",popupCustomSize:"_2fblo"}},39211:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={action:"_1WVC6",textTip:"_14jEY",divider:"_1Uvap"}},30173:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={textTip:"_2Z6v5",divider:"_2Xgjp"}},9686:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={focusAnimation:"_2BW67",focusAnimationKeyframes:"k4bcw"}},35474:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"index.dbe9e9782eee9a9d0228.worker.js")}r.r(t),r.d(t,{default:()=>n})},91528:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"milan.e22463091513e8cc98a7.worker.js")}r.r(t),r.d(t,{default:()=>n})},42372:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"opus.09102b21e963a34779d8.worker.js")}r.r(t),r.d(t,{default:()=>n})},47282:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"rgba_to_webp.worker.73cf0c075ce7e96424c2.worker.js")}r.r(t),r.d(t,{default:()=>n})},71597:(e,t,r)=>{"use strict";function n(){return new Worker(r.p+"webp_to_rgba.worker.9d8a97deb706cdeba4c9.worker.js")}r.r(t),r.d(t,{default:()=>n})},42329:()=>{}},e=>{"use strict";e.O(0,[1174],(()=>{return t=29821,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=https://web.whatsapp.com/bootstrap_qr.b9c65680b4522510f2dc.js.map
